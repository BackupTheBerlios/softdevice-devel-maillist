From stefan at lucke.in-berlin.de  Sun Oct  1 01:27:38 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 1 Oct 2006 01:27:38 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a long
	time
In-Reply-To: <20060930180425.GB2818@localhost.localdomain>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
Message-ID: <200610010127.38153.stefan@lucke.in-berlin.de>

On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
> > I usually let mine turn itself on and off with nvram-wakeup! I see
> > the problem when I leave it for a short while in the middle of something
> > and get distracted!
> 
> Me too.  Sometimes, I hit the Power button followed by some other button
> to suspend the playback and to prevent the system from powering off.
> Then, I'd hit the Power button to resume.
> 
> > Hmmm...if you're right about this, how long should it take to overflow? The 
> > only counter I can see is a 64-bit integer which looks like it's counting in 
> > useconds which would take a few million years to overflow, by my reckoning! 
> > Maybe I'm looking in the wrong place and it's a 32-bit counter which would 
> > take 1 h 12 min to overflow. Not sure it was taking that long but it's hard 
> > to tell.

Negative values should not harm,as we would return immedeatly.

> 
> I would have believed that one hang occurred after a 40-minute suspension.
> Could it perhaps be a signed counter, counting 1<<31 microseconds before
> overflow?

40 minute time frame is good. Had to wait a 2nd one, as I did not save my
inserted trace messages :-( .

Pause:
Oct  1 00:28:47 jarada jarada vdr: [32130] setting audio track to 1 (0)
Oct  1 00:28:47 jarada jarada vdr: [32133] [softdevice-audio]: xrun

Play:
Oct  1 01:11:37 jarada jarada vdr: [32133] [softdevice-audio]: xrun

And now we'll wait for about 27 minutes (without getting signalled?):
Pause:
 -- 0  signalled :retcode -- : Invalid argument
Play:
-- Play --
-- Play --
 -- bad timeout 1665974591 634cc13f --

/* --- cSigTimer --------------------------------------------------------------
 */
int cSigTimer::Sleep(int timeoutUS, int lowLimitUS)
{
  got_signal=false;
  if ( timeoutUS < lowLimitUS )
    return GetRelTime();

if (timeoutUS > 1000000)
fprintf(stderr, " -- bad timeout %d %08x --\n", timeoutUS, timeoutUS);
  struct timeval tv;
  gettimeofday(&tv,NULL);
  struct timespec timeout;
  timeout.tv_nsec=(tv.tv_usec+timeoutUS-lowLimitUS);//*1000;
  timeout.tv_sec=tv.tv_sec + timeout.tv_nsec / 1000000;
  timeout.tv_nsec%=1000000;
  timeout.tv_nsec*=1000;
  pthread_mutex_lock(&mutex);
  int retcode=0;
  while ( retcode != ETIMEDOUT && !got_signal ) {
    retcode = pthread_cond_timedwait(&cond, &mutex, &timeout);
if (retcode != ETIMEDOUT && retcode != EINTR)
{fprintf(stderr, " -- %d %s signalled :", retcode, (got_signal) ? "": "NOT ");
perror("retcode -- ");}
  }

  got_signal = false;
  pthread_mutex_unlock(&mutex);
  return GetRelTime();
}

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Oct  1 01:42:39 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 1 Oct 2006 01:42:39 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a long
	time
In-Reply-To: <200610010127.38153.stefan@lucke.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
Message-ID: <200610010142.39325.stefan@lucke.in-berlin.de>

On Sonntag 01 Oktober 2006 01:27, Stefan Lucke wrote:
> On Samstag 30 September 2006 20:04, Marko M?kel? wrote:

> > I would have believed that one hang occurred after a 40-minute suspension.
> > Could it perhaps be a signed counter, counting 1<<31 microseconds before
> > overflow?
> 
> 40 minute time frame is good. Had to wait a 2nd one, as I did not save my
> inserted trace messages :-( .
> 
> Pause:
> Oct  1 00:28:47 jarada jarada vdr: [32130] setting audio track to 1 (0)
> Oct  1 00:28:47 jarada jarada vdr: [32133] [softdevice-audio]: xrun
> 
> Play:
> Oct  1 01:11:37 jarada jarada vdr: [32133] [softdevice-audio]: xrun
> 
> And now we'll wait for about 27 minutes (without getting signalled?):

After that time, playback continued. Have a nice sleep.

-- 
Stefan Lucke


From jonis2006 at yandex.ru  Sun Oct  1 11:24:49 2006
From: jonis2006 at yandex.ru (jonis2006)
Date: Sun, 1 Oct 2006 13:24:49 +0400 (MSD)
Subject: [Softdevice-devel] Problems with field parity
Message-ID: <451F8961.000002.30674@colgate.yandex.ru>

Hello !

When I watching DVDs with another field parity than standard (top), I see damaged interlacing(wrong field parity), both in PAL and NTSC of course. 

How I can fix it ?


From M.Wache at gmx.net  Sun Oct  1 14:12:22 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 01 Oct 2006 14:12:22 +0200
Subject: [Softdevice-devel] ShmClient and cropping
In-Reply-To: <14472-39254@sneakemail.com>
References: <mailman.21.1159610418.3483.softdevice-devel@lists.berlios.de>
	<14472-39254@sneakemail.com>
Message-ID: <451FB0A6.1000907@gmx.net>

CR schrieb:
> Hi,
> 
> I recently learned about the softdevice ShmClient option.  This is perfect
> for me since I want vdr running in the background to record shows and if I
> want to watch TV, I can launch the client.
> 
> 1. The ShmClient does not seem to honor the cropping setting. Perhaps this
> is part of it not being able to access the "SetupStore"?  I'd like to crop
> the first line from the top, usually I see a bunch of flickering there.
> 
> Can I compile in an option in the ShmClient to get it to remove the top
> line?  Any otherways to accomplish this?
> 
Cropping for the ShmClient is now in the cvs, it is only a minor change
in the code. When I started the ShmClient I did not care about it, and
up to now I did not miss it ;-)

> 2. When using ShmClient, the image on the screen is shifted down and to
> the right by 20-30 pixels (it looks like).  When using softdevice -vo xv,
> the image looks correct (without any strange offsets).
> 
> If I set the post processing quality (with post processing off) to medium,
> and/or turn on mirroring, the image pops back to the place where I would
> expect it (same place as running -vo xv).  Anyway to get the ShmClient's
> output to match the standard -xv output?
>
Hm, I guess that is a bug, I havn't yet had the time to trace this down.

> If ShmClient cannot be fixed or made to do any of this, is there a way to
> suspend the -vo xv output, and then resume it later?
> 
Sure you can suspend the output with the option in the softdevice menu.
But you cant close the softdevice window with xv.

Bye,
Martin


From M.Wache at gmx.net  Sun Oct  1 14:31:45 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 01 Oct 2006 14:31:45 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a long
 time
In-Reply-To: <200610010127.38153.stefan@lucke.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>	<451E8F0D.3050700@gmx.net>	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
Message-ID: <451FB531.7020101@gmx.net>

Stefan Lucke schrieb:
> On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
>> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
>>> I usually let mine turn itself on and off with nvram-wakeup! I see
>>> the problem when I leave it for a short while in the middle of something
>>> and get distracted!
>> Me too.  Sometimes, I hit the Power button followed by some other button
>> to suspend the playback and to prevent the system from powering off.
>> Then, I'd hit the Power button to resume.
>>
>>> Hmmm...if you're right about this, how long should it take to overflow? The 
>>> only counter I can see is a 64-bit integer which looks like it's counting in 
>>> useconds which would take a few million years to overflow, by my reckoning! 
>>> Maybe I'm looking in the wrong place and it's a 32-bit counter which would 
>>> take 1 h 12 min to overflow. Not sure it was taking that long but it's hard 
>>> to tell.
> 
> Negative values should not harm,as we would return immedeatly.
> 
I think the problem is in cSyncTimer::GetRelTime() which returns an
signed int. If GetRelTime() returns a negative number because of an
overflow we will actually add that value to delay instead of
substracting, when we do the ususal delay-=GetRelTime().

We could avoid this by letting GetRelTime() return some maximum, if
there have been overflows. This would fix the pause problem as well as
Marco's problem.

Bye,
Martin


From leo at calidae.net  Mon Oct  2 09:20:13 2006
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Mon, 02 Oct 2006 09:20:13 +0200
Subject: [Softdevice-devel] osd and audio ok, but black screen
Message-ID: <4520BDAD.9080702@calidae.net>

Hi,

I have a nvidia card for the output of my vdr server. I'm trying to get 
working with softdevice and dfb.
I have setted up a framebuffer with nvidiafb. A fbset -i get this:

vdr:~# fbset -i

mode "768x576-75"
    # D: 49.188 MHz, H: 46.580 kHz, V: 75.008 Hz
    geometry 768 576 768 1152 32
    timings 20330 128 32 32 8 128 5
    rgba 8/16,8/8,8/0,8/24
endmode

Frame buffer device information:
    Name        : NV2
    Address     : 0xe4000000
    Size        : 33554432
    Type        : PACKED PIXELS
    Visual      : DIRECTCOLOR
    XPanStep    : 8
    YPanStep    : 1
    YWrapStep   : 0
    LineLength  : 3072
    MMIO Address: 0xe6000000
    MMIO Size   : 16777216
    Accelerator : nVidia RIVA TNT

My directfbrc is:

mode  = 768x576
depth = 32


When I start vdr i ge audio and osd, but don't see any image.
Anyone knows how to solve the problem? Perhaps a nvidiafb module parameter?

Thank you.


From stefan at lucke.in-berlin.de  Mon Oct  2 10:20:28 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon,  2 Oct 2006 10:20:28 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a long
	time
In-Reply-To: <451FB531.7020101@gmx.net>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
Message-ID: <1159777228.4520cbcc9e6cb@webmail.in-berlin.de>

Zitat von Martin Wache <M.Wache at gmx.net>:

> Stefan Lucke schrieb:
> > On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
> >> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
> >>> I usually let mine turn itself on and off with nvram-wakeup! I see
> >>> the problem when I leave it for a short while in the middle of something
> >>> and get distracted!
> >> Me too.  Sometimes, I hit the Power button followed by some other button
> >> to suspend the playback and to prevent the system from powering off.
> >> Then, I'd hit the Power button to resume.
> >>
> >>> Hmmm...if you're right about this, how long should it take to overflow? The
> >>> only counter I can see is a 64-bit integer which looks like it's counting in
> >>> useconds which would take a few million years to overflow, by my reckoning!
> >>> Maybe I'm looking in the wrong place and it's a 32-bit counter which would
> >>> take 1 h 12 min to overflow. Not sure it was taking that long but it's hard
> >>> to tell.
> >
> > Negative values should not harm,as we would return immedeatly.
> >
> I think the problem is in cSyncTimer::GetRelTime() which returns an
> signed int. If GetRelTime() returns a negative number because of an
> overflow we will actually add that value to delay instead of
> substracting, when we do the ususal delay-=GetRelTime().

The -= operator is the one which is causing troubles. I guess we should
introduce a private member "clampValue" , and return values of TimePassed()
and GetRelTime() should be clamped to +/- clampValue if it is nonzero.

The one thing which I cannot recalulate is: I had a sleep time of 27min (0x634cc13f usec).
Time passed between pause/play was about 42min 50sec (0x992f1680 usec) .

>
> We could avoid this by letting GetRelTime() return some maximum, if
> there have been overflows. This would fix the pause problem as well as
> Marco's problem.
>
> Bye,
> Martin
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>




From stefan at lucke.in-berlin.de  Tue Oct  3 09:30:27 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue,  3 Oct 2006 09:30:27 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a
	long	time
In-Reply-To: <1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
Message-ID: <1159860627.45221193b05af@webmail.in-berlin.de>

Zitat von Stefan Lucke <stefan at lucke.in-berlin.de>:

> Zitat von Martin Wache <M.Wache at gmx.net>:
>
> > Stefan Lucke schrieb:
> > > On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
> > >> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
> > >>> I usually let mine turn itself on and off with nvram-wakeup! I see
> > >>> the problem when I leave it for a short while in the middle of something
> > >>> and get distracted!
> > >> Me too.  Sometimes, I hit the Power button followed by some other button
> > >> to suspend the playback and to prevent the system from powering off.
> > >> Then, I'd hit the Power button to resume.
> > >>
> > >>> Hmmm...if you're right about this, how long should it take to overflow? The
> > >>> only counter I can see is a 64-bit integer which looks like it's counting in
> > >>> useconds which would take a few million years to overflow, by my reckoning!
> > >>> Maybe I'm looking in the wrong place and it's a 32-bit counter which would
> > >>> take 1 h 12 min to overflow. Not sure it was taking that long but it's hard
> > >>> to tell.
> > >
> > > Negative values should not harm,as we would return immedeatly.
> > >
> > I think the problem is in cSyncTimer::GetRelTime() which returns an
> > signed int. If GetRelTime() returns a negative number because of an
> > overflow we will actually add that value to delay instead of
> > substracting, when we do the ususal delay-=GetRelTime().
>
> The -= operator is the one which is causing troubles.

That computed value is not only issue in that situation. I managed to
avoid hang by some other changes. With current code we are loosing a signal to
the condition variable.
I did the following changes to sync_timer.c
1. cSigTimer::Sleep() clear signal "got_signal=false;" only if would not sleep.

-- snip --
/* --- cSigTimer --------------------------------------------------------------
 */
int cSigTimer::Sleep(int timeoutUS, int lowLimitUS)
{
  if ( timeoutUS < lowLimitUS ) {
    got_signal=false;
    return GetRelTime();
  }

-- snip --

2. cSyncTimer::Sleep(): clear signals "got_signal=false;" only in case of
   emUsleepTimer and emRtcTimer.

-- snip --
/* ----------------------------------------------------------------------------
 */
void cSyncTimer::Sleep(int *timeoutUS, int lowLimitUS)
{
  switch(syncMode)
  {
    case emUsleepTimer: // usleep timer mode
      while ((*timeoutUS - lowLimitUS) > 2200 && !got_signal)
      {
        usleep (2200);
        *timeoutUS -= GetRelTime ();
      }
      break;
      got_signal=false;
    case emRtcTimer: // rtc timer mode
      while ((*timeoutUS - lowLimitUS) > 15000 && !got_signal)
      {
        usleep (10000);
        *timeoutUS -= GetRelTime();
      }
      while ((*timeoutUS - lowLimitUS) > 1200 && !got_signal)
      {
          uint32_t  ts;

        if (read(rtcFd, &ts, sizeof(ts)) <= 0)
        {
          close(rtcFd);
          rtcFd = -1;
          syncMode = emUsleepTimer;
        }
        *timeoutUS -= GetRelTime();
      }
      break;
      got_signal=false;
    case emSigTimer: // signal timer mode
      *timeoutUS -= cSigTimer::Sleep(*timeoutUS, lowLimitUS);
      break;
  }
}
-- snip --

With these two modifications vdr did _not_ hang after the 40min sleep.

One thing I did not test in case of real long Sync() is in video.c.
Sync() is protected by oldPictureMutex and would lock video thread from
event processing.

> I guess we should
> introduce a private member "clampValue" , and return values of TimePassed()
> and GetRelTime() should be clamped to +/- clampValue if it is nonzero.
>
> The one thing which I cannot recalulate is: I had a sleep time of 27min (0x634cc13f usec).
> Time passed between pause/play was about 42min 50sec (0x992f1680 usec) .
>
> >
> > We could avoid this by letting GetRelTime() return some maximum, if
> > there have been overflows. This would fix the pause problem as well as
> > Marco's problem.
> >
> > Bye,
> > Martin

Stefan Lucke


From hm at seneca.muc.de  Tue Oct  3 10:22:41 2006
From: hm at seneca.muc.de (Harald Milz)
Date: Tue, 3 Oct 2006 10:22:41 +0200
Subject: [Softdevice-devel] Again: "result=Out of video memory" with DFB
Message-ID: <20061003082241.GA25449@seneca.muc.de>

Hi,

I'm rebuilding my VDR w/ Matrox G550 DVI and softdevice CVS from today.
More components:

vdr-1.4.1
ffmpeg CVS from today
DirectFB-1.0.0-rc1
DFB++-0.9.25
OpenSUSE 10.1 w/ kernel 2.6.16.13-4-default. 

This setup used to work just fine until the root disk began to produce more
and more errors some time ago. The rest of the hardware is unchanged, as
well as fb.modes and directfbrc (as I documented on
http://www.vdr-wiki.de/wiki/index.php/Softdevice-plugin#Matrox_G550_mit_DVI-Ausgang_und_DirectFB).

softdevice audio decoding via ALSA / SPDIF works fine, no probs. Video
decoding doesn't product any output, and I get this "Out of video memory"
error that was mentioned here earlier. The error log is attached. 

What gives? DFB only recognizes 16MB video RAM (the card has 32). But this
was similar when the setup worked back then, and was apparently no problem. 


softdevice -vo vidix: sort of works, just the CPU load rises to nearly
100% after some time (~ 10 min or more) sometimes but it's at 22-25% most
of the time, and the console output (cursor blink) can be seen on the
screen. setterm doesn't help because I invoke runvdr from /etc/inittab,
and vdr isn't attached to a TTY anyway. So I'd prefer using DFB as I used
to. 

So - what's wrong with the DFB setup? 

TIA!

-- 
If everybody minded their own business, the world would go
around a deal faster.
		-- The Duchess, "Through the Looking Glass"
-------------- next part --------------
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using PCM alsa device plug:spdif
[softdevice] using AC3 alsa device plug:spdif
[softdevice]   argv [3] = -vo
[setup-softdevice] alsa ac3Mode set to: 1
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 3 (User3)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 1 lavc
[setup-softdevice] mainMenu: 0
[setup-softdevice] setting alpha blend mode to pseudo
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 50
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3346432)
[dfb] init

     =======================|  DirectFB 1.0.0-rc1  |=======================
          (c) 2001-2006  United Cultures of Earth - go for outer space!
          (c) 2000-2004  Convergence (integrated media) GmbH
        ----------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2006-10-02 13:39) 
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 8587)...
(*) Direct/Modules: suppress module 'keyboard'
(*) Direct/Thread: Running 'LiRC Input' (INPUT, 8588)...
(*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media GmbH)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 8589)...
(*) DirectFB/Input: AT Translated Set 2 keyboard (1) 0.1 (convergence integrated media GmbH)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 8590)...
(*) DirectFB/Input: PC Speaker (2) 0.1 (convergence integrated media GmbH)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 8591)...
(*) DirectFB/Input: Budget-CI dvb ir receiver saa71 (3) 0.1 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G550 0.7 (directfb.org)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 16777216 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine FillTriangle Blit StretchBlit All 
[dfb] Drawing Flags: Blend Src.premultiply 
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize SrcColorkey SrcPremultiply Deinterlace 
[dfb] Supported video Modes are: 1280x720 at 32 
[dfb] Enumerating display Layers
[dfb] Configuring CooperativeLevel for OSD
Layer 0 FBDev Primary Layer  Type: graphics 
  Caps: brightness contrast saturation surface 
Layer 1 Matrox Backend Scaler  Type: graphics picture video 
  Caps: brightness contrast deinterlacing dst_colorkey screen_location surface 
[dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
[dfb] (osdLayer): width, height:               1280 720
[dfb] osdLayer without !! alpha channel
[surface capabilities] scrSurface: videoonly double-buffered flipping PixelFormat = 0x00418c04 
[dfb] width = 1280, height = 720
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (FBDev Primary Layer - [1280x720])
[surface capabilities] osdSurface: videoonly double-buffered flipping PixelFormat = 0x00418c04 
[dfb] Configuring CooperativeLevel for Overlay
[surface capabilities] videoSurface: videoonly PixelFormat = 0x00200806 
[dfb] Using this layer for OSD:        FBDev Primary Layer
[dfb] Using this layer for Video out:  Matrox Backend Scaler
[dfb] Display frame time is 16641 microseconds
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb]: Testconfiguration failed flags: 00000040 (disabling failed flags)
 (!!!)  *** WARNING [reallocation of video instance failed] *** [surfaces.c:1635 in dfb_surface_reallocate_buffer()]
[dfb] SetParams: action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), result=Out of video memory!
[surface capabilities] videoSurface: videoonly double-buffered flipping PixelFormat = 0x00200806 
[dfb] (re)configured 0x08100609
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb]: Testconfiguration failed flags: 00000040 (disabling failed flags)
 (!!!)  *** WARNING [reallocation of video instance failed] *** [surfaces.c:1635 in dfb_surface_reallocate_buffer()]
[dfb] SetParams: action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), result=Out of video memory!
[surface capabilities] videoSurface: videoonly double-buffered flipping PixelFormat = 0x00200806 
[dfb] (re)configured 0x08100609
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!

... many lines ...

[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
[dfb] YUV: action=IDirectFBSurface::Lock(DFBSurfaceLockFlags, void**, int*), result=Object is suspended!
Releasing DFB


From stefan at lucke.in-berlin.de  Tue Oct  3 10:59:40 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue,  3 Oct 2006 10:59:40 +0200
Subject: [Softdevice-devel] Again: "result=Out of video memory" with DFB
In-Reply-To: <20061003082241.GA25449@seneca.muc.de>
References: <20061003082241.GA25449@seneca.muc.de>
Message-ID: <1159865980.4522267c1b07e@webmail.in-berlin.de>

Zitat von Harald Milz <hm at seneca.muc.de>:

> Hi,
>
> I'm rebuilding my VDR w/ Matrox G550 DVI and softdevice CVS from today.
> More components:
>
> vdr-1.4.1
> ffmpeg CVS from today
> DirectFB-1.0.0-rc1
> DFB++-0.9.25
> OpenSUSE 10.1 w/ kernel 2.6.16.13-4-default.
>
> This setup used to work just fine until the root disk began to produce more
> and more errors some time ago. The rest of the hardware is unchanged, as
> well as fb.modes and directfbrc (as I documented on
> http://www.vdr-wiki.de/wiki/index.php/Softdevice-plugin#Matrox_G550_mit_DVI-Ausgang_und_DirectFB).
>
> softdevice audio decoding via ALSA / SPDIF works fine, no probs. Video
> decoding doesn't product any output, and I get this "Out of video memory"
> error that was mentioned here earlier. The error log is attached.
>
> What gives? DFB only recognizes 16MB video RAM (the card has 32). But this
> was similar when the setup worked back then, and was apparently no problem.
>
>
> softdevice -vo vidix: sort of works, just the CPU load rises to nearly
> 100% after some time (~ 10 min or more) sometimes but it's at 22-25% most
> of the time, and the console output (cursor blink) can be seen on the
> screen. setterm doesn't help because I invoke runvdr from /etc/inittab,
> and vdr isn't attached to a TTY anyway. So I'd prefer using DFB as I used
> to.
>
> So - what's wrong with the DFB setup?

I guess your kernel lacks matrox full memory patch.

http://www.directfb.org/index.php/viewcvs.cgi/DirectFB/patches/



Stefan Lucke



From marko.makela at hut.fi  Tue Oct  3 11:35:39 2006
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 3 Oct 2006 12:35:39 +0300
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a	long
	time
In-Reply-To: <1159860627.45221193b05af@webmail.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
Message-ID: <20061003093539.GB3303@localhost.localdomain>

On Tue, Oct 03, 2006 at 09:30:27AM +0200, Stefan Lucke wrote:
> That computed value is not only issue in that situation. I managed to
> avoid hang by some other changes. With current code we are loosing
> a signal to the condition variable.
> I did the following changes to sync_timer.c
[snip]
> With these two modifications vdr did _not_ hang after the 40min sleep.

Thank you!  Are these modifications in CVS?

	Marko


From leo at calidae.net  Tue Oct  3 11:55:59 2006
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Tue, 03 Oct 2006 11:55:59 +0200
Subject: [Softdevice-devel] osd and audio ok, but black screen
In-Reply-To: <4520BDAD.9080702@calidae.net>
References: <4520BDAD.9080702@calidae.net>
Message-ID: <452233AF.7010604@calidae.net>

Any ideas?
Perhaps you need more info?

Thanks again.

Leo M?rquez wrote:
> Hi,
>
> I have a nvidia card for the output of my vdr server. I'm trying to get 
> working with softdevice and dfb.
> I have setted up a framebuffer with nvidiafb. A fbset -i get this:
>
> vdr:~# fbset -i
>
> mode "768x576-75"
>     # D: 49.188 MHz, H: 46.580 kHz, V: 75.008 Hz
>     geometry 768 576 768 1152 32
>     timings 20330 128 32 32 8 128 5
>     rgba 8/16,8/8,8/0,8/24
> endmode
>
> Frame buffer device information:
>     Name        : NV2
>     Address     : 0xe4000000
>     Size        : 33554432
>     Type        : PACKED PIXELS
>     Visual      : DIRECTCOLOR
>     XPanStep    : 8
>     YPanStep    : 1
>     YWrapStep   : 0
>     LineLength  : 3072
>     MMIO Address: 0xe6000000
>     MMIO Size   : 16777216
>     Accelerator : nVidia RIVA TNT
>
> My directfbrc is:
>
> mode  = 768x576
> depth = 32
>
>
> When I start vdr i ge audio and osd, but don't see any image.
> Anyone knows how to solve the problem? Perhaps a nvidiafb module parameter?
>
> Thank you.
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>
>   


-- 
Leo M?rquez
[ Enginyeria del Software - Internet ]
[ Calidae - www.calidae.com ]



From M.Wache at gmx.net  Tue Oct  3 11:59:20 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 03 Oct 2006 11:59:20 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a	long
 time
In-Reply-To: <1159860627.45221193b05af@webmail.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>	<451E8F0D.3050700@gmx.net>	<20060930180425.GB2818@localhost.localdomain>	<200610010127.38153.stefan@lucke.in-berlin.de>	<451FB531.7020101@gmx.net>	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
Message-ID: <45223478.4060801@gmx.net>

Stefan Lucke schrieb:
> Zitat von Stefan Lucke <stefan at lucke.in-berlin.de>:
> 
>> Zitat von Martin Wache <M.Wache at gmx.net>:
>>
>>> Stefan Lucke schrieb:
>>>> On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
>>>>> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
>>>>>> I usually let mine turn itself on and off with nvram-wakeup! I see
>>>>>> the problem when I leave it for a short while in the middle of something
>>>>>> and get distracted!
>>>>> Me too.  Sometimes, I hit the Power button followed by some other button
>>>>> to suspend the playback and to prevent the system from powering off.
>>>>> Then, I'd hit the Power button to resume.
>>>>>
>>>>>> Hmmm...if you're right about this, how long should it take to overflow? The
>>>>>> only counter I can see is a 64-bit integer which looks like it's counting in
>>>>>> useconds which would take a few million years to overflow, by my reckoning!
>>>>>> Maybe I'm looking in the wrong place and it's a 32-bit counter which would
>>>>>> take 1 h 12 min to overflow. Not sure it was taking that long but it's hard
>>>>>> to tell.
>>>> Negative values should not harm,as we would return immedeatly.
>>>>
>>> I think the problem is in cSyncTimer::GetRelTime() which returns an
>>> signed int. If GetRelTime() returns a negative number because of an
>>> overflow we will actually add that value to delay instead of
>>> substracting, when we do the ususal delay-=GetRelTime().
>> The -= operator is the one which is causing troubles.
> 
> That computed value is not only issue in that situation. I managed to
> avoid hang by some other changes. With current code we are loosing a signal to
> the condition variable.
> I did the following changes to sync_timer.c
> 1. cSigTimer::Sleep() clear signal "got_signal=false;" only if would not sleep.
> 
> -- snip --
> /* --- cSigTimer --------------------------------------------------------------
>  */
> int cSigTimer::Sleep(int timeoutUS, int lowLimitUS)
> {
>   if ( timeoutUS < lowLimitUS ) {
>     got_signal=false;
>     return GetRelTime();
>   }
> 
> -- snip --
> 
> 2. cSyncTimer::Sleep(): clear signals "got_signal=false;" only in case of
>    emUsleepTimer and emRtcTimer.
> 
> -- snip --
> /* ----------------------------------------------------------------------------
>  */
> void cSyncTimer::Sleep(int *timeoutUS, int lowLimitUS)
> {
>   switch(syncMode)
>   {
>     case emUsleepTimer: // usleep timer mode
>       while ((*timeoutUS - lowLimitUS) > 2200 && !got_signal)
>       {
>         usleep (2200);
>         *timeoutUS -= GetRelTime ();
>       }
>       break;
>       got_signal=false;

This line is never executed.

>     case emRtcTimer: // rtc timer mode
>       while ((*timeoutUS - lowLimitUS) > 15000 && !got_signal)
>       {
>         usleep (10000);
>         *timeoutUS -= GetRelTime();
>       }
>       while ((*timeoutUS - lowLimitUS) > 1200 && !got_signal)
>       {
>           uint32_t  ts;
> 
>         if (read(rtcFd, &ts, sizeof(ts)) <= 0)
>         {
>           close(rtcFd);
>           rtcFd = -1;
>           syncMode = emUsleepTimer;
>         }
>         *timeoutUS -= GetRelTime();
>       }
>       break;
>       got_signal=false;

this too.

>     case emSigTimer: // signal timer mode
>       *timeoutUS -= cSigTimer::Sleep(*timeoutUS, lowLimitUS);
>       break;
>   }
> }
> -- snip --
> 
> With these two modifications vdr did _not_ hang after the 40min sleep.
> 
because got_signal is never set to false... And thus there is no
sleeping at all.
This will break the syncing completely. Maybe you don't notice it with
DirectFB, because there is still the syncing to the Refreshrate.

> One thing I did not test in case of real long Sync() is in video.c.
> Sync() is protected by oldPictureMutex and would lock video thread from
> event processing.
>
Well, maybe we should move the whole syncing to cVideo::Action() and
introduce a picture queue, then we could get rid of the oldPictureMutex
at all... I will think about this..

>> I guess we should
>> introduce a private member "clampValue" , and return values of TimePassed()
>> and GetRelTime() should be clamped to +/- clampValue if it is nonzero.
>>
GetRelTime() and TimePassed() is anyway a code duplication, that should
be fixed too. I would just limit the time which on can measure with
GetRelTime() and TimePassed() to a reasonable time, lets say 15min or
so. That is save to keep in 32bit. On longer waits GetRelTime() should
just return the max value for 15min.
I will send a patch this evening.

Bye,
Martin


From stefan at lucke.in-berlin.de  Tue Oct  3 14:09:19 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue,  3 Oct 2006 14:09:19 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for a	long
	time
In-Reply-To: <45223478.4060801@gmx.net>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
	<45223478.4060801@gmx.net>
Message-ID: <1159877359.452252ef89ecc@webmail.in-berlin.de>

Zitat von Martin Wache <M.Wache at gmx.net>:

> Stefan Lucke schrieb:
> > Zitat von Stefan Lucke <stefan at lucke.in-berlin.de>:
> >
> >> Zitat von Martin Wache <M.Wache at gmx.net>:
> >>
> >>> Stefan Lucke schrieb:
> >>>> On Samstag 30 September 2006 20:04, Marko M?kel? wrote:
> >>>>> On Sat, Sep 30, 2006 at 05:32:06PM +0100, Laz wrote:
> >>>>>> I usually let mine turn itself on and off with nvram-wakeup! I see
> >>>>>> the problem when I leave it for a short while in the middle of something
> >>>>>> and get distracted!
> >>>>> Me too.  Sometimes, I hit the Power button followed by some other button
> >>>>> to suspend the playback and to prevent the system from powering off.
> >>>>> Then, I'd hit the Power button to resume.
> >>>>>
> >>>>>> Hmmm...if you're right about this, how long should it take to overflow? The
> >>>>>> only counter I can see is a 64-bit integer which looks like it's counting in
> >>>>>> useconds which would take a few million years to overflow, by my reckoning!
> >>>>>> Maybe I'm looking in the wrong place and it's a 32-bit counter which would
> >>>>>> take 1 h 12 min to overflow. Not sure it was taking that long but it's hard
> >>>>>> to tell.
> >>>> Negative values should not harm,as we would return immedeatly.
> >>>>
> >>> I think the problem is in cSyncTimer::GetRelTime() which returns an
> >>> signed int. If GetRelTime() returns a negative number because of an
> >>> overflow we will actually add that value to delay instead of
> >>> substracting, when we do the ususal delay-=GetRelTime().
> >> The -= operator is the one which is causing troubles.
> >
> > That computed value is not only issue in that situation. I managed to
> > avoid hang by some other changes. With current code we are loosing a signal to
> > the condition variable.
> > I did the following changes to sync_timer.c
> > 1. cSigTimer::Sleep() clear signal "got_signal=false;" only if would not sleep.
> >
> > -- snip --
> > /* --- cSigTimer --------------------------------------------------------------
> >  */
> > int cSigTimer::Sleep(int timeoutUS, int lowLimitUS)
> > {
> >   if ( timeoutUS < lowLimitUS ) {
> >     got_signal=false;
> >     return GetRelTime();
> >   }
> >
> > -- snip --
> >
> > 2. cSyncTimer::Sleep(): clear signals "got_signal=false;" only in case of
> >    emUsleepTimer and emRtcTimer.
> >
> > -- snip --
> > /* ----------------------------------------------------------------------------
> >  */
> > void cSyncTimer::Sleep(int *timeoutUS, int lowLimitUS)
> > {
> >   switch(syncMode)
> >   {
> >     case emUsleepTimer: // usleep timer mode
> >       while ((*timeoutUS - lowLimitUS) > 2200 && !got_signal)
> >       {
> >         usleep (2200);
> >         *timeoutUS -= GetRelTime ();
> >       }
> >       break;
> >       got_signal=false;
>
> This line is never executed.

Obvious. These lines have to be exchanged. Thats due to the fact, the enviroment here
at my wife's father has a crippled internet access, and I cannot post cvs diffs. The code I ran
had these lines swapped (sig timer mode).

The key for sigtimer is, that got_signal must not be cleared at entry of sleep to avoid
loosing pending signals. For other timers it sould be done like sig timer: clear that at
end of sleep action.

There may be still an issue with syncing after that long pause and so your suggestion may still
be required.

As all (your's and mine) seems to fix the situation and all address real issues, we should apply
all of them.

[ -- snip -- ]

> >
> > With these two modifications vdr did _not_ hang after the 40min sleep.
> >
> because got_signal is never set to false... And thus there is no
> sleeping at all.
> This will break the syncing completely. Maybe you don't notice it with
> DirectFB, because there is still the syncing to the Refreshrate.
>
> > One thing I did not test in case of real long Sync() is in video.c.
> > Sync() is protected by oldPictureMutex and would lock video thread from
> > event processing.

In between I did that test (reverted hang fix, changed oldPictureMutex lock
start) and result was as expected: video is hanging, but OSD interaction is ok.

> >
> Well, maybe we should move the whole syncing to cVideo::Action() and
> introduce a picture queue, then we could get rid of the oldPictureMutex
> at all... I will think about this..
>
> >> I guess we should
> >> introduce a private member "clampValue" , and return values of TimePassed()
> >> and GetRelTime() should be clamped to +/- clampValue if it is nonzero.
> >>
> GetRelTime() and TimePassed() is anyway a code duplication, that should
> be fixed too.

They only differ in setting the refence time marker.

> I would just limit the time which on can measure with
> GetRelTime() and TimePassed() to a reasonable time, lets say 15min or
> so. That is save to keep in 32bit. On longer waits GetRelTime() should
> just return the max value for 15min.
> I will send a patch this evening.
>

Stefan Lucke


From stefan at lucke.in-berlin.de  Tue Oct  3 14:48:56 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue,  3 Oct 2006 14:48:56 +0200
Subject: [Softdevice-devel] Hang after suspending MPEG stream for
	a	long	time
In-Reply-To: <20061003093539.GB3303@localhost.localdomain>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
	<20061003093539.GB3303@localhost.localdomain>
Message-ID: <1159879736.45225c384b655@webmail.in-berlin.de>

Zitat von Marko M?kel?:

> On Tue, Oct 03, 2006 at 09:30:27AM +0200, Stefan Lucke wrote:
> > That computed value is not only issue in that situation. I managed to
> > avoid hang by some other changes. With current code we are loosing
> > a signal to the condition variable.
> > I did the following changes to sync_timer.c
> [snip]
> > With these two modifications vdr did _not_ hang after the 40min sleep.
>
> Thank you!  Are these modifications in CVS?

Mine yes, but I guess Martin's suggestion:
http://lists.berlios.de/pipermail/softdevice-devel/2006q3/002541.html

is required too, to avoid frame drops or sync issues after entering play state.
Can you test that with/without this fix ? I know it's hard to wait for about
40 minutes for a single test execution.


Stefan Lucke


From marko.makela at hut.fi  Tue Oct  3 15:06:28 2006
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 3 Oct 2006 16:06:28 +0300
Subject: [Softdevice-devel] Hang after suspending MPEG stream for	a	long
	time
In-Reply-To: <1159879736.45225c384b655@webmail.in-berlin.de>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
	<20061003093539.GB3303@localhost.localdomain>
	<1159879736.45225c384b655@webmail.in-berlin.de>
Message-ID: <20061003130628.GA2944@localhost.localdomain>

On Tue, Oct 03, 2006 at 02:48:56PM +0200, Stefan Lucke wrote:
> Mine yes, but I guess Martin's suggestion:
> http://lists.berlios.de/pipermail/softdevice-devel/2006q3/002541.html
> 
> is required too, to avoid frame drops or sync issues after entering play state.
> Can you test that with/without this fix ? I know it's hard to wait for about
> 40 minutes for a single test execution.

I don't think that Martin's suggestion would change anything for me.
After all, on my box the play state will not change.  My vdr-suspend
patch just blocks the delivery of MPEG packets to other than recording
threads.

I will test your patch now.

	Marko


From marko.makela at hut.fi  Tue Oct  3 16:09:50 2006
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 3 Oct 2006 17:09:50 +0300
Subject: [Softdevice-devel] Hang after suspending MPEG stream for	a	long
	time
In-Reply-To: <20061003130628.GA2944@localhost.localdomain>
References: <1159430656.451b8200d5e39@webmail.in-berlin.de>
	<451E8F0D.3050700@gmx.net>
	<20060930180425.GB2818@localhost.localdomain>
	<200610010127.38153.stefan@lucke.in-berlin.de>
	<451FB531.7020101@gmx.net>
	<1159777228.4520cbcc9e6cb@webmail.in-berlin.de>
	<1159860627.45221193b05af@webmail.in-berlin.de>
	<20061003093539.GB3303@localhost.localdomain>
	<1159879736.45225c384b655@webmail.in-berlin.de>
	<20061003130628.GA2944@localhost.localdomain>
Message-ID: <20061003140950.GB2944@localhost.localdomain>

On Tue, Oct 03, 2006 at 04:06:28PM +0300, Marko M?kel? wrote:
> On Tue, Oct 03, 2006 at 02:48:56PM +0200, Stefan Lucke wrote:
> > Mine yes, but I guess Martin's suggestion:
> > http://lists.berlios.de/pipermail/softdevice-devel/2006q3/002541.html
> > 
> > is required too, to avoid frame drops or sync issues after entering play state.
> > Can you test that with/without this fix ? I know it's hard to wait for about
> > 40 minutes for a single test execution.
> 
> I don't think that Martin's suggestion would change anything for me.
> After all, on my box the play state will not change.  My vdr-suspend
> patch just blocks the delivery of MPEG packets to other than recording
> threads.
> 
> I will test your patch now.

The playback was suspended for about 50 minutes (give or take one minute),
and it resumed fine.  Thank you for fixing the bug!

	Marko


From hm at seneca.muc.de  Wed Oct  4 00:01:11 2006
From: hm at seneca.muc.de (Harald Milz)
Date: Wed, 4 Oct 2006 00:01:11 +0200
Subject: [Softdevice-devel] Again: "result=Out of video memory" with DFB
In-Reply-To: <1159865980.4522267c1b07e@webmail.in-berlin.de>
References: <20061003082241.GA25449@seneca.muc.de>
	<1159865980.4522267c1b07e@webmail.in-berlin.de>
Message-ID: <20061003220111.GA32341@seneca.muc.de>

On Tue, Oct 03, 2006 at 10:59:40AM +0200, Stefan Lucke wrote:
> I guess your kernel lacks matrox full memory patch.

Correct. I didn't have to patch the older kernel. SUSE apparently missed
this one in 10.1. :-( 

Works just fine now. Thanks for the hint!


-- 
The Psblurtex is an 18-inch long anaconda that hides in the gentlemen's
outfitting departments of Amazonian stores and is often bought by
mistake since its colors are those of the London Reform Club.  Once
tied around its victim's neck, it strangles him gently and then claims
the insurance before running off to Germany where it lives in hiding.
		-- Mike Harding, "The Armchair Anarchist's Almanac"


From hm at seneca.muc.de  Wed Oct  4 09:18:05 2006
From: hm at seneca.muc.de (Harald Milz)
Date: Wed, 4 Oct 2006 09:18:05 +0200
Subject: [Softdevice-devel] softplay-0.0.2 doesn't compile with
	ffmpeg-cvs
In-Reply-To: <20061004070819.GA5067@seneca.muc.de>
References: <20061004070819.GA5067@seneca.muc.de>
Message-ID: <20061004071805.GA5258@seneca.muc.de>

On Wed, Oct 04, 2006 at 09:08:19AM +0200, Harald Milz wrote:
> softplay-cvs from today does compile as soon as the Makefile is patched to
> honor APIVERSION...  Dunno yet if it actually works. 

Works fine - but it doesn't actually end playback and return to live TV
if Exit is pressed, although I set it in softplay's setup menu (that's
for when the file ends, right?). I have to explicitly stop playback in
the Main Menu.


-- 
The United States also has its native Fascists who say that they are
"100 percent American"...
		-- U. S. Army (1945)


From hm at seneca.muc.de  Wed Oct  4 09:08:19 2006
From: hm at seneca.muc.de (Harald Milz)
Date: Wed, 4 Oct 2006 09:08:19 +0200
Subject: [Softdevice-devel] softplay-0.0.2 doesn't compile with ffmpeg-cvs
Message-ID: <20061004070819.GA5067@seneca.muc.de>

Hi,

trying to compile softplay-0.0.2 against ffmpeg-cvs from yesterday. Result: 


Plugin softplay:
make[1]: Entering directory `/usr/src/vdr-1.4.1/PLUGINS/src/softplay-0.0.2'
g++ -fPIC -g -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../DVB/include -I/usr/local/include/ffmpeg SoftPlayer.c
/usr/local/include/ffmpeg/avformat.h:247: warning: ?AVFrac? is deprecated (declared at /usr/local/include/ffmpeg/avformat.h:100)
/usr/local/include/ffmpeg/avformat.h:379: warning: attribute ignored in declaration of ?struct AVInputImageContext?
/usr/local/include/ffmpeg/avformat.h:379: warning: attribute for ?struct AVInputImageContext? must follow the ?struct? keyword
/usr/local/include/ffmpeg/avformat.h:403: warning: ?AVImageInfo? is deprecated (declared at /usr/local/include/ffmpeg/avformat.h:388)
/usr/local/include/ffmpeg/avformat.h:406: warning: ?AVImageInfo? is deprecated (declared at /usr/local/include/ffmpeg/avformat.h:388)
SoftPlayer.c: In member function ?virtual void cSoftPlayer::Action()?:
SoftPlayer.c:173: error: request for member ?codec_type? in ?((cSoftPlayer*)this)->cSoftPlayer::ic->AVFormatContext::streams[pkt.AVPacket::stream_index]->AVStream::codec?, which is of non-class type ?AVCodecContext*?
SoftPlayer.c:178: error: request for member ?codec_type? in ?((cSoftPlayer*)this)->cSoftPlayer::ic->AVFormatContext::streams[pkt.AVPacket::stream_index]->AVStream::codec?, which is of non-class type ?AVCodecContext*?
SoftPlayer.c:222: error: request for member ?codec_id? in ?((cSoftPlayer*)this)->cSoftPlayer::ic->AVFormatContext::streams[i]->AVStream::codec?, which is of non-class type ?AVCodecContext*?
SoftPlayer.c: In member function ?ePlayMode cSoftPlayer::GetPlayMode(AVFormatContext*)?:
SoftPlayer.c:248: error: request for member ?codec_type? in ?IC->AVFormatContext::streams[i]->AVStream::codec?, which is of non-class type ?AVCodecContext*?
SoftPlayer.c:250: error: request for member ?codec_type? in ?IC->AVFormatContext::streams[i]->AVStream::codec?, which is of non-class type ?AVCodecContext*?
make[1]: *** [SoftPlayer.o] Fehler 1
make[1]: Leaving directory `/usr/src/vdr-1.4.1/PLUGINS/src/softplay-0.0.2'


softplay-cvs from today does compile as soon as the Makefile is patched to
honor APIVERSION...  Dunno yet if it actually works. 

Hope this helps. 

-- 
The price of seeking to force our beliefs on others is that someday
they might force their beliefs on us.
		-- Mario Cuomo


From malcolm.caldwell at cdu.edu.au  Thu Oct  5 02:47:11 2006
From: malcolm.caldwell at cdu.edu.au (Malcolm Caldwell)
Date: Thu, 05 Oct 2006 10:17:11 +0930
Subject: [Softdevice-devel] softplay-0.0.2 doesn't compile with
	ffmpeg-cvs
In-Reply-To: <20061004071805.GA5258@seneca.muc.de>
References: <20061004070819.GA5067@seneca.muc.de>
	<20061004071805.GA5258@seneca.muc.de>
Message-ID: <1160009231.3354.12.camel@localhost.localdomain>

On Wed, 2006-10-04 at 09:18 +0200, Harald Milz wrote:
> On Wed, Oct 04, 2006 at 09:08:19AM +0200, Harald Milz wrote:
> > softplay-cvs from today does compile as soon as the Makefile is patched to
> > honor APIVERSION...  Dunno yet if it actually works. 
> 
> Works fine - but it doesn't actually end playback and return to live TV
> if Exit is pressed, although I set it in softplay's setup menu (that's
> for when the file ends, right?). I have to explicitly stop playback in
> the Main Menu.


Are you sure that return to live tv is selected?

This setting does not seem to be saved into the setup.conf (or anywhere
else) and so it does not survive reboots.

Also, exit never ends playback, but the blue key does.  (I know, it
confuses me every time because exit does work when playing VDR
recordings thorough VDR)




From stuart_morris at talk21.com  Thu Oct  5 13:45:53 2006
From: stuart_morris at talk21.com (Stuart Morris)
Date: Thu, 5 Oct 2006 12:45:53 +0100 (BST)
Subject: [Softdevice-devel] G450 simultaneous X and TV out
Message-ID: <20061005114553.95502.qmail@web86708.mail.ird.yahoo.com>

Can anybody suggest how one could output softdevice
on the TV out of a Matrox G450 whilst simultaneously
displaying the X desktop on the VGA output?

I am guessing one way would be to use Directfb with
fusion, mgatv and XDirectfb. XDirectfb however requires
patching and rebuilding X. With an RPM based distribution
I do not know how to do this.

Is it possible to do this?
Is there another way that supports interlaced output?

Stuart


 		
---------------------------------
 Try the all-new Yahoo! Mail . "The New Version is radically easier to use" ? The Wall Street Journal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061005/6c5de12f/attachment.html>

From torgeir at pobox.com  Thu Oct  5 13:58:30 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 5 Oct 2006 12:58:30 +0100
Subject: [Softdevice-devel] G450 simultaneous X and TV out
In-Reply-To: <20061005114553.95502.qmail@web86708.mail.ird.yahoo.com>
References: <20061005114553.95502.qmail@web86708.mail.ird.yahoo.com>
Message-ID: <99F8D576-BCED-42FC-A2C5-D255DACF6FC9@pobox.com>


On 5 Oct 2006, at 12:45, Stuart Morris wrote:

> Can anybody suggest how one could output softdevice
> on the TV out of a Matrox G450 whilst simultaneously
> displaying the X desktop on the VGA output?

I think it would make sense to introduce output profiles to support a  
similar setup. Say you'd want two output options, one for interlaced  
video output, another for high resolution vga output for a projector.  
You could then toggle between them using a user defined key on the  
remote.

I guess this would require us to set all directfb params in video- 
dfb.c, and not rely on any settings in /etc/directfbrc.

This wouldn't provide simultaneous output on two devices with  
different signal requirements, but atleast it would support switching  
between them.

-- 
Torgeir Veimo
torgeir at pobox.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061005/cc5b3ac5/attachment.html>

From stuart_morris at talk21.com  Thu Oct  5 14:12:47 2006
From: stuart_morris at talk21.com (Stuart Morris)
Date: Thu, 5 Oct 2006 13:12:47 +0100 (BST)
Subject: [Softdevice-devel] G450 simultaneous X and TV out
In-Reply-To: <99F8D576-BCED-42FC-A2C5-D255DACF6FC9@pobox.com>
Message-ID: <20061005121247.12243.qmail@web86711.mail.ird.yahoo.com>

Apologies I actually meant display a desktop manager like KDE for example,
on the vga output, for use with other X applications.

My intentions are to use an LCD tv. I will feed tv into a scart input for viewing
VDR recordings. The vga input on the tv would be used for web browsing,
viewing pictures, word processing etc etc.

I want to avoid video output through vga because that would require
deinterlacing and that requires a hot processor. The TV already does a good
job at that at no extra thermal cost.

Stuart

Torgeir Veimo <torgeir at pobox.com> wrote: 
On 5 Oct 2006, at 12:45, Stuart Morris wrote:

Can anybody suggest how one could output softdevice
on the TV out of a Matrox G450 whilst simultaneously
displaying the X desktop on the VGA output?


I think it would make sense to introduce output profiles to support a similar setup. Say you'd want two output options, one for interlaced video output, another for high resolution vga output for a projector. You could then toggle between them using a user defined key on the remote. 

I guess this would require us to set all directfb params in video-dfb.c, and not rely on any settings in /etc/directfbrc.

This wouldn't provide simultaneous output on two devices with different signal requirements, but atleast it would support switching between them.

 -- 
Torgeir Veimo
torgeir at pobox.com



 



_______________________________________________
Softdevice-devel mailing list
Softdevice-devel at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/softdevice-devel


 		
---------------------------------
 Now you can scan emails quickly with a reading pane. Get the new Yahoo! Mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061005/0cd1063c/attachment.html>

From hm at seneca.muc.de  Thu Oct  5 22:07:26 2006
From: hm at seneca.muc.de (Harald Milz)
Date: Thu, 5 Oct 2006 22:07:26 +0200
Subject: [Softdevice-devel] softplay-0.0.2 doesn't compile with
	ffmpeg-cvs
In-Reply-To: <1160009231.3354.12.camel@localhost.localdomain>
References: <20061004070819.GA5067@seneca.muc.de>
	<20061004071805.GA5258@seneca.muc.de>
	<1160009231.3354.12.camel@localhost.localdomain>
Message-ID: <20061005200726.GA22889@seneca.muc.de>

On Thu, Oct 05, 2006 at 10:17:11AM +0930, Malcolm Caldwell wrote:
> Are you sure that return to live tv is selected?

Yes I am :-) But I understand this setting applies only when a recording is
finished not when exit is pressed... 

> Also, exit never ends playback, but the blue key does.  (I know, it

ah - yes. Very ergonomic... 

-- 
Emerson's Law of Contrariness:
	Our chief want in life is somebody who shall make us do what we
can.  Having found them, we shall then hate them for it.


From leo at calidae.net  Fri Oct  6 21:23:39 2006
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Fri, 06 Oct 2006 21:23:39 +0200
Subject: [Softdevice-devel] xv - osd appears and disapears constantly
Message-ID: <4526AD3B.6030505@calidae.net>

Hi,

I'm running vdr with softdevice (-vo xv) in a wmaker desktop with xorg 
behind.
When I run vdr I get a window with the image but osd is shown for a half 
second and get off.
This behavior is produced every key I press and can't get osd fixed in 
screen to navigate menus.
Another q?estion is if I can run softdevice -vo xv in full screen mode. 
It's possible?

My vga card is a riva tnt2 m64.

Thanks!



From herbert at 13thfloor.at  Fri Oct  6 22:38:58 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Fri, 6 Oct 2006 22:38:58 +0200
Subject: [Softdevice-devel] xv - osd appears and disapears constantly
In-Reply-To: <4526AD3B.6030505@calidae.net>
References: <4526AD3B.6030505@calidae.net>
Message-ID: <20061006203858.GA23122@MAIL.13thfloor.at>

On Fri, Oct 06, 2006 at 09:23:39PM +0200, Leo M?rquez wrote:
> Hi,
> 
> I'm running vdr with softdevice (-vo xv) in a wmaker desktop with xorg
> behind.

> When I run vdr I get a window with the image but osd is shown for a
> half second and get off. This behavior is produced every key I press
> and can't get osd fixed in screen to navigate menus.

try to change the softdevice.OSDalphablend to 1
in the setup.conf (should fix this)

> Another q?estion is if I can run softdevice -vo xv in full screen mode. 
> It's possible?

works fine here, just press 'f' to toggle
fullscreen 

HTH,
Herbert

> My vga card is a riva tnt2 m64.
> 
> Thanks!
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From herbert at 13thfloor.at  Fri Oct  6 22:38:58 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Fri, 6 Oct 2006 22:38:58 +0200
Subject: [Softdevice-devel] xv - osd appears and disapears constantly
In-Reply-To: <4526AD3B.6030505@calidae.net>
References: <4526AD3B.6030505@calidae.net>
Message-ID: <20061006203858.GA23122@MAIL.13thfloor.at>

On Fri, Oct 06, 2006 at 09:23:39PM +0200, Leo M?rquez wrote:
> Hi,
> 
> I'm running vdr with softdevice (-vo xv) in a wmaker desktop with xorg
> behind.

> When I run vdr I get a window with the image but osd is shown for a
> half second and get off. This behavior is produced every key I press
> and can't get osd fixed in screen to navigate menus.

try to change the softdevice.OSDalphablend to 1
in the setup.conf (should fix this)

> Another q?estion is if I can run softdevice -vo xv in full screen mode. 
> It's possible?

works fine here, just press 'f' to toggle
fullscreen 

HTH,
Herbert

> My vga card is a riva tnt2 m64.
> 
> Thanks!
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From leo at calidae.net  Sat Oct  7 13:20:09 2006
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Sat, 07 Oct 2006 13:20:09 +0200
Subject: [Softdevice-devel] xv - osd appears and disapears constantly
In-Reply-To: <20061006203858.GA23122@MAIL.13thfloor.at>
References: <4526AD3B.6030505@calidae.net>
	<20061006203858.GA23122@MAIL.13thfloor.at>
Message-ID: <45278D69.3020004@calidae.net>

Thank you for your answer!

Herbert Poetzl escribi?:

>On Fri, Oct 06, 2006 at 09:23:39PM +0200, Leo M?rquez wrote:
>  
>
>>Hi,
>>
>>I'm running vdr with softdevice (-vo xv) in a wmaker desktop with xorg
>>behind.
>>    
>>
>
>  
>
>>When I run vdr I get a window with the image but osd is shown for a
>>half second and get off. This behavior is produced every key I press
>>and can't get osd fixed in screen to navigate menus.
>>    
>>
>
>try to change the softdevice.OSDalphablend to 1
>in the setup.conf (should fix this)
>  
>
Yes!, you're right! Thanks!

>>Another q?estion is if I can run softdevice -vo xv in full screen mode. 
>>It's possible?
>>    
>>
>
>works fine here, just press 'f' to toggle
>fullscreen 
>  
>
Ok! It work too but any way to start always in fullscreen. I will not 
have keyboard on my box.

Thank you again.

Leo

>>My vga card is a riva tnt2 m64.
>>
>>Thanks!
>>
>>_______________________________________________
>>Softdevice-devel mailing list
>>Softdevice-devel at lists.berlios.de
>>https://lists.berlios.de/mailman/listinfo/softdevice-devel
>>    
>>
>_______________________________________________
>Softdevice-devel mailing list
>Softdevice-devel at lists.berlios.de
>https://lists.berlios.de/mailman/listinfo/softdevice-devel
>
>__________ Informaci?n de NOD32, revisi?n 1.1793 (20061006) __________
>
>Este mensaje ha sido analizado con  NOD32 antivirus system
>http://www.nod32.com
>
>
>
>  
>



From stefan at lucke.in-berlin.de  Sat Oct  7 16:34:40 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 Oct 2006 16:34:40 +0200
Subject: [Softdevice-devel] xv - osd appears and disapears constantly
In-Reply-To: <45278D69.3020004@calidae.net>
References: <4526AD3B.6030505@calidae.net>
	<20061006203858.GA23122@MAIL.13thfloor.at>
	<45278D69.3020004@calidae.net>
Message-ID: <200610071634.40467.stefan@lucke.in-berlin.de>

On Samstag 07 Oktober 2006 13:20, Leo M?rquez wrote:
> Thank you for your answer!
> 
> Herbert Poetzl escribi?:
> 
> >On Fri, Oct 06, 2006 at 09:23:39PM +0200, Leo M?rquez wrote:

> >>When I run vdr I get a window with the image but osd is shown for a
> >>half second and get off. This behavior is produced every key I press
> >>and can't get osd fixed in screen to navigate menus.
> >>    
> >>
> >
> >try to change the softdevice.OSDalphablend to 1
> >in the setup.conf (should fix this)

Can you please test if changing:
attributeStore.SetValue("XV_AUTOPAINT_COLORKEY",0);
to
attributeStore.SetValue("XV_AUTOPAINT_COLORKEY",1);

(file video-xv.c around line 1206)

has some effect when using pseudo drawing mode ?

> >  
> >
> Yes!, you're right! Thanks!
> 
> >>Another q?estion is if I can run softdevice -vo xv in full screen mode. 
> >>It's possible?
> >>    
> >>
> >
> >works fine here, just press 'f' to toggle
> >fullscreen 
> >  
> >
> Ok! It work too but any way to start always in fullscreen. I will not 
> have keyboard on my box.

To get a full list of available parameter, you may try calling vdr
with parameter -h.
for option "-vo xv:" you'll get the following list:

  -vo xv:                  enable output via X11-Xv
  -vo xv:aspect=wide       use a 16:9 display area (1024x576)
  -vo xv:aspect=normal     use a  4:3 display area (768x576)
  -vo xv:max-area          use maximum available area
  -vo xv:full              startup fullscreen
  -vo xv:use-defaults      don't change brigtness etc on startup

> 
> Thank you again.
> 
> Leo
> 
> >>My vga card is a riva tnt2 m64.


-- 
Stefan Lucke


From nicolas at huillard.net  Sat Oct  7 23:10:23 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sat, 07 Oct 2006 23:10:23 +0200
Subject: [Softdevice-devel] Softdevice CVS + CLE266 + 352x288 streams
Message-ID: <452817BF.5060109@huillard.net>

Hello all,

First of all : bravo for the great work on hardware decoding with
CLE266. I's a really good milestone on softdevice's life (not so soft
any more, in fact).

Just a little note : when playing 352x288 streams, the hardware decoder
is very often disturbed and the image flickers, the colors are gone and
a few weird artifacts are shown.
Those streams are really not viewable. Not that I miss them though.
I think I recall some threads about CLE266 and stream geometry. This one
is a good test (indefinitely repeating video pattern) :

M?t?o Express;OpenMux:10911:vC34:S13.0E:27500:5820:5830:0:0:5800:176:12000:0

VDR 1.4.2
softdevice CVS 20060929 (-P softdevice -ao alsa:pcm=default -vo
dfb:viatv:cle266)
libcle266mpegdec 0.4
DirectFB-2006-09-10-04-25-09-UTC
DFB++-2006-09-10-04-25-02-UTC
linux-viafb 20060910 (viafb mode=720x576 bpp=32 refresh=50 TVon=1
TVoverscan=1)

-- 
NH


From nicolas at huillard.net  Sat Oct  7 23:19:17 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sat, 07 Oct 2006 23:19:17 +0200
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
	status and patches
Message-ID: <452819D5.3030408@huillard.net>

Hello,

I'm a bit lost about what's needed for field parity correctness on
TV-out with CLE266. I still have field artifacts on interlaced streams
on TV-out.

My setup :
VDR 1.4.2
softdevice CVS 20060929 (-P softdevice -ao alsa:pcm=default -vo
dfb:viatv:cle266)
libcle266mpegdec 0.4
DirectFB-2006-09-10-04-25-09-UTC
DFB++-2006-09-10-04-25-02-UTC
linux-viafb 20060910 (viafb mode=720x576 bpp=32 refresh=50 TVon=1
TVoverscan=1)

I think I do not need any patches for linux-viafb (Mark Adams commited
his patches to CVS)
I don't know if I need something special in DirectFB/DFB++ (I applied
libcle266mpegdec-0.3/patches/GetFBOffset.patch)
I think the latest softdevice filed parity patches have joined CVS
before I checked it out.

What do I miss ?

-- 
NH


From laz at club-burniston.co.uk  Sun Oct  8 16:13:18 2006
From: laz at club-burniston.co.uk (Laz)
Date: Sun, 8 Oct 2006 15:13:18 +0100
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
	status and patches
In-Reply-To: <452819D5.3030408@huillard.net>
References: <452819D5.3030408@huillard.net>
Message-ID: <200610081513.18758.laz@club-burniston.co.uk>

On Saturday 07 October 2006 22:19, Nicolas Huillard wrote:
> Hello,
>
> I'm a bit lost about what's needed for field parity correctness on
> TV-out with CLE266. I still have field artifacts on interlaced streams
> on TV-out.
>
> My setup :
> VDR 1.4.2
> softdevice CVS 20060929 (-P softdevice -ao alsa:pcm=default -vo
> dfb:viatv:cle266)
> libcle266mpegdec 0.4
> DirectFB-2006-09-10-04-25-09-UTC
> DFB++-2006-09-10-04-25-02-UTC
> linux-viafb 20060910 (viafb mode=720x576 bpp=32 refresh=50 TVon=1
> TVoverscan=1)
>
> I think I do not need any patches for linux-viafb (Mark Adams commited
> his patches to CVS)
> I don't know if I need something special in DirectFB/DFB++ (I applied
> libcle266mpegdec-0.3/patches/GetFBOffset.patch)
> I think the latest softdevice filed parity patches have joined CVS
> before I checked it out.

I have nicely working TV-out with CLE266. Looking back, I don't think I've 
updated DirectFB, DFB++, or linux-viafb since about April. I'm using 
libcle266mpegdec-0.4 with vdr-1.4.3 and softdevice CVS 04102006 
(-P'softdevice -vo dfb:viatv:cle266'). My options to viafb are: mode=720x576 
bpp=32 refresh=50 TVon=1 TVoverscan=1. Pretty much the same as you're doing!

However, you mention Mark Adams's patches: I have both viafb and DirectFB 
patched with his field-sync patches (attached).

I've just had a quick scan of the current CVS linux-viafb and can't see any 
obvious signs that they were added: at the time, I don't think Mark wanted to 
commit them because they were a quick bodge and he was going to do it 
properly. Having said that, it is possible that he has done so and that they 
are no longer needed with current CVS... It is a long while since he posted 
them so he has probably improved them by now, even if they haven't made CVS!

Last time I built DirectFB (which I'm sure was more recently than April!) I 
couldn't work out whether I needed the patches or not. Maybe I do!

With my setup, I don't see any noticeable interlace effects with TV-out. Some 
channels aren't quite perfect, i.e. scrolling text on BBC News 24 (a good 
test for this type of stuff!) gives the odd judder every second or so but is 
pretty good. Mark reckoned that this was probably down to a timing problem 
with triple buffering.

Maybe the patches will help your setup: since the hardware decoding has been 
in softdevice, my system has really impressed me, although recently it has 
decided to stop powering off / rebooting when shut down so I can't always 
trust nvram-wakeup!

:(

As to your other post about 352x288 streams, pass! Nothing on UK DVB-T is that 
low a resolution, so I cannot test this.

Cheers,

Laz
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb_unichrome_flip_ioctl.patch
Type: text/x-diff
Size: 2542 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/82d74b57/attachment.patch>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: viafb_flip_ioctl.patch
Type: text/x-diff
Size: 4357 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/82d74b57/attachment-0001.patch>

From nicolas at huillard.net  Sun Oct  8 16:28:10 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 08 Oct 2006 16:28:10 +0200
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
 status and patches
In-Reply-To: <200610081513.18758.laz@club-burniston.co.uk>
References: <452819D5.3030408@huillard.net>
	<200610081513.18758.laz@club-burniston.co.uk>
Message-ID: <45290AFA.1010102@huillard.net>

Thanks for the update. I am currently updating and recompiling
everything (even with DirectFB 1.0rc1), and I gear toward the same
conclusions than you : it seems that these patches are still needed.
I'll keep you all informed when I finish those recompiles and test that
it actually solves the field parity stuff.

-- 
NH


From nicolas at huillard.net  Sun Oct  8 19:45:49 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 08 Oct 2006 19:45:49 +0200
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
 status and patches [update]
In-Reply-To: <452819D5.3030408@huillard.net>
References: <452819D5.3030408@huillard.net>
Message-ID: <4529394D.8000800@huillard.net>

Hi all,

Here's my update on the matter after upgrading quite everything. I would
like to thank those who replied to my questions.
First : I still have field parity problems with interlaced material on
interlaced TV.
Second : there are a lot things there, from the kernel, viafb,
libcle266mpegdec, DirectFB, DFB++, up to softdevice...


Kernel 2.6.17 Debian
* fresh compile and packaging

linux-viafb CVS 20061008 (today)
* applied viafb_flip_ioctl.patch from Mark Adams (transfered by Rolf
Ahrenberg and Laz today)
* this patch is really old, and does not apply totally cleanly on
today's CVS
* attached is un updated patch against current CVS (maybe Mark could
apply it to CVS if he have no better idea now about how to implement that ?)

libcle266mpegdec 0.4 (latest as of today) (oops : I didn't even try CVS)
* the GetFBOffset.patch isn't needed anymore with DirectFB 1.0rc1
* but GetFBOffsetDFB++.patch is still needed with DFB++ CVS
* maybe Rolf could get this patch integrated inside DFB++ before it
reaches 1.0rc stage ?

DirectFB 1.0rc1 (latest as of today)
* since GetFBOffset.patch is already applied, I only have to add
dfb_unichrome_flip_ioctl.patch from Mark Adams (transfered by Rolf
Ahrenberg and Laz today)
* here is the updated patch against 1.0rc1
* this patch was difficult to cleanly apply, because adjustments were
not correct (the code is so light and clean that patch select the wrong
function to apply a chunk, while the other was correctly placed)
(GetFBOffset.patch even applied cleanly, even though it was already in
place, and patch didn't see it)
* maybe Mark could add his patch to DirectFB CVS (if the freeze for 1.0
still allows that)
* to my knowledge, it is the only patch to apply to DirectFB
* see dfbinfo output attached (Caps: ... FIELD_PARITY ...)

DFB++ CVS 20061008 (today)
* applied the GetFBOffsetDFB++.patch from libcle266mpegdec
* this patch should make it into CVS, to keep in sync with DirectFB
* there is nothing about field parity there, since Mark's patch was
about the unichrome driver, not about DirectFB API (which DFB++ only
deals with)

softdevice CVS 20061008 (today)
* no patch to apply ?
* uses libclempegdec, viafb, etc.
* to attached log shows field parity is enabled ([softdevice] enabling
field parity / [softdevice] enabling CLE266 HW decoding)


I don't know what I miss to get rid of interlacing artifacts on TV out...


Nicolas Huillard a ?crit :
> I'm a bit lost about what's needed for field parity correctness on
> TV-out with CLE266. I still have field artifacts on interlaced streams
> on TV-out.
> 
> My setup :
> VDR 1.4.2
> softdevice CVS 20060929 (-P softdevice -ao alsa:pcm=default -vo
> dfb:viatv:cle266)
> libcle266mpegdec 0.4
> DirectFB-2006-09-10-04-25-09-UTC
> DFB++-2006-09-10-04-25-02-UTC
> linux-viafb 20060910 (viafb mode=720x576 bpp=32 refresh=50 TVon=1
> TVoverscan=1)
> 
> I think I do not need any patches for linux-viafb (Mark Adams commited
> his patches to CVS)
> I don't know if I need something special in DirectFB/DFB++ (I applied
> libcle266mpegdec-0.3/patches/GetFBOffset.patch)
> I think the latest softdevice filed parity patches have joined CVS
> before I checked it out.

-- 
NH
-------------- next part --------------
A non-text attachment was scrubbed...
Name: viafb_flip_ioctl-20061008.patch
Type: text/x-patch
Size: 4409 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/9e86e97a/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb_unichrome_flip_ioctl-20061008.patch
Type: text/x-patch
Size: 3003 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/9e86e97a/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vdr.log
Type: text/x-log
Size: 4709 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/9e86e97a/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfbinfo.log
Type: text/x-log
Size: 1534 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061008/9e86e97a/attachment-0003.bin>

From stefan at lucke.in-berlin.de  Sun Oct  8 22:29:10 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 Oct 2006 22:29:10 +0200
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
	status and patches [update]
In-Reply-To: <4529394D.8000800@huillard.net>
References: <452819D5.3030408@huillard.net> <4529394D.8000800@huillard.net>
Message-ID: <200610082229.10651.stefan@lucke.in-berlin.de>

On Sonntag 08 Oktober 2006 19:45, Nicolas Huillard wrote:
> Hi all,
> 
> Here's my update on the matter after upgrading quite everything. I would
> like to thank those who replied to my questions.
> First : I still have field parity problems with interlaced material on
> interlaced TV.
> Second : there are a lot things there, from the kernel, viafb,
> libcle266mpegdec, DirectFB, DFB++, up to softdevice...
> 
> 


> 
> DFB++ CVS 20061008 (today)
> * applied the GetFBOffsetDFB++.patch from libcle266mpegdec
> * this patch should make it into CVS, to keep in sync with DirectFB
> * there is nothing about field parity there, since Mark's patch was
> about the unichrome driver, not about DirectFB API (which DFB++ only
> deals with)

I think the DFB++ patch is still on Denis' radar, see:
http://mail.directfb.org/pipermail/directfb-dev/2006-October/002356.html

So I don't think we need to push him further.

The missing DFB++ part, is one reason not to publish a new softdevice release now.

> 
> softdevice CVS 20061008 (today)
> * no patch to apply ?
> * uses libclempegdec, viafb, etc.
> * to attached log shows field parity is enabled ([softdevice] enabling
> field parity / [softdevice] enabling CLE266 HW decoding)
> 
> 
> I don't know what I miss to get rid of interlacing artifacts on TV out...

If the interlacing problem is a permanent issue, you may try to change
line 294 in video-dfb.c:

fieldParity = 0;    // 0 - top field first, 1 - bottom field first

If that issue is a changing one, we need to set this from
stream information and/or give the user a chance to invert field
parity derived from stream info.


-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Oct  8 23:53:48 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 Oct 2006 23:53:48 +0200
Subject: [Softdevice-devel]
	=?iso-8859-1?q?=5Bdirectfb-users=5D__viafb_+_c?=
	=?iso-8859-1?q?le266mpegdec_+=09TVout_=3A_field_parity_status_and_?=
	=?iso-8859-1?q?patches_=5Bupdate=5D?=
In-Reply-To: <45296A39.60005@directfb.org>
References: <452819D5.3030408@huillard.net>
	<200610082229.10651.stefan@lucke.in-berlin.de>
	<45296A39.60005@directfb.org>
Message-ID: <200610082353.48284.stefan@lucke.in-berlin.de>

On Sonntag 08 Oktober 2006 23:14, Denis Oliver Kropp wrote:
> Stefan Lucke schrieb:
> > On Sonntag 08 Oktober 2006 19:45, Nicolas Huillard wrote:
> >> DFB++ CVS 20061008 (today)
> >> * applied the GetFBOffsetDFB++.patch from libcle266mpegdec
> >> * this patch should make it into CVS, to keep in sync with DirectFB
> >> * there is nothing about field parity there, since Mark's patch was
> >> about the unichrome driver, not about DirectFB API (which DFB++ only
> >> deals with)
> > 
> > I think the DFB++ patch is still on Denis' radar, see:
> > http://mail.directfb.org/pipermail/directfb-dev/2006-October/002356.html
> > 
> > So I don't think we need to push him further.
> 
> I just applied your DFB++ patch. ++DFB also needs an update :)

Thank you very much, that was really fast.
Didn't I say "don't think we need to push" ?

> 
> Any help on bringing ++DFB and DFB++ up to date before making their
> 1.0.0-rc1 is appreciated :)
> 
> > The missing DFB++ part, is one reason not to publish a new softdevice release now.
> 
> I guess that depends on the DFB++ release, not just the commit I did 
> right now?

Oh, in terms of DFB++ it _was_ the commit. Now we can tell softdevice users:
just get the latest cvs versions (as they are in sync).

OT: Denis did you get a "hold for approval message", as you cc'd 
softdevice-devel and you're not on that list ? As softdevice list admin,
I did not yet get a notification on pending request to approve.

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Mon Oct  9 01:25:18 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 Oct 2006 01:25:18 +0200
Subject: [Softdevice-devel] [ANNOUNCE] vdr-softdevice-0.3.0
Message-ID: <200610090125.18654.stefan@lucke.in-berlin.de>

Hello,

the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan Lucke)
is pleased to announce a new release of vdr's softdevice plugin.

General info:
? Softdevice plugin enables vdr to run on your desktop with
? so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
? DirectFB or vidix to your screen. Decoding is done via ffmpeg.

Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x

Plugin's homepage is located at: http://softdevice.berlios.de/

Special hint:
 For cle266 hardware decoding support via DirectFB, you'll need a fresh
 version from todays DirectFB's cvs.
 Further you'll need libcle266mpegdec which is available from:
   http://sourceforge.net/projects/cle266mpegdec/

Changelog since last release:
2006-10-09: softdevice-0.3.0
2006-10-03:
   - fix hang after long pause.
2006-10-01:
   - enable cropping for video-shm.
   - Remove some unneeded code and fix ctl->width/height setting.
2006-09-29:
   - video-shm: silence warnings.
   - video-xv: removed osdMutex.
   - video-dfb: removed osdMutex.
                clear non video area when OSD is active to avoid fade effects.
2006-09-22:
   - protect locking for old picture by a separate mutex.
   - fix possible lost picture update and dropped areaMutex.
2006-09-21:
   - introduce a mutex to protect calls to videoOut from SoftOsd
   - initialize parameters for the vout->GetOSDMode() call
2006-09-19:
   - fix "Error! Trying to unlock a nil picture... Ignoring" error message.
   - use current_OsdMode instead of setupStore.OsdMode
2006-09-18:
   - fix RefreshAll for NoVScaleCopyToBitmap()
   - add a very simple cpu type and host system detection to configure
   - fix changing from pseudo to software osd blending for video-xv
   - remove no longer needed test for broken gcc compiler from configure
   - combine shared memory checks into CheckShmIDs()
   - improve error messages in video-shm.c
2006-09-17:
   - replace "pshufw" with MMX commands to make scaling optimazations available
     to processors without MMX2
   - cleanup PicBuffer.c, release PicBuffers in destructor,...
   - add linux framebuffer detection to configure
   - disable libcle266mpegdec if no DirectFB is found
   - add altivec optimizations to some AlphaBlend() and
     yv12_to_yuy2_il_mmx2_line()
   - make utils.c compile on non MMX machines, cleanup some #ifdefs
   - fix compile issue with g++-4.1.1
   - add NoVScaleCopyToBitmap() for RGB modes
2006-09-16:
   - added -vo shm: to help option
   - added support new fields from libcle266mpegdec-0.4
   - video-dfb: removed check and support for DSBLIT_INTERLACED as DirectFB
                has buildin support for this now.
   - disable cle266 support if DirectFB is not patched for this
   - cle266: fix one aspect ratio info and configure (by Rolf Ahrenberg)
2006-09-12:
   - don't continue on argument errors
2006-09-11:
   - catch unrecognized options for dfb-out (reported by Rolf Ahrenberg)
2006-09-10:
   - fix "NVidia software alpha blending OSD" issue, which turned out
     to be a compiler problem with g++-4.1.1. (Many thanks to Prakash
     Punnoor, Matthias Schwarzott, Chris Elsworth and all the others
     who helped to fix this)
2006-09-09:
   - video-xv.c: silence some warnings
   - video-vidix: offer equalizer settings via OSD (brightness, hue,
                  saturation and contrast)
                  offer HW-deinetrlace via OSD when available
                  (by Roland Praml)
2006-09-08:
   - limit destination video offsets to even values
   - fix typo in asignment
   - fix xv-out with subplugins disabled
2006-09-04:
   - fix wrong colors when using ShmClient (reported by Matthias Schwarzott
     and derWolf at vdrportal)
   - disable debuging printouts
   - cleanup
   - set sPicBuffer completly to zero
2006-08-27:
   - adjust ffmpeg library order in configure
   - enable different pixel formats in video-xv
   - properly init ctl->key (reported by Matthias Schwarzott)
2006-08-05:
   - video-dfb: disable reported failed flags in SetParams()
2006-07-25:
   - no longer exit when a audio mode is not available, audio is only disabled.
   - clean up audio-alsa
   - init tmpOsdSurface and delete dirtyLines properly
   - try to use the XVideo default brightness, hue etc. values on first start
   - new option: "-vo xv:use-defaults", can be used to reset the values
     of brightness, hue etc. to the default values. (Based on a patch
     by Matthias Schwarzott)
2006-07-16:
   - only link against libXi if necessary ( do we need libXi at all?)
   - check explicitly for pkg-config in configure
   - configure: "--with-ffmpeg-path" overrides pkg-config
   - unconditionally set _NET_WM_FULLSCREEN Atom when going fullscreen (recent Metacity WM need it)
2006-07-12:
   - fix segfault in OSD refresher.
2006-07-11:
   - remove no longer defined FFMPEG_VERSION string
2006-07-10:
   - move alsa related stuff into a separate file, enable build without alsa
     support
   - remove uneeded include of "sys/mman.h" and "sys/ioctl.h" from video.c
   - set max_width and max_height for temporary PicBuffer
   - remove uneeded include of "linux/fb.h" from softdevice.c
   - fix possible endianness problems in SoftOsd.c
   - add support for yuy2 pixel format to alpha blend and copy pic buf code
   - change return value of AllocPicBuffer()
   - change the parameters of yv12_to_yuy2_il_mmx() so that it can also be used
     for not interlaced pictures
2006-06-25:
   - video pixelformat and stretchblit mode can be locked by output driver, so
     that changeing them is not offered via OSD.
   - video-dfb: - Adapted radeon real alphablend handling to current DirectFB-cvs.
                  It is now handled similary to via mode (with underlay).
                - In mgatv-out mode, video surface is now allways allocated with
                  attribute DSCAPS_INTERLACED to support interlaced stretchblit
                  of DirectFB-cvs.
                - Removed test #if directives introduced in first via hw-dec support.
                - Lock pixelformat and stretchblit mode in case via hw-decode
                  and mgatv mode.
2006-06-21:
   - video-dfb: changed pixel format for HW-decoding to I420. So accelerated and
     unaccelerated modes use the same pixel format.
2006-06-18:
   - ignore config.log on commit checks
   - removed hardcoded FBDEV name in Makefile and configure
2006-06-17:
   - cle266, video-dfb: added HW-decoder support
   - configure: check for libcle266mpegdec instead of cle266mpegdec
   - get frame buffer name at runtime:
     1. via enviroment variable FRAMEBUFFER
     2. try /dev/fb0 or /dev/fb/0
2006-06-16:
   - video-dfb: fix via aspect ratio handling
2006-06-15:
   - make configure a bit more verbose. A complete log is now saved in
     config.log.
   - fix delete <-> delete[] mismatch reported by Prakash Punnoor.
2006-06-09:
   - activate mmx version of yv12_to_yuy2_il_ () for dfb, xv and vidix.
   - name change libsubvdr-softdevice-METHOD.so.?? -> libsoftdevice-METHOD.so.?? .
   - removed option -L . is obsolete since we can get the path we are loaded from,
     at runtime (thanks to Petri Hintukainen).
2006-06-06:
   - mmx version of yv12_to_yuy2_il_c(): yv12_to_yuy2_il_mmx2(). not yet called.
2006-05-30:
   - set pic->format in AllocPicBuffer()
   - more debug messages
2006-05-29:
   - fix PICDEB
   - fix a few stupid errors in VideoFilter.c, initialise more
     variables in PicFilter.c
2006-05-27:
   - move postproc stuff into VideoFilter.[ch]
   - apply patch to use direct rendering
   - add tests for older ffmpeg versions to configure
   - add "--disable-mmx" and "--disable-mmx2" to configure
   - fix possible segfaults in SoftOsd when using a zoom faktor
2006-05-23:
   - fix VIA OSD transparency for newer DirectFB cvs versions
   - merged some defines which belong together
   - added 15:9 screen aspect
   - fix postprocessing not offered via OSD even detected by configure
   - reenable software alpha blending for video-shm
   - move AlphaBlend into utils.c, clean up MMX defines
2006-05-07:
   - video-dfb: preparation for DSBLIT_INTERLACED which results
     in better displaying of downscaled 16:9 on 4:3 TVs with matrox.
   - video-dfb: make YUY2 color info reordering dependant of
     interlaced vs. progressive video.
2006-05-01:
   - some fixes for DirectFB compile, configure & 64bit arch .

-- 
Stefan Lucke


From nicolas at huillard.net  Mon Oct  9 10:26:12 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Mon, 09 Oct 2006 10:26:12 +0200
Subject: [Softdevice-devel] viafb + cle266mpegdec + TVout : field parity
 status and patches [update]
In-Reply-To: <b7f6d7370610081237o340b4ed4v59db037374f38d49@mail.gmail.com>
References: <452819D5.3030408@huillard.net> <4529394D.8000800@huillard.net>
	<b7f6d7370610081237o340b4ed4v59db037374f38d49@mail.gmail.com>
Message-ID: <452A07A4.3040202@huillard.net>

Mark Adams a ?crit :
>> First : I still have field parity problems with interlaced material on
>> interlaced TV.
> 
> Always, sometimes, coming and going, or just the odd glitch?

"Coming and going".
Defined as : "On the same stream, parity can be OK for a few seconds up
to the minute, and then goes wrong, for a similar period. Pausing the
stream can get it right again. Or not."

So, it's not a parity detection problem from the stream, but it may be a
hole in the stack from viafb to softdevice (both included) that make the
whole parity broken.
Since some people (Laz, at least) are positively happy with field parity
on the same setup (versions excluded), that may be :
* either something I missed somewhere in the stack described in my
[update] post (missing patch ?)
* either a bug introduced in the recent CVS versions I grabbed.

Note that dfbinfo and softdevice both report/enable the field parity
capability.

I just tested without libcle266mpegdec (0.4) (setting "-vo dfb:viatv"
instead of "-vo dfb:viatv:cle266" in softdevice's arguments) :
* it mainly works, after the first few seconds playing a stream (during
these few seconds, there are very short glitches)
* there are very few other glitches from time to time (like a few frame
drops)
* without hardware decoding, it may be related to CPU load (Via EPIA
M10k, C3 Nehemiah 1GHz)

-- 
NH
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfbinfo.log
Type: text/x-log
Size: 1534 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061009/7eff6298/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vdr.log
Type: text/x-log
Size: 4709 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061009/7eff6298/attachment-0001.bin>

From stefan at lucke.in-berlin.de  Mon Oct  9 20:51:37 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 Oct 2006 20:51:37 +0200
Subject: [Softdevice-devel] Remove support for older vdr versions
Message-ID: <200610092051.37167.stefan@lucke.in-berlin.de>

Hi,

if noone vetos, I'd like to remove support for vdr versions earlier than 1.3.7 .


-- 
Stefan Lucke


From nicolas at huillard.net  Mon Oct  9 21:42:33 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Mon, 09 Oct 2006 21:42:33 +0200
Subject: [Softdevice-devel] Remove support for older vdr versions
In-Reply-To: <200610092051.37167.stefan@lucke.in-berlin.de>
References: <200610092051.37167.stefan@lucke.in-berlin.de>
Message-ID: <452AA629.2070408@huillard.net>

Stefan Lucke a ?crit :
> if noone vetos, I'd like to remove support for vdr versions earlier than 1.3.7 .

I think I was the last one still using 1.3, until a few weeks... And
even then, I didn't have a version as old as 1.3.7...
The cleaner the code, the better...

-- 
NH


From torgeir at pobox.com  Mon Oct  9 21:52:00 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 9 Oct 2006 20:52:00 +0100
Subject: [Softdevice-devel] Remove support for older vdr versions
In-Reply-To: <452AA629.2070408@huillard.net>
References: <200610092051.37167.stefan@lucke.in-berlin.de>
	<452AA629.2070408@huillard.net>
Message-ID: <E0E1882D-EBEE-4D5E-9827-F1AA5412DDE9@pobox.com>


On 9 Oct 2006, at 20:42, Nicolas Huillard wrote:

> Stefan Lucke a ?crit :
>> if noone vetos, I'd like to remove support for vdr versions  
>> earlier than 1.3.7 .
>
> I think I was the last one still using 1.3, until a few weeks... And
> even then, I didn't have a version as old as 1.3.7...
> The cleaner the code, the better...

Maybe put a note on the website which version to use with vdr 1.2.*?

-- 
Torgeir Veimo
torgeir at pobox.com





From herbert at 13thfloor.at  Tue Oct 10 03:42:19 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Tue, 10 Oct 2006 03:42:19 +0200
Subject: [Softdevice-devel] [ANNOUNCE] vdr-softdevice-0.3.0
In-Reply-To: <200610090125.18654.stefan@lucke.in-berlin.de>
References: <200610090125.18654.stefan@lucke.in-berlin.de>
Message-ID: <20061010014219.GB29930@MAIL.13thfloor.at>

On Mon, Oct 09, 2006 at 01:25:18AM +0200, Stefan Lucke wrote:
> Hello,
> 
> the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan Lucke)
> is pleased to announce a new release of vdr's softdevice plugin.
> 
> General info:
> ? Softdevice plugin enables vdr to run on your desktop with
> ? so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
> ? DirectFB or vidix to your screen. Decoding is done via ffmpeg.
> 
> Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x

segfaults here (100% reproducible) with or without
alpha blending (i.e. pseudo and software). the only
difference is the backtrace (CopyPicBuf vs *AlphaBlend)

# ./vdr -D1 -c/opt/CONFIG-1/ -P"softdevice -vo xv:"
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
vo_argv: xv: 
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 2 lines from bottom
[setup-softdevice] Cropping 2 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 2 columns from right
[setup-softdevice] Cropping 2 lines from top
[setup-softdevice] deinterlace method set to 1 lavc
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YUY2)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseStretchBlitset to on
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3345152)
[XvVideoOut]: osd_image shmid = 24051722
[XvVideoOut]: got osd_image: width 1600 height 1200, bytes per line 3200
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
DeinitXv
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
vout_pic[2304]:CopyPicBufAlphaBlend_YUV420P_YUY2 width 736 height 576
Segmentation fault (core dumped)


with the following backtrace

#0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020", dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368, 
    yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020", uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
133	    movntq(mm6,*(dest2 + 8));

(gdb) where
#0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020", dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368, 
    yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020", uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
#1  0xb675503a in CopyPicBufAlphaBlend_YUV420P_YUY2 (dst=0x8383ce8, src=0xb61043c0, width=736, height=576, OsdPy=0xb65ca008 '\020' <repeats 200 times>..., 
    OsdPu=0x8bc6338 '\200' <repeats 200 times>..., OsdPv=0x8be0148 '\200' <repeats 200 times>..., OsdPAlphaY=0xb6562008 "", OsdPAlphaUV=0x8bf9f58 "", OsdStride=736, 
    cutTop=2, cutBottom=2, cutLeft=2, cutRight=2) at PicBuffer.c:570
#2  0xb6755591 in CopyPicBufAlphaBlend (dst=0x8383ce8, src=0xb61043c0, OsdPy=0xb65ca008 '\020' <repeats 200 times>..., OsdPu=0x8bc6338 '\200' <repeats 200 times>..., 
    OsdPv=0x8be0148 '\200' <repeats 200 times>..., OsdPAlphaY=0xb6562008 "", OsdPAlphaUV=0x8bf9f58 "", OsdStride=736, cutTop=2, cutBottom=2, cutLeft=2, cutRight=2)
    at PicBuffer.c:700
#3  0xb6752874 in cXvVideoOut::YUV (this=0x8383680, buf=0xb61043c0) at video-xv.c:1820
#4  0xb674e1c9 in cVideoOut::DrawStill_420pl (this=0x8383680, buf=0xb61043c0) at video.c:468
#5  0xb674d79a in cVideoOut::Action (this=0x8383680) at video.c:133
#6  0x080ea83a in cThread::StartThread (Thread=0x8383adc) at thread.c:244
#7  0xb7f37c40 in start_thread () from /lib/tls/libpthread.so.0
#8  0xb7dbb0ee in clone () from /lib/tls/libc.so.6


note: the softdevice-cvs20060623 version I used before
works perfectly fine in the same vdr/setup  (although I h
ad to #define the FFMPEG_VERSION to make it work)

any ideas?

TIA,
Herbert

> Plugin's homepage is located at: http://softdevice.berlios.de/
> 
> Special hint:
>  For cle266 hardware decoding support via DirectFB, you'll need a fresh
>  version from todays DirectFB's cvs.
>  Further you'll need libcle266mpegdec which is available from:
>    http://sourceforge.net/projects/cle266mpegdec/
> 
> Changelog since last release:
> 2006-10-09: softdevice-0.3.0
> 2006-10-03:
>    - fix hang after long pause.
> 2006-10-01:
>    - enable cropping for video-shm.
>    - Remove some unneeded code and fix ctl->width/height setting.
> 2006-09-29:
>    - video-shm: silence warnings.
>    - video-xv: removed osdMutex.
>    - video-dfb: removed osdMutex.
>                 clear non video area when OSD is active to avoid fade effects.
> 2006-09-22:
>    - protect locking for old picture by a separate mutex.
>    - fix possible lost picture update and dropped areaMutex.
> 2006-09-21:
>    - introduce a mutex to protect calls to videoOut from SoftOsd
>    - initialize parameters for the vout->GetOSDMode() call
> 2006-09-19:
>    - fix "Error! Trying to unlock a nil picture... Ignoring" error message.
>    - use current_OsdMode instead of setupStore.OsdMode
> 2006-09-18:
>    - fix RefreshAll for NoVScaleCopyToBitmap()
>    - add a very simple cpu type and host system detection to configure
>    - fix changing from pseudo to software osd blending for video-xv
>    - remove no longer needed test for broken gcc compiler from configure
>    - combine shared memory checks into CheckShmIDs()
>    - improve error messages in video-shm.c
> 2006-09-17:
>    - replace "pshufw" with MMX commands to make scaling optimazations available
>      to processors without MMX2
>    - cleanup PicBuffer.c, release PicBuffers in destructor,...
>    - add linux framebuffer detection to configure
>    - disable libcle266mpegdec if no DirectFB is found
>    - add altivec optimizations to some AlphaBlend() and
>      yv12_to_yuy2_il_mmx2_line()
>    - make utils.c compile on non MMX machines, cleanup some #ifdefs
>    - fix compile issue with g++-4.1.1
>    - add NoVScaleCopyToBitmap() for RGB modes
> 2006-09-16:
>    - added -vo shm: to help option
>    - added support new fields from libcle266mpegdec-0.4
>    - video-dfb: removed check and support for DSBLIT_INTERLACED as DirectFB
>                 has buildin support for this now.
>    - disable cle266 support if DirectFB is not patched for this
>    - cle266: fix one aspect ratio info and configure (by Rolf Ahrenberg)
> 2006-09-12:
>    - don't continue on argument errors
> 2006-09-11:
>    - catch unrecognized options for dfb-out (reported by Rolf Ahrenberg)
> 2006-09-10:
>    - fix "NVidia software alpha blending OSD" issue, which turned out
>      to be a compiler problem with g++-4.1.1. (Many thanks to Prakash
>      Punnoor, Matthias Schwarzott, Chris Elsworth and all the others
>      who helped to fix this)
> 2006-09-09:
>    - video-xv.c: silence some warnings
>    - video-vidix: offer equalizer settings via OSD (brightness, hue,
>                   saturation and contrast)
>                   offer HW-deinetrlace via OSD when available
>                   (by Roland Praml)
> 2006-09-08:
>    - limit destination video offsets to even values
>    - fix typo in asignment
>    - fix xv-out with subplugins disabled
> 2006-09-04:
>    - fix wrong colors when using ShmClient (reported by Matthias Schwarzott
>      and derWolf at vdrportal)
>    - disable debuging printouts
>    - cleanup
>    - set sPicBuffer completly to zero
> 2006-08-27:
>    - adjust ffmpeg library order in configure
>    - enable different pixel formats in video-xv
>    - properly init ctl->key (reported by Matthias Schwarzott)
> 2006-08-05:
>    - video-dfb: disable reported failed flags in SetParams()
> 2006-07-25:
>    - no longer exit when a audio mode is not available, audio is only disabled.
>    - clean up audio-alsa
>    - init tmpOsdSurface and delete dirtyLines properly
>    - try to use the XVideo default brightness, hue etc. values on first start
>    - new option: "-vo xv:use-defaults", can be used to reset the values
>      of brightness, hue etc. to the default values. (Based on a patch
>      by Matthias Schwarzott)
> 2006-07-16:
>    - only link against libXi if necessary ( do we need libXi at all?)
>    - check explicitly for pkg-config in configure
>    - configure: "--with-ffmpeg-path" overrides pkg-config
>    - unconditionally set _NET_WM_FULLSCREEN Atom when going fullscreen (recent Metacity WM need it)
> 2006-07-12:
>    - fix segfault in OSD refresher.
> 2006-07-11:
>    - remove no longer defined FFMPEG_VERSION string
> 2006-07-10:
>    - move alsa related stuff into a separate file, enable build without alsa
>      support
>    - remove uneeded include of "sys/mman.h" and "sys/ioctl.h" from video.c
>    - set max_width and max_height for temporary PicBuffer
>    - remove uneeded include of "linux/fb.h" from softdevice.c
>    - fix possible endianness problems in SoftOsd.c
>    - add support for yuy2 pixel format to alpha blend and copy pic buf code
>    - change return value of AllocPicBuffer()
>    - change the parameters of yv12_to_yuy2_il_mmx() so that it can also be used
>      for not interlaced pictures
> 2006-06-25:
>    - video pixelformat and stretchblit mode can be locked by output driver, so
>      that changeing them is not offered via OSD.
>    - video-dfb: - Adapted radeon real alphablend handling to current DirectFB-cvs.
>                   It is now handled similary to via mode (with underlay).
>                 - In mgatv-out mode, video surface is now allways allocated with
>                   attribute DSCAPS_INTERLACED to support interlaced stretchblit
>                   of DirectFB-cvs.
>                 - Removed test #if directives introduced in first via hw-dec support.
>                 - Lock pixelformat and stretchblit mode in case via hw-decode
>                   and mgatv mode.
> 2006-06-21:
>    - video-dfb: changed pixel format for HW-decoding to I420. So accelerated and
>      unaccelerated modes use the same pixel format.
> 2006-06-18:
>    - ignore config.log on commit checks
>    - removed hardcoded FBDEV name in Makefile and configure
> 2006-06-17:
>    - cle266, video-dfb: added HW-decoder support
>    - configure: check for libcle266mpegdec instead of cle266mpegdec
>    - get frame buffer name at runtime:
>      1. via enviroment variable FRAMEBUFFER
>      2. try /dev/fb0 or /dev/fb/0
> 2006-06-16:
>    - video-dfb: fix via aspect ratio handling
> 2006-06-15:
>    - make configure a bit more verbose. A complete log is now saved in
>      config.log.
>    - fix delete <-> delete[] mismatch reported by Prakash Punnoor.
> 2006-06-09:
>    - activate mmx version of yv12_to_yuy2_il_ () for dfb, xv and vidix.
>    - name change libsubvdr-softdevice-METHOD.so.?? -> libsoftdevice-METHOD.so.?? .
>    - removed option -L . is obsolete since we can get the path we are loaded from,
>      at runtime (thanks to Petri Hintukainen).
> 2006-06-06:
>    - mmx version of yv12_to_yuy2_il_c(): yv12_to_yuy2_il_mmx2(). not yet called.
> 2006-05-30:
>    - set pic->format in AllocPicBuffer()
>    - more debug messages
> 2006-05-29:
>    - fix PICDEB
>    - fix a few stupid errors in VideoFilter.c, initialise more
>      variables in PicFilter.c
> 2006-05-27:
>    - move postproc stuff into VideoFilter.[ch]
>    - apply patch to use direct rendering
>    - add tests for older ffmpeg versions to configure
>    - add "--disable-mmx" and "--disable-mmx2" to configure
>    - fix possible segfaults in SoftOsd when using a zoom faktor
> 2006-05-23:
>    - fix VIA OSD transparency for newer DirectFB cvs versions
>    - merged some defines which belong together
>    - added 15:9 screen aspect
>    - fix postprocessing not offered via OSD even detected by configure
>    - reenable software alpha blending for video-shm
>    - move AlphaBlend into utils.c, clean up MMX defines
> 2006-05-07:
>    - video-dfb: preparation for DSBLIT_INTERLACED which results
>      in better displaying of downscaled 16:9 on 4:3 TVs with matrox.
>    - video-dfb: make YUY2 color info reordering dependant of
>      interlaced vs. progressive video.
> 2006-05-01:
>    - some fixes for DirectFB compile, configure & 64bit arch .
> 
> -- 
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From stefan at lucke.in-berlin.de  Tue Oct 10 07:50:14 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 10 Oct 2006 07:50:14 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs from
	2006-06-23
Message-ID: <1160459414.452b34961290d@webmail.in-berlin.de>

Quoting Herbert Poetzl <herbert at 13thfloor.at>:

> On Mon, Oct 09, 2006 at 01:25:18AM +0200, Stefan Lucke wrote:
> > Hello,
> >
> > the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan Lucke)
> > is pleased to announce a new release of vdr's softdevice plugin.
> >
> > General info:
> >   Softdevice plugin enables vdr to run on your desktop with
> >   so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
> >   DirectFB or vidix to your screen. Decoding is done via ffmpeg.
> >
> > Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x
>
> segfaults here (100% reproducible) with or without
> alpha blending (i.e. pseudo and software). the only
> difference is the backtrace (CopyPicBuf vs *AlphaBlend)
>
> # ./vdr -D1 -c/opt/CONFIG-1/ -P"softdevice -vo xv:"
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice]   argv [1] = -vo
> vo_argv: xv:
> [setup-softdevice] alsa ac3Mode set to: 0
> [setup-softdevice] alsa AC3 device set to: hw:0,1
> [setup-softdevice] alsa device set to: default
> [setup-softdevice] A/V Offset set to (0)
> [setup-softdevice] Cropping 2 lines from bottom
> [setup-softdevice] Cropping 2 columns from left
> [setup-softdevice] cropping mode set to 0 (none)
> [setup-softdevice] cropping mode toggle key set to 0 (none)
> [setup-softdevice] Cropping 2 columns from right
> [setup-softdevice] Cropping 2 lines from top

Does it make a difference when setting crop line /coloumns to 0 ?

> [setup-softdevice] deinterlace method set to 1 lavc
> [setup-softdevice] mainMenu: 1
> [setup-softdevice] setting alpha blend mode to software
> [softdevice] picture mirroring set to 0 (off)
> [setup-softdevice] pixel format set to (YUY2)
> [setup-softdevice] shouldSuspend to: 0
> [setup-softdevice] syncTimerMode: sig
> [softdevice] UseStretchBlitset to on
> [setup-softdevice] vidBrightness: 50
> [setup-softdevice] vidContrast: 50
> [setup-softdevice] vidHue: 0
> [setup-softdevice] vidSaturation: 50
> [setup-softdevice] startup aspect set to (4:3 normal)
> [softdevice] initializing Plugin
> [softdevice] Initializing Video Out
> [softdevice] ffmpeg build(3345152)
> [XvVideoOut]: osd_image shmid = 24051722
> [XvVideoOut]: got osd_image: width 1600 height 1200, bytes per line 3200

Does it make a difference when choosing a lower resolution than 1600x1200 ?

> [XvVideoOut]: max area size 2046 x 2046
> [XvVideoOut]: using area size 736 x 576
> [softdevice] Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> DeinitXv
> [XvVideoOut]: max area size 2046 x 2046
> [XvVideoOut]: using area size 736 x 576
> vout_pic[2304]:CopyPicBufAlphaBlend_YUV420P_YUY2 width 736 height 576
> Segmentation fault (core dumped)
>
>
> with the following backtrace
>
> #0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020",
> dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368,
>     yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020",
> uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
> 133	    movntq(mm6,*(dest2 + 8));
>
> (gdb) where
> #0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020",
> dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368,
>     yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020",
> uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
> #1  0xb675503a in CopyPicBufAlphaBlend_YUV420P_YUY2 (dst=0x8383ce8, src=0xb61043c0, width=736,
> height=576, OsdPy=0xb65ca008 '\020' <repeats 200 times>...,
>     OsdPu=0x8bc6338 '\200' <repeats 200 times>..., OsdPv=0x8be0148 '\200' <repeats 200 times>...,
> OsdPAlphaY=0xb6562008 "", OsdPAlphaUV=0x8bf9f58 "", OsdStride=736,
>     cutTop=2, cutBottom=2, cutLeft=2, cutRight=2) at PicBuffer.c:570
> #2  0xb6755591 in CopyPicBufAlphaBlend (dst=0x8383ce8, src=0xb61043c0, OsdPy=0xb65ca008 '\020'
> <repeats 200 times>..., OsdPu=0x8bc6338 '\200' <repeats 200 times>...,
>     OsdPv=0x8be0148 '\200' <repeats 200 times>..., OsdPAlphaY=0xb6562008 "",
> OsdPAlphaUV=0x8bf9f58 "", OsdStride=736, cutTop=2, cutBottom=2, cutLeft=2, cutRight=2)
>     at PicBuffer.c:700
> #3  0xb6752874 in cXvVideoOut::YUV (this=0x8383680, buf=0xb61043c0) at video-xv.c:1820
> #4  0xb674e1c9 in cVideoOut::DrawStill_420pl (this=0x8383680, buf=0xb61043c0) at video.c:468
> #5  0xb674d79a in cVideoOut::Action (this=0x8383680) at video.c:133
> #6  0x080ea83a in cThread::StartThread (Thread=0x8383adc) at thread.c:244
> #7  0xb7f37c40 in start_thread () from /lib/tls/libpthread.so.0
> #8  0xb7dbb0ee in clone () from /lib/tls/libc.so.6
>
>
> note: the softdevice-cvs20060623 version I used before
> works perfectly fine in the same vdr/setup  (although I h
> ad to #define the FFMPEG_VERSION to make it work)
>
> any ideas?
>

Stefan Lucke


From herbert at 13thfloor.at  Tue Oct 10 15:24:03 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Tue, 10 Oct 2006 15:24:03 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <1160459414.452b34961290d@webmail.in-berlin.de>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
Message-ID: <20061010132403.GB2284@MAIL.13thfloor.at>

On Tue, Oct 10, 2006 at 07:50:14AM +0200, Stefan Lucke wrote:
> Quoting Herbert Poetzl <herbert at 13thfloor.at>:
> 
> > On Mon, Oct 09, 2006 at 01:25:18AM +0200, Stefan Lucke wrote:
> > > Hello,
> > >
> > > the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan
> > > Lucke) is pleased to announce a new release of vdr's softdevice
> > > plugin.
> > >
> > > General info:
> > >   Softdevice plugin enables vdr to run on your desktop with so
> > >   called budget cards. You'll get vdr output via framebuffer or
> > >   X11-Xv or DirectFB or vidix to your screen. Decoding is done via
> > >   ffmpeg.
> > >
> > > Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x
> >
> > segfaults here (100% reproducible) with or without
> > alpha blending (i.e. pseudo and software). the only
> > difference is the backtrace (CopyPicBuf vs *AlphaBlend)
> >
> > # ./vdr -D1 -c/opt/CONFIG-1/ -P"softdevice -vo xv:"
> > [softdevice] processing args
> > [softdevice]   argv [0] = softdevice
> > [softdevice]   argv [1] = -vo
> > vo_argv: xv:
> > [setup-softdevice] alsa ac3Mode set to: 0
> > [setup-softdevice] alsa AC3 device set to: hw:0,1
> > [setup-softdevice] alsa device set to: default
> > [setup-softdevice] A/V Offset set to (0)
> > [setup-softdevice] Cropping 2 lines from bottom
> > [setup-softdevice] Cropping 2 columns from left
> > [setup-softdevice] cropping mode set to 0 (none)
> > [setup-softdevice] cropping mode toggle key set to 0 (none)
> > [setup-softdevice] Cropping 2 columns from right
> > [setup-softdevice] Cropping 2 lines from top
> 
> Does it make a difference when setting crop line /coloumns to 0 ?

that was indeed a good hint, I completely removed the 
configuration entries for the softdevice, and suddenly
it started working. after analyzing the differences,
here is the culprit:

softdevice.AC3Mode = 0
softdevice.AlsaAC3Device = hw:0,1
softdevice.AlsaDevice = default
softdevice.avOffset = 0
softdevice.bufferMode = 0
softdevice.CropBottomLines = 2
softdevice.CropLeftCols = 2
softdevice.CropMode = 0
softdevice.CropModeToggleKey = 0
softdevice.CropRightCols = 2
softdevice.CropTopLines = 2
softdevice.Deinterlace Method = 0
softdevice.mainMenu = 1
softdevice.OSDalphablend = 1
softdevice.Picture mirroring = 0
softdevice.PixelAspect = 0
softdevice.PixelFormat = 2
			~~~
softdevice.Postprocess Method = 0
softdevice.Postprocess Quality = 0
softdevice.Suspend = 0
softdevice.syncTimerMode = 2
softdevice.UseStretchBlit = 0
softdevice.vidBrightness = -1
softdevice.vidContrast = -1
softdevice.vidHue = -1
softdevice.vidSaturation = -1
softdevice.Xv-Aspect = 1

changing the PixelFormat to 0 or 1 makes it work with
correct colors, while 2 causes the segfault

HTH,
Herbert

> > [setup-softdevice] deinterlace method set to 1 lavc
> > [setup-softdevice] mainMenu: 1
> > [setup-softdevice] setting alpha blend mode to software
> > [softdevice] picture mirroring set to 0 (off)
> > [setup-softdevice] pixel format set to (YUY2)
> > [setup-softdevice] shouldSuspend to: 0
> > [setup-softdevice] syncTimerMode: sig
> > [softdevice] UseStretchBlitset to on
> > [setup-softdevice] vidBrightness: 50
> > [setup-softdevice] vidContrast: 50
> > [setup-softdevice] vidHue: 0
> > [setup-softdevice] vidSaturation: 50
> > [setup-softdevice] startup aspect set to (4:3 normal)
> > [softdevice] initializing Plugin
> > [softdevice] Initializing Video Out
> > [softdevice] ffmpeg build(3345152)
> > [XvVideoOut]: osd_image shmid = 24051722
> > [XvVideoOut]: got osd_image: width 1600 height 1200, bytes per line 3200
> 
> Does it make a difference when choosing a lower resolution than 1600x1200 ?
> 
> > [XvVideoOut]: max area size 2046 x 2046
> > [XvVideoOut]: using area size 736 x 576
> > [softdevice] Subplugin successfully opend
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > DeinitXv
> > [XvVideoOut]: max area size 2046 x 2046
> > [XvVideoOut]: using area size 736 x 576
> > vout_pic[2304]:CopyPicBufAlphaBlend_YUV420P_YUY2 width 736 height 576
> > Segmentation fault (core dumped)
> >
> >
> > with the following backtrace
> >
> > #0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020",
> > dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368,
> >     yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020",
> > uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
> > 133	    movntq(mm6,*(dest2 + 8));
> >
> > (gdb) where
> > #0  yv12_to_yuy2_il_mmx2_line (dest1=0xb4723a34 "\020\200\020\200\020\200\020\200\020",
> > dest2=0xb4723ff4 "\020\200\020\200\020\200\020\200", chromaWidth=368,
> >     yc1=0xb6103ef8 '\020' <repeats 200 times>..., yc2=0xb61041d8 "\020\020\020\020",
> > uc=0xb6103a9c "\200\200", vc=0xb61037ac "\200\200") at utils.c:133
> > #1  0xb675503a in CopyPicBufAlphaBlend_YUV420P_YUY2 (dst=0x8383ce8, src=0xb61043c0, width=736,
> > height=576, OsdPy=0xb65ca008 '\020' <repeats 200 times>...,
> >     OsdPu=0x8bc6338 '\200' <repeats 200 times>..., OsdPv=0x8be0148 '\200' <repeats 200 times>...,
> > OsdPAlphaY=0xb6562008 "", OsdPAlphaUV=0x8bf9f58 "", OsdStride=736,
> >     cutTop=2, cutBottom=2, cutLeft=2, cutRight=2) at PicBuffer.c:570
> > #2  0xb6755591 in CopyPicBufAlphaBlend (dst=0x8383ce8, src=0xb61043c0, OsdPy=0xb65ca008 '\020'
> > <repeats 200 times>..., OsdPu=0x8bc6338 '\200' <repeats 200 times>...,
> >     OsdPv=0x8be0148 '\200' <repeats 200 times>..., OsdPAlphaY=0xb6562008 "",
> > OsdPAlphaUV=0x8bf9f58 "", OsdStride=736, cutTop=2, cutBottom=2, cutLeft=2, cutRight=2)
> >     at PicBuffer.c:700
> > #3  0xb6752874 in cXvVideoOut::YUV (this=0x8383680, buf=0xb61043c0) at video-xv.c:1820
> > #4  0xb674e1c9 in cVideoOut::DrawStill_420pl (this=0x8383680, buf=0xb61043c0) at video.c:468
> > #5  0xb674d79a in cVideoOut::Action (this=0x8383680) at video.c:133
> > #6  0x080ea83a in cThread::StartThread (Thread=0x8383adc) at thread.c:244
> > #7  0xb7f37c40 in start_thread () from /lib/tls/libpthread.so.0
> > #8  0xb7dbb0ee in clone () from /lib/tls/libc.so.6
> >
> >
> > note: the softdevice-cvs20060623 version I used before
> > works perfectly fine in the same vdr/setup  (although I h
> > ad to #define the FFMPEG_VERSION to make it work)
> >
> > any ideas?
> >
> 
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From stefan at lucke.in-berlin.de  Tue Oct 10 23:57:57 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 10 Oct 2006 23:57:57 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <20061010132403.GB2284@MAIL.13thfloor.at>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
	<20061010132403.GB2284@MAIL.13thfloor.at>
Message-ID: <200610102357.57629.stefan@lucke.in-berlin.de>

On Dienstag 10 Oktober 2006 15:24, Herbert Poetzl wrote:
> On Tue, Oct 10, 2006 at 07:50:14AM +0200, Stefan Lucke wrote:
> > Quoting Herbert Poetzl <herbert at 13thfloor.at>:
> > 
> > > On Mon, Oct 09, 2006 at 01:25:18AM +0200, Stefan Lucke wrote:
> > > > Hello,
> > > >
> > > > the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan
> > > > Lucke) is pleased to announce a new release of vdr's softdevice
> > > > plugin.
> > > >
> > > > General info:
> > > >   Softdevice plugin enables vdr to run on your desktop with so
> > > >   called budget cards. You'll get vdr output via framebuffer or
> > > >   X11-Xv or DirectFB or vidix to your screen. Decoding is done via
> > > >   ffmpeg.
> > > >
> > > > Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x
> > >
> > > segfaults here (100% reproducible) with or without
> > > alpha blending (i.e. pseudo and software). the only
> > > difference is the backtrace (CopyPicBuf vs *AlphaBlend)
> > >
> > > # ./vdr -D1 -c/opt/CONFIG-1/ -P"softdevice -vo xv:"
> > > [softdevice] processing args
> > > [softdevice]   argv [0] = softdevice
> > > [softdevice]   argv [1] = -vo
> > > vo_argv: xv:
> > > [setup-softdevice] alsa ac3Mode set to: 0
> > > [setup-softdevice] alsa AC3 device set to: hw:0,1
> > > [setup-softdevice] alsa device set to: default
> > > [setup-softdevice] A/V Offset set to (0)
> > > [setup-softdevice] Cropping 2 lines from bottom
> > > [setup-softdevice] Cropping 2 columns from left
> > > [setup-softdevice] cropping mode set to 0 (none)
> > > [setup-softdevice] cropping mode toggle key set to 0 (none)
> > > [setup-softdevice] Cropping 2 columns from right
> > > [setup-softdevice] Cropping 2 lines from top
> > 
> > Does it make a difference when setting crop line /coloumns to 0 ?
> 
> that was indeed a good hint, I completely removed the 
> configuration entries for the softdevice, and suddenly
> it started working. after analyzing the differences,
> here is the culprit:

> softdevice.PixelFormat = 2
> 			~~~

Yes changing pixelformat is the other way to circumvent this segfault.
Please get an updated version from cvs, as the bug was reproducable 
for me and I commited a fix.

-- 
Stefan Lucke


From herbert at 13thfloor.at  Wed Oct 11 01:53:22 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Wed, 11 Oct 2006 01:53:22 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <200610102357.57629.stefan@lucke.in-berlin.de>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
	<20061010132403.GB2284@MAIL.13thfloor.at>
	<200610102357.57629.stefan@lucke.in-berlin.de>
Message-ID: <20061010235322.GA28197@MAIL.13thfloor.at>

On Tue, Oct 10, 2006 at 11:57:57PM +0200, Stefan Lucke wrote:
> On Dienstag 10 Oktober 2006 15:24, Herbert Poetzl wrote:
> > On Tue, Oct 10, 2006 at 07:50:14AM +0200, Stefan Lucke wrote:
> > > Quoting Herbert Poetzl <herbert at 13thfloor.at>:
> > > 
> > > > On Mon, Oct 09, 2006 at 01:25:18AM +0200, Stefan Lucke wrote:
> > > > > Hello,
> > > > >
> > > > > the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan
> > > > > Lucke) is pleased to announce a new release of vdr's softdevice
> > > > > plugin.
> > > > >
> > > > > General info:
> > > > >   Softdevice plugin enables vdr to run on your desktop with so
> > > > >   called budget cards. You'll get vdr output via framebuffer
> > > > >   or X11-Xv or DirectFB or vidix to your screen. Decoding is
> > > > >   done via ffmpeg.
> > > > >
> > > > > Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x
> > > >
> > > > segfaults here (100% reproducible) with or without
> > > > alpha blending (i.e. pseudo and software). the only
> > > > difference is the backtrace (CopyPicBuf vs *AlphaBlend)
> > > >
> > > > # ./vdr -D1 -c/opt/CONFIG-1/ -P"softdevice -vo xv:"
> > > > [softdevice] processing args
> > > > [softdevice]   argv [0] = softdevice
> > > > [softdevice]   argv [1] = -vo
> > > > vo_argv: xv:
> > > > [setup-softdevice] alsa ac3Mode set to: 0
> > > > [setup-softdevice] alsa AC3 device set to: hw:0,1
> > > > [setup-softdevice] alsa device set to: default
> > > > [setup-softdevice] A/V Offset set to (0)
> > > > [setup-softdevice] Cropping 2 lines from bottom
> > > > [setup-softdevice] Cropping 2 columns from left
> > > > [setup-softdevice] cropping mode set to 0 (none)
> > > > [setup-softdevice] cropping mode toggle key set to 0 (none)
> > > > [setup-softdevice] Cropping 2 columns from right
> > > > [setup-softdevice] Cropping 2 lines from top
> > > 
> > > Does it make a difference when setting crop line /coloumns to 0 ?
> > 
> > that was indeed a good hint, I completely removed the 
> > configuration entries for the softdevice, and suddenly
> > it started working. after analyzing the differences,
> > here is the culprit:
> 
> > softdevice.PixelFormat = 2
> > 			~~~
> 
> Yes changing pixelformat is the other way to circumvent this segfault.
> Please get an updated version from cvs, as the bug was reproducable
> for me and I commited a fix.

seems to work fine here, thanks!

btw, a few things I noticed regarding softdevice
but I didn't bother to mention (until now), but 
maybe that input is appreciated:

 - depending on the pixel format, the entire
   picture and overlay shifts slightly left and
   right, where:

   - YV12 is one pixel right compared to YUY2
   - YV12 and I420 are perfectly aligned

 - the pseudo alpha blending never worked for me
   neither with different nvidia cards nor with
   matrox cards

 - I would expect the overlay to be pixel aligned
   (as it is on the full featured card) i.e.
   without strange scaling/alignment effects
   while in fact it changes slightly with each
   channel (duplicating pixels and sometimes
   even antialiasing pixels) see
  
   http://www.13thfloor.at/~herbert/chan{05,14,26}.png

that aside, I'm happy that softdevice was not
abandoned and seems to be well maintained now

thanks for your work and time,
Herbert

> -- 
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From mtvartia at cc.hut.fi  Wed Oct 11 18:39:14 2006
From: mtvartia at cc.hut.fi (Mikko Vartiainen)
Date: Wed, 11 Oct 2006 19:39:14 +0300 (EEST)
Subject: [Softdevice-devel] DVD menu problem with softdevice+dvd-plugin
Message-ID: <Pine.GSO.4.61.0610111928260.15903@vipunen.hut.fi>



Hi

I have a problem with DVD menus. When using dvd menus, osd layer and the 
picture layer aren't aligned, if there is any stretching involved.

This is an old problem which was fixed back in January with Martin Wache's new 
OSD. I think that the problem came back sometime when the new field based 
scaling was introduced.

My configuratin is:
vdr 1.4.3
softdevice 0.3.0
Directfb cvs
dvd-plugin 0.3.6-b03
mgatv with 4:3 tv


-- 
Mikko Vartiainen


From stefan at lucke.in-berlin.de  Wed Oct 11 22:15:45 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 11 Oct 2006 22:15:45 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <20061010235322.GA28197@MAIL.13thfloor.at>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
	<200610102357.57629.stefan@lucke.in-berlin.de>
	<20061010235322.GA28197@MAIL.13thfloor.at>
Message-ID: <200610112215.45675.stefan@lucke.in-berlin.de>

On Mittwoch 11 Oktober 2006 01:53, Herbert Poetzl wrote:
> On Tue, Oct 10, 2006 at 11:57:57PM +0200, Stefan Lucke wrote:

> > 
> > Yes changing pixelformat is the other way to circumvent this segfault.
> > Please get an updated version from cvs, as the bug was reproducable
> > for me and I commited a fix.

There was still an issue with color jumping, when cut lines from left
was set to an odd value. Fixed now.

> 
> seems to work fine here, thanks!
> 
> btw, a few things I noticed regarding softdevice
> but I didn't bother to mention (until now), but 
> maybe that input is appreciated:
> 
>  - depending on the pixel format, the entire
>    picture and overlay shifts slightly left and
>    right, where:
> 
>    - YV12 is one pixel right compared to YUY2

One pixel ? That _was_ much more as for some reason edge_with was 16,
which must be multiplied by 2 for YUV2 offset calculations.

>    - YV12 and I420 are perfectly aligned
> 
>  - the pseudo alpha blending never worked for me
>    neither with different nvidia cards nor with
>    matrox cards

Ups, both modes work perfectly fine for my G550 ;-) .

> 
>  - I would expect the overlay to be pixel aligned
>    (as it is on the full featured card) i.e.
>    without strange scaling/alignment effects
>    while in fact it changes slightly with each
>    channel (duplicating pixels and sometimes
>    even antialiasing pixels) see

Could be an edge_width problem too (<= vs <) .

>   
>    http://www.13thfloor.at/~herbert/chan{05,14,26}.png

That link does not work.

> 
> that aside, I'm happy that softdevice was not
> abandoned and seems to be well maintained now
> 


-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Wed Oct 11 22:16:48 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 11 Oct 2006 22:16:48 +0200
Subject: [Softdevice-devel] softdevice xv and i915 Notebook
In-Reply-To: <200609272055.02845.t-erdmann@web.de>
References: <200609211822.51577.t-erdmann@web.de>
	<1159378202.451ab51a6ebce@webmail.in-berlin.de>
	<200609272055.02845.t-erdmann@web.de>
Message-ID: <200610112216.48921.stefan@lucke.in-berlin.de>

On Mittwoch 27 September 2006 20:55, Thomas Erdmann wrote:
> Am Mittwoch, 27. September 2006 19:30 schrieb Stefan Lucke:
> > But that's not the sequence I intendet to asked for. Command I wrote
> > is buggy. From vdr's directrory I do:
> >
> > jarada vdr-1.4.0.jarada # gdb ./vdr
> > GNU gdb 6.4
> > Copyright 2005 Free Software Foundation, Inc.
> > GDB is free software, covered by the GNU General Public License, and you
> > are welcome to change it and/or distribute copies of it under certain
> > conditions. Type "show copying" to see the conditions.
> > There is absolutely no warranty for GDB. ?Type "show warranty" for details.
> > This GDB was configured as "i686-pc-linux-gnu"...Using host libthread_db
> > library "/lib/tls/libthread_db.so.1".
> >

> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread -1303712848 (LWP 8457)]
> 0xb7bf5067 in cSoftOsd::ScaleUpVert_MMX (this=0x87db5a0, dest=0x0, 
> linesize=5600, new_pixel_height=0,
> ? ? start_pos=0, pixmap=0xb24ae33c, Pixel=1400) at SoftOsd.c:1640
> 1640 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"r" 
> (&dest[ypos*linesize+currPixel*4]) );
> Current language: ?auto; currently c++

Can you recheck that with current cvs, as shown line (1640) has been changed
and is now at a different location (line 1745).

-- 
Stefan Lucke


From marko.makela at hut.fi  Wed Oct 11 22:54:53 2006
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 11 Oct 2006 23:54:53 +0300
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <200610112215.45675.stefan@lucke.in-berlin.de>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
	<200610102357.57629.stefan@lucke.in-berlin.de>
	<20061010235322.GA28197@MAIL.13thfloor.at>
	<200610112215.45675.stefan@lucke.in-berlin.de>
Message-ID: <20061011205453.GD2926@localhost.localdomain>

On Wed, Oct 11, 2006 at 10:15:45PM +0200, Stefan Lucke wrote:
> >    http://www.13thfloor.at/~herbert/chan{05,14,26}.png
> 
> That link does not work.

Try wget http://www.13thfloor.at/~herbert/chan{05,14,26}.png
from bash or some other shell that knows {,} expansion.

	Marko


From stefan at lucke.in-berlin.de  Thu Oct 12 07:24:08 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 12 Oct 2006 07:24:08 +0200
Subject: [Softdevice-devel] Segfault with current 0.3.0 release vs. cvs
	from 2006-06-23
In-Reply-To: <20061011205453.GD2926@localhost.localdomain>
References: <1160459414.452b34961290d@webmail.in-berlin.de>
	<200610112215.45675.stefan@lucke.in-berlin.de>
	<20061011205453.GD2926@localhost.localdomain>
Message-ID: <200610120724.09065.stefan@lucke.in-berlin.de>

On Mittwoch 11 Oktober 2006 22:54, Marko M?kel? wrote:
> On Wed, Oct 11, 2006 at 10:15:45PM +0200, Stefan Lucke wrote:
> > >    http://www.13thfloor.at/~herbert/chan{05,14,26}.png
> > 
> > That link does not work.
> 
> Try wget http://www.13thfloor.at/~herbert/chan{05,14,26}.png
> from bash or some other shell that knows {,} expansion.

Thanks, that worked.

-- 
Stefan Lucke


From laz at club-burniston.co.uk  Sat Oct 14 10:22:12 2006
From: laz at club-burniston.co.uk (Laz)
Date: Sat, 14 Oct 2006 09:22:12 +0100
Subject: [Softdevice-devel]
 =?iso-8859-15?q?=5Bdirectfb-users=5D__viafb_+_?=
 =?iso-8859-15?q?cle266mpegdec_+=09TVout_=3A_field_parity_status_and_patch?=
 =?iso-8859-15?q?es_=5Bupdate=5D?=
In-Reply-To: <45301E7F.9040509@huillard.net>
References: <452819D5.3030408@huillard.net>
	<200610092031.05389.stefan@lucke.in-berlin.de>
	<45301E7F.9040509@huillard.net>
Message-ID: <200610140922.12874.laz@club-burniston.co.uk>

On Saturday 14 October 2006 00:17, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > That looks more like some interrupts are lost.
> > Is VGA IRQ shared with other devices (/proc/interrupts) ?
>
> Please excuse me for this late answer. I didn't check that post on the
> DFB ML.
>
> IRQ 11 is shared with USB (not used) and eth (heavily used, but not when
> I watch TV....):
>   11:   23638023          XT-PIC  uhci_hcd:usb1, viafb, eth0

On my system:
  5:      16739          XT-PIC  viafb, uhci_hcd:usb1, uhci_hcd:usb3, VIA8233, 
eth0

For me, it's sharing the same interrupt for the sound chip and eth0. Eth0 can 
get quite a hammering when I'm using vdrsync over nfs from another box, and I 
hardly see any effects.

> Answer to Mark : it's not a multiprocessor system ("SMP alternatives:
> switching to UP code"; "Freeing SMP alternatives: 0k freed")

I don't have SMP stuff in my (self-built 2.6.15.5) kernel.

> When modprobing viafb, it report the following IRQ (dmesg):
>  viafb: irq handler installed, IRQ(0x200) = 80080c02

Here's what I see in dmesg:
viafb: VIA UNICHROME framebuffer 1.0 initializing
viafb: viafb : CC900000
viafb: framebuffer size = 64 Mb
viafb: Found Device Rev:0
mtrr: MTRR 4 not used
mtrr: 0xd8000000,0x4000000 overlaps existing 0xd8000000,0x800000
viafb: X:720 Y:576
viafb: detected VT1622A (7)
viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
viafb: VQ start:3FC0000  end:3FFFFFF  size:40000
viafb: Cursor start:3FBF000  end:3FBFFFF  size:1000
viafb: detected VT1622A (7)
viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
viafb: irq handler installed, IRQ(0x200) = 80080c02

> I actually see those high IRQ numbers on other hosts, when the APIC is
> enabled:
>  185:   30244076   IO-APIC-level  eth0
>
> On the EPIA VDR host, dmesg says :
>  No local APIC present or hardware disabled
>  mapped APIC to ffffd000 (011c1000)
> Should it be that I have partly working IRQ routing. My kernel is
> self-compiled 2.6.17 (from Debian source package).

Hmm...I'm losing all of the IRQ routing stuff from the top of dmesg. Has the 
size of the buffer shrunk, or something?

:-s

Ahhh...just discovered CONFIG_LOG_BUF_SHIFT=14 in my kernel config!! Don't 
think I've touched that but buffer size used to be 16k! Next time I upgrade 
my kernel I'll have to tweak that.

Looking at my config, I do have the following set:
CONFIG_X86_UP_APIC=y
CONFIG_X86_UP_IOAPIC=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y

but I don't see any mention of APIC in /proc/interrupts.

Not sure any of the above helps but it's what I'm getting here!

Did you try printing out viafb_wait_for_sync as Mark suggested to see if it 
changes or not?

Cheers,

Laz


From nicolas at huillard.net  Sat Oct 14 11:33:59 2006
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sat, 14 Oct 2006 11:33:59 +0200
Subject: [Softdevice-devel] [directfb-users] viafb + cle266mpegdec +
 TVout : field parity status and patches [update]
In-Reply-To: <200610140922.12874.laz@club-burniston.co.uk>
References: <452819D5.3030408@huillard.net>	<200610092031.05389.stefan@lucke.in-berlin.de>	<45301E7F.9040509@huillard.net>
	<200610140922.12874.laz@club-burniston.co.uk>
Message-ID: <4530AF07.70400@huillard.net>

Laz a ?crit :
> On Saturday 14 October 2006 00:17, Nicolas Huillard wrote:
> 
>>When modprobing viafb, it report the following IRQ (dmesg):
>> viafb: irq handler installed, IRQ(0x200) = 80080c02
> 
> Here's what I see in dmesg:
> viafb: VIA UNICHROME framebuffer 1.0 initializing
> viafb: viafb : CC900000
> viafb: framebuffer size = 64 Mb
> viafb: Found Device Rev:0
> mtrr: MTRR 4 not used
> mtrr: 0xd8000000,0x4000000 overlaps existing 0xd8000000,0x800000
> viafb: X:720 Y:576
> viafb: detected VT1622A (7)
> viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
> viafb: VQ start:3FC0000  end:3FFFFFF  size:40000
> viafb: Cursor start:3FBF000  end:3FBFFFF  size:1000
> viafb: detected VT1622A (7)
> viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
> viafb: irq handler installed, IRQ(0x200) = 80080c02

Here is the diff with mine :
viafb: viafb : CEB00000
viafb: framebuffer size = 32 Mb
viafb: detected VT1622 (2), using TV3 tables
viafb: VQ start:1FC0000  end:1FFFFFF  size:40000
viafb: Cursor start:1FBF000  end:1FBFFFF  size:1000
viafb: detected VT1622 (2), using TV3 tables

32Mb buffer size should be enough (26 times the full 720x576x32 frame)

May it be a difference between TV encoder device (VT16xx), or actual
CLE266 revision ?

BTW, you have wrong MTRR stuff :
mtrr: MTRR 4 not used
mtrr: 0xd8000000,0x4000000 overlaps existing 0xd8000000,0x800000

> Did you try printing out viafb_wait_for_sync as Mark suggested to see if it 
> changes or not?

I still have to. Thanks for the reminder.

-- 
NH



From laz at club-burniston.co.uk  Sun Oct 15 00:20:24 2006
From: laz at club-burniston.co.uk (Laz)
Date: Sat, 14 Oct 2006 23:20:24 +0100
Subject: [Softdevice-devel] [directfb-users] viafb + cle266mpegdec +
	TVout : field parity status and patches [update]
In-Reply-To: <4530AF07.70400@huillard.net>
References: <452819D5.3030408@huillard.net>
	<200610140922.12874.laz@club-burniston.co.uk>
	<4530AF07.70400@huillard.net>
Message-ID: <200610142320.25615.laz@club-burniston.co.uk>

On Saturday 14 October 2006 10:33, Nicolas Huillard wrote:
> Laz a ?crit :
> > Here's what I see in dmesg:
> > viafb: VIA UNICHROME framebuffer 1.0 initializing
> > viafb: viafb : CC900000
> > viafb: framebuffer size = 64 Mb
> > viafb: Found Device Rev:0
> > mtrr: MTRR 4 not used
> > mtrr: 0xd8000000,0x4000000 overlaps existing 0xd8000000,0x800000
> > viafb: X:720 Y:576
> > viafb: detected VT1622A (7)
> > viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
> > viafb: VQ start:3FC0000  end:3FFFFFF  size:40000
> > viafb: Cursor start:3FBF000  end:3FBFFFF  size:1000
> > viafb: detected VT1622A (7)
> > viafb: mode=720  bpp=32  refresh=50  TVon=1  TVtype=2
> > viafb: irq handler installed, IRQ(0x200) = 80080c02
>
> Here is the diff with mine :
> viafb: viafb : CEB00000
> viafb: framebuffer size = 32 Mb
> viafb: detected VT1622 (2), using TV3 tables
> viafb: VQ start:1FC0000  end:1FFFFFF  size:40000
> viafb: Cursor start:1FBF000  end:1FBFFFF  size:1000
> viafb: detected VT1622 (2), using TV3 tables
>
> 32Mb buffer size should be enough (26 times the full 720x576x32 frame)

I can't remember why I set mine to 64 MB (I'm assuming this is a BIOS setting: 
not touched the BIOS in months!).

> May it be a difference between TV encoder device (VT16xx), or actual
> CLE266 revision ?

Mine is an Epia MII-12000. Running the find_revision.sh script from DirectFB 
gives me:
Your CLE266 revision number is 17.
To use this value, add the following line to /etc/directfbrc:
    unichrome-revision=17

In /etc/directfb I have:
mode=720x576
depth=32
pixelformat=ARGB
disable-module=lirc
disable-module=joystick
disable-module=cle266
no-vt
unichrome-revision=17

> BTW, you have wrong MTRR stuff :
> mtrr: MTRR 4 not used
> mtrr: 0xd8000000,0x4000000 overlaps existing 0xd8000000,0x800000

How do I fix that? I vaguely remember something a long while back about 
something to do with MTRR being broken because two of them overlapped. Not 
really delved too deeply because it works at the moment!

Cheers,

Laz


From admin at berlios.de  Mon Oct 16 20:54:28 2006
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 16 Oct 2006 10:54:28 -0800 (AKDT)
Subject: [Softdevice-devel] [Bug #9148] --disable-mmx broken
Message-ID: <200610161854.k9GIsSAN002766@unicorn.berlios.de>

Bug #9148, was updated on 2006-Oct-16 10:54
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: e-tobi
Assigned to : none
Summary: --disable-mmx broken

Details: When configuring with --disable-mmx some mmx-functions like mmx_unpack_15rgb() dont get an implementation but are still referenced by other functions.

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=9148&group_id=2051


From malcolm.caldwell at cdu.edu.au  Thu Oct 19 11:33:36 2006
From: malcolm.caldwell at cdu.edu.au (Malcolm Caldwell)
Date: Thu, 19 Oct 2006 19:03:36 +0930
Subject: [Softdevice-devel] softdevice and "Return to Live TV"
Message-ID: <1161250416.4973.4.camel@localhost.localdomain>

Hello,

Softplay has a small bug: although the menu lets you select the option
"Return to Live TV" this is never saved to setup.conf.  This one line
patch fixes this.


====================================================
diff -u -r1.1 Setup.c
--- Setup.c     12 Mar 2006 20:23:23 -0000      1.1
+++ Setup.c     19 Oct 2006 09:30:18 -0000
@@ -37,6 +37,7 @@
         plugin->SetupStore ("UseFileIndex", fileIndex);
        plugin->SetupStore ("LastBrowsedDir", lastDir);
        plugin->SetupStore ("openLastDir", openLastDir);
+       plugin->SetupStore ("ReturnToLiveTV", returnToLiveTV);
 };

 bool cSoftplaySetup::Parse( const char *Name, const char *Value) {





From torgeir at pobox.com  Thu Oct 19 13:48:28 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 19 Oct 2006 12:48:28 +0100
Subject: [Softdevice-devel] softdevice and "Return to Live TV"
In-Reply-To: <1161250416.4973.4.camel@localhost.localdomain>
References: <1161250416.4973.4.camel@localhost.localdomain>
Message-ID: <5E022152-8D3F-4929-9921-E89C882D6CE1@pobox.com>


On 19 Oct 2006, at 10:33, Malcolm Caldwell wrote:

> Hello,
>
> Softplay has a small bug: although the menu lets you select the option
> "Return to Live TV" this is never saved to setup.conf.  This one line
> patch fixes this.

There's a similar bug with deinterlace: on / off. I've been too lazy  
to track it down..

-- 
Torgeir Veimo
torgeir at pobox.com





From herbert at 13thfloor.at  Thu Oct 19 16:53:04 2006
From: herbert at 13thfloor.at (Herbert Poetzl)
Date: Thu, 19 Oct 2006 16:53:04 +0200
Subject: [Softdevice-devel] softdevice and "Return to Live TV"
In-Reply-To: <5E022152-8D3F-4929-9921-E89C882D6CE1@pobox.com>
References: <1161250416.4973.4.camel@localhost.localdomain>
	<5E022152-8D3F-4929-9921-E89C882D6CE1@pobox.com>
Message-ID: <20061019145304.GA23686@MAIL.13thfloor.at>

On Thu, Oct 19, 2006 at 12:48:28PM +0100, Torgeir Veimo wrote:
> 
> On 19 Oct 2006, at 10:33, Malcolm Caldwell wrote:
> 
> > Hello,
> >
> > Softplay has a small bug: although the menu lets you select the
> > option "Return to Live TV" this is never saved to setup.conf. This
> > one line patch fixes this.
> 
> There's a similar bug with deinterlace: on / off. I've been too lazy  
> to track it down..

as far as I can tell, any 'submenu' options are
not saved until you exit the main softdevice menu
'by changing something there' and pressing enter

i.e. if you want the deinterlace to be saved,
change a main option like the format to something
different and back, then exit with pressing ok

(at least that is what I observed)

and yes, I consider it a bug too :)

best,
Herbert

> -- 
> Torgeir Veimo
> torgeir at pobox.com
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel


From samuli at sorvakko.net  Thu Oct 19 23:50:21 2006
From: samuli at sorvakko.net (Samuli Sorvakko)
Date: Fri, 20 Oct 2006 00:50:21 +0300 (EEST)
Subject: [Softdevice-devel] Softdevice and vdr-plugin-mplayer
Message-ID: <Pine.LNX.4.44.0610200029180.3099-100000@polarfrost>


Hello.

I tried trawling through the archives but couldn't find anything too
relevan. Sorry for bothering if this issue has been discussed previously.
This message is being sent to the softdevice mailing list instead of the
mplayer plugin developers, as I have a feeling that the problem really
lies more withing softdevice than mplayer.

I have a peculiar problem trying to use Softdevice and the VDR Mplayer
plugin at the same time. The symptoms are as follows: (snip from ps -ax)

 7177 tty1     Tl     0:35 vdr ....
-P softdevice -vo xv:full -ao alsa:pcm=default#ac3=plug:spdif#
-Pmplayer --mplayer /usr/share/vdr-plugin-mplayer/mplayer .....
 7183 ?        S      0:00 [kdvb-fe-0]
 7229 tty1     T      0:00 /bin/bash /usr/share/vdr-plugin-mplayer/mplayer
/my/video/file.avi
 7269 tty1     T      0:00 /bin/bash /usr/share/vdr-plugin-mplayer/mplayer
/my/video/file.avi
 7270 tty1     T      0:00 /usr/bin/mplayer -identify -vo null -ao null
-frames 0 /my/video/file.avi
 7271 tty1     T      0:00 grep -i -e ^ID_

As can be seen, all interesting processes (vdr itself and all its child
processes) are in state T, i.e. stopped (or being traced, which should not
be the case here). The Mplayer script (and everything above/below it)
stops at this point:
TEMP1=`$MPLAYER -identify -vo null -ao null -frames 0 "$FILE" 2>/dev/null
| grep -i -e "^ID_"`

As can be seen, the processes are all stopped. Sending them SIGCONT (once
or thousands of times or everything in between) doesn't help.

Now here is where I think this issue is tied to softdevice: When I run the
mplayer script without the softdevice plugin (with dummy or stream
output), everything works fine. When I run mplayer with the same options
as the script runs outside VDR (with $DISPLAY set properly, of course)
everything again works fine (except that VDR is still running in the
background so I get a hit on CPU performance and two distinct audio
streams.. :) The only thing that gets hung is mplayer spawned from under
VDR with softdevice running. Softdevice synch settings (usleep, sig or
rtc) don't have any effect on this behavior.

You might of course inquire why I don't use Softplay. I do, and would
prefer that over mplayer - if it would play my files correctly.. I have
all kinds of synch problems with many DivX/Xvid files even though some
others play fine. This is of course understandable, as Softplay is still
in version 0.0.2... :)

So. If anybody has _any_ idea on how to start debugging this problem,
please respond.

Kind regards,
	Samuli

-- 
Samuli Sorvakko                 	<samuli at sorvakko.net>
Viherlaaksonranta 15B25,02710 Espoo, Finland     +358 440 942762
"vinkiksi; ei kande kuoria j?nnitteellisi? johtoja hampailla."
        -- Antti "Zapo" Maula, 14.5.2003



From malcolm.caldwell at cdu.edu.au  Fri Oct 20 01:21:32 2006
From: malcolm.caldwell at cdu.edu.au (Malcolm Caldwell)
Date: Fri, 20 Oct 2006 08:51:32 +0930
Subject: [Softdevice-devel] softdevice and "Return to Live TV"
In-Reply-To: <20061019145304.GA23686@MAIL.13thfloor.at>
References: <1161250416.4973.4.camel@localhost.localdomain>
	<5E022152-8D3F-4929-9921-E89C882D6CE1@pobox.com>
	<20061019145304.GA23686@MAIL.13thfloor.at>
Message-ID: <1161300092.3365.3.camel@localhost.localdomain>

On Thu, 2006-10-19 at 16:53 +0200, Herbert Poetzl wrote:
> On Thu, Oct 19, 2006 at 12:48:28PM +0100, Torgeir Veimo wrote:
> > 
> > On 19 Oct 2006, at 10:33, Malcolm Caldwell wrote:
> > 
> > > Hello,
> > >
> > > Softplay has a small bug: although the menu lets you select the
> > > option "Return to Live TV" this is never saved to setup.conf. This
> > > one line patch fixes this.
> > 
> > There's a similar bug with deinterlace: on / off. I've been too lazy  
> > to track it down..
> 
> as far as I can tell, any 'submenu' options are
> not saved until you exit the main softdevice menu
> 'by changing something there' and pressing enter

You don't have to 'change something there', you just have to press
enter.  The non-obvious bit is you must go past the first two submenu
selections so 'enter' accepts all the settings instead of opening the
submenu.

> 
> i.e. if you want the deinterlace to be saved,
> change a main option like the format to something
> different and back, then exit with pressing ok
> 
> (at least that is what I observed)
> 
> and yes, I consider it a bug too :)
> 
> best,
> Herbert
> 
> > -- 
> > Torgeir Veimo
> > torgeir at pobox.com
> > 
> > _______________________________________________
> > Softdevice-devel mailing list
> > Softdevice-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/softdevice-devel




From torgeir at pobox.com  Fri Oct 20 23:00:07 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 20 Oct 2006 22:00:07 +0100
Subject: [Softdevice-devel] hurry_up
Message-ID: <3FD5A2FF-7C41-462C-8691-56CB5F59FCE4@pobox.com>

I'm getting bad lipsync with mgatv output, I often see video lagging  
behind the audio by several frames.

It appears softdevice is good at speeding up (hurry_up) audio by  
duplicating video frames, but not the opposite..

-- 
Torgeir Veimo
torgeir at pobox.com





From juniper81 at gmail.com  Sat Oct 21 10:56:45 2006
From: juniper81 at gmail.com (Ari Koponen)
Date: Sat, 21 Oct 2006 11:56:45 +0300
Subject: [Softdevice-devel] hurry_up
In-Reply-To: <3FD5A2FF-7C41-462C-8691-56CB5F59FCE4@pobox.com>
References: <3FD5A2FF-7C41-462C-8691-56CB5F59FCE4@pobox.com>
Message-ID: <b7bb36410610210156r6b03a6f1p43887837bd08eaf3@mail.gmail.com>

On 10/21/06, Torgeir Veimo <torgeir at pobox.com> wrote:
> I'm getting bad lipsync with mgatv output, I often see video lagging
> behind the audio by several frames.

I confirm this! I've been struggling with this problem for quite long
time now. I've been thinking if it would be possible to do the syncing
without dropping/doubling video frames by altering the audio playback
somehow. This would perhaps also remove the annoying jerky playback
when switching channels.

Perhaps the optimal solution would be that both of the streams were
synced to the same to one master clock that is kept in sync with the
encoder clock by timestamps from the stream (STC ?) but I don't know
if it is possible in a PC. If I understood correctly, this is what
settopboxes do.

Video stream could in theory be synced by altering video timings
(frame rate?) but how does TV accept this and how could it be done in
practice by software? The audio stream could (again in theory) be
delayed/advanced by altering playback samplerate. But does ALSA allow
this ? If not, how about resampling the audio stream and playing with
a constant sample rate? Another question is if this would make the
audio too noisy.

--
Ari Koponen


From stefan at lucke.in-berlin.de  Wed Oct 25 19:29:07 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 25 Oct 2006 19:29:07 +0200
Subject: [Softdevice-devel] DVD menu problem with softdevice+dvd-plugin
In-Reply-To: <Pine.GSO.4.61.0610111928260.15903@vipunen.hut.fi>
References: <Pine.GSO.4.61.0610111928260.15903@vipunen.hut.fi>
Message-ID: <200610251929.07786.stefan@lucke.in-berlin.de>

On Mittwoch 11 Oktober 2006 18:39, Mikko Vartiainen wrote:
> 
> Hi
> 
> I have a problem with DVD menus. When using dvd menus, osd layer and the 
> picture layer aren't aligned, if there is any stretching involved.

I got that too, and the whole thing, scaling an OSD with a given still image from
a DVD is rather confusing. I did my tests with the following DVDs:
a: 2001 A Space Odyssey
b: Pearl Harbor

After playing around with this for a while I see there is much todo to get
this work correct. In my working version this works _only_ for software
OSD mixing.
I had to change vdr + several places in softdevice.

The main issues are:
- There is only one type of OSD
- We need at least 2 types
  - One OSD that scales to the available screen area
  - One OSD that scales to video area and to which the same scaling is
   applied as video ([sx,sy - sw,sh] -> [dx,dy - dw,dh]).

> 
> This is an old problem which was fixed back in January with Martin Wache's new 
> OSD. I think that the problem came back sometime when the new field based 
> scaling was introduced.

I don't think it's a issue with field based scaling.


-- 
Stefan Lucke


From jpahka at welho.com  Thu Nov  2 07:57:38 2006
From: jpahka at welho.com (Juha Pahkala)
Date: Thu, 02 Nov 2006 08:57:38 +0200
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
Message-ID: <454996E2.7030607@welho.com>

Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems 
to be an improvement, I'm not sure whether I'm imagining things but the 
picture does seem crispier on the primary head of my g400... although I 
also updated dfb so not sure who's to blame ;)

Anyhow, my sound (toslink to my amplifier) is gone. And it does seem to 
be a bug in softdevice since I can do:

aplay -D hw:0,0,3 ....

or

mplayer -ao alsa:device=hw=0.0.3 ...

and get sound, but with:

vdr .... '-P softdevice -vo dfb: -ao alsa:pcm=hw:0,0,3#' ...

I don't get sound. With the previous two my amplifier informs me of an 
incoming s/pdif signal with a message, but with softdevice, it doesn't.

The 'hw:0,0,3' is the optical output of my onboard via8237 chip, but the 
same happens if I replace it with the string 'spdif', this might even be 
the exact same thing.

Anybody else seeing this? Any ideas?

Thanks, juhis



From stefan at lucke.in-berlin.de  Thu Nov  2 12:14:34 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  2 Nov 2006 12:14:34 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <454996E2.7030607@welho.com>
References: <454996E2.7030607@welho.com>
Message-ID: <1162466073.4549d31a01a5c@webmail.in-berlin.de>

Quoting Juha Pahkala <jpahka at welho.com>:

> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
> to be an improvement, I'm not sure whether I'm imagining things but the
> picture does seem crispier on the primary head of my g400... although I
> also updated dfb so not sure who's to blame ;)

Can you try:
a. unmute main pcm with alsamixer, or
b. comment out line 15 of audio_alsa.c: #define NO_MIXER

>
> Anyhow, my sound (toslink to my amplifier) is gone. And it does seem to
> be a bug in softdevice since I can do:

Stefan Lucke


From t-erdmann at web.de  Thu Nov  2 12:50:10 2006
From: t-erdmann at web.de (thomas erdmann)
Date: Thu, 02 Nov 2006 12:50:10 +0100
Subject: [Softdevice-devel] Softdevice Performance with DVD Replay (XV out)
Message-ID: <684330294@web.de>

Hello List,
i use the softdevice from CVS configured for xv output on an i845 chip set.
I have a FF card and a budget and can switch my VDR output 
either to RGB at the FF card or to DVI with softdevice for direct comparison.
Normal live and recorded video streams from Astra are displayed very good with softdevice.
But playing DVD via the DVD or DVDselect plugin gives only an instable frame,
perhaps low as 10 to 25 pictures/s.
I tested output to X11 Window also as full screen, both don't reach normal frame rate.
Playing DVD with my FF card in the same system gives normal performance.
The CPU is a P4 at 2400MHz so that should be enough for this i think,
in the Wiki 1000MHz are recommended.

Has anyone tested DVD replay ore some hints to improve the performance ?

Thanks
  Thomas

_______________________________________________________________________
Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222



From jpahka at welho.com  Thu Nov  2 16:40:49 2006
From: jpahka at welho.com (Juha Pahkala)
Date: Thu, 02 Nov 2006 17:40:49 +0200
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <1162466073.4549d31a01a5c@webmail.in-berlin.de>
References: <454996E2.7030607@welho.com>
	<1162466073.4549d31a01a5c@webmail.in-berlin.de>
Message-ID: <454A1181.8070905@welho.com>

Stefan Lucke wrote:
> Quoting Juha Pahkala <jpahka at welho.com>:
>
>   
>> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
>> to be an improvement, I'm not sure whether I'm imagining things but the
>> picture does seem crispier on the primary head of my g400... although I
>> also updated dfb so not sure who's to blame ;)
>>     
>
> Can you try:
> a. unmute main pcm with alsamixer, or
> b. comment out line 15 of audio_alsa.c: #define NO_MIXER
>   

Hi Stefan,

Option A didn't make a difference but commenting out the NO_MIXER define
fixed the problem! So thank you for your help (as well as softdevice in
general ;)

In the following webpage:

http://alsa.opensrc.org/via8233

there's the following text:

"If the playback device indicates a link is present, but makes no sound,
check the mixer 'IEC958 Playback AC97-SPSA'. The S/PDIF always outputs
at full volume - even muting the master or PCM mixers does not affect
the S/PDIF volume..."

Well, don't know if that means anything, but I think that the master PCM
doesn't do anything for this chip....

Thanks again, juhis


From M.Wache at gmx.net  Thu Nov  2 20:07:58 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 02 Nov 2006 20:07:58 +0100
Subject: [Softdevice-devel] softdevice and "Return to Live TV"
In-Reply-To: <1161250416.4973.4.camel@localhost.localdomain>
References: <1161250416.4973.4.camel@localhost.localdomain>
Message-ID: <454A420E.1000409@gmx.net>

Malcolm Caldwell schrieb:
> Hello,
> 
> Softplay has a small bug: although the menu lets you select the option
> "Return to Live TV" this is never saved to setup.conf.  This one line
> patch fixes this.
> 

Thank you for the patch, I applied it to the cvs.

Bye,
Martin



From M.Wache at gmx.net  Thu Nov  2 20:18:47 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 02 Nov 2006 20:18:47 +0100
Subject: [Softdevice-devel] Remove support for older vdr versions
In-Reply-To: <200610092051.37167.stefan@lucke.in-berlin.de>
References: <200610092051.37167.stefan@lucke.in-berlin.de>
Message-ID: <454A4497.4050005@gmx.net>

Stefan Lucke schrieb:
> Hi,
> 
> if noone vetos, I'd like to remove support for vdr versions earlier than 1.3.7 .
> 
> 
I would have suggested this too :-)

I have a patch which (partially, no currently there is no osd)
implements the possibility to take screenshots with the softdevice, it
requires vdr > 1.3.38 and I'm to lazy/(busy with other things) to
implement it too for older vdr versions.

So what about dropping support for all vdr version prior to vdr-1.4.0?
There are still a lot #ifdefs we could get rid of... They are not as bad
as the ones for the osd (vdr-1.3.7), but on the other hand I guess as
soon as the new development version of vdr turn up we will have to
introduce new #ifdefs. I think it would be nice to have a clean start ;-)

Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Nov  2 21:02:23 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  2 Nov 2006 21:02:23 +0100
Subject: [Softdevice-devel] Remove support for older vdr versions
In-Reply-To: <454A4497.4050005@gmx.net>
References: <200610092051.37167.stefan@lucke.in-berlin.de>
	<454A4497.4050005@gmx.net>
Message-ID: <1162497743.454a4ecf7ab7b@webmail.in-berlin.de>

Quoting Martin Wache:

> Stefan Lucke schrieb:
> > Hi,
> >
> > if noone vetos, I'd like to remove support for vdr versions earlier than 1.3.7 .
> >
> >
> I would have suggested this too :-)
>
> I have a patch which (partially, no currently there is no osd)
> implements the possibility to take screenshots with the softdevice, it
> requires vdr > 1.3.38 and I'm to lazy/(busy with other things) to
> implement it too for older vdr versions.

Nice feature. But can that new feature be delayed for a few of days ?
An additional #if for vdr > 1.3.38 should be ok :-) .

My internal release plan is to fix two things:
a. fix the alsa mixer issue
b. fix the xv-out crash, reported at vdr list,
c. make a bugfix 0.3.1 release,
d. drop support for vdr versions <= 1.3.7 .

>
> So what about dropping support for all vdr version prior to vdr-1.4.0?

I had a similar idea, but now to my opinion that should be delayed to
start of the new development session of vdr 1.5.x .

> There are still a lot #ifdefs we could get rid of... They are not as bad
> as the ones for the osd (vdr-1.3.7), but on the other hand I guess as
> soon as the new development version of vdr turn up we will have to
> introduce new #ifdefs. I think it would be nice to have a clean start ;-)


Stefan Lucke


From stefan at lucke.in-berlin.de  Fri Nov  3 23:37:10 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 3 Nov 2006 23:37:10 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <454A1181.8070905@welho.com>
References: <454996E2.7030607@welho.com>
	<1162466073.4549d31a01a5c@webmail.in-berlin.de>
	<454A1181.8070905@welho.com>
Message-ID: <200611032337.11008.stefan@lucke.in-berlin.de>

On Donnerstag 02 November 2006 16:40, Juha Pahkala wrote:
> Stefan Lucke wrote:
> > Quoting Juha Pahkala <jpahka at welho.com>:
> >
> >   
> >> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
> >> to be an improvement, I'm not sure whether I'm imagining things but the
> >> picture does seem crispier on the primary head of my g400... although I
> >> also updated dfb so not sure who's to blame ;)
> >>     
> >
> > Can you try:
> > a. unmute main pcm with alsamixer, or
> > b. comment out line 15 of audio_alsa.c: #define NO_MIXER
> >   
> 
> Hi Stefan,
> 
> Option A didn't make a difference but commenting out the NO_MIXER define
> fixed the problem! So thank you for your help (as well as softdevice in
> general ;)

Can you try the following patch which makes use of alsa mixer 
selectable via OSD ?


-- 
Stefan Lucke
-------------- next part --------------
Index: audio-alsa.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/audio-alsa.c,v
retrieving revision 1.2
diff -U3 -r1.2 audio-alsa.c
--- audio-alsa.c	25 Jul 2006 19:45:37 -0000	1.2
+++ audio-alsa.c	3 Nov 2006 22:31:46 -0000
@@ -12,7 +12,6 @@
 #include <alsa/asoundlib.h>
 
 #define PCM_FMT SND_PCM_FORMAT_S16_LE
-#define NO_MIXER
 
 //#define AUDIODEB(out...) {printf("AUDIO-ALSA[%04d]:",(int)(getTimeMilis() % 10000));printf(out);}
 
@@ -50,6 +49,7 @@
     oldContext.samplerate = currContext.samplerate=48000;
     dsyslog("[softdevice-audio] Device opened! Ready to play");
     scale_Factor=0x7FFF;
+    this->setupStore = setupStore;
 }
 
 /* ----------------------------------------------------------------------------
@@ -80,14 +80,14 @@
              device, snd_strerror(err));
      return false;
    }
-   //force setting of the parameters after resume 
+   //force setting of the parameters after resume
    currContext.channels=0;
    return true;
 };
 
 /* ----------------------------------------------------------------------------
  */
-  
+
 void cAlsaAudioOut::Write(uchar *Data, int Length)
 {
     int     err;
@@ -111,10 +111,9 @@
   else
     size = Length/(2*currContext.channels);
 
-#ifdef NO_MIXER
-  // change the volume
-  Scale((int16_t*)Data,Length/2,scale_Factor);
-#endif
+  // change the volume without mixer
+  if (!setupStore->useMixer)
+    Scale((int16_t*)Data,Length/2,scale_Factor);
 
   while (size) {
     while (paused) usleep(1000); // block
@@ -225,7 +224,7 @@
           handleMutex.Unlock();
           return 0;
   };
-          
+
   if (!snd_pcm_delay(handle, &r) &&
       currContext.samplerate) {
     // successfully got delay
@@ -278,12 +277,12 @@
     };
     //printf("alsa-audio: SetParams\n");
     currContext=context;
- 
+
     handleMutex.Lock();
-    
-    if (handle) 
+
+    if (handle)
             snd_pcm_close(handle);
-    
+
     if ((err = snd_pcm_open(&handle,
                             device,
                             SND_PCM_STREAM_PLAYBACK, 0)) < 0) {
@@ -410,56 +409,58 @@
  */
 void cAlsaAudioOut::SetVolume (int vol)
 {
-#ifdef NO_MIXER
-  scale_Factor = CalcScaleFactor(vol);
-  //printf("vol %d scale_Factor 0x%04x\n",vol,scale_Factor);
-  //scale_Factor = vol;
-#else
-    int                   err;
-    long                  mixerMin, mixerMax,
-                          setVol;
-    double                mixerRange,
-                          volPercent;
-    char                  *mName = "PCM",
-                          *cardName = "default";
-    snd_mixer_t           *mHandle;
-    snd_mixer_elem_t      *mElem;
-    snd_mixer_selem_id_t  *sId;
-
-  snd_mixer_selem_id_alloca(&sId);
-  snd_mixer_selem_id_set_name(sId, mName);
-  if ((err = snd_mixer_open(&mHandle, 0)) < 0) {
-      static int once = 0;
-    if (!once) {
-      dsyslog("[softdevice-audio]: cannot open mixer: %s (%s)",
-              mName,snd_strerror(err));
-      once = 1;
+  if (!setupStore->useMixer) {
+    scale_Factor = CalcScaleFactor(vol);
+    //printf("vol %d scale_Factor 0x%04x\n",vol,scale_Factor);
+    //scale_Factor = vol;
+  } else {
+      int                   err;
+      long                  mixerMin, mixerMax,
+                            setVol;
+      double                mixerRange,
+                            volPercent;
+      char                  *mName = "PCM",
+                            *cardName = "default";
+      snd_mixer_t           *mHandle;
+      snd_mixer_elem_t      *mElem;
+      snd_mixer_selem_id_t  *sId;
+
+    snd_mixer_selem_id_alloca(&sId);
+    snd_mixer_selem_id_set_name(sId, mName);
+    if ((err = snd_mixer_open(&mHandle, 0)) < 0) {
+        static int once = 0;
+      if (!once) {
+        dsyslog("[softdevice-audio]: cannot open mixer: %s (%s)",
+                mName,snd_strerror(err));
+        once = 1;
+      }
+      return;
     }
-    return;
-  }
 
-  snd_mixer_attach(mHandle, cardName);
-  snd_mixer_selem_register(mHandle, NULL, NULL);
-  snd_mixer_load(mHandle);
-  mElem = snd_mixer_find_selem(mHandle,sId);
-  /* --------------------------------------------------------------------------
-   * some cards don't have any master volume. so check return value
-   */
-  if (mElem)
-  {
-    snd_mixer_selem_get_playback_volume_range(mElem,&mixerMin,&mixerMax);
-    mixerRange = mixerMax - mixerMin;
-    volPercent = (double) vol / 255.0;
-    setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
-    snd_mixer_selem_set_playback_volume(mElem,SND_MIXER_SCHN_FRONT_LEFT,setVol);
-    snd_mixer_selem_set_playback_volume(mElem,SND_MIXER_SCHN_FRONT_RIGHT,setVol);
-    if (snd_mixer_selem_has_playback_switch(mElem))
-    {
-      snd_mixer_selem_set_playback_switch_all(mElem, (vol) ? 1 : 0);
+    snd_mixer_attach(mHandle, cardName);
+    snd_mixer_selem_register(mHandle, NULL, NULL);
+    snd_mixer_load(mHandle);
+    mElem = snd_mixer_find_selem(mHandle,sId);
+    /* ------------------------------------------------------------------------
+     * some cards don't have any master volume. so check return value
+     */
+    if (mElem) {
+      snd_mixer_selem_get_playback_volume_range(mElem,&mixerMin,&mixerMax);
+      mixerRange = mixerMax - mixerMin;
+      volPercent = (double) vol / 255.0;
+      setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
+      snd_mixer_selem_set_playback_volume(mElem,
+                                          SND_MIXER_SCHN_FRONT_LEFT,
+                                          setVol);
+      snd_mixer_selem_set_playback_volume(mElem,
+                                          SND_MIXER_SCHN_FRONT_RIGHT,
+                                          setVol);
+      if (snd_mixer_selem_has_playback_switch(mElem)) {
+        snd_mixer_selem_set_playback_switch_all(mElem, (vol) ? 1 : 0);
+      }
     }
-  }
 
-  snd_mixer_close(mHandle);
-#endif
+    snd_mixer_close(mHandle);
+  }
 }
 
Index: audio-alsa.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/audio-alsa.h,v
retrieving revision 1.1
diff -U3 -r1.1 audio-alsa.h
--- audio-alsa.h	10 Jul 2006 19:40:25 -0000	1.1
+++ audio-alsa.h	3 Nov 2006 22:31:46 -0000
@@ -29,6 +29,7 @@
                     ac3SpdifPro;
   SampleContext     oldContext;
   cAlsaAC3pt        ac3pt;
+  cSetupStore       *setupStore;
 
   bool  SetAC3PassThroughMode(bool on);
   void  Xrun(void);
@@ -52,4 +53,4 @@
 };
 
 
-#endif 
+#endif
Index: setup-softdevice-menu.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/setup-softdevice-menu.c,v
retrieving revision 1.8
diff -U3 -r1.8 setup-softdevice-menu.c
--- setup-softdevice-menu.c	9 Sep 2006 10:35:37 -0000	1.8
+++ setup-softdevice-menu.c	3 Nov 2006 22:31:47 -0000
@@ -352,6 +352,9 @@
                             (SETUP_AC3MODENAMES-1),
                             ac3ModeNames));
 
+  Add(new cMenuEditBoolItem(tr("Volume via H/W Mixer"),
+                            &data->useMixer, tr("no"), tr("yes")));
+
   Add(new cMenuEditStraItem(tr("Sync Mode"),
                             &data->syncTimerMode,
                             (SETUP_SYNC_TIMER_NAMES-1),
@@ -462,6 +465,7 @@
   SetupStore ("Suspend",            setupStore.shouldSuspend);
   SetupStore ("OSDalphablend",      setupStore.osdMode);
   SetupStore ("AC3Mode",            setupStore.ac3Mode);
+  SetupStore ("UseMixer",             setupStore.useMixer);
   SetupStore ("bufferMode",           setupStore.bufferMode);
   SetupStore ("mainMenu",             setupStore.mainMenu);
   SetupStore ("syncTimerMode",        setupStore.syncTimerMode);
Index: setup-softdevice.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/setup-softdevice.c,v
retrieving revision 1.46
diff -U3 -r1.46 setup-softdevice.c
--- setup-softdevice.c	25 Jul 2006 19:58:12 -0000	1.46
+++ setup-softdevice.c	3 Nov 2006 22:31:48 -0000
@@ -109,6 +109,7 @@
   avOffset      = 0;
   shouldSuspend = 0;
   ac3Mode       = 0;
+  useMixer      = 0;
   useMGAtv      = 0;
   viaTv         = 0;
   cle266HWdecode  = 0;
@@ -346,6 +347,10 @@
     ac3Mode = atoi (Value);
     fprintf(stderr, "[setup-softdevice] alsa ac3Mode set to: %d\n", ac3Mode);
     ac3Mode = clamp (0, ac3Mode, 3);
+  } else if (!strcasecmp(Name, "UseMixer")) {
+    useMixer = atoi (Value);
+    useMixer = clamp (0, useMixer, 1);
+    fprintf(stderr, "[setup-softdevice] alsa useMixer set to: %d\n", useMixer);
   } else if (!strcasecmp(Name, "AlsaAC3Device") && strlen(alsaAC3Device) == 0) {
     strncpy(alsaAC3Device, Value, ALSA_DEVICE_NAME_LENGTH);
     alsaAC3Device [ALSA_DEVICE_NAME_LENGTH-1] = 0;
Index: setup-softdevice.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/setup-softdevice.h,v
retrieving revision 1.34
diff -U3 -r1.34 setup-softdevice.h
--- setup-softdevice.h	9 Sep 2006 10:35:37 -0000	1.34
+++ setup-softdevice.h	3 Nov 2006 22:31:49 -0000
@@ -158,6 +158,7 @@
     int   shouldSuspend;
     int   osdMode;
     int   ac3Mode;
+    int   useMixer;
     int   bufferMode;
     int   mainMenu;
     int   syncTimerMode;

From M.Wache at gmx.net  Sat Nov  4 13:37:30 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Nov 2006 13:37:30 +0100
Subject: [Softdevice-devel] Remove support for older vdr versions
In-Reply-To: <1162497743.454a4ecf7ab7b@webmail.in-berlin.de>
References: <200610092051.37167.stefan@lucke.in-berlin.de>	<454A4497.4050005@gmx.net>
	<1162497743.454a4ecf7ab7b@webmail.in-berlin.de>
Message-ID: <454C898A.8090507@gmx.net>

Stefan Lucke schrieb:
> Quoting Martin Wache:
> 
>> Stefan Lucke schrieb:
>>> Hi,
>>>
>>> if noone vetos, I'd like to remove support for vdr versions earlier than 1.3.7 .
>>>
>>>
>> I would have suggested this too :-)
>>
>> I have a patch which (partially, no currently there is no osd)
>> implements the possibility to take screenshots with the softdevice, it
>> requires vdr > 1.3.38 and I'm to lazy/(busy with other things) to
>> implement it too for older vdr versions.
> 
> Nice feature. But can that new feature be delayed for a few of days ?

Sure, no problem.

Martin


From M.Wache at gmx.net  Sat Nov  4 13:56:17 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Nov 2006 13:56:17 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <200611032337.11008.stefan@lucke.in-berlin.de>
References: <454996E2.7030607@welho.com>	<1162466073.4549d31a01a5c@webmail.in-berlin.de>	<454A1181.8070905@welho.com>
	<200611032337.11008.stefan@lucke.in-berlin.de>
Message-ID: <454C8DF1.3000707@gmx.net>

Stefan Lucke schrieb:
> On Donnerstag 02 November 2006 16:40, Juha Pahkala wrote:
>> Stefan Lucke wrote:
>>> Quoting Juha Pahkala <jpahka at welho.com>:
>>>
>>>   
>>>> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
>>>> to be an improvement, I'm not sure whether I'm imagining things but the
>>>> picture does seem crispier on the primary head of my g400... although I
>>>> also updated dfb so not sure who's to blame ;)
>>>>     
>>> Can you try:
>>> a. unmute main pcm with alsamixer, or
>>> b. comment out line 15 of audio_alsa.c: #define NO_MIXER
>>>   
>> Hi Stefan,
>>
>> Option A didn't make a difference but commenting out the NO_MIXER define
>> fixed the problem! So thank you for your help (as well as softdevice in
>> general ;)
> 
> Can you try the following patch which makes use of alsa mixer 
> selectable via OSD ?
> 
I fear some strange effects if one switches the use of alsa mixer via
the osd. Consider the following, the volume of vdr is at some low
position, the alsa mixer is in high volume position. One switches from
no mixer to mixer. The audio wont be scaled any more so the volume goes
dramatically up, since the alsa mixer is still in a high volume
position. Now one changes the volume of the vdr by one step, the volume
will jump to a low volume again, because the alsa mixer will go down to
a low volume. If one now switches back to no alsa mixer option, the
volume will instantly go down even more, since now the audio is scaled
(or something else, scale_Factor is unset)...

Some of those problems can surely be fixed, but that will make it more
complicated. If one has to be able to select to use the alsa mixer I
would prefer a command line option.

But maybe you can explain me what actually the problem is? Of course if
the AC3 data would be scaled, that would make the useless, but as far as
I see, that is not the case. So the is the problem the alsa mixer setting?

Bye,
Martin



From stefan at lucke.in-berlin.de  Sat Nov  4 15:17:30 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 4 Nov 2006 15:17:30 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <454C8DF1.3000707@gmx.net>
References: <454996E2.7030607@welho.com>
	<200611032337.11008.stefan@lucke.in-berlin.de>
	<454C8DF1.3000707@gmx.net>
Message-ID: <200611041517.30492.stefan@lucke.in-berlin.de>

On Samstag 04 November 2006 13:56, Martin Wache wrote:
> Stefan Lucke schrieb:
> > On Donnerstag 02 November 2006 16:40, Juha Pahkala wrote:
> >> Stefan Lucke wrote:
> >>> Quoting Juha Pahkala <jpahka at welho.com>:
> >>>
> >>>   
> >>>> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
> >>>> to be an improvement, I'm not sure whether I'm imagining things but the
> >>>> picture does seem crispier on the primary head of my g400... although I
> >>>> also updated dfb so not sure who's to blame ;)
> >>>>     
> >>> Can you try:
> >>> a. unmute main pcm with alsamixer, or
> >>> b. comment out line 15 of audio_alsa.c: #define NO_MIXER
> >>>   
> >> Hi Stefan,
> >>
> >> Option A didn't make a difference but commenting out the NO_MIXER define
> >> fixed the problem! So thank you for your help (as well as softdevice in
> >> general ;)
> > 
> > Can you try the following patch which makes use of alsa mixer 
> > selectable via OSD ?
> > 
> I fear some strange effects if one switches the use of alsa mixer via
> the osd. Consider the following, the volume of vdr is at some low
> position, the alsa mixer is in high volume position. One switches from
> no mixer to mixer. The audio wont be scaled any more so the volume goes
> dramatically up, since the alsa mixer is still in a high volume
> position.

Yes I'm aware of this, but this problem already exists. Think of
an external amplifier connected via S/P-DIF. Volume is set to low position
and controlled by either alsa mixer or software scaler. Then consider
a switch to an AC3 station, for which volume control is done by
external AC3 decoder/amplifier  only. User and his/her neighbours will
notice a volume difference too.

> Now one changes the volume of the vdr by one step, the volume 
> will jump to a low volume again, because the alsa mixer will go down to
> a low volume. If one now switches back to no alsa mixer option, the
> volume will instantly go down even more, since now the audio is scaled
> (or something else, scale_Factor is unset)...
> 
> Some of those problems can surely be fixed, but that will make it more
> complicated. If one has to be able to select to use the alsa mixer I
> would prefer a command line option.

A command line option has the disadvantage, that the calling script has
to be edited. In a vdr only setup, a normal user has no chance to do this.

> 
> But maybe you can explain me what actually the problem is? Of course if
> the AC3 data would be scaled, that would make the useless, but as far as
> I see, that is not the case. So the is the problem the alsa mixer setting?

Yes the problem is the mixer settings. on my other test box I noticed the situation
too, but I could fix it by alsamixer and unmuting main + pcm mixer and give them
a reasonable volume level than default.

So there a many ways to control volume:
a. external amplifier (S/P-DIF)
b. external amplifier (via line out)
c. PC-Speaker

Things to be controlled by vdr / PC
a. alsa master volume + mute
b. alsa PCM mixer volume + mute
c. alsa line out  + S/P-DIF out (mute ?)
d. alsa output switches (s short summary from my setup)
   - IEC958 5V, Copyright, In Monitor, Loop, ..
   - Line-In Mode: Line-In, Rear Output, Bass output
   - Mic-In Mode: Mic-in, Center/LFE Output, 

Controlling alsa in total, is enough for separate plugin I guess.

-- 
Stefan Lucke


From mimakine at cc.hut.fi  Sat Nov  4 15:32:21 2006
From: mimakine at cc.hut.fi (=?ISO-8859-1?Q?Mikko_M=E4kinen?=)
Date: Sat, 04 Nov 2006 16:32:21 +0200
Subject: [Softdevice-devel] Any plans on improving deinterlacing?
Message-ID: <454CA475.6040305@cc.hut.fi>

Hi,

are there any plans on improving the deinterlace-feature of softdevice? 
I mean like "integrating" for example TomsMoComp or Greedy2Frame 
deinterlacers... Or is this even easily possible?

br,
  Mikko



From M.Wache at gmx.net  Sat Nov  4 18:36:01 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Nov 2006 18:36:01 +0100
Subject: [Softdevice-devel] Any plans on improving deinterlacing?
In-Reply-To: <454CA475.6040305@cc.hut.fi>
References: <454CA475.6040305@cc.hut.fi>
Message-ID: <454CCF81.1070401@gmx.net>

Mikko M?kinen schrieb:
> Hi,
> 
> are there any plans on improving the deinterlace-feature of softdevice? 
> I mean like "integrating" for example TomsMoComp or Greedy2Frame 
> deinterlacers... Or is this even easily possible?
> 

In fact I tried a lot of different deinterlacing algorithms for the
softdevice, and I still have the code lying around...

I read a lot about the quality of TomsMoComp, but when I tried it with
xine, it mainly produced a lot of noise and left some interlacing
artifacts on my test clips. Maybe I didn't get the parameters right...
Can someone tell me which options I have to use to get less noise?

Integrating TomsMoComp into the softdevice is for me not an option. I
checked it once, but it seems that tvtime uses the windows dlls and xine
uses tvtime, so there is no linux port of the deinterlacers. Also the
deinterlacer works on the yuy pixelformat, so that we would have to do
format conversion.

If someone wants to try and experiment with the deinterlacers I wrote, I
can send a patch. But currently most options are only changeable by
changing the code, so some C skills are necessary to see all the
features. Currently I have an equivalent to Greedy2Frame, and two more
advanced deinterlacers one detects motion, and the other detects
interlacing effects to know where to deinterlace. The actual
deinterlacing can be done by several algorithms, one smoothing
deinterlacer, a sharpening and one edge detecting (a bit like TomsMoComp
or GreedyH) and others.

Bye,
Martin

Bye,
Martin


From M.Wache at gmx.net  Sat Nov  4 19:00:18 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Nov 2006 19:00:18 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <200611041517.30492.stefan@lucke.in-berlin.de>
References: <454996E2.7030607@welho.com>	<200611032337.11008.stefan@lucke.in-berlin.de>	<454C8DF1.3000707@gmx.net>
	<200611041517.30492.stefan@lucke.in-berlin.de>
Message-ID: <454CD532.90205@gmx.net>

Stefan Lucke schrieb:
> On Samstag 04 November 2006 13:56, Martin Wache wrote:
>> Stefan Lucke schrieb:
>>> On Donnerstag 02 November 2006 16:40, Juha Pahkala wrote:
>>>> Stefan Lucke wrote:
>>>>> Quoting Juha Pahkala <jpahka at welho.com>:
>>>>>
>>>>>   
>>>>>> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
>>>>>> to be an improvement, I'm not sure whether I'm imagining things but the
>>>>>> picture does seem crispier on the primary head of my g400... although I
>>>>>> also updated dfb so not sure who's to blame ;)
>>>>>>     
>>>>> Can you try:
>>>>> a. unmute main pcm with alsamixer, or
>>>>> b. comment out line 15 of audio_alsa.c: #define NO_MIXER
>>>>>   
>>>> Hi Stefan,
>>>>
>>>> Option A didn't make a difference but commenting out the NO_MIXER define
>>>> fixed the problem! So thank you for your help (as well as softdevice in
>>>> general ;)
>>> Can you try the following patch which makes use of alsa mixer 
>>> selectable via OSD ?
>>>
>> I fear some strange effects if one switches the use of alsa mixer via
>> the osd. Consider the following, the volume of vdr is at some low
>> position, the alsa mixer is in high volume position. One switches from
>> no mixer to mixer. The audio wont be scaled any more so the volume goes
>> dramatically up, since the alsa mixer is still in a high volume
>> position.
> 
> Yes I'm aware of this, but this problem already exists. Think of
> an external amplifier connected via S/P-DIF. Volume is set to low position
> and controlled by either alsa mixer or software scaler. Then consider
> a switch to an AC3 station, for which volume control is done by
> external AC3 decoder/amplifier  only. User and his/her neighbours will
> notice a volume difference too.
>
Well, the softdevice (just like the FF cards) can not change the volume
of an AC3 stream, we cannot change that. But that doesn't mean that we
have to introduce more traps which could hurt the ears of users even if
they don't use AC3 equipment ;-).
And I guess anyone who has AC3 equipment connect anyway only uses the
external amplifier to change the volume, this is the only sensible option.

>> Now one changes the volume of the vdr by one step, the volume 
>> will jump to a low volume again, because the alsa mixer will go down to
>> a low volume. If one now switches back to no alsa mixer option, the
>> volume will instantly go down even more, since now the audio is scaled
>> (or something else, scale_Factor is unset)...
>>
>> Some of those problems can surely be fixed, but that will make it more
>> complicated. If one has to be able to select to use the alsa mixer I
>> would prefer a command line option.
> 
> A command line option has the disadvantage, that the calling script has
> to be edited. In a vdr only setup, a normal user has no chance to do this.
> 
Oh, come on. Connecting AC3 equipment is not something a normal user
does every day, and during installation of the softdevice the command
line has to be setup anyway.

>> But maybe you can explain me what actually the problem is? Of course if
>> the AC3 data would be scaled, that would make the useless, but as far as
>> I see, that is not the case. So the is the problem the alsa mixer setting?
> 
> Yes the problem is the mixer settings. on my other test box I noticed the situation
> too, but I could fix it by alsamixer and unmuting main + pcm mixer and give them
> a reasonable volume level than default.
> 
> So there a many ways to control volume:
> a. external amplifier (S/P-DIF)
> b. external amplifier (via line out)
> c. PC-Speaker
> 
> Things to be controlled by vdr / PC
> a. alsa master volume + mute
> b. alsa PCM mixer volume + mute
> c. alsa line out  + S/P-DIF out (mute ?)
> d. alsa output switches (s short summary from my setup)
>    - IEC958 5V, Copyright, In Monitor, Loop, ..
>    - Line-In Mode: Line-In, Rear Output, Bass output
>    - Mic-In Mode: Mic-in, Center/LFE Output, 
> 
> Controlling alsa in total, is enough for separate plugin I guess.
> 

There is the AVolCtl-plugin ;-)
As you said, we can not control everything... If I understand that
correctly AC3 passthrough works with NO_MIXER defined and with the
correct alsa-mixer settings at the start of the softdevice?
Maybe it is time for a FAQ, and we put all this in the FAQ.

Bye,
Martin


From stefan at lucke.in-berlin.de  Sat Nov  4 23:01:00 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 4 Nov 2006 23:01:00 +0100
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <454CD532.90205@gmx.net>
References: <454996E2.7030607@welho.com>
	<200611041517.30492.stefan@lucke.in-berlin.de>
	<454CD532.90205@gmx.net>
Message-ID: <200611042301.00581.stefan@lucke.in-berlin.de>

On Samstag 04 November 2006 19:00, Martin Wache wrote:
> Stefan Lucke schrieb:
> > On Samstag 04 November 2006 13:56, Martin Wache wrote:
> >> Stefan Lucke schrieb:
> >>> On Donnerstag 02 November 2006 16:40, Juha Pahkala wrote:
> >>>> Stefan Lucke wrote:
> >>>>> Quoting Juha Pahkala <jpahka at welho.com>:
> >>>>>
> >>>>>   
> >>>>>> Just updated my softdevice from 0.2.2 to 0.3.0. Picture-wise, it seems
> >>>>>> to be an improvement, I'm not sure whether I'm imagining things but the
> >>>>>> picture does seem crispier on the primary head of my g400... although I
> >>>>>> also updated dfb so not sure who's to blame ;)
> >>>>>>     
> >>>>> Can you try:
> >>>>> a. unmute main pcm with alsamixer, or
> >>>>> b. comment out line 15 of audio_alsa.c: #define NO_MIXER
> >>>>>   
> >>>> Hi Stefan,
> >>>>
> >>>> Option A didn't make a difference but commenting out the NO_MIXER define
> >>>> fixed the problem! So thank you for your help (as well as softdevice in
> >>>> general ;)
> >>> Can you try the following patch which makes use of alsa mixer 
> >>> selectable via OSD ?
> >>>
> >> I fear some strange effects if one switches the use of alsa mixer via
> >> the osd. Consider the following, the volume of vdr is at some low
> >> position, the alsa mixer is in high volume position. One switches from
> >> no mixer to mixer. The audio wont be scaled any more so the volume goes
> >> dramatically up, since the alsa mixer is still in a high volume
> >> position.
> > 
> > Yes I'm aware of this, but this problem already exists. Think of
> > an external amplifier connected via S/P-DIF. Volume is set to low position
> > and controlled by either alsa mixer or software scaler. Then consider
> > a switch to an AC3 station, for which volume control is done by
> > external AC3 decoder/amplifier  only. User and his/her neighbours will
> > notice a volume difference too.
> >
> Well, the softdevice (just like the FF cards) can not change the volume
> of an AC3 stream, we cannot change that. But that doesn't mean that we
> have to introduce more traps which could hurt the ears of users even if
> they don't use AC3 equipment ;-).
> And I guess anyone who has AC3 equipment connect anyway only uses the
> external amplifier to change the volume, this is the only sensible option.
> 
> >> Now one changes the volume of the vdr by one step, the volume 
> >> will jump to a low volume again, because the alsa mixer will go down to
> >> a low volume. If one now switches back to no alsa mixer option, the
> >> volume will instantly go down even more, since now the audio is scaled
> >> (or something else, scale_Factor is unset)...
> >>
> >> Some of those problems can surely be fixed, but that will make it more
> >> complicated. If one has to be able to select to use the alsa mixer I
> >> would prefer a command line option.
> > 
> > A command line option has the disadvantage, that the calling script has
> > to be edited. In a vdr only setup, a normal user has no chance to do this.
> > 
> Oh, come on. Connecting AC3 equipment is not something a normal user
> does every day, and during installation of the softdevice the command
> line has to be setup anyway.
> 
> >> But maybe you can explain me what actually the problem is? Of course if
> >> the AC3 data would be scaled, that would make the useless, but as far as
> >> I see, that is not the case. So the is the problem the alsa mixer setting?
> > 
> > Yes the problem is the mixer settings. on my other test box I noticed the situation
> > too, but I could fix it by alsamixer and unmuting main + pcm mixer and give them
> > a reasonable volume level than default.

And now as I fixed my installation on this box, mixer values are restored at
startup.

> > 
> > So there a many ways to control volume:
> > a. external amplifier (S/P-DIF)
> > b. external amplifier (via line out)
> > c. PC-Speaker
> > 
> > Things to be controlled by vdr / PC
> > a. alsa master volume + mute
> > b. alsa PCM mixer volume + mute
> > c. alsa line out  + S/P-DIF out (mute ?)
> > d. alsa output switches (s short summary from my setup)
> >    - IEC958 5V, Copyright, In Monitor, Loop, ..
> >    - Line-In Mode: Line-In, Rear Output, Bass output
> >    - Mic-In Mode: Mic-in, Center/LFE Output, 
> > 
> > Controlling alsa in total, is enough for separate plugin I guess.
> > 
> 
> There is the AVolCtl-plugin ;-)

Hey, thats _is_ the solution. Did a short test. This plugin needs just the
usual APIVERSION patch to compile with vdr-1.4.0.

So I'll add only a command line switch for those without avolctl.

> As you said, we can not control everything... If I understand that
> correctly AC3 passthrough works with NO_MIXER defined and with the
> correct alsa-mixer settings at the start of the softdevice?
> Maybe it is time for a FAQ, and we put all this in the FAQ.
> 

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Mon Nov  6 00:02:29 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Nov 2006 00:02:29 +0100
Subject: [Softdevice-devel] [ANNOUNCE] vdr-softdevice-0.3.1
Message-ID: <200611060002.29460.stefan@lucke.in-berlin.de>

Hello,

the softdevice team (Torgeir Veimo, Martin Wache and me, Stefan Lucke)
is pleased to announce a new release of vdr's softdevice plugin.

General info:
  Softdevice plugin enables vdr to run on your desktop with
  so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
  DirectFB or vidix to your screen. Decoding is done via ffmpeg.

This is just a maintance release for previous 0.3.0 version, as code
for support of vdr version earlier than vdr-1.3.7 will be removed soon.

Supported vdr versions: (1.2.x,) 1.3.x and 1.4.x

Plugin's homepage is located at: http://softdevice.berlios.de/

Changelog since last release:
2006-11-05: softdevice-0.3.1
   - xv-out: limit used width & height to screen dimensions.
   - audio: select alsa h/w-mixer for volume control via command line.
2006-10-11:
   - hopfull final color jump fix for odd "cut columns from left" values.
   - fix horizontal picture placement when YUY2 is selected for xv-out.
2006-10-10:
   - fix segfaults when YUY2 pixelformat is used for xv-out and cut lines
     from top is non zero. This fixes wrong colors and misplaced OSD drawing
     too, when cut colums from left is non zero.

Stefan Lucke


From stefan at lucke.in-berlin.de  Wed Nov  8 07:19:45 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed,  8 Nov 2006 07:19:45 +0100
Subject: [Softdevice-devel] cvs compile error
Message-ID: <1162966785.45517701f35a2@webmail.in-berlin.de>

PicBuffer.c: In function `void ClearPicBuffer(sPicBuffer*)':
PicBuffer.c:49: error: `PIX_FMT_RGB32' undeclared (first use this function)

That pixelformat depends on ffmpeg of 2006-08-28 or newer :-( .
It's 2006-07-12 here .

-- 
Stefan Lucke


From M.Wache at gmx.net  Wed Nov  8 22:22:47 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 08 Nov 2006 22:22:47 +0100
Subject: [Softdevice-devel] cvs compile error
In-Reply-To: <1162966785.45517701f35a2@webmail.in-berlin.de>
References: <1162966785.45517701f35a2@webmail.in-berlin.de>
Message-ID: <45524AA7.6070407@gmx.net>

Stefan Lucke schrieb:
> PicBuffer.c: In function `void ClearPicBuffer(sPicBuffer*)':
> PicBuffer.c:49: error: `PIX_FMT_RGB32' undeclared (first use this function)
> 
> That pixelformat depends on ffmpeg of 2006-08-28 or newer :-( .
> It's 2006-07-12 here .
> 
I changed the pixel format to RGBA32, that is almost the same anyway and
supported by ffmpeg-0.4.9pre1.

Bye,
Martin


From rahrenbe at cc.hut.fi  Fri Nov 10 20:27:37 2006
From: rahrenbe at cc.hut.fi (Rolf Ahrenberg)
Date: Fri, 10 Nov 2006 21:27:37 +0200 (EET)
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
Message-ID: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>


Hi,

a new version of libcle266mpegdec is now available at:

http://sourceforge.net/project/showfiles.php?group_id=176530

This release contains an initial AFD implementation by Jon Foster, Cabot 
Communications.

BR,
--
rofa


From laz at club-burniston.co.uk  Sun Nov 12 10:54:49 2006
From: laz at club-burniston.co.uk (Laz)
Date: Sun, 12 Nov 2006 09:54:49 +0000
Subject: [Softdevice-devel] Wrong colours in grabbed image
Message-ID: <200611120954.49139.laz@club-burniston.co.uk>


I'm glad to report that the newly incorporated "Grab" command works however,  
I'm getting incorrect colours. See example grabbed image at:
http://vdr.club-burniston.co.uk/wrong_colours.jpg

I presume this is another pixel format conversion problem: it's the same blue  
cast I was seeing with one of the pixel formats a while back with cle266  
output, although I'm not sure yet whether the grabbed image comes from the  
raw DVB stream or after pixel format conversion for display.

Other than the colour cast, it seems to work fine, e.g. showing live TV 
through vdradmin, etc.

Cheers,

Laz


From jpahka at welho.com  Sun Nov 12 18:46:10 2006
From: jpahka at welho.com (Juha Pahkala)
Date: Sun, 12 Nov 2006 19:46:10 +0200
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <200611032337.11008.stefan@lucke.in-berlin.de>
References: <454996E2.7030607@welho.com>	<1162466073.4549d31a01a5c@webmail.in-berlin.de>	<454A1181.8070905@welho.com>
	<200611032337.11008.stefan@lucke.in-berlin.de>
Message-ID: <45575DE2.7000402@welho.com>

Stefan Lucke wrote:
> Can you try the following patch which makes use of alsa mixer 
> selectable via OSD ?
>
>
>   

Just a quick one, came home from a trip a few hours ago and will test
the patch in the coming days...

juhis


From M.Wache at gmx.net  Sun Nov 12 19:54:13 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 12 Nov 2006 19:54:13 +0100
Subject: [Softdevice-devel] Wrong colours in grabbed image
In-Reply-To: <200611120954.49139.laz@club-burniston.co.uk>
References: <200611120954.49139.laz@club-burniston.co.uk>
Message-ID: <45576DD5.8070302@gmx.net>

Laz schrieb:
> I'm glad to report that the newly incorporated "Grab" command works however,  
> I'm getting incorrect colours. See example grabbed image at:
> http://vdr.club-burniston.co.uk/wrong_colours.jpg
> 
> I presume this is another pixel format conversion problem: it's the same blue  
> cast I was seeing with one of the pixel formats a while back with cle266  
> output, although I'm not sure yet whether the grabbed image comes from the  
> raw DVB stream or after pixel format conversion for display.
> 
Is this using the hardware mpeg2 decoder? It might be that pixel[1] and
pixel[2] have to be exchanged in SetupCle266Buffers(). Those values are
only used by video filters and grab image when you use the hardware
mpeg2 decoder. What happens if you exchange those two and enable the
mirror filter? Is the picture still ok? And the grabbed image?

The grabbed image is just the last picture which is displayed via
DrawVideo_420pl(). It should be before any format conversions.

If you don't use the hardware mpeg2 decoder I'm a bit lost... For me it
works with Xv-out.

Bye,
Martin


From laz at club-burniston.co.uk  Mon Nov 13 09:45:09 2006
From: laz at club-burniston.co.uk (Laz)
Date: Mon, 13 Nov 2006 08:45:09 +0000
Subject: [Softdevice-devel] Wrong colours in grabbed image
In-Reply-To: <45576DD5.8070302@gmx.net>
References: <200611120954.49139.laz@club-burniston.co.uk>
	<45576DD5.8070302@gmx.net>
Message-ID: <200611130845.10058.laz@club-burniston.co.uk>

On Sunday 12 November 2006 18:54, Martin Wache wrote:
> Laz schrieb:
> > I'm glad to report that the newly incorporated "Grab" command works
> > however, I'm getting incorrect colours. See example grabbed image at:
> > http://vdr.club-burniston.co.uk/wrong_colours.jpg
> >
> > I presume this is another pixel format conversion problem: it's the
> > same blue cast I was seeing with one of the pixel formats a while
> > back with cle266 output, although I'm not sure yet whether the
> > grabbed image comes from the raw DVB stream or after pixel format
> > conversion for display.
>
> Is this using the hardware mpeg2 decoder? It might be that pixel[1] and
> pixel[2] have to be exchanged in SetupCle266Buffers(). Those values are
> only used by video filters and grab image when you use the hardware
> mpeg2 decoder. What happens if you exchange those two and enable the
> mirror filter? Is the picture still ok? And the grabbed image?
>
> The grabbed image is just the last picture which is displayed via
> DrawVideo_420pl(). It should be before any format conversions.
>
> If you don't use the hardware mpeg2 decoder I'm a bit lost... For me it
> works with Xv-out.

Aha! Yes, I am using hardware decoding.

I'll have a play tonight to see if I can get correct colours...

Cheers,

Laz


From laz at club-burniston.co.uk  Tue Nov 14 10:23:00 2006
From: laz at club-burniston.co.uk (Laz)
Date: Tue, 14 Nov 2006 09:23:00 +0000
Subject: [Softdevice-devel] Wrong colours in grabbed image
In-Reply-To: <45576DD5.8070302@gmx.net>
References: <200611120954.49139.laz@club-burniston.co.uk>
	<45576DD5.8070302@gmx.net>
Message-ID: <200611140923.00779.laz@club-burniston.co.uk>

On Sunday 12 November 2006 18:54, Martin Wache wrote:
> Laz schrieb:
> > I'm glad to report that the newly incorporated "Grab" command works
> > however, I'm getting incorrect colours. See example grabbed image at:
> > http://vdr.club-burniston.co.uk/wrong_colours.jpg
> >
> > I presume this is another pixel format conversion problem: it's the
> > same blue cast I was seeing with one of the pixel formats a while
> > back with cle266 output, although I'm not sure yet whether the
> > grabbed image comes from the raw DVB stream or after pixel format
> > conversion for display.
>
> Is this using the hardware mpeg2 decoder? It might be that pixel[1] and
> pixel[2] have to be exchanged in SetupCle266Buffers(). Those values are
> only used by video filters and grab image when you use the hardware
> mpeg2 decoder. What happens if you exchange those two and enable the
> mirror filter? Is the picture still ok? And the grabbed image?

Not a totally helpful answer but if I swap around pixel[1] and pixel[2] in 
SetupCle266Buffers(), the grabbed image is correct:

http://vdr.club-burniston.co.uk/pix_swap.jpg

However, I'm doing this over ssh from work so I can't check on what 
the "real" picture looks like on my TV! It will have to wait until 
tonight before I find out whether that picture is now blue!

:)

Cheers,

Laz


From laz at club-burniston.co.uk  Tue Nov 14 20:42:12 2006
From: laz at club-burniston.co.uk (Laz)
Date: Tue, 14 Nov 2006 19:42:12 +0000
Subject: [Softdevice-devel] Wrong colours in grabbed image
In-Reply-To: <200611130845.10058.laz@club-burniston.co.uk>
References: <200611120954.49139.laz@club-burniston.co.uk>
	<45576DD5.8070302@gmx.net>
	<200611130845.10058.laz@club-burniston.co.uk>
Message-ID: <200611141942.12222.laz@club-burniston.co.uk>

On Monday 13 November 2006 08:45, Laz wrote:
> On Sunday 12 November 2006 18:54, Martin Wache wrote:
> > Laz schrieb:
> > > I'm glad to report that the newly incorporated "Grab" command works
> > > however, I'm getting incorrect colours. See example grabbed image at:
> > > http://vdr.club-burniston.co.uk/wrong_colours.jpg
> > >
> > > I presume this is another pixel format conversion problem: it's the
> > > same blue cast I was seeing with one of the pixel formats a while
> > > back with cle266 output, although I'm not sure yet whether the
> > > grabbed image comes from the raw DVB stream or after pixel format
> > > conversion for display.
> >
> > Is this using the hardware mpeg2 decoder? It might be that pixel[1] and
> > pixel[2] have to be exchanged in SetupCle266Buffers(). Those values are
> > only used by video filters and grab image when you use the hardware
> > mpeg2 decoder. What happens if you exchange those two and enable the
> > mirror filter? Is the picture still ok? And the grabbed image?
> >
> > The grabbed image is just the last picture which is displayed via
> > DrawVideo_420pl(). It should be before any format conversions.
> >
> > If you don't use the hardware mpeg2 decoder I'm a bit lost... For me it
> > works with Xv-out.
>
> Aha! Yes, I am using hardware decoding.
>
> I'll have a play tonight to see if I can get correct colours...

Following up from earlier: swapping round pixel[1] and pixel[2] in 
SetupCle266Buffers() gives me correct colours both on the grabbed image and 
also on TV-out. N.B. I'm not using any types of image filter, i.e. I didn't 
need to mirror. Not sure whether this would make a difference if a 
deinterlace filter was used.

Works for me, though!

:)

Cheers,

Laz


From M.Wache at gmx.net  Wed Nov 15 18:25:09 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 15 Nov 2006 18:25:09 +0100
Subject: [Softdevice-devel] Wrong colours in grabbed image
In-Reply-To: <200611141942.12222.laz@club-burniston.co.uk>
References: <200611120954.49139.laz@club-burniston.co.uk>	<45576DD5.8070302@gmx.net>	<200611130845.10058.laz@club-burniston.co.uk>
	<200611141942.12222.laz@club-burniston.co.uk>
Message-ID: <455B4D75.4040102@gmx.net>

Laz schrieb:
> On Monday 13 November 2006 08:45, Laz wrote:
>> On Sunday 12 November 2006 18:54, Martin Wache wrote:
>>> Laz schrieb:
>>>> I'm glad to report that the newly incorporated "Grab" command works
>>>> however, I'm getting incorrect colours. See example grabbed image at:
>>>> http://vdr.club-burniston.co.uk/wrong_colours.jpg
>>>>
>>>> I presume this is another pixel format conversion problem: it's the
>>>> same blue cast I was seeing with one of the pixel formats a while
>>>> back with cle266 output, although I'm not sure yet whether the
>>>> grabbed image comes from the raw DVB stream or after pixel format
>>>> conversion for display.
>>> Is this using the hardware mpeg2 decoder? It might be that pixel[1] and
>>> pixel[2] have to be exchanged in SetupCle266Buffers(). Those values are
>>> only used by video filters and grab image when you use the hardware
>>> mpeg2 decoder. What happens if you exchange those two and enable the
>>> mirror filter? Is the picture still ok? And the grabbed image?
>>>
>>> The grabbed image is just the last picture which is displayed via
>>> DrawVideo_420pl(). It should be before any format conversions.
>>>
>>> If you don't use the hardware mpeg2 decoder I'm a bit lost... For me it
>>> works with Xv-out.
>> Aha! Yes, I am using hardware decoding.
>>
>> I'll have a play tonight to see if I can get correct colours...
> 
> Following up from earlier: swapping round pixel[1] and pixel[2] in 
> SetupCle266Buffers() gives me correct colours both on the grabbed image and 
> also on TV-out. N.B. I'm not using any types of image filter, i.e. I didn't 
> need to mirror. Not sure whether this would make a difference if a 
> deinterlace filter was used.
> 

Could you please try if the colors on your TV are still ok when you
enable a filter (mirror, or deinterlacer, that doesn't matter) and post
a patch if the colors are still ok?
If not maybe this is the wrong position to swap pixel[1] and pixel[2],
or we have to swap them again somewhere else.

Bye,
Martin


From laz at club-burniston.co.uk  Thu Nov 16 10:31:43 2006
From: laz at club-burniston.co.uk (Laz)
Date: Thu, 16 Nov 2006 09:31:43 +0000
Subject: [Softdevice-devel] Patch: fix incorrect colours in GRAB command for
	CLE266 HW decoding
Message-ID: <200611160931.43532.laz@club-burniston.co.uk>


This minor change suggested by Martin Wache sorts out my incorrect colour 
issue when the GRAB command is used with softdevice when using Via CLE266 
hardware decoding.

I've not looked into what pixel[1] and pixel[2] actaully do in the 
PicBuffer structure but this small change fixes the GRAB command so that 
I get correct colours. It seems to work for me with and without picture 
mirroring or deinterlacing (i.e. using some form of postprocessing), both 
for the grabbed image and for live TV.

--- video-dfb.c.orig    2006-11-16 09:24:21.000000000 +0000
+++ video-dfb.c 2006-11-16 09:25:05.000000000 +0000
@@ -1462,8 +1462,8 @@

       // at this point I know that the buffer is not already allocated
       PicBuffer[i].pixel[0] = (uint8_t*) buf;
-      PicBuffer[i].pixel[2] = (uint8_t*) buf + height * mpegfb_stride;
-      PicBuffer[i].pixel[1] = (uint8_t*) PicBuffer[i].pixel[2]
+      PicBuffer[i].pixel[1] = (uint8_t*) buf + height * mpegfb_stride;
+      PicBuffer[i].pixel[2] = (uint8_t*) PicBuffer[i].pixel[1]
                                          +(height>>1)*(mpegfb_stride>>1);
       PicBuffer[i].stride[0] = mpegfb_stride;
       PicBuffer[i].stride[1] = PicBuffer[i].stride[2] = mpegfb_stride>>1;

Cheers,

Laz


From M.Wache at gmx.net  Thu Nov 16 21:42:49 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 16 Nov 2006 21:42:49 +0100
Subject: [Softdevice-devel] Patch: fix incorrect colours in GRAB command
 for	CLE266 HW decoding
In-Reply-To: <200611160931.43532.laz@club-burniston.co.uk>
References: <200611160931.43532.laz@club-burniston.co.uk>
Message-ID: <455CCD49.3020606@gmx.net>

Laz schrieb:
> This minor change suggested by Martin Wache sorts out my incorrect colour 
> issue when the GRAB command is used with softdevice when using Via CLE266 
> hardware decoding.
> 
> I've not looked into what pixel[1] and pixel[2] actaully do in the 
> PicBuffer structure but this small change fixes the GRAB command so that 
> I get correct colours. It seems to work for me with and without picture 
> mirroring or deinterlacing (i.e. using some form of postprocessing), both 
> for the grabbed image and for live TV.

Thanks for the patch and the testing. I've committed the patch to the cvs.

Bye,

Martin


From stefan at lucke.in-berlin.de  Sat Nov 18 14:38:15 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 18 Nov 2006 14:38:15 +0100
Subject: [Softdevice-devel] [Softdevice-cvs] softdevice CHANGELOG, 1.264,
	1.265
In-Reply-To: <20061116212509.13517AE024@bat.berlios.de>
References: <20061116212509.13517AE024@bat.berlios.de>
Message-ID: <200611181438.15450.stefan@lucke.in-berlin.de>

On Donnerstag 16 November 2006 22:25, wachm wrote:
> Update of /cvsroot/softdevice/softdevice
> In directory sheep:/tmp/cvs-serv15273

> Index: CHANGELOG
> ===================================================================
> RCS file: /cvsroot/softdevice/softdevice/CHANGELOG,v
> retrieving revision 1.264
> retrieving revision 1.265
> diff -C2 -d -r1.264 -r1.265
> *** CHANGELOG	16 Nov 2006 20:41:36 -0000	1.264
> --- CHANGELOG	16 Nov 2006 21:24:16 -0000	1.265
> ***************
> *** 3,6 ****
> --- 3,11 ----
>      - fix wrong colors when using GRAB with the cle266 hardware decoder 
>        (patch by Laz)
> +    - better colorkey support in SoftOsd.c, with interface to video.c
> +    - fix a bug which causes bad resolution on upscaling
> +    - fix a bug which causes segfaults when upscaling to huge images
> +    - reintroduce the chessboard pattern for pseudo alpha blending

Thanks, thats really nice to have this pattern back :-)) .

> +    - use WRITE_RGB macros from utils.h
>   2006-11-11:
>      - !! removed support for vdr versions older than vdr-1.3.7 !!
> 

-- 
Stefan Lucke


From rahrenbe at cc.hut.fi  Sat Nov 18 22:20:46 2006
From: rahrenbe at cc.hut.fi (Rolf Ahrenberg)
Date: Sat, 18 Nov 2006 23:20:46 +0200 (EET)
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
References: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
Message-ID: <Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>

On Fri, 10 Nov 2006, Rolf Ahrenberg wrote:

> a new version of libcle266mpegdec is now available at:

I haven't had any reports if this new library version works or not, so I 
guess nobody hasn't even bothered to try it... Any feedback or even 
feature request is appreciated, so I know what has be done before the 
next public release...

--
rofa


From zzam at gentoo.org  Sun Nov 19 13:24:45 2006
From: zzam at gentoo.org (Matthias Schwarzott)
Date: Sun, 19 Nov 2006 13:24:45 +0100
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
References: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
	<Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
Message-ID: <200611191324.46775.zzam@gentoo.org>

On Saturday 18 November 2006 22:20, Rolf Ahrenberg wrote:
> On Fri, 10 Nov 2006, Rolf Ahrenberg wrote:
> > a new version of libcle266mpegdec is now available at:
>
> I haven't had any reports if this new library version works or not, so I
> guess nobody hasn't even bothered to try it... Any feedback or even
> feature request is appreciated, so I know what has be done before the
> next public release...
>
As I started to try to support that kind of hardware (I don't have it myself) 
I added an ebuild to gentoo vdr-testing overlay, but I don't think so much 
people have already tried it.

Matthias

-- 
Matthias Schwarzott
Gentoo Developer
http://www.gentoo.org


From stefan at lucke.in-berlin.de  Sun Nov 19 19:20:16 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 19 Nov 2006 19:20:16 +0100
Subject: [Softdevice-devel] softdevice and gentoo
Message-ID: <200611191920.17011.stefan@lucke.in-berlin.de>

Hi,

I'm on the way to make my 2nd vdr productive with softdevice and dfb mgatv output.

There are/were some issues:

1. I had to modify the ebuild file by hand, as the default
   vdr-softdevice-0.3.0-r1.ebuild would disable directfb support if derectfb
   is not in USE flags. By this softdevice configure can detect my already installed
   DirectFB/DFB++ versions. Those from cvs 2006-11-05 are more suitable then
   those which would be pulled in otherwise:DirectFB-0.9.25.1 / DFB++-0.9.23 .
-- cut --
--- vdr-softdevice-0.3.0-r1.ebuild.old  2006-11-14 10:35:59.000000000 +0100
+++ vdr-softdevice-0.3.0-r1.ebuild      2006-11-18 23:07:35.000000000 +0100
@@ -88,7 +88,7 @@
        MYOPTS="${MYOPTS} --disable-vidix"
        use xv || MYOPTS="${MYOPTS} --disable-xv"
        use fbcon || MYOPTS="${MYOPTS} --disable-fb"
-       use directfb || MYOPTS="${MYOPTS} --disable-dfb"
+       # use directfb || MYOPTS="${MYOPTS} --disable-dfb"

        # MMX-Support
        # hardcode mmx for amd64 - do not disable even without use-flag
-- cut --
   After modifying ebuild I had to run:
     ebuild  vdr-softdevice-0.3.0-r1.ebuild digest

2. For ALSA audio access I had to add user vdr to group audio

3. For running vdr as user "vdr" and having directfb input work via 
   linux-input I had to modify udev rules:
     # lucke: changed input event* settings
     #KERNEL=="event*",      NAME="input/%k", MODE="0600"
     KERNEL=="event*",       NAME="input/%k", GROUP="video", MODE="0660"
   Current /etc/directfbrc looks like the following:
   -- cut --
     mode=720x576
     depth = 32
     matrox-crtc2
     matrox-tv-standard=pal
     primary-layer=2
     pixelformat=ARGB
     matrox-cable-type=scart-rgb
     disable-module=lirc
     no-vt
     no-vt-switch
   -- cut --

4. Shutdown (vdr power off) is still not working.


-- 
Stefan Lucke


From lucianm at users.sourceforge.net  Mon Nov 20 00:05:30 2006
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 20 Nov 2006 00:05:30 +0100
Subject: [Softdevice-devel] softdevice and gentoo
In-Reply-To: <200611191920.17011.stefan@lucke.in-berlin.de>
References: <200611191920.17011.stefan@lucke.in-berlin.de>
Message-ID: <4560E33A.5070008@users.sourceforge.net>

Hi Stefan,

have you managed to start vdr with softdevice output over DirectFB from 
the gentoo start scripts?

Lucian


From stefan at lucke.in-berlin.de  Mon Nov 20 00:58:20 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 20 Nov 2006 00:58:20 +0100
Subject: [Softdevice-devel] softdevice and gentoo
In-Reply-To: <4560E33A.5070008@users.sourceforge.net>
References: <200611191920.17011.stefan@lucke.in-berlin.de>
	<4560E33A.5070008@users.sourceforge.net>
Message-ID: <200611200058.20329.stefan@lucke.in-berlin.de>

On Montag 20 November 2006 00:05, Lucian Muresan wrote:
> Hi Stefan,
> 
> have you managed to start vdr with softdevice output over DirectFB from 
> the gentoo start scripts?

Yes,
- it is running as user vdr,
- it is started in the default runlevel,
- and the reported issue #4 with shutdown is resolved:
   - found the point where I had to activate vdr's shutdown feature:
     /etc/conf.d/vdr.shutdown
   - for some reason my /usr/bin/sudo lost it's suid bit. After restoring that
     it worked. Perhaps that was due to the fact I copied my whole system
     via tar to a new location. I'm shure I used --preserve for extract but ..

This vdr box is now a diskless client :-) .

-- 
Stefan Lucke


From laz at club-burniston.co.uk  Mon Nov 20 01:38:45 2006
From: laz at club-burniston.co.uk (Laz)
Date: Mon, 20 Nov 2006 00:38:45 +0000
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
References: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
	<Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
Message-ID: <200611200038.45505.laz@club-burniston.co.uk>

On Saturday 18 November 2006 21:20, Rolf Ahrenberg wrote:
> On Fri, 10 Nov 2006, Rolf Ahrenberg wrote:
> > a new version of libcle266mpegdec is now available at:
>
> I haven't had any reports if this new library version works or not, so I
> guess nobody hasn't even bothered to try it... Any feedback or even
> feature request is appreciated, so I know what has be done before the
> next public release...

I think I must have missed the announcement. I'm still going strong with 
version 0.4. I've just grabbed version 0.5 and I'll give it a test tomorrow 
and report back...

Cheers,

Laz


From bob at globall.ru  Mon Nov 20 09:31:28 2006
From: bob at globall.ru (Monchenko Vladimir)
Date: Mon, 20 Nov 2006 08:31:28 +0000
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
References: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
	<Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
Message-ID: <456167E0.5070701@globall.ru>



> On Fri, 10 Nov 2006, Rolf Ahrenberg wrote:
>
>> a new version of libcle266mpegdec is now available at:
>
> I haven't had any reports if this new library version works or not, so I 
> guess nobody hasn't even bothered to try it... Any feedback or even 
> feature request is appreciated, so I know what has be done before the 
> next public release..


I try libcle266mpegdec-0.5 with softdevice-0.3.1 on VIA Epia ME6000.
All works ok. Video is replaying very smoothly without twitches.
I am not try recent versions libcle266mpegdec and softdevice with
composite/svideo TV out, but 2 months back all worked very well.
I use Gentoo and build vdr from sources, not from portage.

Monchenko Vladimir.




From torgeir at pobox.com  Mon Nov 20 17:27:52 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 20 Nov 2006 16:27:52 +0000
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
Message-ID: <1164040072.28485.18.camel@fink>

There's a new release of the VIA driver, which seems to support
CN400/700 and VT1636, see
http://www.viaarena.com/default.aspx?PageID=420&OSID=25&CatID=2580&SubCatID=158

Hopefully support for CN400/700 can be added to the library now?

-- 
Torgeir Veimo <torgeir at pobox.com>



From rahrenbe at cc.hut.fi  Mon Nov 20 20:53:59 2006
From: rahrenbe at cc.hut.fi (Rolf Ahrenberg)
Date: Mon, 20 Nov 2006 21:53:59 +0200 (EET)
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <1164040072.28485.18.camel@fink>
References: <1164040072.28485.18.camel@fink>
Message-ID: <Pine.OSF.4.64.0611202136200.509114@kosh.hut.fi>

On Mon, 20 Nov 2006, Torgeir Veimo wrote:

> There's a new release of the VIA driver, which seems to support
> CN400/700 and VT1636, see
> Hopefully support for CN400/700 can be added to the library now?

But the essential part, libddmpeg, is still closed source, and there 
hasn't been any word from VIA that it would ever be opened up. 

Luc's LiveJounal is a nice place to follow up VIA's open source policy:
http://libv.livejournal.com/

--
rofa


From jpahka at welho.com  Mon Nov 20 21:09:36 2006
From: jpahka at welho.com (Juha Pahkala)
Date: Mon, 20 Nov 2006 22:09:36 +0200
Subject: [Softdevice-devel] possible bug in softdevice 0.3.0 alsa code
In-Reply-To: <200611032337.11008.stefan@lucke.in-berlin.de>
References: <454996E2.7030607@welho.com>	<1162466073.4549d31a01a5c@webmail.in-berlin.de>	<454A1181.8070905@welho.com>
	<200611032337.11008.stefan@lucke.in-berlin.de>
Message-ID: <45620B80.3080509@welho.com>

Stefan Lucke wrote:
>> Hi Stefan,
>>
>> Option A didn't make a difference but commenting out the NO_MIXER define
>> fixed the problem! So thank you for your help (as well as softdevice in
>> general ;)
>>     
>
> Can you try the following patch which makes use of alsa mixer 
> selectable via OSD ?
>   
...fwiw, just to let you know, version 0.3.1 (with the alsa patch
already applied??) works for me by setting ... -ao alsa:mixer:pcm=...

you probably knew that already,

thanks, juhis



From torgeir at pobox.com  Mon Nov 20 22:15:47 2006
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 20 Nov 2006 21:15:47 +0000
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611202136200.509114@kosh.hut.fi>
References: <1164040072.28485.18.camel@fink>
	<Pine.OSF.4.64.0611202136200.509114@kosh.hut.fi>
Message-ID: <1164057347.3271.1.camel@fink>

On Mon, 2006-11-20 at 21:53 +0200, Rolf Ahrenberg wrote:

> But the essential part, libddmpeg, is still closed source, and there 
> hasn't been any word from VIA that it would ever be opened up. 

Just to recap, the version of that library for the cle266 was reverse
engineered by instrumenting the fb kernel driver, or does the library
mmap the hardware directly?

-- 
Torgeir Veimo <torgeir at pobox.com>



From laz at club-burniston.co.uk  Tue Nov 21 20:31:28 2006
From: laz at club-burniston.co.uk (Laz)
Date: Tue, 21 Nov 2006 19:31:28 +0000
Subject: [Softdevice-devel] [ANNOUNCE] libcle266mpegdec-0.5
In-Reply-To: <Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
References: <Pine.OSF.4.64.0611102123360.134925@kosh.hut.fi>
	<Pine.OSF.4.64.0611182312550.443072@kosh.hut.fi>
Message-ID: <200611211931.28723.laz@club-burniston.co.uk>

On Saturday 18 November 2006 21:20, Rolf Ahrenberg wrote:
> On Fri, 10 Nov 2006, Rolf Ahrenberg wrote:
> > a new version of libcle266mpegdec is now available at:
>
> I haven't had any reports if this new library version works or not, so I
> guess nobody hasn't even bothered to try it... Any feedback or even
> feature request is appreciated, so I know what has be done before the
> next public release...

Seems to work OK for me with TV-out.

:)

Cheers,

Laz


From patrick.boettcher at desy.de  Sun Dec  3 13:22:29 2006
From: patrick.boettcher at desy.de (Patrick Boettcher)
Date: Sun, 3 Dec 2006 13:22:29 +0100 (CET)
Subject: [Softdevice-devel] Softplay: Duration of a file
Message-ID: <Pine.LNX.4.64.0612031318280.19480@pub4.ifh.de>

Hi all,

for a long time I was bothered by never having the correct duration of a 
video I was watching (If the video was longer than about 35 minutes).

Attached is a very simple fix for that. I'm not sure if this fix hides 
something else, but for me it is obvious: the duration and start_time in 
AVFormatContext are int64_t and not int32_t .

Please apply if appropriate,
Patrick.
-------------- next part --------------
Index: SoftPlayer.h
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.h,v
retrieving revision 1.7
diff -u -3 -p -r1.7 SoftPlayer.h
--- SoftPlayer.h	25 Jul 2006 20:03:33 -0000	1.7
+++ SoftPlayer.h	3 Dec 2006 12:18:09 -0000
@@ -47,8 +47,8 @@ class cSoftPlayer : public cPlayer, cThr
        char title[60];
        char author[60];
        char album[60];
-       int duration;
-       int start_time;
+       int64_t duration;
+       int64_t start_time;
        
        char filename[200];
        bool newFile;

From zzam at gentoo.org  Sun Dec  3 15:21:37 2006
From: zzam at gentoo.org (Matthias Schwarzott)
Date: Sun, 3 Dec 2006 15:21:37 +0100
Subject: [Softdevice-devel] [PATCH] Compiling vdr-softdevice against
	vdr-1.4.4_p1 (maintainance-patch v1)
Message-ID: <200612031521.37765.zzam@gentoo.org>

Hi!

The attached patch changes all remaining uint64-occurences in softdevice to 
uint64_t as vdr-1.4.4_p1 no longer defines uint64 and has completely switched 
to uint64_t.

With this patch applied softdevice keeps compiling against older VDR-Versions 
(tested with vdr-1.4.1_p1).

Matthias

-- 
Matthias Schwarzott
Gentoo Developer
http://www.gentoo.org
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vdr-softdevice-0.3.1-uint64.diff
Type: text/x-diff
Size: 2347 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20061203/2627a973/attachment.diff>

From stefan at lucke.in-berlin.de  Sun Dec  3 19:28:14 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 3 Dec 2006 19:28:14 +0100
Subject: [Softdevice-devel] [PATCH] Compiling vdr-softdevice against
	vdr-1.4.4_p1 (maintainance-patch v1)
In-Reply-To: <200612031521.37765.zzam@gentoo.org>
References: <200612031521.37765.zzam@gentoo.org>
Message-ID: <200612031928.14650.stefan@lucke.in-berlin.de>

On Sonntag 03 Dezember 2006 15:21, Matthias Schwarzott wrote:
> Hi!
> 
> The attached patch changes all remaining uint64-occurences in softdevice to 
> uint64_t as vdr-1.4.4_p1 no longer defines uint64 and has completely switched 
> to uint64_t.

Thanks, applied.

> 
> With this patch applied softdevice keeps compiling against older VDR-Versions 
> (tested with vdr-1.4.1_p1).

Works with vdr-1.4.0 too :-) .

-- 
Stefan Lucke


From claas+maillinglists.softdevice at jucs-kramkiste.de  Wed Dec  6 08:40:33 2006
From: claas+maillinglists.softdevice at jucs-kramkiste.de (Claas Hilbrecht)
Date: Wed, 06 Dec 2006 08:40:33 +0100
Subject: [Softdevice-devel] softdevice stops audio output
Message-ID: <AF478863CDEDF27526FBFA43@[192.168.83.50]>

Hello,

after upgrading to vdr 1.4.4 and softdevice 3.1 I have some trouble. I use 
softdevice to output radio channels on a budget only vdr server system. The 
vdr server is equiped with four dvb-s budget cards. One card is dedicated 
to listen to a radio station. The output is handeld via softdevice to the 
onboard soundcard. This works fine with vdr 1.3.4-patch1 and softdevice 
3.0. This setup works without any problems for several weeks. After 
upgrading to vdr 1.4.4 and softdevice 3.1 I had 3 times the problem that 
the audio output stops working. The output works fine 2-3 days and then 
stops working. Only restarting vdr helps to get a audio output again. I 
tried to switch to another channel and changing the volume level. I didn't 
have a clue where to start searching. Here's what I grab from the logfile.

Dec  5 21:29:25 funfix vdr: [2145] PES packet shortened to 4638 bytes 
(expected: 4814 bytes)
Dec  5 21:29:26 funfix vdr: [2145] 1 cRepacker messages suppressed
Dec  5 21:29:26 funfix vdr: [2145] cAudioRepacker(0xC0): skipped 784 bytes 
to sync on next audio frame
Dec  5 21:29:27 funfix vdr: [2145] PES packet shortened to 4814 bytes 
(expected: 4868 bytes)
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4800 bytes 
(expected: 4814 bytes)
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4454 bytes 
(expected: 4814 bytes)
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4446 bytes 
(expected: 4814 bytes)
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4630 bytes 
(expected: 4814 bytes)
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4630 bytes 
(expected: 4814 bytes)
Dec  5 21:29:28 funfix vdr: [2151] [softdevice-audio] samplerate: 44100Hz, 
channels: #2
Dec  5 21:29:28 funfix vdr: [2151] [softdevice-audio] Rate 44100 Hz is not 
possible (and using instead 48000 Hz is not implemented) NO AUDIO!
Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4728 bytes 
(expected: 4814 bytes)
Dec  5 21:29:29 funfix vdr: [2145] PES packet shortened to 4638 bytes 
(expected: 4814 bytes)
Dec  5 21:29:29 funfix vdr: [2145] PES packet shortened to 4638 bytes 
(expected: 4734 bytes)
Dec  5 21:29:29 funfix vdr: [2145] PES packet shortened to 4446 bytes 
(expected: 4814 bytes)
Dec  5 21:29:29 funfix vdr: [2151] [softdevice-audio] samplerate: 32000Hz, 
channels: #2
Dec  5 21:29:29 funfix vdr: [2151] [softdevice-audio] Rate 32000 Hz is not 
possible (and using instead 48000 Hz is not implemented) NO AUDIO!
Dec  5 21:29:29 funfix vdr: [2145] PES packet shortened to 2000 bytes 
(expected: 4814 bytes)
Dec  5 21:32:08 funfix vdr: [2145] 22 cRepacker messages suppressed
Dec  5 21:32:08 funfix vdr: [2145] cAudioRepacker(0xC0): skipped 202 bytes 
to sync on next audio frame
Dec  5 21:32:08 funfix vdr: [2145] PES packet shortened to 4462 bytes 
(expected: 4814 bytes)
Dec  5 21:32:11 funfix vdr: [2145] PES packet shortened to 4262 bytes 
(expected: 4814 bytes)


-- 
 Claas Hilbrecht
 http://www.jucs-kramkiste.de



From stefan at lucke.in-berlin.de  Wed Dec  6 22:01:36 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed,  6 Dec 2006 22:01:36 +0100
Subject: [Softdevice-devel] softdevice stops audio output
In-Reply-To: <AF478863CDEDF27526FBFA43@[192.168.83.50]>
References: <AF478863CDEDF27526FBFA43@[192.168.83.50]>
Message-ID: <1165438896.45772fb0da694@webmail.in-berlin.de>

Quoting Claas Hilbrecht <claas+maillinglists.softdevice at jucs-kramkiste.de>:

> Hello,
>
> after upgrading to vdr 1.4.4 and softdevice 3.1 I have some trouble. I use
> softdevice to output radio channels on a budget only vdr server system. The
> vdr server is equiped with four dvb-s budget cards. One card is dedicated
> to listen to a radio station. The output is handeld via softdevice to the
> onboard soundcard. This works fine with vdr 1.3.4-patch1 and softdevice
> 3.0. This setup works without any problems for several weeks. After
> upgrading to vdr 1.4.4 and softdevice 3.1 I had 3 times the problem that
> the audio output stops working. The output works fine 2-3 days and then
> stops working. Only restarting vdr helps to get a audio output again. I
> tried to switch to another channel and changing the volume level. I didn't
> have a clue where to start searching. Here's what I grab from the logfile.
>
> Dec  5 21:29:25 funfix vdr: [2145] PES packet shortened to 4638 bytes
> (expected: 4814 bytes)
> Dec  5 21:29:26 funfix vdr: [2145] 1 cRepacker messages suppressed
> Dec  5 21:29:26 funfix vdr: [2145] cAudioRepacker(0xC0): skipped 784 bytes
> to sync on next audio frame
> Dec  5 21:29:27 funfix vdr: [2145] PES packet shortened to 4814 bytes
> (expected: 4868 bytes)
> Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4800 bytes
> (expected: 4814 bytes)
> Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4454 bytes
> (expected: 4814 bytes)
> Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4446 bytes
> (expected: 4814 bytes)
> Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4630 bytes
> (expected: 4814 bytes)
> Dec  5 21:29:28 funfix vdr: [2145] PES packet shortened to 4630 bytes
> (expected: 4814 bytes)

Those repacker messages are related to bad reception I guess.

> Dec  5 21:29:28 funfix vdr: [2151] [softdevice-audio] samplerate: 44100Hz,
> channels: #2
> Dec  5 21:29:28 funfix vdr: [2151] [softdevice-audio] Rate 44100 Hz is not
> possible (and using instead 48000 Hz is not implemented) NO AUDIO!

That looks more like a problem with your sound card, which supports
48kHz only. On vdr-portal, there is a similar thread and I'm waiting for feedback:
http://www.vdr-portal.de/board/thread.php?threadid=56181

My suggestion is/was to create a remixing audio device via ALSA dmix plugin
which should do the resampling. But I don't know if thats the correct approach.

With this definition in my .asoundrc file I could use a device named d48only
(parameter for softdevice: "-ao alsa:d48only"):

pcm.d48only {
        type dmix
        ipc_key 1234
        ipc_perm 0660
        slave {
                pcm "hw:0,0"
                period_time 0
                period_size 1024
                buffer_size 4096
                rate 48000
        }
}

Stefan Lucke


From dave at optionsdsl.ca  Sat Dec  9 17:24:35 2006
From: dave at optionsdsl.ca (Dave)
Date: Sat, 09 Dec 2006 11:24:35 -0500
Subject: [Softdevice-devel] VIA cle266 fast enough to decode HDTV?
Message-ID: <457AE343.2080902@optionsdsl.ca>

I was interested in getting one of these mainboards as a frontend to a 4 
DVB computer mainly for its cle266 decoder, but these boards only seem 
to come in speeds up to about 1ghz, and I want to decode HDTV via the 
cle266 decoder, do these boards support the resolutions and speed to be 
able to decode HDTV OK?  




From laz at club-burniston.co.uk  Sat Dec  9 18:57:02 2006
From: laz at club-burniston.co.uk (Laz)
Date: Sat, 9 Dec 2006 17:57:02 +0000
Subject: [Softdevice-devel] VIA cle266 fast enough to decode HDTV?
In-Reply-To: <457AE343.2080902@optionsdsl.ca>
References: <457AE343.2080902@optionsdsl.ca>
Message-ID: <200612091757.02971.laz@club-burniston.co.uk>

On Saturday 09 December 2006 16:24, Dave wrote:
> I was interested in getting one of these mainboards as a frontend to a 4
> DVB computer mainly for its cle266 decoder, but these boards only seem
> to come in speeds up to about 1ghz, and I want to decode HDTV via the
> cle266 decoder, do these boards support the resolutions and speed to be
> able to decode HDTV OK?

I think you might be hoping a bit, there. The cle266 can only do MPEG2 
decoding at PAL-sort-of resolutions (as far as I know). The cle400 (and I 
think there is a newer chipset) is meant to do MEG4 decoding but I think it's 
only "hardware assisted" decoding, whatever that means.

I've had no experience of the cle400 and I don't think even the hardware MPEG2 
stuff will work on the cle400 chip. I'm not sure whether anyone is working on 
this or not.

Cheers,

Laz


From dave at optionsdsl.ca  Sat Dec  9 19:50:03 2006
From: dave at optionsdsl.ca (Dave)
Date: Sat, 09 Dec 2006 13:50:03 -0500
Subject: [Softdevice-devel] VIA cle266 fast enough to decode HDTV?
In-Reply-To: <200612091757.02971.laz@club-burniston.co.uk>
References: <457AE343.2080902@optionsdsl.ca>
	<200612091757.02971.laz@club-burniston.co.uk>
Message-ID: <457B055B.9080805@optionsdsl.ca>

Laz wrote:
> On Saturday 09 December 2006 16:24, Dave wrote:
>   
>> I was interested in getting one of these mainboards as a frontend to a 4
>> DVB computer mainly for its cle266 decoder, but these boards only seem
>> to come in speeds up to about 1ghz, and I want to decode HDTV via the
>> cle266 decoder, do these boards support the resolutions and speed to be
>> able to decode HDTV OK?
>>     
>
> I think you might be hoping a bit, there. The cle266 can only do MPEG2 
> decoding at PAL-sort-of resolutions (as far as I know). The cle400 (and I 
> think there is a newer chipset) is meant to do MEG4 decoding but I think it's 
> only "hardware assisted" decoding, whatever that means.
>
> I've had no experience of the cle400 and I don't think even the hardware MPEG2 
> stuff will work on the cle400 chip. I'm not sure whether anyone is working on 
> this or not.
>
>   

After some research I see that is not a suitable platform for HDTV, max 
mpeg2 assisted decoding is 1024x1024.

Im after some way to display HDTV channels, but not even at the true 
HDTV resolution (my display device is only 800x600 projector) with some 
sort of acceleration as to not bottom out the CPU. I have tried other 
options such as XvMC (libxineoutput) and had poor results with a/v sync, 
but excellent results in decoding. I like softdevice and have been using 
it for a long time.

I think we need an XvMC softdevice :) And I know this has been said a 
thousand times before ...

> Cheers,
>
> Laz
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>
>   



From dave at optionsdsl.ca  Sun Dec 10 21:09:56 2006
From: dave at optionsdsl.ca (Dave)
Date: Sun, 10 Dec 2006 15:09:56 -0500
Subject: [Softdevice-devel] Softdevice and HDTV
Message-ID: <457C6994.9000608@optionsdsl.ca>

Anyone have HDTV successfully working?  I tried this via directfb and 
Xv, but neither worked in playing back a 720p or 1080i image scaled to 
an output to fit on an 800x600 display device, although there seemed to 
be enough CPU power, it just didnt get displayed correctly, it flickered 
and stuttered on 720p content and the 1080i content was not scaled 
properly and also the sound did not work.  I will live with high cpu 
usage if it worked, I can get faster CPU's. 

The PC plays back a 1080i test file no problem as it stands now.

Thx!






From M.Wache at gmx.net  Fri Dec 15 00:00:39 2006
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 15 Dec 2006 00:00:39 +0100
Subject: [Softdevice-devel] Softplay: Duration of a file
In-Reply-To: <Pine.LNX.4.64.0612031318280.19480@pub4.ifh.de>
References: <Pine.LNX.4.64.0612031318280.19480@pub4.ifh.de>
Message-ID: <4581D797.3010002@gmx.net>

Patrick Boettcher schrieb:
> Hi all,
> 
> for a long time I was bothered by never having the correct duration of a 
> video I was watching (If the video was longer than about 35 minutes).
> 
> Attached is a very simple fix for that. I'm not sure if this fix hides 
> something else, but for me it is obvious: the duration and start_time in 
> AVFormatContext are int64_t and not int32_t .
> 
Thank you very much, I applied the patch.

Bye,
Martin


From stefan at lucke.in-berlin.de  Mon Dec 18 00:31:30 2006
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 18 Dec 2006 00:31:30 +0100
Subject: [Softdevice-devel] Softdevice and HDTV
In-Reply-To: <457C6994.9000608@optionsdsl.ca>
References: <457C6994.9000608@optionsdsl.ca>
Message-ID: <200612180031.30294.stefan@lucke.in-berlin.de>

On Sonntag 10 Dezember 2006 21:09, Dave wrote:
> Anyone have HDTV successfully working?  I tried this via directfb and 
> Xv, but neither worked in playing back a 720p or 1080i image scaled to 
> an output to fit on an 800x600 display device, although there seemed to 
> be enough CPU power, 

I cannot really comment on HDTV, but what is your real cpu power ?

> it just didnt get displayed correctly, it flickered  
> and stuttered on 720p content and the 1080i content was not scaled 
> properly and also the sound did not work.

Downscaling with xv depends on the graphic card too, which one ?
Does it offer an area, which is large enough to hold HDTV ?

Perhaps you need to add max_area to your calling options.
If it's a buffering issue, you may select a different buffer size
via OSD.

> I will live with high cpu  
> usage if it worked, I can get faster CPU's. 
> 
> The PC plays back a 1080i test file no problem as it stands now.
> 

-- 
Stefan Lucke


