<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Softdevice-devel] crash with latest cvs code
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/softdevice-devel/2005q2/index.html" >
   <LINK REL="made" HREF="mailto:softdevice-devel%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-devel%5D%20crash%20with%20latest%20cvs%20code&In-Reply-To=%3C42526F31.1050003%40gmx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000435.html">
   <LINK REL="Next"  HREF="000440.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Softdevice-devel] crash with latest cvs code</H1>
    <B>Martin Wache</B> 
    <A HREF="mailto:softdevice-devel%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-devel%5D%20crash%20with%20latest%20cvs%20code&In-Reply-To=%3C42526F31.1050003%40gmx.net%3E"
       TITLE="[Softdevice-devel] crash with latest cvs code">M.Wache at gmx.net
       </A><BR>
    <I>Tue Apr  5 12:57:53 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000435.html">[Softdevice-devel] crash with latest cvs code
</A></li>
        <LI>Next message: <A HREF="000440.html">[Softdevice-devel] crash with latest cvs code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#436">[ date ]</a>
              <a href="thread.html#436">[ thread ]</a>
              <a href="subject.html#436">[ subject ]</a>
              <a href="author.html#436">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Torgeir Veimo wrote:
&gt;<i> On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>Torgeir Veimo wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>[XvVideoOut]: using area size 2048 x 2048
</I>&gt;&gt;&gt;<i>Subplugin successfully opend
</I>&gt;&gt;&gt;<i>[softdevice] Video Out seems to be OK
</I>&gt;&gt;&gt;<i>[softdevice] Initializing Audio Out
</I>&gt;&gt;&gt;<i>[softdevice] Audio out seems to be OK
</I>&gt;&gt;&gt;<i>[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
</I>&gt;&gt;&gt;<i>cSoftDevice::MakePrimaryDevice
</I>&gt;&gt;&gt;<i>[New Thread 114696 (LWP 5510)]
</I>&gt;&gt;&gt;<i>[New Thread 131081 (LWP 5511)]
</I>&gt;&gt;&gt;<i>[New Thread 147466 (LWP 5513)]
</I>&gt;&gt;&gt;<i>CMD[2932]:SetPlayMode PmAudioVideo
</I>&gt;&gt;&gt;<i>CMD[2932]:Start IsSuspended 0
</I>&gt;&gt;&gt;<i>init put byte finished
</I>&gt;&gt;&gt;<i>[New Thread 163851 (LWP 5515)]
</I>&gt;&gt;&gt;<i>CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
</I>&gt;&gt;&gt;<i>BUF[3213]:av_read_frame start
</I>&gt;&gt;&gt;<i>BUF[3213]:read_packet: StreamBuffer: 0
</I>&gt;&gt;&gt;<i>[New Thread 180236 (LWP 5517)]
</I>&gt;&gt;&gt;<i>[Thread 131081 (LWP 5511) exited]
</I>&gt;&gt;&gt;<i>CMD[5861]:Stop
</I>&gt;&gt;&gt;<i>BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
</I>&gt;&gt;&gt;<i>CMD[5878]:Thread beendet : mpegDecoder pid 5515
</I>&gt;&gt;&gt;<i>[Thread 163851 (LWP 5515) exited]
</I>&gt;&gt;&gt;<i>CMD[5883]:Stop finished
</I>&gt;&gt;&gt;<i>GetSpuDecoder 0
</I>&gt;&gt;&gt;<i>[Thread 180236 (LWP 5517) exited]
</I>&gt;&gt;&gt;<i>[Thread 147466 (LWP 5513) exited]
</I>&gt;&gt;&gt;<i>[New Thread 196617 (LWP 5518)]
</I>&gt;&gt;&gt;<i>[New Thread 213002 (LWP 5519)]
</I>&gt;&gt;&gt;<i>CMD[6005]:SetPlayMode PmAudioVideo
</I>&gt;&gt;&gt;<i>CMD[6005]:Start IsSuspended 0
</I>&gt;&gt;&gt;<i>init put byte finished
</I>&gt;&gt;&gt;<i>[New Thread 229387 (LWP 5520)]
</I>&gt;&gt;&gt;<i>CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
</I>&gt;&gt;&gt;<i>BUF[6011]:av_read_frame start
</I>&gt;&gt;&gt;<i>BUF[6011]:read_packet: StreamBuffer: 0
</I>&gt;&gt;&gt;<i>[New Thread 245772 (LWP 5521)]
</I>&gt;&gt;&gt;<i>BUF[6408]:Decode b32eec88, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6409]:Decode b32efc88, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6409]:Decode b32f0488, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6409]:Decode b32f0c88, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6409]:Decode b32f1488, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6409]:Decode b32f1c88, Length 2048
</I>&gt;&gt;&gt;<i>BUF[6409]:Deocde finished
</I>&gt;&gt;&gt;<i>BUF[6418]:read_packet: sleeping while data (12288) in buffer
</I>&gt;&gt;&gt;<i>BUF[6418]:read_packet: got 12280 bytes
</I>&gt;&gt;&gt;<i>BUF[6418]:got packet from av_read_frame!
</I>&gt;&gt;&gt;<i>BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>Program received signal SIGSEGV, Segmentation fault.
</I>&gt;&gt;&gt;<i>[Switching to Thread 229387 (LWP 5520)]
</I>&gt;&gt;&gt;<i>0xb78668af in cMpeg2Decoder::QueuePacket ()
</I>&gt;&gt;&gt;<i>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
</I>&gt;&gt;&gt;<i>(gdb) ba
</I>&gt;&gt;&gt;<i>#0  0xb78668af in cMpeg2Decoder::QueuePacket ()
</I>&gt;&gt;&gt;<i>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
</I>&gt;&gt;&gt;<i>#1  0xb7866c98 in cMpeg2Decoder::Action ()
</I>&gt;&gt;&gt;<i>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
</I>&gt;&gt;&gt;<i>#2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
</I>&gt;&gt;&gt;<i>thread.c:227
</I>&gt;&gt;&gt;<i>#3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
</I>&gt;&gt;&gt;<i>#4  0xb7f69e51 in pthread_start_thread_event ()
</I>&gt;&gt;&gt;<i>from /lib/i686/libpthread.so.0
</I>&gt;&gt;&gt;<i>#5  0xb7e0913a in clone () from /lib/i686/libc.so.6
</I>&gt;&gt;&gt;<i>(gdb)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Sorry, right now I can't say why this happend. Can you tell me a bit 
</I>&gt;&gt;<i>more about how you produced this crash? Is it reproducible? Can you 
</I>&gt;&gt;<i>print the line where the softdevice crashed? Did you check the messages 
</I>&gt;&gt;<i>in the syslog?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> It appears it's the ic-&gt;streams[pkt.stream_index]-&gt;codec reference that
</I>&gt;<i> causes a segfault.
</I>&gt;<i> 
</I>&gt;<i> 
</I>Still very strange... Did you change the version of ffmpeg? The 
structure ic should be initialized by libavformat in initputbyte and new 
streams should be added in av_read_packet, so this is not in the 
responsibility of the softdevice. However we could overwrite ic 
somewhere, or feed screwed up data to libavformat..
Which version of the softdevice did you use previously? Can you please 
try to go back in the CVS and try to identify the change which breaks 
the softdevice?
What also puzzels me is that the decoder is started and stoped again 
before it could process any data. And on the second try it crashes...
Sorry, I still have no clue :-(

Martin

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000435.html">[Softdevice-devel] crash with latest cvs code
</A></li>
	<LI>Next message: <A HREF="000440.html">[Softdevice-devel] crash with latest cvs code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#436">[ date ]</a>
              <a href="thread.html#436">[ thread ]</a>
              <a href="subject.html#436">[ subject ]</a>
              <a href="author.html#436">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/softdevice-devel">More information about the Softdevice-devel
mailing list</a><br>
</body></html>
