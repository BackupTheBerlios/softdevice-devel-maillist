From torgeir at pobox.com  Wed Jan  3 00:14:12 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 2 Jan 2007 23:14:12 +0000
Subject: [Softdevice-devel] high cpu usage with g540 pci
Message-ID: <F63BBA39-932E-4A01-B5BC-1EC98BA8AF7B@pobox.com>

I recently swapped out a Matrox AGP G550 with a PCI G450 card since  
the former had bad colour output, and I'm now getting quite high CPU  
usage, in the area of 60% to 80% utilization. My cpu is an Athlon XP  
2500+ on a nforce2 MB.

Is this normal utilization with a pci card? I'm outputting composite  
video using crtc2 in 720x576, with the exact same configuration as  
the G550 was set up with. Any hints on where I can look for bottlenecks?


-- 
Torgeir Veimo
torgeir at pobox.com





From bob at globall.ru  Tue Jan 16 12:31:39 2007
From: bob at globall.ru (Vladimir Monchenko)
Date: Tue, 16 Jan 2007 11:31:39 +0000
Subject: [Softdevice-devel] Softplay and mp3
Message-ID: <45ACB79B.4010505@globall.ru>

Hi!

I have a trouble with softplay and mp3 files. In single file mode mp3
files do not play to the end, but decide on the middle of file. In
playlist mode mp3 files are played by the to half of file and jump over
on a next file from playlist. Softdevice and softplay taken from cvs
10th January 2007. It is tested on two machines - VIA Epia ME6000 and
AMD64 3500+.

Regards,
Vladimir Monchenko.


From torgeir at pobox.com  Sun Jan 21 11:52:55 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 21 Jan 2007 10:52:55 +0000
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
Message-ID: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>

If you're struggling with bad lip sync using either mgatv or viatv  
output, try applying this patch to reduce the allowed difference  
between audio and video;

[root at htpc softdevice]# cvs diff -u mpeg2decoder.c
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.70
diff -u -r1.70 mpeg2decoder.c
--- mpeg2decoder.c      7 Nov 2006 19:01:37 -0000       1.70
+++ mpeg2decoder.c      21 Jan 2007 10:50:08 -0000
@@ -923,7 +923,7 @@
    else if (delay < -frametime()*100)
      delay = -frametime()*100;
-  if (offset >  8*frametime())
+  if (offset >  3*frametime())
       hurry_up=1;
    else if ( (offset < 2*frametime()) && (hurry_up > 0) )
       hurry_up=0;

You might get some slightly more judder from this though.

-- 
Torgeir Veimo
torgeir at pobox.com





From torgeir at pobox.com  Sun Jan 21 21:39:36 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 21 Jan 2007 20:39:36 +0000
Subject: [Softdevice-devel] high cpu usage with g540 pci
Message-ID: <38E876B1-850D-42DA-BA2B-AC57C7CF4FC1@pobox.com>

 > I recently swapped out a Matrox AGP G550 with a PCI G450 card since
 > the former had bad colour output, and I'm now getting quite high CPU
 > usage, in the area of 60% to 80% utilization.
 >
 > Is this normal utilization with a pci card?

I fixed this by updating to DirectFB-cvs. Seems the interlaced output  
changes from July fixed it; CPU utilisation is now down to just under  
30% again.

-- 
Torgeir Veimo
torgeir at pobox.com





From stefan at lucke.in-berlin.de  Mon Jan 22 21:26:58 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 22 Jan 2007 21:26:58 +0100
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
Message-ID: <200701222126.58727.stefan@lucke.in-berlin.de>

On Sonntag 21 Januar 2007 11:52, Torgeir Veimo wrote:
> If you're struggling with bad lip sync using either mgatv or viatv  
> output, try applying this patch to reduce the allowed difference  
> between audio and video;

I'm seeing a similar problem with my G400.
But I reduced the skip limit from 8 to 6. Prehaps I should reduce it more.
Further I added some logging:
Jan 22 21:04:44 bodega1 vdr: [6464] [mpeg2decoder] skipped (10, 210 [2490 -> 586])
Jan 22 21:05:59 bodega1 vdr: [6464] [mpeg2decoder] skipped (9, 171 [2530 -> 613])
Jan 22 21:07:01 bodega1 vdr: [6464] [mpeg2decoder] skipped (10, 209 [2567 -> 655])
Jan 22 21:08:11 bodega1 vdr: [6464] [mpeg2decoder] skipped (9, 170 [2608 -> 707])

So my system skips around 9 to 10 frames per minute.
60 * 25 = 1500 frames.
So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .

I guess I've to ask Ville if there is a way to increase the dot clock 
of my card in some way.

diff to get the numbers:
? dfb_report_skipped-01.diff
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.70
diff -U3 -r1.70 mpeg2decoder.c
--- mpeg2decoder.c	7 Nov 2006 19:01:37 -0000	1.70
+++ mpeg2decoder.c	22 Jan 2007 20:22:07 -0000
@@ -923,10 +923,28 @@
   else if (delay < -frametime()*100)
     delay = -frametime()*100;
 
-  if (offset >  8*frametime())
-     hurry_up=1;
-  else if ( (offset < 2*frametime()) && (hurry_up > 0) )
-     hurry_up=0;
+  {
+      static uint64_t skip_time = 0;
+      static int      frames_skipped = 0,
+                      start_offset = 0;
+
+    if (hurry_up)
+      frames_skipped++;
+
+    if (offset >  6*frametime()) {
+      if (!hurry_up) {
+        frames_skipped = 0;
+        start_offset = offset;
+        skip_time = getTimeMilis();
+      }
+      hurry_up=1;
+    } else if ( (offset < 2*frametime()) && (hurry_up > 0) ) {
+      hurry_up=0;
+      skip_time = getTimeMilis() - skip_time;
+      dsyslog ("[mpeg2decoder] skipped (%d, %lld [%d -> %d])",
+               frames_skipped, skip_time, start_offset, offset);
+    }
+  }
 
 #if 1
   int dispTime=syncTimer->GetRelTime();

-- 
Stefan Lucke


From torgeir at pobox.com  Tue Jan 23 01:25:36 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 23 Jan 2007 00:25:36 +0000
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <200701222126.58727.stefan@lucke.in-berlin.de>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<200701222126.58727.stefan@lucke.in-berlin.de>
Message-ID: <53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>


On 22 Jan 2007, at 20:26, Stefan Lucke wrote:

> On Sonntag 21 Januar 2007 11:52, Torgeir Veimo wrote:
>> If you're struggling with bad lip sync using either mgatv or viatv
>> output, try applying this patch to reduce the allowed difference
>> between audio and video;
>
> I'm seeing a similar problem with my G400.
> But I reduced the skip limit from 8 to 6. Prehaps I should reduce  
> it more.
> Further I added some logging:
> Jan 22 21:04:44 bodega1 vdr: [6464] [mpeg2decoder] skipped (10, 210  
> [2490 -> 586])
> Jan 22 21:05:59 bodega1 vdr: [6464] [mpeg2decoder] skipped (9, 171  
> [2530 -> 613])
> Jan 22 21:07:01 bodega1 vdr: [6464] [mpeg2decoder] skipped (10, 209  
> [2567 -> 655])
> Jan 22 21:08:11 bodega1 vdr: [6464] [mpeg2decoder] skipped (9, 170  
> [2608 -> 707])
>
> So my system skips around 9 to 10 frames per minute.
> 60 * 25 = 1500 frames.
> So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
>
> I guess I've to ask Ville if there is a way to increase the dot clock
> of my card in some way.

This assumes your soundcard is perfectly clocked to the incoming DVB  
stream? I'd assume that eventually if the soundcard is a bit faster  
than the DVB stream, you'd get an xrun. Maybe it's an idea to add  
xrun counts as well.

Another thing which would be good to get statistics about: the  
average number of "hurryup"s after a channel change.

-- 
Torgeir Veimo
torgeir at pobox.com





From stefan at lucke.in-berlin.de  Wed Jan 24 21:01:24 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 24 Jan 2007 21:01:24 +0100
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<200701222126.58727.stefan@lucke.in-berlin.de>
	<53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>
Message-ID: <200701242101.24316.stefan@lucke.in-berlin.de>

On Dienstag 23 Januar 2007 01:25, Torgeir Veimo wrote:
> On 22 Jan 2007, at 20:26, Stefan Lucke wrote:

> > So my system skips around 9 to 10 frames per minute.
> > 60 * 25 = 1500 frames.
> > So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
> >
> > I guess I've to ask Ville if there is a way to increase the dot clock
> > of my card in some way.
> 
> This assumes your soundcard is perfectly clocked to the incoming DVB  
> stream? I'd assume that eventually if the soundcard is a bit faster  
> than the DVB stream, you'd get an xrun. Maybe it's an idea to add  
> xrun counts as well.

Yes, there are e few assumptions which may slightly influence calculation.
These numbers are from recording playback. During live view, they are
a bit different, but the direction is the same.

The other way, we have to issue additional delays, because of some
errors we lost about 9 frames is bad too. Let's look at the code:

1. calculate current audio / video offset:
  if ( aPTS )
    offset = aPTS - pts ;
  else offset = 0;
  if ( abs(offset) > 100000)
          offset=0;

To my opinion thats ok.

  // this few lines does the whole syncing
  int pts_corr;

Bad thing starts here. Only 1/10 of offset is taken into account
for further calcs.

  // calculate pts correction. Correct 1/10 of offset at a time
  pts_corr = offset/10;

Even worse, correction value is clamped to +/- 2/10 frametime for
next frame delay calculation.
To understand that this is bad, you haave to remember that directfb ouput
ingores all delays which are lower than one frame duration of out device.

  //Max. correction is 2/10 frametime.
  if (pts_corr > 2*frametime() / 10 )
    pts_corr = 2*frametime() / 10;
  else if (pts_corr < -2*frametime() / 10 )
    pts_corr = -2*frametime() / 10;

  // calculate delay
  delay += ( frametime() - pts_corr  ) * 100;
  // update video pts
  pts += frametime();

Again clamping. Negative delays are out of interest. Positive delays are
limited to 2 frames which is ok to my opinion.

  if (delay > 2*frametime()*100)
    delay = 2*frametime()*100;
  else if (delay < -frametime()*100)
    delay = -frametime()*100;

Finally I guess this handling should be delegated to the output device,
as there might be the chance that it could adjust the frame rate on demand.
I like to have a calculation of a floating average of offset values, and let
the device make it's own decitions of further actions:

videoOut->EvaluateDelay (offset, frametime(), &delay, &hurry_up);

> 
> Another thing which would be good to get statistics about: the  
> average number of "hurryup"s after a channel change.
> 

After a channel change, I think we issue delays instead of hurryups.

-- 
Stefan Lucke


From torgeir at pobox.com  Wed Jan 24 22:45:28 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 24 Jan 2007 21:45:28 +0000
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <200701242101.24316.stefan@lucke.in-berlin.de>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<200701222126.58727.stefan@lucke.in-berlin.de>
	<53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>
	<200701242101.24316.stefan@lucke.in-berlin.de>
Message-ID: <5F3B6E5C-52B0-4CAB-A31C-042D00ADFC10@pobox.com>


On 24 Jan 2007, at 20:01, Stefan Lucke wrote:

> On Dienstag 23 Januar 2007 01:25, Torgeir Veimo wrote:
>> On 22 Jan 2007, at 20:26, Stefan Lucke wrote:
>
>>> So my system skips around 9 to 10 frames per minute.
>>> 60 * 25 = 1500 frames.
>>> So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
>>>
>>> I guess I've to ask Ville if there is a way to increase the dot  
>>> clock
>>> of my card in some way.
>>
>> This assumes your soundcard is perfectly clocked to the incoming DVB
>> stream? I'd assume that eventually if the soundcard is a bit faster
>> than the DVB stream, you'd get an xrun. Maybe it's an idea to add
>> xrun counts as well.
>
> Yes, there are e few assumptions which may slightly influence  
> calculation.
> These numbers are from recording playback. During live view, they are
> a bit different, but the direction is the same.
>
> The other way, we have to issue additional delays, because of some
> errors we lost about 9 frames is bad too. Let's look at the code:
>
> 1. calculate current audio / video offset:
>   if ( aPTS )
>     offset = aPTS - pts ;
>   else offset = 0;
>   if ( abs(offset) > 100000)
>           offset=0;
>
> To my opinion thats ok.

Maybe use the term delay instead of offset. Eg. choosing the term "A/ 
V Offset" in the setup was a bad choice of me.

[...]

>> Another thing which would be good to get statistics about: the
>> average number of "hurryup"s after a channel change.
>
> After a channel change, I think we issue delays instead of hurryups.

Are you sure? Where's the code for that?

I think it would be interesting to gather audio clock to DVB signal  
clock drift over time and reprogram the audio output, if it has the  
capability to do so. I think AC '97 compatible hardware has a  
software programmable clock, but I'm not sure if it can be set using  
an ioctl.

Additionally, why don't we try to make use of the available vsync  
interrupt on the matroxfb in SyncTimer.c, when we don't use  
DSFLIP_WAITFORSYNC?.

For reference, here's five minutes of log from my system. Maybe my  
modeline is not properly adjusted to the DVB clock.

Jan 24 21:35:25 htpc vdr: [19793] frontend 1 timed out while tuning  
to channel 9, tp 578
Jan 24 21:35:28 htpc vdr: [25708] [mpeg2decoder] skipped (5, 83 [2659  
-> 659])
Jan 24 21:36:18 htpc vdr: [25708] [mpeg2decoder] skipped (5, 84 [2409  
-> 409])
Jan 24 21:37:07 htpc vdr: [25708] [mpeg2decoder] skipped (5, 120  
[2409 -> 409])
Jan 24 21:38:52 htpc kernel: cx88[1]/2-mpeg: cx8802_timeout
Jan 24 21:38:53 htpc vdr: [25708] [mpeg2decoder] skipped (8, 163  
[2409 -> 459])
Jan 24 21:39:00 htpc vdr: [19793] frontend 1 timed out while tuning  
to channel 9, tp 578
Jan 24 21:41:44 htpc kernel: cx88[1]/2-mpeg: cx8802_timeout
Jan 24 21:41:51 htpc vdr: [25708] [mpeg2decoder] skipped (5, 85 [2509  
-> 509])
Jan 24 21:41:52 htpc vdr: [19793] frontend 1 timed out while tuning  
to channel 9, tp 578

-- 
Torgeir Veimo
torgeir at pobox.com





From stefan at lucke.in-berlin.de  Wed Jan 24 23:58:27 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 24 Jan 2007 23:58:27 +0100
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <5F3B6E5C-52B0-4CAB-A31C-042D00ADFC10@pobox.com>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<200701242101.24316.stefan@lucke.in-berlin.de>
	<5F3B6E5C-52B0-4CAB-A31C-042D00ADFC10@pobox.com>
Message-ID: <200701242358.28010.stefan@lucke.in-berlin.de>

On Mittwoch 24 Januar 2007 22:45, Torgeir Veimo wrote:
> 
> On 24 Jan 2007, at 20:01, Stefan Lucke wrote:
> 
> > On Dienstag 23 Januar 2007 01:25, Torgeir Veimo wrote:
> >> On 22 Jan 2007, at 20:26, Stefan Lucke wrote:
> >
> >>> So my system skips around 9 to 10 frames per minute.
> >>> 60 * 25 = 1500 frames.
> >>> So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
> >>>
> >>> I guess I've to ask Ville if there is a way to increase the dot  
> >>> clock
> >>> of my card in some way.
> >>
> >> This assumes your soundcard is perfectly clocked to the incoming DVB
> >> stream? I'd assume that eventually if the soundcard is a bit faster
> >> than the DVB stream, you'd get an xrun. Maybe it's an idea to add
> >> xrun counts as well.
> >
> > Yes, there are e few assumptions which may slightly influence  
> > calculation.
> > These numbers are from recording playback. During live view, they are
> > a bit different, but the direction is the same.
> >
> > The other way, we have to issue additional delays, because of some
> > errors we lost about 9 frames is bad too. Let's look at the code:
> >
> > 1. calculate current audio / video offset:
> >   if ( aPTS )
> >     offset = aPTS - pts ;
> >   else offset = 0;
> >   if ( abs(offset) > 100000)
> >           offset=0;
> >
> > To my opinion thats ok.
> 
> Maybe use the term delay instead of offset. Eg. choosing the term "A/ 
> V Offset" in the setup was a bad choice of me.
> 
> [...]
> 
> >> Another thing which would be good to get statistics about: the
> >> average number of "hurryup"s after a channel change.
> >
> > After a channel change, I think we issue delays instead of hurryups.
> 
> Are you sure? Where's the code for that?

So after above code I inserted the following conditional fprintf.
traceCounter is reset in constructor of cVideoStreamDecoder, needs to be
defined in mpeg2decoder.h too.

          offset=0;

if (traceCounter < 100) {
fprintf (stderr, "%d offset = %d\n", traceCounter, offset);
++traceCounter;
}

  // this few lines does the whole syncing

0 offset = 0
1 offset = -400
2 offset = -400
3 offset = -400
4 offset = -400
5 offset = -5519
6 offset = -5492
7 offset = -5465
..
75 offset = -239
76 offset = -425
77 offset = -185
78 offset = -159
79 offset = -132
80 offset = -105
81 offset = -292
82 offset = -52
83 offset = -25
84 offset = 1

First positive number is after 85 frames. Thats a short test from xv-out.

positive numbers -> frame drop.
negative numbers -> frame repeat.

> 
> I think it would be interesting to gather audio clock to DVB signal  
> clock drift over time and reprogram the audio output, if it has the  
> capability to do so. I think AC '97 compatible hardware has a  
> software programmable clock, but I'm not sure if it can be set using  
> an ioctl.

If sound cards would have the possibility to adjust the pll clock would
be really nice, but I've never found a hint to do this. 
Resampling for stereo could do a similar thing, but AC3 pass through ?
Decode -> Resample -> Encode :-( .

> 
> Additionally, why don't we try to make use of the available vsync  
> interrupt on the matroxfb in SyncTimer.c, when we don't use  
> DSFLIP_WAITFORSYNC?.
> 
> For reference, here's five minutes of log from my system. Maybe my  
> modeline is not properly adjusted to the DVB clock.

The tv-out feature of matrox tv-out is not based on modelines :-) .

-- 
Stefan Lucke


From M.Wache at gmx.net  Thu Jan 25 00:29:59 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 25 Jan 2007 00:29:59 +0100
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <200701242101.24316.stefan@lucke.in-berlin.de>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<200701222126.58727.stefan@lucke.in-berlin.de>
	<53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>
	<200701242101.24316.stefan@lucke.in-berlin.de>
Message-ID: <20070124232959.226430@gmx.net>

> On Dienstag 23 Januar 2007 01:25, Torgeir Veimo wrote:
> > On 22 Jan 2007, at 20:26, Stefan Lucke wrote:
> 
> > > So my system skips around 9 to 10 frames per minute.
> > > 60 * 25 = 1500 frames.
> > > So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
> > >
> > > I guess I've to ask Ville if there is a way to increase the dot clock
> > > of my card in some way.
> > 
> > This assumes your soundcard is perfectly clocked to the incoming DVB  
> > stream? I'd assume that eventually if the soundcard is a bit faster  
> > than the DVB stream, you'd get an xrun. Maybe it's an idea to add  
> > xrun counts as well.
> 
> Yes, there are e few assumptions which may slightly influence calculation.
> These numbers are from recording playback. During live view, they are
> a bit different, but the direction is the same.
> 
> The other way, we have to issue additional delays, because of some
> errors we lost about 9 frames is bad too. Let's look at the code:
> 
> 1. calculate current audio / video offset:
>   if ( aPTS )
>     offset = aPTS - pts ;
>   else offset = 0;
>   if ( abs(offset) > 100000)
>           offset=0;
> 
> To my opinion thats ok.
> 
>   // this few lines does the whole syncing
>   int pts_corr;
> 
> Bad thing starts here. Only 1/10 of offset is taken into account
> for further calcs.
>
Not taking the full offset into account is necessary, because otherwise
there is a risk of getting oscilations. So one has to damp the system,
and to do this the best way is to correct only small amounts of the offset.
 
> Even worse, correction value is clamped to +/- 2/10 frametime for
> next frame delay calculation.
> To understand that this is bad, you haave to remember that directfb ouput
> ingores all delays which are lower than one frame duration of out device.
> 
Well, it might be bad for directfb, but what about Xv, Vidix and Framebuffer? In my opinion the a/v sync for Xv is quite good, there
might be still some constant offset, but at least the syncing is very 
smooth and you don't get any judder. So I want to ask you not to break 
this for the other video out methods..
Anyway, if you want to have a smooth adjustment of the A/V sync I think
clamping there is necessary. 

>   //Max. correction is 2/10 frametime.
>   if (pts_corr > 2*frametime() / 10 )
>     pts_corr = 2*frametime() / 10;
>   else if (pts_corr < -2*frametime() / 10 )
>     pts_corr = -2*frametime() / 10;
> 
>   // calculate delay
>   delay += ( frametime() - pts_corr  ) * 100;
>   // update video pts
>   pts += frametime();
> 
> Again clamping. Negative delays are out of interest. Positive delays are
> limited to 2 frames which is ok to my opinion.
> 
>   if (delay > 2*frametime()*100)
>     delay = 2*frametime()*100;
>   else if (delay < -frametime()*100)
>     delay = -frametime()*100;
> 
> Finally I guess this handling should be delegated to the output device,
> as there might be the chance that it could adjust the frame rate on
> demand.

I guess that this would best if DirectFB wants to implement syncing on
the graphics card. But I want to remind you that if you sync on the graphics card, you will usually not get a better average a/v sync t
han +- 10ms, because the bad resolution. 
Maybe it is anyway better to switch to sync the audio to the video by
resampling the audio. Of course that not possible for AC3 pass through, 
but I guess there the A/V sync is anyway worse...

> I like to have a calculation of a floating average of offset values, and
> let

A floating average hides oscilations of the a/v sync and the result
would be similar only correct a small part of the offset at a time.

> the device make it's own decitions of further actions:
> 
> videoOut->EvaluateDelay (offset, frametime(), &delay, &hurry_up);
> 
I would suggest that cVideo gets access to cClock and does the syncing all
by itself (and all the syncing code is removed from mpeg2decoder.c). It
already has the pts values of the frames, so it doesn't need
frametime(), and it can maintain its own delay. I'm not sure if a
hurry_up is necessary, but if so the Mpeg2Decoder could poll a variable
from cVideo..

Bye,
Martin
-- 
"Feel free" - 10 GB Mailbox, 100 FreeSMS/Monat ...
Jetzt GMX TopMail testen: http://www.gmx.net/de/go/topmail


From nicolas at huillard.net  Thu Jan 25 13:55:35 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Thu, 25 Jan 2007 13:55:35 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
Message-ID: <45B8A8C7.1060201@huillard.net>

Hi all,

I just tested a bit more on the field parity issue on my EPIA M10k /
CLE266. I updated many things on my production system.

I now have no field parity issues, when using software decoding on the
EPIA board. Interlaced content is OK on this.
There is just a few artifacts during the first few seconds after tuning
to a channel : maybe dropped frames do not take parity into account
(since you're on this topic on the "improved lip sync with mgatv and
viatv" thread, maybe that's something to investigate).

When using hardware decoding, though, the parity issue comes back (with
"-vo dfb:viatv:cle266" instead of "-vo dfb:viatv") : scrolling text is
awfully jerky on channels like Bloomberg.

Just to be sure : does anyone have this issue when using CLE266 hardware
decoding, or must I dig into versions, patches et al. and solve it ?

viafb 2006-10-08
DirectFB 1.0.0rc2 patched for field parity ioctl
DFB++ 2007-01-24
libcle266mpegdec 0.5
softdevice 0.3.1
VDR 1.4.5

(I just mentionned a 3-weeks-old CVS update to viafb from Mark Adams :
"Added new ioctl to allow accurately timed flipping of the video
overlay. This is required to avoid occasional glitches when outputting
interlaced video through the TV out." May not be used by older 0.3.1
softdevice code, though)

TIA,

-- 
NH


From laz at club-burniston.co.uk  Thu Jan 25 14:15:08 2007
From: laz at club-burniston.co.uk (Laz)
Date: Thu, 25 Jan 2007 13:15:08 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <45B8A8C7.1060201@huillard.net>
References: <45B8A8C7.1060201@huillard.net>
Message-ID: <200701251315.08269.laz@club-burniston.co.uk>

On Thursday 25 January 2007 12:55, Nicolas Huillard wrote:
> Hi all,
>
> I just tested a bit more on the field parity issue on my EPIA M10k /
> CLE266. I updated many things on my production system.
>
> I now have no field parity issues, when using software decoding on the
> EPIA board. Interlaced content is OK on this.
> There is just a few artifacts during the first few seconds after tuning
> to a channel : maybe dropped frames do not take parity into account
> (since you're on this topic on the "improved lip sync with mgatv and
> viatv" thread, maybe that's something to investigate).
>
> When using hardware decoding, though, the parity issue comes back (with
> "-vo dfb:viatv:cle266" instead of "-vo dfb:viatv") : scrolling text is
> awfully jerky on channels like Bloomberg.
>
> Just to be sure : does anyone have this issue when using CLE266
> hardware decoding, or must I dig into versions, patches et al. and
> solve it ?
>
> viafb 2006-10-08
> DirectFB 1.0.0rc2 patched for field parity ioctl
> DFB++ 2007-01-24
> libcle266mpegdec 0.5
> softdevice 0.3.1
> VDR 1.4.5
>
> (I just mentionned a 3-weeks-old CVS update to viafb from Mark Adams :
> "Added new ioctl to allow accurately timed flipping of the video
> overlay. This is required to avoid occasional glitches when outputting
> interlaced video through the TV out." May not be used by older 0.3.1
> softdevice code, though)

Is viafb patched to actually "listen for" the synching ioctl?

I'm using vdr-1.5.0 with softdevice cvs from last October (patched with 
the lip-sync patch from yesterday), DirectFB, DFB++, and viafb from cvs 
back from last October (with Mark Adams' patches from a long while back), 
and libcle266mpegdec 0.5.

I'm running vdr with "-vo dfb:viatv:cle266" and TV-out to connect to a CRT 
TV and, apart from the odd glitches and A-V sync wandering a bit, I get 
nice, smooth scrolling text (BBC News 24 is good for testing this!).

If I get a chance this weekend, I might have a go at upgrading some bits 
to see if something has changed to break this...

Cheers,

Laz


From nicolas at huillard.net  Thu Jan 25 16:09:23 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Thu, 25 Jan 2007 16:09:23 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
 cle266 HW decoding
In-Reply-To: <200701251315.08269.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net>
	<200701251315.08269.laz@club-burniston.co.uk>
Message-ID: <45B8C823.7090004@huillard.net>

Laz a ?crit :
>>viafb 2006-10-08
>>DirectFB 1.0.0rc2 patched for field parity ioctl
>>DFB++ 2007-01-24
>>libcle266mpegdec 0.5
>>softdevice 0.3.1
>>VDR 1.4.5
> 
> Is viafb patched to actually "listen for" the synching ioctl?

I'm using viafb from DirectFB CVS 2006-10-08, which seems to be the
lastest one.

Maybe you're talking about this patch to DirectFB, which makes DFB talk
to viafb's ioctl :
http://www.directfb.org/index.php/viewcvs.cgi/linux-viafb/patches/directfb-viafb-assisted-field-parity.patch?rev=1.1&content-type=text/vnd.viewcvs-markup

Yes, I'm using it, in an older form, which seems to be the same, tough.

Software decoding leaves no interlacing artifacts, so it should be OK on
the lower levels (DirectFB / viafb).

> I'm using vdr-1.5.0 with softdevice cvs from last October (patched with 
> the lip-sync patch from yesterday), DirectFB, DFB++, and viafb from cvs 
> back from last October (with Mark Adams' patches from a long while back), 
> and libcle266mpegdec 0.5.

Can you elaborate on DirectFB/DFB++ versions ?
It seems we have quite the same setup. You also said earlier that field
parity works for you since a long time, with earlier versions.

> I'm running vdr with "-vo dfb:viatv:cle266" and TV-out to connect to a CRT 
> TV and, apart from the odd glitches and A-V sync wandering a bit, I get 
> nice, smooth scrolling text (BBC News 24 is good for testing this!).

What kernel version do you run ?

> If I get a chance this weekend, I might have a go at upgrading some bits 
> to see if something has changed to break this...

If you could recall all patches you applied to everything, that could
help. Not that much, these times, I think.
I only patched DirectFB with something named
"dfb_unichrome_flip_ioctl-libcle266mpegdec" from Mark Adams, which
happens to be the one in linux-viafb CVS now (commited by Mark, BTW).

-- 
NH


From laz at club-burniston.co.uk  Thu Jan 25 17:56:45 2007
From: laz at club-burniston.co.uk (Laz)
Date: Thu, 25 Jan 2007 16:56:45 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <45B8C823.7090004@huillard.net>
References: <45B8A8C7.1060201@huillard.net>
	<200701251315.08269.laz@club-burniston.co.uk>
	<45B8C823.7090004@huillard.net>
Message-ID: <200701251656.45118.laz@club-burniston.co.uk>

On Thursday 25 January 2007 15:09, Nicolas Huillard wrote:
> Laz a ?crit :
> >>viafb 2006-10-08
> >>DirectFB 1.0.0rc2 patched for field parity ioctl
> >>DFB++ 2007-01-24
> >>libcle266mpegdec 0.5
> >>softdevice 0.3.1
> >>VDR 1.4.5
> >
> > Is viafb patched to actually "listen for" the synching ioctl?
>
> I'm using viafb from DirectFB CVS 2006-10-08, which seems to be the
> lastest one.

Looks like my version of viafb is from cvs on 2006-10-24.

> Maybe you're talking about this patch to DirectFB, which makes DFB talk
> to viafb's ioctl :
> http://www.directfb.org/index.php/viewcvs.cgi/linux-viafb/patches/direc
>tfb-viafb-assisted-field-parity.patch?rev=1.1&content-type=text/vnd.view
>cvs-markup
>
> Yes, I'm using it, in an older form, which seems to be the same, tough.
>
> Software decoding leaves no interlacing artifacts, so it should be OK
> on the lower levels (DirectFB / viafb).

There is a patch to DirectFB which sends the FBIO_FLIPONVSYNC ioctl and a 
patch to viafb which "looks out for it". Looks like I still needed to 
patch viafb from 2006-10-24. Try doing:

$ grep FBIO_FLIPONVSYNC linux-viafb/linux/drivers/video/c
le266/via_fbobj.c

I get:
#ifndef FBIO_FLIPONVSYNC
#define FBIO_FLIPONVSYNC    _IOWR('F', 0x21, struct fb_flip)
        case FBIO_FLIPONVSYNC:

with my (patched) version. Not sure whether this ever made it into 
linux-viafb cvs or not: I think Mark was going to rewrite it as less of a 
hack! I have found two versions of this patch, one from August 2005 and 
one dated 2006-10-24 (not sure whether I made the new one by patching by 
hand or Mark posted a new version). I can post this on here, if you like.

If your viafb is from earlier than mine then it will need the patch (maybe 
it has now made it into cvs if the DirectFB patch is in there now...see 
below).

> > I'm using vdr-1.5.0 with softdevice cvs from last October (patched
> > with the lip-sync patch from yesterday), DirectFB, DFB++, and viafb
> > from cvs back from last October (with Mark Adams' patches from a long
> > while back), and libcle266mpegdec 0.5.
>
> Can you elaborate on DirectFB/DFB++ versions ?
> It seems we have quite the same setup. You also said earlier that field
> parity works for you since a long time, with earlier versions.

Looking more closely, I _think_ DirectFB and DFB++ are both cvs from 
2006-04-18. I have lots of different cvs trees which I really should 
clean out.

> > I'm running vdr with "-vo dfb:viatv:cle266" and TV-out to connect to
> > a CRT TV and, apart from the odd glitches and A-V sync wandering a
> > bit, I get nice, smooth scrolling text (BBC News 24 is good for
> > testing this!).
>
> What kernel version do you run ?

It is currently running a 2.6.18.1 kernel.

> > If I get a chance this weekend, I might have a go at upgrading some
> > bits to see if something has changed to break this...
>
> If you could recall all patches you applied to everything, that could
> help. Not that much, these times, I think.
> I only patched DirectFB with something named
> "dfb_unichrome_flip_ioctl-libcle266mpegdec" from Mark Adams, which
> happens to be the one in linux-viafb CVS now (commited by Mark, BTW).

My cvs version of linux-viafb does not contain the patch (sounds like I 
was a couple of weeks early for that!).

The only patches I have are named:

dfb_unichrome_flip_ioctl.patch dated 2006-08-14 (presumably close to the 
one now in linux-viafb cvs) and viafb_flip_ioctl.patch dated 2006-10-24.

Just had a quick look at directfb.org and it would appear that Mark added 
the patch (or something looking very similar) a few days back:

http://www.directfb.org/index.php/viewcvs.cgi/linux-viafb/linux/drivers/video/cle266/via_fbobj.c

Your best bet may be to check out a new version of linux-viafb and see if 
that sorts it out.

As you can see, I haven't really touched much for a while because it has 
been working quite well. I will have a go at updating DirectFB, DFB++, 
and linux-viafb to the current CVS versions this weekend and see if 
anything breaks for me!

Cheers,

Laz


From nicolas at huillard.net  Fri Jan 26 11:33:25 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Fri, 26 Jan 2007 11:33:25 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
 cle266 HW decoding
In-Reply-To: <200701251656.45118.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net>	<200701251315.08269.laz@club-burniston.co.uk>	<45B8C823.7090004@huillard.net>
	<200701251656.45118.laz@club-burniston.co.uk>
Message-ID: <45B9D8F5.9050008@huillard.net>

Laz a ?crit :
> On Thursday 25 January 2007 15:09, Nicolas Huillard wrote:
> 
>>Maybe you're talking about this patch to DirectFB, which makes DFB talk
>>to viafb's ioctl :
>>http://www.directfb.org/index.php/viewcvs.cgi/linux-viafb/patches/direc
>>tfb-viafb-assisted-field-parity.patch?rev=1.1&content-type=text/vnd.view
>>cvs-markup
>>
>>Yes, I'm using it, in an older form, which seems to be the same, tough.
> 
> There is a patch to DirectFB which sends the FBIO_FLIPONVSYNC ioctl and a 
> patch to viafb which "looks out for it". Looks like I still needed to 
> patch viafb from 2006-10-24. Try doing:
> 
> $ grep FBIO_FLIPONVSYNC linux-viafb/linux/drivers/video/c
> le266/via_fbobj.c
> 
> I get:
> #ifndef FBIO_FLIPONVSYNC
> #define FBIO_FLIPONVSYNC    _IOWR('F', 0x21, struct fb_flip)
>         case FBIO_FLIPONVSYNC:

I actually have the same output, and reading further my notes from
10-2006, I can see I added the same patch, your already at that time
sent me.

> Looking more closely, I _think_ DirectFB and DFB++ are both cvs from 
> 2006-04-18. I have lots of different cvs trees which I really should 
> clean out.

My problem may be a regression in DirectFB, then. It may also be that I
badly applied the patch to DirectFB.

> It is currently running a 2.6.18.1 kernel.

2.6.17 is not that different.

> Your best bet may be to check out a new version of linux-viafb and see if 
> that sorts it out.

I'll do that. And also add printk as Mark Adams suggested a (long) while
ago.
I'll keep you all updated on this.

BTW : does anyone else use CLE266 hardware decoding and TV-out with
softdevice (out of the 500+ downloads of libcle266mpegdec) ?

-- 
NH


From laz at club-burniston.co.uk  Fri Jan 26 13:15:07 2007
From: laz at club-burniston.co.uk (Laz)
Date: Fri, 26 Jan 2007 12:15:07 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <45B9D8F5.9050008@huillard.net>
References: <45B8A8C7.1060201@huillard.net>
	<200701251656.45118.laz@club-burniston.co.uk>
	<45B9D8F5.9050008@huillard.net>
Message-ID: <200701261215.07603.laz@club-burniston.co.uk>

On Friday 26 January 2007 10:33, Nicolas Huillard wrote:
> > Looking more closely, I _think_ DirectFB and DFB++ are both cvs from
> > 2006-04-18. I have lots of different cvs trees which I really should
> > clean out.
>
> My problem may be a regression in DirectFB, then. It may also be that I
> badly applied the patch to DirectFB.

I'm just building cvs DirectFB and DFB++ (as Debian packages) and I've 
just remembered another couple of patches: libcle266mpegdec needs to get 
the offset of the framebuffer from DirectFB. Looks like they are no 
longer needed because the code is now in DirectFB and DFB++!

:)

Hmmmm...just built and installed DirectFB, DFB++, and linux-viafb, then 
rebuilt libcle266mpegdec and softdevice against the new versions. Now 
when I try to start vdr, I get:

vdr-1.5.0 --video=/video --config=/home/vdr/vdrconf --lib=/home/vdr/plugins -P'softdevice -vo 
dfb:viatv:cle266'
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
vo_argv: dfb:viatv:cle266
[softdevice] enabling field parity
[softdevice] enabling CLE266 HW decoding
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to pseudo
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 50
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3344640)
[dfb] init

     =======================|  DirectFB 1.0.0-rc3  |
=======================
          (c) 2001-2006  United Cultures of Earth - go for outer space!
          (c) 2000-2004  Convergence (integrated media) GmbH
        ----------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-01-26 10:52)
(*) Direct/Modules: suppress module 'linux_input'
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.3 (directfb.org)
[dfb] RAM: 66842624 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine 
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend Xor
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize 
SrcColorkey DstColorkey Deinterlace
[dfb] Supported video Modes are: 720x576 at 32
[dfb] Enumerating display Layers
[dfb] Configuring CooperativeLevel for OSD
Layer 0 VIA CLE266 Graphics  Type: graphics
  Caps: alphachannel brightness contrast opacity saturation src_colorkey 
surface
Layer 1 VIA Unichrome Video  Type: graphics picture video
  Caps: deinterlacing dst_colorkey levels field_parity opacity 
screen_location surface
Initialising CLE266 decoder (/dev/fb0): success!
CLE266: Creating buffers for decoder
CLE266: Creating buffer number 0
CLE266: Creating buffer number 1
CLE266: Creating buffer number 2
CLE266: Creating buffer number 3
CLE266: passing mpegfb_stride
CLE266: passing buffers to decoder
[dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
[dfb] (osdLayer): width, height:               720 576
[dfb] osdLayer has alpha channel
[dfb] init 
EXITING:action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), 
result=Not supported!
 (!!!)  *** WARNING [Application exited without deinitialization of 
DirectFB!] *** [../../../src/core/core.c:745 in dfb_core_deinit_check()]

Which all looks OK until I get to the end!

:-(

Is there anything in DirectFB which has chagned drastically for the 
Unichrome driver?

> > Your best bet may be to check out a new version of linux-viafb and
> > see if that sorts it out.
>
> I'll do that. And also add printk as Mark Adams suggested a (long)
> while ago.
> I'll keep you all updated on this.
>
> BTW : does anyone else use CLE266 hardware decoding and TV-out with
> softdevice (out of the 500+ downloads of libcle266mpegdec) ?

My main annoyance at the moment are that my Epia system doesn't always 
power off fully so I can't use nvram-wakeup at the moment. Not sure why 
it's decided to do this. Might get round to reflashing the BIOS to see if 
that sorts it: it had worked fine for about a year or so!!

It's also a shame that these things only have one PCI slot, too, because I 
can only have one USB2 device on it (in addition to a Nova-T 500 dual 
card) or they just keep on disconnecting themselves! The drivers for the 
older Nova-T cards seem much more stable.

Still, mustn't grumble: it's in constant use!!

:)

Cheers,

Laz


From laz at club-burniston.co.uk  Fri Jan 26 13:39:51 2007
From: laz at club-burniston.co.uk (Laz)
Date: Fri, 26 Jan 2007 12:39:51 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <200701261215.07603.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net> <45B9D8F5.9050008@huillard.net>
	<200701261215.07603.laz@club-burniston.co.uk>
Message-ID: <200701261239.51655.laz@club-burniston.co.uk>

On Friday 26 January 2007 12:15, Laz wrote:
> Hmmmm...just built and installed DirectFB, DFB++, and linux-viafb, then
> rebuilt libcle266mpegdec and softdevice against the new versions. Now
> when I try to start vdr, I get:
>
> vdr-1.5.0 --video=/video --config=/home/vdr/vdrconf
> --lib=/home/vdr/plugins -P'softdevice -vo dfb:viatv:cle266'
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice]   argv [1] = -vo
> vo_argv: dfb:viatv:cle266
{snip}
> [dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000
> 00418c04 [dfb] (osdLayer): width, height:               720 576
> [dfb] osdLayer has alpha channel
> [dfb] init
> EXITING:action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerC
>onfig&), result=Not supported!
>  (!!!)  *** WARNING [Application exited without deinitialization of
> DirectFB!] *** [../../../src/core/core.c:745 in
> dfb_core_deinit_check()]
>
> Which all looks OK until I get to the end!
>
> :-(
>
> Is there anything in DirectFB which has chagned drastically for the
> Unichrome driver?

Sorted it: I had pixelformat=ARGB instead of AiRGB in /etc/directfbrc. 
Looks like a check for the pixel format has been added when setting 
DLOP_ALPHACHANNEL! Not sure quite when I added that, or whether I even 
need it now!

Can't yet tell what it looks like, though, because I'm doing this over ssh 
from work!

;)

Cheers,

Laz


From bob at globall.ru  Fri Jan 26 13:53:40 2007
From: bob at globall.ru (Vladimir Monchenko)
Date: Fri, 26 Jan 2007 12:53:40 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
 cle266 HW decoding
In-Reply-To: <200701261215.07603.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net>	<200701251656.45118.laz@club-burniston.co.uk>	<45B9D8F5.9050008@huillard.net>
	<200701261215.07603.laz@club-burniston.co.uk>
Message-ID: <45B9F9D4.7000702@globall.ru>

Laz ?????:

>vdr-1.5.0 --video=/video --config=/home/vdr/vdrconf --lib=/home/vdr/plugins -P'softdevice -vo 
>dfb:viatv:cle266'
>[softdevice] processing args
>[softdevice]   argv [0] = softdevice
>[softdevice]   argv [1] = -vo
>vo_argv: dfb:viatv:cle266
>[softdevice] enabling field parity
>[softdevice] enabling CLE266 HW decoding
>[setup-softdevice] alsa ac3Mode set to: 0
>[setup-softdevice] alsa AC3 device set to: hw:0,1
>[setup-softdevice] alsa device set to: default
>[setup-softdevice] A/V Offset set to (0)
>[setup-softdevice] Cropping 0 lines from bottom
>[setup-softdevice] Cropping 0 columns from left
>[setup-softdevice] cropping mode set to 0 (none)
>[setup-softdevice] cropping mode toggle key set to 0 (none)
>[setup-softdevice] Cropping 0 columns from right
>[setup-softdevice] Cropping 0 lines from top
>[setup-softdevice] deinterlace method set to 0 none
>[setup-softdevice] mainMenu: 1
>[setup-softdevice] setting alpha blend mode to pseudo
>[softdevice] picture mirroring set to 0 (off)
>[setup-softdevice] pixel format set to (I420)
>[setup-softdevice] shouldSuspend to: 0
>[setup-softdevice] syncTimerMode: sig
>[softdevice] UseStretchBlitset to off
>[setup-softdevice] vidBrightness: 50
>[setup-softdevice] vidContrast: 50
>[setup-softdevice] vidHue: 50
>[setup-softdevice] vidSaturation: 50
>[setup-softdevice] startup aspect set to (4:3 normal)
>[softdevice] initializing Plugin
>[softdevice] Initializing Video Out
>[softdevice] ffmpeg build(3344640)
>[dfb] init
>
>     =======================|  DirectFB 1.0.0-rc3  |
>=======================
>          (c) 2001-2006  United Cultures of Earth - go for outer space!
>          (c) 2000-2004  Convergence (integrated media) GmbH
>        ----------------------------------------------------------------
>
>(*) DirectFB/Core: Single Application Core. (2007-01-26 10:52)
>(*) Direct/Modules: suppress module 'linux_input'
>(*) Direct/Modules: suppress module 'joystick'
>(*) Direct/Modules: suppress module 'lirc'
>(*) DirectFB/Genefx: MMX detected and enabled
>(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
>(*) DirectFB/Core/WM: Default 0.3 (directfb.org)
>[dfb] RAM: 66842624 bytes
>[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine 
>FillTriangle Blit StretchBlit All
>[dfb] Drawing Flags: Blend Xor
>[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize 
>SrcColorkey DstColorkey Deinterlace
>[dfb] Supported video Modes are: 720x576 at 32
>[dfb] Enumerating display Layers
>[dfb] Configuring CooperativeLevel for OSD
>Layer 0 VIA CLE266 Graphics  Type: graphics
>  Caps: alphachannel brightness contrast opacity saturation src_colorkey 
>surface
>Layer 1 VIA Unichrome Video  Type: graphics picture video
>  Caps: deinterlacing dst_colorkey levels field_parity opacity 
>screen_location surface
>Initialising CLE266 decoder (/dev/fb0): success!
>CLE266: Creating buffers for decoder
>CLE266: Creating buffer number 0
>CLE266: Creating buffer number 1
>CLE266: Creating buffer number 2
>CLE266: Creating buffer number 3
>CLE266: passing mpegfb_stride
>CLE266: passing buffers to decoder
>[dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
>[dfb] (osdLayer): width, height:               720 576
>[dfb] osdLayer has alpha channel
>[dfb] init 
>EXITING:action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), 
>result=Not supported!
> (!!!)  *** WARNING [Application exited without deinitialization of 
>DirectFB!] *** [../../../src/core/core.c:745 in dfb_core_deinit_check()]
>
>Which all looks OK until I get to the end!
>
>:-(
>
>Is there anything in DirectFB which has chagned drastically for the 
>Unichrome driver?
>
>  
>
I get week ago same error with directfb-cvs.
Today I update softdevice from cvs and saw that was some changes.

From nicolas at huillard.net  Fri Jan 26 14:56:04 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Fri, 26 Jan 2007 14:56:04 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
 cle266 HW decoding
In-Reply-To: <200701261239.51655.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net>
	<45B9D8F5.9050008@huillard.net>	<200701261215.07603.laz@club-burniston.co.uk>
	<200701261239.51655.laz@club-burniston.co.uk>
Message-ID: <45BA0874.6040904@huillard.net>

Laz a ?crit :
>>Is there anything in DirectFB which has chagned drastically for the
>>Unichrome driver?
> 
> Sorted it: I had pixelformat=ARGB instead of AiRGB in /etc/directfbrc. 
> Looks like a check for the pixel format has been added when setting 
> DLOP_ALPHACHANNEL! Not sure quite when I added that, or whether I even 
> need it now!

In my case, ARGB works and AiRGB leads to no video on the screen, except
when the OSD is openned (softdevice 0.3.1).
IIRC, this is softdevice change. Not DirectFB.

Here's my /etc/directfbrc :

mode=720x576
depth=32
pixelformat=ARGB
sync
unichrome-revision=3
no-vt

What is this "sync" option (setting or unsetting it doesn't change the
field parity artifacts on TV.

My full VDR output is (field parity is here and enabled) :

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa device default
[softdevice]   argv [3] = -vo
[softdevice] enabling field parity
[softdevice] enabling CLE266 HW decoding
[setup-softdevice] alsa ac3Mode set to: 1
[setup-softdevice] alsa AC3 device set to: spdif
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 2 (16:9)
[setup-softdevice] cropping mode toggle key set to 2 (User2)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to pseudo
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 1
[setup-softdevice] syncTimerMode: sig
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 50
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3344384)
[dfb] init

     =======================|  DirectFB 1.0.0-rc2  |=======================
          (c) 2001-2006  United Cultures of Earth - go for outer space!
          (c) 2000-2004  Convergence (integrated media) GmbH
        ----------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-01-24 20:18)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(*) DirectFB/Core: doing sync()...
(*) Direct/Thread: Running 'LiRC Input' (INPUT, 879)...
(*) DirectFB/Input: LIRC Device 0.2 (directfb.org)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (directfb.org)
[dfb] RAM: 33288192 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend Xor
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize
SrcColorkey DstColorkey Deinterlace
[dfb] Supported video Modes are: 720x576 at 32 800x600 at 8
[dfb] Enumerating display Layers
[dfb] Configuring CooperativeLevel for OSD
Layer 0 VIA CLE266 Graphics  Type: graphics
  Caps: alphachannel brightness contrast opacity saturation src_colorkey
surface
Layer 1 VIA Unichrome Video  Type: graphics picture video
  Caps: deinterlacing dst_colorkey levels field_parity opacity
screen_location surface
Initialising CLE266 decoder (/dev/fb0): success!
CLE266: Creating buffers for decoder
CLE266: Creating buffer number 0
CLE266: Creating buffer number 1
CLE266: Creating buffer number 2
CLE266: Creating buffer number 3
CLE266: passing mpegfb_stride
CLE266: passing buffers to decoder
[dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
[dfb] (osdLayer): width, height:               720 576
[dfb] osdLayer has alpha channel
[dfb] Set DLBM_TRIPLE for layer [VIA Unichrome Video]
[dfb] DLOP_FIELD_PARITY supported by layer [VIA Unichrome Video]
[surface capabilities] scrSurface: videoonly double-buffered flipping
PixelFormat = 0x00418c04
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (VIA CLE266 Graphics - [720x576])
[surface capabilities] osdSurface: videoonly double-buffered flipping
PixelFormat = 0x00418c04
[dfb] Configuring CooperativeLevel for Overlay
[surface capabilities] videoSurface: videoonly PixelFormat = 0x0810060a
[dfb] Using this layer for OSD:        VIA CLE266 Graphics
[dfb] Using this layer for Video out:  VIA Unichrome Video
[dfb] Display frame time is 19994 microseconds
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] SetParams: Enabling DLOP_FIELD_PARITY
[surface capabilities] videoSurface: videoonly flipping triple-buffered
PixelFormat = 0x08100609
[dfb] (re)configured 0x08100609
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[dfb] (re)configuring Videolayer to 736 x 576 (736x416)
[dfb] SetParams: Enabling DLOP_FIELD_PARITY
[surface capabilities] videoSurface: videoonly flipping triple-buffered
PixelFormat = 0x08100609
[dfb] (re)configured 0x08100609

-- 
NH


From laz at club-burniston.co.uk  Fri Jan 26 16:29:09 2007
From: laz at club-burniston.co.uk (Laz)
Date: Fri, 26 Jan 2007 15:29:09 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <45BA0874.6040904@huillard.net>
References: <45B8A8C7.1060201@huillard.net>
	<200701261239.51655.laz@club-burniston.co.uk>
	<45BA0874.6040904@huillard.net>
Message-ID: <200701261529.10069.laz@club-burniston.co.uk>

On Friday 26 January 2007 13:56, Nicolas Huillard wrote:
> Laz a ?crit :
> >>Is there anything in DirectFB which has chagned drastically for the
> >>Unichrome driver?
> >
> > Sorted it: I had pixelformat=ARGB instead of AiRGB in
> > /etc/directfbrc. Looks like a check for the pixel format has been
> > added when setting DLOP_ALPHACHANNEL! Not sure quite when I added
> > that, or whether I even need it now!
>
> In my case, ARGB works and AiRGB leads to no video on the screen,
> except when the OSD is openned (softdevice 0.3.1).
> IIRC, this is softdevice change. Not DirectFB.
>
> Here's my /etc/directfbrc :
>
> mode=720x576
> depth=32
> pixelformat=ARGB
> sync
> unichrome-revision=3
> no-vt
>
> What is this "sync" option (setting or unsetting it doesn't change the
> field parity artifacts on TV.

man directfbrc:
     [no-]sync
         Flushes  all disk buffers before initializing DirectFB. This can
         be useful if you working with experimental  device  drivers  and
         expect crashes. The default is not to sync.

It's whether it syncs the disk buffers before initialising DirectFB and 
has nothing to do with the actual output.

Here's my /etc/directfbrc:

mode=720x576
depth=32
pixelformat=AiRGB
disable-module=lirc
disable-module=joystick
disable-module=cle266
disable-module=linux_input
no-vt
unichrome-revision=17

Won't be able to see if I actually have any video until I get home, 
though!

Cheers,

Laz


From stefan at lucke.in-berlin.de  Fri Jan 26 17:32:28 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 26 Jan 2007 17:32:28 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <45BA0874.6040904@huillard.net>
References: <45B8A8C7.1060201@huillard.net>
	<200701261239.51655.laz@club-burniston.co.uk>
	<45BA0874.6040904@huillard.net>
Message-ID: <200701261732.28526.stefan@lucke.in-berlin.de>

On Freitag 26 Januar 2007 14:56, Nicolas Huillard wrote:
> Laz a ?crit :
> >>Is there anything in DirectFB which has chagned drastically for the
> >>Unichrome driver?
> > 
> > Sorted it: I had pixelformat=ARGB instead of AiRGB in /etc/directfbrc. 
> > Looks like a check for the pixel format has been added when setting 
> > DLOP_ALPHACHANNEL! Not sure quite when I added that, or whether I even 
> > need it now!
> 
> In my case, ARGB works and AiRGB leads to no video on the screen, except
> when the OSD is openned (softdevice 0.3.1).
> IIRC, this is softdevice change. Not DirectFB.

For DirectFB cvs version taken past 2006-12-12 you'll softdevice cvs 
version from 2007-01-20 or the following diff applied to your 
softdevice version:
http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softdevice/video-dfb.c.diff?r1=1.75&r2=1.76

With this softdevice change, you may use AiRGB as pixelformat even with
DirectFB versions taken before 2006-12-12. The reason for being forced to
use AiRGB is the following change in DirectFB:
http://www.directfb.org/index.php/viewcvs.cgi/DirectFB/gfxdrivers/unichrome/uc_primary.c.diff?r1=1.2&r2=1.3

-- 
Stefan Lucke


From laz at club-burniston.co.uk  Sat Jan 27 10:33:46 2007
From: laz at club-burniston.co.uk (Laz)
Date: Sat, 27 Jan 2007 09:33:46 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <200701261732.28526.stefan@lucke.in-berlin.de>
References: <45B8A8C7.1060201@huillard.net> <45BA0874.6040904@huillard.net>
	<200701261732.28526.stefan@lucke.in-berlin.de>
Message-ID: <200701270933.47001.laz@club-burniston.co.uk>

On Friday 26 January 2007 16:32, Stefan Lucke wrote:
> On Freitag 26 Januar 2007 14:56, Nicolas Huillard wrote:
> > Laz a ?crit :
> > >>Is there anything in DirectFB which has chagned drastically for the
> > >>Unichrome driver?
> > >
> > > Sorted it: I had pixelformat=ARGB instead of AiRGB in /etc/directfbrc.
> > > Looks like a check for the pixel format has been added when setting
> > > DLOP_ALPHACHANNEL! Not sure quite when I added that, or whether I even
> > > need it now!
> >
> > In my case, ARGB works and AiRGB leads to no video on the screen, except
> > when the OSD is openned (softdevice 0.3.1).
> > IIRC, this is softdevice change. Not DirectFB.
>
> For DirectFB cvs version taken past 2006-12-12 you'll softdevice cvs
> version from 2007-01-20 or the following diff applied to your
> softdevice version:
> http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softdevice/video-dfb.c
>.diff?r1=1.75&r2=1.76

Yep: just added that (didn't want to update softdevice fully because I _think_ 
it was one of the plugins I had to hack slightly to get it to compile with 
vdr-1.5.0 (maybe it wasn't: I'll try it later on!).

> With this softdevice change, you may use AiRGB as pixelformat even with
> DirectFB versions taken before 2006-12-12. The reason for being forced to
> use AiRGB is the following change in DirectFB:
> http://www.directfb.org/index.php/viewcvs.cgi/DirectFB/gfxdrivers/unichrome
>/uc_primary.c.diff?r1=1.2&r2=1.3

Found that too.

:)

Updating all these bits has not introduced any interlacing artifacts with via 
TV-out and hardware decoding, which is good! I also have video whether the 
OSD is showing or not!

Cheers,

Laz


From stefan at lucke.in-berlin.de  Sat Jan 27 11:34:29 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 27 Jan 2007 11:34:29 +0100
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <200701270933.47001.laz@club-burniston.co.uk>
References: <45B8A8C7.1060201@huillard.net>
	<200701261732.28526.stefan@lucke.in-berlin.de>
	<200701270933.47001.laz@club-burniston.co.uk>
Message-ID: <200701271134.29907.stefan@lucke.in-berlin.de>

On Samstag 27 Januar 2007 10:33, Laz wrote:
> Yep: just added that (didn't want to update softdevice fully because I _think_ 
> it was one of the plugins I had to hack slightly to get it to compile with 
> vdr-1.5.0 (maybe it wasn't: I'll try it later on!).

Ups.
Just did a test with vdr-1.5.0. CVS version compiles and runs with it.
The small trouble I had, was due to forgotten '.configure' which caused a:

make[1]: Entering directory `/home/nfs/extra/src/video/DVB/vdr-1.5.0.jarada/PLUGINS/src/softdevice'
make[1]: *** No rule to make target `postprocess.h', needed by `softdevice.o'.  Stop.

But a 'make clean' in softdevice directory (after './configure') fixed that.

-- 
Stefan Lucke


From laz at club-burniston.co.uk  Sat Jan 27 11:46:52 2007
From: laz at club-burniston.co.uk (Laz)
Date: Sat, 27 Jan 2007 10:46:52 +0000
Subject: [Softdevice-devel] viafb, TVout, field parity, DirectFB,
	cle266 HW decoding
In-Reply-To: <200701271134.29907.stefan@lucke.in-berlin.de>
References: <45B8A8C7.1060201@huillard.net>
	<200701270933.47001.laz@club-burniston.co.uk>
	<200701271134.29907.stefan@lucke.in-berlin.de>
Message-ID: <200701271046.52760.laz@club-burniston.co.uk>

On Saturday 27 January 2007 10:34, Stefan Lucke wrote:
> On Samstag 27 Januar 2007 10:33, Laz wrote:
> > Yep: just added that (didn't want to update softdevice fully because I
> > _think_ it was one of the plugins I had to hack slightly to get it to
> > compile with vdr-1.5.0 (maybe it wasn't: I'll try it later on!).
>
> Ups.
> Just did a test with vdr-1.5.0. CVS version compiles and runs with it.
> The small trouble I had, was due to forgotten '.configure' which caused a:
>
> make[1]: Entering directory
> `/home/nfs/extra/src/video/DVB/vdr-1.5.0.jarada/PLUGINS/src/softdevice'
> make[1]: *** No rule to make target `postprocess.h', needed by
> `softdevice.o'.  Stop.
>
> But a 'make clean' in softdevice directory (after './configure') fixed
> that.

I had several plugins break due to the change to GetDevice in vdr-1.5.0 and I 
thought softdevice was one of the ones I had to patch. Sounds like it wasn't!

Will update softdevice later...

Cheers,

Laz


From stefan at lucke.in-berlin.de  Sun Jan 28 19:54:38 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 28 Jan 2007 19:54:38 +0100
Subject: [Softdevice-devel] improved lip sync with mgatv and viatv
In-Reply-To: <200701242101.24316.stefan@lucke.in-berlin.de>
References: <1A6B2FB9-E733-4A6A-9B4E-CCF8A1421B1C@pobox.com>
	<53FF12B8-D838-4DC3-B53D-9710A07BCB56@pobox.com>
	<200701242101.24316.stefan@lucke.in-berlin.de>
Message-ID: <200701281954.38541.stefan@lucke.in-berlin.de>

On Mittwoch 24 Januar 2007 21:01, Stefan Lucke wrote:
> On Dienstag 23 Januar 2007 01:25, Torgeir Veimo wrote:
> > On 22 Jan 2007, at 20:26, Stefan Lucke wrote:
> 
> > > So my system skips around 9 to 10 frames per minute.
> > > 60 * 25 = 1500 frames.
> > > So the TV frame rate is 25 * 1490 / 1500 = 24.833 Hz .
> > >
> > > I guess I've to ask Ville if there is a way to increase the dot clock
> > > of my card in some way.
> > 
> > This assumes your soundcard is perfectly clocked to the incoming DVB  
> > stream? I'd assume that eventually if the soundcard is a bit faster  
> > than the DVB stream, you'd get an xrun. Maybe it's an idea to add  
> > xrun counts as well.
> 
> Yes, there are e few assumptions which may slightly influence calculation.
> These numbers are from recording playback. During live view, they are
> a bit different, but the direction is the same.

So here comes my first try of moving the sync code to cVideoDevice.
I guess this is not it's final place, but we should first look at th reported
numbers (thats from live view):

Jan 28 18:33:06 bodega1 vdr: [6995] [VideoOut]: video now synced (43 - -316)

This message is issued the first time after ataching a new VideoStreamDecoder
and measured sync offset is within +/- 1 frame.

xrun and other messages are removed.

Each 7500 frames (25 * 60 * 5 ~ 5minutes) a statistic message is printed.
I'm a bit surprised, that repeated frame counter grows wtih drop frame counter.

Jan 28 18:38:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 22, drpF = 11, totF = 7500
Jan 28 18:43:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 26, drpF = 20, totF = 15000
Jan 28 18:48:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 66, drpF = 42, totF = 22500
Jan 28 18:53:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 74, drpF = 54, totF = 30000
Jan 28 18:58:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 85, drpF = 73, totF = 37500
Jan 28 19:03:05 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 85, drpF = 73, totF = 45000
Jan 28 19:08:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 92, drpF = 85, totF = 52500
Jan 28 19:13:04 bodega1 vdr: [6995] [VideoOut]: sync info: repF = 98, drpF = 96, totF = 60000

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: av-sync-04.diff
Type: text/x-diff
Size: 10739 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070128/1c1ec603/attachment.diff>

From marko.makela at hut.fi  Tue Jan 30 19:00:52 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 30 Jan 2007 20:00:52 +0200
Subject: [Softdevice-devel] [PATCH] Adapt for shutdown rewrite
Message-ID: <20070130180052.GA7731@localhost.localdomain>

I started to use Udo Richter's shutdown rewrite
<http://www.udo-richter.de/vdr/patches.en.html#shutdown>
on my VDR box.  I patched the vdr-softdevice and vdr-subtitles
plugins to take advantage of the method Shutdown.IsUserInactive()
that was introduced by Udo's patch:

http://www.iki.fi/~msmakela/software/vdr/#shutdown
http://www.iki.fi/~msmakela/software/vdr/shutdown-subtitles-0.5.0.patch
http://www.iki.fi/~msmakela/software/vdr/shutdown-softdevice.patch

The softdevice patch is attached.  Please consider applying it.

	Marko
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shutdown-softdevice.patch
Type: text/x-diff
Size: 3623 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070130/0133bb75/attachment.patch>

From marko.makela at hut.fi  Fri Feb  2 21:26:33 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 2 Feb 2007 22:26:33 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback of recordings when
	suspended
Message-ID: <20070202202633.GB3854@localhost.localdomain>

I fixed the long-standing bug with the suspend function of softdevice.
If softdevice is suspended when playing back a recording, the recording
will fast-forward to the end.  This patch modifies softdevice so that
it will block the data stream from vdr when playing back recordings.

This fix is now also included in my softdevice patch for Udo Richter's
shutdown rewrite:

http://www.iki.fi/~msmakela/software/vdr/#shutdown
http://www.iki.fi/~msmakela/software/vdr/shutdown-softdevice.patch

The attached patch is simpler, as it only fixes this bug.  Please apply it.

	Marko
-------------- next part --------------
A non-text attachment was scrubbed...
Name: softdevice-suspend.patch
Type: text/x-diff
Size: 909 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070202/9ed4fb0c/attachment.patch>

From marko.makela at hut.fi  Wed Feb  7 18:41:00 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 7 Feb 2007 19:41:00 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback of recordings
	when suspended
In-Reply-To: <20070202202633.GB3854@localhost.localdomain>
References: <20070202202633.GB3854@localhost.localdomain>
Message-ID: <20070207174100.GA7399@localhost.localdomain>

On Fri, Feb 02, 2007 at 10:26:33PM +0200, Marko M?kel? wrote:
> I fixed the long-standing bug with the suspend function of softdevice.
> If softdevice is suspended when playing back a recording, the recording
> will fast-forward to the end.  This patch modifies softdevice so that
> it will block the data stream from vdr when playing back recordings.
> 
> This fix is now also included in my softdevice patch for Udo Richter's
> shutdown rewrite:
> 
> http://www.iki.fi/~msmakela/software/vdr/#shutdown
> http://www.iki.fi/~msmakela/software/vdr/shutdown-softdevice.patch
> 
> The attached patch is simpler, as it only fixes this bug.  Please apply it.

Sorry, the patch causes 100% CPU load when softdevice is suspended.  Adding
a usleep(10000) drops the load to less than 1% on my system.  I first tried
usleep(100000), but it caused vdr to hang for a long time.  I updated the
patch on my home page.  Below are the hunks that fix this bug only.

	Marko

Index: softdevice.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/softdevice.c,v
retrieving revision 1.77
diff -p -u -r1.77 softdevice.c
--- softdevice.c	28 Jan 2007 19:38:06 -0000	1.77
+++ softdevice.c	7 Feb 2007 17:30:19 -0000
@@ -525,6 +534,10 @@ int cSoftDevice::PlayAudio(const uchar *
 # endif
 {
   SOFTDEB("PlayAudio... %p length %d\n",Data,Length);
+  if (setupStore.shouldSuspend && !Transferring()) {
+    usleep(10000); // avoid burning CPU
+    return 0;
+  }
   if (! packetMode)
     return decoder->Decode(Data, Length);
 
@@ -580,6 +593,10 @@ int  cSoftDevice::GetAudioChannelDevice(
 int cSoftDevice::PlayVideo(const uchar *Data, int Length)
 {
    SOFTDEB("PlayVideo %x length %d\n",Data,Length);
+  if (setupStore.shouldSuspend && !Transferring()) {
+    usleep(10000); // avoid burning CPU
+    return 0;
+  }
    if (! packetMode)
     return decoder->Decode(Data, Length);


From stefan at lucke.in-berlin.de  Thu Feb  8 08:50:00 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 8 Feb 2007 08:50:00 +0100
Subject: [Softdevice-devel] [PATCH] Pause the playback of recordings
	when suspended
In-Reply-To: <20070207174100.GA7399@localhost.localdomain>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070207174100.GA7399@localhost.localdomain>
Message-ID: <200702080850.00884.stefan@lucke.in-berlin.de>

On Wednesday 07 February 2007 18:41, Marko M?kel? wrote:
> On Fri, Feb 02, 2007 at 10:26:33PM +0200, Marko M?kel? wrote:
> > I fixed the long-standing bug with the suspend function of softdevice.
> > If softdevice is suspended when playing back a recording, the recording
> > will fast-forward to the end.  This patch modifies softdevice so that
> > it will block the data stream from vdr when playing back recordings.
> > 
> > This fix is now also included in my softdevice patch for Udo Richter's
> > shutdown rewrite:
> > 
> > http://www.iki.fi/~msmakela/software/vdr/#shutdown
> > http://www.iki.fi/~msmakela/software/vdr/shutdown-softdevice.patch
> > 
> > The attached patch is simpler, as it only fixes this bug.  Please apply it.
> 
> Sorry, the patch causes 100% CPU load when softdevice is suspended.  Adding
> a usleep(10000) drops the load to less than 1% on my system.  I first tried
> usleep(100000), but it caused vdr to hang for a long time.  I updated the
> patch on my home page.  Below are the hunks that fix this bug only.

Transferring() was introduced in vdr-1.3.42. So this needs an extra #if
# if VDRVERSNUM >= 10342

Looking at the implementation of Transferring() in device.c I'm just
wondering of the difference compared to Replaying() 
!Transferring() == true -> no player (player == NULL) or
player is not derived from cTransfer.

device.c around line 948:

bool cDevice::Replaying(void) const
{
  return player != NULL;
}

bool cDevice::Transferring(void) const
{
  return dynamic_cast<cTransfer *>(player) != NULL;
}



-- 
Stefan Lucke


From marko.makela at hut.fi  Thu Feb  8 09:26:00 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 8 Feb 2007 10:26:00 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback of
	recordings	when suspended
In-Reply-To: <200702080850.00884.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070207174100.GA7399@localhost.localdomain>
	<200702080850.00884.stefan@lucke.in-berlin.de>
Message-ID: <20070208082600.GA3239@localhost.localdomain>

On Thu, Feb 08, 2007 at 08:50:00AM +0100, Stefan Lucke wrote:
> Transferring() was introduced in vdr-1.3.42. So this needs an extra #if
> # if VDRVERSNUM >= 10342
> 
> Looking at the implementation of Transferring() in device.c I'm just
> wondering of the difference compared to Replaying() 
> !Transferring() == true -> no player (player == NULL) or
> player is not derived from cTransfer.
> 
> device.c around line 948:
> 
> bool cDevice::Replaying(void) const
> {
>   return player != NULL;
> }
> 
> bool cDevice::Transferring(void) const
> {
>   return dynamic_cast<cTransfer *>(player) != NULL;
> }

It seems to me that Replaying() would always return true when called
from cSoftDevice::PlayVideo() or PlayAudio().  I would guess that
player != NULL when playing a recording or a live stream.

Are you suggesting that we should replace Transferring()
with dynamic_cast<cTransfer*>(player) to avoid the VDRVERSNUM check?

There is another method that could possibly be used, something like
cPlayerControl::NowReplaying().  I don't have the source tree at hand
right now, but I can check it tonight.

	Marko


From marko.makela at hut.fi  Fri Feb  9 21:03:44 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 9 Feb 2007 22:03:44 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback
	of	recordings	when suspended
In-Reply-To: <20070208082600.GA3239@localhost.localdomain>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070207174100.GA7399@localhost.localdomain>
	<200702080850.00884.stefan@lucke.in-berlin.de>
	<20070208082600.GA3239@localhost.localdomain>
Message-ID: <20070209200344.GB3663@localhost.localdomain>

On Thu, Feb 08, 2007 at 10:26:00AM +0200, Marko M?kel? wrote:
> On Thu, Feb 08, 2007 at 08:50:00AM +0100, Stefan Lucke wrote:
> > Transferring() was introduced in vdr-1.3.42. So this needs an extra #if
> > # if VDRVERSNUM >= 10342
> > 
> > Looking at the implementation of Transferring() in device.c I'm just
> > wondering of the difference compared to Replaying() 
> > !Transferring() == true -> no player (player == NULL) or
> > player is not derived from cTransfer.
> > 
> > device.c around line 948:
> > 
> > bool cDevice::Replaying(void) const
> > {
> >   return player != NULL;
> > }
> > 
> > bool cDevice::Transferring(void) const
> > {
> >   return dynamic_cast<cTransfer *>(player) != NULL;
> > }
> 
> It seems to me that Replaying() would always return true when called
> from cSoftDevice::PlayVideo() or PlayAudio().  I would guess that
> player != NULL when playing a recording or a live stream.
> 
> Are you suggesting that we should replace Transferring()
> with dynamic_cast<cTransfer*>(player) to avoid the VDRVERSNUM check?

Hmm, the dynamic_cast won't work, because player is a private member of
cDevice.

> There is another method that could possibly be used, something like
> cPlayerControl::NowReplaying().  I don't have the source tree at hand
> right now, but I can check it tonight.

cReplayControl::NowReplaying() looks efficient: a static method that
references two static variables.  I tried replacing !Transferring()
with cReplayControl::NowReplaying(), and it works.

Conclusion: use !Transferring() with an appropriate VDRVERSNUM check.
Or does softdevice need to support the old development version of vdr?
The stable 1.4 series has been around for a while now.

	Marko


From stefan at lucke.in-berlin.de  Sat Feb 10 00:50:32 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 10 Feb 2007 00:50:32 +0100
Subject: [Softdevice-devel]
	=?iso-8859-1?q?=5BPATCH=5D_Pause_the_playback_?=
	=?iso-8859-1?q?of=09recordings=09when_suspended?=
In-Reply-To: <20070209200344.GB3663@localhost.localdomain>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070208082600.GA3239@localhost.localdomain>
	<20070209200344.GB3663@localhost.localdomain>
Message-ID: <200702100050.32874.stefan@lucke.in-berlin.de>

On Friday 09 February 2007 21:03, Marko M?kel? wrote:
> On Thu, Feb 08, 2007 at 10:26:00AM +0200, Marko M?kel? wrote:
> > On Thu, Feb 08, 2007 at 08:50:00AM +0100, Stefan Lucke wrote:
> > > Transferring() was introduced in vdr-1.3.42. So this needs an extra #if
> > > # if VDRVERSNUM >= 10342
> > > 
> > > Looking at the implementation of Transferring() in device.c I'm just
> > > wondering of the difference compared to Replaying() 
> > > !Transferring() == true -> no player (player == NULL) or
> > > player is not derived from cTransfer.
> > > 
> > > device.c around line 948:
> > > 
> > > bool cDevice::Replaying(void) const
> > > {
> > >   return player != NULL;
> > > }
> > > 
> > > bool cDevice::Transferring(void) const
> > > {
> > >   return dynamic_cast<cTransfer *>(player) != NULL;
> > > }
> > 
> > It seems to me that Replaying() would always return true when called
> > from cSoftDevice::PlayVideo() or PlayAudio().  I would guess that
> > player != NULL when playing a recording or a live stream.
> > 
> > Are you suggesting that we should replace Transferring()
> > with dynamic_cast<cTransfer*>(player) to avoid the VDRVERSNUM check?
> 
> Hmm, the dynamic_cast won't work, because player is a private member of
> cDevice.
> 
> > There is another method that could possibly be used, something like
> > cPlayerControl::NowReplaying().  I don't have the source tree at hand
> > right now, but I can check it tonight.
> 
> cReplayControl::NowReplaying() looks efficient: a static method that
> references two static variables.  I tried replacing !Transferring()
> with cReplayControl::NowReplaying(), and it works.

NowReplaying() is even newer than Transferring(), appeared is 1.4.4 ;-) .

> 
> Conclusion: use !Transferring() with an appropriate VDRVERSNUM check.

Yes.

> Or does softdevice need to support the old development version of vdr?

Yes.

> The stable 1.4 series has been around for a while now.

softdevice-0.3.1 last release, had support for vdr.1.2.x .
We should support some older versions.

I know we have to make a new release. But I'm still busy on tv-out
sync issue., will soon commit some logging helper functions.

-- 
Stefan Lucke


From marko.makela at hut.fi  Sat Feb 10 08:34:24 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 10 Feb 2007 09:34:24 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback of recordings
	when suspended
In-Reply-To: <200702100050.32874.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070208082600.GA3239@localhost.localdomain>
	<20070209200344.GB3663@localhost.localdomain>
	<200702100050.32874.stefan@lucke.in-berlin.de>
Message-ID: <20070210073424.GA3832@localhost.localdomain>

On Sat, Feb 10, 2007 at 12:50:32AM +0100, Stefan Lucke wrote:
> > cReplayControl::NowReplaying() looks efficient: a static method that
> > references two static variables.  I tried replacing !Transferring()
> > with cReplayControl::NowReplaying(), and it works.
> 
> NowReplaying() is even newer than Transferring(), appeared is 1.4.4 ;-) .

Actually, I meant to write that (I downloaded the 1.4.0 tarball and all
1.4.x diffs to see where it appeared), but somehow I forgot it.

	Marko


From stefan at lucke.in-berlin.de  Sat Feb 10 23:54:03 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 10 Feb 2007 23:54:03 +0100
Subject: [Softdevice-devel]
	=?iso-8859-1?q?=5BPATCH=5D_Pause_the_playback_?=
	=?iso-8859-1?q?of=09recordings=09when_suspended?=
In-Reply-To: <200702100050.32874.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070209200344.GB3663@localhost.localdomain>
	<200702100050.32874.stefan@lucke.in-berlin.de>
Message-ID: <200702102354.04113.stefan@lucke.in-berlin.de>

On Saturday 10 February 2007 00:50, Stefan Lucke wrote:
> On Friday 09 February 2007 21:03, Marko M?kel? wrote:
> > On Thu, Feb 08, 2007 at 10:26:00AM +0200, Marko M?kel? wrote:

> > cReplayControl::NowReplaying() looks efficient: a static method that
> > references two static variables.  I tried replacing !Transferring()
> > with cReplayControl::NowReplaying(), and it works.
> 
> NowReplaying() is even newer than Transferring(), appeared is 1.4.4 ;-) .
> 
> > 
> > Conclusion: use !Transferring() with an appropriate VDRVERSNUM check.
> 
> Yes.

This version is in cvs.

-- 
Stefan Lucke


From nicolas at huillard.net  Sun Feb 11 14:21:27 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 11 Feb 2007 14:21:27 +0100
Subject: [Softdevice-devel] field parity : viafb, TVout, cle266 HW decoding
Message-ID: <45CF1857.4020703@huillard.net>

Hi all,

This is a followup to the (very) old thread "[directfb-users]
[Softdevice-devel] viafb + cle266mpegdec + TVout : field parity status
and patches" and more recent "[Softdevice-devel] viafb, TVout, field
parity, DirectFB, cle266 HW decoding".

I still have problems with field parity on TV-out. I check everything
one more time. I can't figure anything regarding wrong patches, version,
etc.
The only obvious difference I see with Laz's working setup is his MII12k
vs. my M10k (with unichrome-revision=17 vs. unichrome-revision=3)


I finally tested Mark Adams suggestion dated 2006-10-09 18:32 :
------------------------
Try adding a printk in viafb_wait_for_sync (via_fbobj.c), just before it
returns:

printk(KERN_INFO "wait vsync: %d %d %d\n", field_option, p->irq_cnt & 1,
ret);

You _should_ see a stream of messages all identical.  Let me know
whether anything changes when the field parity 'goes wrong'.
------------------------

I did that (with and without printing "ret"), like this :
------------------------
    // 20070211/NH
    //printk(KERN_INFO "wait vsync: %d %d %d\n", field_option,
p->irq_cnt & 1, ret);
    //printk(KERN_INFO "wait vsync: %d %d\n", field_option, p->irq_cnt & 1);

    if (ret < 0) {
        return ret;
    }
    if (ret == 0) {
        return -ETIMEDOUT;
    }

    return 0;
}
------------------------

There are calls refering to HZ before that code, which is 250 on my
machine. viafb reports the following when loading :
------------------------
Feb 11 12:46:39 vdr kernel: viafb: VIA UNICHROME framebuffer 1.0
initializing
Feb 11 12:46:39 vdr kernel: viafb: viafb : CEB00000
Feb 11 12:46:39 vdr kernel: viafb: framebuffer size = 32 Mb
Feb 11 12:46:39 vdr kernel: viafb: Found Device Rev:0
Feb 11 12:46:39 vdr kernel: viafb: HZ: 250
Feb 11 12:46:39 vdr kernel: viafb: X:720 Y:576
Feb 11 12:46:39 vdr kernel: viafb: detected VT1622 (2), using TV3 tables
Feb 11 12:46:39 vdr kernel: viafb: mode=720  bpp=32  refresh=50  TVon=1
 TVtype=2
Feb 11 12:46:39 vdr kernel: viafb: VQ start:1FC0000  end:1FFFFFF  size:40000
Feb 11 12:46:39 vdr kernel: viafb: Cursor start:1FBF000  end:1FBFFFF
size:1000
Feb 11 12:46:39 vdr kernel: viafb: detected VT1622 (2), using TV3 tables
Feb 11 12:46:39 vdr kernel: viafb: mode=720  bpp=32  refresh=50  TVon=1
 TVtype=2
Feb 11 12:46:39 vdr kernel: viafb: irq handler installed, IRQ(0x200) =
80080c02
Feb 11 12:46:39 vdr kernel: fb0: UNICHROME frame buffer device
------------------------


When I compile/link viafb, I see errors (gcc version 3.3.5, kernel
2.6.18) like the following :

------------------------
WARNING:
/home/nhuillard/vdr-build/kernel/anonymous-cvs/20070201/linux-viafb/linux/drivers/video/cle266/viafb.o
- Section mismatch: reference to .init.data: from .text between
'get_memsize' (at offset 0x56) and 'setmode'
WARNING:
/home/nhuillard/vdr-build/kernel/anonymous-cvs/20070201/linux-viafb/linux/drivers/video/cle266/viafb.o
- Section mismatch: reference to .init.data: from .text between
'via_pci_probe' (at offset 0x18fe) and 'via_pci_remove'
------------------------


Please see an attached file, with the kernel log reporting "wait
vsync:". There are many conditions, explained a bit in the file.
* when running VDR/softdevice with "-vo dfb:viatv" (no hardware MPEG2
decoding), field parity takes 10-20 seconds to settle, and remains OK
with some glitches from time to time
* when running VDR/softdevice with "-vo dfb:viatv:cle266" (with hardware
MPEG2 decoding), there is no real settlement for field parity : it is OK
for some time, then switches to bad, then gets back or hesitate...
* some "wait vsync:" log changes do not correspond to visible glitches,
and some visible glitches do not always have corresponding log lines
(specially when I don't log "ret", latest parts)


TIA,

-- 
NH
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: viafb_printk.txt
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070211/302a2130/attachment.txt>

From rahrenbe at cc.hut.fi  Sun Feb 11 14:48:49 2007
From: rahrenbe at cc.hut.fi (Rolf Ahrenberg)
Date: Sun, 11 Feb 2007 15:48:49 +0200 (EET)
Subject: [Softdevice-devel] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <45CF1857.4020703@huillard.net>
References: <45CF1857.4020703@huillard.net>
Message-ID: <Pine.OSF.4.64.0702111541530.10739@kosh.hut.fi>

On Sun, 11 Feb 2007, Nicolas Huillard wrote:

> I still have problems with field parity on TV-out. I check everything
> one more time. I can't figure anything regarding wrong patches, version,

The field parity code has been integrated into DirectFB (RC4 or newer) 
and viafb, so you shouldn't need any patches anymore. If you're using 
older drivers and/or DirectFB, I'd suggest to test the current ones 
before starting any further debugging.

> When I compile/link viafb, I see errors (gcc version 3.3.5, kernel
> 2.6.18) like the following :

Just ignore those warnings. :)

BR,
--
rofa


From nicolas at huillard.net  Sun Feb 11 19:18:28 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 11 Feb 2007 19:18:28 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>
References: <45CF1857.4020703@huillard.net>
	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>
Message-ID: <45CF5DF4.7070002@huillard.net>

Mark Adams a ?crit :
> No patches should be required any more.  All this stuff should work if you
> have linux-viafb from DirectFB CVS and DirectFB-rc4 or later.

I actually used DirectFB rc2, which needs
"dfb_unichrome_flip_ioctl-libcle266mpegdec_GetFBOffset.patch". I didn't
upgraded this one since Laz said it was working with an even older
version (2006-10).
DFB++ needed a similar patch, but latest CVS didn't need it.
I upgraded viafb to get rid of it's latest patch.
So you're correct : no more patches.

I'll test 1.0rc4

>> ------------------------
>> Try adding a printk in viafb_wait_for_sync (via_fbobj.c), just before it
>> returns:
>>
>> printk(KERN_INFO "wait vsync: %d %d %d\n", field_option, p->irq_cnt & 1,
>> ret);
> 
> OK, so we see this:
> 
>> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
>> Feb 11 11:39:47 vdr last message repeated 2 times
>> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
>> Feb 11 11:39:47 vdr last message repeated 2 times
>> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
>> Feb 11 11:39:47 vdr last message repeated 2 times
>> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
>> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> 
> field_option 3 is a wait for a kernel-assisted flip to complete.  The 25's
> (HZ/10) mean that the wait calls are returning immediately (presumably
> because a fair amount of processing was required to get the next frame
> ready
> and the previous frame had been displayed by that point).  The mixture of
> 0's and 1's means that the video is sometimes on the top field and
> sometimes
> on the bottom when the wait happens.
> 
> All that is fine provided that you're using triple buffering.  That's
> perhaps something I should enforce when this method is being used and fall
> back to the old method if not.
> 
> Are you using triple buffering?

Softdevice developpers should give a sound answer.
The logs say :

[surface capabilities] videoSurface: videoonly flipping triple-buffered
PixelFormat = 0x08100609

> Can you try using df_xine (from DirectFB-extra)?  This I know to work
> perfectly on my hardware and it would be a good starting point to see if
> this works for you before going much further.  I think I've asked this
> before but I don't remember you reporting back what the result was.  Use
> something like:
> 
> df_xine -m 720x576 -l 1 -b triple -f top <filename>
> 
> There are some more useful tests we can do if we still don't find out
> what's
> happening but try the above first.

I'll do that and report.

Thank you very much for all your help.

-- 
NH


From stefan at lucke.in-berlin.de  Sun Feb 11 19:58:12 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 11 Feb 2007 19:58:12 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <45CF5DF4.7070002@huillard.net>
References: <45CF1857.4020703@huillard.net>
	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>
	<45CF5DF4.7070002@huillard.net>
Message-ID: <1171220292.45cf674453e9d@webmail.in-berlin.de>

Quoting Nicolas Huillard:

> Mark Adams a ?crit :

> >> ------------------------
> >> Try adding a printk in viafb_wait_for_sync (via_fbobj.c), just before it
> >> returns:
> >>
> >> printk(KERN_INFO "wait vsync: %d %d %d\n", field_option, p->irq_cnt & 1,
> >> ret);
> >
> > OK, so we see this:
> >
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >
> > field_option 3 is a wait for a kernel-assisted flip to complete.  The 25's
> > (HZ/10) mean that the wait calls are returning immediately (presumably
> > because a fair amount of processing was required to get the next frame
> > ready
> > and the previous frame had been displayed by that point).  The mixture of
> > 0's and 1's means that the video is sometimes on the top field and
> > sometimes
> > on the bottom when the wait happens.

"when the wait happens": Does that mean we are somtimes displaying top field
first, and sometimes bottom field first ?
These messages are within the same second.

Softdevice allways does layer->SetFieldParity(fieldParity); // fieldParity is 0

> >
> > All that is fine provided that you're using triple buffering.  That's
> > perhaps something I should enforce when this method is being used and fall
> > back to the old method if not.
> >
> > Are you using triple buffering?
>
> Softdevice developpers should give a sound answer.
> The logs say :
>
> [surface capabilities] videoSurface: videoonly flipping triple-buffered
> PixelFormat = 0x08100609
>

You should get other messages printed to stderr too, like:
[dfb] Set DLBM_TRIPLE for layer [%s]

or if enabling triple buffering fails:
[dfb]: SetParms (): failed to set buffermode to triple, will try back video

But this requires softdevice option "viatv" to be set.

Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Feb 11 19:58:12 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 11 Feb 2007 19:58:12 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <45CF5DF4.7070002@huillard.net>
References: <45CF1857.4020703@huillard.net>
	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>
	<45CF5DF4.7070002@huillard.net>
Message-ID: <1171220292.45cf674453e9d@webmail.in-berlin.de>

Quoting Nicolas Huillard:

> Mark Adams a ?crit :

> >> ------------------------
> >> Try adding a printk in viafb_wait_for_sync (via_fbobj.c), just before it
> >> returns:
> >>
> >> printk(KERN_INFO "wait vsync: %d %d %d\n", field_option, p->irq_cnt & 1,
> >> ret);
> >
> > OK, so we see this:
> >
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 0 25
> >> Feb 11 11:39:47 vdr last message repeated 2 times
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >> Feb 11 11:39:47 vdr kernel: wait vsync: 3 1 25
> >
> > field_option 3 is a wait for a kernel-assisted flip to complete.  The 25's
> > (HZ/10) mean that the wait calls are returning immediately (presumably
> > because a fair amount of processing was required to get the next frame
> > ready
> > and the previous frame had been displayed by that point).  The mixture of
> > 0's and 1's means that the video is sometimes on the top field and
> > sometimes
> > on the bottom when the wait happens.

"when the wait happens": Does that mean we are somtimes displaying top field
first, and sometimes bottom field first ?
These messages are within the same second.

Softdevice allways does layer->SetFieldParity(fieldParity); // fieldParity is 0

> >
> > All that is fine provided that you're using triple buffering.  That's
> > perhaps something I should enforce when this method is being used and fall
> > back to the old method if not.
> >
> > Are you using triple buffering?
>
> Softdevice developpers should give a sound answer.
> The logs say :
>
> [surface capabilities] videoSurface: videoonly flipping triple-buffered
> PixelFormat = 0x08100609
>

You should get other messages printed to stderr too, like:
[dfb] Set DLBM_TRIPLE for layer [%s]

or if enabling triple buffering fails:
[dfb]: SetParms (): failed to set buffermode to triple, will try back video

But this requires softdevice option "viatv" to be set.

Stefan Lucke


From nicolas at huillard.net  Mon Feb 12 11:10:41 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Mon, 12 Feb 2007 11:10:41 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
 cle266 HW decoding
In-Reply-To: <1171220292.45cf674453e9d@webmail.in-berlin.de>
References: <45CF1857.4020703@huillard.net>	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>	<45CF5DF4.7070002@huillard.net>
	<1171220292.45cf674453e9d@webmail.in-berlin.de>
Message-ID: <45D03D21.5070505@huillard.net>

Stefan Lucke a ?crit :
> You should get other messages printed to stderr too, like:
> [dfb] Set DLBM_TRIPLE for layer [%s]
> 
> or if enabling triple buffering fails:
> [dfb]: SetParms (): failed to set buffermode to triple, will try back video

I have them correctly on stderr :

[dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
[dfb] (osdLayer): width, height:               720 576
[dfb] osdLayer has alpha channel
[dfb] Set DLBM_TRIPLE for layer [VIA Unichrome Video]
[dfb] DLOP_FIELD_PARITY supported by layer [VIA Unichrome Video]
[surface capabilities] scrSurface: videoonly double-buffered flipping
PixelFormat = 0x00418c04
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (VIA CLE266 Graphics - [720x576])
[surface capabilities] osdSurface: videoonly double-buffered flipping
PixelFormat = 0x00418c04
[dfb] Configuring CooperativeLevel for Overlay
[surface capabilities] videoSurface: videoonly PixelFormat = 0x0810060a
[dfb] Using this layer for OSD:        VIA CLE266 Graphics
[dfb] Using this layer for Video out:  VIA Unichrome Video
[dfb] Display frame time is 19995 microseconds

-- 
NH


From nicolas at huillard.net  Mon Feb 12 12:21:40 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Mon, 12 Feb 2007 12:21:40 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <b7f6d7370702111127w298b5e24j80d0bec2de362e6f@mail.gmail.com>
References: <45CF1857.4020703@huillard.net>	
	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>	
	<45CF5DF4.7070002@huillard.net>
	<b7f6d7370702111127w298b5e24j80d0bec2de362e6f@mail.gmail.com>
Message-ID: <45D04DC4.6040706@huillard.net>

Mark Adams a ?crit :
> You could also usefully add the following printf to
> DirectFB/gfxdrivers/unichrome/uc_overlay.c after the FBIO_FLIPONVSYNC
> ioctl:
> 
> printf("v1 flip: current frame %d field %d flipping on field %d\n",
>        flip->count, flip->field, ucovl->config.parity);

Done. Here is the result, post-processed using the following command
("awk" substitutes the frame number with the difference between the
current frame number and the previous one, "uniq" counts the same lines,
ie. the ones with frame increments = +1, same field, etc.) :

grep 'v1 flip' vdr-err.k0Nl3p | awk '{print $3, $4, "+", $5-p, $6, $7,
$8, $9, $10, $11; p=$5}' | uniq -c

Result is :
-------------------------------
      1 current frame + 0 field 0 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 40 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
     12 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 1 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      5 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      7 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      7 current frame + 1 field 0 flipping on field 0
      9 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
    307 current frame + 1 field 0 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      8 current frame + 1 field 0 flipping on field 0
      7 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      6 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
    792 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      4 current frame + 1 field 0 flipping on field 0
      5 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
    246 current frame + 1 field 0 flipping on field 0
-------------------------------

-- 
NH


From nicolas at huillard.net  Mon Feb 12 14:37:18 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Mon, 12 Feb 2007 14:37:18 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <b7f6d7370702120338k79feaaa5qdf7e3ef3dd75e98b@mail.gmail.com>
References: <45CF1857.4020703@huillard.net>	
	<b7f6d7370702110813s628828c4l8ff3ea365ba19ddc@mail.gmail.com>	
	<45CF5DF4.7070002@huillard.net>	
	<b7f6d7370702111127w298b5e24j80d0bec2de362e6f@mail.gmail.com>	
	<45D04DC4.6040706@huillard.net>
	<b7f6d7370702120338k79feaaa5qdf7e3ef3dd75e98b@mail.gmail.com>
Message-ID: <45D06D8E.4020408@huillard.net>

Mark Adams a ?crit :
>> Result is :
>> -------------------------------
>>       1 current frame + 0 field 0 flipping on field 0
>>       1 current frame + 2 field 0 flipping on field 0
>>       1 current frame + 40 field 0 flipping on field 0
>>       1 current frame + 1 field 0 flipping on field 0
>>       2 current frame + 1 field 1 flipping on field 0
>>      12 current frame + 1 field 0 flipping on field 0
>>       2 current frame + 1 field 1 flipping on field 0
>>       1 current frame + 2 field 0 flipping on field 0
>>       2 current frame + 1 field 0 flipping on field 0
> 
> ... etc...
> 
> OK then, it appears that you're simply not able to generate frames fast
> enough, with the effect that frames will be repeated.  If that happens and
> the frames are interlaced, you will see nasty judder because you get to see
> something like field 1, field 2, field 3, field 4, field 3, field 4, field
> 7, field 8 etc.
> 
> Wherever you see '+2' in the output, that means that more than 1 frame
> period has elapsed since the last frame was flipped.

If I understand correctly, "+1" means that there was no dropped frames,
whether the flip occured during field 0 or 1. Field 1 meaning that
decoding was a bit late, but not enough to show stutter on screen...

> You can see that often the flips occur first during field 0 of a frame,
> then
> after a few frames, they've slipped into field 1, then you skip a frame and
> go back to field 0.

That's softdevice behaviour, which tries to keep up with frame rate. OK.

> I suspect that the DirectFB gfxdriver and the framebuffer are working
> perfectly but your hardware is just not able to keep up with generating
> frames.

This is a Via C3 Nehemiah 1GHz, with the following CPU usage on typical
live TV :

* software decoding:
  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 2820 vdr       15   0  264m  54m 5696 S 58.0 24.7   0:42.09 vdr
* hardware decoding:
 3118 vdr       15   0  278m  50m 5580 S 37.7 23.2   0:17.70 vdr

General CPU usage (HW decoding):
Cpu(s): 20.0% us,  9.3% sy,  0.0% ni, 66.3% id,  0.0% wa,  4.3% hi,  0.0% si

Maybe the problem is the load average, which seems to reach 1.00 (after
a few minutes):
	load average: 1.07, 1.02, 0.50
(this may be biased by logging and "top", ssh, etc.)

That's on the softdevice side it seems.
Laz's 1.2GHz may be just the missing bit to get full synch...

>    307 current frame + 1 field 0 flipping on field 0
> 
>    792 current frame + 1 field 0 flipping on field 0
> 
> Those bits probably displayed properly, yes?

I guess... Since output is directed to a buffered file, I can't say for
sure.

> I presume that output you quoted was for the software decode case?  How
> does it look when you use the hardware decoder?

This was the hardware decoder. The following set is with software decoding :

      1 current frame + 0 field 0 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 26 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 4 field 0 flipping on field 0
     15 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
      4 current frame + 1 field 0 flipping on field 0
      9 current frame + 1 field 1 flipping on field 0
      1 current frame + 2 field 0 flipping on field 0
     22 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
     16 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
     10 current frame + 1 field 0 flipping on field 0
     16 current frame + 1 field 1 flipping on field 0
     11 current frame + 1 field 0 flipping on field 0
      4 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
     82 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     30 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      9 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     63 current frame + 1 field 0 flipping on field 0
     11 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      7 current frame + 1 field 0 flipping on field 0
      5 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     66 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      4 current frame + 1 field 0 flipping on field 0
     14 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      6 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
     11 current frame + 1 field 1 flipping on field 0
     59 current frame + 1 field 0 flipping on field 0
      6 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
     67 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     16 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
     34 current frame + 1 field 0 flipping on field 0
      7 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
     10 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      4 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      8 current frame + 1 field 1 flipping on field 0
     85 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     29 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     28 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     17 current frame + 1 field 0 flipping on field 0
     15 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     73 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     33 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
     21 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      3 current frame + 1 field 0 flipping on field 0
      2 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      7 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      3 current frame + 1 field 1 flipping on field 0
      1 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     11 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     23 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      6 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     42 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      2 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
     20 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
      3 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
    171 current frame + 1 field 0 flipping on field 0
      1 current frame + 1 field 1 flipping on field 0
   1584 current frame + 1 field 0 flipping on field 0

This case has no +2, except at the beginning. After that, the output is
smooth.

@Stefan : is upgrading softdevice from 0.3.1 to CVS a good idea to try
to improve this (I know, the answer is not "no") ?

-- 
NH


From marko.makela at hut.fi  Mon Feb 12 21:16:46 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 12 Feb 2007 22:16:46 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback
	of?recordings?when suspended
In-Reply-To: <200702102354.04113.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<20070209200344.GB3663@localhost.localdomain>
	<200702100050.32874.stefan@lucke.in-berlin.de>
	<200702102354.04113.stefan@lucke.in-berlin.de>
Message-ID: <20070212201646.GB5442@localhost.localdomain>

On Sat, Feb 10, 2007 at 11:54:03PM +0100, Stefan Lucke wrote:
> On Saturday 10 February 2007 00:50, Stefan Lucke wrote:
> > On Friday 09 February 2007 21:03, Marko M?kel? wrote:
> > > On Thu, Feb 08, 2007 at 10:26:00AM +0200, Marko M?kel? wrote:
> 
> > > cReplayControl::NowReplaying() looks efficient: a static method that
> > > references two static variables.  I tried replacing !Transferring()
> > > with cReplayControl::NowReplaying(), and it works.
> > 
> > NowReplaying() is even newer than Transferring(), appeared is 1.4.4 ;-) .
> > 
> > > 
> > > Conclusion: use !Transferring() with an appropriate VDRVERSNUM check.
> > 
> > Yes.
> 
> This version is in cvs.

Thanks, I updated my softdevice patch for the vdr shutdown rewrite:

http://www.iki.fi/~msmakela/software/vdr/#shutdown

However, I had to remove the declaration and uses of gettid in
setup-softlog.c.  This is GNU libc 2.3.6 and
gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)

	Marko


From stefan at lucke.in-berlin.de  Mon Feb 12 22:48:32 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 12 Feb 2007 22:48:32 +0100
Subject: [Softdevice-devel] [PATCH] Pause the playback
	of?recordings?when suspended
In-Reply-To: <20070212201646.GB5442@localhost.localdomain>
References: <20070202202633.GB3854@localhost.localdomain>
	<200702102354.04113.stefan@lucke.in-berlin.de>
	<20070212201646.GB5442@localhost.localdomain>
Message-ID: <200702122248.32504.stefan@lucke.in-berlin.de>

On Monday 12 February 2007 21:16, Marko M?kel? wrote:

> 
> However, I had to remove the declaration and uses of gettid in
> setup-softlog.c.  This is GNU libc 2.3.6 and
> gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)

I found a compile error report on vdr-portal.
In the link below you'll find a patch with hopefully fixes that.
Patch works for me too, but previously I had no problems.

Just need 1 positive feedback.

http://www.vdr-portal.de/board/thread.php?postid=576709#post576709


-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Mon Feb 12 22:48:38 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 12 Feb 2007 22:48:38 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <45D06D8E.4020408@huillard.net>
References: <45CF1857.4020703@huillard.net>
	<b7f6d7370702120338k79feaaa5qdf7e3ef3dd75e98b@mail.gmail.com>
	<45D06D8E.4020408@huillard.net>
Message-ID: <200702122248.38389.stefan@lucke.in-berlin.de>

On Monday 12 February 2007 14:37, Nicolas Huillard wrote:

> 
> @Stefan : is upgrading softdevice from 0.3.1 to CVS a good idea to try
> to improve this (I know, the answer is not "no") ?

Your guess is right. Typical answer is yes, use CVS.
(be aware of the following problem + patch):
http://www.vdr-portal.de/board/thread.php?postid=576709#post576709

But looking at the diffs to 0.3.1, there are not so many improvements
towards performance. The only thing for newer DirectFB versions is the
AiRGB pixelformat issue, which should should work with softdevice cvs.

-- 
Stefan Lucke


From marko.makela at hut.fi  Tue Feb 13 08:27:22 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 13 Feb 2007 09:27:22 +0200
Subject: [Softdevice-devel] [PATCH] Pause the playback of recordings
	when suspended
In-Reply-To: <200702122248.32504.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<200702102354.04113.stefan@lucke.in-berlin.de>
	<20070212201646.GB5442@localhost.localdomain>
	<200702122248.32504.stefan@lucke.in-berlin.de>
Message-ID: <20070213072722.GA3512@localhost.localdomain>

On Mon, Feb 12, 2007 at 10:48:32PM +0100, Stefan Lucke wrote:
> On Monday 12 February 2007 21:16, Marko M?kel? wrote:
> 
> > 
> > However, I had to remove the declaration and uses of gettid in
> > setup-softlog.c.  This is GNU libc 2.3.6 and
> > gcc (GCC) 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)
> 
> I found a compile error report on vdr-portal.
> In the link below you'll find a patch with hopefully fixes that.
> Patch works for me too, but previously I had no problems.

The patch makes sense to me.  I'll try it tonight.

	Marko


From marko.makela at hut.fi  Tue Feb 13 20:52:33 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 13 Feb 2007 21:52:33 +0200
Subject: [Softdevice-devel] gettid compilation error
In-Reply-To: <200702122248.32504.stefan@lucke.in-berlin.de>
References: <20070202202633.GB3854@localhost.localdomain>
	<200702102354.04113.stefan@lucke.in-berlin.de>
	<20070212201646.GB5442@localhost.localdomain>
	<200702122248.32504.stefan@lucke.in-berlin.de>
Message-ID: <20070213195233.GA4306@localhost.localdomain>

On Mon, Feb 12, 2007 at 10:48:32PM +0100, Stefan Lucke wrote:
> I found a compile error report on vdr-portal.
> In the link below you'll find a patch with hopefully fixes that.
> Patch works for me too, but previously I had no problems.
> 
> Just need 1 positive feedback.
> 
> http://www.vdr-portal.de/board/thread.php?postid=576709#post576709

That patch works for me.  Please apply it.

	Marko


From stefan at lucke.in-berlin.de  Wed Feb 14 20:26:20 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 14 Feb 2007 20:26:20 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
	cle266 HW decoding
In-Reply-To: <45D03D21.5070505@huillard.net>
References: <45CF1857.4020703@huillard.net>
	<1171220292.45cf674453e9d@webmail.in-berlin.de>
	<45D03D21.5070505@huillard.net>
Message-ID: <200702142026.20582.stefan@lucke.in-berlin.de>

Dropping directfb.users.

On Monday 12 February 2007 11:10, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > You should get other messages printed to stderr too, like:
> > [dfb] Set DLBM_TRIPLE for layer [%s]
> > 
> > or if enabling triple buffering fails:
> > [dfb]: SetParms (): failed to set buffermode to triple, will try back video
> 
> I have them correctly on stderr :
> 
> [dfb] (osdLayer): flags, options, pixelformat: 0000000f, 00000000 00418c04
> [dfb] (osdLayer): width, height:               720 576
> [dfb] osdLayer has alpha channel
> [dfb] Set DLBM_TRIPLE for layer [VIA Unichrome Video]
> [dfb] DLOP_FIELD_PARITY supported by layer [VIA Unichrome Video]
> [surface capabilities] scrSurface: videoonly double-buffered flipping
> PixelFormat = 0x00418c04
> [dfb] width = 720, height = 576
> [dfb] got fmt = 0x00418c04 bpp = 32
> [dfb] Using this layer for OSD: (VIA CLE266 Graphics - [720x576])
> [surface capabilities] osdSurface: videoonly double-buffered flipping
> PixelFormat = 0x00418c04
> [dfb] Configuring CooperativeLevel for Overlay
> [surface capabilities] videoSurface: videoonly PixelFormat = 0x0810060a
> [dfb] Using this layer for OSD:        VIA CLE266 Graphics
> [dfb] Using this layer for Video out:  VIA Unichrome Video

> [dfb] Display frame time is 19995 microseconds

Hm, that is 50Hz. Thats the field rate and not the frame rate.
Can you try to set displayTimeUS to 40000 in video-dfb.c around
line 648 ?

That could make a difference, as dfb-out does no delays if delay
time is below frame time. In that case we should be throttled by the
display itself.

-- 
Stefan Lucke


From nicolas at huillard.net  Wed Feb 14 22:26:08 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Wed, 14 Feb 2007 22:26:08 +0100
Subject: [Softdevice-devel] [directfb-users] field parity : viafb, TVout,
 cle266 HW decoding
In-Reply-To: <200702142026.20582.stefan@lucke.in-berlin.de>
References: <45CF1857.4020703@huillard.net>	<1171220292.45cf674453e9d@webmail.in-berlin.de>	<45D03D21.5070505@huillard.net>
	<200702142026.20582.stefan@lucke.in-berlin.de>
Message-ID: <45D37E70.5010401@huillard.net>

Stefan Lucke a ?crit :
> On Monday 12 February 2007 11:10, Nicolas Huillard wrote:
>>[dfb] Display frame time is 19995 microseconds
> 
> Hm, that is 50Hz. Thats the field rate and not the frame rate.
> Can you try to set displayTimeUS to 40000 in video-dfb.c around
> line 648 ?

I tried 40000, 50000, 15000, with no visible difference.

-- 
NH


From joegi at scene.nl  Sun Feb 25 16:10:08 2007
From: joegi at scene.nl (Hugo Visser)
Date: Sun, 25 Feb 2007 16:10:08 +0100
Subject: [Softdevice-devel] Zoom to 16:9
Message-ID: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>

Hello,

I'm testing with vdr and softdevice to see if I can simplify and  
replace my current mythtv setup. One feature that I can't seem to  
find in softdevice is picture zooming. For example, some channels  
broadcast in 16:9 aspect, but the picture itself is letterboxed back  
to 4:3 (black bars). I'd like to zoom that picture to 16:9.

I have my lcd tv connected to the vga port and set softdevice to 16:9  
aspect ratio, same as the tv aspect ratio.

Is picture zooming already supported or if not is it something that  
is planned?

Thanks,

Hugo


From marko.makela at hut.fi  Sun Feb 25 20:21:04 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 25 Feb 2007 21:21:04 +0200
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
Message-ID: <20070225192104.GD24295@localhost.localdomain>

On Sun, Feb 25, 2007 at 04:10:08PM +0100, Hugo Visser wrote:
> Hello,
> 
> I'm testing with vdr and softdevice to see if I can simplify and  
> replace my current mythtv setup. One feature that I can't seem to  
> find in softdevice is picture zooming. For example, some channels  
> broadcast in 16:9 aspect, but the picture itself is letterboxed back  
> to 4:3 (black bars). I'd like to zoom that picture to 16:9.
> 
> I have my lcd tv connected to the vga port and set softdevice to 16:9  
> aspect ratio, same as the tv aspect ratio.
> 
> Is picture zooming already supported or if not is it something that  
> is planned?

It is already supported (softdevice.CropMode); see the plugin setup menu.
The setting is hidden on the topmost submenu (something about cropping;
I'm using the Finnish OSD).

However, it could be nice if softdevice honored the aspect ratio setting
from the DVB settings menu (VideoDisplayFormat and VideoFormat).  It
could also optionally display the WSS on the topmost line, so that
wide-screen TVs would automatically switch the aspect ratio.

	Marko


From stefan at lucke.in-berlin.de  Sun Feb 25 21:18:39 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 25 Feb 2007 21:18:39 +0100
Subject: [Softdevice-devel] Aspect ratio from DVB settings and WSS
	signalling. (WAS: Re: Zoom to 16:9)
Message-ID: <200702252118.39665.stefan@lucke.in-berlin.de>

On Sunday 25 February 2007 20:21, Marko M?kel? wrote:

> However, it could be nice if softdevice honored the aspect ratio setting
> from the DVB settings menu (VideoDisplayFormat and VideoFormat).

Answer is just simple:
1st, There are more aspect ratios selectable via our setup menu 
     (5:4, 16:10, 15:9) than vdr supports, and 
2nd, I didn't ask Klaus for adding more A/Rs to his DVB menu as
     his usual answer would be: "It works for me and those A/Rs are
     not supported by FF cards".

> It could also optionally display the WSS on the topmost line, so that
> wide-screen TVs would automatically switch the aspect ratio.

If someone has a WSS capable TV for testing, we could do
something on topmost two lines.

But this is no solution in case of stations which do not provide correct
signalling of their A/R (AFD - Active Format Display).
If AFD info is be present, we use it.

-- 
Stefan Lucke


From marko.makela at hut.fi  Sun Feb 25 21:30:00 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 25 Feb 2007 22:30:00 +0200
Subject: [Softdevice-devel] [PATCH] Suspend output when the user is inactive
Message-ID: <20070225203000.GB28061@localhost.localdomain>

Now that VDR 1.5.1 includes the rewritten shutdown logic by Udo Richter,
I hope that the attached patch can be applied to softdevice.  It
suspends the output when ShutdownHandler.IsUserInactive() holds.
The setup menu item for suspending output still works.

Please note that the variable "Shutdown" of Udo's patch was renamed to
"ShutdownHandler" in VDR 1.5.1.  The attached patch uses "ShutdownHandler".

	Marko
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shutdown-softdevice.patch
Type: text/x-diff
Size: 4792 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070225/5070e900/attachment.patch>

From torgeir at pobox.com  Sun Feb 25 20:47:08 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 25 Feb 2007 19:47:08 +0000
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <20070225192104.GD24295@localhost.localdomain>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
Message-ID: <D6FD87CE-D372-4942-AD52-3FAE47F16D42@pobox.com>


On 25 Feb 2007, at 19:21, Marko M?kel? wrote:

> On Sun, Feb 25, 2007 at 04:10:08PM +0100, Hugo Visser wrote:
>> One feature that I can't seem to
>> find in softdevice is picture zooming. For example, some channels
>> broadcast in 16:9 aspect, but the picture itself is letterboxed back
>> to 4:3 (black bars). I'd like to zoom that picture to 16:9.
>
> It is already supported (softdevice.CropMode); see the plugin setup  
> menu.
> The setting is hidden on the topmost submenu (something about  
> cropping;
> I'm using the Finnish OSD).

It's still a bit cumbersome, if only needed for a single channel. We  
could have a key combination, eg a | A, that zooms and unzooms at eg  
1.2x intervals, to quickly turn on and off zooming. Xine uses the key  
comb a | A if I remember correctly.

-- 
Torgeir Veimo
torgeir at pobox.com





From marko.makela at hut.fi  Mon Feb 26 08:17:27 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 26 Feb 2007 09:17:27 +0200
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <D6FD87CE-D372-4942-AD52-3FAE47F16D42@pobox.com>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
	<D6FD87CE-D372-4942-AD52-3FAE47F16D42@pobox.com>
Message-ID: <20070226071727.GA3456@localhost.localdomain>

On Sun, Feb 25, 2007 at 07:47:08PM +0000, Torgeir Veimo wrote:
> 
> On 25 Feb 2007, at 19:21, Marko M?kel? wrote:
> 
> > On Sun, Feb 25, 2007 at 04:10:08PM +0100, Hugo Visser wrote:
> >> One feature that I can't seem to
> >> find in softdevice is picture zooming. For example, some channels
> >> broadcast in 16:9 aspect, but the picture itself is letterboxed back
> >> to 4:3 (black bars). I'd like to zoom that picture to 16:9.
> >
> > It is already supported (softdevice.CropMode); see the plugin setup  
> > menu.
> > The setting is hidden on the topmost submenu (something about  
> > cropping;
> > I'm using the Finnish OSD).
> 
> It's still a bit cumbersome, if only needed for a single channel. We  
> could have a key combination, eg a | A, that zooms and unzooms at eg  
> 1.2x intervals, to quickly turn on and off zooming. Xine uses the key  
> comb a | A if I remember correctly.

There already is the CropModeToggleKey.  I think it's mapped to some key
in the Xv output.  If softdevice reads the RCU via DirectFB, it can
steal one of the keys for that purpose.  Otherwise, I guess that you
could define a key macro within VDR.  I've mapped CropModeToggleKey
to User1 on my system.

Given that there are only 4 values of softdevice.CropMode, I don't think
that it makes much sense to occupy two keys.  If this is done, I'd
implement three keys, some of which could be left unmapped: CropModeToggleKey,
CropModeZoomInKey, and CropModeZoomOutKey.  Keyboard users would use the
zoom keys, and remote control units would keep using CropModeToggleKey.

	Marko


From joegi at scene.nl  Mon Feb 26 19:51:24 2007
From: joegi at scene.nl (Hugo Visser)
Date: Mon, 26 Feb 2007 19:51:24 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <20070225192104.GD24295@localhost.localdomain>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
Message-ID: <E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>


On Feb 25, 2007, at 8:21 PM, Marko M?kel? wrote:
> It is already supported (softdevice.CropMode); see the plugin setup  
> menu.
> The setting is hidden on the topmost submenu (something about  
> cropping;
> I'm using the Finnish OSD).

Well, I've tried that option already and I've just tried it again to  
confirm, but the cropping option seems to be the opposite of what I  
want.
The "problem" is that quite a few channels are broadcasting series  
and such that are in 16:9 in 4:3. So then I'll have black bars around  
the picture. Cropping to 16:9 just flattens the picture and stretches  
it horizontally. That doesn't give the correct aspect and the black  
bars above and below the picture remain.  What it should do is zoom  
the picture, so that the black bars get "out of screen" to fill the  
entire screen. I'm running on DirectFB, maybe that matters?

I think the aspect settings I've set up in softdevice are correct, as  
regular 16:9 broadcasts are "full screen".

Maybe I'm missing the point, if so could someone point me in the  
right direction?

Thanks,

Hugo



From marko.makela at hut.fi  Mon Feb 26 21:49:07 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 26 Feb 2007 22:49:07 +0200
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
	<E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>
Message-ID: <20070226204907.GA3451@localhost.localdomain>

On Mon, Feb 26, 2007 at 07:51:24PM +0100, Hugo Visser wrote:
> 
> On Feb 25, 2007, at 8:21 PM, Marko M?kel? wrote:
> > It is already supported (softdevice.CropMode); see the plugin setup  
> > menu.
> > The setting is hidden on the topmost submenu (something about  
> > cropping;
> > I'm using the Finnish OSD).
> 
> Well, I've tried that option already and I've just tried it again to  
> confirm, but the cropping option seems to be the opposite of what I  
> want.
> The "problem" is that quite a few channels are broadcasting series  
> and such that are in 16:9 in 4:3. So then I'll have black bars around  
> the picture. Cropping to 16:9 just flattens the picture and stretches  
> it horizontally. That doesn't give the correct aspect and the black  
> bars above and below the picture remain.  What it should do is zoom  
> the picture, so that the black bars get "out of screen" to fill the  
> entire screen. I'm running on DirectFB, maybe that matters?
> 
> I think the aspect settings I've set up in softdevice are correct, as  
> regular 16:9 broadcasts are "full screen".
> 
> Maybe I'm missing the point, if so could someone point me in the  
> right direction?

Sorry, I only have a 4:3 monitor, and there the cropping does work
(cutting from the left and right, so that the center of the 16:9 picture
fills the 4:3 screen).  I assumed that 4:3 footage would be similarly
stretched on a 16:9 screen.

	Marko


From stefan at lucke.in-berlin.de  Mon Feb 26 22:31:50 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 26 Feb 2007 22:31:50 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
	<E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>
Message-ID: <200702262231.50979.stefan@lucke.in-berlin.de>

On Monday 26 February 2007 19:51, Hugo Visser wrote:
> 
> On Feb 25, 2007, at 8:21 PM, Marko M?kel? wrote:
> > It is already supported (softdevice.CropMode); see the plugin setup  
> > menu.
> > The setting is hidden on the topmost submenu (something about  
> > cropping;
> > I'm using the Finnish OSD).
> 
> Well, I've tried that option already and I've just tried it again to  
> confirm, but the cropping option seems to be the opposite of what I  
> want.
> The "problem" is that quite a few channels are broadcasting series  
> and such that are in 16:9 in 4:3. So then I'll have black bars around  
> the picture. Cropping to 16:9 just flattens the picture and stretches  
> it horizontally. That doesn't give the correct aspect and the black  
> bars above and below the picture remain.  

Did you select the correct display aspect ratio for your device ?
What is the native resolution of your TV ?

Some plasma TVs have 1024x768 as a native 16:9 resolution (non square pixels).

> What it should do is zoom   
> the picture, so that the black bars get "out of screen" to fill the  
> entire screen. I'm running on DirectFB, maybe that matters?

The "should do" is the expected behaviour. 
What is your selected display resolution ?

Choosen resolution for displaying is reported via syslog.
Can you show us such lines for which you see wrong aspect on your screen ?
They  look like:
vdr: [14328] [VideoOut]: 720x576 [0,72 720x432] -> 1024x576 [0,0 1024x576]

> 
> I think the aspect settings I've set up in softdevice are correct, as  
> regular 16:9 broadcasts are "full screen".
> 
> Maybe I'm missing the point, if so could someone point me in the  
> right direction?
> 

-- 
Stefan Lucke


From joegi at scene.nl  Mon Feb 26 23:13:09 2007
From: joegi at scene.nl (Hugo Visser)
Date: Mon, 26 Feb 2007 23:13:09 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200702262231.50979.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<20070225192104.GD24295@localhost.localdomain>
	<E15374A5-9F97-4E52-AC97-0FAB3DEABCA6@scene.nl>
	<200702262231.50979.stefan@lucke.in-berlin.de>
Message-ID: <8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>


On Feb 26, 2007, at 10:31 PM, Stefan Lucke wrote:

> Did you select the correct display aspect ratio for your device ?
> What is the native resolution of your TV ?
>
> Some plasma TVs have 1024x768 as a native 16:9 resolution (non  
> square pixels).
>

The offical supported resolutions are 640x480 and 1024x768 according  
to the (sparse) manual, but the panel itself is W-XGA 1366x768  
pixels. I'm running 1024x768 in "full" or 16:9 mode, so the pixels  
must be non square. It's a JVC LT-26x70s.

>> What it should do is zoom
>> the picture, so that the black bars get "out of screen" to fill the
>> entire screen. I'm running on DirectFB, maybe that matters?
>
> The "should do" is the expected behaviour.
> What is your selected display resolution ?
>
> Choosen resolution for displaying is reported via syslog.
> Can you show us such lines for which you see wrong aspect on your  
> screen ?
> They  look like:
> vdr: [14328] [VideoOut]: 720x576 [0,72 720x432] -> 1024x576 [0,0  
> 1024x576]

Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: resolution changed:  
W(736 -> 704); H(576 ->576)
Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: aspect changed (0 - 
 > 0 ; 1.366667 -> 1.333333)
Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: 704x576 [0,0  
704x576] -> 1024x768 [128,0 768x768]

Then I tried with a fb.modes line of 1366x768 that I dug up on google  
(not quite correct but just for testing), and got these lines

Feb 26 23:05:13 localhost vdr: [6878] [VideoOut]: 528x576 [0,40  
528x496] -> 1368x768 [84,0 1197x768]
Feb 26 23:05:14 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  
528x576] -> 1368x768 [170,0 1026x768]
Feb 26 23:05:21 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  
528x576] -> 1368x768 [114,0 1140x768]
Feb 26 23:05:22 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  
528x576] -> 1368x768 [136,0 1094x768]
Feb 26 23:05:24 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  
528x576] -> 1368x768 [172,0 1024x768]

I'm still getting the same cropping results in this mode.

Hugo


From leo at calidae.net  Mon Feb 26 22:54:13 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Mon, 26 Feb 2007 22:54:13 +0100
Subject: [Softdevice-devel] directfb no system found :(
Message-ID: <45E35705.6060200@calidae.net>

Hi,

I want to run vdr softdevice with my epia M mobo thats cames with cle266 
chipset accelerator.
I have followed the:

*_HOWTO use the hardware mpeg decoding capabilities using 
libcle266mpegdec and softdevice

http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266

_*As say the how-to I have compiled the viafb module and has made a:

 mode=720x576 bpp=32 refresh=50 TVon=1 TVoverscan=1

In my crt tv I don't see garbage as other tries. I see my console.
But when I start vdr with:

./vdr -c /video -v /media/v0 -P"softdevice -vo dfb:cle266:viatv"

I get:

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
vo_argv: dfb:cle266:viatv
[softdevice] enabling CLE266 HW decoding
[softdevice] enabling field parity
[setup-softdevice] alsa ac3Mode set to: 1
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 1 lavc
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YV12)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 50
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
[Setup-Softplay] set lastDir to '/multimedia/series/Heroes'
[Setup-Softplay] set openLastDir to 1
[Setup-Softplay] set returnToLiveTV to 1
[Setup-Softplay] set use file index to 0
[Setup-Softplay] set live-TV while audio to 0
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3351040)
[dfb] init

     =======================|  DirectFB 1.0.0-rc4  |=======================
          (c) 2001-2006  United Cultures of Earth - go for outer space!
          (c) 2000-2004  Convergence (integrated media) GmbH
        ----------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-02-23 21:05)
(!) Direct/Modules: Module 'libdirectfb_fbdev.so' did not register 
itself after loading! Trying default module constructor...
(!) Direct/Modules: ... even did not register after explicitly calling 
the module constructor!
(!) DirectFB/core/system: No system found!
[dfb] init EXITING:action=IDirectFB* DirectFB::Create(), result=No 
(suitable) implementation found!

I use vdr 1.4.3, kernel 2.6.17 and softdevice cvs and havo no idea about 
this problem. I not consider myself a linux expert and need some help.

Thanks

Leo



From stefan at lucke.in-berlin.de  Tue Feb 27 21:49:28 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 27 Feb 2007 21:49:28 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200702262231.50979.stefan@lucke.in-berlin.de>
	<8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>
Message-ID: <200702272149.29181.stefan@lucke.in-berlin.de>

On Monday 26 February 2007 23:13, Hugo Visser wrote:
> 
> On Feb 26, 2007, at 10:31 PM, Stefan Lucke wrote:
> 
> > Did you select the correct display aspect ratio for your device ?
> > What is the native resolution of your TV ?
> >
> > Some plasma TVs have 1024x768 as a native 16:9 resolution (non  
> > square pixels).
> >
> 
> The offical supported resolutions are 640x480 and 1024x768 according  
> to the (sparse) manual, but the panel itself is W-XGA 1366x768  
> pixels. I'm running 1024x768 in "full" or 16:9 mode, so the pixels  
> must be non square. It's a JVC LT-26x70s.
> 
> >> What it should do is zoom
> >> the picture, so that the black bars get "out of screen" to fill the
> >> entire screen. I'm running on DirectFB, maybe that matters?
> >
> > The "should do" is the expected behaviour.
> > What is your selected display resolution ?
> >
> > Choosen resolution for displaying is reported via syslog.
> > Can you show us such lines for which you see wrong aspect on your  
> > screen ?
> > They  look like:
> > vdr: [14328] [VideoOut]: 720x576 [0,72 720x432] -> 1024x576 [0,0  
> > 1024x576]
> 
> Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: resolution changed:  
> W(736 -> 704); H(576 ->576)
> Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: aspect changed (0 -> 0 ; 1.366667 -> 1.333333)
> Feb 26 22:52:14 localhost vdr: [6553] [VideoOut]: 704x576 [0,0  704x576] -> 1024x768 [128,0 768x768]
> 
> Then I tried with a fb.modes line of 1366x768 that I dug up on google  
> (not quite correct but just for testing), and got these lines
> 

> Feb 26 23:05:13 localhost vdr: [6878] [VideoOut]: 528x576 [0,40 528x496] -> 1368x768 [84,0 1197x768]

For this one, it look like "Cropping" -> "CropMode" is set to 14:9 and "Screen Aspect"
set "16:9" or "default".
14:9:
video.c, line 345:
  if (afd_asp <= new_asp) {
    swidth = (int) (0.5 + ((double) tmpWidth * afd_asp / new_asp));
  } else {
    sheight = (int) (0.5 + ((double) tmpHeight * new_asp / afd_asp));
  }

new_asp: assumed as 4/3 (1.3333),
afd_asp: unknown but greater than new_asp
-> else part will be choosen.
so afd_asp = tmpHeight * new_asp / sheight;
sheight: about 496 (+2 due to adjusting to YV12)
tmpHeight: 576 (not other zoom / offset values applied)
afd_asp is about 1.54838 ( 14 / 9 = 1.5555)

> Feb 26 23:05:14 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  528x576] -> 1368x768 [170,0 1026x768]
> Feb 26 23:05:21 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  528x576] -> 1368x768 [114,0 1140x768]
> Feb 26 23:05:22 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  528x576] -> 1368x768 [136,0 1094x768]
> Feb 26 23:05:24 localhost vdr: [6878] [VideoOut]: 528x576 [0,0  528x576] -> 1368x768 [172,0 1024x768]

Did you cycle through all possible "Screen Aspect" possibilities ?

"Screen Aspect" should be set only once, so that it fits the geometry
of your output device.

So with screen aspect set to 16:9 and cropmode set to 16:9 it should work,
as long a pur 16:9 video fills the entire screen of your lcd .
Don't know what to ask further, exept for short sample recording as I've never
seen resolution 528x576 (only 540x576).


-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Tue Feb 27 22:42:15 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 27 Feb 2007 22:42:15 +0100
Subject: [Softdevice-devel] directfb no system found :(
In-Reply-To: <45E35705.6060200@calidae.net>
References: <45E35705.6060200@calidae.net>
Message-ID: <200702272242.15620.stefan@lucke.in-berlin.de>

On Monday 26 February 2007 22:54, Leo M?rquez wrote:

> 
>      =======================|  DirectFB 1.0.0-rc4  |=======================
>           (c) 2001-2006  United Cultures of Earth - go for outer space!
>           (c) 2000-2004  Convergence (integrated media) GmbH
>         ----------------------------------------------------------------
> 
> (*) DirectFB/Core: Single Application Core. (2007-02-23 21:05)
> (!) Direct/Modules: Module 'libdirectfb_fbdev.so' did not register 
> itself after loading! Trying default module constructor...
> (!) Direct/Modules: ... even did not register after explicitly calling 
> the module constructor!
> (!) DirectFB/core/system: No system found!
> [dfb] init EXITING:action=IDirectFB* DirectFB::Create(), result=No 
> (suitable) implementation found!

Can you check your DirectFB configure logs?
Are you sure that unichrome target  / driver was selected and build,
and/or viafb framebuffer module is loaded ?

> 
> I use vdr 1.4.3, kernel 2.6.17 and softdevice cvs and havo no idea about 
> this problem. I not consider myself a linux expert and need some help.
> 

-- 
Stefan Lucke


From joegi at scene.nl  Tue Feb 27 23:08:14 2007
From: joegi at scene.nl (Hugo Visser)
Date: Tue, 27 Feb 2007 23:08:14 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200702272149.29181.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200702262231.50979.stefan@lucke.in-berlin.de>
	<8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>
	<200702272149.29181.stefan@lucke.in-berlin.de>
Message-ID: <5A6A80AB-3555-4354-B3B2-8DAE41780388@scene.nl>

Hi Stefan,

> For this one, it look like "Cropping" -> "CropMode" is set to 14:9  
> and "Screen Aspect"
> set "16:9" or "default".
> 14:9:
> video.c, line 345:
>   if (afd_asp <= new_asp) {
>     swidth = (int) (0.5 + ((double) tmpWidth * afd_asp / new_asp));
>   } else {
>     sheight = (int) (0.5 + ((double) tmpHeight * new_asp / afd_asp));
>   }
>
> new_asp: assumed as 4/3 (1.3333),
> afd_asp: unknown but greater than new_asp
> -> else part will be choosen.
> so afd_asp = tmpHeight * new_asp / sheight;
> sheight: about 496 (+2 due to adjusting to YV12)
> tmpHeight: 576 (not other zoom / offset values applied)
> afd_asp is about 1.54838 ( 14 / 9 = 1.5555)
>

I think the crop mode was disabled, but the aspect was set to 16:9.  
I'll test again and pay more attention :)

>> Feb 26 23:05:14 localhost vdr: [6878] [VideoOut]: 528x576 [0,0   
>> 528x576] -> 1368x768 [170,0 1026x768]
>> Feb 26 23:05:21 localhost vdr: [6878] [VideoOut]: 528x576 [0,0   
>> 528x576] -> 1368x768 [114,0 1140x768]
>> Feb 26 23:05:22 localhost vdr: [6878] [VideoOut]: 528x576 [0,0   
>> 528x576] -> 1368x768 [136,0 1094x768]
>> Feb 26 23:05:24 localhost vdr: [6878] [VideoOut]: 528x576 [0,0   
>> 528x576] -> 1368x768 [172,0 1024x768]
>
> Did you cycle through all possible "Screen Aspect" possibilities ?
>

Yes I was cycling here, I realized that when I'd already sent the  
message that log wasn't very usefull.

> "Screen Aspect" should be set only once, so that it fits the geometry
> of your output device.
>
> So with screen aspect set to 16:9 and cropmode set to 16:9 it  
> should work,
> as long a pur 16:9 video fills the entire screen of your lcd .
> Don't know what to ask further, exept for short sample recording as  
> I've never
> seen resolution 528x576 (only 540x576).

I'll record a short clip and post back when I've put it online  
somewhere if thats ok. I think that will be later this week as I then  
have some spare time to hack on this. I'll look at vdeo.c to see if I  
can put in some printf's so that I can figure out what's going on.

Could it be that my dvb device (a dvb-t usb stick) is producing the  
weird resolution? I thought it was the broadcaster that controls that?

Thanks,

Hugo


From leo at calidae.net  Tue Feb 27 23:10:45 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Tue, 27 Feb 2007 23:10:45 +0100
Subject: [Softdevice-devel] directfb no system found :(
In-Reply-To: <200702272242.15620.stefan@lucke.in-berlin.de>
References: <45E35705.6060200@calidae.net>
	<200702272242.15620.stefan@lucke.in-berlin.de>
Message-ID: <45E4AC65.60707@calidae.net>

Thanks for your answer Stefan,

Stefan Lucke escribi?:

>On Monday 26 February 2007 22:54, Leo M?rquez wrote:
>
>  
>
>>     =======================|  DirectFB 1.0.0-rc4  |=======================
>>          (c) 2001-2006  United Cultures of Earth - go for outer space!
>>          (c) 2000-2004  Convergence (integrated media) GmbH
>>        ----------------------------------------------------------------
>>
>>(*) DirectFB/Core: Single Application Core. (2007-02-23 21:05)
>>(!) Direct/Modules: Module 'libdirectfb_fbdev.so' did not register 
>>itself after loading! Trying default module constructor...
>>(!) Direct/Modules: ... even did not register after explicitly calling 
>>the module constructor!
>>(!) DirectFB/core/system: No system found!
>>[dfb] init EXITING:action=IDirectFB* DirectFB::Create(), result=No 
>>(suitable) implementation found!
>>    
>>
>
>Can you check your DirectFB configure logs?
>  
>
I have reviewed syslog and have not saw any dfb info.

>Are you sure that unichrome target  / driver was selected and build,
>and/or viafb framebuffer module is loaded ?
>  
>
This is my dfbinfo:

dori:~# dfbinfo

     =======================|  DirectFB 1.0.0-rc4  |=======================
          (c) 2001-2006  United Cultures of Earth - go for outer space!
          (c) 2000-2004  Convergence (integrated media) GmbH
        ----------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-02-26 22:35)
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 3966)...
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 3967)...
(*) DirectFB/Input: AT Translated Set 2 keyboard (1) 0.1 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 3968)...
(*) DirectFB/Input: Logitech USB Receiver (2) 0.1 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 3969)...
(*) DirectFB/Input: PC Speaker (3) 0.1 (directfb.org)
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.3 (directfb.org)


Screen (00) FBDev Primary Screen            (primary screen)
   Caps: VSYNC POWER_MANAGEMENT

     Layer (00) VIA CLE266 Graphics             (primary layer)
        Type:    GRAPHICS
        Caps:    SURFACE OPACITY ALPHACHANNEL SRC_COLORKEY BRIGHTNESS 
CONTRAST SATURATION

     Layer (01) VIA Unichrome Video
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY SCREEN_LOCATION DEINTERLACING 
DST_COLORKEY LEVELS FIELD_PARITY SCREEN_POSITION SCREEN_SIZE

     Layer (02) VIA Unichrome DVD Subpicture
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY


Input (01) IMPS/2 Mouse                    (primary mouse)
   Type: MOUSE
   Caps: AXES BUTTONS
   Max. Axis: 2
   Max. Button: 2

Input (00) AT Translated Set 2 keyboard    (primary keyboard)
   Type: KEYBOARD
   Caps: KEYS

Input (10) Logitech USB Receiver
   Type: MOUSE
   Caps: AXES BUTTONS
   Max. Axis: 2
   Max. Button: 4

Where can I found more information about the problem?

Thanks for your help.

Leo


From marko.makela at hut.fi  Wed Feb 28 10:14:38 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 28 Feb 2007 11:14:38 +0200
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <5A6A80AB-3555-4354-B3B2-8DAE41780388@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200702262231.50979.stefan@lucke.in-berlin.de>
	<8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>
	<200702272149.29181.stefan@lucke.in-berlin.de>
	<5A6A80AB-3555-4354-B3B2-8DAE41780388@scene.nl>
Message-ID: <20070228091438.GA3701@localhost.localdomain>

On Tue, Feb 27, 2007 at 11:08:14PM +0100, Hugo Visser wrote:
> Could it be that my dvb device (a dvb-t usb stick) is producing the  
> weird resolution? I thought it was the broadcaster that controls that?

The DVB device should just buffer and transfer MPEG TS packets.  It is
ffmpeg and softdevice that deal with the resolution and aspect ratio.
Yes, those are set by the broadcaster.  And sometimes they're set
incorrectly (such as 16:9 program being tagged as 4:3 for a couple of
minutes until someone corrected the error).  I recorded that program,
if anyone is interested.

	Marko


From stefan at lucke.in-berlin.de  Wed Feb 28 12:14:57 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 28 Feb 2007 12:14:57 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <5A6A80AB-3555-4354-B3B2-8DAE41780388@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200702262231.50979.stefan@lucke.in-berlin.de>
	<8309F703-A1DE-4E47-AADC-EDAC0A850B7D@scene.nl>
	<200702272149.29181.stefan@lucke.in-berlin.de>
	<5A6A80AB-3555-4354-B3B2-8DAE41780388@scene.nl>
Message-ID: <1172661297.45e564313bc99@webmail.in-berlin.de>

Quoting Hugo Visser:

> I'll record a short clip and post back when I've put it online
> somewhere if thats ok.

Would be ok.

Which graphic card do you have ?
For some (like radeon) x-coordinates should bit 32? pixels aligned
for scaleing. For thoses cards it would be best to use the "old" code
path with "HAVE_SetSourceLocation" disabled. This parameter (define)
is detected during configure.

> I think that will be later this week as I then
> have some spare time to hack on this. I'll look at vdeo.c to see if I
> can put in some printf's so that I can figure out what's going on.
>

Stefan Lucke



From bob at globall.ru  Wed Feb 28 13:55:48 2007
From: bob at globall.ru (Vladimir Monchenko)
Date: Wed, 28 Feb 2007 15:55:48 +0300
Subject: [Softdevice-devel] cle266 + RGB tvout - possibly?
Message-ID: <45E57BD4.9020801@globall.ru>

Hi all!

My TV has SCART RGB and Y/Pb/Pr connecting.
Is there a way to connect to them VIA EPIA ME-6000 (cle266) through
D-SUB VGA output over DirectFB?
Thank you.

Regards,
Vladimir Monchenko.


From nicolas at huillard.net  Thu Mar  1 11:14:34 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Thu, 01 Mar 2007 11:14:34 +0100
Subject: [Softdevice-devel] cle266 + RGB tvout - possibly?
In-Reply-To: <45E57BD4.9020801@globall.ru>
References: <45E57BD4.9020801@globall.ru>
Message-ID: <45E6A78A.9030300@huillard.net>

Vladimir Monchenko a ?crit :
> My TV has SCART RGB and Y/Pb/Pr connecting.
> Is there a way to connect to them VIA EPIA ME-6000 (cle266) through
> D-SUB VGA output over DirectFB?

The TV encoder is able to output RGB signal, which needs 4 DACs to
actually work (R + G + B + sync). The EPIA M series only have 3 of the
DACs actually connected, so this is an option only if you don't mind
soldering on the mobo...

The VGA output can be used (like Stefan does on Matrox cards) to output
RGB signal, but you have to build a simple synch signal merging circuit
(Hsync + Vsync + change voltage). You also have to convince the CLE266
to output an interlaced signal, which I didn't read about anywhere...

-- 
NH


From nicolas at huillard.net  Thu Mar  1 11:06:42 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Thu, 01 Mar 2007 11:06:42 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
Message-ID: <45E6A5B2.4020308@huillard.net>

Hugo Visser a ?crit :
> I'm testing with vdr and softdevice to see if I can simplify and  
> replace my current mythtv setup. One feature that I can't seem to  
> find in softdevice is picture zooming. For example, some channels  
> broadcast in 16:9 aspect, but the picture itself is letterboxed back  
> to 4:3 (black bars). I'd like to zoom that picture to 16:9.
> 
> I have my lcd tv connected to the vga port and set softdevice to 16:9  
> aspect ratio, same as the tv aspect ratio.
> 
> Is picture zooming already supported or if not is it something that  
> is planned?

I just read the whole thread, and it appears you have the same problem
than me :
* broadcasters in your country send bogus aspect ratio information, or
simply do not bother with 16:9 TVs
* you actually have a 16:9 screen
* Stefan and other core developers have quality programs with correct
AFD, 16:9-aware broadcasters et al.

I think the problem is that SoftDevice's crop-mode actually manages to
get all the broadcasted picture on the screen, sometimes adding black
bars (either top/bottom or left/right). What we want is softdevice to
*remove* broadcasted black bars (the kind of dumb black bars that
uselessly consume bandwidth).

Maybe the solution is to toggle SoftDevice's cropmode behaviour from
"reduce image to fit on the screen, adding black bars" to "expand the
image, without bothering with lost parts of the image, which happen to
be black bars".

-- 
NH


From marko.makela at hut.fi  Thu Mar  1 12:05:22 2007
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 1 Mar 2007 13:05:22 +0200
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <45E6A5B2.4020308@huillard.net>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E6A5B2.4020308@huillard.net>
Message-ID: <20070301110522.GC3633@localhost.localdomain>

On Thu, Mar 01, 2007 at 11:06:42AM +0100, Nicolas Huillard wrote:
> Maybe the solution is to toggle SoftDevice's cropmode behaviour from
> "reduce image to fit on the screen, adding black bars" to "expand the
> image, without bothering with lost parts of the image, which happen to
> be black bars".

Good idea.  Over here in Finland, the DVB-T broadcasters seem to avoid
aspect ratio changes within a program.  A year ago, the children's program
"Pikku kakkonen" was broadcast in 4:3, and they added colourful bars on
top and bottom of 16:9 material.  Now they're broadcasting at 16:9 and
cropping the top and bottom of 4:3 material (such as a Polish classic
animation from the 1980s, which I think infringes the moral copyright).

On commercial channels, movies are often broadcast at 16:9 and commercials
at 4:3.  Every now and then, some older 16:9 material is broadcast
at 4:3.  Maybe the material was shipped on analog tapes at 4:3 resolution?

	Marko


From torgeir at pobox.com  Thu Mar  1 11:59:57 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 1 Mar 2007 10:59:57 +0000
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <45E6A5B2.4020308@huillard.net>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E6A5B2.4020308@huillard.net>
Message-ID: <25ECE29A-4814-40BF-954F-470005B5E8A4@pobox.com>


On 1 Mar 2007, at 10:06, Nicolas Huillard wrote:

> I just read the whole thread, and it appears you have the same problem
> than me :
> * broadcasters in your country send bogus aspect ratio information, or
> simply do not bother with 16:9 TVs

You mean anything letterboxed inside a 4x3 frame? Most music channels  
still transmit this way..

-- 
Torgeir Veimo
torgeir at pobox.com





From nicolas at huillard.net  Thu Mar  1 18:23:56 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Thu, 01 Mar 2007 18:23:56 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <25ECE29A-4814-40BF-954F-470005B5E8A4@pobox.com>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<45E6A5B2.4020308@huillard.net>
	<25ECE29A-4814-40BF-954F-470005B5E8A4@pobox.com>
Message-ID: <45E70C2C.9050009@huillard.net>

Torgeir Veimo a ?crit :
> On 1 Mar 2007, at 10:06, Nicolas Huillard wrote:
>>* broadcasters in your country send bogus aspect ratio information, or
>>simply do not bother with 16:9 TVs
> 
> You mean anything letterboxed inside a 4x3 frame? Most music channels  
> still transmit this way..

I think we mean the same, yes.

(we have a music channel which seem to be the only french one to
transmit correct aspect ratio... I can say there is no rule of thumb
regarding how broadcasters encode their programs...)

-- 
NH


From joegi at scene.nl  Thu Mar  1 20:03:12 2007
From: joegi at scene.nl (Hugo Visser)
Date: Thu, 1 Mar 2007 20:03:12 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <45E6A5B2.4020308@huillard.net>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E6A5B2.4020308@huillard.net>
Message-ID: <2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>

On Mar 1, 2007, at 11:06 AM, Nicolas Huillard wrote:

>
> I just read the whole thread, and it appears you have the same problem
> than me :
> * broadcasters in your country send bogus aspect ratio information, or
> simply do not bother with 16:9 TVs
> * you actually have a 16:9 screen
> * Stefan and other core developers have quality programs with correct
> AFD, 16:9-aware broadcasters et al.
>

I think you're spot on. Real 16:9 broadcasts are slowly becoming  
reality on the three public nets we have in the Netherlands. The  
commercial channels like RTL 4 and such do not broadcast in 16:9 at  
all. Most of their content is 4:3, but some of that (mostly series)  
is 16:9 content, scaled or cropped to 4:3 adding black bars.

> Maybe the solution is to toggle SoftDevice's cropmode behaviour from
> "reduce image to fit on the screen, adding black bars" to "expand the
> image, without bothering with lost parts of the image, which happen to
> be black bars".

Thats what I meant with zooming the picture , in stead of cropping.  
If soft device could zoom the picture up to the point that the added  
black bars are gone, I'd be happy.

As a reference, this link describes the mythtv zooming: http:// 
www.mythtv.org/wiki/index.php/Aspect_ratio

I'll try to record some "evidence" later this night.

Hugo




From stefan at lucke.in-berlin.de  Thu Mar  1 21:38:20 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 1 Mar 2007 21:38:20 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E6A5B2.4020308@huillard.net>
	<2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>
Message-ID: <200703012138.20273.stefan@lucke.in-berlin.de>

On Thursday 01 March 2007 20:03, Hugo Visser wrote:
> On Mar 1, 2007, at 11:06 AM, Nicolas Huillard wrote:
> 
> >
> > I just read the whole thread, and it appears you have the same problem
> > than me :
> > * broadcasters in your country send bogus aspect ratio information, or
> > simply do not bother with 16:9 TVs
> > * you actually have a 16:9 screen
> > * Stefan and other core developers have quality programs with correct
> > AFD, 16:9-aware broadcasters et al.
> >
> 
> I think you're spot on. Real 16:9 broadcasts are slowly becoming  
> reality on the three public nets we have in the Netherlands. The  
> commercial channels like RTL 4 and such do not broadcast in 16:9 at  
> all. Most of their content is 4:3, but some of that (mostly series)  
> is 16:9 content, scaled or cropped to 4:3 adding black bars.
> 
> > Maybe the solution is to toggle SoftDevice's cropmode behaviour from
> > "reduce image to fit on the screen, adding black bars" to "expand the
> > image, without bothering with lost parts of the image, which happen to
> > be black bars".
> 
> Thats what I meant with zooming the picture , in stead of cropping.  
> If soft device could zoom the picture up to the point that the added  
> black bars are gone, I'd be happy.
> 
> As a reference, this link describes the mythtv zooming: http:// 
> www.mythtv.org/wiki/index.php/Aspect_ratio

Whats described there within section "zoom" is what we are actual doing.

I took some screen shots of a broadcast which is 4:3 aspect with encoded
black bars (letterboxed video). It is displayed via xv-out in a 1024x576 window.

http://lucke.in-berlin.de/aspect-crop/DSC00082.JPG

The initial crop mode is none, so I get black borders on all 4 sides.
http://lucke.in-berlin.de/aspect-crop/DSC00083.JPG

Now when I select cropmode 16:9, the corresponding 16:9 part of that
video is taken and displayed in the whole area of the window.
http://lucke.in-berlin.de/aspect-crop/DSC00084.JPG

So I've a small problem in understanding what might be wrong in
our zoom/crop-modes.

-- 
Stefan Lucke


From nicolas at huillard.net  Fri Mar  2 12:22:57 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Fri, 02 Mar 2007 12:22:57 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703012138.20273.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<45E6A5B2.4020308@huillard.net>	<2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>
	<200703012138.20273.stefan@lucke.in-berlin.de>
Message-ID: <45E80911.2050509@huillard.net>

Stefan Lucke a ?crit :
> Whats described there within section "zoom" is what we are actual doing.
> 
> I took some screen shots of a broadcast which is 4:3 aspect with encoded
> black bars (letterboxed video). It is displayed via xv-out in a 1024x576 window.
> 
> http://lucke.in-berlin.de/aspect-crop/DSC00082.JPG
> 
> The initial crop mode is none, so I get black borders on all 4 sides.
> http://lucke.in-berlin.de/aspect-crop/DSC00083.JPG
> 
> Now when I select cropmode 16:9, the corresponding 16:9 part of that
> video is taken and displayed in the whole area of the window.
> http://lucke.in-berlin.de/aspect-crop/DSC00084.JPG
> 
> So I've a small problem in understanding what might be wrong in
> our zoom/crop-modes.

Your photos seem to show what I would like, except that you're in a
1024x576 window on a 4:3 device.

We're talking about DirectFB and full-screen and output on a 16:9
device. The problem might be either of those 3 conditions.

On a 720x576 physical resolution, I (and also Hugo, I think) would like
the horizontal scaling to fit the entire space (ie. 720 pixels), and
horizontal scaling to enlarge the image to show only ~400 MPEG lines on
the 576 physical lines, leaving ~176 black lines out of the physical device.

I'm not able to take shots and post them at the moment.

-- 
NH


From joegi at scene.nl  Fri Mar  2 18:45:17 2007
From: joegi at scene.nl (Hugo Visser)
Date: Fri, 2 Mar 2007 18:45:17 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <45E80911.2050509@huillard.net>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<45E6A5B2.4020308@huillard.net>	<2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>
	<200703012138.20273.stefan@lucke.in-berlin.de>
	<45E80911.2050509@huillard.net>
Message-ID: <9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>


On Mar 2, 2007, at 12:22 PM, Nicolas Huillard wrote:
> Your photos seem to show what I would like, except that you're in a
> 1024x576 window on a 4:3 device.
>
> We're talking about DirectFB and full-screen and output on a 16:9
> device. The problem might be either of those 3 conditions.

Maybe it's also due to the fact that I've set softdevice to 16:9 and  
not "default". Here are my screen shots:

A 16:9 broadcast shown correctly, soft device is set to 16:9 aspect  
ratio. Then the same broadcast using the "default" aspect ratio; the  
image is stretched, black bars are added on top.

http://img402.imageshack.us/img402/1438/dsc00244xv7.jpg
http://img442.imageshack.us/img442/1990/dsc00245lt9.jpg

A normal 4:3 broadcast in 16:9 aspect, black bars around only the  
channel logo pops out. Then the same broadcast using cropmode 16:9.  
Again, the image is streched horizontally, but the black bars on top  
remain. Other crop modes only stretch the image.

http://img184.imageshack.us/img184/6725/dsc00246qj5.jpg
http://img144.imageshack.us/img144/516/dsc00247kq1.jpg

Hope this makes things more clear...

Hugo


From nicolas at huillard.net  Fri Mar  2 19:16:45 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Fri, 02 Mar 2007 19:16:45 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<45E6A5B2.4020308@huillard.net>	<2AA0C40C-8BEC-4DF8-9686-C025DEA7BEDA@scene.nl>	<200703012138.20273.stefan@lucke.in-berlin.de>	<45E80911.2050509@huillard.net>
	<9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>
Message-ID: <45E86A0D.8040704@huillard.net>

Hugo Visser a ?crit :
> A normal 4:3 broadcast in 16:9 aspect, black bars around only the  
> channel logo pops out. Then the same broadcast using cropmode 16:9.  
> Again, the image is streched horizontally, but the black bars on top  
> remain. Other crop modes only stretch the image.
> 
> http://img184.imageshack.us/img184/6725/dsc00246qj5.jpg
> http://img144.imageshack.us/img144/516/dsc00247kq1.jpg
> 
> Hope this makes things more clear...

That's exactly what I also experience. Thank you for the photos...

What I would like to have is the lastest image
(http://img144.imageshack.us/img144/516/dsc00247kq1.jpg), stretched
vertically to remove the horizontal black bars. The image would have the
same aspect than the previous one
(http://img184.imageshack.us/img184/6725/dsc00246qj5.jpg), just filling
the whole screen device.

-- 
NH


From stefan at lucke.in-berlin.de  Fri Mar  2 23:01:17 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 2 Mar 2007 23:01:17 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E80911.2050509@huillard.net>
	<9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>
Message-ID: <200703022301.17955.stefan@lucke.in-berlin.de>

On Friday 02 March 2007 18:45, Hugo Visser wrote:
> 
> On Mar 2, 2007, at 12:22 PM, Nicolas Huillard wrote:
> > Your photos seem to show what I would like, except that you're in a
> > 1024x576 window on a 4:3 device.
> >
> > We're talking about DirectFB and full-screen and output on a 16:9
> > device. The problem might be either of those 3 conditions.

That shouldn't matter :-) .

> 
> Maybe it's also due to the fact that I've set softdevice to 16:9 and  
> not "default". Here are my screen shots:
> 
> A 16:9 broadcast shown correctly, soft device is set to 16:9 aspect  
> ratio. Then the same broadcast using the "default" aspect ratio; the  
> image is stretched, black bars are added on top.
> 
> http://img402.imageshack.us/img402/1438/dsc00244xv7.jpg
> http://img442.imageshack.us/img442/1990/dsc00245lt9.jpg

Can't believe what I see.

Can you try attached patch to get some more infos ?
Which graphic card do you use ?


-- 
Stefan Lucke
-------------- next part --------------
Index: video.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video.c,v
retrieving revision 1.73
diff -U3 -r1.73 video.c
--- video.c	26 Feb 2007 23:00:34 -0000	1.73
+++ video.c	2 Mar 2007 21:58:43 -0000
@@ -262,6 +262,9 @@
      */
     lheight = dheight;
     lwidth = (int) (0.5 + ((double) dheight * afd_aspect / p_asp));
+setupStore->softlog->Log(SOFT_LOG_DEBUG, 0,
+"[video] ++ afd = %.5f, pasp = %.5f, dasp = %.5f, sa = %d, dw = %d, dh = %d\n",
+afd_aspect, p_asp, d_asp, screenPixelAspect, dwidth, dheight);
   } else {
     /* ------------------------------------------------------------------------
      * display aspect is taller or equal than frame aspect
@@ -269,6 +272,9 @@
      */
     lwidth = dwidth;
     lheight = (int) (0.5 + ((double) dwidth * p_asp / afd_aspect));
+setupStore->softlog->Log(SOFT_LOG_DEBUG, 0,
+"[video] -- afd = %.5f, pasp = %.5f, dasp = %.5f, sa = %d, dw = %d, dh = %d\n",
+afd_aspect, p_asp, d_asp, screenPixelAspect, dwidth, dheight);
   }
 
   /* -------------------------------------------------------------------------

From joegi at scene.nl  Sat Mar  3 16:03:24 2007
From: joegi at scene.nl (Hugo Visser)
Date: Sat, 3 Mar 2007 16:03:24 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703022301.17955.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<45E80911.2050509@huillard.net>
	<9E22B17D-68FE-4344-983B-CF3F86950683@scene.nl>
	<200703022301.17955.stefan@lucke.in-berlin.de>
Message-ID: <4925233E-DDD3-4B8F-9D35-D76403607BFD@scene.nl>

>
> Can't believe what I see.
>
> Can you try attached patch to get some more infos ?
> Which graphic card do you use ?

I'm running vdr on an epia m10k, so the graphics are unichrome/ 
cle266. I'm using the -vo dfb:cle266 switch, but it doesn't matter if  
I'm using dfb: or dfb:266.

Here's the log (latest cvs + patch)

Again, softdevice is set to a fixed 16:9 aspect. The first broadcast  
is a 4:3 broadcast and is displayed correctly (black bars left and  
right).

Mar  3 15:48:46 localhost vdr: [7788] TS buffer on device 1 thread  
started (pid=7765, tid=7788)
Mar  3 15:48:48 localhost vdr: [7787] [VideoOut] reset: sync info:  
repF = 0, drpF = 0, totF = 0
Mar  3 15:48:48 localhost vdr: [7790] [VideoOut]: resolution changed:  
W(736 -> 704); H(576 ->576)
Mar  3 15:48:48 localhost vdr: [7790] [VideoOut]: aspect changed (0 - 
 > 0 ; 1.366667 -> 1.333333)
Mar  3 15:48:48 localhost vdr: [7790] [video] ++ afd = 1.33333, pasp  
= 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
Mar  3 15:48:48 localhost vdr: [7790] [VideoOut]: 704x576 [0,0  
704x576] -> 1024x768 [128,0 768x768]
Mar  3 15:48:48 localhost vdr: [7790] [dfb] (re)configuring  
Videolayer to 704 x 576 (704x576)
Mar  3 15:48:48 localhost vdr: [7790] [dfb] surface capabilities for  
(videoSurface): videoonly, double-buffered, flipping, PixelFormat =  
0x08100609
Mar  3 15:48:48 localhost vdr: [7790] [dfb] (re)configured 0x08100609

Then I switched to another channel with a 16:9 broadcast cropped back  
to 4:3 (black bars all around)

Mar  3 15:49:15 localhost vdr: [7805] TS buffer on device 1 thread  
started (pid=7765, tid=7805)
Mar  3 15:49:16 localhost vdr: [7804] [VideoOut] reset: sync info:  
repF = 153, drpF = 1, totF = 158
Mar  3 15:49:16 localhost vdr: [7806] [VideoOut]: resolution changed:  
W(704 -> 528); H(576 ->576)
Mar  3 15:49:16 localhost vdr: [7806] [video] ++ afd = 1.33333, pasp  
= 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
Mar  3 15:49:16 localhost vdr: [7806] [VideoOut]: 528x576 [0,0  
528x576] -> 1024x768 [128,0 768x768]
Mar  3 15:49:16 localhost vdr: [7806] [dfb] (re)configuring  
Videolayer to 528 x 576 (528x576)
Mar  3 15:49:16 localhost vdr: [7806] [dfb] surface capabilities for  
(videoSurface): videoonly, double-buffered, flipping, PixelFormat =  
0x08100609
Mar  3 15:49:16 localhost vdr: [7806] [dfb] (re)configured 0x08100609

Then I set the cropmode to 16:9

Mar  3 15:49:35 localhost vdr: [7806] [video] ++ afd = 1.33333, pasp  
= 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
Mar  3 15:49:35 localhost vdr: [7806] [VideoOut]: 528x576 [0,0  
528x576] -> 1024x768 [128,0 768x768]
Mar  3 15:49:35 localhost vdr: [7806] [dfb] (re)configuring  
Videolayer to 528 x 576 (528x576)
Mar  3 15:49:35 localhost vdr: [7806] [dfb] surface capabilities for  
(videoSurface): videoonly, double-buffered, flipping, PixelFormat =  
0x08100609
Mar  3 15:49:35 localhost vdr: [7806] [dfb] (re)configured 0x08100609
Mar  3 15:49:36 localhost vdr: [7806] [video] -- afd = 1.77778, pasp  
= 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
Mar  3 15:49:36 localhost vdr: [7806] [VideoOut]: 528x576 [0,72  
528x432] -> 1024x768 [0,0 1024x768]
Mar  3 15:49:36 localhost vdr: [7806] [dfb] (re)configuring  
Videolayer to 528 x 576 (528x432)
Mar  3 15:49:36 localhost vdr: [7806] [dfb] surface capabilities for  
(videoSurface): videoonly, double-buffered, flipping, PixelFormat =  
0x08100609
Mar  3 15:49:36 localhost vdr: [7806] [dfb] (re)configured 0x08100609

I've kept the full syslog, but I think these are the revelant parts.

Any clues?

Hugo



From stefan at lucke.in-berlin.de  Sat Mar  3 16:48:43 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 3 Mar 2007 16:48:43 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <4925233E-DDD3-4B8F-9D35-D76403607BFD@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703022301.17955.stefan@lucke.in-berlin.de>
	<4925233E-DDD3-4B8F-9D35-D76403607BFD@scene.nl>
Message-ID: <200703031648.43356.stefan@lucke.in-berlin.de>

On Saturday 03 March 2007 16:03, Hugo Visser wrote:
> >
> > Can't believe what I see.
> >
> > Can you try attached patch to get some more infos ?
> > Which graphic card do you use ?
> 
> I'm running vdr on an epia m10k, so the graphics are unichrome/ 
> cle266. I'm using the -vo dfb:cle266 switch, but it doesn't matter if  
> I'm using dfb: or dfb:266.

Good to know. So I should try my epia.

> 
> Here's the log (latest cvs + patch)
> 

> Then I set the cropmode to 16:9
> 
> Mar  3 15:49:35 localhost vdr: [7806] [video] ++ afd = 1.33333, pasp  = 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
> Mar  3 15:49:35 localhost vdr: [7806] [VideoOut]: 528x576 [0,0  528x576] -> 1024x768 [128,0 768x768]
> Mar  3 15:49:35 localhost vdr: [7806] [dfb] (re)configuring  Videolayer to 528 x 576 (528x576)
> Mar  3 15:49:35 localhost vdr: [7806] [dfb] surface capabilities for  (videoSurface): videoonly, double-buffered, flipping, PixelFormat =  0x08100609
> Mar  3 15:49:35 localhost vdr: [7806] [dfb] (re)configured 0x08100609
> Mar  3 15:49:36 localhost vdr: [7806] [video] -- afd = 1.77778, pasp  = 1.33333, dasp = 1.33333, sa = 3, dw = 1024, dh = 768
> Mar  3 15:49:36 localhost vdr: [7806] [VideoOut]: 528x576 [0,72  528x432] -> 1024x768 [0,0 1024x768]

But this are the correct numbers to fill the entire screen.

528x576 [0,72  528x432]: From source there are 72 lines cut from top and 72 lines cut from bottom.
1024x768 [0,0 1024x768]: Whole screen is used (x, y offset are zero).

Short test on epia: numer are the nearly the same, but screen is not filled :-(( .


-- 
Stefan Lucke


From joegi at scene.nl  Sat Mar  3 17:01:28 2007
From: joegi at scene.nl (Hugo Visser)
Date: Sat, 3 Mar 2007 17:01:28 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703031648.43356.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703022301.17955.stefan@lucke.in-berlin.de>
	<4925233E-DDD3-4B8F-9D35-D76403607BFD@scene.nl>
	<200703031648.43356.stefan@lucke.in-berlin.de>
Message-ID: <E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>

>
> But this are the correct numbers to fill the entire screen.
>
> 528x576 [0,72  528x432]: From source there are 72 lines cut from  
> top and 72 lines cut from bottom.
> 1024x768 [0,0 1024x768]: Whole screen is used (x, y offset are zero).
>
> Short test on epia: numer are the nearly the same, but screen is  
> not filled :-(( .

So that would mean it's a bug in directfb or the framebuffer I'm  
using? Or maybe something different? Maybe Nicolas can confirm that  
he's also using an epia or unichrome chipset...

Hugo




From stefan at lucke.in-berlin.de  Sat Mar  3 20:25:25 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 3 Mar 2007 20:25:25 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703031648.43356.stefan@lucke.in-berlin.de>
	<E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
Message-ID: <200703032025.25227.stefan@lucke.in-berlin.de>

On Saturday 03 March 2007 17:01, Hugo Visser wrote:
> >
> > But this are the correct numbers to fill the entire screen.
> >
> > 528x576 [0,72  528x432]: From source there are 72 lines cut from  
> > top and 72 lines cut from bottom.
> > 1024x768 [0,0 1024x768]: Whole screen is used (x, y offset are zero).
> >
> > Short test on epia: numer are the nearly the same, but screen is  
> > not filled :-(( .
> 
> So that would mean it's a bug in directfb or the framebuffer I'm  
> using? 

It's a bug (or missing feature) in the DirectFBs unichrome driver.
With my epia I get the same when defining a 1024x768 resolution as 16:9.
Crop area is only stretched horizontally SetSourceLocation() is not
taken into account.

Radeon driver does it correct.


-- 
Stefan Lucke


From joegi at scene.nl  Sat Mar  3 21:56:42 2007
From: joegi at scene.nl (Hugo Visser)
Date: Sat, 3 Mar 2007 21:56:42 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703032025.25227.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703031648.43356.stefan@lucke.in-berlin.de>
	<E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
	<200703032025.25227.stefan@lucke.in-berlin.de>
Message-ID: <B55BA6C7-C181-48E2-8DAF-8070F38D69E3@scene.nl>

>> So that would mean it's a bug in directfb or the framebuffer I'm
>> using?
>
> It's a bug (or missing feature) in the DirectFBs unichrome driver.
> With my epia I get the same when defining a 1024x768 resolution as  
> 16:9.
> Crop area is only stretched horizontally SetSourceLocation() is not
> taken into account.
>
> Radeon driver does it correct.

:( That's really too bad. So I guess I have to move this to the  
directfb list? Maybe you could explain the problem better to the devs?

Thanks a lot so far anyway!

Hugo


From stefan at lucke.in-berlin.de  Sat Mar  3 23:40:24 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 3 Mar 2007 23:40:24 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <B55BA6C7-C181-48E2-8DAF-8070F38D69E3@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703032025.25227.stefan@lucke.in-berlin.de>
	<B55BA6C7-C181-48E2-8DAF-8070F38D69E3@scene.nl>
Message-ID: <200703032340.24203.stefan@lucke.in-berlin.de>

On Saturday 03 March 2007 21:56, Hugo Visser wrote:
> >> So that would mean it's a bug in directfb or the framebuffer I'm
> >> using?
> >
> > It's a bug (or missing feature) in the DirectFBs unichrome driver.
> > With my epia I get the same when defining a 1024x768 resolution as  
> > 16:9.
> > Crop area is only stretched horizontally SetSourceLocation() is not
> > taken into account.
> >
> > Radeon driver does it correct.
> 
> :( That's really too bad. So I guess I have to move this to the  
> directfb list? Maybe you could explain the problem better to the devs?
> 

I already started a thread on directfb-dev list and Denis confirmed
that it's a missing feature of the driver.
So we'll see/have to wait what will happen in that direction.

But there's another issue:
I cannot confirm broadcasted 16:9 video with cropping set to 16:9 displayed wrong,
which was shown on your screen shots (dsc00245lt9.jpg). Please shown
me the syslog trace of that example.

Unfortunatly using the old softdevice code with "#define HAVE_SetSourceLocation 0"
does not work for me either as I get some exceptions there. Have to look at that.

-- 
Stefan Lucke


From leo at calidae.net  Sun Mar  4 01:03:01 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Sun, 04 Mar 2007 01:03:01 +0100
Subject: [Softdevice-devel] dfb:cle266 serious problems
In-Reply-To: <45EA07F3.4030006@calidae.net>
References: <45EA07F3.4030006@calidae.net>
Message-ID: <45EA0CB5.3020005@calidae.net>

More info when vdr starts....

[dfb] (re)configuring Videolayer to 736 x 576 (736x576)
[dfb] SetParams: Enabling DLOP_FIELD_PARITY
[surface capabilities] videoSurface: videoonly flipping triple-buffered 
PixelFormat = 0x08100609
[dfb] (re)configured 0x08100609
allocating buffer format orig->format 0
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] SetParams: Enabling DLOP_FIELD_PARITY
[surface capabilities] videoSurface: videoonly flipping triple-buffered 
PixelFormat = 0x08100609
[dfb] (re)configured 0x08100609
01:02:08.0035 D [4629] [softdevice-audio]: Xrun (at least 10,294 ms long)
allocating buffer format orig->format 0
01:02:08.0493 D [4632] [softdevice-audio]: Xrun (at least 336,756 ms long)
++01:02:09.0743 D [4632] [softdevice-audio]: Xrun (at least 0,074 ms long)
01:02:09.0947 D [4632] [softdevice-audio]: Xrun (at least 11,747 ms long)

I hope this information helps to find the problem.

Thanks

Leo M?rquez escribi?:

> Hi,
>
> I'm running vdr (1.4.3) with softdevice (cvs) direcfb 1.0, 
> libcle266mpegdec-0.5.
>
> I see osd and live tv but with a lot of interruptions and cpu is at 
> 90-100%
> This say me that cle266 is not working properly. In vdr console I see 
> all time:
>
> ++00:33:57.0581 D [4354] [softdevice-audio]: Xrun (at least 199,779 ms 
> long)
> +00:33:57.0693 D [4354] [softdevice-audio]: Xrun (at least 39,813 ms 
> long)
> 00:33:57.0805 D [4354] [softdevice-audio]: Xrun (at least 63,813 ms long)
> +00:33:57.0917 D [4354] [softdevice-audio]: Xrun (at least 87,791 ms 
> long)
> +00:33:58.0118 D [4354] [softdevice-audio]: Xrun (at least 152,208 ms 
> long)
> ++allocating buffer format orig->format 0
> CLE266 warning: frame had errors, resetting decoder
> 00:33:58.0918 D [4357] [softdevice-audio]: Xrun (at least 487,504 ms 
> long)
> +++++++00:34:01.0126 D [4357] [softdevice-audio]: Xrun (at least 
> 95,792 ms long)
> ++00:34:01.0398 D [4357] [softdevice-audio]: Xrun (at least 7,821 ms 
> long)
> 00:34:01.0510 D [4357] [softdevice-audio]: Xrun (at least 63,865 ms long)
>
> I don't have set the remote yet but I don't think that it can be the 
> problem.
> Do you know what can be the problem?
>
> Thanks!
>



From leo at calidae.net  Sun Mar  4 00:42:43 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Sun, 04 Mar 2007 00:42:43 +0100
Subject: [Softdevice-devel] dfb:cle266 serious problems
Message-ID: <45EA07F3.4030006@calidae.net>

Hi,

I'm running vdr (1.4.3) with softdevice (cvs) direcfb 1.0, 
libcle266mpegdec-0.5.

I see osd and live tv but with a lot of interruptions and cpu is at 90-100%
This say me that cle266 is not working properly. In vdr console I see 
all time:

++00:33:57.0581 D [4354] [softdevice-audio]: Xrun (at least 199,779 ms long)
+00:33:57.0693 D [4354] [softdevice-audio]: Xrun (at least 39,813 ms long)
00:33:57.0805 D [4354] [softdevice-audio]: Xrun (at least 63,813 ms long)
+00:33:57.0917 D [4354] [softdevice-audio]: Xrun (at least 87,791 ms long)
+00:33:58.0118 D [4354] [softdevice-audio]: Xrun (at least 152,208 ms long)
++allocating buffer format orig->format 0
CLE266 warning: frame had errors, resetting decoder
00:33:58.0918 D [4357] [softdevice-audio]: Xrun (at least 487,504 ms long)
+++++++00:34:01.0126 D [4357] [softdevice-audio]: Xrun (at least 95,792 
ms long)
++00:34:01.0398 D [4357] [softdevice-audio]: Xrun (at least 7,821 ms long)
00:34:01.0510 D [4357] [softdevice-audio]: Xrun (at least 63,865 ms long)

I don't have set the remote yet but I don't think that it can be the 
problem.
Do you know what can be the problem?

Thanks!


From ragawu at gmail.com  Sun Mar  4 04:08:43 2007
From: ragawu at gmail.com (Alasdair Campbell)
Date: Sun, 4 Mar 2007 03:08:43 +0000
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703032025.25227.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703031648.43356.stefan@lucke.in-berlin.de>
	<E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
	<200703032025.25227.stefan@lucke.in-berlin.de>
Message-ID: <1849e5180703031908v76aad4efndf37244b6249cb5b@mail.gmail.com>

On 03/03/07, Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> It's a bug (or missing feature) in the DirectFBs unichrome driver.
> With my epia I get the same when defining a 1024x768 resolution as 16:9.
> Crop area is only stretched horizontally SetSourceLocation() is not
> taken into account.
>
> Radeon driver does it correct.
>

Any idea how the Nvidia driver copes on this issue?

>
> --
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>


-- 
A l a s d a i r   C a m p b e l l

r a g a w u @ g m a i l . c o m


From stefan at lucke.in-berlin.de  Sun Mar  4 11:42:52 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 4 Mar 2007 11:42:52 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <1849e5180703031908v76aad4efndf37244b6249cb5b@mail.gmail.com>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703032025.25227.stefan@lucke.in-berlin.de>
	<1849e5180703031908v76aad4efndf37244b6249cb5b@mail.gmail.com>
Message-ID: <200703041142.52544.stefan@lucke.in-berlin.de>

On Sunday 04 March 2007 04:08, Alasdair Campbell wrote:
> On 03/03/07, Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> > It's a bug (or missing feature) in the DirectFBs unichrome driver.
> > With my epia I get the same when defining a 1024x768 resolution as 16:9.
> > Crop area is only stretched horizontally SetSourceLocation() is not
> > taken into account.
> >
> > Radeon driver does it correct.
> >
> 
> Any idea how the Nvidia driver copes on this issue?

No idea, as I've never tested such a card.

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Mar  4 11:42:48 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 4 Mar 2007 11:42:48 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703032340.24203.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<B55BA6C7-C181-48E2-8DAF-8070F38D69E3@scene.nl>
	<200703032340.24203.stefan@lucke.in-berlin.de>
Message-ID: <200703041142.48748.stefan@lucke.in-berlin.de>

On Saturday 03 March 2007 23:40, Stefan Lucke wrote:
> On Saturday 03 March 2007 21:56, Hugo Visser wrote:
> > >> So that would mean it's a bug in directfb or the framebuffer I'm
> > >> using?
> > >
> > > It's a bug (or missing feature) in the DirectFBs unichrome driver.
> > > With my epia I get the same when defining a 1024x768 resolution as  
> > > 16:9.
> > > Crop area is only stretched horizontally SetSourceLocation() is not
> > > taken into account.
> > >
> > > Radeon driver does it correct.
> > 
> > :( That's really too bad. So I guess I have to move this to the  
> > directfb list? Maybe you could explain the problem better to the devs?
> > 
> 
> I already started a thread on directfb-dev list and Denis confirmed
> that it's a missing feature of the driver.
> So we'll see/have to wait what will happen in that direction.
> 
> But there's another issue:
> I cannot confirm broadcasted 16:9 video with cropping set to 16:9 displayed wrong,
> which was shown on your screen shots (dsc00245lt9.jpg). Please shown
> me the syslog trace of that example.
> 
> Unfortunatly using the old softdevice code with "#define HAVE_SetSourceLocation 0"
> does not work for me either as I get some exceptions there. Have to look at that.

The error with that was on my side, as I had pixelformat set to YUY2. 
With  Pixelformat set I420 it works as cropped to 16:9, video filles
entire screen :-)) .

So if you run configure, edit config.h so that HAVE_SetSourceLocation
is defined as 0. The bad thing is, hw decoder support has to be disabled.

I'll make SetSourceLocation as a runtime selectable option in a few days.

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Mar  4 18:51:45 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 4 Mar 2007 18:51:45 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703041142.48748.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703032340.24203.stefan@lucke.in-berlin.de>
	<200703041142.48748.stefan@lucke.in-berlin.de>
Message-ID: <200703041851.46065.stefan@lucke.in-berlin.de>

On Sunday 04 March 2007 11:42, Stefan Lucke wrote:
> On Saturday 03 March 2007 23:40, Stefan Lucke wrote:
> > On Saturday 03 March 2007 21:56, Hugo Visser wrote:
> > > >> So that would mean it's a bug in directfb or the framebuffer I'm
> > > >> using?
> > > >
> > > > It's a bug (or missing feature) in the DirectFBs unichrome driver.
> > > > With my epia I get the same when defining a 1024x768 resolution as  
> > > > 16:9.
> > > > Crop area is only stretched horizontally SetSourceLocation() is not
> > > > taken into account.
> > > >
> > > > Radeon driver does it correct.
> > > 
> > > :( That's really too bad. So I guess I have to move this to the  
> > > directfb list? Maybe you could explain the problem better to the devs?
> > > 
> > 
> > I already started a thread on directfb-dev list and Denis confirmed
> > that it's a missing feature of the driver.
> > So we'll see/have to wait what will happen in that direction.
> > 
> > But there's another issue:
> > I cannot confirm broadcasted 16:9 video with cropping set to 16:9 displayed wrong,
> > which was shown on your screen shots (dsc00245lt9.jpg). Please shown
> > me the syslog trace of that example.
> > 
> > Unfortunatly using the old softdevice code with "#define HAVE_SetSourceLocation 0"
> > does not work for me either as I get some exceptions there. Have to look at that.
> 
> The error with that was on my side, as I had pixelformat set to YUY2. 
> With  Pixelformat set I420 it works as cropped to 16:9, video filles
> entire screen :-)) .
> 
> So if you run configure, edit config.h so that HAVE_SetSourceLocation
> is defined as 0. The bad thing is, hw decoder support has to be disabled.
> 
> I'll make SetSourceLocation as a runtime selectable option in a few days.

A fews days are over and SetSourceRectangle (the real name of DirectFB's
function) is now runtime selectable.

But for some reason Blit() of the unichrome driver seems to be broken
when not beeing called with the entire area. So the result with HW assisted
decoding is broken when SetSourceRectangle is disabled, and the scaling
is wrong when it is enabled :-( .

-- 
Stefan Lucke


From joegi at scene.nl  Sun Mar  4 22:10:58 2007
From: joegi at scene.nl (Hugo Visser)
Date: Sun, 4 Mar 2007 22:10:58 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <200703041851.46065.stefan@lucke.in-berlin.de>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703032340.24203.stefan@lucke.in-berlin.de>
	<200703041142.48748.stefan@lucke.in-berlin.de>
	<200703041851.46065.stefan@lucke.in-berlin.de>
Message-ID: <F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>


On Mar 4, 2007, at 6:51 PM, Stefan Lucke wrote:

>
> A fews days are over and SetSourceRectangle (the real name of  
> DirectFB's
> function) is now runtime selectable.
>
> But for some reason Blit() of the unichrome driver seems to be broken
> when not beeing called with the entire area. So the result with HW  
> assisted
> decoding is broken when SetSourceRectangle is disabled, and the  
> scaling
> is wrong when it is enabled :-( .


Thanks Stefan, that was really fast :) Unfortunately HW decoding is  
almost a must have to run decent decoding on epia's. I'll test some  
more next week and then I'll also will produce the log you asked for  
earlier.

Hugo


From nicolas at huillard.net  Sun Mar  4 23:34:35 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 04 Mar 2007 23:34:35 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<200703022301.17955.stefan@lucke.in-berlin.de>	<4925233E-DDD3-4B8F-9D35-D76403607BFD@scene.nl>	<200703031648.43356.stefan@lucke.in-berlin.de>
	<E1E81F82-2707-49D0-A187-C96E03F5C496@scene.nl>
Message-ID: <45EB497B.7040908@huillard.net>

Hugo Visser a ?crit :
> So that would mean it's a bug in directfb or the framebuffer I'm  
> using? Or maybe something different? Maybe Nicolas can confirm that  
> he's also using an epia or unichrome chipset...

I can confirm.
Yet another EPIA M10k/CLE266/Unichrome driver...

-- 
NH


From nicolas at huillard.net  Sun Mar  4 23:38:35 2007
From: nicolas at huillard.net (Nicolas Huillard)
Date: Sun, 04 Mar 2007 23:38:35 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<200703032340.24203.stefan@lucke.in-berlin.de>	<200703041142.48748.stefan@lucke.in-berlin.de>	<200703041851.46065.stefan@lucke.in-berlin.de>
	<F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>
Message-ID: <45EB4A6B.50204@huillard.net>

Hugo Visser a ?crit :
> Thanks Stefan, that was really fast :) Unfortunately HW decoding is  
> almost a must have to run decent decoding on epia's. I'll test some  
> more next week and then I'll also will produce the log you asked for  
> earlier.

Thanks Stefan for the fix!!!

On my side, I feel hardware decoding does not really improve image
quality of smoothness (I still have the field parity issue with hardware
decoding though). It just hurts my mind when I know I have an efficient
piece of hardware that I do not use.

I output in 720x576. Maybe that is the difference between "no visible
problem" and "a must have" ?

-- 
NH


From joegi at scene.nl  Mon Mar  5 08:57:22 2007
From: joegi at scene.nl (Hugo Visser)
Date: Mon, 5 Mar 2007 08:57:22 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <45EB4A6B.50204@huillard.net>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>	<200703032340.24203.stefan@lucke.in-berlin.de>	<200703041142.48748.stefan@lucke.in-berlin.de>	<200703041851.46065.stefan@lucke.in-berlin.de>
	<F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>
	<45EB4A6B.50204@huillard.net>
Message-ID: <9C023F5C-BABA-4EB5-BD5D-977207DC89D7@scene.nl>


On Mar 4, 2007, at 11:38 PM, Nicolas Huillard wrote:

>
> Thanks Stefan for the fix!!!
>
> On my side, I feel hardware decoding does not really improve image
> quality of smoothness (I still have the field parity issue with  
> hardware
> decoding though). It just hurts my mind when I know I have an  
> efficient
> piece of hardware that I do not use.
>
> I output in 720x576. Maybe that is the difference between "no visible
> problem" and "a must have" ?

I'm just testing vdr, but I'm coming from a mythtv / xorg setup. TV  
and recordings where OK (but high cpu) on myth without hardware  
decoding, but when watching dvd's frames are dropped. Maybe without  
the overhead of xorg vdr will cope with that without any hardware  
decoding :) So for mythtv / dvd's under xorg I consider hw decoding a  
must have, for vdr I don't know yet :) But I do think that switching  
to a slower fanless epia is out of the question now...

Hugo


From stefan at lucke.in-berlin.de  Tue Mar  6 23:57:59 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 6 Mar 2007 23:57:59 +0100
Subject: [Softdevice-devel] Zoom to 16:9
In-Reply-To: <F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>
References: <F34E2618-0FA3-406F-AFC3-EFEC86B178BC@scene.nl>
	<200703041851.46065.stefan@lucke.in-berlin.de>
	<F3C8381F-6AFE-41D6-9D8E-338B6FE5EF3B@scene.nl>
Message-ID: <200703062357.59400.stefan@lucke.in-berlin.de>

On Sunday 04 March 2007 22:10, Hugo Visser wrote:
> 
> On Mar 4, 2007, at 6:51 PM, Stefan Lucke wrote:
> 
> >
> > A fews days are over and SetSourceRectangle (the real name of  
> > DirectFB's
> > function) is now runtime selectable.
> >
> > But for some reason Blit() of the unichrome driver seems to be broken
> > when not beeing called with the entire area. So the result with HW  
> > assisted
> > decoding is broken when SetSourceRectangle is disabled, and the  
> > scaling
> > is wrong when it is enabled :-( .
> 
> 
> Thanks Stefan, that was really fast :) Unfortunately HW decoding is  
> almost a must have to run decent decoding on epia's. 

50 to 60 % cpu load with sw decodeing vs.
30 - 40 % is not that much difference I guess.

But here is my suggestion to fix the DirectFB unichrome blit bug.

-- 
Stefan Lucke
-------------- next part --------------
Index: uc_accel.c
===================================================================
RCS file: /cvs/directfb/DirectFB/gfxdrivers/unichrome/uc_accel.c,v
retrieving revision 1.6
diff -U 3 -r1.6 uc_accel.c
--- uc_accel.c	2 Jan 2007 17:46:19 -0000	1.6
+++ uc_accel.c	6 Mar 2007 22:42:09 -0000
@@ -258,8 +258,8 @@
 {
     UC_ACCEL_BEGIN()
 
-    int uv_dst_offset = ucdev->dst_offset + (ucdev->dst_pitch * rect->h);
-    int uv_src_offset = ucdev->src_offset + (ucdev->src_pitch * rect->h);
+    int uv_dst_offset = ucdev->dst_offset + (ucdev->dst_pitch * ucdev->dst_height);
+    int uv_src_offset = ucdev->src_offset + (ucdev->src_pitch * ucdev->src_height);
     
     int uv_dst_pitch = ucdev->dst_pitch / 2;
     int uv_src_pitch = ucdev->src_pitch / 2;
@@ -292,8 +292,8 @@
     
     // now for the second chrominance plane
     
-    uv_src_offset += uv_src_pitch * rect2.h;
-    uv_dst_offset += uv_dst_pitch * rect2.h;
+    uv_src_offset += uv_src_pitch * ucdev->src_height/2;
+    uv_dst_offset += uv_dst_pitch * ucdev->dst_height/2;
     
     UC_FIFO_PREPARE ( fifo, 6 );
     UC_FIFO_ADD_HDR( fifo, HC_ParaType_NotTex << 16 );
Index: uc_hwset.c
===================================================================
RCS file: /cvs/directfb/DirectFB/gfxdrivers/unichrome/uc_hwset.c,v
retrieving revision 1.6
diff -U 3 -r1.6 uc_hwset.c
--- uc_hwset.c	2 Jan 2007 17:45:58 -0000	1.6
+++ uc_hwset.c	6 Mar 2007 22:42:09 -0000
@@ -161,6 +161,7 @@
      int                    dst_bpp     = DFB_BYTES_PER_PIXEL( dst_format );
 
 
+     ucdev->dst_height = destination->height;
      /* Save FIFO space and CPU cycles. */
      if (ucdev->dst_format == dst_format &&
          ucdev->dst_offset == dst_offset &&
@@ -223,6 +224,7 @@
      
      ucdev->src_offset = buffer->video.offset;
      ucdev->src_pitch = buffer->video.pitch;
+     ucdev->src_height = state->source->height;
 
      UC_VALIDATE( uc_source2d );
 }
@@ -244,7 +246,7 @@
      if (UC_IS_VALID( uc_source3d ))
           return;
 
-     src_height = source->height;
+     ucdev->src_height = src_height = source->height;
      src_offset = buffer->video.offset;
      src_pitch  = buffer->video.pitch;
 
Index: unichrome.h
===================================================================
RCS file: /cvs/directfb/DirectFB/gfxdrivers/unichrome/unichrome.h,v
retrieving revision 1.6
diff -U 3 -r1.6 unichrome.h
--- unichrome.h	1 Feb 2007 18:42:44 -0000	1.6
+++ unichrome.h	6 Mar 2007 22:42:10 -0000
@@ -108,8 +108,10 @@
      DFBSurfacePixelFormat   dst_format; // destination pixel format
      int                     dst_offset; // destination buffer byte offset
      int                     dst_pitch;  // destination buffer byte pitch
+     int                     dst_height;
      int                     src_offset; // source buffer byte offset
      int                     src_pitch;  // source buffer byte pitch
+     int                     src_height;
 
      int                     field;      // source field
 

From admin at berlios.de  Wed Mar  7 20:34:56 2007
From: admin at berlios.de (admin at berlios.de)
Date: Wed, 7 Mar 2007 20:34:56 +0100 (CET)
Subject: [Softdevice-devel] [Bug #10575] softplay + vdr-1.5.0
Message-ID: <200703071934.l27JYuth009201@unicorn.berlios.de>

Bug #10575, was updated on 2007-Mar-07 20:34
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: pimboli
Assigned to : none
Summary: softplay + vdr-1.5.0

Details: Hi,

I was unable to compile softplay with vdr-1.5.0.

Plugin softplay:
make[1]: Entering directory `/usr/src/vdr-1.5.0/PLUGINS/src/softplay'
g++ -g -O2 -Wall -Woverloaded-virtual -L/usr/local/include/ffmpeg/ -L/usr/local/include/ffmpeg//libavformat -L/usr/local/include/ffmpeg//libavcodec -L/usr/local/include/ffmpeg//libavutil  -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ -I/usr/local/include/ffmpeg//libavformat -I/usr/local/include/ffmpeg//libavcodec -I/usr/local/include/ffmpeg//libavutil  SoftPlayer.c
SoftPlayer.c: In member function 'virtual void cSoftPlayer::Action()':
SoftPlayer.c:333: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
SoftPlayer.c: In member function 'void cSoftPlayer::ChannelUpDown(int)':
SoftPlayer.c:519: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
SoftPlayer.c:525: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
make[1]: *** [SoftPlayer.o] Error 1
make[1]: Leaving directory `/usr/src/vdr-1.5.0/PLUGINS/src/softplay'

Can anybody give me a hint how I can solve this error?

regards

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=10575&group_id=2051


From leo at calidae.net  Mon Mar 12 19:10:43 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Mon, 12 Mar 2007 19:10:43 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder
Message-ID: <45F597A3.2080002@calidae.net>

Hi,

I'm experimenting a lot of problems to run vdr, softdevice with 
dfb:cle266:viatv
The output is poor, I don't see live video, only a single frames each 2 
seconds. It's very strange.
In vdr console I see all time an X character. Keyboard don't work and if 
I try to set the softdevice keys with the keyboard it ask always for the 
up and down keys ??

vdr console output:

19:02:01.0567 D [10555] [dfb] (re)configuring Videolayer to 736 x 576 
(736x576)
19:02:01.0567 D [10555] [dfb] SetParams: Enabling DLOP_FIELD_PARITY
19:02:01.0598 D [10555] [dfb] surface capabilities for (videoSurface): 
videoonly, flipping, triple-buffered, PixelFormat = 0x08100609
19:02:01.0598 D [10555] [dfb] (re)configured 0x08100609
19:02:21.0096 D [10563] [VideoOut] reset: sync info: repF = 0, drpF = 0, 
totF = 0
allocating buffer format orig->format 0
19:02:21.0392 D [10566] [dfb] (re)configuring Videolayer to 720 x 576 
(720x576)
19:02:21.0393 D [10566] [dfb] SetParams: Enabling DLOP_FIELD_PARITY
19:02:21.0559 D [10566] [dfb] surface capabilities for (videoSurface): 
videoonly, flipping, triple-buffered, PixelFormat = 0x08100609
19:02:21.0559 D [10566] [dfb] (re)configured 0x08100609
19:02:23.0145 D [10566] [VideoOut] video now synced (10 - 0)
19:02:23.0596 D [10568] [VideoOut] reset: sync info: repF = 0, drpF = 0, 
totF = 10
allocating buffer format orig->format 0
CLE266 warning: frame had errors, resetting decoder
XXXXXXXXX19:02:28.0308 D [10571] [VideoOut] reset: sync info: repF = 0, 
drpF = 9, totF = 20
allocating buffer format orig->format 0
CLE266 warning: frame had errors, resetting decoder
XXXXXXXXXXXXXXXXXXXXXX19:02:33.0266 D [10574] [VideoOut] reset: sync 
info: repF = 0, drpF = 22, totF = 50
allocating buffer format orig->format 0
CLE266 warning: frame had errors, resetting decoder
XXXXXXXXXXXXXXXXXXXX19:02:38.0202 D [10577] [VideoOut] reset: sync info: 
repF = 0, drpF = 20, totF = 45
allocating buffer format orig->format 0
XXXXXXXXXXXXXXXXXXX19:02:42.0532 D [10580] [VideoOut] reset: sync info: 
repF = 0, drpF = 19, totF = 43
allocating buffer format orig->format 0
XXXXXXXXXXXXXXXXXXXXXXXXXX19:02:48.0268 D [10583] [VideoOut] reset: sync 
info: repF = 0, drpF = 26, totF = 61
allocating buffer format orig->format 0
CLE266 warning: frame had errors, resetting decoder
XXXXXXXXXXXXXXXXXXXX19:02:52.0997 D [10586] [VideoOut] reset: sync info: 
repF = 0, drpF = 20, totF = 48
allocating buffer format orig->format 0
XXXXXXXX19:02:55.0183 D [10548] Releasing DFB

DFBINFO

dori:~# dfbinfo

     =======================|  DirectFB 1.0.0  |=======================
          (c) 2001-2007  The DirectFB Organization (directfb.org)
          (c) 2000-2004  Convergence (integrated media) GmbH
        ------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-03-04 00:19)
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 10612)...
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 10613)...
(*) DirectFB/Input: AT Translated Set 2 keyboard (1) 0.1 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 10614)...
(*) DirectFB/Input: Logitech USB Receiver (2) 0.1 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 10615)...
(*) DirectFB/Input: PC Speaker (3) 0.1 (directfb.org)
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.3 (directfb.org)


Screen (00) FBDev Primary Screen            (primary screen)
   Caps: VSYNC POWER_MANAGEMENT

     Layer (00) VIA CLE266 Graphics             (primary layer)
        Type:    GRAPHICS
        Caps:    SURFACE OPACITY ALPHACHANNEL SRC_COLORKEY BRIGHTNESS 
CONTRAST SATURATION

     Layer (01) VIA Unichrome Video
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY SCREEN_LOCATION DEINTERLACING 
DST_COLORKEY LEVELS FIELD_PARITY SCREEN_POSITION SCREEN_SIZE

     Layer (02) VIA Unichrome DVD Subpicture
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY


Input (01) IMPS/2 Mouse                    (primary mouse)
   Type: MOUSE
   Caps: AXES BUTTONS
   Max. Axis: 2
   Max. Button: 2

Input (00) AT Translated Set 2 keyboard    (primary keyboard)
   Type: KEYBOARD
   Caps: KEYS

Input (10) Logitech USB Receiver
   Type: MOUSE
   Caps: AXES BUTTONS
   Max. Axis: 2
   Max. Button: 4

Do you think it can be a hardware problem? I have an epia m10k.
If you need more info tell me and I give you.
Any help would be apreciated.

A lot of thanks
Leo


From admin at berlios.de  Mon Mar 12 22:35:20 2007
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 12 Mar 2007 22:35:20 +0100 (CET)
Subject: [Softdevice-devel] [Bug #10575] softplay + vdr-1.5.0
Message-ID: <200703122135.l2CLZKCe029191@unicorn.berlios.de>

Bug #10575, was updated on 2007-Mar-07 20:34
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Closed
Resolution: None
Bug Group: None
Priority: 5
Submitted by: pimboli
Assigned to : none
Summary: softplay + vdr-1.5.0

Details: Hi,

I was unable to compile softplay with vdr-1.5.0.

Plugin softplay:
make[1]: Entering directory `/usr/src/vdr-1.5.0/PLUGINS/src/softplay'
g++ -g -O2 -Wall -Woverloaded-virtual -L/usr/local/include/ffmpeg/ -L/usr/local/include/ffmpeg//libavformat -L/usr/local/include/ffmpeg//libavcodec -L/usr/local/include/ffmpeg//libavutil  -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ -I/usr/local/include/ffmpeg//libavformat -I/usr/local/include/ffmpeg//libavcodec -I/usr/local/include/ffmpeg//libavutil  SoftPlayer.c
SoftPlayer.c: In member function 'virtual void cSoftPlayer::Action()':
SoftPlayer.c:333: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
SoftPlayer.c: In member function 'void cSoftPlayer::ChannelUpDown(int)':
SoftPlayer.c:519: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
SoftPlayer.c:525: error: no matching function for call to 'cDevice::GetDevice(const cChannel*&, int)'
../../../include/vdr/device.h:127: note: candidates are: static cDevice* cDevice::GetDevice(int)
../../../include/vdr/device.h:131: note:                 static cDevice* cDevice::GetDevice(const cChannel*, int, bool)
make[1]: *** [SoftPlayer.o] Error 1
make[1]: Leaving directory `/usr/src/vdr-1.5.0/PLUGINS/src/softplay'

Can anybody give me a hint how I can solve this error?

regards

Follow-Ups:

Date: 2007-Mar-12 22:35
By: wachm

Comment:
Should now be fixed in the CVS. 
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=10575&group_id=2051


From M.Wache at gmx.net  Mon Mar 12 22:48:22 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 12 Mar 2007 22:48:22 +0100
Subject: [Softdevice-devel] XReparentWindow() needed?
Message-ID: <45F5CAA6.8040909@gmx.net>

Hi all,

I have experienced some problems when trying to go from fullscreen to
windowed mode with Xfce 4.3.99. The softdevice returns to windowed mode,
but the size is still almost as large as the screen, and when pressing
"f" again, nothing happens.

After experimenting a bit I found that everything works well, when I
comment the call to XReparentWindow(). So now I wonder what for, or if
at all, this call is needed? MPlayer doesn't have a this call, so I
would remove it unless it breaks things for other window managers...

Attached is a patch for those who want to try it :-)

Bye,

Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: fullscreen.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070312/c28213c2/attachment.ksh>

From torgeir at pobox.com  Tue Mar 13 00:39:53 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 12 Mar 2007 23:39:53 +0000
Subject: [Softdevice-devel] XReparentWindow() needed?
In-Reply-To: <45F5CAA6.8040909@gmx.net>
References: <45F5CAA6.8040909@gmx.net>
Message-ID: <34F9B670-A3C2-49DE-A091-0BDF2C462782@pobox.com>


On 12 Mar 2007, at 21:48, Martin Wache wrote:

>
> I have experienced some problems when trying to go from fullscreen to
> windowed mode with Xfce 4.3.99. The softdevice returns to windowed  
> mode,
> but the size is still almost as large as the screen, and when pressing
> "f" again, nothing happens.
>
> After experimenting a bit I found that everything works well, when I
> comment the call to XReparentWindow(). So now I wonder what for, or if
> at all, this call is needed? MPlayer doesn't have a this call, so I
> would remove it unless it breaks things for other window managers...

I think it was left in as a fallback. Any EWMH compliant window  
manager should do without.

-- 
Torgeir Veimo
torgeir at pobox.com





From stefan at lucke.in-berlin.de  Tue Mar 13 09:24:48 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 13 Mar 2007 09:24:48 +0100
Subject: [Softdevice-devel] XReparentWindow() needed?
In-Reply-To: <45F5CAA6.8040909@gmx.net>
References: <45F5CAA6.8040909@gmx.net>
Message-ID: <1173774288.45f65fd00341e@webmail.in-berlin.de>

Quoting Martin Wache:

> Hi all,
>
> I have experienced some problems when trying to go from fullscreen to
> windowed mode with Xfce 4.3.99. The softdevice returns to windowed mode,
> but the size is still almost as large as the screen, and when pressing
> "f" again, nothing happens.
>
> After experimenting a bit I found that everything works well, when I
> comment the call to XReparentWindow(). So now I wonder what for, or if
> at all, this call is needed? MPlayer doesn't have a this call, so I
> would remove it unless it breaks things for other window managers...

Of course I would suggest/prefer another way :-) .

Can you try to
a. uncomment "//XMapRaised (dpy, win);" just below the reparent call, or
b. (preferred way) to handle ReparentNotify event like MapNotify in ProcessEvents():
       case ReparentNotify:
       case MapNotify:

Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Mar 13 09:33:32 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 13 Mar 2007 09:33:32 +0100
Subject: [Softdevice-devel] [Softdevice-cvs] softplay Makefile, 1.7,
	1.8 Receiver.c, 1.1, 1.2 SoftPlayer.c, 1.15, 1.16
In-Reply-To: <20070312213350.0CECDDAD00@mail.berlios.de>
References: <20070312213350.0CECDDAD00@mail.berlios.de>
Message-ID: <1173774812.45f661dc83d37@webmail.in-berlin.de>

Quoting wachm:

> Update of /cvsroot/softdevice/softplay

> ===================================================================
> RCS file: /cvsroot/softdevice/softplay/Makefile,v

> --- 21,25 ----
>
>   CXX      ?= g++
> ! CXXFLAGS ?= -g -O2 -Wall -Woverloaded-virtual

There should be option "-fPIC" too, as I need to add that to all plugins to get them
compiled with OpenSuse 10.2 x86_64 .

Stefan Lucke


From M.Wache at gmx.net  Tue Mar 13 23:12:08 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 13 Mar 2007 23:12:08 +0100
Subject: [Softdevice-devel] XReparentWindow() needed?
In-Reply-To: <1173774288.45f65fd00341e@webmail.in-berlin.de>
References: <45F5CAA6.8040909@gmx.net>
	<1173774288.45f65fd00341e@webmail.in-berlin.de>
Message-ID: <45F721B8.9000003@gmx.net>

Stefan Lucke schrieb:
> Quoting Martin Wache:
> 
>> Hi all,
>>
>> I have experienced some problems when trying to go from fullscreen to
>> windowed mode with Xfce 4.3.99. The softdevice returns to windowed mode,
>> but the size is still almost as large as the screen, and when pressing
>> "f" again, nothing happens.
>>
>> After experimenting a bit I found that everything works well, when I
>> comment the call to XReparentWindow(). So now I wonder what for, or if
>> at all, this call is needed? MPlayer doesn't have a this call, so I
>> would remove it unless it breaks things for other window managers...
> 
> Of course I would suggest/prefer another way :-) .
> 
> Can you try to
> a. uncomment "//XMapRaised (dpy, win);" just below the reparent call, or
> b. (preferred way) to handle ReparentNotify event like MapNotify in ProcessEvents():
>        case ReparentNotify:
>        case MapNotify:
> 

Thanks, Torgeir and Stefan for your input. Unfortunately I cannot have a
closer look at this now, I hope I will have some time maybe this weekend.

Bye,

Martin


From M.Wache at gmx.net  Tue Mar 13 23:14:11 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 13 Mar 2007 23:14:11 +0100
Subject: [Softdevice-devel] [Softdevice-cvs] softplay Makefile, 1.7,
 1.8 Receiver.c, 1.1, 1.2 SoftPlayer.c, 1.15, 1.16
In-Reply-To: <1173774812.45f661dc83d37@webmail.in-berlin.de>
References: <20070312213350.0CECDDAD00@mail.berlios.de>
	<1173774812.45f661dc83d37@webmail.in-berlin.de>
Message-ID: <45F72233.5000308@gmx.net>

Stefan Lucke schrieb:
> Quoting wachm:
> 
>> Update of /cvsroot/softdevice/softplay
> 
>> ===================================================================
>> RCS file: /cvsroot/softdevice/softplay/Makefile,v
> 
>> --- 21,25 ----
>>
>>   CXX      ?= g++
>> ! CXXFLAGS ?= -g -O2 -Wall -Woverloaded-virtual
> 
> There should be option "-fPIC" too, as I need to add that to all plugins to get them
> compiled with OpenSuse 10.2 x86_64 .
> 
Sorry I don't have much time now, so if you want to commit this change,
I'm fine with it.

Bye,
Martin


From stefan at lucke.in-berlin.de  Wed Mar 14 09:06:50 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 14 Mar 2007 09:06:50 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder
In-Reply-To: <45F597A3.2080002@calidae.net>
References: <45F597A3.2080002@calidae.net>
Message-ID: <1173859610.45f7ad1ac6f2e@webmail.in-berlin.de>

Quoting Leo M?rquez:

We are not ignoring your post, but since I've no concrete idea what
went wrong it's a bit hard to help.

> Hi,
>
> I'm experimenting a lot of problems to run vdr, softdevice with
> dfb:cle266:viatv
> The output is poor, I don't see live video, only a single frames each 2
> seconds. It's very strange.
> In vdr console I see all time an X character. Keyboard don't work and if
> I try to set the softdevice keys with the keyboard it ask always for the
> up and down keys ??
>
> vdr console output:
>
> 19:02:01.0567 D [10555] [dfb] (re)configuring Videolayer to 736 x 576
> (736x576)
> 19:02:01.0567 D [10555] [dfb] SetParams: Enabling DLOP_FIELD_PARITY
> 19:02:01.0598 D [10555] [dfb] surface capabilities for (videoSurface):
> videoonly, flipping, triple-buffered, PixelFormat = 0x08100609
> 19:02:01.0598 D [10555] [dfb] (re)configured 0x08100609
> 19:02:21.0096 D [10563] [VideoOut] reset: sync info: repF = 0, drpF = 0,
> totF = 0
> allocating buffer format orig->format 0
> 19:02:21.0392 D [10566] [dfb] (re)configuring Videolayer to 720 x 576
> (720x576)
> 19:02:21.0393 D [10566] [dfb] SetParams: Enabling DLOP_FIELD_PARITY
> 19:02:21.0559 D [10566] [dfb] surface capabilities for (videoSurface):
> videoonly, flipping, triple-buffered, PixelFormat = 0x08100609
> 19:02:21.0559 D [10566] [dfb] (re)configured 0x08100609
> 19:02:23.0145 D [10566] [VideoOut] video now synced (10 - 0)
> 19:02:23.0596 D [10568] [VideoOut] reset: sync info: repF = 0, drpF = 0,
> totF = 10
> allocating buffer format orig->format 0
> CLE266 warning: frame had errors, resetting decoder

May be caused by bad reception.
Can you check your signal quality ?

Are you using both (tv-out + vga-out) output connectors at the same time ?
With epia I use only vga-out. So I disable tv-out at module load time.

In one of your other logs, I saw the line:

[setup-softdevice] deinterlace method set to 1 lavc

I don't know if that setting has some influence, when using hw-decoder.
I guess it should be ignored in that case, but it is not :-( .
So disable postprocessing !

Stefan Lucke


From poiux at hotmail.com  Wed Mar 14 15:43:30 2007
From: poiux at hotmail.com (mike n)
Date: Wed, 14 Mar 2007 06:43:30 -0800
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
Message-ID: <BAY138-F11765EB55D9094DB98049AB4730@phx.gbl>

>Leo M?rquez wrote: Hi, I'm experimenting a lot of problems to run vdr, 
>softdevice with  dfb:cle266:viatv The output is poor, I don't see live 
>video, only a single frames each 2 seconds. It's very strange.

Hello Leo,

I have VIA M10000 and was experimenting the same problems. Fortunately I 
found a "solution", but I don't know what is causing the problem. Maybe you 
have the same scenario.

Hardware + Linux Kernel + basic software:
- VIA M10000 CLE266  (Nehemiah)
- Linux 2.6.18.1 kernel (Puppy linux distro)
- Twinhan USB2 Alpha DVB-T dongle (uses dvb-usb-vp7045 firmware file)
- VDR version 1.4.3-2 (patch level 2)
- Softdevice plugin in VDR  (CVS version)
- DirectFB + DFB  (CVS versions)
- FFMPEG (SVN version)
- linux-viafb framebuffer driver (CVS version)
- libclempegdec-0.5 (downloaded from sourceforge)

VDR is started using vdr -P"softdevice -vo dfb:cle266:viatv" option (and 
other plugins having nothing to do with this problem).

I had this combination working just fine somewhere in last November. Nice 
picture in CRT-Television using VIAFB tv output and processor load was about 
30%. Therefore hw accelerated mpeg must have been working. Softdevice, 
DirectFB/DFB, FFMPEG and linux-viafb were all CVS/SVN checkout versions from 
November.

Note! The version I had was still working with /ETC/DIRECTFBRC 
pixelformat=ARGB setting so directfb was that old.

In February I decided to upgrade every CVS/SVN version because based on 
changelogs there seemed to be lots of fixes and improvements.

Uuuh. Then problems started. After updating ffmpeg to latest SVN version and 
DirectFB/DFB/softdevice/linux-viafb to latest CVS versions in February, VDR 
and mpeg output stopped working. Lots of decoder had errors messages or 
sometimes the picture was completely black but curiously epg, audio and DVB 
subtitles worked.

I was smart enough to delete old sources before I updated everything so I 
could not verify whether the old sources would have still work :-)

Well, when I checked out old versions from everything from CVS/SVN (back to 
November version) things worked again. Then I started to update CVS/SVN 
versions one by one to see which one breaks the system. It turned out to be 
the latest FFMPEG version from SVN repository.

Now-a-days I finally have working system with following software versions:
- Softdevice plugin in VDR  (latest CVS version from 
cvs.softdevice.berlios.de)
- DirectFB + DFB  (latest CVS versions from DirectFB.org. This version uses 
pixelformat=AiRGB)
- linux-viafb framebuffer driver (latest CVS version from DirectFB.org)
- libclempegdec-0.5 (downloaded from sourceforge)
- FFMPEG (SVN using 2006-12-01 date from svn.mplayerhq.hu)

If I try to use the latest SVN version of FFMPEG, the picture breaks just 
like Leo described (errors or nothing but black picture) but the old 
2006-12-01 version works.

I used following command to checkout older revision of FFMPEG:
cd /usr/src/
svn checkout -r {20061201} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

This could be problem in FFMPEG itself so not really softdevice plugin 
problem. Or the latest FFMPEG would require a bit different softdevice 
plugin interface. I have no idea.

I hope this helps to track down the problem. Or whether me and Leo are the 
only ones having problems with the latest SVN FFMPEG version?

Best regards,
Mike

_________________________________________________________________
Get a FREE Web site, company branded e-mail and more from Microsoft Office 
Live! http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/



From leo at calidae.net  Wed Mar 14 16:07:55 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Wed, 14 Mar 2007 16:07:55 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <BAY138-F11765EB55D9094DB98049AB4730@phx.gbl>
References: <BAY138-F11765EB55D9094DB98049AB4730@phx.gbl>
Message-ID: <45F80FCB.5080709@calidae.net>

A lot of thanks Mike!!!!!
I'm at work and could not test it now but I'm happy because i was 
thinking that I was alone in the world with this problem.

I'll expose results here after test it.

Leo.

En/na mike n ha escrit:
>> Leo M?rquez wrote: Hi, I'm experimenting a lot of problems to run 
>> vdr, softdevice with  dfb:cle266:viatv The output is poor, I don't 
>> see live video, only a single frames each 2 seconds. It's very strange.
>
> Hello Leo,
>
> I have VIA M10000 and was experimenting the same problems. Fortunately 
> I found a "solution", but I don't know what is causing the problem. 
> Maybe you have the same scenario.
>
> Hardware + Linux Kernel + basic software:
> - VIA M10000 CLE266  (Nehemiah)
> - Linux 2.6.18.1 kernel (Puppy linux distro)
> - Twinhan USB2 Alpha DVB-T dongle (uses dvb-usb-vp7045 firmware file)
> - VDR version 1.4.3-2 (patch level 2)
> - Softdevice plugin in VDR  (CVS version)
> - DirectFB + DFB  (CVS versions)
> - FFMPEG (SVN version)
> - linux-viafb framebuffer driver (CVS version)
> - libclempegdec-0.5 (downloaded from sourceforge)
>
> VDR is started using vdr -P"softdevice -vo dfb:cle266:viatv" option 
> (and other plugins having nothing to do with this problem).
>
> I had this combination working just fine somewhere in last November. 
> Nice picture in CRT-Television using VIAFB tv output and processor 
> load was about 30%. Therefore hw accelerated mpeg must have been 
> working. Softdevice, DirectFB/DFB, FFMPEG and linux-viafb were all 
> CVS/SVN checkout versions from November.
>
> Note! The version I had was still working with /ETC/DIRECTFBRC 
> pixelformat=ARGB setting so directfb was that old.
>
> In February I decided to upgrade every CVS/SVN version because based 
> on changelogs there seemed to be lots of fixes and improvements.
>
> Uuuh. Then problems started. After updating ffmpeg to latest SVN 
> version and DirectFB/DFB/softdevice/linux-viafb to latest CVS versions 
> in February, VDR and mpeg output stopped working. Lots of decoder had 
> errors messages or sometimes the picture was completely black but 
> curiously epg, audio and DVB subtitles worked.
>
> I was smart enough to delete old sources before I updated everything 
> so I could not verify whether the old sources would have still work :-)
>
> Well, when I checked out old versions from everything from CVS/SVN 
> (back to November version) things worked again. Then I started to 
> update CVS/SVN versions one by one to see which one breaks the system. 
> It turned out to be the latest FFMPEG version from SVN repository.
>
> Now-a-days I finally have working system with following software 
> versions:
> - Softdevice plugin in VDR  (latest CVS version from 
> cvs.softdevice.berlios.de)
> - DirectFB + DFB  (latest CVS versions from DirectFB.org. This version 
> uses pixelformat=AiRGB)
> - linux-viafb framebuffer driver (latest CVS version from DirectFB.org)
> - libclempegdec-0.5 (downloaded from sourceforge)
> - FFMPEG (SVN using 2006-12-01 date from svn.mplayerhq.hu)
>
> If I try to use the latest SVN version of FFMPEG, the picture breaks 
> just like Leo described (errors or nothing but black picture) but the 
> old 2006-12-01 version works.
>
> I used following command to checkout older revision of FFMPEG:
> cd /usr/src/
> svn checkout -r {20061201} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
>
> This could be problem in FFMPEG itself so not really softdevice plugin 
> problem. Or the latest FFMPEG would require a bit different softdevice 
> plugin interface. I have no idea.
>
> I hope this helps to track down the problem. Or whether me and Leo are 
> the only ones having problems with the latest SVN FFMPEG version?
>
> Best regards,
> Mike
>
> _________________________________________________________________
> Get a FREE Web site, company branded e-mail and more from Microsoft 
> Office Live! http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>   


-- 
Leo M?rquez
[ Enginyeria del Software - Internet ]
[ Calidae - www.calidae.com ]



From poiux at hotmail.com  Wed Mar 14 19:16:57 2007
From: poiux at hotmail.com (mike n)
Date: Wed, 14 Mar 2007 10:16:57 -0800
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <45F80FCB.5080709@calidae.net>
Message-ID: <BAY138-F11E7E9811F6B8918E5B4F0B4730@phx.gbl>


Hello again,

I did further investigation about this "non-working latest SVN version of 
FFMPEG" issue with VIA-Cle266+VDR+softdevice+DirectFB.

Following FFMPEG version WORKS with latest CVS versions of 
DirectFB/DFB/linux-viafb/softdevice VDR plugin (everything updated today 
2007-03-14):
  svn checkout -r {20070207} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

However, the next day something has drastically changed in FFMPEG sources 
and following version or the latest DOESN'T WORK (black screen or lots of 
decoder reset error messages):
  svn checkout -r {20070208} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

Between these two versions I removed old /usr/lib/libav* and 
/usr/lib/libpostproc* files to make sure no previous binary version was 
hiding somewhere.  I also made "make clean" to VDR and softdevice plugin 
sources between these tests.

The next step was to re-configure, recompile and install FFMPEG.
cd /usr/src/ffmpeg/
./configure --prefix=/usr
make
make install

Finally I recompiled VDR and VDR plugins:
cd /usr/src/vdr/
make
make plugins

Well, at the moment this is not a major problem for me because FFMPEG 
20070207 version works and the picture is nice and smooth in CRT television. 
Thanks for the good work with Softdevice vdr plugin and VIA-CLE266 
accelerator support.

Best regards,
Mike N

PS. Don't know whether re-compiling of DirectFB/DFB/linux-viafb would have 
any change between 2007-02-07 and 2007-02-08 FFMPEG versions. However, 
yeasterday I had re-compiled everything with the latest CVS/SVN versions and 
it didn't work so probably DirectFB doesn't have to be re-compiled if new 
FFMPEG library is installed.

>From: Leo M?rquez <leo at calidae.net>
>A lot of thanks Mike!!!!!
>I'm at work and could not test it now but I'm happy because i was
>thinking that I was alone in the world with this problem.
>
>I'll expose results here after test it.
>
>Leo.
>

>En/na mike n ha escrit:
> >> Leo M?rquez wrote: Hi, I'm experimenting a lot of problems to run
> >> vdr, softdevice with  dfb:cle266:viatv The output is poor, I don't
> >> see live video, only a single frames each 2 seconds. It's very strange.
> >

> > Mike N wrote;
> > Hello Leo,
> >
> > I have VIA M10000 and was experimenting the same problems. Fortunately
> > I found a "solution", but I don't know what is causing the problem.
> > Maybe you have the same scenario.
>>---snip snip snip---- > >
> > I used following command to checkout older revision of FFMPEG:
> > cd /usr/src/
> > svn checkout -r {20061201} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

_________________________________________________________________
The average US Credit Score is 675. The cost to see yours: $0 by Experian. 
http://www.freecreditreport.com/pm/default.aspx?sc=660600&bcd=EMAILFOOTERAVERAGE



From stefan at lucke.in-berlin.de  Thu Mar 15 11:22:44 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 15 Mar 2007 11:22:44 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <BAY138-F11E7E9811F6B8918E5B4F0B4730@phx.gbl>
References: <BAY138-F11E7E9811F6B8918E5B4F0B4730@phx.gbl>
Message-ID: <1173954164.45f91e743b48d@webmail.in-berlin.de>

Quoting mike n:

>
> Hello again,
>
> I did further investigation about this "non-working latest SVN version of
> FFMPEG" issue with VIA-Cle266+VDR+softdevice+DirectFB.

Thanks for your detailed search on this issue.

>
> Following FFMPEG version WORKS with latest CVS versions of
> DirectFB/DFB/linux-viafb/softdevice VDR plugin (everything updated today
> 2007-03-14):
>   svn checkout -r {20070207} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

If svn checkout commands is the same as cvs, this should include all changes
up to 2006-02-06 23:59:59. If thats correct, this is ffmpeg revision 7865,

>
> However, the next day something has drastically changed in FFMPEG sources
> and following version or the latest DOESN'T WORK (black screen or lots of
> decoder reset error messages):
>   svn checkout -r {20070208} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg

and this should be revision 7881.


From stefan at lucke.in-berlin.de  Thu Mar 15 11:30:54 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 15 Mar 2007 11:30:54 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <1173954164.45f91e743b48d@webmail.in-berlin.de>
References: <BAY138-F11E7E9811F6B8918E5B4F0B4730@phx.gbl>
	<1173954164.45f91e743b48d@webmail.in-berlin.de>
Message-ID: <1173954654.45f9205e0cc4c@webmail.in-berlin.de>

Quoting Stefan Lucke:

>
> From svn commit comments I guess relevant changes are:
> rev 7877 : muxing packets with unknown timestamps is not allowed
> rev 7879 : iam pretty sure send time is dts and not pts ...

Crap, asf-enc.c (muxer) is not our problem.

Stefan


From poiux at hotmail.com  Thu Mar 15 18:18:09 2007
From: poiux at hotmail.com (mike n)
Date: Thu, 15 Mar 2007 09:18:09 -0800
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <1173954164.45f91e743b48d@webmail.in-berlin.de>
Message-ID: <BAY138-F2013F508A50BFEF4B586A7B4720@phx.gbl>

> > Following FFMPEG version WORKS with latest CVS versions of
> > DirectFB/DFB/linux-viafb/softdevice VDR plugin (everything updated today
> > 2007-03-14):
> >   svn checkout -r {20070207} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
>
>If svn checkout commands is the same as cvs, this should include all 
>changes
>up to 2006-02-06 23:59:59. If thats correct, this is ffmpeg revision 7865,
> >
> >   svn checkout -r {20070208} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
>and this should be revision 7881.

Yes. SVN checkout without time part assumes that timestamp part is 00:00:00, 
so the command would checkout "20070207 00:00:00" revision.

However, "svn log -r {20070207}:{20070208}" command lists revision numbers 
from 7851 to 7872 so the working rev would be 7851 and non-working rev 7872. 
But could be that I'm wrong because I don't usually play with SVN revisions, 
I just use the latest trunk version.

>Would you like to do some further checks?
>Does revision 7876 still work?
>If answer is yes which of above revision kicks us ?
>If answer is no, I've to guess some more.

No probs. I'm just glad if I can help somehow.

I went through and tested these revisions. It turn out that rev 7852 was the 
last one working and rev 7853 of ffmpeg broke the VDR output.

This was the cmd I used to checkout the last working ffmpeg source codes 
(FYI for those having the same problem):
  svn checkout -r 7852 svn://svn.mplayerhq.hu.ffmpeg/trunk ffmpeg

7853 revision modified ffmpeg/libavcodec/avcodec.h and 
ffmpeg/libavformat/mpeg.c files so there must be something nasty. Changelog 
talks about some patch for HD DVD demuxing. "svn diff -r 7852:7853" command 
shows just handful of modified lines.

avcodec.h change is just some new enum type, so it probably doesn't break 
anything.

mpeg.c file has dozen of changed/added code lines. Something to do with PES 
extensions and frame handling (what ever those are :-)

I didn't go through every revision after that 7853 revision so could be that 
"potential bug" in mpeg.c file is fixed there. But neverthless the latest 
ffmpeg revision doesn't work either so....

This could be some "only under certain cirmumstances bug" in ffmpeg which 
surfaces only when the library is used in a way softdevice uses it, so not 
really softdevice bug.

Best regards,
Mike N

_________________________________________________________________
Find what you need at prices you?ll love. Compare products and save at MSN? 
Shopping. 
http://shopping.msn.com/default/shp/?ptnrid=37,ptnrdata=24102&tcode=T001MSN20A0701



From stefan at lucke.in-berlin.de  Thu Mar 15 22:10:06 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 15 Mar 2007 22:10:06 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <BAY138-F2013F508A50BFEF4B586A7B4720@phx.gbl>
References: <BAY138-F2013F508A50BFEF4B586A7B4720@phx.gbl>
Message-ID: <1173993006.45f9b62ecb65e@webmail.in-berlin.de>

Quoting mike n:

> > > Following FFMPEG version WORKS with latest CVS versions of
> > > DirectFB/DFB/linux-viafb/softdevice VDR plugin (everything updated today
> > > 2007-03-14):
> > >   svn checkout -r {20070207} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
> >
> >If svn checkout commands is the same as cvs, this should include all
> >changes
> >up to 2006-02-06 23:59:59. If thats correct, this is ffmpeg revision 7865,
> > >
> > >   svn checkout -r {20070208} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg
> >and this should be revision 7881.
>
> Yes. SVN checkout without time part assumes that timestamp part is 00:00:00,
> so the command would checkout "20070207 00:00:00" revision.
>
> However, "svn log -r {20070207}:{20070208}" command lists revision numbers
> from 7851 to 7872 so the working rev would be 7851 and non-working rev 7872.
> But could be that I'm wrong because I don't usually play with SVN revisions,
> I just use the latest trunk version.

That's strange. I thought these timestamps are server based.
But you are (from mail header) in UTC - 0800 ! That's the reason for my
looking at wrong revisions.


> I went through and tested these revisions. It turn out that rev 7852 was the
> last one working and rev 7853 of ffmpeg broke the VDR output.
>
> This was the cmd I used to checkout the last working ffmpeg source codes
> (FYI for those having the same problem):
>   svn checkout -r 7852 svn://svn.mplayerhq.hu.ffmpeg/trunk ffmpeg
>
> 7853 revision modified ffmpeg/libavcodec/avcodec.h and

Header file modification is minor. But the other one not.
http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/mpeg.c?r1=7567&r2=7853&pathrev=7853

My guess is the part with checking PES extension (line 1535 - 1557).
Perhaps it's an issue with libcle266, which does it's own scanning or
something with audio/video repacker of vdr.

If you are still motivated enough, you could try to deactivate
audio/video repacker of vdr with non working revision 7853 of ffmpeg.

In vdr they could be deactivated in remux.c, around line 1868 (vdr-1.4.0).


Stefan Lucke


From poiux at hotmail.com  Sat Mar 17 22:19:50 2007
From: poiux at hotmail.com (mike n)
Date: Sat, 17 Mar 2007 14:19:50 -0700
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <1173993006.45f9b62ecb65e@webmail.in-berlin.de>
Message-ID: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>


Hello again,

Sorry for not being able to test this "VDR repacker" theory. I will do it as 
soon I find time (won't happen in few days). However, I took a quick look at 
the code and the theory does look promising.

I remember that I had tested this problem without CLE266 HW acceleration 
libraries (ie. pure software output) and it didn't work either. Could be 
wrong so I have to re-test the software only output, too. This way we could 
verify whether this is just a LIBCLE266mpegdec-0.5.so specific problem or 
wider problem.

Leo. Did you manage to get your system working or do you have some other 
problem?

Mike N


>Stefan wrote:
>
>Header file modification is minor. But the other one not.
>http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/mpeg.c?r1=7567&r2=7853&pathrev=7853
>
>My guess is the part with checking PES extension (line 1535 - 1557).
>Perhaps it's an issue with libcle266, which does it's own scanning or
>something with audio/video repacker of vdr.
>
>If you are still motivated enough, you could try to deactivate
>audio/video repacker of vdr with non working revision 7853 of ffmpeg.
>
>In vdr they could be deactivated in remux.c, around line 1868 (vdr-1.4.0).

_________________________________________________________________
Get a FREE Web site, company branded e-mail and more from Microsoft Office 
Live! http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/



From stefan at lucke.in-berlin.de  Sun Mar 18 01:26:42 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 18 Mar 2007 01:26:42 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
References: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
Message-ID: <200703180126.42686.stefan@lucke.in-berlin.de>

On Saturday 17 March 2007 22:19, mike n wrote:
> 
> Hello again,
> 
> Sorry for not being able to test this "VDR repacker" theory. I will do it as 
> soon I find time (won't happen in few days). However, I took a quick look at 
> the code and the theory does look promising.

My latest impression is that the repackers do not harm, they help us.
See discussion on vdr list "softdevice audio problem. audio repacker issue?"

Martin posted a patch for softdevice there, which solves one of my problems.
Perhaps you should try this first.
http://www.linuxtv.org/pipermail/vdr/2007-March/012476.html

Today (now yesterday) I did a search/probe through ffmpeg versions myself.
I know it's a hard thing even I did it on a amd X2 3800+ between
revisions 5933 and 6040 for finding an issue that kicks ffplay.
http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/mpeg.c?view=log&pathrev=6025

Didn't expect that from commit comment.
http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/mpeg.c?r1=5707&r2=6025&pathrev=6025

Thank you very much for your help.

-- 
Stefan Lucke


From leo at calidae.net  Mon Mar 19 12:04:48 2007
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Mon, 19 Mar 2007 12:04:48 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
References: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
Message-ID: <45FE6E50.3060005@calidae.net>

Hi,

En/na mike n ha escrit:
> Leo. Did you manage to get your system working or do you have some other 
> problem?
>   
I have tried to use olf ffmpeg cvs versions as you recommended but since 
I have tried it softdevice don't work for me. First I only recompiled 
ffmpeg. After no luck I have recompiled libcle266 too. But the new error:

vdr: /usr/local/lib/libavcodec.so.51: undefined symbol: av_init_random

I supose that I have to start from zero and reinstall all vdr box parts. 
ffmpeg libcle dfb softdevice vdr....I'm right? Is yes, the doubt I have 
is that version of ffmpeg I have to install.
The other parts I understad that can install last cvs.
I not dispose very time but i try to do more tests today.

Thanks!

Leo.
> Mike N
>
>
>   
>> Stefan wrote:
>>
>> Header file modification is minor. But the other one not.
>> http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/mpeg.c?r1=7567&r2=7853&pathrev=7853
>>
>> My guess is the part with checking PES extension (line 1535 - 1557).
>> Perhaps it's an issue with libcle266, which does it's own scanning or
>> something with audio/video repacker of vdr.
>>
>> If you are still motivated enough, you could try to deactivate
>> audio/video repacker of vdr with non working revision 7853 of ffmpeg.
>>
>> In vdr they could be deactivated in remux.c, around line 1868 (vdr-1.4.0).
>>     
>
> _________________________________________________________________
> Get a FREE Web site, company branded e-mail and more from Microsoft Office 
> Live! http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/
>
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>
>   





From poiux at hotmail.com  Mon Mar 19 20:35:35 2007
From: poiux at hotmail.com (mike n)
Date: Mon, 19 Mar 2007 12:35:35 -0700
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <45FE6E50.3060005@calidae.net>
Message-ID: <BAY138-F13ADB06623F4DB0ECA06E9B4760@phx.gbl>


Stop the press, Stop the press!  :-)

Leo. Don't start everything from scratch. You just probably still have the 
VDR softdevice plugin library using the latest (ie. different) version of 
ffmpeg runtime libraries. I assume you didn't re-compile VDR and VDR 
softdevice plugin?  (well, it is enough if you re-compile just the 
softdevice plugin again).

Clean old softdevice compilation files and re-compile VDR plugin. After this 
the softdevice plugin should use the new (older but still different in 
binary level) version of ffmpeg libraries (and remember to "make" AND "make 
install" ffmpeg libraries when you re-compile it):

  cd /usr/src/vdr/PLUGINS/src/softdevice
  make clean
  cd /usr/src/vdr
  make plugins

Stefan had some good ideas about this problem but unfortunately I have had 
time to test run those theories (too much work elsewhere :-( )

Best regards,
Mike N


>From: Leo M?rquez  >
>I have tried to use olf ffmpeg cvs versions as you recommended but since
>I have tried it softdevice don't work for me. First I only recompiled
>ffmpeg. After no luck I have recompiled libcle266 too. But the new error:
>
>vdr: /usr/local/lib/libavcodec.so.51: undefined symbol: av_init_random

_________________________________________________________________
Get a FREE Web site, company branded e-mail and more from Microsoft Office 
Live! http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/



From stefan at lucke.in-berlin.de  Mon Mar 19 22:21:07 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 19 Mar 2007 22:21:07 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <200703180126.42686.stefan@lucke.in-berlin.de>
References: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
	<200703180126.42686.stefan@lucke.in-berlin.de>
Message-ID: <200703192221.07656.stefan@lucke.in-berlin.de>

On Sunday 18 March 2007 01:26, Stefan Lucke wrote:
> On Saturday 17 March 2007 22:19, mike n wrote:
> > 
> > Hello again,
> > 
> > Sorry for not being able to test this "VDR repacker" theory. I will do it as 
> > soon I find time (won't happen in few days). However, I took a quick look at 
> > the code and the theory does look promising.
> 
> My latest impression is that the repackers do not harm, they help us.
> See discussion on vdr list "softdevice audio problem. audio repacker issue?"
> 
> Martin posted a patch for softdevice there, which solves one of my problems.
> Perhaps you should try this first.
> http://www.linuxtv.org/pipermail/vdr/2007-March/012476.html

You'd like to hear some good news ?
I've no troubles with today's ffmpeg cvs (rev. 8449) neither in
softdecoding nor in hw-decoding mode. I had to use above mentioned
patch from Martin to avoid audio troubles.
CPU load is 60% vs 30% on my epia 1G.

OT: I get a lot more deprecated warnings:
g++ -O2 -g -Wall -fPIC -Woverloaded-virtual   -c -DHAVE_CONFIG -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE -DPLUGINLIBDIR='"./PLUGINS/lib"' -DSHM_SUPPORT -I../../../include -I../../../../DVB/include -I/usr/local/include -I/usr/local/include/ffmpeg -I/usr/local/include/postproc   -D_REENTRANT -I/usr/local/include/directfb -I/usr/local/include/dfb++   -DHAVE_CLE266_MPEG_DECODER -I/usr/local/include   SoftOsd.c
In file included from PicBuffer.h:15,
                 from video.h:25,
                 from SoftOsd.h:31,
                 from SoftOsd.c:12:
/usr/local/include/ffmpeg/avcodec.h:2434: warning: `ImgReSampleContext' is
   deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2431)
/usr/local/include/ffmpeg/avcodec.h:2441: warning: `ImgReSampleContext' is
   deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2431)
/usr/local/include/ffmpeg/avcodec.h:2445: warning: `ImgReSampleContext' is
   deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2431)
/usr/local/include/ffmpeg/avcodec.h:2447: warning: `ImgReSampleContext' is
   deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2431)

These are future troubles.

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Mon Mar 19 22:30:13 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 19 Mar 2007 22:30:13 +0100
Subject: [Softdevice-devel] CLE266 warning reseting decoder]
In-Reply-To: <200703192221.07656.stefan@lucke.in-berlin.de>
References: <BAY138-F817F7685FD33E9C146DACB4700@phx.gbl>
	<200703180126.42686.stefan@lucke.in-berlin.de>
	<200703192221.07656.stefan@lucke.in-berlin.de>
Message-ID: <200703192230.13908.stefan@lucke.in-berlin.de>

On Monday 19 March 2007 22:21, Stefan Lucke wrote:
> On Sunday 18 March 2007 01:26, Stefan Lucke wrote:
> > On Saturday 17 March 2007 22:19, mike n wrote:
> > > 
> > > Hello again,
> > > 
> > > Sorry for not being able to test this "VDR repacker" theory. I will do it as 
> > > soon I find time (won't happen in few days). However, I took a quick look at 
> > > the code and the theory does look promising.
> > 
> > My latest impression is that the repackers do not harm, they help us.
> > See discussion on vdr list "softdevice audio problem. audio repacker issue?"
> > 
> > Martin posted a patch for softdevice there, which solves one of my problems.
> > Perhaps you should try this first.
> > http://www.linuxtv.org/pipermail/vdr/2007-March/012476.html
> 
> You'd like to hear some good news ?
> I've no troubles with today's ffmpeg cvs (rev. 8449) neither in
> softdecoding nor in hw-decoding mode. I had to use above mentioned
> patch from Martin to avoid audio troubles.
> CPU load is 60% vs 30% on my epia 1G.

Perhaps thats the difference, from ldd:
libcle266mpegdec-0.3.so => /usr/local/lib/libcle266mpegdec-0.3.so (0xb78f2000)

-- 
Stefan Lucke


From vdrgeorge at gmail.com  Tue Mar 20 16:16:55 2007
From: vdrgeorge at gmail.com (vdrgeorge)
Date: Tue, 20 Mar 2007 10:16:55 -0500
Subject: [Softdevice-devel] Softplay feature request - sort directory/files
	by date
Message-ID: <6bd97e940703200816t46da3ab6t496d6a01898f043e@mail.gmail.com>

I would like to request a feature to toggle the file/directory lists sorting
by date.

As my media library grows (350GB currently), I would find it beneficial to
be able to browse by 'newest first' to easily identify and select recent
additions.

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070320/98459662/attachment.html>

From Neumann at do-net.de  Wed Mar 21 20:56:52 2007
From: Neumann at do-net.de (Andre Neumann)
Date: Wed, 21 Mar 2007 20:56:52 +0100
Subject: [Softdevice-devel] Feature Request: Autocrop and smooth zoom in
	softdevice
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D03901A15A@sbs2003.do-net.de>

Hi list,
 
i've just tested the very good xineliboutput plugin for vdr. Since im only using softdevice till now, i know how
good softdevice works. Again my respect to Stefan, Martin and the others.
 
While testing the xineliboutput plugin i noticed some really nice features.
 
The xineliboutput plugins features a autocrop mode. That means, when using a 16:9 TV and when watching a 4:3 movie with black bars, the plugin sets the crop mode to 16:9 automaticly. And it also zooms slowly into that
crop mode. Very nice feature i think. My girlfriend likes it, and me too :)
 
I know that this feature is from the xine-lib, but maybe it is possible to integrate it into softdevice.
 
One person from vdrportal.de a while ago posted such patches, but they do not work for me. The smooth zoom patch does not work at all, the autocrop patch works, but not as good as the xine think.
 
Maybe anyone likes this idea too, and is able to integrate it into softdevice. I think, it would be a great feature.
 
-----------------------
Andre Neumann
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070321/fa15b244/attachment.html>

From torgeir at pobox.com  Thu Mar 22 01:27:09 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 22 Mar 2007 00:27:09 +0000
Subject: [Softdevice-devel] weird osd effect during channel change
Message-ID: <373E4131-0FE6-42A4-BEA8-2FC63A6E9E98@pobox.com>

I'm seeing a weird effect in my setup (vdr 1.4.5, softdevice from  
cvs). When I change channel with the cursor keys (as opposed to using  
the number buttons), while the channel change is in effect and  
softdevice isn't updating the video, the OSD continues to change the  
channel info upwards.

Eg. I'm watching channel 1, then change to channel two with the up  
key. While i'm waiting for channel 2 to be shown, the channel info  
show's what's on now for channel 3, then channel 4, then channel 5  
etc. When the video from channel 2 finally appears, info for what's  
on channel 2 is shown again. Thus it's not a problem with a 'stuck'  
up key. It's a bit hard to see how fast the channel info is changing,  
but it might be one higher channel per new frame.

I'm really baffeled by this would be happening. Any ideas?

I'm using mgatv output on DirectFB.

-- 
Torgeir Veimo
torgeir at pobox.com





From M.Wache at gmx.net  Sun Mar 25 11:32:53 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 25 Mar 2007 11:32:53 +0200
Subject: [Softdevice-devel] Softplay feature request - sort
 directory/files by date
In-Reply-To: <6bd97e940703200816t46da3ab6t496d6a01898f043e@mail.gmail.com>
References: <6bd97e940703200816t46da3ab6t496d6a01898f043e@mail.gmail.com>
Message-ID: <460641C5.8020609@gmx.net>

Hi,


vdrgeorge schrieb:
> I would like to request a feature to toggle the file/directory lists
> sorting by date.
> 
> As my media library grows (350GB currently), I would find it beneficial
> to be able to browse by 'newest first' to easily identify and select
> recent additions.
> 

I'm sorry, currently I don't spend much time on softplay, since most of
my spare time is already taken by other projects. So if I implemented
this feature, it won't be any time soon.

But feel free to send a patch :-)

Bye,

Martin


From Neumann at do-net.de  Sun Mar 25 13:21:46 2007
From: Neumann at do-net.de (Andre Neumann)
Date: Sun, 25 Mar 2007 13:21:46 +0200
Subject: [Softdevice-devel] Feature Request: Autocrop and smooth zoom
	insoftdevice
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D039D1F7@sbs2003.do-net.de>

I have it working now. You find the patch at 
http://www.do-net.de/softdevice_autocropsmooth.diff , 
which is againts CVS from around 08/08/2006.

I did not write the code, someone from vdrportal.de has done this, i put the
two patches together, and yes, it is working.

Maybe someone with more knowledge of programming can look into the patch and
bring it to current CVS.


-------------
Andre Neumann



From M.Wache at gmx.net  Sun Mar 25 11:47:25 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 25 Mar 2007 11:47:25 +0200
Subject: [Softdevice-devel] Feature Request: Autocrop and smooth zoom
 in	softdevice
In-Reply-To: <FB3B5DB3197CEA429E5FB8E83D01D03901A15A@sbs2003.do-net.de>
References: <FB3B5DB3197CEA429E5FB8E83D01D03901A15A@sbs2003.do-net.de>
Message-ID: <4606452D.6020805@gmx.net>

Hi,

Andre Neumann schrieb:
> 
> Hi list,
>  
> i've just tested the very good xineliboutput plugin for vdr. Since im
> only using softdevice till now, i know how
> good softdevice works. Again my respect to Stefan, Martin and the others.
>  
> While testing the xineliboutput plugin i noticed some really nice features.
>  
> The xineliboutput plugins features a autocrop mode. That means, when
> using a 16:9 TV and when watching a 4:3 movie with black bars, the
> plugin sets the crop mode to 16:9 automaticly. And it also zooms slowly
> into that
> crop mode. Very nice feature i think. My girlfriend likes it, and me too :)
>  
> I know that this feature is from the xine-lib, but maybe it is possible
> to integrate it into softdevice.
>  
> One person from vdrportal.de a while ago posted such patches, but they
> do not work for me. The smooth zoom patch does not work at all, the
> autocrop patch works, but not as good as the xine think.
>  
I personally don't own a 16:9 screen, so I would not use such a
feature... However I had a look at the patch by pram at vdrportal.de and
updated them to the softdevice cvs. I also improved some things, and
made it possible to switch the border detection on and of. I also tried
a smooth zoom, but with video-xv the video will flicker during the zoom,
so I left it out for now. Also currently the aspect is switched for the
every frame, I think it would be better to wait until one detects a
aspect change in a series of frames and switch the aspect only once.

I attached the result, please try it and tell me if you like it/ what
could be improved.

Bye,

martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: borderdetect.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20070325/df3fcedd/attachment.ksh>

From stefan at lucke.in-berlin.de  Sun Mar 25 20:13:20 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 25 Mar 2007 20:13:20 +0200
Subject: [Softdevice-devel] [PATCH] softdevice configure SUSPEND_BY_KEY
	support
In-Reply-To: <4603C434.9040300@o2.pl>
References: <4603C434.9040300@o2.pl>
Message-ID: <200703252013.20347.stefan@lucke.in-berlin.de>

On Friday 23 March 2007 13:12, Artur Skawina wrote:
> i've been wondering why the XV suspend key stopped working a while
> ago, but as i was not actually using it, never investigated. Until
> today :) Apparently SUSPEND_BY_KEY was (and is) a makefile option,
> but the newer configure script does not know about this feature.
> Patch below enables it and adds a configure option to turn it off.
> 

Thanks for your patch.

Should be ok. Reenabling the 'r/R' functionality.

> 
> diff -urp softdevice-cvs.org/configure softdevice-cvs/configure
> --- softdevice-cvs.org/configure	2007-03-13 02:57:19.000000000 +0100
> +++ softdevice-cvs/configure	2007-03-23 10:23:18.000000000 +0100
> @@ -43,6 +43,7 @@ cle266="yes"
>  alsa="yes"
>  oss="yes"
>  yaepg="auto"
> +suspendkey="yes"
> 
>  function help () {
>    echo "Usage: configure [options]"
> @@ -58,6 +59,7 @@ function help () {
>    echo "  --disable-mmx2"
>    echo "  --disable-alsa"
>    echo "  --disable-oss"
> +  echo "  --disable-suspendkey"
>    echo "  --disable-yaepg / --enable-yapg (yaepg patch support)"
>    echo "  --with-ffmpeg-path YOUR_FFMPEG_PATH"
>    echo "  --with-vidix-path YOUR_VIDIX_PATH"
> @@ -81,6 +83,7 @@ do
>      --disable-mmx2) shift; with_mmx2="no";;
>      --disable-alsa) shift; alsa="no";;
>      --disable-oss) shift; oss="no";;
> +    --disable-suspendkey) shift; suspendkey="no";;
>      --disable-yaepg) shift; yaepg="no";;
>      --enable-yaepg) shift; yaepg="yes";;
>      --with-ffmpeg-path) shift;
> @@ -586,6 +589,10 @@ if test "${with_altivec}" = "yes" ; then
>    echo "ADD_CXXFLAGS += -faltivec" >> $TMPM
>  fi
> 
> +if test "${suspendkey}" = "yes" ; then
> +  echo "#define SUSPEND_BY_KEY 1" >> $TMPH
> +fi
> +
>  if test "${yaepg}" = "yes" ; then
>    echo "#define HAVE_YAEPGPATCH 1" >> $TMPH
>  fi
> 
> 
> 
> 
> 
> 

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Mar 25 20:13:25 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 25 Mar 2007 20:13:25 +0200
Subject: [Softdevice-devel] [PATCH] softdevice xv autosuspend
In-Reply-To: <4603CA00.1030901@o2.pl>
References: <4603CA00.1030901@o2.pl>
Message-ID: <200703252013.25256.stefan@lucke.in-berlin.de>

On Friday 23 March 2007 13:37, Artur Skawina wrote:
> Turns off the decoder when the video window isn't visible (when you switch to another
> (virtual) desktop, other windows cover it or screensaver kicks in etc).
> 
> Note this will unsuspend on vdr startup when using XV even when the previously saved
> config value was 0 - this is probably the desired behaviour; to start XV in suspended
> mode make sure the window isn't visible by placing it appropriately (using geometry/WM).
> 

Thanks for your patch.

We should be prepared to act on VisibilityNotify, but I don't think this should
be done automagically mapped to suspend/resume action.
Comments welcome.

Example:
- 'r' did a suspend action (video and audio stopped).
- touching the window will bring back both.

and switching to another desktop with kde does not deliver
VisibilityFullyObscured :-( . 

> 
> diff -urp softdevice-cvs.org/video-xv.c softdevice-cvs/video-xv.c
> --- softdevice-cvs.org/video-xv.c	2006-12-18 00:03:46.000000000 +0100
> +++ softdevice-cvs/video-xv.c	2007-03-23 11:09:48.000000000 +0100
> @@ -579,7 +579,8 @@ void cXvVideoOut::ProcessEvents ()
>                                   KeyPressMask |
>                                   ExposureMask |
>                                   ConfigureNotify |
> -                                 StructureNotifyMask,
> +                                 StructureNotifyMask |
> +                                 VisibilityChangeMask,
>                                   &event))
>    {
>      switch (event.type)
> @@ -703,6 +704,11 @@ void cXvVideoOut::ProcessEvents ()
>          }
>          break;
> 
> +      case VisibilityNotify:
> +        EVDEB("VisibilityNotify\n");
> +        setupStore->shouldSuspend = event.xvisibility.state==VisibilityFullyObscured;
> +        break;
> +
>        case MapNotify:
>          EVDEB("MapNotify\n");
>          map_count++;
> @@ -920,7 +926,8 @@ bool cXvVideoOut::Initialize (void)
> 
>    XSelectInput(dpy, win, KeyPressMask | ExposureMask |
>                           ConfigureNotify | StructureNotifyMask |
> -                         PointerMotionMask | ButtonPressMask);
> +                         PointerMotionMask | ButtonPressMask |
> +                         VisibilityChangeMask);
> 
>    XMapRaised(dpy, win);
>    //XNextEvent(dpy, &event);
> 
> 

-- 
Stefan Lucke


From malcolm.caldwell at cdu.edu.au  Mon Mar 26 05:49:14 2007
From: malcolm.caldwell at cdu.edu.au (Malcolm Caldwell)
Date: Mon, 26 Mar 2007 03:49:14 +0000 (UTC)
Subject: [Softdevice-devel] Feature Request: Autocrop and smooth
	zoom	insoftdevice
References: <FB3B5DB3197CEA429E5FB8E83D01D039D1F7@sbs2003.do-net.de>
Message-ID: <pan.2007.03.26.03.49.13@cdu.edu.au>

On Sun, 25 Mar 2007 13:21:46 +0200, Andre Neumann wrote:

> I have it working now. You find the patch at
> http://www.do-net.de/softdevice_autocropsmooth.diff , which is againts
> CVS from around 08/08/2006.

Can someone tell me:

Does this code work for the case where there is I have a 4:3 Display, but 
my channel broadcasts all programming as 16:9 - even if it is 4:3 
content.  They also do not use AFD.

Does this patch 'zoom' such content to fill my screen?
 
> I did not write the code, someone from vdrportal.de has done this, i put
> the two patches together, and yes, it is working.
> 
> Maybe someone with more knowledge of programming can look into the patch
> and bring it to current CVS.
> 
> 
> -------------
> Andre Neumann



From per at mellander.org  Mon Mar 26 13:31:40 2007
From: per at mellander.org (Per Mellander)
Date: Mon, 26 Mar 2007 13:31:40 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
Message-ID: <4607AF1C.8090802@mellander.org>


VDR 1.4.5
softdevice CVS 20070312
softplay CVS 20070312
FFmpeg version SVN-r7991, Copyright (c) 2000-2007 Fabrice Bellard, et al.
   configuration: --enable-shared --enable-pp --enable-gpl
   libavutil version: 49.3.0
   libavcodec version: 51.33.0
   libavformat version: 51.10.0
   built on Feb 17 2007 21:53:00, gcc: 4.1.1 20070105 (Red Hat 4.1.1-51)

I've also patched softdevice with a patch that should have solved 
another issue for me. ( Unfortunately it didn't ) It was the patch 
released on the list here:

http://www.linuxtv.org/pipermail/vdr/2007-March/012476.html

Have noticed an unwanted A/V-sync issue with my current setup. I've 
recently switched to faster/better hardware ( Core 2, 1.86GHz ). The 
problem I've got is that when watching live TV I've getting this nasty 
A/V sync problem. Sometimes it fixes itself (!) and also sometimes it 
will get in sync after I switch channel. IIRC I didn't have this problem 
running the installation with my old hardware. The difference is that 
I'm running a kernel compiled with coretemp patch and with another 
processor selected.

I have one DVB-S and one DVB-T, ( both budget cards ) and I've got the 
same problem on either card, so I don't think it has anything to do with 
a weak signal (?).

I've got a feeling that it has something to do with backgrounding tasks 
as I see temp raises from ~46 to ~54 degrees Celsius when it starts to 
loose sync. I've also noticed that idle drops from about 96 to 87 when 
the problem occurs. Maybe it's the patch mentioned earlier in this 
message? I'll try with a fresh install later today to sort things out.

Anyone with this problem?

Sincerely,
Per


From torgeir at pobox.com  Mon Mar 26 14:36:54 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 26 Mar 2007 13:36:54 +0100
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
In-Reply-To: <4607AF1C.8090802@mellander.org>
References: <4607AF1C.8090802@mellander.org>
Message-ID: <6611C8EF-1EE9-499D-8267-82B314B7FFF7@pobox.com>


On 26 Mar 2007, at 12:31, Per Mellander wrote:

> Have noticed an unwanted A/V-sync issue with my current setup.

Are you using DirectFB output? If you are, get the latest CVS  
version, and edit video.c line 546 from if(0) to if (1), this turns  
on a bit more agressive resync approach for DirectFB.

-- 
Torgeir Veimo
torgeir at pobox.com





From per at mellander.org  Mon Mar 26 14:52:47 2007
From: per at mellander.org (Per Mellander)
Date: Mon, 26 Mar 2007 14:52:47 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <6611C8EF-1EE9-499D-8267-82B314B7FFF7@pobox.com>
References: <4607AF1C.8090802@mellander.org>
	<6611C8EF-1EE9-499D-8267-82B314B7FFF7@pobox.com>
Message-ID: <4607C21F.9000001@mellander.org>

Torgeir Veimo wrote:
> On 26 Mar 2007, at 12:31, Per Mellander wrote:
> 
>> Have noticed an unwanted A/V-sync issue with my current setup.
> 
> Are you using DirectFB output? If you are, get the latest CVS  
> version, and edit video.c line 546 from if(0) to if (1), this turns  
> on a bit more agressive resync approach for DirectFB.
> 

No I'm running xv-output in fullscreen. But thanks anyway.

Per


From torgeir at pobox.com  Mon Mar 26 14:56:36 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 26 Mar 2007 13:56:36 +0100
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
In-Reply-To: <4607C21F.9000001@mellander.org>
References: <4607AF1C.8090802@mellander.org>
	<6611C8EF-1EE9-499D-8267-82B314B7FFF7@pobox.com>
	<4607C21F.9000001@mellander.org>
Message-ID: <98EA4C08-222A-43BA-B664-EAE537125718@pobox.com>


On 26 Mar 2007, at 13:52, Per Mellander wrote:

> Torgeir Veimo wrote:
>> On 26 Mar 2007, at 12:31, Per Mellander wrote:
>>
>>> Have noticed an unwanted A/V-sync issue with my current setup.
>>
>> Are you using DirectFB output? If you are, get the latest CVS
>> version, and edit video.c line 546 from if(0) to if (1), this turns
>> on a bit more agressive resync approach for DirectFB.
>>
>
> No I'm running xv-output in fullscreen. But thanks anyway.

Maybe try it even for Xv output.

-- 
Torgeir Veimo
torgeir at pobox.com





From M.Wache at gmx.net  Mon Mar 26 18:55:11 2007
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 26 Mar 2007 18:55:11 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <4607AF1C.8090802@mellander.org>
References: <4607AF1C.8090802@mellander.org>
Message-ID: <4607FAEF.2090201@gmx.net>

Per Mellander schrieb:
> VDR 1.4.5
> softdevice CVS 20070312
> softplay CVS 20070312
> FFmpeg version SVN-r7991, Copyright (c) 2000-2007 Fabrice Bellard, et al.
>    configuration: --enable-shared --enable-pp --enable-gpl
>    libavutil version: 49.3.0
>    libavcodec version: 51.33.0
>    libavformat version: 51.10.0
>    built on Feb 17 2007 21:53:00, gcc: 4.1.1 20070105 (Red Hat 4.1.1-51)
> 
> I've also patched softdevice with a patch that should have solved 
> another issue for me. ( Unfortunately it didn't ) It was the patch 
> released on the list here:
> 
> http://www.linuxtv.org/pipermail/vdr/2007-March/012476.html
> 

This patch still has some issues which have to be solved, one of them is
that it breaks A-V sync for some streams. So if you don't need it,
please don't apply it.

Bye,

Martin


From stefan at lucke.in-berlin.de  Mon Mar 26 19:22:06 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 26 Mar 2007 19:22:06 +0200
Subject: [Softdevice-devel] [PATCH] softdevice xv autosuspend
In-Reply-To: <4607D17C.5000400@o2.pl>
References: <4603CA00.1030901@o2.pl>
	<200703252013.25256.stefan@lucke.in-berlin.de>
	<4607D17C.5000400@o2.pl>
Message-ID: <200703261922.06705.stefan@lucke.in-berlin.de>

On Monday 26 March 2007 15:58, Artur Skawina wrote:

Please subscribe to the list. For some reason there is no separate
request for approval.

> Stefan Lucke wrote:
> > On Friday 23 March 2007 13:37, Artur Skawina wrote:
> >> Turns off the decoder when the video window isn't visible (when you switch to another
> >> (virtual) desktop, other windows cover it or screensaver kicks in etc).
> >>
> >> Note this will unsuspend on vdr startup when using XV even when the previously saved
> >> config value was 0 - this is probably the desired behaviour; to start XV in suspended
> >> mode make sure the window isn't visible by placing it appropriately (using geometry/WM).
> >>
> > 
> > Thanks for your patch.
> > 
> > We should be prepared to act on VisibilityNotify, but I don't think this should
> > be done automagically mapped to suspend/resume action.
> > Comments welcome.
> 
> I've now used it for a few days, some thoughts:
> 
> - it does the right thing wrt video, but turning off the audio is not always desirable;
>   examples would be listening to radio or some kind of music/talk channel. While the
>   former could be auto detected (don't suspend if no video) the latter does require
>   a user defined preference.
> - When not live viewing but playing back recordings, suspending the playback completely
>   when the window is hidden actually turns out to be a feature -- you can switch to
>   another desktop (or otherwise hide the window) and playback will pause; switch back
>   and the playback resumes. This turns out to be very convenient, but makes the user
>   pref mentioned above a bit more complicated. Is there a simple way to distinguish live
>   viewing from playback?
> - When live viewing, suspending does not stop av stream, using bw and/or keeping a dvb device
>   unnecessarily busy.
> - (un)suspending does a bit too much x/xv (de)init.
> 
> > Example:
> > - 'r' did a suspend action (video and audio stopped).
> > - touching the window will bring back both.
> 
> I'm not using 'r' so i didn't notice this. Yes, moving anything over the window or just
> moving the video window itself does unsuspend. I've always considered the 'r' key a hack
> (the reason I sent the patch enabling it w/ configure is that it is a regression); it should
> be done via normal vdr input processing so that it it is accessible from remotes too.
> Making 'r' work independently from autosuspend would be easy (eg using a bitmask instead of int),
> but a more complex approach is needed anyway to handle the above mentioned cases...
> 
> > and switching to another desktop with kde does not deliver
> > VisibilityFullyObscured :-( . 
> 
> It works with fvwm2; this probably depends on the window manager. Switching away from X
> (eg ctrl-alt-f1) seems to work too.
> 
> I'll take a look at fixing some of the above issues in the next few days.
> 
> artur
> 
> >> diff -urp softdevice-cvs.org/video-xv.c softdevice-cvs/video-xv.c
> >> --- softdevice-cvs.org/video-xv.c	2006-12-18 00:03:46.000000000 +0100
> >> +++ softdevice-cvs/video-xv.c	2007-03-23 11:09:48.000000000 +0100
> >> @@ -579,7 +579,8 @@ void cXvVideoOut::ProcessEvents ()
> >>                                   KeyPressMask |
> >>                                   ExposureMask |
> >>                                   ConfigureNotify |
> >> -                                 StructureNotifyMask,
> >> +                                 StructureNotifyMask |
> >> +                                 VisibilityChangeMask,
> >>                                   &event))
> >>    {
> >>      switch (event.type)
> >> @@ -703,6 +704,11 @@ void cXvVideoOut::ProcessEvents ()
> >>          }
> >>          break;
> >>
> >> +      case VisibilityNotify:
> >> +        EVDEB("VisibilityNotify\n");
> >> +        setupStore->shouldSuspend = event.xvisibility.state==VisibilityFullyObscured;
> >> +        break;
> >> +
> >>        case MapNotify:
> >>          EVDEB("MapNotify\n");
> >>          map_count++;
> >> @@ -920,7 +926,8 @@ bool cXvVideoOut::Initialize (void)
> >>
> >>    XSelectInput(dpy, win, KeyPressMask | ExposureMask |
> >>                           ConfigureNotify | StructureNotifyMask |
> >> -                         PointerMotionMask | ButtonPressMask);
> >> +                         PointerMotionMask | ButtonPressMask |
> >> +                         VisibilityChangeMask);
> >>
> >>    XMapRaised(dpy, win);
> >>    //XNextEvent(dpy, &event);
> >>
> >>
> 
> 

-- 
Stefan Lucke


From per at mellander.org  Tue Mar 27 08:49:28 2007
From: per at mellander.org (Per Mellander)
Date: Tue, 27 Mar 2007 08:49:28 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <4607FAEF.2090201@gmx.net>
References: <4607AF1C.8090802@mellander.org> <4607FAEF.2090201@gmx.net>
Message-ID: <4608BE78.3050803@mellander.org>

Martin Wache wrote:
> 
> This patch still has some issues which have to be solved, one of them is
> that it breaks A-V sync for some streams. So if you don't need it,
> please don't apply it.
> 

I checked out a fresh CVS yesterday and changed the 'if (0)' to 'if (1)' 
at line 546 in video.c. The result was that I've now got A/V sync 
problems lasting much shorter in time than before. It seems to fix 
itself also because I didn't have to do anything to get the A/V in sync 
again. I'm not quite sure but I think that the problems sometimes occur 
at the same time that the HD led is active. I've switched off all the 
unneeded services and VDR is the only 'user activity' on the machine.

Tried to find some more debugging options in softdevice but didn't do 
any changes. How do I set softdevice to send a little bit more debugging 
info?

Per


From torgeir at pobox.com  Tue Mar 27 09:40:16 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 27 Mar 2007 08:40:16 +0100
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
In-Reply-To: <4608BE78.3050803@mellander.org>
References: <4607AF1C.8090802@mellander.org> <4607FAEF.2090201@gmx.net>
	<4608BE78.3050803@mellander.org>
Message-ID: <11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>


On 27 Mar 2007, at 07:49, Per Mellander wrote:

> Martin Wache wrote:
>>
>> This patch still has some issues which have to be solved, one of  
>> them is
>> that it breaks A-V sync for some streams. So if you don't need it,
>> please don't apply it.
>>
>
> I checked out a fresh CVS yesterday and changed the 'if (0)' to 'if  
> (1)'
> at line 546 in video.c. The result was that I've now got A/V sync
> problems lasting much shorter in time than before. It seems to fix
> itself also because I didn't have to do anything to get the A/V in  
> sync
> again. I'm not quite sure but I think that the problems sometimes  
> occur
> at the same time that the HD led is active. I've switched off all the
> unneeded services and VDR is the only 'user activity' on the machine.
>
> Tried to find some more debugging options in softdevice but didn't do
> any changes. How do I set softdevice to send a little bit more  
> debugging
> info?

Make sure you have syslog set to debug output, also change line 917  
of mpeg2decoder.c from #if 0 to #if 1, which will result in some  
stats on dropped / repeted frames.

You said you had better sync with an older version? Which version was  
that? Or was it simply older hardware?

-- 
Torgeir Veimo
torgeir at pobox.com





From per at mellander.org  Tue Mar 27 11:15:44 2007
From: per at mellander.org (Per Mellander)
Date: Tue, 27 Mar 2007 11:15:44 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>
References: <4607AF1C.8090802@mellander.org>
	<4607FAEF.2090201@gmx.net>	<4608BE78.3050803@mellander.org>
	<11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>
Message-ID: <4608E0C0.6030203@mellander.org>

Torgeir Veimo wrote:

> Make sure you have syslog set to debug output, also change line 917  
> of mpeg2decoder.c from #if 0 to #if 1, which will result in some  
> stats on dropped / repeted frames.
> 
> You said you had better sync with an older version? Which version was  
> that? Or was it simply older hardware?
> 

Older hardware only, ie. P4 Prescott @ 3GHz. I took the old installation 
and booted the new hardware. Did a quick test and after that I patched 
the kernel 2.6.20 with cputemp, changed the CPU-type. Recompile, install 
etc. Noticed the sync problem and started this thread.



From torgeir at pobox.com  Tue Mar 27 12:04:19 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 27 Mar 2007 11:04:19 +0100
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
In-Reply-To: <4608E0C0.6030203@mellander.org>
References: <4607AF1C.8090802@mellander.org> <4607FAEF.2090201@gmx.net>
	<4608BE78.3050803@mellander.org>
	<11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>
	<4608E0C0.6030203@mellander.org>
Message-ID: <1E27249A-0365-4C1B-884B-52326537A33B@pobox.com>


On 27 Mar 2007, at 10:15, Per Mellander wrote:

> Torgeir Veimo wrote:
>
>> Make sure you have syslog set to debug output, also change line 917
>> of mpeg2decoder.c from #if 0 to #if 1, which will result in some
>> stats on dropped / repeted frames.
>>
>> You said you had better sync with an older version? Which version was
>> that? Or was it simply older hardware?
>>
>
> Older hardware only, ie. P4 Prescott @ 3GHz. I took the old  
> installation
> and booted the new hardware. Did a quick test and after that I patched
> the kernel 2.6.20 with cputemp, changed the CPU-type. Recompile,  
> install
> etc. Noticed the sync problem and started this thread.

Can you set up an a/v offset (delay) of 40 in softdevice  
configuration? It's needed when doing double buffering as the Xv  
output does.

What hardware are you using?

-- 
Torgeir Veimo
torgeir at pobox.com





From per at mellander.org  Tue Mar 27 12:58:42 2007
From: per at mellander.org (Per Mellander)
Date: Tue, 27 Mar 2007 12:58:42 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <1E27249A-0365-4C1B-884B-52326537A33B@pobox.com>
References: <4607AF1C.8090802@mellander.org>
	<4607FAEF.2090201@gmx.net>	<4608BE78.3050803@mellander.org>	<11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>	<4608E0C0.6030203@mellander.org>
	<1E27249A-0365-4C1B-884B-52326537A33B@pobox.com>
Message-ID: <4608F8E2.4010806@mellander.org>

Torgeir Veimo wrote:
> On 27 Mar 2007, at 10:15, Per Mellander wrote:
> 
>> Torgeir Veimo wrote:
>>
>>> Make sure you have syslog set to debug output, also change line 917
>>> of mpeg2decoder.c from #if 0 to #if 1, which will result in some
>>> stats on dropped / repeted frames.
>>>
>>> You said you had better sync with an older version? Which version was
>>> that? Or was it simply older hardware?
>>>
>> Older hardware only, ie. P4 Prescott @ 3GHz. I took the old  
>> installation
>> and booted the new hardware. Did a quick test and after that I patched
>> the kernel 2.6.20 with cputemp, changed the CPU-type. Recompile,  
>> install
>> etc. Noticed the sync problem and started this thread.
> 
> Can you set up an a/v offset (delay) of 40 in softdevice  
> configuration? It's needed when doing double buffering as the Xv  
> output does.
> 
> What hardware are you using?
> 

I'll try that!

Foxconn P9657AA-8EKRS2H
Intel Core 2 Duo @ 1.86GHz
1GB RAM
GeForce 7600 GT ( HDMI output )
Hauppauge Nova-T
Skystar 2 DVB-S



From per at mellander.org  Wed Mar 28 07:38:41 2007
From: per at mellander.org (Per Mellander)
Date: Wed, 28 Mar 2007 07:38:41 +0200
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
 softdevice.
In-Reply-To: <4608F8E2.4010806@mellander.org>
References: <4607AF1C.8090802@mellander.org>	<4607FAEF.2090201@gmx.net>	<4608BE78.3050803@mellander.org>	<11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>	<4608E0C0.6030203@mellander.org>	<1E27249A-0365-4C1B-884B-52326537A33B@pobox.com>
	<4608F8E2.4010806@mellander.org>
Message-ID: <4609FF61.70200@mellander.org>

Per Mellander wrote:
> Torgeir Veimo wrote:
>> On 27 Mar 2007, at 10:15, Per Mellander wrote:
>>
>>> Torgeir Veimo wrote:
>>>
>>>> Make sure you have syslog set to debug output, also change line 917
>>>> of mpeg2decoder.c from #if 0 to #if 1, which will result in some
>>>> stats on dropped / repeted frames.
>>>>

Didn't compile without adding:

int dispTime = syncTimer->GetRelTime();

and changing:

DispTSum/(float)Freq/1000.0,hurry_up);

to

DispTSum/(float)Freq/1000.0,context->hurry_up);

Is this correct?

Didn't get that much time with VDR yesterday. Noticed a few 'lags' after 
increasing A/V delay to 40, but as said - still sync problem :( I'll try 
to generate some logs tonight to see if that will give more info. I'm 
pretty sure it's somewhere in softdevice and not an hardware or load 
issue. My MediaMVP ( vompserver ) is running smooth in the kitchen.

/Per


From torgeir at pobox.com  Wed Mar 28 20:18:30 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 28 Mar 2007 19:18:30 +0100
Subject: [Softdevice-devel] Is there a known A/V sync issue with current
	softdevice.
In-Reply-To: <4608E0C0.6030203@mellander.org>
References: <4607AF1C.8090802@mellander.org> <4607FAEF.2090201@gmx.net>
	<4608BE78.3050803@mellander.org>
	<11BF6F4D-150B-4D1D-819F-A91B80C48993@pobox.com>
	<4608E0C0.6030203@mellander.org>
Message-ID: <AE4E91C9-540F-464E-994F-6A3E16824294@pobox.com>

Maybe try changing your refresh rate, eg try any of 50, 56 and 60Hz.

-- 
Torgeir Veimo
torgeir at pobox.com





From jean.palazuelos at free.fr  Thu Mar 29 11:20:32 2007
From: jean.palazuelos at free.fr (jean.palazuelos at free.fr)
Date: Thu, 29 Mar 2007 11:20:32 +0200
Subject: [Softdevice-devel] Howto control alsa volume in command line?
Message-ID: <1175160032.460b84e082d1a@imp.free.fr>

Hi all,

I set the volume to maximum in VDR but the sound still be very low. I read
something about this (but can not retreive where). The only thing I read is in
the changelog from Softdevice 0.3.1:

"2006-11-05: softdevice-0.3.1
   ...
   - audio: select alsa h/w-mixer for volume control via command line.
   ...
"

I understand that I have to change volume level with a comand line (may be alsa
tools), but how can I do that?

THX and great Job for doing Softdevice !!
Bye




From torgeir at pobox.com  Fri Mar 30 02:40:01 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 30 Mar 2007 01:40:01 +0100
Subject: [Softdevice-devel] video now synced
Message-ID: <F553E9EF-0EE7-42E0-90F6-FBF017310B8F@pobox.com>

  [VideoOut] video now synced (53 - -370)

Are these numbers the frame at which time a/v sync was achieved  
counted from playback started after channel change, and the second  
number the amount of offset applied to the video?

-- 
Torgeir Veimo
torgeir at pobox.com





From stefan at lucke.in-berlin.de  Sat Mar 31 09:32:27 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 31 Mar 2007 09:32:27 +0200
Subject: [Softdevice-devel] Howto control alsa volume in command line?
In-Reply-To: <1175160032.460b84e082d1a@imp.free.fr>
References: <1175160032.460b84e082d1a@imp.free.fr>
Message-ID: <200703310932.27859.stefan@lucke.in-berlin.de>

On Thursday 29 March 2007 11:20, jean.palazuelos at free.fr wrote:
> Hi all,
> 
> I set the volume to maximum in VDR but the sound still be very low. I read
> something about this (but can not retreive where). The only thing I read is in
> the changelog from Softdevice 0.3.1:
> 
> "2006-11-05: softdevice-0.3.1
>    ...
>    - audio: select alsa h/w-mixer for volume control via command line.
>    ...
> "

Maybe this is ambigue:
- select h/w-mixer via command line.

volume control is done via h/w mixer
instead of software multiplication.

-- 
Stefan Lucke


From stefan at lucke.in-berlin.de  Sat Mar 31 09:32:31 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 31 Mar 2007 09:32:31 +0200
Subject: [Softdevice-devel] video now synced
In-Reply-To: <F553E9EF-0EE7-42E0-90F6-FBF017310B8F@pobox.com>
References: <F553E9EF-0EE7-42E0-90F6-FBF017310B8F@pobox.com>
Message-ID: <200703310932.31579.stefan@lucke.in-berlin.de>

On Friday 30 March 2007 02:40, Torgeir Veimo wrote:
>   [VideoOut] video now synced (53 - -370)
> 
> Are these numbers the frame at which time a/v sync was achieved  
> counted from playback started after channel change,
Yes.

> and the second   
> number the amount of offset applied to the video?

2nd number is the current offset, as the message is written.
Sync is defined here as:
current offset enters a +-1 frame duration magrin.

-- 
Stefan Lucke


