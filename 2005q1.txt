From noreply at berlios.de  Sat Jan  1 15:47:40 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Sat, 1 Jan 2005 15:47:40 +0100 (CET)
Subject: [Softdevice-devel] [Bug #2972] Picture disappears when OSD goes off
Message-ID: <200501011447.j01Ele45022509@unicorn.berlios.de>

Bug #2972, was updated on 2004-Dec-29 22:38
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: xv-out
Status: Closed
Resolution: Fixed
Bug Group: None
Priority: 5
Submitted by: vesuri
Assigned to : none
Summary: Picture disappears when OSD goes off

Details: The OSD works on top of the video display but when no button is pressed and the OSD goes off after a few seconds the window goes completely blank. Moving the window makes the picture appear again but this repeats every time the OSD goes off. Subtitles seemed to have the same effect.

Setup:

- vdr-1.3.17
- vdr-softdevice-0.0.8pre1
- GCC 3.4.2
- glibc 2.3.4
- Linux 2.6.9-mh3
- ALSA 1.0.7
- Current FFMPEG CVS as of 20041229


Follow-Ups:

Date: 2004-Dec-31 02:00
By: lucke

Comment:
No, colorkey value 0x01000000 was a workaround for an Xfree, dri, Xorg bug in the savage driver(s) which treat colorkey value of BLACK different as other colors. Value BLACK 0x00000000 is the right value. If the vdr window is partially hidden by other windows which have black areas, then it is by nature of colorkeying that video is shown in these black areas. If you minimize the vdr window, Xv-out is stopped and black areas of other windows shall return to black :-) . Colorkey fix is now in cvs.
-------------------------------------------------------

Date: 2004-Dec-30 20:24
By: vesuri

Comment:
Video is shown through all black parts of all windows though but I guess there's nothing that can be done about that if the driver does not support the 0x01000000 color key.
-------------------------------------------------------

Date: 2004-Dec-30 15:30
By: vesuri

Comment:
Yes, this fixed the problem. Thanks!
-------------------------------------------------------

Date: 2004-Dec-29 23:52
By: lucke

Comment:
Can you try to change line 860 from:
attributeStore.SetColorkey(0x01000000);
to:
attributeStore.SetColorkey(0x00000000);
to see if that brings back colorkeying for your card
-------------------------------------------------------

Date: 2004-Dec-29 23:46
By: vesuri

Comment:
XFree86 is version 4.3.0 and I'm using ATis proprietary XFree86 driver fglrx-4.3.0-3.14.6.
-------------------------------------------------------

Date: 2004-Dec-29 23:40
By: lucke

Comment:
Which exact version of X11 do you use and which driver is in use ? This is perhaps similar to this report on vdr mailing list:
http://www.linuxtv.org/mailinglists/vdr/2004/12-2004/msg00885.html
-------------------------------------------------------

Date: 2004-Dec-29 23:34
By: vesuri

Comment:
Ah, forgot to mention XFree86 4.3.0. I'll move (back) to X.org 6.8.1 as soon as ATi releases their new driver that will support X.org.
-------------------------------------------------------

Date: 2004-Dec-29 23:31
By: none

Comment:
Are you using XFree 4.*? There was another user which had similar problems a few weeks ago, and he apparently fixed the problem by moving to the xorg server.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=2972&group_id=2051


From particle at luukku.com  Wed Jan  5 20:40:31 2005
From: particle at luukku.com (Ari Koponen)
Date: Wed, 05 Jan 2005 21:40:31 +0200
Subject: [Softdevice-devel] problems with mgatv
Message-ID: <1104954030.2788.38.camel@localhost.localdomain>

Hi guys,

Previously I had problems getting picture to TV with this but now I
eventually managed to get it. The problem was in my directfbrc. I had a
line

mode=720x576

and I changed it to

mode=768x576

and voila! It worked,but next problem is that both video and audio
streams choke very badly. I get only something like a frame per second
and the video looks like it was in slow motion. Here's my log:

---
[root at localhost vdr-1.2.6]# ./vdr -P"softdevice -vo dfb:mgatv"
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 1 lavc
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YUV2)
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4736)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
 
       ---------------------- DirectFB v0.9.21 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------
 
(*) DirectFB/Core: Single Application Core. (2005-01-04 12:35)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 5559)...
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'ps2mouse'
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 5560)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G450 0.7 (convergence integrated media
GmbH)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 8388608 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize
SrcColorkey Deinterlace
[dfb] Supported video Modes are: 640x480 at 16 768x576 at 32 768x576 at 16
640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8
800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8
1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8
1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8
1024x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8
1600x1200 at 8 1600x1200 at 8 1600x1200 at 8 720x576 at 16
[dfb] Enumeratig display Layers
Layer 2 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
  Caps: brightness contrast deinterlacing dst_colorkey screen_location
surface
Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
  Caps: brightness contrast flicker_filtering hue saturation surface
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00200806 bpp = 16
[dfb] Using this layer for OSD: (Matrox CRTC2 Layer - [720x576])
osdSurface::
 - videoonly
 - flipping
videoSurface::
 - videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring ColorKeying
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: Matrox CRTC2 Layer
[dfb] Using this layer for Video out: Matrox CRTC2 Layer
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[dfb] (re)configured 0x00200806
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[softdevice] OSD-Position at 54 x 396
[video] Creating WindowLayer at 54 x 396, (624 x 135)
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 24 8
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 14
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 12
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 16
[mpeg2video @ 0xb7d3a128]skiped MB in I frame at 1 18
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 19
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 21
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 22
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 25
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 1 26
[mpeg2video @ 0xb7d3a128]invalid mb type in I Frame at 0 27
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 1 28
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 29
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 30
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 31
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 32
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 33
[mpeg2video @ 0xb7d3a128]skiped MB in I frame at 1 34
[mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 35
[mpeg2video @ 0xb7d3a128]concealing 2147483647 errors
[mpeg2video @ 0xb7d3a128]Warning MVs not available
[mpeg2video @ 0xb7d3a128]00 motion_type at 11 2
[mpeg2video @ 0xb7d3a128]concealing 2147479327 errors
[mpeg2video @ 0xb7d3a128]Warning MVs not available
---

And here's part of /var/log/messages
---
Jan  5 21:20:46 localhost vdr[5546]: ERROR: ring buffer overflow (89
bytes dropp ed)
Jan  5 21:20:46 localhost vdr[5546]: ERROR: ring buffer overflow (188
bytes drop ped)
Jan  5 21:21:05 localhost last message repeated 21541 times
Jan  5 21:21:05 localhost vdr[5546]: ERROR: skipped 99 byte to sync on
TS packet
Jan  5 21:21:05 localhost vdr[5546]: ERROR: ring buffer overflow (89
bytes dropp ed)
Jan  5 21:21:05 localhost vdr[5546]: ERROR: ring buffer overflow (188
bytes drop ped)
Jan  5 21:21:12 localhost last message repeated 8113 times
---

Normal dfb: driver doesn't cause these problems so I believe that this
problem is not caused by ffmpeg as suggested in the VDR mailinglist.

And last some information about my system:

- Graphics card: Matrox G450 Dualhead 16 Mb
- Kernel: 2.6.9 (vanilla)
- Softdevice and ffmpeg are from today's CVS
- Distro: FedoraCore 2



From stefan at lucke.in-berlin.de  Wed Jan  5 22:11:38 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 5 Jan 2005 22:11:38 +0100
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1104954030.2788.38.camel@localhost.localdomain>
References: <1104954030.2788.38.camel@localhost.localdomain>
Message-ID: <200501052211.39103.stefan@lucke.in-berlin.de>

On Mittwoch, 5. Januar 2005 20:40, Ari Koponen wrote:
> Hi guys,
> 
> Previously I had problems getting picture to TV with this but now I
> eventually managed to get it. The problem was in my directfbrc. I had a
> line
> 
> mode=720x576

But that should be the right one as this resolution is selected, see below.

> 
> and I changed it to
> 
> mode=768x576
> 
> and voila! It worked,but next problem is that both video and audio
> streams choke very badly. I get only something like a frame per second
> and the video looks like it was in slow motion. Here's my log:
> 
> ---
> [root at localhost vdr-1.2.6]# ./vdr -P"softdevice -vo dfb:mgatv"
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice]   argv [1] = -vo
> [setup-softdevice] alsa device set to: default
> [setup-softdevice] A/V Offset set to (0)
> [setup-softdevice] cropping mode set to 0 (none)
> [setup-softdevice] deinterlace method set to 1 lavc

Turn deinterlace OFF. It is not needed in TV-out mode.

> [softdevice] picture mirroring set to 0 (off)
> [setup-softdevice] pixel format set to (YUV2)
> [setup-softdevice] startup aspect set to (4:3 normal)
> [softdevice] initializing Plugin
> [softdevice] Initializing Video Out
> [softdevice] ffmpeg version(0.4.9-pre1) build(4736)
> [dfb] init
> (*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
>  
>        ---------------------- DirectFB v0.9.21 ---------------------
>              (c) 2000-2002  convergence integrated media GmbH
>              (c) 2002-2004  convergence GmbH
>         -----------------------------------------------------------
>  
> (*) DirectFB/Core: Single Application Core. (2005-01-04 12:35)
> (*) Direct/Memcpy: Using MMXEXT optimized memcpy()
> (*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 5559)...
> (*) Direct/Modules: suppress module 'joystick'
> (*) Direct/Modules: suppress module 'ps2mouse'
> (*) Direct/Thread: Running 'Keyboard Input' (INPUT, 5560)...
>  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
> (*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
> (*) DirectFB/Genefx: MMX detected and enabled
> (*) DirectFB/Graphics: Matrox G450 0.7 (convergence integrated media
> GmbH)
> (*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
> [dfb] RAM: 8388608 bytes

Only 8MB are reported, please use the matorx-full-memory patch from DirectFB.

> [dfb] Accellerated Functions: FillRectange DrawRectange DrawLine
> FillTriangle Blit StretchBlit All
> [dfb] Drawing Flags: Blend
> [dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize
> SrcColorkey Deinterlace
> [dfb] Supported video Modes are: 640x480 at 16 768x576 at 32 768x576 at 16
> 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8
> 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8
> 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8
> 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8
> 1024x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8
> 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8 720x576 at 16
> [dfb] Enumeratig display Layers
> Layer 2 FBDev Primary Layer  Type: graphics
>   Caps: brightness contrast saturation surface
> Layer 1 Matrox Backend Scaler  Type: graphics picture video
>   Caps: brightness contrast deinterlacing dst_colorkey screen_location
> surface
> Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
>   Caps: brightness contrast flicker_filtering hue saturation surface
> [dfb] width = 720, height = 576
> [dfb] got fmt = 0x00200806 bpp = 16

Mode 720x576 is selected, OK.
Why the 16 bit mode ? Something from your directfbrc ?
But the number 0x00200806 should be ok as I posted on vdr list ;-) .

> [dfb] Using this layer for OSD: (Matrox CRTC2 Layer - [720x576])
> osdSurface::
>  - videoonly
>  - flipping
> videoSurface::
>  - videoonly
> [dfb] Configuring CooperativeLevel for Overlay
> [dfb] Configuring ColorKeying
> [dfb] Configuring CooperativeLevel for OSD
> [dfb] Using this layer for OSD: Matrox CRTC2 Layer
> [dfb] Using this layer for Video out: Matrox CRTC2 Layer
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] creating new surface
> [dfb] (re)configured 0x00200806
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> [softdevice] OSD-Position at 54 x 396
> [video] Creating WindowLayer at 54 x 396, (624 x 135)
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 24 8
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 14
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 12
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 16
> [mpeg2video @ 0xb7d3a128]skiped MB in I frame at 1 18
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 19
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 21
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 22
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 25
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 1 26
> [mpeg2video @ 0xb7d3a128]invalid mb type in I Frame at 0 27
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 1 28
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 29
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 30
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 31
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 32
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 33
> [mpeg2video @ 0xb7d3a128]skiped MB in I frame at 1 34
> [mpeg2video @ 0xb7d3a128]ac-tex damaged at 0 35
> [mpeg2video @ 0xb7d3a128]concealing 2147483647 errors
> [mpeg2video @ 0xb7d3a128]Warning MVs not available
> [mpeg2video @ 0xb7d3a128]00 motion_type at 11 2
> [mpeg2video @ 0xb7d3a128]concealing 2147479327 errors
> [mpeg2video @ 0xb7d3a128]Warning MVs not available
> ---
> 
> And here's part of /var/log/messages
> ---
> Jan  5 21:20:46 localhost vdr[5546]: ERROR: ring buffer overflow (89
> bytes dropp ed)
> Jan  5 21:20:46 localhost vdr[5546]: ERROR: ring buffer overflow (188
> bytes drop ped)
> Jan  5 21:21:05 localhost last message repeated 21541 times
> Jan  5 21:21:05 localhost vdr[5546]: ERROR: skipped 99 byte to sync on
> TS packet
> Jan  5 21:21:05 localhost vdr[5546]: ERROR: ring buffer overflow (89
> bytes dropp ed)
> Jan  5 21:21:05 localhost vdr[5546]: ERROR: ring buffer overflow (188
> bytes drop ped)
> Jan  5 21:21:12 localhost last message repeated 8113 times
> ---
> 
> Normal dfb: driver doesn't cause these problems so I believe that this
> problem is not caused by ffmpeg as suggested in the VDR mailinglist.
> 
> And last some information about my system:
> 
> - Graphics card: Matrox G450 Dualhead 16 Mb
> - Kernel: 2.6.9 (vanilla)
> - Softdevice and ffmpeg are from today's CVS
> - Distro: FedoraCore 2

Whats the CPU type and speed ?

Stefan Lucke



From lachlanlewis at gmail.com  Thu Jan  6 02:14:00 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Thu, 6 Jan 2005 09:14:00 +0800
Subject: [Softdevice-devel] softdevice question on/off
Message-ID: <b98c6b1a050105171452369913@mail.gmail.com>

G'day.  I was wondering if there was any way to just turn on and off
the softdevice display when it was needed, and keep vdr running all
the time to manage recordings.

Should this question be directed elsewhere?  I would be using freevo
for main display, dvd menu's, and music,, and then when whatching tv
somehow (maybe via an svdrp) turn on the mgatv output, and then turn
it off again when no longer required..

Is there something like this implimented already??  Or would the norm
just be to run 2 instances of vdr ont he one machine??

Mike


From stefan at lucke.in-berlin.de  Thu Jan  6 07:36:44 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 6 Jan 2005 07:36:44 +0100
Subject: [Softdevice-devel] softdevice question on/off
In-Reply-To: <b98c6b1a050105171452369913@mail.gmail.com>
References: <b98c6b1a050105171452369913@mail.gmail.com>
Message-ID: <200501060736.44335.stefan@lucke.in-berlin.de>

On Donnerstag, 6. Januar 2005 02:14, mike lewis wrote:
> G'day.  I was wondering if there was any way to just turn on and off
> the softdevice display when it was needed, and keep vdr running all
> the time to manage recordings.

Ther server part should run allways, right ?

> 
> Should this question be directed elsewhere?  I would be using freevo
> for main display, dvd menu's, and music,, and then when whatching tv
> somehow (maybe via an svdrp) turn on the mgatv output, and then turn
> it off again when no longer required..
> 
> Is there something like this implimented already??  Or would the norm
> just be to run 2 instances of vdr ont he one machine??
> 

The normal setup would be one vdr server and one or more vdr client
connected via streamdev. But even this setup has some disadvanteges.
There is _no_ way to get the OSD of the server :-( , except that someone
writes the code for doing that. You like to do ?

-- 
stefan lucke



From lachlanlewis at gmail.com  Thu Jan  6 13:17:37 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Thu, 6 Jan 2005 20:17:37 +0800
Subject: [Softdevice-devel] softdevice question on/off
In-Reply-To: <200501060736.44335.stefan@lucke.in-berlin.de>
References: <b98c6b1a050105171452369913@mail.gmail.com>
	 <200501060736.44335.stefan@lucke.in-berlin.de>
Message-ID: <b98c6b1a050106041793e8e08@mail.gmail.com>

> Ther server part should run allways, right ?
>
Yes.. 
> >
> > Should this question be directed elsewhere?  I would be using freevo
> > for main display, dvd menu's, and music,, and then when whatching tv
> > somehow (maybe via an svdrp) turn on the mgatv output, and then turn
> > it off again when no longer required..
> >
> > Is there something like this implimented already??  Or would the norm
> > just be to run 2 instances of vdr ont he one machine??
> >
> 
> The normal setup would be one vdr server and one or more vdr client
> connected via streamdev. But even this setup has some disadvanteges.
> There is _no_ way to get the OSD of the server :-( , except that someone
> writes the code for doing that. You like to do ?
> 
OK, I have not used softdevice output yet.  Would it be fair to say
that usual running of vdr with softdevice would be to have one
instance of vdr run to be able to capture from dvb with no display,
and then another vdr started and stopped as the display device; or has
softdevice been deveoped so as to be used on a dedicated set-top-box
type of application, so only ever one vdr running, with softdevice
always running??

As for would I like to do: yes, I would but i'm very limited for time
(yuck, i hate to say this, but my kids need me ;-)) and i havn't coded
in c for over 7 years.  Sorry tosay that although I would like to i
doubt I will...

Mick


From particle at luukku.com  Thu Jan  6 15:29:37 2005
From: particle at luukku.com (Ari Koponen)
Date: Thu, 06 Jan 2005 16:29:37 +0200
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <200501052211.39103.stefan@lucke.in-berlin.de>
References: <1104954030.2788.38.camel@localhost.localdomain>
	 <200501052211.39103.stefan@lucke.in-berlin.de>
Message-ID: <1105021777.3202.83.camel@localhost.localdomain>

> Turn deinterlace OFF. It is not needed in TV-out mode.

> > [dfb] RAM: 8388608 bytes
> 
> Only 8MB are reported, please use the matorx-full-memory patch from DirectFB.

Okay, these did the trick, it works with mode=720x576. Now the video
flows very well. Only problem seems to be that when there's motion the
video looks pretty crap. I don't know if this called tearing or what and
if it could be fixed by setting some directfb options. Maybe field
parity or something but with quick glance I couldn't find an option for
that in the directfbrc man-page.

> Why the 16 bit mode ? Something from your directfbrc ?
> But the number 0x00200806 should be ok as I posted on vdr list ;-) .

Well that's because I had commented the depth=32 line in directfbrc. I
thought that it would save some memory.

> > And last some information about my system:
> > 
> > - Graphics card: Matrox G450 Dualhead 16 Mb
> > - Kernel: 2.6.9 (vanilla)
> > - Softdevice and ffmpeg are from today's CVS
> > - Distro: FedoraCore 2
> 
> Whats the CPU type and speed ?

AMD Athlon XP 1700+ 

One more problem I had was that VDR found an RC unit and it accepted
only keyboard input. Next it asked to configure the keyboard. Then it
didn't accept the keyboard buttons anymore. I solved the problem by
compiling VDR without keyboard input possibility. My keyboard is
wireless and currently connected to ps/2 port but it can be connected to
USB port as well and maybe I'll try that if I have some time. But most
important, now I get the picture so thank you!

Few more questions about that RGB via VGA connector method described on
the softdevice homepage. Is that setup supposed to be used with
framebuffer output driver with softdevice? Are you using matroxset
program and perhaps how?

Did you use the VGA connector pinout from matrox to connect the VGA
connector cable?

http://forum.matrox.com/mga/viewtopic.php?t=4381

All other pins are clear to me but the pin 16 (blanking) on the scart
side of the schematic

http://www.sm.go.dlr.de/%7Ebob/scart/scart.gif

makes me wonder. Is it connected to the TTL vertical sync pin (14) on
the VGA connector? 

And one more question: Does anyone know if G450 can generate intercaled
signal and from which connectors? I read that G450 is a stripped version
of G400. 




From stefan at lucke.in-berlin.de  Thu Jan  6 16:12:19 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  6 Jan 2005 16:12:19 +0100
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1105021777.3202.83.camel@localhost.localdomain>
References: <1104954030.2788.38.camel@localhost.localdomain>  <200501052211.39103.stefan@lucke.in-berlin.de> <1105021777.3202.83.camel@localhost.localdomain>
Message-ID: <1105024339.41dd555373c2f@webmail.in-berlin.de>

Quoting Ari Koponen:

> 
> > Turn deinterlace OFF. It is not needed in TV-out mode.
> 
> > > [dfb] RAM: 8388608 bytes
> > 
> > Only 8MB are reported, please use the matorx-full-memory patch from
> DirectFB.
> 
> Okay, these did the trick, it works with mode=720x576. Now the video
> flows very well. Only problem seems to be that when there's motion the
> video looks pretty crap. I don't know if this called tearing or what and
> if it could be fixed by setting some directfb options. Maybe field
> parity or something but with quick glance I couldn't find an option for
> that in the directfbrc man-page.

Thats because the video must be scaled different. There is an OSD option
for changeing scaleing: "Pixel Aspect" and it should be set to "tv-out (PAL)" .

> 
> > Why the 16 bit mode ? Something from your directfbrc ?
> > But the number 0x00200806 should be ok as I posted on vdr list ;-) .
> 
> Well that's because I had commented the depth=32 line in directfbrc. I
> thought that it would save some memory.
> 
> > > And last some information about my system:
> > > 
> > > - Graphics card: Matrox G450 Dualhead 16 Mb
> > > - Kernel: 2.6.9 (vanilla)
> > > - Softdevice and ffmpeg are from today's CVS
> > > - Distro: FedoraCore 2
> > 
> > Whats the CPU type and speed ?
> 
> AMD Athlon XP 1700+ 

Should be enough.
Rest of your mail will be answered later when I'm back home.

Stefan Lucke


From torgeir at pobox.com  Thu Jan  6 18:45:47 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 06 Jan 2005 17:45:47 +0000
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501042137.28285.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de>
Message-ID: <1105033547.14000.7.camel@atlantis.netenviron.com>

On Tue, 2005-01-04 at 21:37 +0100, Stefan Lucke wrote:

>    - Changed A/V sync point by 4 frames. Sync is now ok for streams with PTS
>      value for each frame and for streams with PTS values for I-Frames only.

How did you decide on 4 frames? Is this per spec or just a value found
by experimenting? am asking because one of my channels don't have
perfect sync.

There's an issue with sync just when you're changing channel, maybe we
can "fix" this by remembering approximately the av sync offset from the
previous channel, and use that as the initial offset for the new
channel?

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Thu Jan  6 18:47:39 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 06 Jan 2005 17:47:39 +0000
Subject: [Softdevice-devel] softdevice question on/off
In-Reply-To: <b98c6b1a050106041793e8e08@mail.gmail.com>
References: <b98c6b1a050105171452369913@mail.gmail.com>
	 <200501060736.44335.stefan@lucke.in-berlin.de>
	 <b98c6b1a050106041793e8e08@mail.gmail.com>
Message-ID: <1105033660.14000.10.camel@atlantis.netenviron.com>

On Thu, 2005-01-06 at 20:17 +0800, mike lewis wrote:
> [...] or has
> softdevice been deveoped so as to be used on a dedicated set-top-box
> type of application, so only ever one vdr running, with softdevice
> always running??

This is how it works right now. It would be possible to have a display
toggle button that toggles the Xv output window and audio output
allowing other apps such as xine to temporarily run. We would need
better X11 error handling though, allowing the Xv output port allocation
to fail more gracefully.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Thu Jan  6 22:00:33 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 6 Jan 2005 22:00:33 +0100
Subject: [Softdevice-devel] softdevice question on/off
In-Reply-To: <1105033660.14000.10.camel@atlantis.netenviron.com>
References: <b98c6b1a050105171452369913@mail.gmail.com> <b98c6b1a050106041793e8e08@mail.gmail.com> <1105033660.14000.10.camel@atlantis.netenviron.com>
Message-ID: <200501062200.33911.stefan@lucke.in-berlin.de>

On Donnerstag, 6. Januar 2005 18:47, Torgeir Veimo wrote:
> On Thu, 2005-01-06 at 20:17 +0800, mike lewis wrote:
> > [...] or has
> > softdevice been deveoped so as to be used on a dedicated set-top-box
> > type of application, so only ever one vdr running, with softdevice
> > always running??
> 
> This is how it works right now. It would be possible to have a display
> toggle button that toggles the Xv output window and audio output
> allowing other apps such as xine to temporarily run. We would need
> better X11 error handling though, allowing the Xv output port allocation
> to fail more gracefully.

Usually cards have only one port for Xv. The only I know which has multiple
ports are matrox cards, when X11 is told at startup to use the texture engine
instead of the backend scaler. But unfortunately color keying does not work
in this mode, so OSD flickers painful. One advantage of using the texture unit
would be that it is possible to take normal screen shots, as scaled video
is written to video memory instead of doing overlay.
The texture unit is merly the same as DirectFB is using when softdevice is set
to strechblit mode where true alpha blending is possible.
But such things like alpha blending is unknown to Xfree :-( .
Oh we could use openGL to do such things.

Stefan Lucke



From stefan at lucke.in-berlin.de  Thu Jan  6 22:25:12 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 6 Jan 2005 22:25:12 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <1105033547.14000.7.camel@atlantis.netenviron.com>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <1105033547.14000.7.camel@atlantis.netenviron.com>
Message-ID: <200501062225.12054.stefan@lucke.in-berlin.de>

On Donnerstag, 6. Januar 2005 18:45, Torgeir Veimo wrote:
> On Tue, 2005-01-04 at 21:37 +0100, Stefan Lucke wrote:
> 
> >    - Changed A/V sync point by 4 frames. Sync is now ok for streams with PTS
> >      value for each frame and for streams with PTS values for I-Frames only.
> 
> How did you decide on 4 frames? Is this per spec or just a value found
> by experimenting?

Experimenting, tracing. Please have a look at the tracelogs a added to mpeg2decoder.c .
Formerly we took the video PTS to sync on, from the incoming stream where frames
are ordered in transport sequence and _not_ in display sequence. So when we take
the PTS from an incomeing I-frame we should use this PTS value only when we
get this I-frame from the decoder to display. You can see it in the snipped of 
sequence A :

*V(1) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(9)  CF2(9)
 V(0) NPTS(65785752) PPTS(65785272) P(1) P2(2) CF(10) CF2(7)
 V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(11) CF2(11)
 V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(12) CF2(12)
+V(0) NPTS(65785752) PPTS(65785272) P(2) P2(1) CF(13) CF2(10)

The line marked with '*' is the incoming I-frame -> rememer the PTS value and
the line marked with '+' is the I-frame we should display now P2 == 1 -> use
remember PTS value

> am asking because one of my channels don't have
> perfect sync.

Can you activate some tracing ? or make a short sequence that we could test this too.

> 
> There's an issue with sync just when you're changing channel, maybe we
> can "fix" this by remembering approximately the av sync offset from the
> previous channel, and use that as the initial offset for the new
> channel?

In the first few seconds there seems to be some kind of slow motion ?


Stefan Lucke



From torgeir at pobox.com  Thu Jan  6 22:50:15 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 06 Jan 2005 21:50:15 +0000
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501062225.12054.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de>
	 <1105033547.14000.7.camel@atlantis.netenviron.com>
	 <200501062225.12054.stefan@lucke.in-berlin.de>
Message-ID: <1105048216.14000.18.camel@atlantis.netenviron.com>

On Thu, 2005-01-06 at 22:25 +0100, Stefan Lucke wrote:
> 
> In the first few seconds there seems to be some kind of slow motion ?

Yes, I can see the video is being slowed down to let the audio catch up.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Thu Jan  6 22:51:55 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 6 Jan 2005 22:51:55 +0100
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1105021777.3202.83.camel@localhost.localdomain>
References: <1104954030.2788.38.camel@localhost.localdomain> <200501052211.39103.stefan@lucke.in-berlin.de> <1105021777.3202.83.camel@localhost.localdomain>
Message-ID: <200501062251.55678.stefan@lucke.in-berlin.de>

On Donnerstag, 6. Januar 2005 15:29, Ari Koponen wrote:

> One more problem I had was that VDR found an RC unit and it accepted
> only keyboard input. Next it asked to configure the keyboard. Then it
> didn't accept the keyboard buttons anymore. I solved the problem by
> compiling VDR without keyboard input possibility. My keyboard is
> wireless and currently connected to ps/2 port but it can be connected to
> USB port as well and maybe I'll try that if I have some time. But most
> important, now I get the picture so thank you!
> 
> Few more questions about that RGB via VGA connector method described on
> the softdevice homepage. Is that setup supposed to be used with
> framebuffer output driver with softdevice?

You can use it with FB-out or with directfb too :-), but then you have to comment
out "primary-layer=2" and output will go to thru your cards first head.

>Are you using matroxset
> program and perhaps how?

No didn't use that, just "fbset my-pal-32" .

> 
> Did you use the VGA connector pinout from matrox to connect the VGA
> connector cable?

No, I took just normal VGA->BNC cable, with 5 BNC connectors (4 connectors used).

> 
> http://forum.matrox.com/mga/viewtopic.php?t=4381
> 
> All other pins are clear to me but the pin 16 (blanking) on the scart
> side of the schematic
> 
> http://www.sm.go.dlr.de/%7Ebob/scart/scart.gif
> 
> makes me wonder. Is it connected to the TTL vertical sync pin (14) on
> the VGA connector? 

No the H-sync line from BNC cable (see above), as shown in schematic.
I didn't solder the vga plug myself :-( .

> 
> And one more question: Does anyone know if G450 can generate intercaled
> signal and from which connectors? I read that G450 is a stripped version
> of G400.

Don't know if there is a difference in generating a combined sync on the h-sync
line between G400 and G450. Just try it from console mode. If you don't
get a stable console picture on TV within 2 seconds, disconnect tv to avoid
any damage.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Thu Jan  6 22:54:49 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 6 Jan 2005 22:54:49 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <1105048216.14000.18.camel@atlantis.netenviron.com>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <200501062225.12054.stefan@lucke.in-berlin.de> <1105048216.14000.18.camel@atlantis.netenviron.com>
Message-ID: <200501062254.49141.stefan@lucke.in-berlin.de>

On Donnerstag, 6. Januar 2005 22:50, Torgeir Veimo wrote:
> On Thu, 2005-01-06 at 22:25 +0100, Stefan Lucke wrote:
> > 
> > In the first few seconds there seems to be some kind of slow motion ?
> 
> Yes, I can see the video is being slowed down to let the audio catch up.

So perhaps we should delay the 1st or 2nd frame upon a well experienced value.

-- 
Stefan Lucke



From noreply at berlios.de  Thu Jan  6 23:10:12 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Thu, 6 Jan 2005 23:10:12 +0100 (CET)
Subject: [Softdevice-devel] [Patch #272] Matrox TV-out with Hardware OSD
Message-ID: <200501062210.j06MACpv015589@unicorn.berlios.de>

Patch #272 has been updated. 

Project: softdevice
Category: None
Status: Rejected
Submitted by: anaouman
Assigned to : none
Summary: Matrox TV-out with Hardware OSD

Follow-Ups:

Date: 2005-Jan-06 23:10
By: lucke

Comment:
I'll close this as rejected, as this patch is unaccessable. The idea behind it, is more like postponed.
-------------------------------------------------------

Date: 2004-Dec-19 16:35
By: lucke

Comment:
I cannot access this. My mail sent to you, got the error message: user unknown :-)
-------------------------------------------------------

-------------------------------------------------------
For more info, visit:

http://developer.berlios.de/patch/?func=detailpatch&patch_id=272&group_id=2051


From lachlanlewis at gmail.com  Fri Jan  7 02:38:23 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Fri, 7 Jan 2005 09:38:23 +0800
Subject: [Softdevice-devel] softdevice question on/off
In-Reply-To: <200501062200.33911.stefan@lucke.in-berlin.de>
References: <b98c6b1a050105171452369913@mail.gmail.com>
	 <b98c6b1a050106041793e8e08@mail.gmail.com>
	 <1105033660.14000.10.camel@atlantis.netenviron.com>
	 <200501062200.33911.stefan@lucke.in-berlin.de>
Message-ID: <b98c6b1a05010617384bd34e9b@mail.gmail.com>

> Usually cards have only one port for Xv. The only I know which has multiple
> ports are matrox cards, when X11 is told at startup to use the texture engine
> instead of the backend scaler. But unfortunately color keying does not work
> in this mode, so OSD flickers painful. One advantage of using the texture unit
> would be that it is possible to take normal screen shots, as scaled video
> is written to video memory instead of doing overlay.
> The texture unit is merly the same as DirectFB is using when softdevice is set
> to strechblit mode where true alpha blending is possible.
> But such things like alpha blending is unknown to Xfree :-( .
> Oh we could use openGL to do such things.
>
Would it be possible in directfb?

Mick


From olangu at hotmail.com  Fri Jan  7 14:03:19 2005
From: olangu at hotmail.com (Andreas Gustafsson)
Date: Fri, 07 Jan 2005 13:03:19 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefined symbol: dts_frame
Message-ID: <BAY16-F32082F430BB98ED7BE38BFD1940@phx.gbl>

Hi!
As a owner of a 'budget card' im desperatly trying to get your vdr-plugin 
work on my box.

It compiles nice and without any complaints.
But when I try to run it I get: "undefined symbol: dts_frame"

Any ideas what can cause this and how to fix it?

Thanks!
Andreas Gustafsson

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/



From torgeir at pobox.com  Fri Jan  7 14:09:31 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 07 Jan 2005 13:09:31 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefined symbol:
	dts_frame
In-Reply-To: <BAY16-F32082F430BB98ED7BE38BFD1940@phx.gbl>
References: <BAY16-F32082F430BB98ED7BE38BFD1940@phx.gbl>
Message-ID: <1105103371.14000.72.camel@atlantis.netenviron.com>

On Fri, 2005-01-07 at 13:03 +0000, Andreas Gustafsson wrote:
> Hi!
> As a owner of a 'budget card' im desperatly trying to get your vdr-plugin 
> work on my box.
> 
> It compiles nice and without any complaints.
> But when I try to run it I get: "undefined symbol: dts_frame"
> 
> Any ideas what can cause this and how to fix it?

This doesn't seem to be related to softdevice. Have you build liba52
with some experimental support for DTS decoding? Try a grep
dts_frame /usr/local/lib* or /usr/lib/lib* to see where this symbol is
requested.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Fri Jan  7 14:11:14 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri,  7 Jan 2005 14:11:14 +0100
Subject: [Softdevice-devel] Problem with softdevice, undefined symbol: dts_frame
In-Reply-To: <BAY16-F32082F430BB98ED7BE38BFD1940@phx.gbl>
References: <BAY16-F32082F430BB98ED7BE38BFD1940@phx.gbl>
Message-ID: <1105103474.41de8a726734f@webmail.in-berlin.de>

Quoting Andreas Gustafsson:

> Hi!
> As a owner of a 'budget card' im desperatly trying to get your vdr-plugin 
> work on my box.
> 
> It compiles nice and without any complaints.
> But when I try to run it I get: "undefined symbol: dts_frame"

Would be nice to have some more information:
which vdr version ?
which plugins where loaded ?
startup log from vdr .

Stefan Lucke


From olangu at hotmail.com  Fri Jan  7 17:21:47 2005
From: olangu at hotmail.com (Andreas Gustafsson)
Date: Fri, 07 Jan 2005 16:21:47 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefined symbol:dts_frame
In-Reply-To: <1105103371.14000.72.camel@atlantis.netenviron.com>
Message-ID: <BAY16-F23AFBE6F87B728F7E3A82ED1940@phx.gbl>

>On Fri, 2005-01-07 at 13:03 +0000, Andreas Gustafsson wrote:
> > Hi!
> > As a owner of a 'budget card' im desperatly trying to get your 
>vdr-plugin
> > work on my box.
> >
> > It compiles nice and without any complaints.
> > But when I try to run it I get: "undefined symbol: dts_frame"
> >
> > Any ideas what can cause this and how to fix it?
>
>This doesn't seem to be related to softdevice. Have you build liba52
>with some experimental support for DTS decoding? Try a grep
>dts_frame /usr/local/lib* or /usr/lib/lib* to see where this symbol is
>requested.
>
>--
>Torgeir Veimo <torgeir at pobox.com>
>

Thanks for the help.
Seem like there was problem with the debian package of libavcodec.
Now Ive compiled my own and you plugin works.

But there are some strange things I cant really understand, they are 
vdr-related but Ill ask here anyway.

When running vdr without the option -d the program gets in some kind of loop 
and reasks for keyconfig again and again.
When running in -d mode it works, but it says channel not avalible all the 
time. I know i dont have the best signal. But I can get somethings to show 
with dvbstream and mplayer. So why does not vdr work?

What kind of signal strenght do one need?
I get;
status 1f | signal 3030 | snr abab | ber 00009431 | unc 000000a3 | 
FE_HAS_LOCK
in tzap.

Thanks in advance.
Andreas Gustafsson

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/



From torgeir at pobox.com  Fri Jan  7 18:39:49 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 07 Jan 2005 17:39:49 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefined
	symbol:dts_frame
In-Reply-To: <BAY16-F23AFBE6F87B728F7E3A82ED1940@phx.gbl>
References: <BAY16-F23AFBE6F87B728F7E3A82ED1940@phx.gbl>
Message-ID: <1105119589.6386.2.camel@vigor10>

On Fri, 2005-01-07 at 16:21 +0000, Andreas Gustafsson wrote:
> When running vdr without the option -d the program gets in some kind of loop 
> and reasks for keyconfig again and again.

You can disable the normal keyboard input by using make NO_KDB=1 .
Softdevice has it's own keyboard input through X11, if you're running
softdevice with X11.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Fri Jan  7 18:41:11 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 07 Jan 2005 17:41:11 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefined
	symbol:dts_frame
In-Reply-To: <BAY16-F23AFBE6F87B728F7E3A82ED1940@phx.gbl>
References: <BAY16-F23AFBE6F87B728F7E3A82ED1940@phx.gbl>
Message-ID: <1105119671.6386.5.camel@vigor10>

On Fri, 2005-01-07 at 16:21 +0000, Andreas Gustafsson wrote:
> When running in -d mode it works, but it says channel not avalible all the 
> time. I know i dont have the best signal. But I can get somethings to show 
> with dvbstream and mplayer. So why does not vdr work?

Is this vdr version 1.3.17? That version has some nasty threading bugs;
I'd suggest either using 1.3.16 (I use this one), or wait for 1.3.18
that will prob be released on sunday.

-- 
Torgeir Veimo <torgeir at pobox.com>



From olangu at hotmail.com  Fri Jan  7 19:28:39 2005
From: olangu at hotmail.com (Andreas Gustafsson)
Date: Fri, 07 Jan 2005 18:28:39 +0000
Subject: [Softdevice-devel] Problem with softdevice, undefinedsymbol:dts_frame
In-Reply-To: <1105119671.6386.5.camel@vigor10>
Message-ID: <BAY16-F12E53F3732F9C12C92263AD1940@phx.gbl>

>
>On Fri, 2005-01-07 at 16:21 +0000, Andreas Gustafsson wrote:
> > When running in -d mode it works, but it says channel not avalible all 
>the
> > time. I know i dont have the best signal. But I can get somethings to 
>show
> > with dvbstream and mplayer. So why does not vdr work?
>
>Is this vdr version 1.3.17? That version has some nasty threading bugs;
>I'd suggest either using 1.3.16 (I use this one), or wait for 1.3.18
>that will prob be released on sunday.
>
>--
>Torgeir Veimo <torgeir at pobox.com>
>

I was using a very old vdr, the stable release on their homepage.
When i switched to 1.3.16 the keyboard-prolems dissapered, but i still get 
no picture.

Andreas Gustafsson

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/



From torgeir at pobox.com  Fri Jan  7 20:51:44 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 07 Jan 2005 19:51:44 +0000
Subject: [Softdevice-devel] Problem with softdevice,
	undefinedsymbol:dts_frame
In-Reply-To: <BAY16-F12E53F3732F9C12C92263AD1940@phx.gbl>
References: <BAY16-F12E53F3732F9C12C92263AD1940@phx.gbl>
Message-ID: <1105127504.14000.80.camel@atlantis.netenviron.com>

On Fri, 2005-01-07 at 18:28 +0000, Andreas Gustafsson wrote:
> >
> >On Fri, 2005-01-07 at 16:21 +0000, Andreas Gustafsson wrote:
> > > When running in -d mode it works, but it says channel not avalible all 
> >the
> > > time. I know i dont have the best signal. But I can get somethings to 
> >show
> > > with dvbstream and mplayer. So why does not vdr work?
> >
> >Is this vdr version 1.3.17? That version has some nasty threading bugs;
> >I'd suggest either using 1.3.16 (I use this one), or wait for 1.3.18
> >that will prob be released on sunday.

Where are you outputting? Xv? Which graphis hardware & X server software
are you using?

-- 
Torgeir Veimo <torgeir at pobox.com>



From olangu at hotmail.com  Fri Jan  7 21:48:07 2005
From: olangu at hotmail.com (Andreas Gustafsson)
Date: Fri, 07 Jan 2005 20:48:07 +0000
Subject: [Softdevice-devel] Problem with softdevice,undefinedsymbol:dts_frame
In-Reply-To: <1105127504.14000.80.camel@atlantis.netenviron.com>
Message-ID: <BAY16-F315EE688A5BF66BAA78386D1940@phx.gbl>

>
>On Fri, 2005-01-07 at 18:28 +0000, Andreas Gustafsson wrote:
> > >
> > >On Fri, 2005-01-07 at 16:21 +0000, Andreas Gustafsson wrote:
> > > > When running in -d mode it works, but it says channel not avalible 
>all
> > >the
> > > > time. I know i dont have the best signal. But I can get somethings 
>to
> > >show
> > > > with dvbstream and mplayer. So why does not vdr work?
> > >
> > >Is this vdr version 1.3.17? That version has some nasty threading bugs;
> > >I'd suggest either using 1.3.16 (I use this one), or wait for 1.3.18
> > >that will prob be released on sunday.
>
>Where are you outputting? Xv? Which graphis hardware & X server software
>are you using?
>
>--
>Torgeir Veimo <torgeir at pobox.com>

Im outputting in xv using a tnt2-card at the moment. With the nv driver that 
comes with the xserver. Using xserver-xfree86.
Might it be problems with the xvideo on my card perhaps?

Andreas Gustafsson

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/



From rupertt at gmail.com  Fri Jan  7 22:58:47 2005
From: rupertt at gmail.com (rupert t)
Date: Fri, 07 Jan 2005 22:58:47 +0100
Subject: [Softdevice-devel] crash on channels with 5.1
Message-ID: <1105135127.6803.25.camel@localhost.localdomain>

Hi,
i run the softdevice on a matrox g450.
All channels run fine, but when I watch a movie with DD 5.1(Pro7 20.15
movie) stream there are often lags and after a while vdr crashes.
Maybe there goes something wrong in demuxing it into analog for alsa.
I cant find the right logoutput, will sent this later.
Are other people have this problem too?


Stefan already said the wanna get 5.1 output,
would it be hard to direct the uncodemuxed stream to alsa?


thx



From torgeir at pobox.com  Sat Jan  8 03:06:09 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 08 Jan 2005 02:06:09 +0000
Subject: [Softdevice-devel] Problem with
	softdevice,undefinedsymbol:dts_frame
In-Reply-To: <BAY16-F315EE688A5BF66BAA78386D1940@phx.gbl>
References: <BAY16-F315EE688A5BF66BAA78386D1940@phx.gbl>
Message-ID: <1105149969.14000.82.camel@atlantis.netenviron.com>

On Fri, 2005-01-07 at 20:48 +0000, Andreas Gustafsson wrote:
> 
> Im outputting in xv using a tnt2-card at the moment. With the nv
> driver that 
> comes with the xserver. Using xserver-xfree86.
> Might it be problems with the xvideo on my card perhaps?

Might be. You you receive dvbt- tramsmissions using xawtv or nixe with
via dvb input?

-- 
Torgeir Veimo <torgeir at pobox.com>



From andreas.schaefer at rwth-aachen.de  Fri Jan  7 23:22:45 2005
From: andreas.schaefer at rwth-aachen.de (Andreas Schaefer)
Date: Fri, 07 Jan 2005 23:22:45 +0100
Subject: [Softdevice-devel] crash on channels with 5.1
In-Reply-To: <1105135127.6803.25.camel@localhost.localdomain>
References: <1105135127.6803.25.camel@localhost.localdomain>
Message-ID: <opsj8637pjv2n8hf@relay.rwth-aachen.de>

On Fri, 07 Jan 2005 22:58:47 +0100, rupert t <rupertt at gmail.com> wrote:

> All channels run fine, but when I watch a movie with DD 5.1(Pro7 20.15
> movie) stream there are often lags and after a while vdr crashes.
> Maybe there goes something wrong in demuxing it into analog for alsa.

It seems to me the crash is caused by bad signal quality. The same error  
occoured using a slower cpu and bad receiving conditions without ac3.  
Upgrading to a faster cpu softdevice crashes with same behavior using ac3,  
but only on bad transponders such as Pro7. Maybe the error correction is  
on the edge?

> Are other people have this problem too?

Yes me, and a friend of mine.

Greetings,
Andreas



From M.Wache at gmx.net  Sat Jan  8 16:04:12 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 08 Jan 2005 16:04:12 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work with softdevice)
Message-ID: <41DFF66C.50704@gmx.net>

Hi all,

I finished a small patch which adds support of raw PCM audio codec to 
the softdevice. The way I implemented this is not the cleanest way, but 
the easiest way: The raw audio stream is sent to the AudioStreamDecoder, 
and I added a small class which parses the PCM header and extracts the 
audio data.
The way I would prefer to do it, would be to switch the whole parsing of 
the PES stream to libavformat (which is provided by ffmpeg), and use the 
AVPacket to send the audio and video streams to the appropriate decoder. 
This way we would be prepared to handle all the codecs libavcodec can 
handle (including mp2, raw PCM, ac3 and many others and maybe other 
video codecs as well?? We could easily replay .avi files with vdr, we 
would just need an additional cPlayer...). We could also get rid of the 
double parsing of the PES headers in the mpeg decoder, and have instead 
the well tested ffmpeg parser. But that would mean to almost completly 
rewrite mpegdecoder.c. I hope to find the time to do this in a not too 
far future...
Anyway, for now I would like to ask you to try out this patch, and if 
there are no complaints or objections I will commit this patch in a few 
days.

Bye,
Martin
Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dvd.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050108/1c967aae/attachment.ksh>

From stefan at lucke.in-berlin.de  Sun Jan  9 10:17:22 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 9 Jan 2005 10:17:22 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work with softdevice)
In-Reply-To: <41DFF66C.50704@gmx.net>
References: <41DFF66C.50704@gmx.net>
Message-ID: <200501091017.22282.stefan@lucke.in-berlin.de>

On Samstag, 8. Januar 2005 16:04, Martin Wache wrote:
> Hi all,
> 
> I finished a small patch which adds support of raw PCM audio codec to 
> the softdevice. The way I implemented this is not the cleanest way, but 
> the easiest way: The raw audio stream is sent to the AudioStreamDecoder, 
> and I added a small class which parses the PCM header and extracts the 
> audio data.

Stream id 0x01bd (private stream) is used for ac3 too. But we get the ac3
via PlayAudio ( .. ) .

> The way I would prefer to do it, would be to switch the whole parsing of 
> the PES stream to libavformat (which is provided by ffmpeg), and use the 
> AVPacket to send the audio and video streams to the appropriate decoder. 
> This way we would be prepared to handle all the codecs libavcodec can 
> handle (including mp2, raw PCM, ac3 and many others and maybe other 
> video codecs as well??

Yes :-)) .

> We could easily replay .avi files with vdr, we 
> would just need an additional cPlayer...). 

That should be the way to go. Hopefully this could be done without patching
vdr. Normal cDevice has to method of specifying different output formats.

> We could also get rid of the 
> double parsing of the PES headers in the mpeg decoder, and have instead 
> the well tested ffmpeg parser. But that would mean to almost completly 
> rewrite mpegdecoder.c. I hope to find the time to do this in a not too 
> far future...

So I'll hope that too :-). 

> Anyway, for now I would like to ask you to try out this patch, and if 
> there are no complaints or objections I will commit this patch in a few 
> days.

I tested this with vdr-1.3.17. Just with two different dvds. Xv-out method.

- Contact
	aspect ratio ok, sound complete out of sync,
	video jerky (as no one throttles us).

- Herr der Ringe, die zwei T?rme
	aspect ratio wrong (shown as 4:3 within my 1024x768 window),
	sound out of sync, video jerky (as no one throttles us).

The first time I tried it, I had an error accessing my dvd device. After
returning to tv live mode there was a terrible sound: beeps, zirps and wistles.
This happend only once and I don't know how to reproduce this.

-- 
Stefan Lucke



From olangu at hotmail.com  Sun Jan  9 16:50:48 2005
From: olangu at hotmail.com (Andreas Gustafsson)
Date: Sun, 09 Jan 2005 15:50:48 +0000
Subject: [Softdevice-devel] Problem withsoftdevice,undefinedsymbol:dts_frame
In-Reply-To: <1105149969.14000.82.camel@atlantis.netenviron.com>
Message-ID: <BAY16-F375108F2E251E8F1B0DFCBD1960@phx.gbl>

>
>On Fri, 2005-01-07 at 20:48 +0000, Andreas Gustafsson wrote:
> >
> > Im outputting in xv using a tnt2-card at the moment. With the nv
> > driver that
> > comes with the xserver. Using xserver-xfree86.
> > Might it be problems with the xvideo on my card perhaps?
>
>Might be. You you receive dvbt- tramsmissions using xawtv or nixe with
>via dvb input?
>
>--
>Torgeir Veimo <torgeir at pobox.com>

Apparently there was errors in my channels.conf-file.
Now I got everything up and running.
But my cpu was too slow =(

Thanks for all the help.

Andreas Gustafsson

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.click-url.com/go/onm00200471ave/direct/01/



From stefan at lucke.in-berlin.de  Sun Jan  9 18:10:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 9 Jan 2005 18:10:07 +0100
Subject: [Softdevice-devel] [PATCH] vdr-1.3.18 softdevice plugin
Message-ID: <200501091810.07110.stefan@lucke.in-berlin.de>

Hi,

attached diff is a hot-fix for running softdevice with vdr-1.3.18.
Diff is for softdevice-0.0.8 (cvs version) and not yet in cvs.

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: softdevice-cvs-4-vdr-1.3.18.diff
Type: text/x-diff
Size: 1464 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050109/179b8e8a/attachment.diff>

From M.Wache at gmx.net  Mon Jan 10 17:40:50 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 10 Jan 2005 17:40:50 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
 with softdevice)
In-Reply-To: <200501091017.22282.stefan@lucke.in-berlin.de>
References: <41DFF66C.50704@gmx.net> <200501091017.22282.stefan@lucke.in-berlin.de>
Message-ID: <41E2B012.9040504@gmx.net>

Stefan Lucke wrote:

> Stream id 0x01bd (private stream) is used for ac3 too. But we get the ac3
> via PlayAudio ( .. ) .
Not if we recieve data from the dvd-plugin, the dvd-plugin sends data 
directly to the primary device.

>>We could easily replay .avi files with vdr, we 
>>would just need an additional cPlayer...). 
> 
> 
> That should be the way to go. Hopefully this could be done without patching
> vdr. Normal cDevice has to method of specifying different output formats.
But that doesn't mean that the softdevice can't have a method to switch 
formats ;-). I have not checked everything, but I'm pretty sure that we 
won't need to patch vdr...

> I tested this with vdr-1.3.17. Just with two different dvds. Xv-out method.
> 
> - Contact
> 	aspect ratio ok, sound complete out of sync,
> 	video jerky (as no one throttles us).
> 
> - Herr der Ringe, die zwei T?rme
> 	aspect ratio wrong (shown as 4:3 within my 1024x768 window),
> 	sound out of sync, video jerky (as no one throttles us).
That sounds like the softdevice doesn't get video or audio PTS... Hm 
that's strange, for me it is working with all my dvds...
Apart from not beeing in sync with the video,is the sound okay? I guess 
you are useing the latest version of the dvd-plugin?

Is there somebody else who tried the patch?

Thank you very much,
Martin


From stefan at lucke.in-berlin.de  Mon Jan 10 21:20:23 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 10 Jan 2005 21:20:23 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work with softdevice)
In-Reply-To: <41E2B012.9040504@gmx.net>
References: <41DFF66C.50704@gmx.net> <200501091017.22282.stefan@lucke.in-berlin.de> <41E2B012.9040504@gmx.net>
Message-ID: <200501102120.24019.stefan@lucke.in-berlin.de>

On Montag, 10. Januar 2005 17:40, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > Stream id 0x01bd (private stream) is used for ac3 too. But we get the ac3
> > via PlayAudio ( .. ) .
> Not if we recieve data from the dvd-plugin, the dvd-plugin sends data 
> directly to the primary device.
> 
> >>We could easily replay .avi files with vdr, we 
> >>would just need an additional cPlayer...). 
> > 
> > 
> > That should be the way to go. Hopefully this could be done without patching
> > vdr. Normal cDevice has to method of specifying different output formats.
> But that doesn't mean that the softdevice can't have a method to switch 
> formats ;-). I have not checked everything, but I'm pretty sure that we 
> won't need to patch vdr...
> 
> > I tested this with vdr-1.3.17. Just with two different dvds. Xv-out method.
> > 
> > - Contact
> > 	aspect ratio ok, sound complete out of sync,
> > 	video jerky (as no one throttles us).

I'll do some traces. So after traceing this, there was a large offset
offset = aPTS - pts; it starts with 12000 and went down to 7300.
After changeing the language via OSD, A/V was in sync ;-) for all
languages (german, english, spain) .

> > 
> > - Herr der Ringe, die zwei T?rme
> > 	aspect ratio wrong (shown as 4:3 within my 1024x768 window),
> > 	sound out of sync, video jerky (as no one throttles us).

With this DVD I have to re-test, Contact was complete out of sync.
So now it seems to be ok.

> That sounds like the softdevice doesn't get video or audio PTS... Hm 
> that's strange, for me it is working with all my dvds...
> Apart from not beeing in sync with the video,is the sound okay? I guess 
> you are useing the latest version of the dvd-plugin?

I use dvd-0.3.5b06 , should I switch to cvs version ?


-- 
Stefan Lucke



From particle at luukku.com  Tue Jan 11 20:59:51 2005
From: particle at luukku.com (Ari Koponen)
Date: Tue, 11 Jan 2005 21:59:51 +0200
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1105024339.41dd555373c2f@webmail.in-berlin.de>
References: <1104954030.2788.38.camel@localhost.localdomain>
	 <200501052211.39103.stefan@lucke.in-berlin.de>
	 <1105021777.3202.83.camel@localhost.localdomain>
	 <1105024339.41dd555373c2f@webmail.in-berlin.de>
Message-ID: <1105473591.24494.29.camel@localhost.localdomain>

> > Okay, these did the trick, it works with mode=720x576. Now the video
> > flows very well. Only problem seems to be that when there's motion the
> > video looks pretty crap. I don't know if this called tearing or what and
> > if it could be fixed by setting some directfb options. Maybe field
> > parity or something but with quick glance I couldn't find an option for
> > that in the directfbrc man-page.
> 
> Thats because the video must be scaled different. There is an OSD option
> for changeing scaleing: "Pixel Aspect" and it should be set to "tv-out (PAL)" .

Sorry for the late reply. That doesn't seem to have any effect. If I
switch some deinterlacer on then the video plays smoothly. This is not
just softdevice issue because this happens also with mplayer if I play
these vdr recordings with it. I noticed that Tony Houghton had similar
issues with softdevice on the VDR mailinglist today.



From stefan at lucke.in-berlin.de  Tue Jan 11 23:05:52 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 11 Jan 2005 23:05:52 +0100
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1105473591.24494.29.camel@localhost.localdomain>
References: <1104954030.2788.38.camel@localhost.localdomain> <1105024339.41dd555373c2f@webmail.in-berlin.de> <1105473591.24494.29.camel@localhost.localdomain>
Message-ID: <200501112305.52515.stefan@lucke.in-berlin.de>

On Dienstag, 11. Januar 2005 20:59, Ari Koponen wrote:

> Sorry for the late reply. That doesn't seem to have any effect. If I
> switch some deinterlacer on then the video plays smoothly. This is not
> just softdevice issue because this happens also with mplayer if I play
> these vdr recordings with it. I noticed that Tony Houghton had similar
> issues with softdevice on the VDR mailinglist today.

Can you try attached diff, which should enable field parity TOP ?

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb-field-parity.diff
Type: text/x-diff
Size: 332 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050111/61530dea/attachment.diff>

From particle at luukku.com  Wed Jan 12 09:07:32 2005
From: particle at luukku.com (Ari Koponen)
Date: Wed, 12 Jan 2005 10:07:32 +0200
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <200501112305.52515.stefan@lucke.in-berlin.de>
References: <1104954030.2788.38.camel@localhost.localdomain>
	 <1105024339.41dd555373c2f@webmail.in-berlin.de>
	 <1105473591.24494.29.camel@localhost.localdomain>
	 <200501112305.52515.stefan@lucke.in-berlin.de>
Message-ID: <1105517252.5504.5.camel@localhost.localdomain>

ke, 2005-01-12 kello 00:05, Stefan Lucke kirjoitti:
> On Dienstag, 11. Januar 2005 20:59, Ari Koponen wrote:
> 
> > Sorry for the late reply. That doesn't seem to have any effect. If I
> > switch some deinterlacer on then the video plays smoothly. This is not
> > just softdevice issue because this happens also with mplayer if I play
> > these vdr recordings with it. I noticed that Tony Houghton had similar
> > issues with softdevice on the VDR mailinglist today.
> 
> Can you try attached diff, which should enable field parity TOP ?

I'm afraid this didn't solve my problem either. It seems that the
interlaced picture is sometimes ok but most of the time not. 



From rupertt at gmail.com  Wed Jan 12 16:31:04 2005
From: rupertt at gmail.com (rupert t)
Date: Wed, 12 Jan 2005 16:31:04 +0100
Subject: [Softdevice-devel] [PATCH] vdr-1.3.18 softdevice plugin
In-Reply-To: <200501091810.07110.stefan@lucke.in-berlin.de>
References: <200501091810.07110.stefan@lucke.in-berlin.de>
Message-ID: <1105543864.6374.6.camel@localhost.localdomain>

Am Sonntag, den 09.01.2005, 18:10 +0100 schrieb Stefan Lucke:
> Hi,
> 
> attached diff is a hot-fix for running softdevice with vdr-1.3.18.
> Diff is for softdevice-0.0.8 (cvs version) and not yet in cvs.
> 
are these patches in cvs now.

I had this error while compiling, but it runs trough.

mpeg2decoder.c: In Memberfunktion ?virtual int
   cAudioStreamDecoder::DecodeData(uchar*, int)?:
mpeg2decoder.c:327: Warnung: unused variable `int delay'

CVS from 4.15 PM today.

When it works, maybe i test the RAW PCM patch.

greets



From torgeir at pobox.com  Wed Jan 12 18:13:22 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 12 Jan 2005 17:13:22 +0000
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
	with softdevice)
In-Reply-To: <41E2B012.9040504@gmx.net>
References: <41DFF66C.50704@gmx.net>
	 <200501091017.22282.stefan@lucke.in-berlin.de>  <41E2B012.9040504@gmx.net>
Message-ID: <1105550002.5791.16.camel@atlantis.netenviron.com>

On Mon, 2005-01-10 at 17:40 +0100, Martin Wache wrote:
> Is there somebody else who tried the patch?

Do you have an updated patch relative to the quickfix patch for running
softdevice under vdr 1.3.18?

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Wed Jan 12 19:46:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 12 Jan 2005 19:46:26 +0100
Subject: [Softdevice-devel] [PATCH] vdr-1.3.18 softdevice plugin
In-Reply-To: <1105543864.6374.6.camel@localhost.localdomain>
References: <200501091810.07110.stefan@lucke.in-berlin.de> <1105543864.6374.6.camel@localhost.localdomain>
Message-ID: <200501121946.26494.stefan@lucke.in-berlin.de>

On Mittwoch, 12. Januar 2005 16:31, rupert t wrote:
> Am Sonntag, den 09.01.2005, 18:10 +0100 schrieb Stefan Lucke:
> > Hi,
> > 
> > attached diff is a hot-fix for running softdevice with vdr-1.3.18.
> > Diff is for softdevice-0.0.8 (cvs version) and not yet in cvs.
> > 
> are these patches in cvs now.

Still not yet as this may influence Martins work on dvd-plugin support

> 
> I had this error while compiling, but it runs trough.
> 
> mpeg2decoder.c: In Memberfunktion ?virtual int
>    cAudioStreamDecoder::DecodeData(uchar*, int)?:
> mpeg2decoder.c:327: Warnung: unused variable `int delay'

Thats only a warning and may be ignored.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Wed Jan 12 19:53:31 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 12 Jan 2005 19:53:31 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work with softdevice)
In-Reply-To: <1105550002.5791.16.camel@atlantis.netenviron.com>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net> <1105550002.5791.16.camel@atlantis.netenviron.com>
Message-ID: <200501121953.31017.stefan@lucke.in-berlin.de>

On Mittwoch, 12. Januar 2005 18:13, Torgeir Veimo wrote:
> On Mon, 2005-01-10 at 17:40 +0100, Martin Wache wrote:
> > Is there somebody else who tried the patch?
> 
> Do you have an updated patch relative to the quickfix patch for running
> softdevice under vdr 1.3.18?

As the dvd-plugin has his own modified version with vdr-1.3.18 support in cvs,
Martin should decide how to proceed. Haven't tested that combination.

To my opinion it would be best to focus on vdr-1.3.18 with dvd-plugin from cvs,
and I don't belive we could support all new features with all vdr version (1.2.x).

-- 
Stefan Lucke



From jarppa81 at luukku.com  Wed Jan 12 21:09:23 2005
From: jarppa81 at luukku.com (Jari H)
Date: Wed, 12 Jan 2005 22:09:23 +0200 (EET)
Subject: [Softdevice-devel] problems with mgatv
Message-ID: <1105560563757.jarppa81.736.oLJlZGY0i1kfdB-YtDVDFg@luukku.com>

>> Can you try attached diff, which should enable field parity TOP ?

>I'm afraid this didn't solve my problem either. It seems that the
>interlaced picture is sometimes ok but most of the time not. 

I have same problem becouse somehow softdevice wont use interrupt.

You can check it yourself: cat /proc/interrupts


..............................................................
 MTV3 Laajakaista - Hauskemman el?m?n puolesta.
 http://www.mtv3.fi/liittyma/hankinta/laajakaista/



From M.Wache at gmx.net  Thu Jan 13 09:57:51 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 13 Jan 2005 09:57:51 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
 with softdevice)
In-Reply-To: <200501121953.31017.stefan@lucke.in-berlin.de>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net> <1105550002.5791.16.camel@atlantis.netenviron.com> <200501121953.31017.stefan@lucke.in-berlin.de>
Message-ID: <41E6380F.1020301@gmx.net>

Stefan Lucke wrote:
> On Mittwoch, 12. Januar 2005 18:13, Torgeir Veimo wrote:
> 
>>On Mon, 2005-01-10 at 17:40 +0100, Martin Wache wrote:
>>
>>>Is there somebody else who tried the patch?
>>
>>Do you have an updated patch relative to the quickfix patch for running
>>softdevice under vdr 1.3.18?
> 
> 
> As the dvd-plugin has his own modified version with vdr-1.3.18 support in cvs,
> Martin should decide how to proceed. Haven't tested that combination.
> 
> To my opinion it would be best to focus on vdr-1.3.18 with dvd-plugin from cvs,
> and I don't belive we could support all new features with all vdr version (1.2.x).

I'm sorry that I'm answering so late... I'm also working on a different 
patch, I still have some unfinished patches around which I want to 
finish bevore I start to work on the inclusion of libavformat for the 
parsing.
I think we should not delay the development of the softdevice for a 
working dvd-plugin, so lets make the softdevice compatible with 
vdr-1.3.18 and than look for the dvd-plugin. And I also think we should 
not put too much work into the patch I send around, it will be obsolete 
anyway if we move to parsing with libavformat... I just proposed to 
include it into cvs because it was working without any problems for me, 
and I didn't expect that there will be problems. Ah yes, and I found a 
small bug in the calculation of the audio pts, it still uses a fixed 
bitrate and number of channels, I will fix this in the cvs this 
afternoon. So maybe this is the reason for the problems with the sync...

So if it is not too much trouble you can still try the patch, I'm 
curious if it is working for someone else without problems, but don't 
spend too much time with it if its not working...

Martin



From torgeir at pobox.com  Thu Jan 13 17:01:13 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 13 Jan 2005 16:01:13 +0000
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
	with softdevice)
In-Reply-To: <41E6380F.1020301@gmx.net>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net>
	 <1105550002.5791.16.camel@atlantis.netenviron.com>
	 <200501121953.31017.stefan@lucke.in-berlin.de>  <41E6380F.1020301@gmx.net>
Message-ID: <1105632074.3411.25.camel@atlantis.netenviron.com>

On Thu, 2005-01-13 at 09:57 +0100, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Mittwoch, 12. Januar 2005 18:13, Torgeir Veimo wrote:
> > 
> >>On Mon, 2005-01-10 at 17:40 +0100, Martin Wache wrote:
> >>
> >>>Is there somebody else who tried the patch?
> >>
> >>Do you have an updated patch relative to the quickfix patch for running
> >>softdevice under vdr 1.3.18?
> > 
> > 
> > As the dvd-plugin has his own modified version with vdr-1.3.18 support in cvs,
> > Martin should decide how to proceed. Haven't tested that combination.
> > 
> > To my opinion it would be best to focus on vdr-1.3.18 with dvd-plugin from cvs,
> > and I don't belive we could support all new features with all vdr version (1.2.x).

Yes. 

> So if it is not too much trouble you can still try the patch, I'm 
> curious if it is working for someone else without problems, but don't 
> spend too much time with it if its not working...

Well, it was mostly that with the recent 1.3.18 patch, these line will
not have any effect;

approx line 1301:
if ( (streamtype >= 0xC0 && streamtype <= 0xCF) || streamtype==0xBD ) {
  aout->Write(header,6);
}

approx line 1310:
if (streamtype == 0xC0 || streamtype==0xBD)
  aout->Write(inbuf_ptr,streamlen);

because they are now only compiled in conditionally;

#if VDRVERSNUM < 10318
        if (streamtype == 0xC0 || streamtype==0xBD)
          aout->Write(inbuf_ptr,streamlen);
#endif

I just tested a DVD with the latest dvd plugin and your patch (without
these lines), and I get no sound.

When we get proper dvd playback running, I can chime in with
XVidModeExtension code to switch between 50 and 60Hz vertical refresh if
proper ModeLines are configured. That's more my area..

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Thu Jan 13 17:04:21 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 13 Jan 2005 17:04:21 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work with softdevice)
In-Reply-To: <41E6380F.1020301@gmx.net>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net> <1105550002.5791.16.camel@atlantis.netenviron.com> <200501121953.31017.stefan@lucke.in-berlin.de> <41E6380F.1020301@gmx.net>
Message-ID: <1105632261.41e69c0529cde@webmail.in-berlin.de>

Quoting Martin Wache <M.Wache at gmx.net>:

> Stefan Lucke wrote:
> > On Mittwoch, 12. Januar 2005 18:13, Torgeir Veimo wrote:
> > 
> >>On Mon, 2005-01-10 at 17:40 +0100, Martin Wache wrote:
> >>
> >>>Is there somebody else who tried the patch?
> >>
> >>Do you have an updated patch relative to the quickfix patch for running
> >>softdevice under vdr 1.3.18?
> > 
> > 
> > As the dvd-plugin has his own modified version with vdr-1.3.18 support in
> cvs,
> > Martin should decide how to proceed. Haven't tested that combination.
> > 
> > To my opinion it would be best to focus on vdr-1.3.18 with dvd-plugin from
> cvs,
> > and I don't belive we could support all new features with all vdr version
> (1.2.x).
> 
> I'm sorry that I'm answering so late... I'm also working on a different 
> patch, I still have some unfinished patches around which I want to 
> finish bevore I start to work on the inclusion of libavformat for the 
> parsing.
> I think we should not delay the development of the softdevice for a 
> working dvd-plugin, so lets make the softdevice compatible with 
> vdr-1.3.18 and than look for the dvd-plugin.

So I'll commit my vdr-1.3.18 patch.

> And I also think we should 
> not put too much work into the patch I send around, it will be obsolete 
> anyway if we move to parsing with libavformat... I just proposed to 
> include it into cvs because it was working without any problems for me, 
> and I didn't expect that there will be problems. Ah yes, and I found a 
> small bug in the calculation of the audio pts, it still uses a fixed 
> bitrate and number of channels, I will fix this in the cvs this 
> afternoon. So maybe this is the reason for the problems with the sync...

As you come back to audio sync..
1. The call of GetRelTime() after displaying a frame is not guarantied to
   measure only the display time. If the delay-loops are not executed
   it will measure to the last call (at the same place).
2. Before entering the delay loop shouldn't we reduce/adjust delay by the
   time of the last measurement point "delay -= GetRelTime()" ?
3. I've noticed that a usleep(x), sleeps at least for 10000 usecs.

Stefan Lucke


From stefan at lucke.in-berlin.de  Thu Jan 13 17:15:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 13 Jan 2005 17:15:30 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work	with softdevice)
In-Reply-To: <1105632074.3411.25.camel@atlantis.netenviron.com>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net>  <1105550002.5791.16.camel@atlantis.netenviron.com>  <200501121953.31017.stefan@lucke.in-berlin.de>  <41E6380F.1020301@gmx.net> <1105632074.3411.25.camel@atlantis.netenviron.com>
Message-ID: <1105632930.41e69ea239867@webmail.in-berlin.de>

Quoting Torgeir Veimo <torgeir at pobox.com>:

> 
> Well, it was mostly that with the recent 1.3.18 patch, these line will
> not have any effect;
> 
> approx line 1301:
> if ( (streamtype >= 0xC0 && streamtype <= 0xCF) || streamtype==0xBD ) {
>   aout->Write(header,6);
> }
> 
> approx line 1310:
> if (streamtype == 0xC0 || streamtype==0xBD)
>   aout->Write(inbuf_ptr,streamlen);
> 
> because they are now only compiled in conditionally;
> 
> #if VDRVERSNUM < 10318
>         if (streamtype == 0xC0 || streamtype==0xBD)
>           aout->Write(inbuf_ptr,streamlen);
> #endif
> 
> I just tested a DVD with the latest dvd plugin and your patch (without
> these lines), and I get no sound.

Ok I'll test that with cvs version of dvd plugin before committing.
Did you get sound with dvd plugin and reverting aboce change ?

Stefan Lucke


From torgeir at pobox.com  Thu Jan 13 17:18:27 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 13 Jan 2005 16:18:27 +0000
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin
	work	with softdevice)
In-Reply-To: <1105632930.41e69ea239867@webmail.in-berlin.de>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net>
	 <1105550002.5791.16.camel@atlantis.netenviron.com>
	 <200501121953.31017.stefan@lucke.in-berlin.de>  <41E6380F.1020301@gmx.net>
	 <1105632074.3411.25.camel@atlantis.netenviron.com>
	 <1105632930.41e69ea239867@webmail.in-berlin.de>
Message-ID: <1105633107.3411.27.camel@atlantis.netenviron.com>

On Thu, 2005-01-13 at 17:15 +0100, Stefan Lucke wrote:
> Quoting Torgeir Veimo <torgeir at pobox.com>:

> Ok I'll test that with cvs version of dvd plugin before committing.
> Did you get sound with dvd plugin and reverting aboce change ?

No.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Thu Jan 13 17:23:00 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 13 Jan 2005 16:23:00 +0000
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
	with softdevice)
In-Reply-To: <41E6380F.1020301@gmx.net>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net>
	 <1105550002.5791.16.camel@atlantis.netenviron.com>
	 <200501121953.31017.stefan@lucke.in-berlin.de>  <41E6380F.1020301@gmx.net>
Message-ID: <1105633380.3411.31.camel@atlantis.netenviron.com>

On Thu, 2005-01-13 at 09:57 +0100, Martin Wache wrote:
> parsing.
> I think we should not delay the development of the softdevice for a 
> working dvd-plugin, so lets make the softdevice compatible with 
> vdr-1.3.18 and than look for the dvd-plugin. And I also think we should 
> not put too much work into the patch I send around, it will be obsolete 
> anyway if we move to parsing with libavformat... 

I think it would be wise to consider implementing a separate dvd plugin
for use with softdevice exclusively. It appears to me that the current
dvd plugin is targeted at FF cards, and if we did a new one, we could
offload more work to libavcodec. 

I see issues with aspect ratio, and I'd assume there some other stuff
that is wrong as well. 

Probably starting with the current dvd plugin and removing all stuff
that can be offloaded to libavcodec would be a start.

I also think the keyboard navigation is not implemented in the best way
in the dvd plugin.


-- 
Torgeir Veimo <torgeir at pobox.com>



From particle at luukku.com  Thu Jan 13 20:17:08 2005
From: particle at luukku.com (Ari Koponen)
Date: Thu, 13 Jan 2005 21:17:08 +0200 (EET)
Subject: [Softdevice-devel] problems with mgatv
Message-ID: <1105643828837.particle.11367.HjhzuqCf_wucO5nSCksOgA@luukku.com>

Jari H kirjoitti 12.01.2005 kello 22:09:
> >> Can you try attached diff, which should enable field parity TOP ?
> 
> >I'm afraid this didn't solve my problem either. It seems that the
> >interlaced picture is sometimes ok but most of the time not. 
> 
> I have same problem becouse somehow softdevice wont use interrupt.
> 
> You can check it yourself: cat /proc/interrupts
> 
I'm not sure if it's that easy. I read from the DirectFB Changelog that IRQ is used only when there's actually traffic on /dev/fb?. So I think you should be running softdevice while you log in yourself via ssh or similar from anoter computer.  Quote from the changelog (sorry if it's garbled):

2003-04-05   syrjala	21:04:23	Ville Syrjala <syrjala at sci.fi>

	Files:	patches/matroxfb-vsync-c2vline-irq-patch-2.4.19.bz2 (1.4) (+0 -0)
		patches/matroxfb-vsync-irq-2.4.21-pre6.patch.bz2 (1.1) ( )
		patches/matroxfb-vsync-irq-2.4.20.patch.bz2 (1.1) ( )
	
	Improved matroxfb vsync patch.
	
	- Move wait queues to the matrox_fb_info struct. Should allow more than
	  one card to work at the same time.
	- Enable irq only when /dev/fbX is opened. I think this should eliminate
	  XFree86 hanging on startup.
	- Use vline interrupt on the first head simply because it's easier to
	  turn on/off than the vsync interrupt. It's programmed to trigger on
	  vblank start.
	- Check card type before trying to use the c2vline interrupt.

So this is about those vsync patches for 2.4 kernels. I'm not sure if these patches are included in the 2.6 kernel or not but atleast they won't apply cleanly to 2.6.9 that I have. I tested some of these with --dry-run option. Here

http://platan.vc.cvut.cz/ftp/pub/linux/matrox-latest/

seems to be also some patches for matroxfb but I haven't found out what do they actually do.. 

This could be even problem with my mainboard which is Asrock K7S8X. I've read about (and previosly experienced myself) problems with its APIC. 

Is someone having good interlaced picture with G450, G550 or G400 using s-video or scart-rgb and directfb? 

..............................................................
 MTV3 Laajakaista - Hauskemman el?m?n puolesta.
 http://www.mtv3.fi/liittyma/hankinta/laajakaista/



From stefan at lucke.in-berlin.de  Thu Jan 13 22:52:10 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 13 Jan 2005 22:52:10 +0100
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <1105517252.5504.5.camel@localhost.localdomain>
References: <1104954030.2788.38.camel@localhost.localdomain> <200501112305.52515.stefan@lucke.in-berlin.de> <1105517252.5504.5.camel@localhost.localdomain>
Message-ID: <200501132252.10210.stefan@lucke.in-berlin.de>

On Mittwoch, 12. Januar 2005 09:07, Ari Koponen wrote:
> ke, 2005-01-12 kello 00:05, Stefan Lucke kirjoitti:

> > Can you try attached diff, which should enable field parity TOP ?
> 
> I'm afraid this didn't solve my problem either. It seems that the
> interlaced picture is sometimes ok but most of the time not. 

In that diff SetFieldParity was called at the wrong place. The
modified version is now in cvs (including some other changes).
Could you please try again ?


-- 
Stefan Lucke



From particle at luukku.com  Fri Jan 14 08:24:16 2005
From: particle at luukku.com (Ari Koponen)
Date: Fri, 14 Jan 2005 09:24:16 +0200
Subject: [Softdevice-devel] problems with mgatv
In-Reply-To: <200501132252.10210.stefan@lucke.in-berlin.de>
References: <1104954030.2788.38.camel@localhost.localdomain>
	 <200501112305.52515.stefan@lucke.in-berlin.de>
	 <1105517252.5504.5.camel@localhost.localdomain>
	 <200501132252.10210.stefan@lucke.in-berlin.de>
Message-ID: <1105687456.32596.2.camel@localhost.localdomain>

to, 2005-01-13 kello 23:52, Stefan Lucke kirjoitti:
> On Mittwoch, 12. Januar 2005 09:07, Ari Koponen wrote:
> > ke, 2005-01-12 kello 00:05, Stefan Lucke kirjoitti:
> 
> > > Can you try attached diff, which should enable field parity TOP ?
> > 
> > I'm afraid this didn't solve my problem either. It seems that the
> > interlaced picture is sometimes ok but most of the time not. 
> 
> In that diff SetFieldParity was called at the wrong place. The
> modified version is now in cvs (including some other changes).
> Could you please try again ?

Damn, the new CVS version won't fire up. Here's my log:

[root at localhost vdr-1.3.18]# ./vdr -P"softdevice -vo dfb:mgatv"
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4736)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
 
       ---------------------- DirectFB v0.9.21 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------
 
(*) DirectFB/Core: Single Application Core. (2005-01-14 07:05)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 32580)...
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 32581)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 32582)...
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G450 0.7 (convergence integrated media
GmbH)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 16777216 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize
SrcColorkey Deinterlace
[dfb] Supported video Modes are: 640x480 at 16 768x576 at 32 768x576 at 16
640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8
800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8
1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8
1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8
1024x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8
1600x1200 at 8 1600x1200 at 8 1600x1200 at 8 720x576 at 16
[dfb] Enumeratig display Layers
Layer 2 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
  Caps: brightness contrast deinterlacing dst_colorkey screen_location
surface
Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
  Caps: brightness contrast flicker_filtering hue saturation surface
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (Matrox CRTC2 Layer - [720x576])
osdSurface::
 - videoonly
 - flipping
videoSurface::
 - videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring ColorKeying
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: Matrox CRTC2 Layer
[dfb] Using this layer for Video out: Matrox CRTC2 Layer
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
(!) [32565:    0.000] --> Caught signal 6 (sent by pid 32565, uid 0) <--
Tapettu

I'm away for the weekend so I can't test or reply to the list.




From torgeir at pobox.com  Fri Jan 14 20:43:33 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 14 Jan 2005 19:43:33 +0000
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501062225.12054.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de>
	 <1105033547.14000.7.camel@atlantis.netenviron.com>
	 <200501062225.12054.stefan@lucke.in-berlin.de>
Message-ID: <1105731813.28475.4.camel@atlantis.netenviron.com>

On Thu, 2005-01-06 at 22:25 +0100, Stefan Lucke wrote:
> On Donnerstag, 6. Januar 2005 18:45, Torgeir Veimo wrote:
> > On Tue, 2005-01-04 at 21:37 +0100, Stefan Lucke wrote:
> > 
> > >    - Changed A/V sync point by 4 frames. Sync is now ok for streams with PTS
> > >      value for each frame and for streams with PTS values for I-Frames only.
> > 
> > How did you decide on 4 frames? Is this per spec or just a value found
> > by experimenting?
> 
> Experimenting, tracing. Please have a look at the tracelogs a added to mpeg2decoder.c .
> Formerly we took the video PTS to sync on, from the incoming stream where frames
> are ordered in transport sequence and _not_ in display sequence. So when we take
> the PTS from an incomeing I-frame we should use this PTS value only when we
> get this I-frame from the decoder to display. You can see it in the snipped of 
> sequence A :
> 
> *V(1) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(9)  CF2(9)
>  V(0) NPTS(65785752) PPTS(65785272) P(1) P2(2) CF(10) CF2(7)
>  V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(11) CF2(11)
>  V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(12) CF2(12)
> +V(0) NPTS(65785752) PPTS(65785272) P(2) P2(1) CF(13) CF2(10)
> 
> The line marked with '*' is the incoming I-frame -> rememer the PTS value and
> the line marked with '+' is the I-frame we should display now P2 == 1 -> use
> remember PTS value
> 
> > am asking because one of my channels don't have
> > perfect sync.
> 
> Can you activate some tracing ? or make a short sequence that we could test this too.

Here's a log of the channel. I'll prepare a recording for upload as
well.

 V(1) NPTS(2525187) PPTS(2525227) P(2) P2(2) CF(63) CF2(61)
 V(1) NPTS(2525307) PPTS(2525187) P(3) P2(3) CF(64) CF2(64)
 V(1) NPTS(2525267) PPTS(2525307) P(2) P2(2) CF(65) CF2(63)
 V(1) NPTS(2525387) PPTS(2525267) P(3) P2(3) CF(66) CF2(66)
 V(1) NPTS(2525347) PPTS(2525387) P(2) P2(2) CF(67) CF2(65)
 V(1) NPTS(2525467) PPTS(2525347) P(3) P2(3) CF(68) CF2(68)
 V(1) NPTS(2525427) PPTS(2525467) P(2) P2(2) CF(69) CF2(67)
 V(1) NPTS(2525547) PPTS(2525427) P(3) P2(3) CF(70) CF2(70)
 V(1) NPTS(2525507) PPTS(2525547) P(1) P2(2) CF(71) CF2(69)
 V(1) NPTS(2525627) PPTS(2525507) P(3) P2(3) CF(72) CF2(72)
 V(1) NPTS(2525587) PPTS(2525627) P(2) P2(1) CF(73) CF2(71)
 V(1) NPTS(2525707) PPTS(2525587) P(3) P2(3) CF(74) CF2(74)
 V(1) NPTS(2525667) PPTS(2525707) P(2) P2(2) CF(75) CF2(73)
 V(1) NPTS(2525787) PPTS(2525667) P(3) P2(3) CF(76) CF2(76)
 V(1) NPTS(2525747) PPTS(2525787) P(2) P2(2) CF(77) CF2(75)
 V(1) NPTS(2525867) PPTS(2525747) P(3) P2(3) CF(78) CF2(78)
 V(1) NPTS(2525827) PPTS(2525867) P(2) P2(2) CF(79) CF2(77)
 V(1) NPTS(2525947) PPTS(2525827) P(3) P2(3) CF(80) CF2(80)
 V(1) NPTS(2525907) PPTS(2525947) P(2) P2(2) CF(81) CF2(79)




-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Sat Jan 15 10:04:38 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 15 Jan 2005 10:04:38 +0100
Subject: [Softdevice-devel] Patch: Raw PCM out (makes dvd-plugin work
 with softdevice)
In-Reply-To: <1105632261.41e69c0529cde@webmail.in-berlin.de>
References: <41DFF66C.50704@gmx.net> <41E2B012.9040504@gmx.net> <1105550002.5791.16.camel@atlantis.netenviron.com> <200501121953.31017.stefan@lucke.in-berlin.de> <41E6380F.1020301@gmx.net> <1105632261.41e69c0529cde@webmail.in-berlin.de>
Message-ID: <41E8DCA6.9070305@gmx.net>

> 
> As you come back to audio sync..
> 1. The call of GetRelTime() after displaying a frame is not guarantied to
>    measure only the display time. If the delay-loops are not executed
>    it will measure to the last call (at the same place).
Yes, that's right. But I don't think this does any harm, sine the 
dispTime is only used for showing some statistics, and in the most cases 
it will show the correct time.
> 2. Before entering the delay loop shouldn't we reduce/adjust delay by the
>    time of the last measurement point "delay -= GetRelTime()" ?
Yes, you are again right... I missed this and it solves problem No. 1 
;-). If you don't mind I will correct this together with the my pts 
calculation fix...

> 3. I've noticed that a usleep(x), sleeps at least for 10000 usecs.
That's why I like the linux RTC better... I found that the usleep(x) on 
my machine sleeps actually 2*x usecs and the minimum is about 2000 
usecs. That's the the reason why the variable "rest" is at 2200 now.
We should adjust this to a value which suits the most systems, but what 
would this value be? Or if we want to be really precise we can use CPU 
burning timing, but I don't like that....

Bye,
Martin


From M.Wache at gmx.net  Sat Jan 15 11:48:14 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 15 Jan 2005 11:48:14 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
Message-ID: <41E8F4EE.7060604@gmx.net>

Hi all,

I have another patch, I used a similar feature for some time now and on 
the questions on the list I added the feature that XV port and audio 
device are released.
On pressing "v" (for video suspend) the softdevice stops decoding the 
video and releases the XV port and the audio device. This saves CPU time 
and one can watch use other programs which need the XV port or the audio 
device while making a recoding. If one presses "v" again the softdevice 
tries to reopen the XV port and the audio device, if opening of one of 
them fails the softdevice returns to sleep mode. Sadly this doesn't work 
properly yet for the audio device... The open function just doesn't 
return until it can open the audio device. If the opening succeds the 
video is decoded again.

Right now the suspend is only accessible from XV-out, in principle it 
can also be implemented for other output methods.

So if you want please try the patch and tell me how it works for you, so 
that we can include it in the CVS if you like it and its working.

Bye,
Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Suspend_patch.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050115/0f67e281/attachment.ksh>

From stefan at lucke.in-berlin.de  Sat Jan 15 12:21:53 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 15 Jan 2005 12:21:53 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <41E8F4EE.7060604@gmx.net>
References: <41E8F4EE.7060604@gmx.net>
Message-ID: <200501151221.53414.stefan@lucke.in-berlin.de>

On Samstag, 15. Januar 2005 11:48, Martin Wache wrote:
> Hi all,
> 
> I have another patch, I used a similar feature for some time now and on 
> the questions on the list I added the feature that XV port and audio 
> device are released.
> On pressing "v" (for video suspend) the softdevice stops decoding the 
> video and releases the XV port and the audio device. This saves CPU time 
> and one can watch use other programs which need the XV port or the audio 
> device while making a recoding.

Selecting 'V' and 'v' for this action I'm not happy with, as I mapped those chars
to my vdr remote for controlling volume+ and volume-. As these direct key code
handling bypasses vdr remote control we should change that. I introduced that
at a time we had no own OSD and no setup store ;-) .

-- 
Stefan Lucke



From lachlanlewis at gmail.com  Sat Jan 15 14:13:43 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Sat, 15 Jan 2005 21:13:43 +0800
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <41E8F4EE.7060604@gmx.net>
References: <41E8F4EE.7060604@gmx.net>
Message-ID: <b98c6b1a05011505131cadc28f@mail.gmail.com>

> So if you want please try the patch and tell me how it works for you, so
> that we can include it in the CVS if you like it and its working.
>
I'm exited about this prospect, i wish I could help to code this for
DirectFB.  Thanks for your efforts Martin.  If anyone wants to port
this to directFfb i'll buy them a beer ;-)

Mick


From stefan at lucke.in-berlin.de  Sat Jan 15 15:23:35 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 15 Jan 2005 15:23:35 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <b98c6b1a05011505131cadc28f@mail.gmail.com>
References: <41E8F4EE.7060604@gmx.net> <b98c6b1a05011505131cadc28f@mail.gmail.com>
Message-ID: <200501151523.35414.stefan@lucke.in-berlin.de>

On Samstag, 15. Januar 2005 14:13, mike lewis wrote:
> > So if you want please try the patch and tell me how it works for you, so
> > that we can include it in the CVS if you like it and its working.
> >
> I'm exited about this prospect, i wish I could help to code this for
> DirectFB.  Thanks for your efforts Martin.  If anyone wants to port
> this to directFfb i'll buy them a beer ;-)

When talking about such a feature:
what is the real use-case for this feature ?

Should we probably cycle thru all our output methods via hot-keys 
(x -> x11, d -> dfb, v -> vidix) too ?

-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 15 16:13:23 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 15 Jan 2005 15:13:23 +0000
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV
	out)
In-Reply-To: <200501151523.35414.stefan@lucke.in-berlin.de>
References: <41E8F4EE.7060604@gmx.net>
	 <b98c6b1a05011505131cadc28f@mail.gmail.com>
	 <200501151523.35414.stefan@lucke.in-berlin.de>
Message-ID: <1105802003.28475.9.camel@atlantis.netenviron.com>

On Sat, 2005-01-15 at 15:23 +0100, Stefan Lucke wrote:
> On Samstag, 15. Januar 2005 14:13, mike lewis wrote:
> > > So if you want please try the patch and tell me how it works for you, so
> > > that we can include it in the CVS if you like it and its working.
> > >
> > I'm exited about this prospect, i wish I could help to code this for
> > DirectFB.  Thanks for your efforts Martin.  If anyone wants to port
> > this to directFfb i'll buy them a beer ;-)
> 
> When talking about such a feature:
> what is the real use-case for this feature ?

You are recording something, but want to watch a DVD, thus you'd like to
continue running vdr, but use your one and only Xv output port with
Xine.

> Should we probably cycle thru all our output methods via hot-keys 
> (x -> x11, d -> dfb, v -> vidix) too ?

That's is less useful in my view.

I think if we had a fully working DVD plugin with softdevice there would
be less use for this feature.

It would be good to actually implement a Gnome / freedesktop standard
type notification are icon when output is suspended. I might look into
that. Also, we need to be able to map this feature to one user defined
remote button.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sat Jan 15 17:29:19 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 15 Jan 2005 16:29:19 +0000
Subject: [Softdevice-devel] DirectFB output w higher resolution OSD
Message-ID: <1105806559.28475.15.camel@atlantis.netenviron.com>

Can the DirectFB output be set up to use a higher resolution for the
OSD? I'd prefer to have on screen text in the native resolution of my
display while still using the scaler for the video output.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Jan 15 18:31:22 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 15 Jan 2005 18:31:22 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <1105802003.28475.9.camel@atlantis.netenviron.com>
References: <41E8F4EE.7060604@gmx.net> <200501151523.35414.stefan@lucke.in-berlin.de> <1105802003.28475.9.camel@atlantis.netenviron.com>
Message-ID: <200501151831.22806.stefan@lucke.in-berlin.de>

On Samstag, 15. Januar 2005 16:13, Torgeir Veimo wrote:
> On Sat, 2005-01-15 at 15:23 +0100, Stefan Lucke wrote:
> > On Samstag, 15. Januar 2005 14:13, mike lewis wrote:
> > > > So if you want please try the patch and tell me how it works for you, so
> > > > that we can include it in the CVS if you like it and its working.
> > > >
> > > I'm exited about this prospect, i wish I could help to code this for
> > > DirectFB.  Thanks for your efforts Martin.  If anyone wants to port
> > > this to directFfb i'll buy them a beer ;-)
> > 
> > When talking about such a feature:
> > what is the real use-case for this feature ?
> 
> You are recording something, but want to watch a DVD, thus you'd like to
> continue running vdr, but use your one and only Xv output port with
> Xine.

Isn't that the same as terminating your vdr-client and let the vdr-server
up and running :-) ? Yes that would require a better streamdev plugin ..
and a way to highjack the server OSD to the client. The last is one of
my greatest whishes as my vdr-server downstairs has no graphic and
audio output device :-( (vdr-server based video cutting, .. ).

> 
> > Should we probably cycle thru all our output methods via hot-keys 
> > (x -> x11, d -> dfb, v -> vidix) too ?
> 
> That's is less useful in my view.

For dfb-out due to startup mode with SetCooperativeLevel(DLSCL_ADMINISTRATIVE);
it would be more or less the same as delete videoOut; ...
videoOut = new cMETHODVideoOut (..);.

> 
> I think if we had a fully working DVD plugin with softdevice there would
> be less use for this feature.

So we should focus on more compatibility with some other plugins and have 
a player like Martin suggested for other video stream types which are
supported by ffmpeg. To get the dvd plugin work again, I think looking at
recent changes of vdr output method PlayPES()  instead of playvideo()
(wondering why it still works with vdr-1.3.18).

When targeting upon inclusion into distributions (binary) we should have
our own sub-plugin loader for runtime loading the output device handler. By
this vdr would not fail on startup while loading libvdr-softdevice.so.1.x.y on
a system that has only support for directfb, but not for X11. This would still
allow that all output methods are selected at build time.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Jan 15 19:01:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 15 Jan 2005 19:01:58 +0100
Subject: [Softdevice-devel] DirectFB output w higher resolution OSD
In-Reply-To: <1105806559.28475.15.camel@atlantis.netenviron.com>
References: <1105806559.28475.15.camel@atlantis.netenviron.com>
Message-ID: <200501151901.58841.stefan@lucke.in-berlin.de>

On Samstag, 15. Januar 2005 17:29, Torgeir Veimo wrote:
> Can the DirectFB output be set up to use a higher resolution for the
> OSD? I'd prefer to have on screen text in the native resolution of my
> display while still using the scaler for the video output.

To my knowledge OSD is limited to 672x567 by vdr, see config.h .


-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 15 21:10:14 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 15 Jan 2005 20:10:14 +0000
Subject: [Softdevice-devel] DirectFB output w higher resolution OSD
In-Reply-To: <200501151901.58841.stefan@lucke.in-berlin.de>
References: <1105806559.28475.15.camel@atlantis.netenviron.com>
	 <200501151901.58841.stefan@lucke.in-berlin.de>
Message-ID: <1105819814.6074.1.camel@atlantis.netenviron.com>

On Sat, 2005-01-15 at 19:01 +0100, Stefan Lucke wrote:
> On Samstag, 15. Januar 2005 17:29, Torgeir Veimo wrote:
> > Can the DirectFB output be set up to use a higher resolution for the
> > OSD? I'd prefer to have on screen text in the native resolution of my
> > display while still using the scaler for the video output.
> 
> To my knowledge OSD is limited to 672x567 by vdr, see config.h .

Ok, but I'd rather have that displayed centered in native resolution
than scaled. A higher resolution OSD would of course be preferred, but
this can be done later.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Sun Jan 16 11:01:07 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 16 Jan 2005 11:01:07 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV
 out)
In-Reply-To: <200501151831.22806.stefan@lucke.in-berlin.de>
References: <41E8F4EE.7060604@gmx.net> <200501151523.35414.stefan@lucke.in-berlin.de> <1105802003.28475.9.camel@atlantis.netenviron.com> <200501151831.22806.stefan@lucke.in-berlin.de>
Message-ID: <41EA3B63.7000008@gmx.net>

Stefan Lucke wrote:
>>>When talking about such a feature:
>>>what is the real use-case for this feature ?
>>
>>You are recording something, but want to watch a DVD, thus you'd like to
>>continue running vdr, but use your one and only Xv output port with
>>Xine.
> 
> 
> Isn't that the same as terminating your vdr-client and let the vdr-server
> up and running :-) ? Yes that would require a better streamdev plugin ..
It is a similar feature, and it has some advantages over using streamdev 
plugin. I think that the fact there is already a possibility to do 
something one way should not be a reason to include features which allow 
to do the same think an other way. Or maybe we should stop developing 
the softdevice just because there is already vdr-xine ;-)

>>I think if we had a fully working DVD plugin with softdevice there would
>>be less use for this feature.
I can think of a lot more things where suspending the video playback is 
very usefull, espacially for people who don't have a vdr-only machine.
I personally like to transcode videos while I do recordings ( my pc is 
on anyway during this time). When I suspend the vdr output I get more 
cpu time for the transcoding and since I usually do the cutting with a 
different program than vdr, I can do that also during a recording.
Or just imagine someone who wants to listen to mp3 with his favourite 
mp3-player while doing a recording...


So like Stefan suggested I will create a menu entry for suspending the 
video. Since I like to have a hotkey for suspending I will leave that 
option too, but make it configurable from the Makefile. Are there some 
suggestions which key should be used? I originally wanted to use 's' but 
  that's already taken for 'Saturation'...
Are there some other objections against including this feature in the 
softdevice?

Bye,
Martin


From stefan at lucke.in-berlin.de  Sun Jan 16 21:29:28 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 16 Jan 2005 21:29:28 +0100
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <41EA3B63.7000008@gmx.net>
References: <41E8F4EE.7060604@gmx.net> <200501151831.22806.stefan@lucke.in-berlin.de> <41EA3B63.7000008@gmx.net>
Message-ID: <200501162129.28326.stefan@lucke.in-berlin.de>

On Sonntag, 16. Januar 2005 11:01, Martin Wache wrote:
> Stefan Lucke wrote:
> >>>When talking about such a feature:
> >>>what is the real use-case for this feature ?
> >>
> >>You are recording something, but want to watch a DVD, thus you'd like to
> >>continue running vdr, but use your one and only Xv output port with
> >>Xine.
> > 
> > 
> > Isn't that the same as terminating your vdr-client and let the vdr-server
> > up and running :-) ? Yes that would require a better streamdev plugin ..
> It is a similar feature, and it has some advantages over using streamdev 
> plugin. I think that the fact there is already a possibility to do 
> something one way should not be a reason to include features which allow 
> to do the same think an other way. Or maybe we should stop developing 
> the softdevice just because there is already vdr-xine ;-)

vdr-xine no. The reason for me to step into softdevice was that I was not
forced to patch other applications and libs.

> 
> >>I think if we had a fully working DVD plugin with softdevice there would
> >>be less use for this feature.
> I can think of a lot more things where suspending the video playback is 
> very usefull, espacially for people who don't have a vdr-only machine.
> I personally like to transcode videos while I do recordings ( my pc is 
> on anyway during this time). When I suspend the vdr output I get more 
> cpu time for the transcoding and since I usually do the cutting with a 
> different program than vdr, I can do that also during a recording.

But don't do a logoff as your vdr standalone would be killed, your
vdr-server wouldn't.

> Or just imagine someone who wants to listen to mp3 with his favourite 
> mp3-player while doing a recording...

Ok there is demand for such a feature and some arguments for it so let's
include it. I just wanted to know for what it is used.

> 
> 
> So like Stefan suggested I will create a menu entry for suspending the 
> video. Since I like to have a hotkey for suspending I will leave that 
> option too, but make it configurable from the Makefile. Are there some 
> suggestions which key should be used? I originally wanted to use 's' but 
>   that's already taken for 'Saturation'...

We should make most of them OSD accessible as other output modes may have
them too. The remaining should be
'f' toggle fullscreen,
'r' toggle release/resume output mode 

> Are there some other objections against including this feature in the 
> softdevice?

No.

-- 
Stefan Lucke



From lachlanlewis at gmail.com  Mon Jan 17 03:14:59 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Mon, 17 Jan 2005 10:14:59 +0800
Subject: [Softdevice-devel] PATCH: Suspend audio and video out (for XV out)
In-Reply-To: <200501162129.28326.stefan@lucke.in-berlin.de>
References: <41E8F4EE.7060604@gmx.net>
	 <200501151831.22806.stefan@lucke.in-berlin.de>
	 <41EA3B63.7000008@gmx.net>
	 <200501162129.28326.stefan@lucke.in-berlin.de>
Message-ID: <b98c6b1a0501161814140fd45@mail.gmail.com>

> > Or just imagine someone who wants to listen to mp3 with his favourite
> > mp3-player while doing a recording...
> 
> Ok there is demand for such a feature and some arguments for it so let's
> include it. I just wanted to know for what it is used.
>
Freevo is my example.  I use freevo as my main Gui, for news, mp3,
dvd's, and avi's.  Its just much prettier.  I use vdradmin for
managing recordings.  And vdr-xine for watching live-tv and recorded
tv.  My issue is that with vdr-xine i can't zoom in, as vidix support
is not full-featured like xv support in xine.  df_xine also doesn't
have any zoom or aspect changing features..


From M.Wache at gmx.net  Mon Jan 17 10:40:39 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 17 Jan 2005 10:40:39 +0100
Subject: [Softdevice-devel] Suspend Video patch updated
Message-ID: <41EB8817.8060907@gmx.net>

Hi all,

I'm sending you an updated version of my suspend playback patch. As 
discussed supending is now possible from OSD menu and thus accessable 
form all video output modes. I did not test this new feature with all 
output methods, so if you have the possibility to test the patch with 
different video output modes, please try it.
The hotkey for suspend/resume video playback in XV-out mode is now "r", 
and this feature maybe switched off from the Makefile.

I would be glad for any reports on how this feature is working for you, 
so that we can include it in the CVS soon.

Cheers,
Martin


From M.Wache at gmx.net  Mon Jan 17 10:45:38 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 17 Jan 2005 10:45:38 +0100
Subject: [Softdevice-devel] Suspend Video patch updated
In-Reply-To: <41EB8817.8060907@gmx.net>
References: <41EB8817.8060907@gmx.net>
Message-ID: <41EB8942.4060000@gmx.net>

Hi again,

sorry I forgot to attach the patch....
Here it comes....

Bye,
Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Suspend2.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050117/dc03d77b/attachment.ksh>

From lachlanlewis at gmail.com  Tue Jan 18 13:41:37 2005
From: lachlanlewis at gmail.com (mike lewis)
Date: Tue, 18 Jan 2005 20:41:37 +0800
Subject: [Softdevice-devel] Suspend Video patch updated
In-Reply-To: <41EB8942.4060000@gmx.net>
References: <41EB8817.8060907@gmx.net> <41EB8942.4060000@gmx.net>
Message-ID: <b98c6b1a0501180441593a5d00@mail.gmail.com>

I'm getting a 'malformed patch' error.  I think its because I'm
cutting and pasting from a windows client..   Can you send it to my
offline email account?  When I forward from gmail it gets converted to
body-text..

{{{
freevo softdevice-0.0.8 # patch -p0 < /tmp/vdr_softoff.patch
patching file Makefile
patch: **** malformed patch at line 12: LIBXDPMS_SUPPORT = 1
}}}

email_mick[at]bigpond[dot]com

Cheers,
Mick


From stefan at lucke.in-berlin.de  Tue Jan 18 23:33:18 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 18 Jan 2005 23:33:18 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <1105731813.28475.4.camel@atlantis.netenviron.com>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <200501062225.12054.stefan@lucke.in-berlin.de> <1105731813.28475.4.camel@atlantis.netenviron.com>
Message-ID: <200501182333.18623.stefan@lucke.in-berlin.de>

On Freitag, 14. Januar 2005 20:43, Torgeir Veimo wrote:
> On Thu, 2005-01-06 at 22:25 +0100, Stefan Lucke wrote:

> > 
> > *V(1) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(9)  CF2(9)
> >  V(0) NPTS(65785752) PPTS(65785272) P(1) P2(2) CF(10) CF2(7)
> >  V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(11) CF2(11)
> >  V(0) NPTS(65785752) PPTS(65785272) P(3) P2(3) CF(12) CF2(12)
> > +V(0) NPTS(65785752) PPTS(65785272) P(2) P2(1) CF(13) CF2(10)
> > 
> > The line marked with '*' is the incoming I-frame -> rememer the PTS value and
> > the line marked with '+' is the I-frame we should display now P2 == 1 -> use
> > remember PTS value
> > 
> > > am asking because one of my channels don't have
> > > perfect sync.
> > 
> > Can you activate some tracing ? or make a short sequence that we could test this too.
> 
> Here's a log of the channel. I'll prepare a recording for upload as
> well.

No need to upload. Sometimes it takes a while to see what's going wrong.

> 
>  V(1) NPTS(2525187) PPTS(2525227) P(2) P2(2) CF(63) CF2(61)
>  V(1) NPTS(2525307) PPTS(2525187) P(3) P2(3) CF(64) CF2(64)
>  V(1) NPTS(2525267) PPTS(2525307) P(2) P2(2) CF(65) CF2(63)
>  V(1) NPTS(2525387) PPTS(2525267) P(3) P2(3) CF(66) CF2(66)
>  V(1) NPTS(2525347) PPTS(2525387) P(2) P2(2) CF(67) CF2(65)
>  V(1) NPTS(2525467) PPTS(2525347) P(3) P2(3) CF(68) CF2(68)
*>  V(1) NPTS(2525427) PPTS(2525467) P(2) P2(2) CF(69) CF2(67)
#>  V(1) NPTS(2525547) PPTS(2525427) P(3) P2(3) CF(70) CF2(70)
+>  V(1) NPTS(2525507) PPTS(2525547) P(1) P2(2) CF(71) CF2(69)
 >  V(1) NPTS(2525627) PPTS(2525507) P(3) P2(3) CF(72) CF2(72)
+>  V(1) NPTS(2525587) PPTS(2525627) P(2) P2(1) CF(73) CF2(71)

You see that the difference between the two points '+' is two frames instead
of three in my example above. By this you'll get an A/V async of 120ms 
NPTS(#)-NPTS(*) as we use '*' PTS where we should use '#' instead.

When you change in mpeg2decoder.c the line : '-->' from

    if (picture->pict_type == FF_I_TYPE)
    {
#if 0
      fprintf (stderr, " changing PTS from %lld to %lld. delta %lld\n",
               pts, historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT],
-->               historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT]-pts);
#endif
      pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
      //fprintf (stderr, "* using PTS value (%lld)\n", pts);
    }

to:
-->               historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT]-pts);

you should get a good sync with this channel (only).
Accessing back pts values has to be recalculated someway.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Jan 18 23:48:19 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 18 Jan 2005 23:48:19 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501182333.18623.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <1105731813.28475.4.camel@atlantis.netenviron.com> <200501182333.18623.stefan@lucke.in-berlin.de>
Message-ID: <200501182348.19277.stefan@lucke.in-berlin.de>

On Dienstag, 18. Januar 2005 23:33, Stefan Lucke wrote:
> When you change in mpeg2decoder.c the line : '-->' from
> 
>     if (picture->pict_type == FF_I_TYPE)
>     {
> #if 0
>       fprintf (stderr, " changing PTS from %lld to %lld. delta %lld\n",
>                pts, historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT],
> -->               historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT]-pts);
> #endif
>       pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
>       //fprintf (stderr, "* using PTS value (%lld)\n", pts);
>     }
> 
> to:
> -->               historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT]-pts);

Wrong line should be from:
-- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
to:
-- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT];


-- 
Stefan Lucke



From torgeir at pobox.com  Tue Jan 18 23:53:22 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 18 Jan 2005 22:53:22 +0000
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501182348.19277.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de>
	 <1105731813.28475.4.camel@atlantis.netenviron.com>
	 <200501182333.18623.stefan@lucke.in-berlin.de>
	 <200501182348.19277.stefan@lucke.in-berlin.de>
Message-ID: <1106088802.7386.2.camel@atlantis.netenviron.com>

On Tue, 2005-01-18 at 23:48 +0100, Stefan Lucke wrote:
> On Dienstag, 18. Januar 2005 23:33, Stefan Lucke wrote:
> > When you change in mpeg2decoder.c the line : '-->' from
> > 
> >     if (picture->pict_type == FF_I_TYPE)
> >     {
> > #if 0
> >       fprintf (stderr, " changing PTS from %lld to %lld. delta %lld\n",
> >                pts, historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT],
> > -->               historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT]-pts);
> > #endif
> >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
> >       //fprintf (stderr, "* using PTS value (%lld)\n", pts);
> >     }
> > 
> > to:
> > -->               historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT]-pts);
> 
> Wrong line should be from:
> -- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
> to:
> -- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT];

But this would not work that well for the other majority of channels
then..? Would of course be best if that constant can be derived from the
stream itself.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Fri Jan 21 07:41:18 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Jan 2005 07:41:18 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501182348.19277.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <200501182333.18623.stefan@lucke.in-berlin.de> <200501182348.19277.stefan@lucke.in-berlin.de>
Message-ID: <200501210741.18329.stefan@lucke.in-berlin.de>

On Dienstag, 18. Januar 2005 23:48, Stefan Lucke wrote:

> Wrong line should be from:
> -- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-4)%PTS_COUNT];
> to:
> -- > >       pts = historyPTS[(historyPTSIndex+PTS_COUNT-3)%PTS_COUNT];

Torgeir did you test that ? The final version should calculate the back
index from the video stream if above change fixes the sync issue with
this channel.

Wondering why you mail I saw via web interface didn't go into my inbox.

-- 
Stefan Lucke



From ollo.diab at gmx.de  Fri Jan 21 11:26:44 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Fri, 21 Jan 2005 11:26:44 +0100 (MET)
Subject: [Softdevice-devel] softdevice & XvMC lib?
Message-ID: <24765.1106303204@www18.gmx.net>

Hallo,

eine Frage zur Unterst?tzung der Hardwarebeschleunigung von Softdevice.
Offensichtlich erfolgt schon eine (geringe) Hardwarebeschleunigung ?ber den
X-Server solange das XV-Module geladen wird (wird es!).

Allerdings beschleunigt der mplayer ja mehr bzw. entlastet die CPU st?rker,
wenn die libXvMC.so direkt verwendet wird. Unter anderem ist das auch beim
mpeg2play_accel (siehe http://www.xfree86.org/~mvojkovi/) zu sehen.

Gibt es eine Chance, das Softdevice um libXvMC Support erweitert wird?

Ich frage, weil f?r HDTV mein System ohne libXvMC Support ziemlich an der
Kante ist, jedoch mit stabil l?uft (getestet mit MPlayer).

Danke & Gru?,   Thomas

-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl


From particle at luukku.com  Sat Jan 22 13:17:55 2005
From: particle at luukku.com (Ari Koponen)
Date: Sat, 22 Jan 2005 14:17:55 +0200
Subject: [Softdevice-devel] mgatv & interlaced playback
Message-ID: <1106396275.2829.13.camel@localhost.localdomain>

I managed to get mplayer to play interlaced content smoothly with these
options: -vo dfbmga:fieldparity=top:buffermode=triple -vsync. I also
tested with buffermode=single and there were tearing. The latest version
of the softdevice from CVS seems to do a little bit better job as the
previous versions but still there are tearing issues sometimes.

I don't know how softdevice is built but would it be possible to use
double or triple buffering for DirectFB (or is it already using it?) and
use interrupt based synchronizing like the mplayer seems to do? Would
that extra buffering affect channel switching time?



From torgeir at pobox.com  Sat Jan 22 20:53:53 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 22 Jan 2005 19:53:53 +0000
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <200501210741.18329.stefan@lucke.in-berlin.de>
References: <200501042137.28285.stefan@lucke.in-berlin.de>
	 <200501182333.18623.stefan@lucke.in-berlin.de>
	 <200501182348.19277.stefan@lucke.in-berlin.de>
	 <200501210741.18329.stefan@lucke.in-berlin.de>
Message-ID: <1106423633.16690.48.camel@atlantis.netenviron.com>

On Fri, 2005-01-21 at 07:41 +0100, Stefan Lucke wrote:
> 
> Torgeir did you test that ? The final version should calculate the
> back
> index from the video stream if above change fixes the sync issue with
> this channel.


Ok. I tried both PTS_COUNT-3, -2 and -1, and subjectively, using -2 is
best with this channel. It's a bit hard to judge, as it's a music
channel, and one I don't watch too often.

-2 log:

[softdevice] allocating picture buffer for resolution 720x576
 V(1) NPTS(23834363) PPTS(23834403) P(2) P2(1) CF(1) CF2(0)
 V(1) NPTS(23834483) PPTS(23834363) P(3) P2(3) CF(2) CF2(2)
 V(1) NPTS(23834443) PPTS(23834483) P(2) P2(2) CF(3) CF2(1)
 V(1) NPTS(23834563) PPTS(23834443) P(3) P2(3) CF(4) CF2(4)
 V(1) NPTS(23834523) PPTS(23834563) P(1) P2(2) CF(5) CF2(3)
 V(1) NPTS(23834643) PPTS(23834523) P(3) P2(3) CF(6) CF2(6)
 V(1) NPTS(23834603) PPTS(23834643) P(2) P2(1) CF(7) CF2(5)
 changing PTS from 23834523 to 23834523. delta 0
 V(1) NPTS(23834723) PPTS(23834603) P(3) P2(3) CF(8) CF2(8)
 V(1) NPTS(23834683) PPTS(23834723) P(2) P2(2) CF(9) CF2(7)
 V(1) NPTS(23834803) PPTS(23834683) P(3) P2(3) CF(10) CF2(10)
 V(1) NPTS(23834763) PPTS(23834803) P(2) P2(2) CF(11) CF2(9)
 V(1) NPTS(23834883) PPTS(23834763) P(3) P2(3) CF(12) CF2(12)
 V(1) NPTS(23834843) PPTS(23834883) P(2) P2(2) CF(13) CF2(11)
 V(1) NPTS(23834963) PPTS(23834843) P(3) P2(3) CF(14) CF2(14)
 V(1) NPTS(23834923) PPTS(23834963) P(2) P2(2) CF(15) CF2(13)
 V(1) NPTS(23835043) PPTS(23834923) P(3) P2(3) CF(16) CF2(16)
 V(1) NPTS(23835003) PPTS(23835043) P(1) P2(2) CF(17) CF2(15)
 V(1) NPTS(23835123) PPTS(23835003) P(3) P2(3) CF(18) CF2(18)
 V(1) NPTS(23835083) PPTS(23835123) P(2) P2(1) CF(19) CF2(17)
 changing PTS from 23835003 to 23835003. delta 0
 V(1) NPTS(23835203) PPTS(23835083) P(3) P2(3) CF(20) CF2(20)
 V(1) NPTS(23835163) PPTS(23835203) P(2) P2(2) CF(21) CF2(19)
 V(1) NPTS(23835283) PPTS(23835163) P(3) P2(3) CF(22) CF2(22)
 V(1) NPTS(23835243) PPTS(23835283) P(2) P2(2) CF(23) CF2(21)
 V(1) NPTS(23835363) PPTS(23835243) P(3) P2(3) CF(24) CF2(24)
 V(1) NPTS(23835323) PPTS(23835363) P(2) P2(2) CF(25) CF2(23)
 V(1) NPTS(23835443) PPTS(23835323) P(3) P2(3) CF(26) CF2(26)
 V(1) NPTS(23835403) PPTS(23835443) P(2) P2(2) CF(27) CF2(25)
 V(1) NPTS(23835523) PPTS(23835403) P(3) P2(3) CF(28) CF2(28)
 V(1) NPTS(23835483) PPTS(23835523) P(1) P2(2) CF(29) CF2(27)
 V(1) NPTS(23835603) PPTS(23835483) P(3) P2(3) CF(30) CF2(30)
 V(1) NPTS(23835563) PPTS(23835603) P(2) P2(1) CF(31) CF2(29)
 changing PTS from 23835483 to 23835483. delta 0
 V(1) NPTS(23835683) PPTS(23835563) P(3) P2(3) CF(32) CF2(32)
 V(1) NPTS(23835643) PPTS(23835683) P(2) P2(2) CF(33) CF2(31)
 V(1) NPTS(23835763) PPTS(23835643) P(3) P2(3) CF(34) CF2(34)
 V(1) NPTS(23835723) PPTS(23835763) P(2) P2(2) CF(35) CF2(33)
 V(1) NPTS(23835843) PPTS(23835723) P(3) P2(3) CF(36) CF2(36)
 V(1) NPTS(23835803) PPTS(23835843) P(2) P2(2) CF(37) CF2(35)
 V(1) NPTS(23835923) PPTS(23835803) P(3) P2(3) CF(38) CF2(38)
 V(1) NPTS(23835883) PPTS(23835923) P(2) P2(2) CF(39) CF2(37)
 V(1) NPTS(23836003) PPTS(23835883) P(3) P2(3) CF(40) CF2(40)
 V(1) NPTS(23835963) PPTS(23836003) P(1) P2(2) CF(41) CF2(39)
 V(1) NPTS(23836083) PPTS(23835963) P(3) P2(3) CF(42) CF2(42)
 V(1) NPTS(23836043) PPTS(23836083) P(1) P2(1) CF(43) CF2(41)
 changing PTS from 23835963 to 23835963. delta 0
 V(1) NPTS(23836163) PPTS(23836043) P(3) P2(3) CF(44) CF2(44)
 V(1) NPTS(23836123) PPTS(23836163) P(2) P2(1) CF(45) CF2(43)
 changing PTS from 23836043 to 23836043. delta 0
 V(1) NPTS(23836243) PPTS(23836123) P(3) P2(3) CF(46) CF2(46)
 V(1) NPTS(23836203) PPTS(23836243) P(2) P2(2) CF(47) CF2(45)
 V(1) NPTS(23836323) PPTS(23836203) P(3) P2(3) CF(48) CF2(48)
 V(1) NPTS(23836283) PPTS(23836323) P(2) P2(2) CF(49) CF2(47)
 V(1) NPTS(23836403) PPTS(23836283) P(3) P2(3) CF(50) CF2(50)
 V(1) NPTS(23836363) PPTS(23836403) P(2) P2(2) CF(51) CF2(49)
 V(1) NPTS(23836483) PPTS(23836363) P(3) P2(3) CF(52) CF2(52)
 V(1) NPTS(23836443) PPTS(23836483) P(2) P2(2) CF(53) CF2(51)
 V(1) NPTS(23836563) PPTS(23836443) P(3) P2(3) CF(54) CF2(54)
 V(1) NPTS(23836523) PPTS(23836563) P(1) P2(2) CF(55) CF2(53)
 V(1) NPTS(23836643) PPTS(23836523) P(3) P2(3) CF(56) CF2(56)
 V(1) NPTS(23836603) PPTS(23836643) P(2) P2(1) CF(57) CF2(55)
 changing PTS from 23836523 to 23836523. delta 0
 V(1) NPTS(23836723) PPTS(23836603) P(3) P2(3) CF(58) CF2(58)
 V(1) NPTS(23836683) PPTS(23836723) P(2) P2(2) CF(59) CF2(57)
 V(1) NPTS(23836803) PPTS(23836683) P(3) P2(3) CF(60) CF2(60)
 V(1) NPTS(23836763) PPTS(23836803) P(2) P2(2) CF(61) CF2(59)
 V(1) NPTS(23836883) PPTS(23836763) P(3) P2(3) CF(62) CF2(62)
 V(1) NPTS(23836843) PPTS(23836883) P(2) P2(2) CF(63) CF2(61)
 V(1) NPTS(23836963) PPTS(23836843) P(3) P2(3) CF(64) CF2(64)
 V(1) NPTS(23836923) PPTS(23836963) P(2) P2(2) CF(65) CF2(63)
 V(1) NPTS(23837043) PPTS(23836923) P(3) P2(3) CF(66) CF2(66)
 V(1) NPTS(23837003) PPTS(23837043) P(1) P2(2) CF(67) CF2(65)
 V(1) NPTS(23837123) PPTS(23837003) P(3) P2(3) CF(68) CF2(68)
 V(1) NPTS(23837083) PPTS(23837123) P(2) P2(1) CF(69) CF2(67)
 changing PTS from 23837003 to 23837003. delta 0
 V(1) NPTS(23837203) PPTS(23837083) P(3) P2(3) CF(70) CF2(70)
 V(1) NPTS(23837163) PPTS(23837203) P(2) P2(2) CF(71) CF2(69)
 V(1) NPTS(23837283) PPTS(23837163) P(3) P2(3) CF(72) CF2(72)
 V(1) NPTS(23837243) PPTS(23837283) P(2) P2(2) CF(73) CF2(71)
 V(1) NPTS(23837363) PPTS(23837243) P(3) P2(3) CF(74) CF2(74)
 V(1) NPTS(23837323) PPTS(23837363) P(2) P2(2) CF(75) CF2(73)
 V(1) NPTS(23837443) PPTS(23837323) P(3) P2(3) CF(76) CF2(76)
 V(1) NPTS(23837403) PPTS(23837443) P(2) P2(2) CF(77) CF2(75)
 V(1) NPTS(23837523) PPTS(23837403) P(3) P2(3) CF(78) CF2(78)
 V(1) NPTS(23837483) PPTS(23837523) P(1) P2(2) CF(79) CF2(77)
 V(1) NPTS(23837603) PPTS(23837483) P(3) P2(3) CF(80) CF2(80)
 V(1) NPTS(23837563) PPTS(23837603) P(2) P2(1) CF(81) CF2(79)
 changing PTS from 23837483 to 23837483. delta 0
 V(1) NPTS(23837683) PPTS(23837563) P(3) P2(3) CF(82) CF2(82)
 V(1) NPTS(23837643) PPTS(23837683) P(2) P2(2) CF(83) CF2(81)
 V(1) NPTS(23837763) PPTS(23837643) P(3) P2(3) CF(84) CF2(84)
 V(1) NPTS(23837723) PPTS(23837763) P(2) P2(2) CF(85) CF2(83)
 V(1) NPTS(23837843) PPTS(23837723) P(3) P2(3) CF(86) CF2(86)
 V(1) NPTS(23837803) PPTS(23837843) P(2) P2(2) CF(87) CF2(85)
 V(1) NPTS(23837923) PPTS(23837803) P(3) P2(3) CF(88) CF2(88)
 V(1) NPTS(23837883) PPTS(23837923) P(2) P2(2) CF(89) CF2(87)
 V(1) NPTS(23838003) PPTS(23837883) P(3) P2(3) CF(90) CF2(90)
 V(1) NPTS(23837963) PPTS(23838003) P(1) P2(2) CF(91) CF2(89)
 V(1) NPTS(23838083) PPTS(23837963) P(3) P2(3) CF(92) CF2(92)
 V(1) NPTS(23838043) PPTS(23838083) P(2) P2(1) CF(93) CF2(91)
 changing PTS from 23837963 to 23837963. delta 0
 V(1) NPTS(23838163) PPTS(23838043) P(3) P2(3) CF(94) CF2(94)
 V(1) NPTS(23838123) PPTS(23838163) P(2) P2(2) CF(95) CF2(93)
 V(1) NPTS(23838243) PPTS(23838123) P(3) P2(3) CF(96) CF2(96)

-3 log:

[softdevice] allocating picture buffer for resolution 720x576
 V(1) NPTS(23915803) PPTS(23915843) P(2) P2(1) CF(1) CF2(0)
 V(1) NPTS(23915923) PPTS(23915803) P(3) P2(3) CF(2) CF2(2)
 V(1) NPTS(23915883) PPTS(23915923) P(2) P2(2) CF(3) CF2(1)
 V(1) NPTS(23916003) PPTS(23915883) P(3) P2(3) CF(4) CF2(4)
 V(1) NPTS(23915963) PPTS(23916003) P(2) P2(2) CF(5) CF2(3)
 V(1) NPTS(23916083) PPTS(23915963) P(3) P2(3) CF(6) CF2(6)
 V(1) NPTS(23916043) PPTS(23916083) P(2) P2(2) CF(7) CF2(5)
 V(1) NPTS(23916163) PPTS(23916043) P(3) P2(3) CF(8) CF2(8)
 V(1) NPTS(23916123) PPTS(23916163) P(2) P2(2) CF(9) CF2(7)
 V(1) NPTS(23916243) PPTS(23916123) P(3) P2(3) CF(10) CF2(10)
 V(1) NPTS(23916203) PPTS(23916243) P(1) P2(2) CF(11) CF2(9)
 V(1) NPTS(23916323) PPTS(23916203) P(3) P2(3) CF(12) CF2(12)
 V(1) NPTS(23916283) PPTS(23916323) P(2) P2(1) CF(13) CF2(11)
 changing PTS from 23916203 to 23916243. delta 40
 V(1) NPTS(23916403) PPTS(23916283) P(3) P2(3) CF(14) CF2(14)
 V(1) NPTS(23916363) PPTS(23916403) P(2) P2(2) CF(15) CF2(13)
 V(1) NPTS(23916483) PPTS(23916363) P(3) P2(3) CF(16) CF2(16)
 V(1) NPTS(23916443) PPTS(23916483) P(2) P2(2) CF(17) CF2(15)
 V(1) NPTS(23916563) PPTS(23916443) P(3) P2(3) CF(18) CF2(18)
 V(1) NPTS(23916523) PPTS(23916563) P(2) P2(2) CF(19) CF2(17)
 V(1) NPTS(23916643) PPTS(23916523) P(3) P2(3) CF(20) CF2(20)
 V(1) NPTS(23916603) PPTS(23916643) P(2) P2(2) CF(21) CF2(19)
 V(1) NPTS(23916723) PPTS(23916603) P(3) P2(3) CF(22) CF2(22)
 V(1) NPTS(23916683) PPTS(23916723) P(1) P2(2) CF(23) CF2(21)
 V(1) NPTS(23916803) PPTS(23916683) P(3) P2(3) CF(24) CF2(24)
 V(1) NPTS(23916763) PPTS(23916803) P(2) P2(1) CF(25) CF2(23)
 changing PTS from 23916723 to 23916723. delta 0
 V(1) NPTS(23916883) PPTS(23916763) P(3) P2(3) CF(26) CF2(26)
 V(1) NPTS(23916843) PPTS(23916883) P(2) P2(2) CF(27) CF2(25)
 V(1) NPTS(23916963) PPTS(23916843) P(3) P2(3) CF(28) CF2(28)
 V(1) NPTS(23916923) PPTS(23916963) P(2) P2(2) CF(29) CF2(27)
 V(1) NPTS(23917043) PPTS(23916923) P(3) P2(3) CF(30) CF2(30)
 V(1) NPTS(23917003) PPTS(23917043) P(2) P2(2) CF(31) CF2(29)
 V(1) NPTS(23917123) PPTS(23917003) P(3) P2(3) CF(32) CF2(32)
 V(1) NPTS(23917083) PPTS(23917123) P(1) P2(2) CF(33) CF2(31)
 V(1) NPTS(23917203) PPTS(23917083) P(3) P2(3) CF(34) CF2(34)
 V(1) NPTS(23917163) PPTS(23917203) P(2) P2(1) CF(35) CF2(33)
 changing PTS from 23917123 to 23917123. delta 0
 V(1) NPTS(23917283) PPTS(23917163) P(3) P2(3) CF(36) CF2(36)
 V(1) NPTS(23917243) PPTS(23917283) P(2) P2(2) CF(37) CF2(35)
 V(1) NPTS(23917363) PPTS(23917243) P(3) P2(3) CF(38) CF2(38)
 V(1) NPTS(23917323) PPTS(23917363) P(2) P2(2) CF(39) CF2(37)
 V(1) NPTS(23917443) PPTS(23917323) P(3) P2(3) CF(40) CF2(40)
 V(1) NPTS(23917403) PPTS(23917443) P(2) P2(2) CF(41) CF2(39)
 V(1) NPTS(23917523) PPTS(23917403) P(3) P2(3) CF(42) CF2(42)
 V(1) NPTS(23917483) PPTS(23917523) P(2) P2(2) CF(43) CF2(41)
 V(1) NPTS(23917603) PPTS(23917483) P(3) P2(3) CF(44) CF2(44)
 V(1) NPTS(23917563) PPTS(23917603) P(1) P2(2) CF(45) CF2(43)
 V(1) NPTS(23917683) PPTS(23917563) P(3) P2(3) CF(46) CF2(46)
 V(1) NPTS(23917643) PPTS(23917683) P(2) P2(1) CF(47) CF2(45)
 changing PTS from 23917603 to 23917603. delta 0
 V(1) NPTS(23917763) PPTS(23917643) P(3) P2(3) CF(48) CF2(48)
 V(1) NPTS(23917723) PPTS(23917763) P(2) P2(2) CF(49) CF2(47)
 V(1) NPTS(23917843) PPTS(23917723) P(3) P2(3) CF(50) CF2(50)
 V(1) NPTS(23917803) PPTS(23917843) P(2) P2(2) CF(51) CF2(49)
 V(1) NPTS(23917923) PPTS(23917803) P(3) P2(3) CF(52) CF2(52)
 V(1) NPTS(23917883) PPTS(23917923) P(2) P2(2) CF(53) CF2(51)
 V(1) NPTS(23918003) PPTS(23917883) P(3) P2(3) CF(54) CF2(54)
 V(1) NPTS(23917963) PPTS(23918003) P(2) P2(2) CF(55) CF2(53)
 V(1) NPTS(23918083) PPTS(23917963) P(3) P2(3) CF(56) CF2(56)
 V(1) NPTS(23918043) PPTS(23918083) P(1) P2(2) CF(57) CF2(55)
 V(1) NPTS(23918163) PPTS(23918043) P(3) P2(3) CF(58) CF2(58)
 V(1) NPTS(23918123) PPTS(23918163) P(2) P2(1) CF(59) CF2(57)
 changing PTS from 23918083 to 23918083. delta 0
 V(1) NPTS(23918243) PPTS(23918123) P(3) P2(3) CF(60) CF2(60)
 V(1) NPTS(23918203) PPTS(23918243) P(2) P2(2) CF(61) CF2(59)
 V(1) NPTS(23918323) PPTS(23918203) P(3) P2(3) CF(62) CF2(62)
 V(1) NPTS(23918283) PPTS(23918323) P(2) P2(2) CF(63) CF2(61)
 V(1) NPTS(23918403) PPTS(23918283) P(3) P2(3) CF(64) CF2(64)
 V(1) NPTS(23918363) PPTS(23918403) P(2) P2(2) CF(65) CF2(63)
 V(1) NPTS(23918483) PPTS(23918363) P(3) P2(3) CF(66) CF2(66)
 V(1) NPTS(23918443) PPTS(23918483) P(2) P2(2) CF(67) CF2(65)
 V(1) NPTS(23918563) PPTS(23918443) P(3) P2(3) CF(68) CF2(68)
 V(1) NPTS(23918523) PPTS(23918563) P(1) P2(2) CF(69) CF2(67)
 V(1) NPTS(23918643) PPTS(23918523) P(3) P2(3) CF(70) CF2(70)
 V(1) NPTS(23918603) PPTS(23918643) P(2) P2(1) CF(71) CF2(69)
 changing PTS from 23918563 to 23918563. delta 0
 V(1) NPTS(23918723) PPTS(23918603) P(3) P2(3) CF(72) CF2(72)
 V(1) NPTS(23918683) PPTS(23918723) P(2) P2(2) CF(73) CF2(71)
 V(1) NPTS(23918803) PPTS(23918683) P(3) P2(3) CF(74) CF2(74)
 V(1) NPTS(23918763) PPTS(23918803) P(2) P2(2) CF(75) CF2(73)
 V(1) NPTS(23918883) PPTS(23918763) P(3) P2(3) CF(76) CF2(76)
 V(1) NPTS(23918843) PPTS(23918883) P(2) P2(2) CF(77) CF2(75)
 V(1) NPTS(23918963) PPTS(23918843) P(3) P2(3) CF(78) CF2(78)
 V(1) NPTS(23918923) PPTS(23918963) P(2) P2(2) CF(79) CF2(77)
 V(1) NPTS(23919043) PPTS(23918923) P(3) P2(3) CF(80) CF2(80)
 V(1) NPTS(23919003) PPTS(23919043) P(1) P2(2) CF(81) CF2(79)
 V(1) NPTS(23919123) PPTS(23919003) P(3) P2(3) CF(82) CF2(82)
 V(1) NPTS(23919083) PPTS(23919123) P(2) P2(1) CF(83) CF2(81)
 changing PTS from 23919043 to 23919043. delta 0
 V(1) NPTS(23919203) PPTS(23919083) P(3) P2(3) CF(84) CF2(84)
 V(1) NPTS(23919163) PPTS(23919203) P(2) P2(2) CF(85) CF2(83)
 V(1) NPTS(23919283) PPTS(23919163) P(3) P2(3) CF(86) CF2(86)
 V(1) NPTS(23919243) PPTS(23919283) P(2) P2(2) CF(87) CF2(85)
 V(1) NPTS(23919363) PPTS(23919243) P(3) P2(3) CF(88) CF2(88)
 V(1) NPTS(23919323) PPTS(23919363) P(2) P2(2) CF(89) CF2(87)
 V(1) NPTS(23919443) PPTS(23919323) P(3) P2(3) CF(90) CF2(90)
 V(1) NPTS(23919403) PPTS(23919443) P(2) P2(2) CF(91) CF2(89)
 V(1) NPTS(23919523) PPTS(23919403) P(3) P2(3) CF(92) CF2(92)
 V(1) NPTS(23919483) PPTS(23919523) P(1) P2(2) CF(93) CF2(91)
 V(1) NPTS(23919603) PPTS(23919483) P(3) P2(3) CF(94) CF2(94)
 V(1) NPTS(23919563) PPTS(23919603) P(2) P2(1) CF(95) CF2(93)
 changing PTS from 23919523 to 23919523. delta 0

-1 log:

[softdevice] allocating picture buffer for resolution 720x576
 V(1) NPTS(24096523) PPTS(24096563) P(2) P2(1) CF(1) CF2(0)
 V(1) NPTS(24096643) PPTS(24096523) P(3) P2(3) CF(2) CF2(2)
 V(1) NPTS(24096603) PPTS(24096643) P(2) P2(2) CF(3) CF2(1)
 V(1) NPTS(24096723) PPTS(24096603) P(3) P2(3) CF(4) CF2(4)
 V(1) NPTS(24096683) PPTS(24096723) P(1) P2(2) CF(5) CF2(3)
 V(1) NPTS(24096803) PPTS(24096683) P(3) P2(3) CF(6) CF2(6)
 V(1) NPTS(24096763) PPTS(24096803) P(2) P2(1) CF(7) CF2(5)
 changing PTS from 24096683 to 24096803. delta 120
 V(1) NPTS(24096883) PPTS(24096763) P(3) P2(3) CF(8) CF2(8)
 V(1) NPTS(24096843) PPTS(24096883) P(2) P2(2) CF(9) CF2(7)
 V(1) NPTS(24096963) PPTS(24096843) P(3) P2(3) CF(10) CF2(10)
 V(1) NPTS(24096923) PPTS(24096963) P(2) P2(2) CF(11) CF2(9)
 V(1) NPTS(24097043) PPTS(24096923) P(3) P2(3) CF(12) CF2(12)
 V(1) NPTS(24097003) PPTS(24097043) P(2) P2(2) CF(13) CF2(11)
 V(1) NPTS(24097123) PPTS(24097003) P(3) P2(3) CF(14) CF2(14)
 V(1) NPTS(24097083) PPTS(24097123) P(2) P2(2) CF(15) CF2(13)
 V(1) NPTS(24097203) PPTS(24097083) P(3) P2(3) CF(16) CF2(16)
 V(1) NPTS(24097163) PPTS(24097203) P(1) P2(2) CF(17) CF2(15)
 V(1) NPTS(24097283) PPTS(24097163) P(3) P2(3) CF(18) CF2(18)
 V(1) NPTS(24097243) PPTS(24097283) P(2) P2(1) CF(19) CF2(17)
 changing PTS from 24097283 to 24097283. delta 0
 V(1) NPTS(24097363) PPTS(24097243) P(3) P2(3) CF(20) CF2(20)
 V(1) NPTS(24097323) PPTS(24097363) P(2) P2(2) CF(21) CF2(19)
 V(1) NPTS(24097443) PPTS(24097323) P(3) P2(3) CF(22) CF2(22)
 V(1) NPTS(24097403) PPTS(24097443) P(2) P2(2) CF(23) CF2(21)
 V(1) NPTS(24097523) PPTS(24097403) P(3) P2(3) CF(24) CF2(24)
 V(1) NPTS(24097483) PPTS(24097523) P(2) P2(2) CF(25) CF2(23)
 V(1) NPTS(24097603) PPTS(24097483) P(3) P2(3) CF(26) CF2(26)
 V(1) NPTS(24097563) PPTS(24097603) P(2) P2(2) CF(27) CF2(25)
 V(1) NPTS(24097683) PPTS(24097563) P(3) P2(3) CF(28) CF2(28)
 V(1) NPTS(24097643) PPTS(24097683) P(1) P2(2) CF(29) CF2(27)
 V(1) NPTS(24097763) PPTS(24097643) P(3) P2(3) CF(30) CF2(30)
 V(1) NPTS(24097723) PPTS(24097763) P(2) P2(1) CF(31) CF2(29)
 changing PTS from 24097763 to 24097763. delta 0
 V(1) NPTS(24097843) PPTS(24097723) P(3) P2(3) CF(32) CF2(32)
 V(1) NPTS(24097803) PPTS(24097843) P(2) P2(2) CF(33) CF2(31)
 V(1) NPTS(24097923) PPTS(24097803) P(3) P2(3) CF(34) CF2(34)
 V(1) NPTS(24097883) PPTS(24097923) P(2) P2(2) CF(35) CF2(33)


-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun Jan 23 09:39:28 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 23 Jan 2005 09:39:28 +0100
Subject: [Softdevice-devel] mgatv & interlaced playback
In-Reply-To: <1106396275.2829.13.camel@localhost.localdomain>
References: <1106396275.2829.13.camel@localhost.localdomain>
Message-ID: <1106469568.41f362c0994d5@webmail.in-berlin.de>

Zitat von Ari Koponen <particle at luukku.com>:

> I managed to get mplayer to play interlaced content smoothly with these
> options: -vo dfbmga:fieldparity=top:buffermode=triple -vsync. I also
> tested with buffermode=single and there were tearing.

I still have some troubles during select of field parity. For select
field_parity I have SetCooperationLevel (.._EXCLUSIVE) instead of
_ADMINISTRATIVE. But this segfault on one box and produces a black screen on an
other one.

> 
> I don't know how softdevice is built but would it be possible to use
> double or triple buffering for DirectFB (or is it already using it?) and
> use interrupt based synchronizing like the mplayer seems to do? Would
> that extra buffering affect channel switching time?

Triple buffering is used implicit.

Stefan Lucke


From ollo.diab at gmx.de  Sat Jan 22 14:58:26 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Sat, 22 Jan 2005 14:58:26 +0100 (MET)
Subject: [Softdevice-devel] HDTV support
References: <20050121102700.28627.13054.Mailman@bat.berlios.de>
Message-ID: <21512.1106402306@www15.gmx.net>

Hi everyone,

I just checked EURO1080 with softdevice, but the picture shown is cut small
in the standard 720x576 window (using xv output).

Any chance to add HDTV support to softdevice?

Thanks,   Thomas

-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl


From torgeir at pobox.com  Mon Jan 24 18:07:27 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 24 Jan 2005 17:07:27 +0000
Subject: [Softdevice-devel] DirectFB output w higher resolution OSD
In-Reply-To: <1105819814.6074.1.camel@atlantis.netenviron.com>
References: <1105806559.28475.15.camel@atlantis.netenviron.com>
	 <200501151901.58841.stefan@lucke.in-berlin.de>
	 <1105819814.6074.1.camel@atlantis.netenviron.com>
Message-ID: <1106586447.13905.1.camel@atlantis.netenviron.com>

On Sat, 2005-01-15 at 20:10 +0000, Torgeir Veimo wrote:
> On Sat, 2005-01-15 at 19:01 +0100, Stefan Lucke wrote:
> > On Samstag, 15. Januar 2005 17:29, Torgeir Veimo wrote:
> > > Can the DirectFB output be set up to use a higher resolution for the
> > > OSD? I'd prefer to have on screen text in the native resolution of my
> > > display while still using the scaler for the video output.
> > 
> > To my knowledge OSD is limited to 672x567 by vdr, see config.h .
> 
> Ok, but I'd rather have that displayed centered in native resolution
> than scaled. A higher resolution OSD would of course be preferred, but
> this can be done later.

Specifying a higher resolution in /etc/directfb together with this patch
enables native resolution OSD with centered display.

[root at vigor10 softdevice]# cvs diff video-dfb.c
Index: video-dfb.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-dfb.c,v
retrieving revision 1.15
diff -r1.15 video-dfb.c
336,339c336,339
<     if (Xres > 768)
<       Xres = 768;
<     if (Yres > 576)
<       Yres = 576;
---
>    // if (Xres > 768)
>    //   Xres = 768;
>    // if (Yres > 576)
>    //   Yres = 576;
838c838,839
<       osdsrc.x = osdsrc.y = 0;
---
>       osdsrc.x = (720 - Xres) >> 1;
>       osdsrc.y = (576 - Yres) >> 1;
998c999,1000
<         osdsrc.x = osdsrc.y = 0;
---
>         osdsrc.x = (720 - Xres) >> 1;
>         osdsrc.y = (576 - Yres) >> 1;

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Mon Jan 24 18:23:32 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 24 Jan 2005 17:23:32 +0000
Subject: [Softdevice-devel] DirectFB output w higher resolution OSD
In-Reply-To: <1106586447.13905.1.camel@atlantis.netenviron.com>
References: <1105806559.28475.15.camel@atlantis.netenviron.com>
	 <200501151901.58841.stefan@lucke.in-berlin.de>
	 <1105819814.6074.1.camel@atlantis.netenviron.com>
	 <1106586447.13905.1.camel@atlantis.netenviron.com>
Message-ID: <1106587412.13905.2.camel@atlantis.netenviron.com>

On Mon, 2005-01-24 at 17:07 +0000, Torgeir Veimo wrote:
> On Sat, 2005-01-15 at 20:10 +0000, Torgeir Veimo wrote:
> > On Sat, 2005-01-15 at 19:01 +0100, Stefan Lucke wrote:
> > > On Samstag, 15. Januar 2005 17:29, Torgeir Veimo wrote:
> > > > Can the DirectFB output be set up to use a higher resolution for the
> > > > OSD? I'd prefer to have on screen text in the native resolution of my
> > > > display while still using the scaler for the video output.
> > > 
> > > To my knowledge OSD is limited to 672x567 by vdr, see config.h .
> > 
> > Ok, but I'd rather have that displayed centered in native resolution
> > than scaled. A higher resolution OSD would of course be preferred, but
> > this can be done later.
> 
> Specifying a higher resolution in /etc/directfb together with this patch
> enables native resolution OSD with centered display.

Forgot, it only works properly for pixelformat YUV2. Would need a check
to avoid using it otherwise. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Wed Jan 26 18:31:43 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 26 Jan 2005 17:31:43 +0000
Subject: [Softdevice-devel] DirectFB radeon output
Message-ID: <1106760704.6239.21.camel@atlantis.netenviron.com>

DirectFB output works ok with an mga card, but I'm struggling with
radeon output. The screen goes all black, and the strange thing is that
if I start up the Xorg server after this, the Xv output windows is also
completely black, but with OSD shown. Any ideas?

[root at vigor10 softdevice]# cat /etc/directfbrc
mode=720x576
#mode=1280x720
depth=32
no-graphics-vt
no-vt-switching
no-vt-switch


[root at vigor10 softdevice]# dfbinfo
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

       ---------------------- DirectFB v0.9.21 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-01-24 13:32)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 5494)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 5495)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: ATI Radeon 0.2 (Michel Dnzer)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)


Screen (00) Radeon Primary Screen           (primary screen)
   Caps: VSYNC POWER_MANAGEMENT

     Layer (00) FBDev Primary Layer             (primary layer)
        Type:    GRAPHICS
        Caps:    SURFACE BRIGHTNESS CONTRAST SATURATION

     Layer (01) Radeon Overlay
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY ALPHACHANNEL SCREEN_LOCATION
SRC_COLORKEY DST_COLORKEY


Input (01) IMPS/2 Mouse                    (primary mouse)
   Type: MOUSE
   Caps: AXES BUTTONS

Input (00) Keyboard                        (primary keyboard)
   Type: KEYBOARD
   Caps: KEYS

[root at vigor10 VDR]# ./rundfb
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
arg: /dev/cdrom
[setup-softdevice] alsa device set to: hw:0,2
[setup-softdevice] A/V Offset set to (-8)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 1 lavc
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YUV2)
[setup-softdevice] startup aspect set to (16:9 wide)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4736)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

       ---------------------- DirectFB v0.9.21 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-01-24 13:32)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 5505)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 5506)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: ATI Radeon 0.2 (Michel Dnzer)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 67108864 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine Blit
All
[dfb] Drawing Flags: none
[dfb] Surface Blitting Flags: SrcColorkey
[dfb] Supported video Modes are: 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8
640x480 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8
800x600 at 8 800x600 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8
1024x768 at 8 1024x768 at 8 1024x768 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8
1152x864 at 8 1152x864 at 8 1152x864 at 8 1024x1024 at 8 1280x1024 at 8 1280x1024 at 8
1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8
1280x720 at 16 1280x720 at 32 720x576 at 32
[dfb] Enumeratig display Layers
Layer 0 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Radeon Overlay  Type: graphics picture video
  Caps: alphachannel dst_colorkey opacity screen_location src_colorkey
surface
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00400c03 bpp = 32
[dfb] Using this layer for OSD: (FBDev Primary Layer - [720x576])
osdSurface::
 - videoonly
 - flipping
videoSurface::
 - videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring ColorKeying
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: FBDev Primary Layer
[dfb] Using this layer for Video out: Radeon Overlay
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[dfb] (re)configured 0x00200806
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
 (!!!)  *** ONCE [only copying/scaling blits supported for YUV in
software] *** [generic.c:3998 in gAcquire()]
[softdevice] allocating picture buffer for resolution 720x576
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[dfb] (re)configured 0x00200806



-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Fri Jan 28 22:09:32 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 28 Jan 2005 22:09:32 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1106760704.6239.21.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
Message-ID: <200501282209.32168.stefan@lucke.in-berlin.de>

On Mittwoch, 26. Januar 2005 18:31, Torgeir Veimo wrote:
> DirectFB output works ok with an mga card, but I'm struggling with
> radeon output. The screen goes all black, and the strange thing is that
> if I start up the Xorg server after this, the Xv output windows is also
> completely black, but with OSD shown. Any ideas?

That may be caused by not restoreing register content to the values found
at startup. With my matrox I've sometimes the opposite effect when
started from an xterm, video is present but OSD is invisible. But that depends
on the selected pixel format (YV12 vs YUV2).


> [setup-softdevice] pixel format set to (YUV2)

With radeons you should select one of the other pixel formats
(should be check/set from our output method according card
capabilities).

-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 29 18:28:38 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 17:28:38 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501282209.32168.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501282209.32168.stefan@lucke.in-berlin.de>
Message-ID: <1107019719.22534.2.camel@atlantis.netenviron.com>

On Fri, 2005-01-28 at 22:09 +0100, Stefan Lucke wrote:
> On Mittwoch, 26. Januar 2005 18:31, Torgeir Veimo wrote:
> > DirectFB output works ok with an mga card, but I'm struggling with
> > radeon output. The screen goes all black, and the strange thing is that
> > if I start up the Xorg server after this, the Xv output windows is also
> > completely black, but with OSD shown. Any ideas?
> 
> That may be caused by not restoreing register content to the values found
> at startup. With my matrox I've sometimes the opposite effect when
> started from an xterm, video is present but OSD is invisible. But that depends
> on the selected pixel format (YV12 vs YUV2).


> > [setup-softdevice] pixel format set to (YUV2)
> 
> With radeons you should select one of the other pixel formats
> (should be check/set from our output method according card
> capabilities).

Yes, I get it running with I420. Would like to use YUV2 though, as it
would allow me to run in 1280x720 resolution. I guess the directfb
radeon driver doesn't fully support the onchip scaler.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Jan 29 18:58:09 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 29 Jan 2005 18:58:09 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1107019719.22534.2.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com> <200501282209.32168.stefan@lucke.in-berlin.de> <1107019719.22534.2.camel@atlantis.netenviron.com>
Message-ID: <200501291858.09877.stefan@lucke.in-berlin.de>

On Samstag, 29. Januar 2005 18:28, Torgeir Veimo wrote:
> On Fri, 2005-01-28 at 22:09 +0100, Stefan Lucke wrote:

> > With radeons you should select one of the other pixel formats
> > (should be check/set from our output method according card
> > capabilities).
> 
> Yes, I get it running with I420. Would like to use YUV2 though, as it
> would allow me to run in 1280x720 resolution. I guess the directfb
> radeon driver doesn't fully support the onchip scaler.

So what is the problem when selecting 1280x720 at 32 ? According to your
reported modes, this should work too. YUV2 doesn't use the backend
scaler, it uses the texture engine (stretch-blit) which isn't supported by
dfb for radeons.

-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 29 19:05:59 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 18:05:59 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501291858.09877.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501282209.32168.stefan@lucke.in-berlin.de>
	 <1107019719.22534.2.camel@atlantis.netenviron.com>
	 <200501291858.09877.stefan@lucke.in-berlin.de>
Message-ID: <1107021959.22743.5.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 18:58 +0100, Stefan Lucke wrote:
> 
> So what is the problem when selecting 1280x720 at 32 ? According to your
> reported modes, this should work too. YUV2 doesn't use the backend
> scaler, it uses the texture engine (stretch-blit) which isn't
> supported by dfb for radeons.

It works, but the image is not scaled to full screen, as happens when I
use a G450 with YUV2 in 1280x720. Should it be possible to scale to full
screen even with I420 if set up correctly? 

I do get some tearing with I420 in 720x576. Will have to look into that.

Some automatic setup based on gfx hardware would probably be an idea.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Jan 29 19:33:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 29 Jan 2005 19:33:39 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1107021959.22743.5.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com> <200501291858.09877.stefan@lucke.in-berlin.de> <1107021959.22743.5.camel@atlantis.netenviron.com>
Message-ID: <200501291933.39728.stefan@lucke.in-berlin.de>

On Samstag, 29. Januar 2005 19:05, Torgeir Veimo wrote:
> On Sat, 2005-01-29 at 18:58 +0100, Stefan Lucke wrote:
> > 
> > So what is the problem when selecting 1280x720 at 32 ? According to your
> > reported modes, this should work too. YUV2 doesn't use the backend
> > scaler, it uses the texture engine (stretch-blit) which isn't
> > supported by dfb for radeons.
> 
> It works, but the image is not scaled to full screen, as happens when I
> use a G450 with YUV2 in 1280x720.

Which scaleing parameters are reported in syslog?

This is scaleing of 4:3 source width/height 704x576 with no source offsets
to a window with width/height 1276x716 and x/y offsets 158/0 to an used
area of width/height 955x716.
Jan 29 19:24:52 jarada vdr[2803]: [VideoOut]: 704x576 [0,0 704x576] -> 1272x716 [158,0 955x716]

> Should it be possible to scale to full
> screen even with I420 if set up correctly? 

Yes.

> 
> I do get some tearing with I420 in 720x576. Will have to look into that.
> 
> Some automatic setup based on gfx hardware would probably be an idea.

Ack.


-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 29 19:33:58 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 18:33:58 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1107021959.22743.5.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501282209.32168.stefan@lucke.in-berlin.de>
	 <1107019719.22534.2.camel@atlantis.netenviron.com>
	 <200501291858.09877.stefan@lucke.in-berlin.de>
	 <1107021959.22743.5.camel@atlantis.netenviron.com>
Message-ID: <1107023638.22743.16.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 18:05 +0000, Torgeir Veimo wrote:
> On Sat, 2005-01-29 at 18:58 +0100, Stefan Lucke wrote:
> > 
> > So what is the problem when selecting 1280x720 at 32 ? According to your
> > reported modes, this should work too. YUV2 doesn't use the backend
> > scaler, it uses the texture engine (stretch-blit) which isn't
> > supported by dfb for radeons.
> 
> It works, but the image is not scaled to full screen, as happens when I
> use a G450 with YUV2 in 1280x720. Should it be possible to scale to full
> screen even with I420 if set up correctly? 

Very strange, I get it to scale to fullscreen in 1280x720 after a number
of channel changed, so it might be to due reconfiguring the video layer.
Not sure if this log fragment reveals anything.

[dfb] Using this layer for OSD: (FBDev Primary Layer - [768x576])
osdSurface::
 - videoonly
 - flipping
 (!!!)  *** WARNING [letting unprivileged
IDirectFBDisplayLayer::GetSurface() call pass until cooperative level
handling is finished] *** [idirectfbdisplaylayer.c:170 in
IDirectFBDisplayLayer_GetSurface()]
videoSurface::
 - videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring ColorKeying
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: FBDev Primary Layer
[dfb] Using this layer for Video out: Radeon Overlay
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
(-) [  NO NAME         1.356] (13388) Core/SurfaceMgr:   Deallocating
614400 bytes at offset 66494464.
(-) [  NO NAME         1.356] (13388) Core/SurfaceMgr:   Allocating
635904 bytes at offset 62319616.
[dfb] (re)configured 0x08100609
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
[softdevice] allocating picture buffer for resolution 720x576
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
[softdevice] allocating picture buffer for resolution 720x576
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
[softdevice] allocating picture buffer for resolution 704x576
[dfb] (re)configuring Videolayer to 704 x 576 (704x576)
(-) [  NO NAME        10.598] (14453) Core/SurfaceMgr:   Deallocating
635904 bytes at offset 62319616.
(-) [  NO NAME        10.598] (14453) Core/SurfaceMgr:   Allocating
608256 bytes at offset 66500608.
[dfb] (re)configured 0x08100609
[softdevice] allocating picture buffer for resolution 704x576
[softdevice] allocating picture buffer for resolution 704x576
[dfb] (re)configuring Videolayer to 704 x 576 (704x576)
[dfb] (re)configured 0x08100609

After this the video is full screen.

Another thing, VDR doesn't seem to close down fully, hanging at this
output;

Releasing DFB
(-) [  NO NAME       120.047] ( 5109) DirectFB/Core: dfb_core_destroy...
(-) [  NO NAME       120.047] ( 5109) Direct/Signals:    Removing
handler 0xb76a780c for signal -1 with context 0x85b10d0...
(-) [  NO NAME       120.047] ( 5109) DirectFB/Core: Shutting down...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:     == Window Pool
==
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> destroying
pool...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> syncing...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> locking...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> pool
destroyed (Window Pool)
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:     == Layer Region
Pool ==
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> destroying
pool...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> syncing...
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> locking...
 (!!!)  *** WARNING [still objects in 'Layer Region Pool'] ***
[object.c:200 in fusion_object_pool_destroy()]
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:     == Layer Region
Pool ==
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> zombie
0x85be940 [3], refs 1
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.047] ( 5109) DirectFB/core/layers: destroying
region 0x85be940 (FBDev Primary Layer, 720x576, configured, enabled,
active, realized - ZOMBIE)
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:     == Layer
Context Pool ==
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> dead
object 0x85b9998 [2]
(-) [  NO NAME       120.047] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.047] ( 5109) DirectFB/core/layers: destroying
context 0x85b9998 (FBDev Primary Layer, active)
(-) [  NO NAME       120.047] ( 5109) DirectFB/core/layers:
dfb_layer_remove_context (FBDev Primary Layer, 0x85b9998)
(-) [  NO NAME       120.047] ( 5109) DirectFB/core/layers:
dfb_layer_context_deactivate (0x85b9998)
(-) [  NO NAME       120.047] ( 5109) DirectFB/core/layers:
dfb_layer_context_activate (0x85b5dc8)
(-) [  NO NAME       120.047] ( 5109) DirectFB/FBDev: dfb_fbdev_set_mode
(surface: 0x85b9f48, mode: 0x85b5728, buffermode: 2)
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:     == Layer Region
Pool ==
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> zombie
0x85ba520 [2], refs 2
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.049] ( 5109) DirectFB/core/layers: destroying
region 0x85ba520 (Radeon Overlay, 720x576, configured, enabled, active,
realized - ZOMBIE)
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:     == Layer Region
Pool ==
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> zombie
0x85b9de8 [1], refs 1
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.049] ( 5109) DirectFB/core/layers: destroying
region 0x85b9de8 (FBDev Primary Layer, 720x576, configured, enabled,
active, realized - ZOMBIE)
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:     == Surface Pool
==
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> dead
object 0x85b9f48 [1]
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.049] ( 5109) Core/Surface:      destroying
0x85b9f48 (720x576)
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> pool
destroyed (Layer Region Pool)
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:     == Layer
Context Pool ==
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> destroying
pool...
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> syncing...
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> locking...
 (!!!)  *** WARNING [still objects in 'Layer Context Pool'] ***
[object.c:200 in fusion_object_pool_destroy()]
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:     == Layer
Context Pool ==
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> zombie
0x85ba1e0 [3], refs 1
(-) [  NO NAME       120.049] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.049] ( 5109) DirectFB/core/layers: destroying
context 0x85ba1e0 (Radeon Overlay, active - ZOMBIE)
(-) [  NO NAME       120.050] ( 5109) DirectFB/core/layers:
dfb_layer_remove_context (Radeon Overlay, 0x85ba1e0)
(-) [  NO NAME       120.050] ( 5109) DirectFB/core/layers:
dfb_layer_context_deactivate (0x85ba1e0)
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Layer
Context Pool ==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> zombie
0x85b5dc8 [1], refs 1
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.050] ( 5109) DirectFB/core/layers: destroying
context 0x85b5dc8 (FBDev Primary Layer, active - ZOMBIE)
(-) [  NO NAME       120.050] ( 5109) DirectFB/core/layers:
dfb_layer_remove_context (FBDev Primary Layer, 0x85b5dc8)
(-) [  NO NAME       120.050] ( 5109) DirectFB/core/layers:
dfb_layer_context_deactivate (0x85b5dc8)
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> pool
destroyed (Layer Context Pool)
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Surface Pool
==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destroying
pool...
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> syncing...
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> locking...
 (!!!)  *** WARNING [still objects in 'Surface Pool'] *** [object.c:200
in fusion_object_pool_destroy()]
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Surface Pool
==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> zombie
0x85bee58 [4], refs 2
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.050] ( 5109) Core/Surface:      destroying
0x85bee58 (720x576 ZOMBIE)
(-) [  NO NAME       120.050] ( 5109) Core/SurfaceMgr:   Deallocating
1695744 bytes at offset 63102976.
(-) [  NO NAME       120.050] ( 5109) Core/SurfaceMgr:   Deallocating
1695744 bytes at offset 64798720.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Surface Pool
==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> zombie
0x85beaa0 [3], refs 2
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.050] ( 5109) Core/Surface:      destroying
0x85beaa0 (720x576 ZOMBIE)
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Surface Pool
==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> zombie
0x85ba680 [2], refs 2
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> calling
destructor...
(-) [  NO NAME       120.050] ( 5109) Core/Surface:      destroying
0x85ba680 (720x576 ZOMBIE)
(-) [  NO NAME       120.050] ( 5109) Core/SurfaceMgr:   Deallocating
635904 bytes at offset 62467072.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destructor
done.
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> pool
destroyed (Surface Pool)
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:     == Palette Pool
==
(-) [  NO NAME       120.050] ( 5109) Fusion/Object:       -> destroying
pool...
(-) [  NO NAME       120.051] ( 5109) Fusion/Object:       -> syncing...
(-) [  NO NAME       120.051] ( 5109) Fusion/Object:       -> locking...
(-) [  NO NAME       120.051] ( 5109) Fusion/Object:       -> pool
destroyed (Palette Pool)
(-) [  NO NAME       120.051] ( 5109) DirectFB/CoreParts: Going to
shutdown 'wm' core...
(-) [  NO NAME       120.051] ( 5109) DirectFB/CoreParts: Going to
shutdown 'layers' core...
(-) [  NO NAME       120.051] ( 5109) DirectFB/CoreParts: Going to
shutdown 'screens' core...
(-) [  NO NAME       120.051] ( 5109) DirectFB/CoreParts: Going to
shutdown 'gfxcard' core...
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON: FIFO Performance
Monitoring:
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:         68
radeon_waitfifo calls
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:        305
register writes (radeon_waitfifo sum)
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:          1 FIFO
wait cycles (depends on CPU)
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:       7787 IDLE
wait cycles (depends on CPU)
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:         67 FIFO
space cache hits(depends on CPU)
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON: Conclusion:
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:  Average register
writes/radeon_waitfifocall:4.49
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:  Average wait
cycles/radeon_waitfifo call: 0.01
(-) [  NO NAME       120.051] ( 5109) DirectFB/RADEON:  Average fifo
space cache hits: 98%
(-) [  NO NAME       120.051] ( 5109) DirectFB/CoreParts: Going to
shutdown 'input' core...
(-) [  NO NAME       120.051] ( 5109) Direct/Thread:     Canceling 5218.
(-) [  NO NAME       120.051] ( 5109) Direct/Thread:     Canceling 5219.
(-) [  NO NAME       120.271] ( 5109) DirectFB/CoreParts: Going to
shutdown 'system' core...
(-) [  NO NAME       120.272] ( 5109) Direct/Thread:     Canceling 5129.
(-) [  NO NAME       120.272] ( 5109) switching back...
(-) [  NO NAME       120.273] ( 5109) switched back...
(-) [  NO NAME       120.338] ( 5109) DirectFB/CoreParts: Going to
shutdown 'colorhash' core...
(-) [  NO NAME       120.338] ( 5109) DirectFB/CoreParts: Going to
shutdown 'clipboard' core...
(-) [  NO NAME       120.338] ( 5109) Direct/Main:       direct_shutdown
() called...
(-) [  NO NAME       120.338] ( 5109) Direct/Main:       ...1 references
left.
(-) [  NO NAME       120.338] ( 5109) Direct/Main:       direct_shutdown
() called...
(-) [  NO NAME       120.338] ( 5109) Direct/Main:       ...shutting
down now.
(-) [  NO NAME       120.338] ( 5109) Direct/Signals:    Shutting
down...

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sat Jan 29 19:45:12 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 18:45:12 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501291933.39728.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501291858.09877.stefan@lucke.in-berlin.de>
	 <1107021959.22743.5.camel@atlantis.netenviron.com>
	 <200501291933.39728.stefan@lucke.in-berlin.de>
Message-ID: <1107024313.22743.25.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 19:33 +0100, Stefan Lucke wrote:
> 
> Which scaleing parameters are reported in syslog?

If I start with BBC 1 as initial channel, video not full screen;

Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: aspect changed (-100 ->
15 ; -100.000000 -> 1.777778)
Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: 720x576 [0,0 720x576] ->
1280x720 [0,0 1280x720]

Startup with channel four, video full screen initially;

Jan 29 18:41:33 vigor10 vdr[17355]: [VideoOut]: resolution changed: W
(720 -> 704); H(576 ->576)
Jan 29 18:41:33 vigor10 vdr[17355]: [VideoOut]: aspect changed (-100 ->
9 ; -100.000000 -> 1.333333)
Jan 29 18:41:33 vigor10 vdr[17355]: [VideoOut]: 704x576 [0,0 704x576] ->
1280x720 [160,0 960x720]

Or when changing from BBC 1 to channel four directly;

Jan 29 18:38:24 vigor10 vdr[17017]: [VideoOut]: aspect changed (8 -> 9 ;
1.777778 -> 1.333333)
Jan 29 18:38:24 vigor10 vdr[17017]: [VideoOut]: 704x576 [0,0 704x576] ->
1280x720 [160,0 960x720]
Jan 29 18:38:24 vigor10 vdr[17015]: [softdevice-audio]: xrun


-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Jan 29 21:16:20 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 29 Jan 2005 21:16:20 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1107024313.22743.25.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com> <200501291933.39728.stefan@lucke.in-berlin.de> <1107024313.22743.25.camel@atlantis.netenviron.com>
Message-ID: <200501292116.20852.stefan@lucke.in-berlin.de>

On Samstag, 29. Januar 2005 19:45, Torgeir Veimo wrote:
> On Sat, 2005-01-29 at 19:33 +0100, Stefan Lucke wrote:
> > 
> > Which scaleing parameters are reported in syslog?
> 
> If I start with BBC 1 as initial channel, video not full screen;
> 
> Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: aspect changed (-100 ->
> 15 ; -100.000000 -> 1.777778)
> Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: 720x576 [0,0 720x576] ->
> 1280x720 [0,0 1280x720]

All parameters are ok and should scale to fullscreen. Maybe what you see
is the same I have, when selecting 1024x768 instead of 1280x1024. In that
case video is shown unscaled (in source width/height) in the upper left corner
of the screen. Toggeling pixel aspect via OSD recovers to the right scaleing
setup. If that toggeling resolves your problem too, then this is to my opinion
a bug in directfb and should be discussed on their devel list.


-- 
Stefan Lucke



From torgeir at pobox.com  Sat Jan 29 21:30:11 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 20:30:11 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501292116.20852.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501291933.39728.stefan@lucke.in-berlin.de>
	 <1107024313.22743.25.camel@atlantis.netenviron.com>
	 <200501292116.20852.stefan@lucke.in-berlin.de>
Message-ID: <1107030611.22743.42.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 21:16 +0100, Stefan Lucke wrote:
> On Samstag, 29. Januar 2005 19:45, Torgeir Veimo wrote:
> > On Sat, 2005-01-29 at 19:33 +0100, Stefan Lucke wrote:
> > > 
> > > Which scaleing parameters are reported in syslog?
> > 
> > If I start with BBC 1 as initial channel, video not full screen;
> > 
> > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: aspect changed (-100 ->
> > 15 ; -100.000000 -> 1.777778)
> > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: 720x576 [0,0 720x576] ->
> > 1280x720 [0,0 1280x720]
> 
> All parameters are ok and should scale to fullscreen. Maybe what you see
> is the same I have, when selecting 1024x768 instead of 1280x1024. In that
> case video is shown unscaled (in source width/height) in the upper left corner
> of the screen. Toggeling pixel aspect via OSD recovers to the right scaleing
> setup. If that toggeling resolves your problem too, then this is to my opinion
> a bug in directfb and should be discussed on their devel list.

Yes, toggling aspect ratio fixes it. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sat Jan 29 21:32:34 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 20:32:34 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501292116.20852.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <200501291933.39728.stefan@lucke.in-berlin.de>
	 <1107024313.22743.25.camel@atlantis.netenviron.com>
	 <200501292116.20852.stefan@lucke.in-berlin.de>
Message-ID: <1107030754.22743.46.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 21:16 +0100, Stefan Lucke wrote:
> On Samstag, 29. Januar 2005 19:45, Torgeir Veimo wrote:
> > On Sat, 2005-01-29 at 19:33 +0100, Stefan Lucke wrote:
> > > 
> > > Which scaleing parameters are reported in syslog?
> > 
> > If I start with BBC 1 as initial channel, video not full screen;
> > 
> > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: aspect changed (-100 ->
> > 15 ; -100.000000 -> 1.777778)
> > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: 720x576 [0,0 720x576] ->
> > 1280x720 [0,0 1280x720]
> 
> All parameters are ok and should scale to fullscreen. Maybe what you see
> is the same I have, when selecting 1024x768 instead of 1280x1024. In that
> case video is shown unscaled (in source width/height) in the upper left corner
> of the screen. Toggeling pixel aspect via OSD recovers to the right scaleing
> setup. If that toggeling resolves your problem too, then this is to my opinion
> a bug in directfb and should be discussed on their devel list.

My radeon directfb setup is nearing completion :), now only the tearing
issue remains. I've seen that the radeon driver doesn't do conditionally
wait for vsync in FlipRegion, as the matrox driver does.
-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Jan 29 22:14:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 29 Jan 2005 22:14:39 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <1107030611.22743.42.camel@atlantis.netenviron.com>
References: <1106760704.6239.21.camel@atlantis.netenviron.com> <200501292116.20852.stefan@lucke.in-berlin.de> <1107030611.22743.42.camel@atlantis.netenviron.com>
Message-ID: <200501292214.39905.stefan@lucke.in-berlin.de>

On Samstag, 29. Januar 2005 21:30, Torgeir Veimo wrote:
> On Sat, 2005-01-29 at 21:16 +0100, Stefan Lucke wrote:
> > On Samstag, 29. Januar 2005 19:45, Torgeir Veimo wrote:
> > > On Sat, 2005-01-29 at 19:33 +0100, Stefan Lucke wrote:
> > > > 
> > > > Which scaleing parameters are reported in syslog?
> > > 
> > > If I start with BBC 1 as initial channel, video not full screen;
> > > 
> > > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: aspect changed (-100 ->
> > > 15 ; -100.000000 -> 1.777778)
> > > Jan 29 18:43:28 vigor10 vdr[17467]: [VideoOut]: 720x576 [0,0 720x576] ->
> > > 1280x720 [0,0 1280x720]
> > 
> > All parameters are ok and should scale to fullscreen. Maybe what you see
> > is the same I have, when selecting 1024x768 instead of 1280x1024. In that
> > case video is shown unscaled (in source width/height) in the upper left corner
> > of the screen. Toggeling pixel aspect via OSD recovers to the right scaleing
> > setup. If that toggeling resolves your problem too, then this is to my opinion
> > a bug in directfb and should be discussed on their devel list.
> 
> Yes, toggling aspect ratio fixes it. 

So it is common between different drivers: yours is radeon and mine is matrox.
Please try attached diff, which fixes (and reports something via fprintfs) my
problem at 1024x768.

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb_screenlocation_reporting_fix.diff
Type: text/x-diff
Size: 939 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050129/d37b0ab4/attachment.diff>

From stefan at lucke.in-berlin.de  Sat Jan 29 22:36:33 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 29 Jan 2005 22:36:33 +0100
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501292214.39905.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com> <1107030611.22743.42.camel@atlantis.netenviron.com> <200501292214.39905.stefan@lucke.in-berlin.de>
Message-ID: <200501292236.33914.stefan@lucke.in-berlin.de>

On Samstag, 29. Januar 2005 22:14, Stefan Lucke wrote:

> So it is common between different drivers: yours is radeon and mine is matrox.
> Please try attached diff, which fixes (and reports something via fprintfs) my
> problem at 1024x768.

Depending on your directfb version previous patch wouldn't apply.
So here's the short form.

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb_screenlocation_reporting_fix-01.diff
Type: text/x-diff
Size: 457 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050129/a9d8cd5c/attachment.diff>

From torgeir at pobox.com  Sat Jan 29 22:57:05 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 29 Jan 2005 21:57:05 +0000
Subject: [Softdevice-devel] DirectFB radeon output
In-Reply-To: <200501292236.33914.stefan@lucke.in-berlin.de>
References: <1106760704.6239.21.camel@atlantis.netenviron.com>
	 <1107030611.22743.42.camel@atlantis.netenviron.com>
	 <200501292214.39905.stefan@lucke.in-berlin.de>
	 <200501292236.33914.stefan@lucke.in-berlin.de>
Message-ID: <1107035825.22743.50.camel@atlantis.netenviron.com>

On Sat, 2005-01-29 at 22:36 +0100, Stefan Lucke wrote:
> On Samstag, 29. Januar 2005 22:14, Stefan Lucke wrote:
> 
> > So it is common between different drivers: yours is radeon and mine is matrox.
> > Please try attached diff, which fixes (and reports something via fprintfs) my
> > problem at 1024x768.
> 
> Depending on your directfb version previous patch wouldn't apply.
> So here's the short form.

This seems to fix it. Did only a few quick tests though.

I changed the flip method in radeon_overlay.c to read

static DFBResult
ov0FlipRegion( CoreLayer           *layer,
               void                *driver_data,
               void                *layer_data,
               void                *region_data,
               CoreSurface         *surface,
               DFBSurfaceFlipFlags  flags )
{
    RADEONDriverData       *rdrv = (RADEONDriverData*) driver_data;
    RadeonOverlayLayerData *rov0 = (RadeonOverlayLayerData*) layer_data;

    dfb_surface_flip_buffers( surface, false );

    ov_calc_buffer_regs( rdrv, rov0, surface );
    
    if ( flags & DSFLIP_ONSYNC )
        dfb_screen_wait_vsync( dfb_screens_at( DSCID_PRIMARY ) );
    
    ov_set_buffer_regs( rdrv, rov0, surface ); 
    
    
    if (flags & DSFLIP_WAIT)
        dfb_screen_wait_vsync( dfb_screens_at( DSCID_PRIMARY ) ); 

    return DFB_OK;
}

It seems to improve tearing a bit, but I'm not sure it's perfect yet.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Tue Feb  1 19:25:46 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 01 Feb 2005 18:25:46 +0000
Subject: [Softdevice-devel] Tearing w I410 output
Message-ID: <1107282346.6581.4.camel@atlantis.netenviron.com>

I see this both with the radeon and a G400, but I cannot see why this is
happening, except errors in my directfb setup. Output is done using
mempcy to offscreen memory and the a Flip is done?

I've configured directfb as 

./configure --with-gfxdrivers=radeon,nvidia,matrox,ati128 --enable-debug
--enable-fbdev --enable-sysfs

Any idead?
-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Sat Feb  5 14:01:07 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 05 Feb 2005 14:01:07 +0100
Subject: [Softdevice-devel] PATCH: OSD scaling && and real alpha blending for XV
Message-ID: <4204C393.7030802@gmx.net>

Hi all,

I've created a patch which adds true alpha blending done in software to 
XV-out. The method is the following, first it transforms the OSD to YUV 
format and scales it down, if the current video stream is smaller than 
the DVB standard 736x576. This image is then overlayed over each video 
frame, respecting the alpha values. The result is shown via the normal 
output method. In principle this should be feasible for all output 
methods, but for now I only implemented it for xv.
Since I had to write a scaling routine I also implemented OSD scaling to 
Xv out, changing between true alpha blending and pseudo alpha blending 
can be done via OSD menu.

It works already quite well, I tested it with the text2skin plugin 
version 1.0 and several skins. The speed for the software overlay is 
quite okay, the routine uses MMX optimized code. On my machine, an 
Athlon-1GHz the cpu usage raises from ca. 30% to ca 40% when OSD is 
shown. Since the Athlon doesn't have MMX2 (only 3Dnow, which is somehow 
similar) I could not test MMX2 and  I would like to ask people owning a 
processor which has MMX2 extension to test my patch and report if its 
working (especially people who own an intel processor).
Ah, and before I forget to mention it, I didn't test the other output 
methods and vdr-1.2.6, so this patch might break other things than 
vdr-1.3.19 and XV-out...

I would appreciate any comments!
Cheers,
Martin




-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Alpha_blend.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050205/c21c0d0c/attachment.ksh>

From ollo.diab at gmx.de  Tue Feb  8 11:14:27 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Tue, 8 Feb 2005 11:14:27 +0100 (MET)
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
Message-ID: <29471.1107857667@www32.gmx.net>

Hi Martin,

I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
cvs, AthlonXP). Just one minor issue, the software mode does not get saved
in the setup file of vdr (have to reenable software OSD after every restart
of VDR).

Great Job!

Thanks,  Thomas

-- 
Lassen Sie Ihren Gedanken freien Lauf... z.B. per FreeSMS
GMX bietet bis zu 100 FreeSMS/Monat: http://www.gmx.net/de/go/mail


From stefan at lucke.in-berlin.de  Tue Feb  8 22:43:03 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 8 Feb 2005 22:43:03 +0100
Subject: [Softdevice-devel] Re: [directfb-users] Re: G550, TV-Out, SetFieldParity
In-Reply-To: <20050208194639.GA9281@realh.co.uk>
References: <200501290905.14927.stefan@lucke.in-berlin.de> <200502072201.54897.stefan@lucke.in-berlin.de> <20050208194639.GA9281@realh.co.uk>
Message-ID: <200502082243.03416.stefan@lucke.in-berlin.de>

On Dienstag, 8. Februar 2005 20:46, Tony Houghton wrote:
> In <200502072201.54897.stefan at lucke.in-berlin.de>, Stefan Lucke wrote:
> 
> > Back to the  list (the right one ?):
> 
> It's mostly on-topic, but I may want to bring up some related points
> that are related to VDR and not DirectFB.
> 
> > On Sonntag, 6. Februar 2005 21:12, Tony Houghton wrote:
> > > 
> > > Unfortunately I'm only getting a blank white screen - with black bars
> > > top and bottom, because the 16:9 option only works if I select it
> > > manually at start-up, but that problem is lower priority ATM! VDR is
> > > working correctly in the background, I can hear the sound and change
> > > channels. When the OSD comes up I can see a white area overlapping the
> > > border in the shape of the proper OSD. I remember seeing this white
> > > screen phenomenon before, but I can't remember why or what I did to stop
> > > it.
> > 
> > That previous diff failed the test on my vdr-1.2.1 G400 system too, got
> > a flickering green image via s-video. But time goes on and this next one
> > works with:
> >
> > a) vdr-1.3.18, DirectFB cvs from 2005-02-05, G550, composite out +
> > monitor, P4 2.2G
> > b) vdr-1.2.1, DirectFB 0.9.20, G400, s-video out, P3 Celeron 1.2G
> 
> c) vdr-1.3.19, DirectFB 0.9.21, G450, S-Video, P3 Celeron 1.2GHz.
> 
> :-)

OK, I commited the diff to cvs.

> 
> > To be honest, on system "b" viewing is unacceptable. When OSD kicks in,
> > video seems to be slow motion. Without OSD there is a jitter/flicker
> > every now and then. CPU load at that time was about 50%.
> > 
> > That has to be resolved too, next step(s). I'm wondering why these
> > effects are not noticable on system "a".
> 

So now we get OT for this list and should continue on softdevice-devel.
https://lists.berlios.de/mailman/listinfo/softdevice-devel

> It works quite smoothly for me with the same CPU as your (b), so I
> suspect it's due more to the outdated VDR or (more likely) DirectFB than
> CPU power. VDR 1.2 may be worth supporting until 1.3 becomes 1.4 stable
> release, but I think you should try upgrading from DirectFB 0.9.20 to
> .21 before worrying.
> 
> I do have some issues though, I'm afraid:
> 
> (a) A/V sync is a bit of a problem. It's probably mostly my fault for
> buying a sound card that cost only about ?5 new and may therefore have a
> dodgy clock, but without any guarantee that a more expensive card would
> fix the problem I'd rather see a software workaround of dynamic
> resampling. I'm willing to do most of the work on this myself, but I
> think I might need lots of help from you, explaining the stages the
> sound goes through as it's decoded and buffered etc.
> 
> (b) Sometimes when starting VDR after using MPlayer I get the blank
> white screen problem again and I can't make it work properly until I
> reboot.
> 
> (c) I can't use VDR's mplayer plugin for two reasons. One is that
> softdevice appears to be leaving the sound card tied up, so mplayer
> can't play sound. The other is that when returning to VDR it either
> plays a couple of seconds of sound with a black screen, then locks up
> with lots of ringbuffer errors in the log, or produces a garbled screen
> in garish colours with only room for about half the OSD. When I used to
> use th DXR3 plugin, starting the mplayer plugin would pop up a message
> about releasing DXR3 devices, so I guess something similar is needed for
> softdevice to make it fully shut down and reinitialise.
> 


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Feb  8 23:14:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 8 Feb 2005 23:14:30 +0100
Subject: [Softdevice-devel] Re: [directfb-users] Re: G550, TV-Out, SetFieldParity
In-Reply-To: <200502082243.03416.stefan@lucke.in-berlin.de>
References: <200501290905.14927.stefan@lucke.in-berlin.de> <20050208194639.GA9281@realh.co.uk> <200502082243.03416.stefan@lucke.in-berlin.de>
Message-ID: <200502082314.30756.stefan@lucke.in-berlin.de>

On Dienstag, 8. Februar 2005 22:43, Stefan Lucke wrote:
> On Dienstag, 8. Februar 2005 20:46, Tony Houghton wrote:
> > In <200502072201.54897.stefan at lucke.in-berlin.de>, Stefan Lucke wrote:
> > 

> > > On Sonntag, 6. Februar 2005 21:12, Tony Houghton wrote:
> > > > 
> > > > Unfortunately I'm only getting a blank white screen - with black bars
> > > > top and bottom, because the 16:9 option only works if I select it
> > > > manually at start-up, but that problem is lower priority ATM! VDR is
> > > > working correctly in the background, I can hear the sound and change
> > > > channels. When the OSD comes up I can see a white area overlapping the
> > > > border in the shape of the proper OSD. I remember seeing this white
> > > > screen phenomenon before, but I can't remember why or what I did to stop
> > > > it.
> > > 
> > > That previous diff failed the test on my vdr-1.2.1 G400 system too, got
> > > a flickering green image via s-video. But time goes on and this next one
> > > works with:
> > >
> > > a) vdr-1.3.18, DirectFB cvs from 2005-02-05, G550, composite out +
> > > monitor, P4 2.2G
> > > b) vdr-1.2.1, DirectFB 0.9.20, G400, s-video out, P3 Celeron 1.2G
> > 
> > c) vdr-1.3.19, DirectFB 0.9.21, G450, S-Video, P3 Celeron 1.2GHz.
> > 
> > :-)
> 
> OK, I commited the diff to cvs.
> 
> > 
> > > To be honest, on system "b" viewing is unacceptable. When OSD kicks in,
> > > video seems to be slow motion. Without OSD there is a jitter/flicker
> > > every now and then. CPU load at that time was about 50%.
> > > 
> > > That has to be resolved too, next step(s). I'm wondering why these
> > > effects are not noticable on system "a".
> > 
> 
> So now we get OT for this list and should continue on softdevice-devel.
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
> 
> > It works quite smoothly for me with the same CPU as your (b), so I
> > suspect it's due more to the outdated VDR or (more likely) DirectFB than
> > CPU power. VDR 1.2 may be worth supporting until 1.3 becomes 1.4 stable
> > release, but I think you should try upgrading from DirectFB 0.9.20 to
> > .21 before worrying.

As I remember the OSD drawing changed between vdr 1.2.x and 1.3.x ,
in 1.2 there was a OSD refresh after each frame. So this may be the
main issue with my observation.
We still do not take into account dirty regions and do not mark them
as "Clean" for drawing optimisation.

> > 
> > I do have some issues though, I'm afraid:
> > 
> > (a) A/V sync is a bit of a problem. It's probably mostly my fault for
> > buying a sound card that cost only about ?5 new and may therefore have a
> > dodgy clock, but without any guarantee that a more expensive card would
> > fix the problem I'd rather see a software workaround of dynamic
> > resampling. I'm willing to do most of the work on this myself, but I
> > think I might need lots of help from you, explaining the stages the
> > sound goes through as it's decoded and buffered etc.

Is that sync issue common between all channels or for a specific one ?

> > 
> > (b) Sometimes when starting VDR after using MPlayer I get the blank
> > white screen problem again and I can't make it work properly until I
> > reboot.

mplayer problem !?

> > 
> > (c) I can't use VDR's mplayer plugin for two reasons. One is that
> > softdevice appears to be leaving the sound card tied up, so mplayer
> > can't play sound. The other is that when returning to VDR it either
> > plays a couple of seconds of sound with a black screen, then locks up
> > with lots of ringbuffer errors in the log, or produces a garbled screen
> > in garish colours with only room for about half the OSD. When I used to
> > use th DXR3 plugin, starting the mplayer plugin would pop up a message
> > about releasing DXR3 devices, so I guess something similar is needed for
> > softdevice to make it fully shut down and reinitialise.

So dfb-out should resume reconnect (as xv-out does) dfb, someone else
asked for that too. The only problem I see with such a feature is that I see
no way at the moment to reconnect, as in such a situation I have to release
everything I allocated of dfb.

-- 
Stefan Lucke



From h at realh.co.uk  Wed Feb  9 00:04:09 2005
From: h at realh.co.uk (Tony Houghton)
Date: Tue, 8 Feb 2005 23:04:09 +0000
Subject: [Softdevice-devel] Re: [directfb-users] Re: G550, TV-Out, SetFieldParity
In-Reply-To: <200502082314.30756.stefan@lucke.in-berlin.de>
References: <200501290905.14927.stefan@lucke.in-berlin.de> <20050208194639.GA9281@realh.co.uk> <200502082243.03416.stefan@lucke.in-berlin.de> <200502082314.30756.stefan@lucke.in-berlin.de>
Message-ID: <20050208230409.GB5452@realh.co.uk>

In <200502082314.30756.stefan at lucke.in-berlin.de>, you wrote:

> > > (a) A/V sync is a bit of a problem. It's probably mostly my fault for
> > > buying a sound card that cost only about ?5 new and may therefore have a
> > > dodgy clock, but without any guarantee that a more expensive card would
> > > fix the problem I'd rather see a software workaround of dynamic
> > > resampling. I'm willing to do most of the work on this myself, but I
> > > think I might need lots of help from you, explaining the stages the
> > > sound goes through as it's decoded and buffered etc.
> 
> Is that sync issue common between all channels or for a specific one ?

I haven't had time to sit and watch anything long enough to really tell
the extent, but it seems all channels can go out of sync a little bit.
One time on BBC 1 it got really bad. I heard a few vague things
suggesting BBC may have issues that other channels don't.

> > > 
> > > (b) Sometimes when starting VDR after using MPlayer I get the blank
> > > white screen problem again and I can't make it work properly until I
> > > reboot.
> 
> mplayer problem !?

MPlayer works OK, and IIRC it can be restarted and work normally after
VDR has failed in this way. Those are the only two working DFP apps I
have currently. If it's beyond softdevice's control, I would have
thought it's more likely to be DirectFB's fault than MPlayer's.

> > > (c) I can't use VDR's mplayer plugin for two reasons. One is that
> > > softdevice appears to be leaving the sound card tied up, so mplayer
> > > can't play sound. The other is that when returning to VDR it either
> > > plays a couple of seconds of sound with a black screen, then locks up
> > > with lots of ringbuffer errors in the log, or produces a garbled screen
> > > in garish colours with only room for about half the OSD. When I used to
> > > use th DXR3 plugin, starting the mplayer plugin would pop up a message
> > > about releasing DXR3 devices, so I guess something similar is needed for
> > > softdevice to make it fully shut down and reinitialise.
> 
> So dfb-out should resume reconnect (as xv-out does) dfb, someone else
> asked for that too. The only problem I see with such a feature is that I see
> no way at the moment to reconnect, as in such a situation I have to release
> everything I allocated of dfb.

Can't you release it all before mplayer.sh starts, then reallocate it
afterwards?

-- 
TH * http://www.realh.co.uk


From lucianm at users.sourceforge.net  Wed Feb  9 14:54:56 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 9 Feb 2005 14:54:56 +0100
Subject: [Softdevice-devel] RE: [directfb-users] Re: df_xine with Matrox G450 TV-out
In-Reply-To: <20050208194725.GA17966@sci.fi>
Message-ID: <EBECIPPNBDCCLOJFHAJLGEEMCDAA.lucianm@users.sourceforge.net>

> -----Original Message-----
> From: Ville Syrj?l? [mailto:syrjala at sci.fi]
> Sent: Tuesday, February 08, 2005 8:47 PM
> To: Lucian Muresan
> Cc: directfb-users at directfb.org
> Subject: Re: [directfb-users] Re: df_xine with Matrox G450 TV-out
>
...
> > >When my information is correct, the subpicturelayer is of depth 8bit
> > >with 4bit alpha and 4bit  color information (-> 16 colors). So I think
> > >it's not much useful.
> >
> > You might be right, I don't know, I'd suggest Ville should tell
> us here.
> > If the situation is like this, I must admit, there's no fun having such
> > an OSD in VDR.
>
> Yes the sub-picture layer support only ALUT44 format. That means 4 bit
> alpha + 4 bit palette. Furthermore the sub-picture layer only works when
> CRTC2 is displaying YV12/I420 data. For other pixel formats you could use
> an ARGB surface for the OSD which you would blit after the video frame to
> the CRTC2 surface. dfbmga doesn't currently do that (ie. it draws the OSD
> directly to CRTC2 surface. Fortunately mplayer doesn't make heavy use of
> OSD stuff (only subtitles, time display and some occasional status bars)
> so it doesn't take too much CPU power to blend them.
>

Ok, then aybe such kind of OSD displaying would only be useful in the
default "classic" VDR theme. I think I will investigate this myself further,
as I hopefully will get closer to understand DirectFB, maybe something in
the direction I pointed out using drawing primitives and such is feasable
too, who knows...

Lucian



From lucianm at users.sourceforge.net  Wed Feb  9 15:03:11 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 9 Feb 2005 15:03:11 +0100
Subject: [Softdevice-devel] latest field parity improvements on Matrox
Message-ID: <EBECIPPNBDCCLOJFHAJLOEEMCDAA.lucianm@users.sourceforge.net>

Hi,

I checked out the latest improvements in the field parity area last night,
and at a first glance, it seemed that everything is ok. But then I switched
to a news channel wich broadcasts a horizontally scrolling newsticker at the
bottom of the image. Well, there I can still observe some tearing of the
scrolling letters, they are less at the top of the letter, and larger at the
bottom, just to explain how it's looking like. After bringing up some VDR
OSD, and then turn the OSD of, I experienced also longer periods (almost 1 -
2 minutes) of PERFECT picture, no field parity inversion whatsoever.
I looked a little bit in the code, and am wondering if the field parity is
set to 0 (top if I'm right) only for the OSD surface...
Anyway, I'm glad it got better...

Cheers,
Lucian



From lucianm at users.sourceforge.net  Wed Feb  9 15:03:11 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 9 Feb 2005 15:03:11 +0100
Subject: [Softdevice-devel] ALSA sound in softdevice
Message-ID: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net>

Hi,

I'm using softdevice with ALSA and SPDIF (a C-Media 8738 able to output
either at 44.1 or 48kHz). But SPDIF passthrough is not working for channels
with AC3. Or do I have to switch the language somehow, or configure in
channels.conf?
Another problem is on channels which broadcast just mono MP2, they are mute,
too. I haven?t tried yet how to deal with dual language channels, but I'd
like to know first what to do with mono MP2 and AC3...

Regards,
Lucian






From M.Wache at gmx.net  Thu Feb 10 18:23:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 10 Feb 2005 18:23:16 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
In-Reply-To: <29471.1107857667@www32.gmx.net>
References: <29471.1107857667@www32.gmx.net>
Message-ID: <420B9884.4070300@gmx.net>

Thomas Herrmann wrote:
> Hi Martin,
> 
> I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
> cvs, AthlonXP). 
Thanks for you report, even though I would have liked it better if you 
were useing an Intel processor ;-) I still fear that I have used some 
3Dnow only instructions which aren't supported by Intel...

Just one minor issue, the software mode does not get saved
> in the setup file of vdr (have to reenable software OSD after every restart
> of VDR).
I noticed this too, but up to now I don't now how to fix it... The 
method for saving the softdevice options seems not to be called by vdr.
What actually works is the parsing of the options, so if you want to 
have software alpha blending osd from start adding a line similar to
"softdevice.OSDalphablend = 1"
to your /video/setup.conf should help. I'm sorry I'm not at home right 
now, so I can't check what the actual line was like...

So I will start to work on the implentation of software osd alpha 
blending for vidix-out, that should one be easy. Standard fb-out will be 
difficult, or at least slow because we would have to do additional 
copying, so I wont do it now. What about directfb? Is software osd alpha 
blending needed/wanted for directfb?

Bye,
Martin



From M.Wache at gmx.net  Thu Feb 10 18:31:27 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 10 Feb 2005 18:31:27 +0100
Subject: [Softdevice-devel] ALSA sound in softdevice
In-Reply-To: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net>
References: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net>
Message-ID: <420B9A6F.7000406@gmx.net>

Lucian Muresan wrote:
> Hi,
> 
> I'm using softdevice with ALSA and SPDIF (a C-Media 8738 able to output
> either at 44.1 or 48kHz). But SPDIF passthrough is not working for channels
> with AC3. Or do I have to switch the language somehow, or configure in
> channels.conf?

AC3 is currently not supported in the softdevice, maybe we will add 
support for it in a future release. Have you tried the bitstreamout 
plugin? I don't now if it works together with the softdevice, but you 
could try and report your results here. Unfortunatly I don't have the 
hardware to test it...

Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Feb 10 19:15:52 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 10 Feb 2005 19:15:52 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <420B9884.4070300@gmx.net>
References: <29471.1107857667@www32.gmx.net> <420B9884.4070300@gmx.net>
Message-ID: <200502101915.52219.stefan@lucke.in-berlin.de>

On Donnerstag, 10. Februar 2005 18:23, Martin Wache wrote:
> Thomas Herrmann wrote:
> > Hi Martin,
> > 
> > I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
> > cvs, AthlonXP). 
> Thanks for you report, even though I would have liked it better if you 
> were useing an Intel processor ;-) I still fear that I have used some 
> 3Dnow only instructions which aren't supported by Intel...

Sorry test is still pending.

> 
> Just one minor issue, the software mode does not get saved
> > in the setup file of vdr (have to reenable software OSD after every restart
> > of VDR).
> I noticed this too, but up to now I don't now how to fix it... The 
> method for saving the softdevice options seems not to be called by vdr.


From thauta at iki.fi  Thu Feb 10 19:48:30 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Thu, 10 Feb 2005 20:48:30 +0200 (EET)
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha
 blending for XV
In-Reply-To: <420B9884.4070300@gmx.net>
References: <29471.1107857667@www32.gmx.net> <420B9884.4070300@gmx.net>
Message-ID: <Pine.LNX.4.61.0502101942250.15545@tuomi.oulu.fi>

On Thu, 10 Feb 2005, Martin Wache wrote:
> Just one minor issue, the software mode does not get saved
>> in the setup file of vdr (have to reenable software OSD after every restart
>> of VDR).
> I noticed this too, but up to now I don't now how to fix it... The method for 
> saving the softdevice options seems not to be called by vdr.
> What actually works is the parsing of the options, so if you want to have 
> software alpha blending osd from start adding a line similar to
> "softdevice.OSDalphablend = 1"
> to your /video/setup.conf should help. I'm sorry I'm not at home right now, 
> so I can't check what the actual line was like...

I have the same kind of problem here. With G400 CRTC2 & DFB I have to 
change the video to YUV2 and pixel aspect to PAL-TV every time. Any 
keywords to enable these?

A bit OT, but @Stefan: With 1.3.20, softdevice cvs, DFB 0.9.21 and Celeron 
1.2GHz the dfb:mga seems to be in really bad trouble when watching live 
hockey. Whenever there's vertical movement I'm getting picture jams 
ramdomly between 1-5 secs.

BTW, how do you guys stop the vdr&softdevice when you want to return 
quickly back to X/console? I'm running vdr on my desktop machine and 
can't use it while vdr is running on the CRTC2. If I want to test 
vdr&softdevice and then return, I hit the vdr's power button and then have 
to wait for 5 mins to vdr run my kill_vdr script. Any better ideas?

Tomi Hautakoski
thauta at iki.fi
                    Life is a series of very rude awakenings.


From stefan at lucke.in-berlin.de  Thu Feb 10 22:10:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 10 Feb 2005 22:10:07 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <Pine.LNX.4.61.0502101942250.15545@tuomi.oulu.fi>
References: <29471.1107857667@www32.gmx.net> <420B9884.4070300@gmx.net> <Pine.LNX.4.61.0502101942250.15545@tuomi.oulu.fi>
Message-ID: <200502102210.07149.stefan@lucke.in-berlin.de>

On Donnerstag, 10. Februar 2005 19:48, Tomi Hautakoski wrote:
> On Thu, 10 Feb 2005, Martin Wache wrote:
> > Just one minor issue, the software mode does not get saved
> >> in the setup file of vdr (have to reenable software OSD after every restart
> >> of VDR).
> > I noticed this too, but up to now I don't now how to fix it... The method for 
> > saving the softdevice options seems not to be called by vdr.
> > What actually works is the parsing of the options, so if you want to have 
> > software alpha blending osd from start adding a line similar to
> > "softdevice.OSDalphablend = 1"
> > to your /video/setup.conf should help. I'm sorry I'm not at home right now, 
> > so I can't check what the actual line was like...
> 
> I have the same kind of problem here. With G400 CRTC2 & DFB I have to 
> change the video to YUV2 and pixel aspect to PAL-TV every time. Any 
> keywords to enable these?

Please use setup->plugins->softdevice.

> 
> A bit OT, but @Stefan: With 1.3.20, softdevice cvs, DFB 0.9.21 and Celeron 
> 1.2GHz the dfb:mga seems to be in really bad trouble when watching live 
> hockey. Whenever there's vertical movement I'm getting picture jams 
> ramdomly between 1-5 secs.

Maybe thats because we sync just before we are calling the output method
specific drawing function.

> 
> BTW, how do you guys stop the vdr&softdevice when you want to return 
> quickly back to X/console? I'm running vdr on my desktop machine and 
> can't use it while vdr is running on the CRTC2. If I want to test 
> vdr&softdevice and then return, I hit the vdr's power button and then have 
> to wait for 5 mins to vdr run my kill_vdr script. Any better ideas?

I'm starting vdr just just from console "./vdr ...." , so there is no looping
script and thus setup->restart stops vdr :-) .


-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Thu Feb 10 22:29:19 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Thu, 10 Feb 2005 22:29:19 +0100
Subject: [Softdevice-devel] ALSA sound in softdevice
In-Reply-To: <420B9A6F.7000406@gmx.net>
References: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net> <420B9A6F.7000406@gmx.net>
Message-ID: <420BD22F.70007@users.sourceforge.net>

Martin Wache wrote:
> Lucian Muresan wrote:
> 
>> Hi,
>>
>> I'm using softdevice with ALSA and SPDIF (a C-Media 8738 able to output
>> either at 44.1 or 48kHz). But SPDIF passthrough is not working for 
>> channels
>> with AC3. Or do I have to switch the language somehow, or configure in
>> channels.conf?
> 
> 
> AC3 is currently not supported in the softdevice, maybe we will add 
> support for it in a future release. Have you tried the bitstreamout 
> plugin? I don't now if it works together with the softdevice, but you 
> could try and report your results here. Unfortunatly I don't have the 
> hardware to test it...
> 

If bitstreamout only works if you connect the physical output of a FF
card to the digital input of the soundcard to route it only, then I
don't have the necessary hardware either, only budget card here. Or did 
I miss something?

Regards,
Lucian



From M.Wache at gmx.net  Thu Feb 10 23:01:33 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 10 Feb 2005 23:01:33 +0100
Subject: [Softdevice-devel] ALSA sound in softdevice
In-Reply-To: <420BD22F.70007@users.sourceforge.net>
References: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net> <420B9A6F.7000406@gmx.net> <420BD22F.70007@users.sourceforge.net>
Message-ID: <420BD9BD.60608@gmx.net>

Lucian Muresan wrote:
> Martin Wache wrote:
> 
>> Lucian Muresan wrote:
>>
>>> Hi,
>>>
>>> I'm using softdevice with ALSA and SPDIF (a C-Media 8738 able to output
>>> either at 44.1 or 48kHz). But SPDIF passthrough is not working for 
>>> channels
>>> with AC3. Or do I have to switch the language somehow, or configure in
>>> channels.conf?
>>
>>
>>
>> AC3 is currently not supported in the softdevice, maybe we will add 
>> support for it in a future release. Have you tried the bitstreamout 
>> plugin? I don't now if it works together with the softdevice, but you 
>> could try and report your results here. Unfortunatly I don't have the 
>> hardware to test it...
>>
> 
> If bitstreamout only works if you connect the physical output of a FF
> card to the digital input of the soundcard to route it only, then I
> don't have the necessary hardware either, only budget card here. Or did 
> I miss something?
Hmm, I don't know for sure, as I didn't try, but there is a german howto 
at http://www.vdr-portal.de/board/thread.php?threadid=1958 which says 
that there is no need for an digital input to the soundcard anymore. 
Also the sourceforge page http://bitstreamout.sourceforge.net/ states 
that the minimum hardware requirement is a sound card with a digital 
output and a reciever with integrated decoder, so I assume that there is 
no need for a FF card, but I may be mistaken...

Cheers,
Martin




From lucianm at users.sourceforge.net  Fri Feb 11 00:16:34 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Fri, 11 Feb 2005 00:16:34 +0100
Subject: [Softdevice-devel] ALSA sound in softdevice
In-Reply-To: <420BD9BD.60608@gmx.net>
References: <EBECIPPNBDCCLOJFHAJLAEENCDAA.lucianm@users.sourceforge.net> <420B9A6F.7000406@gmx.net> <420BD22F.70007@users.sourceforge.net> <420BD9BD.60608@gmx.net>
Message-ID: <420BEB52.5020104@users.sourceforge.net>

Martin Wache wrote:
...
>>> AC3 is currently not supported in the softdevice, maybe we will add 
>>> support for it in a future release. Have you tried the bitstreamout 
>>> plugin? I don't now if it works together with the softdevice, but you 
>>> could try and report your results here. Unfortunatly I don't have the 
>>> hardware to test it...
>>>
>>
>> If bitstreamout only works if you connect the physical output of a FF
>> card to the digital input of the soundcard to route it only, then I
>> don't have the necessary hardware either, only budget card here. Or 
>> did I miss something?
> 
> Hmm, I don't know for sure, as I didn't try, but there is a german howto 
> at http://www.vdr-portal.de/board/thread.php?threadid=1958 which says 
> that there is no need for an digital input to the soundcard anymore. 
> Also the sourceforge page http://bitstreamout.sourceforge.net/ states 
> that the minimum hardware requirement is a sound card with a digital 
> output and a reciever with integrated decoder, so I assume that there is 
> no need for a FF card, but I may be mistaken...
> 

Maybe it works, but I can't compile bitstreamout with a fairly new VDR, 
it seems like bitstreamout hasn't been updated for a very long time, I 
think since vdr-1.3.11, and this evening I just updated from 1.3.18 to 
1.3.20...

Lucian


From stefan at lucke.in-berlin.de  Sat Feb 12 06:19:12 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 12 Feb 2005 06:19:12 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <420B9884.4070300@gmx.net>
References: <29471.1107857667@www32.gmx.net> <420B9884.4070300@gmx.net>
Message-ID: <200502120619.12411.stefan@lucke.in-berlin.de>

On Donnerstag, 10. Februar 2005 18:23, Martin Wache wrote:
> Thomas Herrmann wrote:
> > Hi Martin,
> > 
> > I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
> > cvs, AthlonXP). 
> Thanks for you report, even though I would have liked it better if you 
> were useing an Intel processor ;-) I still fear that I have used some 
> 3Dnow only instructions which aren't supported by Intel...

I think there are unsupported instructions in my P4 enviroment.
It aborted immediate after switching osd drawing method.

-OsdWidth 736 newOsdWidth 736 OsdHeight 576 newOsdHeight 576
+YUV:OSDWidth 704 576 Bitmap 624 486
----------------------------
OSDWidth 704 576 Bitmap 624 486
dirty area (105984,137902928) (105984,1106759300)
++++++++++++++++++++++new OsdHeight+++++++ OSDdirty 1+++++
-Ung?ltiger Maschinenbefehl

Candidates are "femms" and "prefetch" which are listed in my
3DNow!(tm) Technology Manual

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Feb 13 19:16:38 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 13 Feb 2005 19:16:38 +0100
Subject: [Softdevice-devel] Re: [vdr] [ANNOUNCE] vdr-softdevice-0.0.8
In-Reply-To: <1106423633.16690.48.camel@atlantis.netenviron.com>
References: <200501042137.28285.stefan@lucke.in-berlin.de> <200501210741.18329.stefan@lucke.in-berlin.de> <1106423633.16690.48.camel@atlantis.netenviron.com>
Message-ID: <200502131916.38500.stefan@lucke.in-berlin.de>

On Samstag, 22. Januar 2005 20:53, Torgeir Veimo wrote:
> On Fri, 2005-01-21 at 07:41 +0100, Stefan Lucke wrote:
> > 
> > Torgeir did you test that ? The final version should calculate the
> > back
> > index from the video stream if above change fixes the sync issue with
> > this channel.
> 
> 
> Ok. I tried both PTS_COUNT-3, -2 and -1, and subjectively, using -2 is
> best with this channel. It's a bit hard to judge, as it's a music
> channel, and one I don't watch too often.
> 

Yes for calculated value -3, -2 should be use instead. Autocalculation
is in cvs now.

I found some stations too which use the different transmission scheme.

-- 
Stefan Lucke



From M.Wache at gmx.net  Wed Feb 16 13:09:10 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 16 Feb 2005 13:09:10 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
Message-ID: <421337E6.60004@gmx.net>

Stefan Lucke wrote:
> On Donnerstag, 10. Februar 2005 18:23, Martin Wache wrote:
> 
>>Thomas Herrmann wrote:
>>
>>>Hi Martin,
>>>
>>>I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
>>>cvs, AthlonXP). 
>>
>>Thanks for you report, even though I would have liked it better if you 
>>were useing an Intel processor ;-) I still fear that I have used some 
>>3Dnow only instructions which aren't supported by Intel...
> 
> 
> I think there are unsupported instructions in my P4 enviroment.
> It aborted immediate after switching osd drawing method.
> -OsdWidth 736 newOsdWidth 736 OsdHeight 576 newOsdHeight 576
> +YUV:OSDWidth 704 576 Bitmap 624 486
> ----------------------------
> OSDWidth 704 576 Bitmap 624 486
> dirty area (105984,137902928) (105984,1106759300)
> ++++++++++++++++++++++new OsdHeight+++++++ OSDdirty 1+++++
> -Ung?ltiger Maschinenbefehl
> 
> Candidates are "femms" and "prefetch" which are listed in my
> 3DNow!(tm) Technology Manual
> 
Thanks for testing! And yes, these are the ones I also suspect. I
updated my patch, now there is the possibility to select 3DNow or MMX2,
but since the MMX2 code is also understood by my Athlon and the speed
difference is small the MMX2 code is the default.
I also added software alpha blending support for vidix-out, and fixed
the osd flickering in fb only mode. For vidix-out and fb-out the osd is
now also scaled if the display resolution is smaller than the default
video resolution.
I think that the patch is now almost ready for inclusion into CVS, I
tested it with the different output methods and vdr-1.2.6, software
alpha blending is not supported for it, but I also didn't break
anything. The only thing which is difficult to test for me ist DFB, for
some reason the video overlay is alwas in front on my ATI Rage128pro, so
that the OSD is never visible... Does anyone now how to fix this?

Stefan, could you please try again with the new patch? I replaced the
"prefetch" command with a "prefetchnta" for MMX2, it is done similar in
the MPlayer and I also replaced the "femms" command.
So as soon as this patch is finished, I will start working on using
libavformat for parsing of the ps stream. I already studied the code of
the library, it looks quite good and I hope that in a few weeks we can
have a first version of the softdevice which understands more than just
mp2 as audio-codec....

Bye,
Martin

-------------- next part --------------
A non-text attachment was scrubbed...
Name: AlphaBlend2.patch.gz
Type: application/x-gzip
Size: 12039 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050216/f9652c5d/attachment.bin>

From torgeir at pobox.com  Wed Feb 16 13:18:32 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 16 Feb 2005 12:18:32 +0000
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha
	blending for XV
In-Reply-To: <421337E6.60004@gmx.net>
References: <421337E6.60004@gmx.net>
Message-ID: <1108556312.14621.32.camel@atlantis.netenviron.com>

On Wed, 2005-02-16 at 13:09 +0100, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Donnerstag, 10. Februar 2005 18:23, Martin Wache wrote:
> > 
> >>Thomas Herrmann wrote:
> >>
> >>>Hi Martin,
> >>>
> >>>I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
> >>>cvs, AthlonXP). 
> >>
> >>Thanks for you report, even though I would have liked it better if you 
> >>were useing an Intel processor ;-) I still fear that I have used some 
> >>3Dnow only instructions which aren't supported by Intel...

Work nicely here as well. 

We'll still keep the old method as an option for high res output
devices? 


> So as soon as this patch is finished, I will start working on using
> libavformat for parsing of the ps stream. I already studied the code of
> the library, it looks quite good and I hope that in a few weeks we can
> have a first version of the softdevice which understands more than just
> mp2 as audio-codec....

Will you look into a simpler version of the dvd plugin that leaves a bit
more of the decoding to libavcodec?

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Fri Feb 18 01:37:48 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 18 Feb 2005 00:37:48 +0000
Subject: [Softdevice-devel] Re: [Softdevice-cvs] softdevice CHANGELOG,1.32,1.33
 mpeg2decoder.c,1.14,1.15 mpeg2decoder.h,1.11,1.12
In-Reply-To: <200502131812.j1DICYN01078@bat.berlios.de>
References: <200502131812.j1DICYN01078@bat.berlios.de>
Message-ID: <1108687068.6442.31.camel@atlantis.netenviron.com>

On Sun, 2005-02-13 at 19:12 +0100, lucke wrote:
> Update of /cvsroot/softdevice/softdevice
> In directory sheep:/tmp/cvs-serv22343
> 
> Modified Files:
> 	CHANGELOG mpeg2decoder.c mpeg2decoder.h 
> Log Message:
> a/v sync: auto adjusting back index instead of using fixed value 4

Watching with this update for a week, it seems that it compensates one
frame too much, putting sound one frame ahead of video.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Fri Feb 18 10:56:42 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Feb 2005 10:56:42 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha	blending
 for XV
In-Reply-To: <1108556312.14621.32.camel@atlantis.netenviron.com>
References: <421337E6.60004@gmx.net> <1108556312.14621.32.camel@atlantis.netenviron.com>
Message-ID: <4215BBDA.5070702@gmx.net>

Torgeir Veimo wrote:

> 
> Work nicely here as well. 
Hey, that's great! Thank you for testing.
> 
> We'll still keep the old method as an option for high res output
> devices? 
I wanted to keep it, mostly because it's faster and I think for hardware 
accelerated alpha blending the old Draw(cBitmap..) method is also more 
usefull.
> 
> 
> 
>>So as soon as this patch is finished, I will start working on using
>>libavformat for parsing of the ps stream. I already studied the code of
>>the library, it looks quite good and I hope that in a few weeks we can
>>have a first version of the softdevice which understands more than just
>>mp2 as audio-codec....
> 
> 
> Will you look into a simpler version of the dvd plugin that leaves a bit
> more of the decoding to libavcodec?
> 

You are right that could be done, but right now I don't plan to do it. 
First I want to have the softdevice running with libavformat and support 
the other audio formats. Hopefully the dvd-plugin will work togther with 
the softdevice after this step and maybe some tuneing. And if the 
dvd-plugin is working, I think the need for a softdevice-only dvd-plugin 
is not that big.
My next step will be to use libavformat to be able to replay avi, mp3 
and others with vdr/softdevice. Including unencrypted .vob support 
should be not to difficult at that step (although I did not check that 
yet), but I certainly don't want to mess around with decss and libdvdnav.


Bye,
Martin


From nhuillard at e-dition.fr  Fri Feb 18 12:24:10 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 18 Feb 2005 12:24:10 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha	blending
 for XV
In-Reply-To: <4215BBDA.5070702@gmx.net>
References: <421337E6.60004@gmx.net> <1108556312.14621.32.camel@atlantis.netenviron.com> <4215BBDA.5070702@gmx.net>
Message-ID: <4215D05A.80302@e-dition.fr>

Martin Wache a ?crit :
> Torgeir Veimo wrote:
> 
>> Work nicely here as well. 
> 
> Hey, that's great! Thank you for testing.

I'll also get back to testing softdevice.
Thanks for all the hard work and creativity everyone put into this 
really promising software !!!

-- 
NH


From stefan at lucke.in-berlin.de  Fri Feb 18 14:10:21 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 18 Feb 2005 14:10:21 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <421337E6.60004@gmx.net>
References: <421337E6.60004@gmx.net>
Message-ID: <200502181410.22087.stefan@lucke.in-berlin.de>

On Mittwoch, 16. Februar 2005 13:09, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Donnerstag, 10. Februar 2005 18:23, Martin Wache wrote:
> > 
> >>Thomas Herrmann wrote:
> >>
> >>>Hi Martin,
> >>>
> >>>I tried your patch and it works fine (vdr-1.3.20, text2skin 1.0, softdevice
> >>>cvs, AthlonXP). 
> >>
> >>Thanks for you report, even though I would have liked it better if you 
> >>were useing an Intel processor ;-) I still fear that I have used some 
> >>3Dnow only instructions which aren't supported by Intel...
> > 
> > 
> > I think there are unsupported instructions in my P4 enviroment.
> > It aborted immediate after switching osd drawing method.
> > -OsdWidth 736 newOsdWidth 736 OsdHeight 576 newOsdHeight 576
> > +YUV:OSDWidth 704 576 Bitmap 624 486
> > ----------------------------
> > OSDWidth 704 576 Bitmap 624 486
> > dirty area (105984,137902928) (105984,1106759300)
> > ++++++++++++++++++++++new OsdHeight+++++++ OSDdirty 1+++++
> > -Ung?ltiger Maschinenbefehl
> > 
> > Candidates are "femms" and "prefetch" which are listed in my
> > 3DNow!(tm) Technology Manual
> > 
> Thanks for testing! And yes, these are the ones I also suspect. I
> updated my patch, now there is the possibility to select 3DNow or MMX2,
> but since the MMX2 code is also understood by my Athlon and the speed
> difference is small the MMX2 code is the default.
> I also added software alpha blending support for vidix-out, and fixed
> the osd flickering in fb only mode. For vidix-out and fb-out the osd is
> now also scaled if the display resolution is smaller than the default
> video resolution.
> I think that the patch is now almost ready for inclusion into CVS, I
> tested it with the different output methods and vdr-1.2.6, software
> alpha blending is not supported for it, but I also didn't break
> anything. The only thing which is difficult to test for me ist DFB, for
> some reason the video overlay is alwas in front on my ATI Rage128pro, so
> that the OSD is never visible... Does anyone now how to fix this?

New thread and post the startup messages from DFB.

> 
> Stefan, could you please try again with the new patch? I replaced the
> "prefetch" command with a "prefetchnta" for MMX2, it is done similar in
> the MPlayer and I also replaced the "femms" command.

Works ok for me too. So get it in as I've a small mod to the vidix
driver pending, which I'll do after your mod is in. It is for
supporting cards which have only support YUY2 format, but it is still
not working for nvidia Gforce 5200 :-( .


-- 
Stefan Lucke



From M.Wache at gmx.net  Fri Feb 18 14:34:31 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Feb 2005 14:34:31 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
In-Reply-To: <200502181410.22087.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <200502181410.22087.stefan@lucke.in-berlin.de>
Message-ID: <4215EEE7.6090603@gmx.net>

> Works ok for me too. So get it in as I've a small mod to the vidix
> driver pending, which I'll do after your mod is in. It is for
> supporting cards which have only support YUY2 format, but it is still
> not working for nvidia Gforce 5200 :-( .
> 
> 
I've just commited the patch. Originally I wanted to wait until 
thursday, because I will be away until wednesday next week... So I hope 
I didn't break anything, because I wont have access to a computer until 
thursday :-(

Bye,
Martin


From stefan at lucke.in-berlin.de  Fri Feb 18 16:52:56 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 18 Feb 2005 16:52:56 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <4215EEE7.6090603@gmx.net>
References: <421337E6.60004@gmx.net> <200502181410.22087.stefan@lucke.in-berlin.de> <4215EEE7.6090603@gmx.net>
Message-ID: <200502181652.57184.stefan@lucke.in-berlin.de>

On Freitag, 18. Februar 2005 14:34, Martin Wache wrote:
> 
> > Works ok for me too. So get it in as I've a small mod to the vidix
> > driver pending, which I'll do after your mod is in. It is for
> > supporting cards which have only support YUY2 format, but it is still
> > not working for nvidia Gforce 5200 :-( .
> > 
> > 
> I've just commited the patch. Originally I wanted to wait until 
> thursday, because I will be away until wednesday next week... So I hope 
> I didn't break anything, because I wont have access to a computer until 
> thursday :-(

Ok until then we'll collect bug reports. I'll start here:
vidix:
- when using previous OSD drawing method leftmost column is drawn on the right.
- when switching from alpha blended to pseudo I got a segfault.
- I had to restore previous color key settings to value 0 to get video.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Feb 18 18:50:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 18 Feb 2005 18:50:07 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <200502181652.57184.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <4215EEE7.6090603@gmx.net> <200502181652.57184.stefan@lucke.in-berlin.de>
Message-ID: <200502181850.07785.stefan@lucke.in-berlin.de>

On Freitag, 18. Februar 2005 16:52, Stefan Lucke wrote:
> On Freitag, 18. Februar 2005 14:34, Martin Wache wrote:
> > 
> > > Works ok for me too. So get it in as I've a small mod to the vidix
> > > driver pending, which I'll do after your mod is in. It is for
> > > supporting cards which have only support YUY2 format, but it is still
> > > not working for nvidia Gforce 5200 :-( .
> > > 
> > > 
> > I've just commited the patch. Originally I wanted to wait until 
> > thursday, because I will be away until wednesday next week... So I hope 
> > I didn't break anything, because I wont have access to a computer until 
> > thursday :-(
> 
> Ok until then we'll collect bug reports. I'll start here:
> vidix:
> - when using previous OSD drawing method leftmost column is drawn on the right.

That was the same for dfb-out. Top and bottom line were swapped (repeated ?) too.

Fix is in cvs now.

I'll leave vidix color key for now. We have to check that later. If you
are using a rage128 for your test, this maybe a driver bug as they (vidix)
treat rage128 a bit different.
if function set_gr_key (..)

#ifdef RAGE128
	besr.graphics_key_msk=(1<<dbpp)-1;
	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|GRAPHIC_KEY_FN_NE|CMP_MIX_AND;
#else
	besr.graphics_key_msk=besr.graphics_key_clr;
	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|CMP_MIX_AND|GRAPHIC_KEY_FN_EQ;
#endif

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Feb 22 07:22:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 22 Feb 2005 07:22:58 +0100
Subject: [Softdevice-devel] Re: [Softdevice-cvs] softdevice CHANGELOG,1.32,1.33 mpeg2decoder.c,1.14,1.15 mpeg2decoder.h,1.11,1.12
In-Reply-To: <1108687068.6442.31.camel@atlantis.netenviron.com>
References: <200502131812.j1DICYN01078@bat.berlios.de> <1108687068.6442.31.camel@atlantis.netenviron.com>
Message-ID: <200502220722.58170.stefan@lucke.in-berlin.de>

On Freitag, 18. Februar 2005 01:37, Torgeir Veimo wrote:
> On Sun, 2005-02-13 at 19:12 +0100, lucke wrote:
> > Update of /cvsroot/softdevice/softdevice
> > In directory sheep:/tmp/cvs-serv22343
> > 
> > Modified Files:
> > 	CHANGELOG mpeg2decoder.c mpeg2decoder.h 
> > Log Message:
> > a/v sync: auto adjusting back index instead of using fixed value 4
> 
> Watching with this update for a week, it seems that it compensates one
> frame too much, putting sound one frame ahead of video.

Do you get this for all transponders ?
Which back index is used when you hear "audio ahead" ?
(no message -> back index = 4).

Feb 22 07:20:09 jarada vdr[2084]: [mpeg2decoder]: back index change (4 -> 3(2))

-- 
Stefan Lucke



From M.Wache at gmx.net  Fri Feb 25 11:48:20 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 25 Feb 2005 11:48:20 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
In-Reply-To: <200502181850.07785.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <4215EEE7.6090603@gmx.net> <200502181652.57184.stefan@lucke.in-berlin.de> <200502181850.07785.stefan@lucke.in-berlin.de>
Message-ID: <421F0274.5050907@gmx.net>

Hi Stefan,

thanks for fixing all those bugs while I was away!!! It seems you did 
not leave much for me to fix ;-)
I had a short look at the softdevice yesterday, but I did not have the 
time to test anything.

> 
> I'll leave vidix color key for now. We have to check that later. If you
> are using a rage128 for your test, this maybe a driver bug as they (vidix)
> treat rage128 a bit different.
> if function set_gr_key (..)
> 
> #ifdef RAGE128
> 	besr.graphics_key_msk=(1<<dbpp)-1;
> 	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|GRAPHIC_KEY_FN_NE|CMP_MIX_AND;
> #else
> 	besr.graphics_key_msk=besr.graphics_key_clr;
> 	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|CMP_MIX_AND|GRAPHIC_KEY_FN_EQ;
> #endif
> 
Yes, for some reason my Rage128pro seems to behave quite different than 
other cards, it's similar for vidix and dfb. I guess I have to talk to 
the vidix guys and ask them.
I did not inted to change the color key in vidix, I was just playing 
around with it and I missed that I didn't take back the changes before 
commiting :-o. Hehm, so I think it is the best to put the old values back.

I saw that you commited a subplugin concept for the video out methods, 
after takeing a first glance at it, it looks very promising. Great work! 
I will try it when I'm at home.
Do you plan to go further? I could imagine to move all video out method 
specific comandline parsing to the video clases just by passing the 
string following the "-vo xxx:" to the constructor of video out methods. 
We could get rid of most of the ugly #ifdefs in softdevice.c.
I don't now if this is possible, but I would also like to have to 
possibility to create menu items from the video clases. This way for 
example Xv could create menu items for saturation,hue,... at runtime 
corresponding to the capabilities of the graphics card to have them 
modified from OSD. And we would get rid of all those shortcut keys which 
are used right now in Xv-out to modify the values :-).

Bye,
Martin


From torgeir at pobox.com  Sat Feb 26 02:25:55 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 26 Feb 2005 01:25:55 +0000
Subject: [Softdevice-devel] Tearing w I4"0 output
In-Reply-To: <1107282346.6581.4.camel@atlantis.netenviron.com>
References: <1107282346.6581.4.camel@atlantis.netenviron.com>
Message-ID: <1109381155.12011.12.camel@atlantis.netenviron.com>

On Tue, 2005-02-01 at 18:25 +0000, Torgeir Veimo wrote:
> I see this both with the radeon and a G400, but I cannot see why this is
> happening, except errors in my directfb setup. Output is done using
> mempcy to offscreen memory and the a Flip is done?

Am suspecting the reason for this is the lack of mmx usage for
pixelformat DSPF_I420 and DSPF_YV12? I'm running df_xine nicely without
any tearing at all in my setup.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun Feb 27 12:10:18 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 27 Feb 2005 12:10:18 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <421F0274.5050907@gmx.net>
References: <421337E6.60004@gmx.net> <200502181850.07785.stefan@lucke.in-berlin.de> <421F0274.5050907@gmx.net>
Message-ID: <200502271210.18815.stefan@lucke.in-berlin.de>

On Freitag, 25. Februar 2005 11:48, Martin Wache wrote:
> Hi Stefan,
> 
> thanks for fixing all those bugs while I was away!!! It seems you did 
> not leave much for me to fix ;-)

But there are a few things. With xv-out and startup aspect wide, and crop
mode 16:9 the full OSD is scaled correct and full visible, but the
info OSD at bottom of the screen is mostly invisible.
With fb-out there are some positioning problems when I tried it at
1280x1024x16.

> I had a short look at the softdevice yesterday, but I did not have the 
> time to test anything.
> 
> > 
> > I'll leave vidix color key for now. We have to check that later. If you
> > are using a rage128 for your test, this maybe a driver bug as they (vidix)
> > treat rage128 a bit different.
> > if function set_gr_key (..)
> > 
> > #ifdef RAGE128
> > 	besr.graphics_key_msk=(1<<dbpp)-1;
> > 	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|GRAPHIC_KEY_FN_NE|CMP_MIX_AND;
> > #else
> > 	besr.graphics_key_msk=besr.graphics_key_clr;
> > 	besr.ckey_cntl = VIDEO_KEY_FN_TRUE|CMP_MIX_AND|GRAPHIC_KEY_FN_EQ;
> > #endif
> > 
> Yes, for some reason my Rage128pro seems to behave quite different than 
> other cards, it's similar for vidix and dfb. I guess I have to talk to 
> the vidix guys and ask them.

I wondered if changing the GRAPHIC_KEY function is correct. Did you try
it with "#if 0" instead of "#if RAGE128". In total there are only a very
few applications out there, which use and rely on colorkeying working
correct.

> I did not inted to change the color key in vidix, I was just playing 
> around with it and I missed that I didn't take back the changes before 
> commiting :-o. Hehm, so I think it is the best to put the old values back.
> 
> I saw that you commited a subplugin concept for the video out methods, 
> after takeing a first glance at it, it looks very promising. Great work! 
> I will try it when I'm at home.
> Do you plan to go further? I could imagine to move all video out method 
> specific comandline parsing to the video clases just by passing the 
> string following the "-vo xxx:" to the constructor of video out methods. 

Done. Pointer to remaining option string is now in setup store
(for vo and ao).

> We could get rid of most of the ugly #ifdefs in softdevice.c.
> I don't now if this is possible, but I would also like to have to 
> possibility to create menu items from the video clases. This way for 
> example Xv could create menu items for saturation,hue,... at runtime 
> corresponding to the capabilities of the graphics card to have them 
> modified from OSD. And we would get rid of all those shortcut keys which 
> are used right now in Xv-out to modify the values :-).

That would be nice too. But the most important thing to my opinion is:
AC3 out .

-- 
Stefan Lucke



From M.Wache at gmx.net  Mon Feb 28 11:38:50 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 28 Feb 2005 11:38:50 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
In-Reply-To: <200502271210.18815.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <200502181850.07785.stefan@lucke.in-berlin.de> <421F0274.5050907@gmx.net> <200502271210.18815.stefan@lucke.in-berlin.de>
Message-ID: <4222F4BA.8020103@gmx.net>

Stefan Lucke wrote:

> But there are a few things. With xv-out and startup aspect wide, and crop
> mode 16:9 the full OSD is scaled correct and full visible, but the
> info OSD at bottom of the screen is mostly invisible.
I guess that is pseudo alpha blending mode?
> With fb-out there are some positioning problems when I tried it at
> 1280x1024x16.
Can you be a bit more precise? My poor old Athlon can hardly do the 
640x480x15 fb-out, so that's hard for me to test... Not speaking of my 
old monitor which is only capable of doing the 1280x1024 at eye hurting 
60Hz... I guess I have to buy a new machine soon ;-)
Right now I'm already working on using libavformat for the parsing, but 
I will have to change the software osd again after finishing the 
libavformat stuff. That will be the perfect opertunity to do bug 
hunting, so please tell all problems you know, that I can fix them.

> That would be nice too. But the most important thing to my opinion is:
> AC3 out .
> 
In fact I already have a early version which understands ac3 :-)
But there is still a lot to do, as this version is not very stable, A-V 
sync is broken ( and so on and so on...its almost a complete rewrite of 
mpeg2decoder.c) and I will be away for another week from thursday on... 
So I guess it will take at least 2-3 weeks before I can present a quite 
stable version.

Inspired by your work with the subplugins I will create a general 
interface for video filters like deinterleace and postproc. I plan to 
use some kind of filter queue which can be plugged between the mpeg 
decoder and the video out ( but not with shared libraries). Creating 
additional filters like image scalers or format conversion would be a 
lot easier then and could be used for all video out methods. Finally I 
don't like to have the filters in the mpeg2decoder. They have nothing to 
do with mpeg2 decoding, it's postprocessing what they are doing...

I'm also using your subplugin option now and it works wunderfull!

Bye,
Martin






From stefan at lucke.in-berlin.de  Mon Feb 28 18:45:56 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 28 Feb 2005 18:45:56 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <4222F4BA.8020103@gmx.net>
References: <421337E6.60004@gmx.net> <200502271210.18815.stefan@lucke.in-berlin.de> <4222F4BA.8020103@gmx.net>
Message-ID: <200502281845.56853.stefan@lucke.in-berlin.de>

On Montag, 28. Februar 2005 11:38, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > But there are a few things. With xv-out and startup aspect wide, and crop
> > mode 16:9 the full OSD is scaled correct and full visible, but the
> > info OSD at bottom of the screen is mostly invisible.
> I guess that is pseudo alpha blending mode?

Not that was in software alpha mode. Now with vdr.1.3.22 I get segfaults
even in pseudo alpha mode (the old mode). That is what I did:
vdr started with Pro7 dvb-t starup mode wide, main menu, 5 softdevice,
changed crop mode to 16:9, moved seltion up/ down, enter(OK).
from gdb:
setup-softdevice] storing data

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 16384 (LWP 2266)]
0x40552668 in cVideoOut::Draw(cBitmap*, unsigned char*, int, bool) (this=0x833b8f0, Bitmap=0x83482b8, osd_buf=0x41f12000 "", linelen=1472,
    inverseAlpha=false) at video.c:547
547                 buf[0] = ((b >> 3)& 0x1F) | ((g & 0x1C) << 3);
Current language:  auto; currently c++
(gdb) bt
#0  0x40552668 in cVideoOut::Draw(cBitmap*, unsigned char*, int, bool) (this=0x833b8f0, Bitmap=0x83482b8, osd_buf=0x41f12000 "", linelen=1472,
    inverseAlpha=false) at video.c:547
#1  0x40555612 in cXvVideoOut::Refresh(cBitmap*) () from ./PLUGINS/lib/libvdr-softdevice-xv.so.1.3.22
#2  0x403299a0 in cSoftOsd::Flush() (this=0x8348250) at softdevice.c:138
#3  0x080d1cbd in cSkinSTTNGDisplayMenu::Flush() (this=0x83481a0) at skinsttng.c:597
#4  0x080ce438 in cSkins::Flush() (this=0x81ac6c8) at skins.h:43
#5  0x0809f6fd in cInterface::GetKey(bool) (this=0x834dcc0, Wait=true) at interface.c:35
#6  0x080e2ce2 in main (argc=1109612211, argv=0x83f1238) at osdbase.h:79
(gdb) info locals
x = 13
y = 459
depth = 2
a = 255
r = 252
g = 192
b = 36
prev_pix = 255
do_dither = 134
buf = (tIndex *) 0x41fe1086 ""
x1 = 13
x2 = 591
y1 = 5
y2 = 485
PixelMaskPtr = (uint8_t *) 0xcf37 <Address 0xcf37 out of bounds>


> > With fb-out there are some positioning problems when I tried it at
> > 1280x1024x16.
> Can you be a bit more precise? 

Have to check that later again. Maybe it's because I started with
software alpha instead of pseudo alpha.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Mar  1 06:16:29 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 1 Mar 2005 06:16:29 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <4222F4BA.8020103@gmx.net>
References: <421337E6.60004@gmx.net> <200502271210.18815.stefan@lucke.in-berlin.de> <4222F4BA.8020103@gmx.net>
Message-ID: <200503010616.30034.stefan@lucke.in-berlin.de>

On Montag, 28. Februar 2005 11:38, Martin Wache wrote:

> In fact I already have a early version which understands ac3 :-)
> But there is still a lot to do, as this version is not very stable, A-V 
> sync is broken ( and so on and so on...its almost a complete rewrite of 
> mpeg2decoder.c) and I will be away for another week from thursday on... 
> So I guess it will take at least 2-3 weeks before I can present a quite 
> stable version.

As I'm trying to release a new version, we should delay this for a short
period. V0.0.8 is quite old and doesn't work with newer vdr versions
without an cvs update.

> 
> Inspired by your work with the subplugins I will create a general 
> interface for video filters like deinterleace and postproc. I plan to 
> use some kind of filter queue which can be plugged between the mpeg 
> decoder and the video out ( but not with shared libraries). Creating 
> additional filters like image scalers or format conversion would be a 
> lot easier then and could be used for all video out methods. Finally I 
> don't like to have the filters in the mpeg2decoder. They have nothing to 
> do with mpeg2 decoding, it's postprocessing what they are doing...

Changeing this is some sort of optimazing too. Remember we are
decoding a frame. deinterlace and finally copying the frame to
the destination area.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Mar  1 06:34:50 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 1 Mar 2005 06:34:50 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <200502281845.56853.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <4222F4BA.8020103@gmx.net> <200502281845.56853.stefan@lucke.in-berlin.de>
Message-ID: <200503010634.50452.stefan@lucke.in-berlin.de>

On Montag, 28. Februar 2005 18:45, Stefan Lucke wrote:
> On Montag, 28. Februar 2005 11:38, Martin Wache wrote:
> > Stefan Lucke wrote:
> > 
> > > But there are a few things. With xv-out and startup aspect wide, and crop
> > > mode 16:9 the full OSD is scaled correct and full visible, but the
> > > info OSD at bottom of the screen is mostly invisible.
> > I guess that is pseudo alpha blending mode?
> 
> Not that was in software alpha mode. Now with vdr.1.3.22 I get segfaults
> even in pseudo alpha mode (the old mode). 

Just an idea (partial tested): Now sxoff and syoff are honored in Draw (..). Shouldn't
these values be used only used in software alpha mode ?

As Draw() is used with PSEUDO Alpha (only ?) could we revert that to the
previous one ? In xv-out I have some doubts about the osd-positioning
in osd-pseudo mode too ShowOSD ().


-- 
Stefan Lucke



From M.Wache at gmx.net  Wed Mar  2 09:47:11 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 02 Mar 2005 09:47:11 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending
 for XV
In-Reply-To: <200503010634.50452.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <4222F4BA.8020103@gmx.net> <200502281845.56853.stefan@lucke.in-berlin.de> <200503010634.50452.stefan@lucke.in-berlin.de>
Message-ID: <42257D8F.2010302@gmx.net>

Stefan Lucke wrote:
>>Not that was in software alpha mode. Now with vdr.1.3.22 I get segfaults
>>even in pseudo alpha mode (the old mode). 
> 
> 
> Just an idea (partial tested): Now sxoff and syoff are honored in Draw (..). Shouldn't
> these values be used only used in software alpha mode ?
> 
> As Draw() is used with PSEUDO Alpha (only ?) could we revert that to the
> previous one ? In xv-out I have some doubts about the osd-positioning
> in osd-pseudo mode too ShowOSD ().
> 

I'm sorry, but I currently don't have time to do extensive debuging. I 
had a short look at it yesterday and it seems that you are right. I 
added the sxoff and syoff to Draw() to have both pseudo and software osd 
positioned at the same position, but this has some unwanted sideeffects 
(and caused the crash you reported), so I just removed it from the CVS.

Bye,
Martin


From nhuillard at e-dition.fr  Wed Mar  2 11:10:06 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 02 Mar 2005 11:10:06 +0100
Subject: [Softdevice-devel] Softdevice future [was : PATCH: OSD scaling &&
 and real alpha blending for XV]
In-Reply-To: <4222F4BA.8020103@gmx.net>
References: <421337E6.60004@gmx.net> <200502181850.07785.stefan@lucke.in-berlin.de> <421F0274.5050907@gmx.net> <200502271210.18815.stefan@lucke.in-berlin.de> <4222F4BA.8020103@gmx.net>
Message-ID: <422590FE.4030201@e-dition.fr>

Martin Wache a ?crit :
> Inspired by your work with the subplugins I will create a general 
> interface for video filters like deinterleace and postproc. I plan to 
> use some kind of filter queue which can be plugged between the mpeg 
> decoder and the video out ( but not with shared libraries). Creating 
> additional filters like image scalers or format conversion would be a 
> lot easier then and could be used for all video out methods. Finally I 
> don't like to have the filters in the mpeg2decoder. They have nothing to 
> do with mpeg2 decoding, it's postprocessing what they are doing...

Isn't that kind of stuff exactly what is implemented in libxine ? Didn't 
you evaluate the possibility to use libxine to have the plugin interface 
and plugin library already made ?
I know this is what the libxineoutput plugin seems to do, but this one 
is not maintained.
I think this is also the goal of the gstreamer project (or so).

Is softdevice aimed to remain light and simple, or can it grow to the 
size of a libxine-based plugin ?

Maybe AC3 and/or hardware MPEG2 decoding would be easier with it ?

-- 
NH


From M.Wache at gmx.net  Thu Mar  3 11:43:21 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 03 Mar 2005 11:43:21 +0100
Subject: [Softdevice-devel] Softdevice future [was : PATCH: OSD scaling
 && and real alpha blending for XV]
In-Reply-To: <422590FE.4030201@e-dition.fr>
References: <421337E6.60004@gmx.net> <200502181850.07785.stefan@lucke.in-berlin.de> <421F0274.5050907@gmx.net> <200502271210.18815.stefan@lucke.in-berlin.de> <4222F4BA.8020103@gmx.net> <422590FE.4030201@e-dition.fr>
Message-ID: <4226EA49.7020103@gmx.net>

Nicolas Huillard wrote:
> Martin Wache a ?crit :
> 
>> Inspired by your work with the subplugins I will create a general 
>> interface for video filters like deinterleace and postproc. I plan to 
>> use some kind of filter queue which can be plugged between the mpeg 
>> decoder and the video out ( but not with shared libraries). Creating 
>> additional filters like image scalers or format conversion would be a 
>> lot easier then and could be used for all video out methods. Finally I 
>> don't like to have the filters in the mpeg2decoder. They have nothing 
>> to do with mpeg2 decoding, it's postprocessing what they are doing...
> 
> 
> Isn't that kind of stuff exactly what is implemented in libxine ? Didn't 
> you evaluate the possibility to use libxine to have the plugin interface 
> and plugin library already made ?
> I know this is what the libxineoutput plugin seems to do, but this one 
> is not maintained.
> I think this is also the goal of the gstreamer project (or so).
> 
> Is softdevice aimed to remain light and simple, or can it grow to the 
> size of a libxine-based plugin ?

I want to keep the softdevice as simple and small as possible, and my 
plans are to make the code more simple.

Maybe I didn't explain my goals the right way... Currently all 
postprocessing is done in mpeg2decoder.c, which means that there are a 
lot of #ifdefs,#else and #endif around to respect the compile options. 
Also the picture buffers for mirroring, deinterlacing and ffmpeg 
postproc are allocated from cMpeg2Decoder, as well as the interface to 
the underlying libraries is in cMpeg2Decoder.
What I plan to do is to move all this code to seperate classes. All what 
would be neccesary in cMpeg2Deocder would be a call like 
"PrepareForDisplay(.. )" to the postprocessing filters right after a 
frame is decoded, and then some kind of "Display()" call when the frame 
should be displayed. As I said I don't plan to have shared libraries, 
but I want to have a common interface for the postprocessing filters 
and not have them entangled with the video decoding.

> 
> Maybe AC3 and/or hardware MPEG2 decoding would be easier with it ?
> 

AC3 decoding and XvMC support is already in the ffmpeg library, so 
currently I don't think we need another library.

Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Mar  3 21:27:08 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 3 Mar 2005 21:27:08 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <200502281845.56853.stefan@lucke.in-berlin.de>
References: <421337E6.60004@gmx.net> <4222F4BA.8020103@gmx.net> <200502281845.56853.stefan@lucke.in-berlin.de>
Message-ID: <200503032127.08886.stefan@lucke.in-berlin.de>

On Montag, 28. Februar 2005 18:45, Stefan Lucke wrote:
> On Montag, 28. Februar 2005 11:38, Martin Wache wrote:
> > Stefan Lucke wrote:

> 
> > > With fb-out there are some positioning problems when I tried it at
> > > 1280x1024x16.
> > Can you be a bit more precise? 
> 
> Have to check that later again. Maybe it's because I started with
> software alpha instead of pseudo alpha.

I think mask and OSD postion are the same now (with my last
commited change[s]).

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Thu Mar  3 22:12:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 3 Mar 2005 22:12:26 +0100
Subject: [Softdevice-devel] Ready for 0.0.9pre1
Message-ID: <200503032212.27018.stefan@lucke.in-berlin.de>

Has someone a pending modification or fix ?

If not, I'll release 0.0.9pre1 tomorrow .

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Fri Mar  4 13:11:39 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 04 Mar 2005 13:11:39 +0100
Subject: [Softdevice-devel] Ready for 0.0.9pre1
In-Reply-To: <200503032212.27018.stefan@lucke.in-berlin.de>
References: <200503032212.27018.stefan@lucke.in-berlin.de>
Message-ID: <4228507B.5010808@e-dition.fr>

Stefan Lucke a ?crit :
> Has someone a pending modification or fix ?
> 
> If not, I'll release 0.0.9pre1 tomorrow .

Hum...
Why not simply 0.0.9, then 0.0.10, and when we are all happy with this
one, 0.1.0 ?
(the 0.0. prefix is really diminishing the importance of this great plug-in)

-- 
NH



From stefan at lucke.in-berlin.de  Fri Mar  4 20:00:10 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 4 Mar 2005 20:00:10 +0100
Subject: [Softdevice-devel] Ready for 0.0.9pre1
In-Reply-To: <4228507B.5010808@e-dition.fr>
References: <200503032212.27018.stefan@lucke.in-berlin.de> <4228507B.5010808@e-dition.fr>
Message-ID: <200503042000.10189.stefan@lucke.in-berlin.de>

On Freitag, 4. M?rz 2005 13:11, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Has someone a pending modification or fix ?
> > 
> > If not, I'll release 0.0.9pre1 tomorrow .
> 
> Hum...
> Why not simply 0.0.9, then 0.0.10, and when we are all happy with this
> one, 0.1.0 ?
> (the 0.0. prefix is really diminishing the importance of this great plug-in)

But the disadvantage for such a naming scheme is that 0.0.10 would
have bug fixes of 0.0.9, some new features and some new bugs of
it's own. We could add a branch for fixes and keep HEAD open
for new development but thats to my opinion to much for such
a small project. 

As more as I'm thinking of your suggestion, the result of the 0.0.9pre
series should be 0.1.0 . So no 0.0.9pre and 0.1.0pre instead ?

I'd like to have the first number to change. But that would require that at
least I could replace the dxr3 in livingroom with softdevice. For this
AC3 out is mandatory (didn't I mention that some time ago :-) ).

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Mar  4 20:24:20 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 4 Mar 2005 20:24:20 +0100
Subject: [Softdevice-devel] Xv-out and Ati Mach64
Message-ID: <200503042024.20313.stefan@lucke.in-berlin.de>

Has someone above combination running ?
At vdr-portal a guy has problems with this combination and X11 
(X.org 6.8.0) on a vdr client together with streamdev (OSD and sound,
but no video).

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Mar  4 21:31:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 4 Mar 2005 21:31:02 +0100
Subject: [Softdevice-devel] [ANNOUNCE] vdr-softdevice-0.1.0pre1
Message-ID: <200503042131.02614.stefan@lucke.in-berlin.de>

Hello,

I'm pleased to announce a new pre-release of vdr softdevice plugin.

In short words: softdevice plugin is for getting vdr to your desktop with
so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
DirectFB or vidix to your screen. Decoding is done via ffmpeg.

For compile options, please read the Makefile carefully and decide which of
the available output methods fit to your system.

Plugin's homepage is located at: http://softdevice.berlios.de/

Changelog since last release:
 2005-03-04: 0.1.0pre1
    - some i18n changes
 2005-03-03:
    - fb-out: fix for build option USE_SUBPLUGINS
              fix alpha mask misplacement
              fix locking during video and OSD drawing
 2005-03-02:
    - increased osd fallback timeout
    - removed syoff and sxoff from Draw(...)
 2005-02-27:
    - save "vo" and "ao" calling args in setup store.
    - new runtime arg "-L path_name". Default set in Makefile to: "./PLUGINS/lib"
    - USE_SUBPLUGINS is now default build option
    - dfb-out: fix for segfault on via unichrome with current DirectFB cvs.
 2005-02-25:
    - vidix-out: fix segfaults upon switch from software OSD back to pseudo mode.
                 match available fourcc against selected.
                 support for YUY2 added (without soft alpha [todo]).
    - all-out: unified constuctor parameter
               optionaly output method is loaded at runtime. by this, one can
               build and ship binaries with all methods enabled to target
               enviroments where not all libs are present.
    - removed obsolete OSD option "sync on" (I-frame/all frames).
 2005-02-18:
    - support for DIRECTCOLOR framebuffer ( most ATI cards, tested with Mach64)
    - fixed osd flickering in framebuffer mode vdr>1.3.7
    - software alpha blending implemented for Vidix (vdr>1.3.7)
    - software alpha blending done in software for Xv out and vdr>1.3.7
    - osd scaling for vdr and Xv >1.3.7
 2005-02-13:
    - a/v sync: auto adjusting back index instead of using fixed value 4
 2005-02-08:
    - dfb-out: fix for field parity in tv-out mode
    - xv-out: fix compile warnings on amd64 (reported by Konrad Naumann)
 2005-01-23:
    - added suspend video playback patch.
 2005-01-15:
    - fix OSD drawing when multiple areas are used (with text2skin plugin)
    - dfb out: reverted top-field first setting as it may crash
    - removed some unused code
    - subtract already spend time from delay before entering delay loop
      (found by Stefan Lucke)
    - audio pts calculation changed to use sample rate and number of channels
 2005-01-13:
    - compatibility fix for vdr-1.3.18
    - aspect ratio handling for 16:9 TV output
    - dfb-out TVout: set top field first and acpect scaleing for TV mode if not set
  2005-01-12:
    - fix aspect ratio calculation/recognition on some dvds


By subscribing to the to cvs list via
https://lists.berlios.de/mailman/listinfo/softdevice-cvs
you'll get informed about lastest changes.

For those who are interested in active development, subscribing to
https://lists.berlios.de/mailman/listinfo/softdevice-devel
is a good choice.

Members of softdevice development crew are:
Torgeir Veimo, Martin Wache and me, Stefan Lucke.


-- 
Stefan Lucke



From torgeir at pobox.com  Sat Mar  5 16:04:27 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 15:04:27 +0000
Subject: [Softdevice-devel] old_stuff..
Message-ID: <1110035067.32583.0.camel@atlantis.netenviron.com>

- is missing release 0.0.8 and 0.0.7. I can upload, but not sure if I
have write perm there?

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Mar  5 17:04:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 5 Mar 2005 17:04:07 +0100
Subject: [Softdevice-devel] old_stuff..
In-Reply-To: <1110035067.32583.0.camel@atlantis.netenviron.com>
References: <1110035067.32583.0.camel@atlantis.netenviron.com>
Message-ID: <200503051704.08040.stefan@lucke.in-berlin.de>

On Samstag, 5. M?rz 2005 16:04, Torgeir Veimo wrote:
> - is missing release 0.0.8 and 0.0.7. I can upload, but not sure if I
> have write perm there?

What exact is your problem ? They are still available here:
http://developer.berlios.de/project/showfiles.php?group_id=2051&release_id=4954

-- 
Stefan Lucke



From torgeir at pobox.com  Sat Mar  5 19:41:41 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 18:41:41 +0000
Subject: [Softdevice-devel] old_stuff..
In-Reply-To: <200503051704.08040.stefan@lucke.in-berlin.de>
References: <1110035067.32583.0.camel@atlantis.netenviron.com>
	 <200503051704.08040.stefan@lucke.in-berlin.de>
Message-ID: <1110048101.32583.5.camel@atlantis.netenviron.com>

On Sat, 2005-03-05 at 17:04 +0100, Stefan Lucke wrote:
> On Samstag, 5. M?rz 2005 16:04, Torgeir Veimo wrote:
> > - is missing release 0.0.8 and 0.0.7. I can upload, but not sure if I
> > have write perm there?
> 
> What exact is your problem ? They are still available here:
> http://developer.berlios.de/project/showfiles.php?group_id=2051&release_id=4954

Hmm, sorry didn't remember that location. 

When selecting a deinterlace method available through libavcodec's pp
library, it seems to be reset to zero when changing channel. This patch
fixes it;

[root at vigor10 softdevice]# cvs diff mpeg2decoder.c
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.18
diff -r1.18 mpeg2decoder.c
929,930d928
<   if (currentDeintMethod != deintWork)
<   {
932c930
<     if (currentDeintMethod > 2)
---
>   if (currentDeintMethod > 2)
934c932
<     if (currentDeintMethod > 1)
---
>   if (currentDeintMethod > 1)
935a934,935
>   {
>     if (currentDeintMethod != deintWork || ppmode == NULL)
936a937
>
941a943,945
>
>       ppmode = pp_get_mode_by_name_and_quality(setupStore.getPPValue
(), 6);
>       currentDeintMethod = deintWork;
943,944d946
<     ppmode = pp_get_mode_by_name_and_quality(setupStore.getPPValue(),
6);
<     currentDeintMethod = deintWork;
946d947
<

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sat Mar  5 19:58:52 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 18:58:52 +0000
Subject: [Softdevice-devel] Ready for 0.0.9pre1
In-Reply-To: <4228507B.5010808@e-dition.fr>
References: <200503032212.27018.stefan@lucke.in-berlin.de>
	 <4228507B.5010808@e-dition.fr>
Message-ID: <1110049132.32583.10.camel@atlantis.netenviron.com>

On Fri, 2005-03-04 at 13:11 +0100, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Has someone a pending modification or fix ?
> > 
> > If not, I'll release 0.0.9pre1 tomorrow .

There's still the aspect ratio bug on some channels here which change
a/r during commercial breaks. I'll try to get my head around it.

> (the 0.0. prefix is really diminishing the importance of this great plug-in)
 
I agree totally.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Mar  5 20:38:34 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 5 Mar 2005 20:38:34 +0100
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for 0.0.9pre1]
Message-ID: <200503052038.35042.stefan@lucke.in-berlin.de>

On Samstag, 5. M?rz 2005 19:58, Torgeir Veimo wrote:
> On Fri, 2005-03-04 at 13:11 +0100, Nicolas Huillard wrote:
> > Stefan Lucke a ?crit :
> > > Has someone a pending modification or fix ?
> > > 
> > > If not, I'll release 0.0.9pre1 tomorrow .
> 
> There's still the aspect ratio bug on some channels here which change
> a/r during commercial breaks. I'll try to get my head around it.

Is that the short sequence I got from you "T4: The O.C. There is a
commercial in 16:9 format, followed by the 4:3 main movie. Excerpt from
log with reported a/r changes:
Mar  5 20:34:51 jarada vdr[3907]: [VideoOut]: aspect changed (9 -> 14 ; 1,333333 -> 1,777778)
Mar  5 20:34:51 jarada vdr[3907]: [VideoOut]: 704x576 [0,0 704x576] -> 1024x576 [0,0 1024x576]
Mar  5 20:34:52 jarada vdr[3908]: buffer usage: 100% (tid=196616)
Mar  5 20:35:19 jarada vdr[3907]: [VideoOut]: aspect changed (14 -> 9 ; 1,777778 -> 1,333333)
Mar  5 20:35:19 jarada vdr[3907]: [VideoOut]: 704x576 [0,0 704x576] -> 1024x576 [128,0 768x576]

-- 
Stefan Lucke



From torgeir at pobox.com  Sat Mar  5 20:48:57 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 19:48:57 +0000
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for
	0.0.9pre1]
In-Reply-To: <200503052038.35042.stefan@lucke.in-berlin.de>
References: <200503052038.35042.stefan@lucke.in-berlin.de>
Message-ID: <1110052138.32583.12.camel@atlantis.netenviron.com>

On Sat, 2005-03-05 at 20:38 +0100, Stefan Lucke wrote:
> 
> > There's still the aspect ratio bug on some channels here which
> change
> > a/r during commercial breaks. I'll try to get my head around it.
> 
> Is that the short sequence I got from you "T4: The O.C

Yes.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sat Mar  5 20:53:49 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 19:53:49 +0000
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for
	0.0.9pre1]
In-Reply-To: <1110052138.32583.12.camel@atlantis.netenviron.com>
References: <200503052038.35042.stefan@lucke.in-berlin.de>
	 <1110052138.32583.12.camel@atlantis.netenviron.com>
Message-ID: <1110052430.32583.15.camel@atlantis.netenviron.com>

On Sat, 2005-03-05 at 19:48 +0000, Torgeir Veimo wrote:
> On Sat, 2005-03-05 at 20:38 +0100, Stefan Lucke wrote:
> > 
> > > There's still the aspect ratio bug on some channels here which
> > change
> > > a/r during commercial breaks. I'll try to get my head around it.
> > 
> > Is that the short sequence I got from you "T4: The O.C
> 
> Yes.

Cropping changes correctly, but the image itself is in the wrong a/r.
It's weird as I would suspect the cropping is done implicitly by the X
server itself?

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Mar  5 21:20:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 5 Mar 2005 21:20:07 +0100
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for 0.0.9pre1]
In-Reply-To: <1110052430.32583.15.camel@atlantis.netenviron.com>
References: <200503052038.35042.stefan@lucke.in-berlin.de> <1110052138.32583.12.camel@atlantis.netenviron.com> <1110052430.32583.15.camel@atlantis.netenviron.com>
Message-ID: <200503052120.07456.stefan@lucke.in-berlin.de>

On Samstag, 5. M?rz 2005 20:53, Torgeir Veimo wrote:
> On Sat, 2005-03-05 at 19:48 +0000, Torgeir Veimo wrote:
> > On Sat, 2005-03-05 at 20:38 +0100, Stefan Lucke wrote:
> > > 
> > > > There's still the aspect ratio bug on some channels here which
> > > change
> > > > a/r during commercial breaks. I'll try to get my head around it.
> > > 
> > > Is that the short sequence I got from you "T4: The O.C
> > 
> > Yes.
> 
> Cropping changes correctly, but the image itself is in the wrong a/r.
> It's weird as I would suspect the cropping is done implicitly by the X
> server itself?

We do cropping ourself. So which part is to your opinion at the wrong
a/r, commercial or movie. Do you get the same/similar messages ?
Check'd your old mail from 2004-08-24. At my setup the movie was
displayed at correct 4:3 aspect on a 4:3 area, no center cut out.
If the behaviour is different at your set please post the log messages
so see the scaling coordinates.
-- 
Stefan Lucke



From torgeir at pobox.com  Sat Mar  5 21:44:46 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 05 Mar 2005 20:44:46 +0000
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for
	0.0.9pre1]
In-Reply-To: <200503052120.07456.stefan@lucke.in-berlin.de>
References: <200503052038.35042.stefan@lucke.in-berlin.de>
	 <1110052138.32583.12.camel@atlantis.netenviron.com>
	 <1110052430.32583.15.camel@atlantis.netenviron.com>
	 <200503052120.07456.stefan@lucke.in-berlin.de>
Message-ID: <1110055486.32583.17.camel@atlantis.netenviron.com>

On Sat, 2005-03-05 at 21:20 +0100, Stefan Lucke wrote:
> On Samstag, 5. M?rz 2005 20:53, Torgeir Veimo wrote:
> > On Sat, 2005-03-05 at 19:48 +0000, Torgeir Veimo wrote:
> > > On Sat, 2005-03-05 at 20:38 +0100, Stefan Lucke wrote:
> > > > 
> > > > > There's still the aspect ratio bug on some channels here which
> > > > change
> > > > > a/r during commercial breaks. I'll try to get my head around it.
> > > > 
> > > > Is that the short sequence I got from you "T4: The O.C
> > > 
> > > Yes.
> > 
> > Cropping changes correctly, but the image itself is in the wrong a/r.
> > It's weird as I would suspect the cropping is done implicitly by the X
> > server itself?
> 
> We do cropping ourself. So which part is to your opinion at the wrong
> a/r, commercial or movie.

It depens on which one starts the sequence, as it is always correct
after a channel change.

>  Do you get the same/similar messages ?
> Check'd your old mail from 2004-08-24. At my setup the movie was
> displayed at correct 4:3 aspect on a 4:3 area, no center cut out.
> If the behaviour is different at your set please post the log messages
> so see the scaling coordinates.

Will do.
-- 
Torgeir Veimo <torgeir at pobox.com>



From ollo.diab at gmx.de  Sun Mar  6 09:51:19 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Sun, 6 Mar 2005 09:51:19 +0100 (MET)
Subject: [Softdevice-devel] HDTV & XV out & scaling
Message-ID: <31470.1110099079@www18.gmx.net>

Hi Stefan & list,

I have a question on the softdevice XV out scaling viewing HDTV channels
like HD1. I run the X server at 1280x1024 resolution because this is the
native resolution of my LCD. Softdevice runs and scales great using PAL
resolutions, but if I switch to HD1 the XV window stays the same size, but
the visuable picture is only a fraction of the full picture. It still scales
with the XV window, but I can not see the full 1920x1080 picture. It's hard
to describe and I was not (yet) able to make a screenshot of the behavior
I'm talking about.

Is there a limitation on how a larger input stream gets scaled down to a
smaller output resolution of the XV out driver?

Thanks,   Thomas

-- 
SMS bei wichtigen e-mails und Ihre Gedanken sind frei ...
Alle Infos zur SMS-Benachrichtigung: http://www.gmx.net/de/go/sms


From stefan at lucke.in-berlin.de  Sun Mar  6 21:56:15 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 6 Mar 2005 21:56:15 +0100
Subject: [Softdevice-devel] HDTV & XV out & scaling
In-Reply-To: <31470.1110099079@www18.gmx.net>
References: <31470.1110099079@www18.gmx.net>
Message-ID: <200503062156.15206.stefan@lucke.in-berlin.de>

On Sonntag, 6. M?rz 2005 09:51, Thomas Herrmann wrote:
> Hi Stefan & list,
> 
> I have a question on the softdevice XV out scaling viewing HDTV channels
> like HD1. I run the X server at 1280x1024 resolution because this is the
> native resolution of my LCD. Softdevice runs and scales great using PAL
> resolutions, but if I switch to HD1 the XV window stays the same size, but
> the visuable picture is only a fraction of the full picture. It still scales
> with the XV window, but I can not see the full 1920x1080 picture. It's hard
> to describe and I was not (yet) able to make a screenshot of the behavior
> I'm talking about.

Up to now I haven't spend any time on thinking of support for HDTV.
It should be easy (tm) to add support for larger areas.
Query the max supported xv dimensions and allocated matching shared
memory area. I don't know the performance implication of allocating
the largest possible area always.

> 
> Is there a limitation on how a larger input stream gets scaled down to a
> smaller output resolution of the XV out driver?

There are area limitations which are driver dependant. For my G550
largest xv imgae size is 1024x1024 :-(. You can check your limits with
xvinfo .


PS: This list is for members only. So please subscribe. Post from
non-members have to be approved individually which may
cause delays.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Mar  6 22:46:04 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 6 Mar 2005 22:46:04 +0100
Subject: [Softdevice-devel] HDTV & XV out & scaling
In-Reply-To: <200503062156.15206.stefan@lucke.in-berlin.de>
References: <31470.1110099079@www18.gmx.net> <200503062156.15206.stefan@lucke.in-berlin.de>
Message-ID: <200503062246.04566.stefan@lucke.in-berlin.de>

On Sonntag, 6. M?rz 2005 21:56, Stefan Lucke wrote:
> On Sonntag, 6. M?rz 2005 09:51, Thomas Herrmann wrote:
> > Hi Stefan & list,
> > 
> > I have a question on the softdevice XV out scaling viewing HDTV channels
> > like HD1. I run the X server at 1280x1024 resolution because this is the
> > native resolution of my LCD. Softdevice runs and scales great using PAL
> > resolutions, but if I switch to HD1 the XV window stays the same size, but
> > the visuable picture is only a fraction of the full picture. It still scales
> > with the XV window, but I can not see the full 1920x1080 picture. It's hard
> > to describe and I was not (yet) able to make a screenshot of the behavior
> > I'm talking about.
> 
> Up to now I haven't spend any time on thinking of support for HDTV.
> It should be easy (tm) to add support for larger areas.
> Query the max supported xv dimensions and allocated matching shared
> memory area. I don't know the performance implication of allocating
> the largest possible area always.

Hm, not so simple as originally thought, but not so complicated as expected.
Could you try attached diff and report your results ?

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xv-max-area.diff
Type: text/x-diff
Size: 5113 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050306/51cf3744/attachment.diff>

From noreply at berlios.de  Tue Mar  8 13:13:32 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Tue, 8 Mar 2005 13:13:32 +0100 (CET)
Subject: [Softdevice-devel] [Feature #687] start in fullscreen ,  safe parameter
Message-ID: <200503081213.j28CDWHV015749@unicorn.berlios.de>

Feature Request #687, was updated on 2005-Mar-08 13:13
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051

Category: None
Status: Open
Priority: 5
Summary: start in fullscreen ,  safe parameter

By: tagore
Date: 2005-Mar-08 13:13

Message:
Logged In: YES 
user_id=14338
Browser: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.4.3) Gecko/20041005

It would be great if you could start softdevice (xv) in
fullscreen-mode.  ("Option -F" - Request)

In general it would be nice if one could 
[ safe to a file | parse from commandline | compile in]
all the great default/settings one can make via ODS
(f.e. dinterlacing-method) or that are hotkeys built in
video-xv.c.

To me softdevice 0.0.8 seems performant enough to run
vdr as a parallel-independent Kiosk-Application on an own
X-Server beside gdmlogin on a sempron 2600 . 
Thanks for that great work!


----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051


From noreply at berlios.de  Tue Mar  8 21:56:18 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Tue, 8 Mar 2005 21:56:18 +0100 (CET)
Subject: [Softdevice-devel] [Feature #687] start in fullscreen ,  safe parameter
Message-ID: <200503082056.j28KuIxk006800@unicorn.berlios.de>

Feature Request #687, was updated on 2005-Mar-08 13:13
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051

Category: None
Status: Open
Priority: 5
Summary: start in fullscreen ,  safe parameter

By: lucke
Date: 2005-Mar-08 21:56

Message:
Logged In: YES 
user_id=8885
Browser: Mozilla/5.0 (compatible; Konqueror/3.1; Linux)

Start in fullscreen: 
 That should be an additional substring to th -vo option 
 something like "-vo xv:full" 
 
Save parameter: 
 That is already present via settings->plugins->softdevice 
 
X11 changes via OSD instead of hotkeys: 
 Could/should be done. 

----------------------------------------------------------------------

By: tagore
Date: 2005-Mar-08 13:13

Message:
Logged In: YES 
user_id=14338
Browser: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.4.3) Gecko/20041005

It would be great if you could start softdevice (xv) in
fullscreen-mode.  ("Option -F" - Request)

In general it would be nice if one could 
[ safe to a file | parse from commandline | compile in]
all the great default/settings one can make via ODS
(f.e. dinterlacing-method) or that are hotkeys built in
video-xv.c.

To me softdevice 0.0.8 seems performant enough to run
vdr as a parallel-independent Kiosk-Application on an own
X-Server beside gdmlogin on a sempron 2600 . 
Thanks for that great work!


----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051


From stefan at lucke.in-berlin.de  Tue Mar  8 22:30:48 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 8 Mar 2005 22:30:48 +0100
Subject: [Softdevice-devel] HDTV & XV out & scaling
In-Reply-To: <200503062246.04566.stefan@lucke.in-berlin.de>
References: <31470.1110099079@www18.gmx.net> <200503062156.15206.stefan@lucke.in-berlin.de> <200503062246.04566.stefan@lucke.in-berlin.de>
Message-ID: <200503082230.48882.stefan@lucke.in-berlin.de>

On Sonntag, 6. M?rz 2005 22:46, Stefan Lucke wrote:
> On Sonntag, 6. M?rz 2005 21:56, Stefan Lucke wrote:
> > On Sonntag, 6. M?rz 2005 09:51, Thomas Herrmann wrote:
> > > Hi Stefan & list,
> > > 
> > > I have a question on the softdevice XV out scaling viewing HDTV channels
> > > like HD1. I run the X server at 1280x1024 resolution because this is the
> > > native resolution of my LCD. Softdevice runs and scales great using PAL
> > > resolutions, but if I switch to HD1 the XV window stays the same size, but
> > > the visuable picture is only a fraction of the full picture. It still scales
> > > with the XV window, but I can not see the full 1920x1080 picture. It's hard
> > > to describe and I was not (yet) able to make a screenshot of the behavior
> > > I'm talking about.
> > 
> > Up to now I haven't spend any time on thinking of support for HDTV.
> > It should be easy (tm) to add support for larger areas.
> > Query the max supported xv dimensions and allocated matching shared
> > memory area. I don't know the performance implication of allocating
> > the largest possible area always.
> 
> Hm, not so simple as originally thought, but not so complicated as expected.
> Could you try attached diff and report your results ?

With a slight modification Thomas was able to HDTV. There are some
additional troubles with deinterlacing filter which caused segfaults
and with scaled OSD which showed up with messed colors.

I'll commit the modified patch tomorrow.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Mar  8 22:55:37 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 8 Mar 2005 22:55:37 +0100
Subject: [Softdevice-devel] OSD handling
Message-ID: <200503082255.37142.stefan@lucke.in-berlin.de>

OSD handling is someway odd. Each output method does it's own things.
There are several variables in use and which one has which dedicated
meaning is sometimes not clear to me.

For functionality we have to define some common behaviour.

I would suggest:

- All output method should be capable to draw a centered unscaled OSD.
  By that you get the OSD allways on screen independant of your choosen
  screen resolution.
- Center should/could be adjustable top/bottom left/right in +/- 100% which
  in term would be resolution independant.
- vdr's absolute left/top coordinates (positive range only) should be ignored.
- For scaled OSD our scaler should provide OSD dimensions, so that
  scaled OSD may keep it's original 4:3 aspect ratio.


-- 
Stefan Lucke



From ollo.diab at gmx.de  Wed Mar  9 09:31:54 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Wed, 9 Mar 2005 09:31:54 +0100 (MET)
Subject: [Softdevice-devel] softdevice & XvMC lib?
Message-ID: <11224.1110357114@www46.gmx.net>

Hello,

sorry for the email in german before. I'm reasking in english now:

My question is if somebody could include a code path to use hardware
accellerated MPEG decoding provided by the libXvMC(W). This seems to be
necessary at least for my system to decode and view HDTV without frame
drops. 

I feel very sorry to not have the ability to code such great feature, but I
can point ot the mpeg2play_accel project (http://www.xfree86.org/~mvojkovi/)
which includes such code path. And I can offer testing such developement.

Anyhow, by using the libXvMCW from unichrome project, suddently all VIA
CLE266 users get hardware accelleration too (not only for HDTV). Not sure if
ATI provides a libXvMC too.

Thanks & best regards,    Thomas

-- 
DSL Komplett von GMX +++ Superg?nstig und stressfrei einsteigen!
AKTION "Kein Einrichtungspreis" nutzen: http://www.gmx.net/de/go/dsl


From torgeir at pobox.com  Wed Mar  9 15:03:07 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 09 Mar 2005 14:03:07 +0000
Subject: [Softdevice-devel] softdevice & XvMC lib?
In-Reply-To: <11224.1110357114@www46.gmx.net>
References: <11224.1110357114@www46.gmx.net>
Message-ID: <1110376988.5769.44.camel@atlantis.netenviron.com>

On Wed, 2005-03-09 at 09:31 +0100, Thomas Herrmann wrote:
> Hello,
> 
> sorry for the email in german before. I'm reasking in english now:
> 
> My question is if somebody could include a code path to use hardware
> accellerated MPEG decoding provided by the libXvMC(W). This seems to be
> necessary at least for my system to decode and view HDTV without frame
> drops. 
> 
> I feel very sorry to not have the ability to code such great feature, but I
> can point ot the mpeg2play_accel project (http://www.xfree86.org/~mvojkovi/)
> which includes such code path. And I can offer testing such developement.
> 
> Anyhow, by using the libXvMCW from unichrome project, suddently all VIA
> CLE266 users get hardware accelleration too (not only for HDTV). Not sure if
> ATI provides a libXvMC too.

It think it's only an issue of none of the developers currently have any
need for it personally (or have actual hardware that can do it). I know
ppl are looking into support on ATI cards, but it's not available yet. I
don't think it's that difficult as libavcodec already has support for
using XvMC type acceleration.

-- 
Torgeir Veimo <torgeir at pobox.com>



From ollo.diab at gmx.de  Wed Mar  9 15:30:58 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Wed, 9 Mar 2005 15:30:58 +0100 (MET)
Subject: [Softdevice-devel] softdevice & XvMC lib?
References: <1110376988.5769.44.camel@atlantis.netenviron.com>
Message-ID: <19056.1110378658@www51.gmx.net>

Hi Torgeir,
> 
> It think it's only an issue of none of the developers currently have any
> need for it personally (or have actual hardware that can do it). I know
> ppl are looking into support on ATI cards, but it's not available yet. I
> don't think it's that difficult as libavcodec already has support for
> using XvMC type acceleration.

Oh, that's new to me. How can I build libavcodec with libXvMC support?

Thanks,   Thomas


> 
> -- 
> Torgeir Veimo <torgeir at pobox.com>
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
DSL Komplett von GMX +++ Superg?nstig und stressfrei einsteigen!
AKTION "Kein Einrichtungspreis" nutzen: http://www.gmx.net/de/go/dsl


From torgeir at pobox.com  Wed Mar  9 15:50:14 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 09 Mar 2005 14:50:14 +0000
Subject: [Softdevice-devel] softdevice & XvMC lib?
In-Reply-To: <19056.1110378658@www51.gmx.net>
References: <1110376988.5769.44.camel@atlantis.netenviron.com>
	 <19056.1110378658@www51.gmx.net>
Message-ID: <1110379814.5769.52.camel@atlantis.netenviron.com>

On Wed, 2005-03-09 at 15:30 +0100, Thomas Herrmann wrote:
> Hi Torgeir,
> > 
> > It think it's only an issue of none of the developers currently have any
> > need for it personally (or have actual hardware that can do it). I know
> > ppl are looking into support on ATI cards, but it's not available yet. I
> > don't think it's that difficult as libavcodec already has support for
> > using XvMC type acceleration.
> 
> Oh, that's new to me. How can I build libavcodec with libXvMC support?

http://itdp.fh-biergarten.de/mplayer-dev-eng/2003-06/msg00374.html

You'd have to search the ffmpeg devel mailing lists. Basically it's not
enough to just build libavcodec with XvMC support, as the interaction
with whatever output method is done through softdevice's video-* output
code, which needs to get support for it as well.

See also http://sourceforge.net/mailarchive/message.php?msg_id=9065904

-- 
Torgeir Veimo <torgeir at pobox.com>



From ollo.diab at gmx.de  Thu Mar 10 08:50:04 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Thu, 10 Mar 2005 08:50:04 +0100 (MET)
Subject: [Softdevice-devel] softdevice & XvMC lib?
References: <1110379814.5769.52.camel@atlantis.netenviron.com>
Message-ID: <17595.1110441004@www49.gmx.net>

Hi Torgeir,

> On Wed, 2005-03-09 at 15:30 +0100, Thomas Herrmann wrote:
> > Hi Torgeir,
> > > 
> > 
> > Oh, that's new to me. How can I build libavcodec with libXvMC support?
> 
> http://itdp.fh-biergarten.de/mplayer-dev-eng/2003-06/msg00374.html
> 
> You'd have to search the ffmpeg devel mailing lists. Basically it's not
> enough to just build libavcodec with XvMC support, as the interaction
> with whatever output method is done through softdevice's video-* output
> code, which needs to get support for it as well.
> 
> See also http://sourceforge.net/mailarchive/message.php?msg_id=9065904
> 

... I see. I've checked the ffmpeg cvs tree and can see the "HAVE_XVMC"
defines in the code. Just that the configure script does not support it.
Anyhow, I was able to build a XVMC enabled libavcodec by tweaking the
config.mak and Makefile.

Ok, what's next? How to add the output methode to the softdevice's video-xv
code? I guess it has to link the actual libXvMC.so and to call the right
methodes?!

Thanks,   Thomas


> -- 
> Torgeir Veimo <torgeir at pobox.com>
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
DSL Komplett von GMX +++ Superg?nstig und stressfrei einsteigen!
AKTION "Kein Einrichtungspreis" nutzen: http://www.gmx.net/de/go/dsl


From M.Wache at gmx.net  Thu Mar 10 09:11:29 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 10 Mar 2005 09:11:29 +0100
Subject: [Softdevice-devel] Xv-out and Ati Mach64
In-Reply-To: <200503042024.20313.stefan@lucke.in-berlin.de>
References: <200503042024.20313.stefan@lucke.in-berlin.de>
Message-ID: <42300131.3070207@gmx.net>

Stefan Lucke wrote:
> Has someone above combination running ?
> At vdr-portal a guy has problems with this combination and X11 
> (X.org 6.8.0) on a vdr client together with streamdev (OSD and sound,
> but no video).
> 
I own two slightly different Ati Mach64, but I never tried them with 
softdevice and Xv-out. I will have a look at the weekend, I'll have to 
change the graphics card in my box...

Martin


From M.Wache at gmx.net  Thu Mar 10 09:56:56 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 10 Mar 2005 09:56:56 +0100
Subject: [Softdevice-devel] OSD handling
In-Reply-To: <200503082255.37142.stefan@lucke.in-berlin.de>
References: <200503082255.37142.stefan@lucke.in-berlin.de>
Message-ID: <42300BD8.9050003@gmx.net>

Stefan Lucke wrote:
> OSD handling is someway odd. Each output method does it's own things.
> There are several variables in use and which one has which dedicated
> meaning is sometimes not clear to me.
I agree, the OSD handling in a mess...
> 
> For functionality we have to define some common behaviour.
> 
> I would suggest:
> 
> - All output method should be capable to draw a centered unscaled OSD.
>   By that you get the OSD allways on screen independant of your choosen
>   screen resolution.
I don't agree on this point. I can only watch TV in fb-out mode with a 
resolution of 640x480. If the OSD is not scaled I see only a part of the 
OSD. The same for Xv-out when useing a smaller window. I don't think 
that unscaled OSD makes sense here.
> - Center should/could be adjustable top/bottom left/right in +/- 100% which
>   in term would be resolution independant.
> - vdr's absolute left/top coordinates (positive range only) should be ignored.
> - For scaled OSD our scaler should provide OSD dimensions, so that
>   scaled OSD may keep it's original 4:3 aspect ratio.
> 
These suggestions sound reasonable.
As I already said I agree that the OSD is a mess, and it certainly 
deserves a cleanup. In my opinion we should use the same code for all 
video out methods where it is possible and have as few differences as 
possible. But that's not only the OSD drawing which could be done 
cleaner. For instance the copying from the picture buffer to the 
graphics card memory is done different in all video out methods, but 
it's essentially the same thing. Also the conversion to YUV2, there is 
the exact same code in vidix-out and dfb-out, why not have one routine 
which does the copying and, if necessary, the format conversion?

For the OSD, what I would like to do is to replace the vdr's cBitmap 
with our own. Then we could draw the OSD in the right pixel format, and 
all the format conversions in Draw() won't be necessary and scaling 
could be done a lot faster, because we won't have to lookup all the 
indices...
At a first glance it may be enough to overload cBitmap::SetIndex(), 
unfortunaly it is not a virtual method. We could give it a try and if it 
works ask Klaus Schmidiger to make SetIndex virtual.

Bye,
Martin


From nhuillard at e-dition.fr  Thu Mar 10 10:57:43 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 10 Mar 2005 10:57:43 +0100
Subject: [Softdevice-devel] softdevice & XvMC lib?
In-Reply-To: <17595.1110441004@www49.gmx.net>
References: <1110379814.5769.52.camel@atlantis.netenviron.com> <17595.1110441004@www49.gmx.net>
Message-ID: <42301A17.8040001@e-dition.fr>

Thomas Herrmann a ?crit :
> Hi Torgeir,
> 
>>On Wed, 2005-03-09 at 15:30 +0100, Thomas Herrmann wrote:
>>
>>You'd have to search the ffmpeg devel mailing lists. Basically it's not
>>enough to just build libavcodec with XvMC support, as the interaction
>>with whatever output method is done through softdevice's video-* output
>>code, which needs to get support for it as well.
>>
>>See also http://sourceforge.net/mailarchive/message.php?msg_id=9065904
> 
> ... I see. I've checked the ffmpeg cvs tree and can see the "HAVE_XVMC"
> defines in the code. Just that the configure script does not support it.
> Anyhow, I was able to build a XVMC enabled libavcodec by tweaking the
> config.mak and Makefile.

Does this means that XvMC is now X/Xv-independent ?
What I would ideally like to have is hardware MPEG2 decoding on DirectFB.

-- 
NH


From stefan at lucke.in-berlin.de  Thu Mar 10 21:12:00 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 10 Mar 2005 21:12:00 +0100
Subject: [Softdevice-devel] vdr total !!
Message-ID: <200503102112.00877.stefan@lucke.in-berlin.de>

Hi,

I made an update to softdevice's homepage which shows now two addtitional
screenshots.

There are 2 vdr instances running concurrently on screen and show two
live streams. Oh yes cpu P4 2.2G  was quite busy so I didn't try 3
concurrent vdrs.

Screenshots were taken by normal screenshot utilities. My Xserver is running
with texture xv enabled. That is the following line in the device section of XF86Config:
  Option       "TexturedVideo" "true"

In this mode there are about 31 xv ports available:
Mar 10 20:19:16 jarada vdr[2854]: [XvVideoOut]: Matrox G-Series Texture Engine: available ports 62 - 93

Softdevice modification is rather small: just adding a dummy
audio output device ;-) .

Enjoy.

-- 
Stefan Lucke



From noreply at berlios.de  Sun Mar 13 20:55:55 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Sun, 13 Mar 2005 10:55:55 -0900 (AKST)
Subject: [Softdevice-devel] [Feature #709] vidix output for nvidia cards
Message-ID: <200503131955.j2DJttSx011825@unicorn.berlios.de>

Feature Request #709, was updated on 2005-Mar-13 10:55
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=709&group_id=2051

Category: None
Status: Open
Priority: 5
Summary: vidix output for nvidia cards

By: zottel9
Date: 2005-Mar-13 10:55

Message:
Logged In: YES 
user_id=14496
Browser: Mozilla/4.0 (compatible; MSIE 5.5; Windows 98; Win 9x 4.90)

the vidix driver for nvidia Cards can't work with 
framebuffer enabled, i.e. it only supports video 
playback on plain text console (mplayer -vo cvidix), 
but softdevice requires access to the framebuffer 
device during vidix initialization. please add console 
vidix support (see vo_cvidix.c from mplayer 
sources).

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=709&group_id=2051


From stefan at lucke.in-berlin.de  Mon Mar 14 23:12:52 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 14 Mar 2005 23:12:52 +0100
Subject: [Softdevice-devel] dvd plugin with softdevice
Message-ID: <200503142312.53114.stefan@lucke.in-berlin.de>

Hi,

based on Martin's work, I made a patch to get the cvs version of the
dvd plugin work with softdevice.

If that wouldn't disturb Martin's next setps we can include this
into cvs if it works for oters too.

To get sound, you have to set vdr osd option "UseDolbyDigital" to no.
Value of this option controls vdr's behaviour of recordings too.

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: softdevice-dvd.diff
Type: text/x-diff
Size: 8750 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050314/70aa461a/attachment.diff>

From M.Wache at gmx.net  Tue Mar 15 17:10:17 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 15 Mar 2005 17:10:17 +0100
Subject: [Softdevice-devel] dvd plugin with softdevice
In-Reply-To: <200503142312.53114.stefan@lucke.in-berlin.de>
References: <200503142312.53114.stefan@lucke.in-berlin.de>
Message-ID: <423708E9.6050209@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> based on Martin's work, I made a patch to get the cvs version of the
> dvd plugin work with softdevice.
> 
> If that wouldn't disturb Martin's next setps we can include this
> into cvs if it works for oters too.
No, it won't disturb my work on using libavformat. I had to make so may 
changes in mpeg2decoder.c that there are almost no similarities anyway.

On the other hand, I hope to be able to publish my libavformat work the 
next weekend. Live tv with ac3 already works (Stereo, in 5.1 mode I get 
only the rear speakers with my stereo soundcard, has anyone a 5.1 card 
with Speakers connected directly to the card? - there is no ac3 
passthrough yet), watching recordings also works (there are some minor 
problems with still pictures though...), and it is now stable. What 
remains to be done is mainly compilation issues with older vdr versions 
and ffmpeg versions.

Also the dvd-plugin works, but I still have some troubles with audio 
buffer underruns in ac3 mode :-(.

Since we just released a new version, think I will commit the changes 
directly to the CVS, so that we don't have to mess around with patches, 
or are there any objections?

Bye,
Martin


From torgeir at pobox.com  Tue Mar 15 17:18:32 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 15 Mar 2005 16:18:32 +0000
Subject: [Softdevice-devel] dvd plugin with softdevice
In-Reply-To: <423708E9.6050209@gmx.net>
References: <200503142312.53114.stefan@lucke.in-berlin.de>
	 <423708E9.6050209@gmx.net>
Message-ID: <1110903512.5496.24.camel@africa.netenviron.com>

On Tue, 2005-03-15 at 17:10 +0100, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > based on Martin's work, I made a patch to get the cvs version of the
> > dvd plugin work with softdevice.
> > 
> > If that wouldn't disturb Martin's next setps we can include this
> > into cvs if it works for oters too.
> No, it won't disturb my work on using libavformat. I had to make so may 
> changes in mpeg2decoder.c that there are almost no similarities anyway.

> Also the dvd-plugin works, but I still have some troubles with audio 
> buffer underruns in ac3 mode :-(.

Are you padding up ac3 packets correctly? I remember xine had this issue
a long time ago.


-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Tue Mar 15 17:33:45 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 15 Mar 2005 17:33:45 +0100
Subject: [Softdevice-devel] dvd plugin with softdevice
In-Reply-To: <1110903512.5496.24.camel@africa.netenviron.com>
References: <200503142312.53114.stefan@lucke.in-berlin.de>	 <423708E9.6050209@gmx.net> <1110903512.5496.24.camel@africa.netenviron.com>
Message-ID: <42370E69.5080206@gmx.net>

Torgeir Veimo wrote:
> On Tue, 2005-03-15 at 17:10 +0100, Martin Wache wrote:
> 
>>Stefan Lucke wrote:
>>
>>>Hi,
>>>
>>>based on Martin's work, I made a patch to get the cvs version of the
>>>dvd plugin work with softdevice.
>>>
>>>If that wouldn't disturb Martin's next setps we can include this
>>>into cvs if it works for oters too.
>>
>>No, it won't disturb my work on using libavformat. I had to make so may 
>>changes in mpeg2decoder.c that there are almost no similarities anyway.
> 
> 
>>Also the dvd-plugin works, but I still have some troubles with audio 
>>buffer underruns in ac3 mode :-(.
> 
> 
> Are you padding up ac3 packets correctly? I remember xine had this issue
> a long time ago.
> 
> 
Was this related to the dvd-plugin? Because live Tv and recordings are 
working fine... Maybe you are right, libavformat sometimes tried to skip 
bytes...
Are there any links?

Martin


From stefan at lucke.in-berlin.de  Tue Mar 15 18:12:31 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 15 Mar 2005 18:12:31 +0100
Subject: [Softdevice-devel] dvd plugin with softdevice
In-Reply-To: <423708E9.6050209@gmx.net>
References: <200503142312.53114.stefan@lucke.in-berlin.de> <423708E9.6050209@gmx.net>
Message-ID: <200503151812.31797.stefan@lucke.in-berlin.de>

On Dienstag, 15. M?rz 2005 17:10, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > based on Martin's work, I made a patch to get the cvs version of the
> > dvd plugin work with softdevice.
> > 
> > If that wouldn't disturb Martin's next setps we can include this
> > into cvs if it works for oters too.
> No, it won't disturb my work on using libavformat. I had to make so may 
> changes in mpeg2decoder.c that there are almost no similarities anyway.

So I'll tag current cvs with v010post1 commit the dvd diff and tag that
with v010post2. 

> 
> On the other hand, I hope to be able to publish my libavformat work the 
> next weekend. Live tv with ac3 already works (Stereo, in 5.1 mode I get 
> only the rear speakers with my stereo soundcard, has anyone a 5.1 card 
> with Speakers connected directly to the card?

Checked mine: production system has a 4ch card with (hopefully AC3
pass through.

> - there is no ac3 passthrough yet),

:-( 

> watching recordings also works (there are some minor 
> problems with still pictures though...), and it is now stable. What 
> remains to be done is mainly compilation issues with older vdr versions 
> and ffmpeg versions.

Which ffmpeg version do you use and for which ffmpeg version do you
expect problems ? 

> 
> Also the dvd-plugin works, but I still have some troubles with audio 
> buffer underruns in ac3 mode :-(.

Ffmpeg has a resampler. There real playback rate should be measured
and compared to arrival rate.

> 
> Since we just released a new version, think I will commit the changes 
> directly to the CVS, so that we don't have to mess around with patches, 
> or are there any objections?

No, as sooner as better.

-- 
Stefan Lucke



From softdevice at ckollmeier.de  Wed Mar 16 11:20:26 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Wed, 16 Mar 2005 11:20:26 +0100
Subject: [Softdevice-devel] directfb questions
Message-ID: <200503161120.26876.softdevice@ckollmeier.de>

Hi!

First of all, I am new here, so lets introduce myself: Carsten, 
interested in helping out in the development of softdevice 
(especially directfb on mga and DD). For I'm not quite fit in the 
plugin yet, I can offer testing things. My configuration: VDR 1.3.22 
on PIII 1GHz, matrox G450 card, Soundblaster Live! card.

What is the current status of the directfb part? On my system, the 
directfb output is a slower than vidix? Does it use the BES of the 
matrox card? With mplayer, I can choose the outputs -vo directfb and 
-vo dfbmga with dfbmga a lot faster than directfb, so I assume 
softdevice doesn't use the accelaration possibilitites of the Matrox 
card?

Hope I can help?!

Carsten 


From softdevice at ckollmeier.de  Wed Mar 16 11:28:26 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Wed, 16 Mar 2005 11:28:26 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
Message-ID: <200503161128.26455.softdevice@ckollmeier.de>

Hi!

Me again, thought it was better to handle this in a seperate thread.

As I understand, DD out could be done via Bitstreamout, but this is 
not developed yet?

In the moment (using the cvs-Head), Bitstreamout produces a big lag 
in A/V sync (~10s). With DD sound, it produces quiet, then a sharp 
digital squeak, finally the VDR crashes.

Is it planned to get DD working?

As I said before, I can offer helping out, for the moment I can help 
by testing things, but as soon I have understood the way the plugin 
works, I can do more... (Is there some "good literature" on how it 
works?)

Carsten


From M.Wache at gmx.net  Wed Mar 16 17:43:11 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 16 Mar 2005 17:43:11 +0100
Subject: [Softdevice-devel] dvd plugin with softdevice
In-Reply-To: <200503151812.31797.stefan@lucke.in-berlin.de>
References: <200503142312.53114.stefan@lucke.in-berlin.de> <423708E9.6050209@gmx.net> <200503151812.31797.stefan@lucke.in-berlin.de>
Message-ID: <4238621F.9010108@gmx.net>

> Which ffmpeg version do you use and for which ffmpeg version do you
> expect problems ? 
I'm currently working with ffmpeg-0.4.9pre1, there are some differences 
in the pts handling of libavformat of ffmpeg-0.4.8.

> 
> 
>>Also the dvd-plugin works, but I still have some troubles with audio 
>>buffer underruns in ac3 mode :-(.

Don't worry :-) I found a bug in my code.... Now dvd playback is smooth 
for both ac3 and pcm audio. The only strange thing is that live tv and 
the playback of vdr recordings were not affected.

So now what remains are only compatibility checks... Hmm, I might be 
even finished before the weekend :-).

Martin



From M.Wache at gmx.net  Wed Mar 16 18:14:31 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 16 Mar 2005 18:14:31 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <200503161128.26455.softdevice@ckollmeier.de>
References: <200503161128.26455.softdevice@ckollmeier.de>
Message-ID: <42386977.6020009@gmx.net>

Carsten Kollmeier wrote:
> Hi!
> 
> Me again, thought it was better to handle this in a seperate thread.
> 
> As I understand, DD out could be done via Bitstreamout, but this is 
> not developed yet?
In principle it should work since the softdevice tries to behave just 
like a FF-card, but as far as I know noone ever tried to use the 
Bitstreamout with the softdevice.

> 
> In the moment (using the cvs-Head), Bitstreamout produces a big lag 
> in A/V sync (~10s). With DD sound, it produces quiet, then a sharp 
> digital squeak, finally the VDR crashes.
Ok, so do I understand correctly that with only mp2-audio the 
combination of Bitstreamout and softdevice works except for the bad A/V 
sync? Do you get the audio from the softdevice or from the Bitstreamout? 
Maybe I can explain the bad A/V sync. The softdevice reports only an 
approximate pts of the video stream to other devices. Normally this is 
okay, but for A/V sync this may be too bad... I will try to improve 
precision of the reported pts, hopefully this helps.

The crash in DD-mode is very likely caused by the softdevice, it doesn't 
understand ac3, and tries to handle it like mp2. This causes the noises 
and the crash. I will commit some changes to the softdevice-cvs this 
weekend which will hopefully cure this crash.

> 
> Is it planned to get DD working?
Sure, but I don't own any DD equipment, so I can't test SPDIF out.

> 
> As I said before, I can offer helping out, for the moment I can help 
> by testing things, but as soon I have understood the way the plugin 
> works, I can do more... (Is there some "good literature" on how it 
> works?)
Hm, there is the source code... Not that I would call it "good 
literature", but it is certainly the best documentation. For the 
understanding of the plugin/device interface I found the vdr header 
files quite usefull, they contain quite a lot of comments. And if you 
have some specific questions you can always ask...

Martin


From stefan at lucke.in-berlin.de  Wed Mar 16 19:04:56 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 16 Mar 2005 19:04:56 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <42386977.6020009@gmx.net>
References: <200503161128.26455.softdevice@ckollmeier.de> <42386977.6020009@gmx.net>
Message-ID: <200503161904.57024.stefan@lucke.in-berlin.de>

On Mittwoch, 16. M?rz 2005 18:14, Martin Wache wrote:
> Carsten Kollmeier wrote:
> > Hi!
> > 
> > Me again, thought it was better to handle this in a seperate thread.
> > 
> > As I understand, DD out could be done via Bitstreamout, but this is 
> > not developed yet?
> In principle it should work since the softdevice tries to behave just 
> like a FF-card, but as far as I know noone ever tried to use the 
> Bitstreamout with the softdevice.
> 
> > 
> > In the moment (using the cvs-Head), Bitstreamout produces a big lag 
> > in A/V sync (~10s). With DD sound, it produces quiet, then a sharp 
> > digital squeak, finally the VDR crashes.
> Ok, so do I understand correctly that with only mp2-audio the 
> combination of Bitstreamout and softdevice works except for the bad A/V 
> sync? Do you get the audio from the softdevice or from the Bitstreamout? 
> Maybe I can explain the bad A/V sync. The softdevice reports only an 
> approximate pts of the video stream to other devices. Normally this is 
> okay, but for A/V sync this may be too bad... I will try to improve 
> precision of the reported pts, hopefully this helps.
> 
> The crash in DD-mode is very likely caused by the softdevice, it doesn't 
> understand ac3, and tries to handle it like mp2. This causes the noises 
> and the crash. I will commit some changes to the softdevice-cvs this 
> weekend which will hopefully cure this crash.

Cvs version should only lock 0x1bd stream when it is lpcm.
I think we should have a deeper look at this when your decoder changes
are in cvs.

One problem with bitstreamout could be that it tries to open alsa which we
have already open-> Suspend audio only ??

> 
> > 
> > Is it planned to get DD working?
> Sure, but I don't own any DD equipment, so I can't test SPDIF out.

I can do that, currently in use by dxr3 card.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Wed Mar 16 19:10:27 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 16 Mar 2005 19:10:27 +0100
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <200503161120.26876.softdevice@ckollmeier.de>
References: <200503161120.26876.softdevice@ckollmeier.de>
Message-ID: <200503161910.27616.stefan@lucke.in-berlin.de>

On Mittwoch, 16. M?rz 2005 11:20, Carsten Kollmeier wrote:
> Hi!
> 
> First of all, I am new here, so lets introduce myself: Carsten, 
> interested in helping out in the development of softdevice 
> (especially directfb on mga and DD). For I'm not quite fit in the 
> plugin yet, I can offer testing things. My configuration: VDR 1.3.22 
> on PIII 1GHz, matrox G450 card, Soundblaster Live! card.

cpu power should be ok.

> 
> What is the current status of the directfb part? On my system, the 
> directfb output is a slower than vidix? Does it use the BES of the 
> matrox card? With mplayer, I can choose the outputs -vo directfb and 
> -vo dfbmga with dfbmga a lot faster than directfb, so I assume 
> softdevice doesn't use the accelaration possibilitites of the Matrox 
> card?

Acceleration is used as it is available.
Which version of DFB do you use ?
Which output mode do you use (vga vs tv-out) ?
Which pixel format do you use YV12 vs YUV2 ?

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Wed Mar 16 19:12:25 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 16 Mar 2005 19:12:25 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <42386977.6020009@gmx.net>
References: <200503161128.26455.softdevice@ckollmeier.de> <42386977.6020009@gmx.net>
Message-ID: <42387709.4010708@users.sourceforge.net>

Martin Wache wrote:
> Carsten Kollmeier wrote:
>> Hi!
>> 
>> Me again, thought it was better to handle this in a seperate thread.
>> 
>> As I understand, DD out could be done via Bitstreamout, but this is 
>> not developed yet?
> In principle it should work since the softdevice tries to behave just 
> like a FF-card, but as far as I know noone ever tried to use the 
> Bitstreamout with the softdevice.

Hi!

I tried to use softdevice & bitstreamout on my single budget (Nova-S) 
system with CMI8738 SPDIF-out and external decoder, and I think the 
crash I get is due to the fact that both bitstreamout and softdevice try 
to access the SPDIF.
For me, as I do not have a FF-card with a physical SPDIF output to loop 
through my soundcard and control this with bitstreamout, the best 
solution would be if softdevice could just passthrough DD as well.
Forgot to mention, it's working for  stereo MP2, but not for mono. If 
you could please have a look on this mono issue too (besides DD of 
course ;-), I think the decoded PCM must also be upmixed to stereo, I'm 
suspecting that libavcodec or ffmpeg or whatever you use for decoding in 
softdevice just tries to pass the decoded PCM to the SPDIF as is, and 
I'm not aware of any external decoder to handle mono PCM, as it has to 
be exactly like the stereo PCM on Audio-CDs by the Red book (mono 
material is just too identical channels, too).


Keep up the good work!

Lucian

P.S. this surely belongs to a new thread, but what about DirectFB output 
on interlaced devices (TV-out of a Matrox G400 for example), has there 
been any improvement in the field parity issues? The output is still 
jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
completely turn of deinterlacing (as it is not needed at all on a an 
"interlaced-by-nature" device like a standard PAL TV with no fancy 
feateres) and just take care of the right field order?


From torgeir at pobox.com  Wed Mar 16 19:23:54 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 16 Mar 2005 18:23:54 +0000
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <42387709.4010708@users.sourceforge.net>
References: <200503161128.26455.softdevice@ckollmeier.de>
	 <42386977.6020009@gmx.net>  <42387709.4010708@users.sourceforge.net>
Message-ID: <1110997434.9075.20.camel@africa.netenviron.com>

On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> Martin Wache wrote:
> > Carsten Kollmeier wrote:
> >> Hi!
> >> 
> >> Me again, thought it was better to handle this in a seperate thread.
> >> 
> >> As I understand, DD out could be done via Bitstreamout, but this is 
> >> not developed yet?
> > In principle it should work since the softdevice tries to behave just 
> > like a FF-card, but as far as I know noone ever tried to use the 
> > Bitstreamout with the softdevice.
> 
> Hi!
> 
> I tried to use softdevice & bitstreamout on my single budget (Nova-S) 
> system with CMI8738 SPDIF-out and external decoder, and I think the 
> crash I get is due to the fact that both bitstreamout and softdevice try 
> to access the SPDIF.

Stefan recently added a dummy audio output option, try -ao dummy:

You'll need the cvs version of softdevice for this.

-- 
Torgeir Veimo <torgeir at pobox.com>



From softdevice at ckollmeier.de  Wed Mar 16 20:09:54 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Wed, 16 Mar 2005 20:09:54 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <42386977.6020009@gmx.net>
References: <200503161128.26455.softdevice@ckollmeier.de> <42386977.6020009@gmx.net>
Message-ID: <200503162009.55087.softdevice@ckollmeier.de>

Am Mittwoch, 16. M?rz 2005 18:14 schrieb Martin Wache:
> Ok, so do I understand correctly that with only mp2-audio the
> combination of Bitstreamout and softdevice works except for the
> bad A/V sync?

As I experienced it, it crashed to after a while. But I didn't tried 
it further with mp2-Sound, because it worked perfectly without 
bitstreamout.

> The crash in DD-mode is very likely caused by the softdevice, it
> doesn't understand ac3, and tries to handle it like mp2. This
> causes the noises and the crash. I will commit some changes to the
> softdevice-cvs this weekend which will hopefully cure this crash.

If I got it right, the bitstreamout isn't the best way to get DD into 
my receiver, as it aims on FF-cards? The best way to handle this 
would be to give the ac3-stream directly to the sound card? This 
would be a nice feature (I think of an option like "-ac hwac3" on 
mplayer or a configuration option like the xine plugin has).

> > Is it planned to get DD working?
>
> Sure, but I don't own any DD equipment, so I can't test SPDIF out.

I own some and would be willing to test :-)

Carsten


From softdevice at ckollmeier.de  Wed Mar 16 20:24:28 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Wed, 16 Mar 2005 20:24:28 +0100
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <200503161910.27616.stefan@lucke.in-berlin.de>
References: <200503161120.26876.softdevice@ckollmeier.de> <200503161910.27616.stefan@lucke.in-berlin.de>
Message-ID: <200503162024.29120.softdevice@ckollmeier.de>

Am Mittwoch, 16. M?rz 2005 19:10 schrieb Stefan Lucke:
> > My configuration:
> > VDR 1.3.22 on PIII 1GHz, matrox G450 card, Soundblaster Live!
> > card.
>
> cpu power should be ok.

top says ~50% cpu-load.

> Acceleration is used as it is available.
> Which version of DFB do you use ?

DirectFB 0.9.22 is running.

> Which output mode do you use (vga vs tv-out) ?

I'm using vga. TV-out would be interesting, but my TV is broken...

> Which pixel format do you use YV12 vs YUV2 ?

Uhmm, I will look: Ok, softdevice tells me, it uses I420, I'm not 
shure wether DirectFB uses this too (What is the default, for I have 
nothing configured in directfbrc?).

Could this be the problem with the slow output, for DirectFB has to 
convert from I420? Then I will be testing dfb-output right away, for 
I don't like the vidix-output I am using not very much.

Carsten


From stefan at lucke.in-berlin.de  Wed Mar 16 22:16:55 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 16 Mar 2005 22:16:55 +0100
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <200503162024.29120.softdevice@ckollmeier.de>
References: <200503161120.26876.softdevice@ckollmeier.de> <200503161910.27616.stefan@lucke.in-berlin.de> <200503162024.29120.softdevice@ckollmeier.de>
Message-ID: <200503162216.56003.stefan@lucke.in-berlin.de>

On Mittwoch, 16. M?rz 2005 20:24, Carsten Kollmeier wrote:
> Am Mittwoch, 16. M?rz 2005 19:10 schrieb Stefan Lucke:
> > > My configuration:
> > > VDR 1.3.22 on PIII 1GHz, matrox G450 card, Soundblaster Live!
> > > card.
> >
> > cpu power should be ok.
> 
> top says ~50% cpu-load.
> 
> > Acceleration is used as it is available.
> > Which version of DFB do you use ?
> 
> DirectFB 0.9.22 is running.
> 
> > Which output mode do you use (vga vs tv-out) ?
> 
> I'm using vga. TV-out would be interesting, but my TV is broken...
> 
> > Which pixel format do you use YV12 vs YUV2 ?
> 
> Uhmm, I will look: Ok, softdevice tells me, it uses I420, I'm not 
> shure wether DirectFB uses this too (What is the default, for I have 
> nothing configured in directfbrc?).

Nothing ? Hm, Whats your screen resolution & ..
Can you post that messages written to console ?

My /etc/directfb used for vga framebuffer out looks like:

stefan at jarada:~> more /etc/directfbrc.fb0
#mode  = 1024x768
mode  = 1280x1024
#mode=720x576
depth = 32
#matrox-crtc2
#matrox-tv-standard=pal
#primary-layer=2
pixelformat=ARGB
#matrox-cable-type=composite
#pixelformat=RGB32

> 
> Could this be the problem with the slow output, for DirectFB has to 
> convert from I420? Then I will be testing dfb-output right away, for 
> I don't like the vidix-output I am using not very much.

YV12/I420 are the ones used with BES and the default.

-- 
Stefan Lucke



From torgeir at pobox.com  Thu Mar 17 01:09:15 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 00:09:15 +0000
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <42387709.4010708@users.sourceforge.net>
References: <200503161128.26455.softdevice@ckollmeier.de>
	 <42386977.6020009@gmx.net>  <42387709.4010708@users.sourceforge.net>
Message-ID: <1111018155.9075.24.camel@africa.netenviron.com>

On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> 
> 
> P.S. this surely belongs to a new thread, but what about DirectFB
> output 
> on interlaced devices (TV-out of a Matrox G400 for example), has
> there 
> been any improvement in the field parity issues? The output is still 
> jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> completely turn of deinterlacing (as it is not needed at all on a an 
> "interlaced-by-nature" device like a standard PAL TV with no fancy 
> feateres) and just take care of the right field order?

In my testing I've found that commenting out all Flip() calls doesn't
have any impact at all on operation, so I don't think there's double
buffering involved when using I420, which would explain why I'm seeing
tearing, and you are seeing field parity issues.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Thu Mar 17 01:21:43 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 00:21:43 +0000
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <1111018155.9075.24.camel@africa.netenviron.com>
References: <200503161128.26455.softdevice@ckollmeier.de>
	 <42386977.6020009@gmx.net>  <42387709.4010708@users.sourceforge.net>
	 <1111018155.9075.24.camel@africa.netenviron.com>
Message-ID: <1111018903.9075.27.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 00:09 +0000, Torgeir Veimo wrote:
> On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> > 
> > 
> > P.S. this surely belongs to a new thread, but what about DirectFB
> > output 
> > on interlaced devices (TV-out of a Matrox G400 for example), has
> > there 
> > been any improvement in the field parity issues? The output is still 
> > jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> > completely turn of deinterlacing (as it is not needed at all on a an 
> > "interlaced-by-nature" device like a standard PAL TV with no fancy 
> > feateres) and just take care of the right field order?
> 
> In my testing I've found that commenting out all Flip() calls doesn't
> have any impact at all on operation, so I don't think there's double
> buffering involved when using I420, which would explain why I'm seeing
> tearing, and you are seeing field parity issues.

Correction, the osd layer seems to be double buffered in my radeonfb
setup.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Thu Mar 17 17:50:06 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 17 Mar 2005 17:50:06 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <200503162009.55087.softdevice@ckollmeier.de>
References: <200503161128.26455.softdevice@ckollmeier.de> <42386977.6020009@gmx.net> <200503162009.55087.softdevice@ckollmeier.de>
Message-ID: <4239B53E.7060203@gmx.net>

Carsten Kollmeier wrote:

> 
> If I got it right, the bitstreamout isn't the best way to get DD into 
> my receiver, as it aims on FF-cards? The best way to handle this 
> would be to give the ac3-stream directly to the sound card? This 
> would be a nice feature (I think of an option like "-ac hwac3" on 
> mplayer or a configuration option like the xine plugin has).
>
I would prefer if the bitstreamout plugin would work with the 
softdevice. The bitstreamout plugin seems to be well maintained, and 
Werner Fink seems to know what he is doing. I don't know how to send the 
ac3 directly to the soundcard... I guess it is not too difficult, but 
what about mp2? As far as I know the bitstreamout plugin repacks the 
stream and also sends it to SPDIF. Implementing that in the softdevice 
would require a lot more work...

> 
>>>Is it planned to get DD working?
>>
>>Sure, but I don't own any DD equipment, so I can't test SPDIF out.
> 
> 
> I own some and would be willing to test :-)
Ok, so lets try to get the bitstreamout plugin to work and if we fail, 
we can still implement a ac3 passthrough in the softdevice.
I will commit my changes to mpeg2decoder this evening - I wanted to do 
more checks with older vdr versions, but I guess we can postpone them - 
  I'm curiuous if my changes fix the crashs.
I will send a message around when I've commited the changes containing a 
description of what I've done.

Bye,
Martin


From lucianm at users.sourceforge.net  Thu Mar 17 18:18:09 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Thu, 17 Mar 2005 18:18:09 +0100
Subject: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <4239B53E.7060203@gmx.net>
References: <200503161128.26455.softdevice@ckollmeier.de> <42386977.6020009@gmx.net> <200503162009.55087.softdevice@ckollmeier.de> <4239B53E.7060203@gmx.net>
Message-ID: <4239BBD1.20806@users.sourceforge.net>

Martin Wache wrote:
> Carsten Kollmeier wrote:
> 
> 
>>If I got it right, the bitstreamout isn't the best way to get DD into 
>>my receiver, as it aims on FF-cards? The best way to handle this 
>>would be to give the ac3-stream directly to the sound card? This 
>>would be a nice feature (I think of an option like "-ac hwac3" on 
>>mplayer or a configuration option like the xine plugin has).
>>
> 
> I would prefer if the bitstreamout plugin would work with the 
> softdevice. The bitstreamout plugin seems to be well maintained, and 
> Werner Fink seems to know what he is doing. I don't know how to send the 
> ac3 directly to the soundcard... I guess it is not too difficult, but 
> what about mp2? As far as I know the bitstreamout plugin repacks the 
> stream and also sends it to SPDIF. Implementing that in the softdevice 
> would require a lot more work...

Isn't the bitstreamout meant only for FF cards with a J2 connector where 
  one can get a SPDIF signal from? I understood that the bitreamout 
plugin is some firmware for FF-cards which lets them manipulate the 
stream before it gets to this physical connector, or didn't I understand 
right? If I did, then it won't be of any use for me to use bitstreamout, 
as I only have a budget card, so everything must be done in software.
MP2 is decoded by the softdevice to PCM and sent to the soundcard, I 
think it's the soundcard's setup who sends it to the SPDIF, I'm glad 
that this works without having some SPDIF-related option in softdevice, 
at least I didn't find one. The only problem right now are mono MP2 
streams (yes, some DVB-S stations broadcast like this, too, if you want 
to test, I can give you parameters from them, but those I know and want 
to watch and record and replay ar not on Astra 19,2E), which after 
decoding should be upmixed stereo PCM (I'm imagining that this should be 
easy, the second channel should just be an identical copy of the first 
one), then the external decoder would also get that PCM.
I agree that DD passtrhough must be different, but not necessarily 
complicated. Xine and mplayer do it without problems, I'll try and find 
out how.

Regards,
Lucian


From M.Wache at gmx.net  Thu Mar 17 21:22:26 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 17 Mar 2005 21:22:26 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
Message-ID: <4239E702.7000805@gmx.net>

Hi,

I just commited the new mpeg2decoder, now the PES stream is not parsed 
anymore by the mpeg2decoder itself, but it is passed to libavformat.
This meas we now support any format which is supported by ffmpeg, so pcm 
, mp2 and ac3 in the PES stream is no longer any problem. If you want to 
have ac3 decoding you have to enable it in ffmpeg, by default it is 
disabled.
So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
Also the softdevice should no longer crash when ac3 audio is selected.

I did not check that its running with all vdr versions, there have been 
some changes recently in the interface, but it should work with vdr-1.3.22.

Bye,
Martin


From noreply at berlios.de  Thu Mar 17 21:21:51 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Thu, 17 Mar 2005 21:21:51 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3588] softdevice-0.1.0 compiliert mit gcc-3.4 nicht
Message-ID: <200503172021.j2HKLpBx024431@unicorn.berlios.de>

Bug #3588, was updated on 2005-Mar-17 21:21
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: softdevice-0.1.0 compiliert mit gcc-3.4 nicht

Details: softdevice 0.1.0 l?sst sich mit gcc-3.4 nicht compilieren
der fehler liegt in i18n.c
die genaue meldung lautet

i18n.c:265 error: too many initializers for 'const char* const[16]'

die zeile steht 12 mal da

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3588&group_id=2051


From noreply at berlios.de  Thu Mar 17 21:26:00 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Thu, 17 Mar 2005 21:26:00 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3589] vdr mit softdevice beendet sich sofort nach dem start
Message-ID: <200503172026.j2HKQ0xQ024577@unicorn.berlios.de>

Bug #3589, was updated on 2005-Mar-17 21:26
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: vidix-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: vdr mit softdevice beendet sich sofort nach dem start

Details: vdr mit softdevice plugin versionen 0.0.7 bis einschliesslich 0.0.8 
beenden sich sobald vidix output eincompiliert ist.
(0.1.0 kann ich nicht testen da das nicht compiliert)

Also die versionen beenden sich AUCH wenn man via -vo xv angibt als ausgabedevice

gcc 3.4.1
aktuelles vidix cvs
radeon_vidix
vdr-1.2.6


For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3589&group_id=2051


From torgeir at pobox.com  Thu Mar 17 21:36:19 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 20:36:19 +0000
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <4239E702.7000805@gmx.net>
References: <4239E702.7000805@gmx.net>
Message-ID: <1111091779.5513.1.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 21:22 +0100, Martin Wache wrote:
> Hi,
> 
> I just commited the new mpeg2decoder, now the PES stream is not parsed 
> anymore by the mpeg2decoder itself, but it is passed to libavformat.
> This meas we now support any format which is supported by ffmpeg, so pcm 
> , mp2 and ac3 in the PES stream is no longer any problem. If you want to 
> have ac3 decoding you have to enable it in ffmpeg, by default it is 
> disabled.
> So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
> Also the softdevice should no longer crash when ac3 audio is selected.

I can't get any output. Just did a fresh cvs checkout, and tried with
both ffmpeg-0.4.9pre1 and current cvs. The output stops on

[dfb] Using this layer for OSD: FBDev Primary Layer
[dfb] Using this layer for Video out: Radeon Overlay
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
CMD[5951]:Start IsSuspended 0
init put byte finished
CMD[5961]:Neuer Thread gestartet: Mpeg2Decoder pid 1468
playmode not implemented... 0

It happens with both DirectFB and Xv output.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Thu Mar 17 21:37:30 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 20:37:30 +0000
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <4239E702.7000805@gmx.net>
References: <4239E702.7000805@gmx.net>
Message-ID: <1111091850.5513.3.camel@africa.netenviron.com>

syslog output;

Mar 17 20:33:52 vigor10 vdr[2115]: switching to channel 2
Mar 17 20:33:53 vigor10 vdr[2128]: transfer thread started (pid=2128,
tid=98311)
Mar 17 20:33:53 vigor10 vdr[2129]: receiver on device 1 thread started
(pid=2129, tid=114696)
Mar 17 20:33:53 vigor10 vdr[2130]: TS buffer on device 1 thread started
(pid=2130, tid=131081)
Mar 17 20:33:54 vigor10 vdr[2124]: channel 8 (BBC THREE) event 20:30
'BBC THREE News' status 4
Mar 17 20:33:54 vigor10 vdr[2124]: channel 21 (CBBC Channel) event 19:00
'This is CBBC!' status 4
Mar 17 20:33:54 vigor10 vdr[2124]: channel 2 (BBC TWO) event 20:30 'The
Reclaimers' status 4
Mar 17 20:33:54 vigor10 vdr[2124]: channel 1 (BBC ONE) event 20:00 'The
Inspector Lynley Mysteries' status 4
Mar 17 20:33:54 vigor10 vdr[2124]: channel 20 (BBCi) event 18:00 'BBCi'
status 4
Mar 17 20:33:55 vigor10 vdr[2124]: channel 14 (BBC NEWS 24) event 20:00
'BBC News' status 4
Mar 17 20:33:57 vigor10 vdr[2115]: timer 3 (6 2029-2126 'American Idol')
set to event Fri 18.03.2005 20:30-21:25
'American Idol'
Mar 17 20:33:57 vigor10 vdr[2115]: timer 4 (6 2124-2151 'American Idol
Results') set to event Fri 18.03.2005 21:25-21:50 'American Idol
Results'
Mar 17 20:34:00 vigor10 vdr[2129]: buffer usage: 70% (tid=98311)
Mar 17 20:34:00 vigor10 vdr[2129]: buffer usage: 80% (tid=98311)
Mar 17 20:34:01 vigor10 vdr[2129]: buffer usage: 90% (tid=98311)
Mar 17 20:34:01 vigor10 vdr[2129]: buffer usage: 100% (tid=98311)
Mar 17 20:34:01 vigor10 vdr[2129]: ERROR: 1 ring buffer overflow (177
bytes dropped)
Mar 17 20:34:07 vigor10 vdr[2129]: ERROR: 14703 ring buffer overflows
(2764164 bytes dropped)
Mar 17 20:34:13 vigor10 vdr[2129]: ERROR: 16927 ring buffer overflows
(3182276 bytes dropped)
Mar 17 20:34:19 vigor10 vdr[2129]: ERROR: 17476 ring buffer overflows
(3285488 bytes dropped)
Mar 17 20:34:25 vigor10 vdr[2129]: ERROR: 17291 ring buffer overflows
(3250708 bytes dropped)
Mar 17 20:34:31 vigor10 vdr[2129]: ERROR: 20045 ring buffer overflows
(3768460 bytes dropped)
Mar 17 20:34:37 vigor10 vdr[2129]: ERROR: 19314 ring buffer overflows
(3631032 bytes dropped)
Mar 17 20:34:43 vigor10 vdr[2129]: ERROR: 19138 ring buffer overflows
(3597944 bytes dropped)
Mar 17 20:34:49 vigor10 vdr[2129]: ERROR: 15806 ring buffer overflows
(2971528 bytes dropped)
Mar 17 20:34:55 vigor10 vdr[2129]: ERROR: 19180 ring buffer overflows
(3605840 bytes dropped)
Mar 17 20:35:01 vigor10 vdr[2129]: ERROR: 17003 ring buffer overflows
(3196564 bytes dropped)

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Thu Mar 17 22:44:26 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 17 Mar 2005 22:44:26 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111091779.5513.1.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net> <1111091779.5513.1.camel@africa.netenviron.com>
Message-ID: <4239FA3A.50204@gmx.net>

Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 21:22 +0100, Martin Wache wrote:
> 
>>Hi,
>>
>>I just commited the new mpeg2decoder, now the PES stream is not parsed 
>>anymore by the mpeg2decoder itself, but it is passed to libavformat.
>>This meas we now support any format which is supported by ffmpeg, so pcm 
>>, mp2 and ac3 in the PES stream is no longer any problem. If you want to 
>>have ac3 decoding you have to enable it in ffmpeg, by default it is 
>>disabled.
>>So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
>>Also the softdevice should no longer crash when ac3 audio is selected.
> 
> 
> I can't get any output. Just did a fresh cvs checkout, and tried with
> both ffmpeg-0.4.9pre1 and current cvs. The output stops on
> 
> [dfb] Using this layer for OSD: FBDev Primary Layer
> [dfb] Using this layer for Video out: Radeon Overlay
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] (re)configured 0x08100609
> Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> cSoftDevice::MakePrimaryDevice
> CMD[5951]:Start IsSuspended 0
> init put byte finished
> CMD[5961]:Neuer Thread gestartet: Mpeg2Decoder pid 1468
> playmode not implemented... 0
> 
> It happens with both DirectFB and Xv output.
> 
hmm, for some reason the softdevice doesn't accept any data from the vdr...
What vdr version are you using? I will send you a patch with some 
extended debuging output...

Bye,
Martin


From torgeir at pobox.com  Thu Mar 17 22:55:42 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 21:55:42 +0000
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <4239FA3A.50204@gmx.net>
References: <4239E702.7000805@gmx.net>
	 <1111091779.5513.1.camel@africa.netenviron.com>  <4239FA3A.50204@gmx.net>
Message-ID: <1111096542.5513.7.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 22:44 +0100, Martin Wache wrote:

> hmm, for some reason the softdevice doesn't accept any data from the vdr...
> What vdr version are you using? I will send you a patch with some 
> extended debuging output...

1.3.21. I'll try 1.3.22 as well.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Thu Mar 17 23:00:39 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 17 Mar 2005 23:00:39 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111091779.5513.1.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net> <1111091779.5513.1.camel@africa.netenviron.com>
Message-ID: <4239FE07.2060908@gmx.net>

> 
> I can't get any output. Just did a fresh cvs checkout, and tried with
> both ffmpeg-0.4.9pre1 and current cvs. The output stops on
> 
> [dfb] Using this layer for OSD: FBDev Primary Layer
> [dfb] Using this layer for Video out: Radeon Overlay
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] (re)configured 0x08100609
> Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> cSoftDevice::MakePrimaryDevice
> CMD[5951]:Start IsSuspended 0
> init put byte finished
> CMD[5961]:Neuer Thread gestartet: Mpeg2Decoder pid 1468
> playmode not implemented... 0
> 
> It happens with both DirectFB and Xv output.
> 

Hi Torgeir,

please apply the attached patch, start vdr rederecting the output in a 
file. You will get a hell lot of output, could you please send me the 
output in a mail directly to my e-mail account? I guess the list will 
reject the file because of it's length... Ah, and maybe you can just 
send me the about the first 1000 lines, I guess the rest is not that 
important.

Thank you very much!
Martin


From stefan at lucke.in-berlin.de  Thu Mar 17 23:02:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 17 Mar 2005 23:02:39 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111091779.5513.1.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net> <1111091779.5513.1.camel@africa.netenviron.com>
Message-ID: <200503172302.39915.stefan@lucke.in-berlin.de>

On Donnerstag, 17. M?rz 2005 21:36, Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 21:22 +0100, Martin Wache wrote:
> > Hi,
> > 
> > I just commited the new mpeg2decoder, now the PES stream is not parsed 
> > anymore by the mpeg2decoder itself, but it is passed to libavformat.
> > This meas we now support any format which is supported by ffmpeg, so pcm 
> > , mp2 and ac3 in the PES stream is no longer any problem. If you want to 
> > have ac3 decoding you have to enable it in ffmpeg, by default it is 
> > disabled.
> > So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
> > Also the softdevice should no longer crash when ac3 audio is selected.
> 
> I can't get any output. Just did a fresh cvs checkout, and tried with
> both ffmpeg-0.4.9pre1 and current cvs. The output stops on

I tried vdr-1.3.22 with xv-out and ffmpeg:
[softdevice] ffmpeg version(0.4.8) build(4700)

Got no problems in my short test.


-- 
Stefan Lucke



From torgeir at pobox.com  Thu Mar 17 23:17:53 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 22:17:53 +0000
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <4239FE07.2060908@gmx.net>
References: <4239E702.7000805@gmx.net>
	 <1111091779.5513.1.camel@africa.netenviron.com>  <4239FE07.2060908@gmx.net>
Message-ID: <1111097873.5513.9.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 23:00 +0100, Martin Wache wrote:
> please apply the attached patch, start vdr rederecting the output in a 
> file. You will get a hell lot of output, could you please send me the 
> output in a mail directly to my e-mail account? I guess the list will 
> reject the file because of it's length... Ah, and maybe you can just 
> send me the about the first 1000 lines, I guess the rest is not that 
> important.

You forgot the patch. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From noreply at berlios.de  Thu Mar 17 23:18:15 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Thu, 17 Mar 2005 23:18:15 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3588] softdevice-0.1.0 compiliert mit gcc-3.4 nicht
Message-ID: <200503172218.j2HMIFgo028967@unicorn.berlios.de>

Bug #3588, was updated on 2005-Mar-17 21:21
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: softdevice-0.1.0 compiliert mit gcc-3.4 nicht

Details: softdevice 0.1.0 l?sst sich mit gcc-3.4 nicht compilieren
der fehler liegt in i18n.c
die genaue meldung lautet

i18n.c:265 error: too many initializers for 'const char* const[16]'

die zeile steht 12 mal da

Follow-Ups:

Date: 2005-Mar-17 23:18
By: lucke

Comment:
Can you please surround all entries 17 to 20 in file i18n.c like the following:
    "",             // 16 TODO
#if VDRVERSNUM >= 10316
    "",             // 17 TODO
    "",             // 18 TODO
    "",             // 19 TODO
    "",             // 20 TODO
#endif

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3588&group_id=2051


From noreply at berlios.de  Thu Mar 17 23:21:23 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Thu, 17 Mar 2005 23:21:23 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3589] vdr mit softdevice beendet sich sofort nach dem start
Message-ID: <200503172221.j2HMLNtH029098@unicorn.berlios.de>

Bug #3589, was updated on 2005-Mar-17 21:26
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: vidix-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: vdr mit softdevice beendet sich sofort nach dem start

Details: vdr mit softdevice plugin versionen 0.0.7 bis einschliesslich 0.0.8 
beenden sich sobald vidix output eincompiliert ist.
(0.1.0 kann ich nicht testen da das nicht compiliert)

Also die versionen beenden sich AUCH wenn man via -vo xv angibt als ausgabedevice

gcc 3.4.1
aktuelles vidix cvs
radeon_vidix
vdr-1.2.6


Follow-Ups:

Date: 2005-Mar-17 23:21
By: lucke

Comment:
So please give us some more details on what is written to syslog and to console.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3589&group_id=2051


From M.Wache at gmx.net  Thu Mar 17 23:29:42 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 17 Mar 2005 23:29:42 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111097873.5513.9.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net>	 <1111091779.5513.1.camel@africa.netenviron.com>  <4239FE07.2060908@gmx.net> <1111097873.5513.9.camel@africa.netenviron.com>
Message-ID: <423A04D6.5010208@gmx.net>

Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 23:00 +0100, Martin Wache wrote:
> 
>>please apply the attached patch, start vdr rederecting the output in a 
>>file. You will get a hell lot of output, could you please send me the 
>>output in a mail directly to my e-mail account? I guess the list will 
>>reject the file because of it's length... Ah, and maybe you can just 
>>send me the about the first 1000 lines, I guess the rest is not that 
>>important.
> 
> 
> You forgot the patch. 
> 
Oh, sorry.... here it is.
Bye,
Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: DEBUG.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050317/64a9f1b8/attachment.ksh>

From torgeir at pobox.com  Fri Mar 18 00:39:25 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 17 Mar 2005 23:39:25 +0000
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111091779.5513.1.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net>
	 <1111091779.5513.1.camel@africa.netenviron.com>
Message-ID: <1111102765.5513.22.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 20:36 +0000, Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 21:22 +0100, Martin Wache wrote:
> > Hi,
> > 
> > I just commited the new mpeg2decoder, now the PES stream is not parsed 
> > anymore by the mpeg2decoder itself, but it is passed to libavformat.
> > This meas we now support any format which is supported by ffmpeg, so pcm 
> > , mp2 and ac3 in the PES stream is no longer any problem. If you want to 
> > have ac3 decoding you have to enable it in ffmpeg, by default it is 
> > disabled.
> > So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
> > Also the softdevice should no longer crash when ac3 audio is selected.
> 
> I can't get any output. Just did a fresh cvs checkout, and tried with
> both ffmpeg-0.4.9pre1 and current cvs. The output stops on
> 
> [dfb] Using this layer for OSD: FBDev Primary Layer
> [dfb] Using this layer for Video out: Radeon Overlay
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] (re)configured 0x08100609
> Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> cSoftDevice::MakePrimaryDevice
> CMD[5951]:Start IsSuspended 0
> init put byte finished
> CMD[5961]:Neuer Thread gestartet: Mpeg2Decoder pid 1468
> playmode not implemented... 0
> 
> It happens with both DirectFB and Xv output.

I fixed this by commenting out the while loop in line 1041 and 1042;

while (freezeMode && ThreadActive)
    usleep(10000);

I tried removing all instanced that could set freezeMode to true, but
that didn't have any effect, so I'm thinking it might be a gcc issue?

-- 
Torgeir Veimo <torgeir at pobox.com>



From noreply at berlios.de  Fri Mar 18 00:40:51 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Fri, 18 Mar 2005 00:40:51 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3589] vdr mit softdevice beendet sich sofort nach dem start
Message-ID: <200503172340.j2HNepFE009273@unicorn.berlios.de>

Bug #3589, was updated on 2005-Mar-17 21:26
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: vidix-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: vdr mit softdevice beendet sich sofort nach dem start

Details: vdr mit softdevice plugin versionen 0.0.7 bis einschliesslich 0.0.8 
beenden sich sobald vidix output eincompiliert ist.
(0.1.0 kann ich nicht testen da das nicht compiliert)

Also die versionen beenden sich AUCH wenn man via -vo xv angibt als ausgabedevice

gcc 3.4.1
aktuelles vidix cvs
radeon_vidix
vdr-1.2.6


Follow-Ups:

Date: 2005-Mar-18 00:40
By: sapier

Comment:
?hh ja w?rd ich gerne liefern aber nachdem ich gerade eben die version 0.1.0 compilieren konnte (laufen tuts immer noch nich)
kann ich den bug f?r 0.0.7 -0.0.8 nicht mehr reproduzieren ... irgendwas mach ich jetzt anscheinend anders als vorher ich weiss nur nich wirklich was aber egal solanges geht solls mir recht sein

-------------------------------------------------------

Date: 2005-Mar-17 23:21
By: lucke

Comment:
So please give us some more details on what is written to syslog and to console.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3589&group_id=2051


From noreply at berlios.de  Fri Mar 18 00:43:04 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Fri, 18 Mar 2005 00:43:04 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3588] softdevice-0.1.0 compiliert mit gcc-3.4 nicht
Message-ID: <200503172343.j2HNh4GN012516@unicorn.berlios.de>

Bug #3588, was updated on 2005-Mar-17 21:21
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: softdevice-0.1.0 compiliert mit gcc-3.4 nicht

Details: softdevice 0.1.0 l?sst sich mit gcc-3.4 nicht compilieren
der fehler liegt in i18n.c
die genaue meldung lautet

i18n.c:265 error: too many initializers for 'const char* const[16]'

die zeile steht 12 mal da

Follow-Ups:

Date: 2005-Mar-18 00:43
By: sapier

Comment:
ok das wars jetzt compilierts
-------------------------------------------------------

Date: 2005-Mar-17 23:18
By: lucke

Comment:
Can you please surround all entries 17 to 20 in file i18n.c like the following:
    "",             // 16 TODO
#if VDRVERSNUM >= 10316
    "",             // 17 TODO
    "",             // 18 TODO
    "",             // 19 TODO
    "",             // 20 TODO
#endif

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3588&group_id=2051


From M.Wache at gmx.net  Fri Mar 18 09:31:30 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 09:31:30 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <1111102765.5513.22.camel@africa.netenviron.com>
References: <4239E702.7000805@gmx.net>	 <1111091779.5513.1.camel@africa.netenviron.com> <1111102765.5513.22.camel@africa.netenviron.com>
Message-ID: <423A91E2.5010807@gmx.net>

Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 20:36 +0000, Torgeir Veimo wrote:
> 
>>On Thu, 2005-03-17 at 21:22 +0100, Martin Wache wrote:
>>
>>>Hi,
>>>
>>>I just commited the new mpeg2decoder, now the PES stream is not parsed 
>>>anymore by the mpeg2decoder itself, but it is passed to libavformat.
>>>This meas we now support any format which is supported by ffmpeg, so pcm 
>>>, mp2 and ac3 in the PES stream is no longer any problem. If you want to 
>>>have ac3 decoding you have to enable it in ffmpeg, by default it is 
>>>disabled.
>>>So with the new cvs-head the dvd-plugin should work with ac3 and pcm. 
>>>Also the softdevice should no longer crash when ac3 audio is selected.
>>
>>I can't get any output. Just did a fresh cvs checkout, and tried with
>>both ffmpeg-0.4.9pre1 and current cvs. The output stops on
>>
>>[dfb] Using this layer for OSD: FBDev Primary Layer
>>[dfb] Using this layer for Video out: Radeon Overlay
>>[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
>>[dfb] (re)configured 0x08100609
>>Subplugin successfully opend
>>[softdevice] Video Out seems to be OK
>>[softdevice] Initializing Audio Out
>>[softdevice] Audio out seems to be OK
>>[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
>>cSoftDevice::MakePrimaryDevice
>>CMD[5951]:Start IsSuspended 0
>>init put byte finished
>>CMD[5961]:Neuer Thread gestartet: Mpeg2Decoder pid 1468
>>playmode not implemented... 0
>>
>>It happens with both DirectFB and Xv output.
> 
> 
> I fixed this by commenting out the while loop in line 1041 and 1042;
> 
> while (freezeMode && ThreadActive)
>     usleep(10000);
> 
> I tried removing all instanced that could set freezeMode to true, but
> that didn't have any effect, so I'm thinking it might be a gcc issue?
> 
Great! So you have track the problem down. From the logs you send it 
looks like Play() was never called, that means that propably freezeMode 
was not initialized correctly. Please try to add a "freezeMode=false;" 
statement somewhere before the "cThread::Start" call in 
cMpeg2Decoder::Start().

Bye,
Martin



From lucianm at users.sourceforge.net  Fri Mar 18 10:41:51 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Fri, 18 Mar 2005 10:41:51 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field parity seems to be solved :-)
 , some audio issues remain
Message-ID: <423AA25F.3030007@users.sourceforge.net>

Hi,


I checked out last night's CVS (after Martin committed the new 
mpeg2decoder), and I must say, this is getting very interesting for me now:
  - I no longer have field parity artifacts on my G400 TV-out 
(DirectFB), only every few seconds there seems to be a jump, but 
otherwise the image is as it should be, I'm very pleased.
  - the new libavformat parsing code gives me software AC3 decoding (of 
course, I still would like to find out how to let ffmpeg just 
passthrough AC3 to the SPDIF);
  - the new tracing printed on the console comes very handy for 
analysing some MP2-related issues, let me give you some examples:

1.)
CMD[6295]:Neuer Thread gestartet: Mpeg2Decoder pid 17562
CMD[7646]:Neuer StreamDecoder type 17562
CMD[7700]:Neuer Thread gestartet: pid:17562 type 1
alsa-audio: SetParams
Input #0, mpeg, from 'test':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Audio: mp2, 48000 Hz, mono, 96 kb/s

On this channel, I have no sound on the SPDIF, because the stream is 
mono and I think it should be upmixed to stereo. BTW, this is a romanian 
  channel on EutelsatW2.

2.)
CMD[7480]:Neuer Thread gestartet: pid:18720 type 1
alsa-audio: SetParams
Input #0, mpeg, from 'test':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Video: mpeg2video, 528x576, 25.00 fps, 15000 kb/s
    Stream #0.1: Audio: mp2, 48000 Hz, mono, 128 kb/s

Same as above, only this is CNN on Astra 19.2E, you could tune to this 
one yourself if you use SPDIF and could debug the problem. Note the 
different bitrate, in the following examples there is more about bitrate.

3.)
CMD[6143]:Neuer StreamDecoder type 18720
CMD[6154]:Neuer Thread gestartet: pid:18720 type 1
alsa-audio: SetParams
Input #0, mpeg, from 'test':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Video: mpeg2video, 704x576, 25.00 fps, 3840 kb/s
    Stream #0.1: Audio: mp2, 48000 Hz, stereo, 128 kb/s

On this one I have sound, like I always did, but with the new code there 
is an approx. 1 second offset betwwen audio and video (audio ahead of video)


4.)
CMD[1501]:Neuer Thread gestartet: pid:18720 type 1
alsa-audio: Xrun
Input #0, mpeg, from 'test':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Video: mpeg2video, 720x576, 25.00 fps, 15000 kb/s
    Stream #0.1: Audio: ac3, 48000 Hz, stereo, 448 kb/s

This one was Pro7 when broadcasting DD 2.0, I have sound now but 
software decoded and passed as stereo PCM to the SPDIF, with a very big 
sync offset as well;


5.)
CMD[7496]:Neuer Thread gestartet: pid:18720 type 1
alsa-audio: SetParams
Input #0, mpeg, from 'test':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Video: mpeg2video, 480x576, 25.00 fps, 7980 kb/s
    Stream #0.1: Audio: mp2, 48000 Hz, stereo, 192 kb/s

Now, this one is very, very interesting! This was the french channel TV5 
and it was in lipsync! Is it due to the bitrate of 192 kb/s?



As you see, I found some very distinct and reproducible scenarios, maybe 
you can conclude few things from them, as you know your code best. for 
instance, this A/V-sync stuff depending on the bitrate.

Did samething actually changed in the DirectFB code what caused the 
benefic effect that I no longer see field parity artifacts not even on 
horizontally scrollin text banners (except a jump every 1-3 seconds, 
maybe a re-sync attempt, I don't know)? Or is it due to the fact that 
the audio stream parsing or even decoding is done differently? Or did 
you changed something in the threading scheme of the plugin?
Maybe all these are worth analyzing, I don't know, I'm just suggesting 
you should give it a thought.


Otherwise, great work, keep it up guys!
Lucian Muresan


From softdevice at ckollmeier.de  Fri Mar 18 14:57:59 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Fri, 18 Mar 2005 14:57:59 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <4239E702.7000805@gmx.net>
References: <4239E702.7000805@gmx.net>
Message-ID: <200503181458.00052.softdevice@ckollmeier.de>

Am Donnerstag, 17. M?rz 2005 21:22 schrieb Martin Wache:

> I just commited the new mpeg2decoder, now the PES stream is not
> parsed anymore by the mpeg2decoder itself, but it is passed to
> libavformat. ...

Hi!

I checked out the changes in the cvs, but I can't get vdr to work 
with softdevice. Here is, what it tells me: (The last part of it, 
tell me if you need more)

BTW, I'm using vdr 1.3.22, DirectFB 0.9.22, ffmpeg 0.4.9_pre1, kernel 
2.6.11 (gentoo-r3)

Carsten

--snip--

(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 12926)...
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 12950)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** 
[reactor.c:802]
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) Direct/Thread: Running 'LiRC Input' (INPUT, 12951)...
(*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media 
GmbH)
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 12968)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G400 0.7 (convergence integrated media 
GmbH)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 8388608 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine 
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize 
SrcColorkey Deinterlace
[dfb] Supported video Modes are: 640x480 at 16 720x576 at 16 768x576 at 16 
800x600 at 16 1024x768 at 16 1280x1024 at 16 1280x1024 at 16 1600x1200 at 16 
640x400 at 16 400x300 at 16 320x240 at 16 320x200 at 16
[dfb] Enumeratig display Layers
Layer 0 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
  Caps: brightness contrast deinterlacing dst_colorkey 
screen_location surface
[dfb] width = 768, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (FBDev Primary Layer - [768x576])
osdSurface::
 - videoonly
 - flipping
 (!!!)  *** WARNING [letting unprivileged 
IDirectFBDisplayLayer::GetSurface() call pass until cooperative 
level handling is finished] *** [idirectfbdisplaylayer.c:170 in 
IDirectFBDisplayLayer_GetSurface()]
videoSurface::
 - videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: FBDev Primary Layer
[dfb] Using this layer for Video out: Matrox Backend Scaler
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
CMD[5224]:Start IsSuspended 0
init put byte finished
CMD[6223]:Neuer Thread gestartet: Mpeg2Decoder pid 12977
CMD[6223]:Neuer StreamDecoder type 12977
Set up to use linux RTC
CMD[6243]:Neuer Thread gestartet: pid:12978 type 0
[softdevice] allocating picture buffer for resolution 720x576
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
CMD[6540]:Neuer StreamDecoder type 12977
CMD[6544]:Neuer Thread gestartet: pid:12979 type 1
(!) [12978:    0.000] --> Caught signal 8 (at 0xb7d6a90d, integer 
divide by zero) <--
(!) [12897:    0.114] --> Caught signal 11 (at 0x40, invalid address) 
<--
alsa-audio: SetParams
Killed

---snip---


From M.Wache at gmx.net  Fri Mar 18 15:52:44 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 15:52:44 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <200503181458.00052.softdevice@ckollmeier.de>
References: <4239E702.7000805@gmx.net> <200503181458.00052.softdevice@ckollmeier.de>
Message-ID: <423AEB3C.4000009@gmx.net>

Carsten Kollmeier wrote:

> I checked out the changes in the cvs, but I can't get vdr to work 
> with softdevice. Here is, what it tells me: (The last part of it, 
> tell me if you need more)
More information would be nice, I have some things which I would like 
you to do:

Just to be sure, did you do a make clean in the softdevice directory?

I guess you don't have a core dump, but maybe you can produce one and 
post a backtrace and print out of the line where the softdevice crashed?

Try to replace the line ( in mpeg2decoder.c function 
cAudioStreamDecoder::GetPTS)
if (audioBuffer && context...
with
if (audioBuffer && audioContext.channels)

If all of the above doesn't help / gives no result, then uncomment the line
//#define MPGDEB(out) {printf....
in mpeg2decoder.c, recompile and start the vdr rederecting the output in 
a file. Please send the gzipped output directly to my e-mail acount...

Bye,
Martin


From M.Wache at gmx.net  Fri Mar 18 16:15:19 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 16:15:19 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <423AA25F.3030007@users.sourceforge.net>
References: <423AA25F.3030007@users.sourceforge.net>
Message-ID: <423AF087.2080009@gmx.net>

Lucian Muresan wrote:
> Hi,
> 
> 
> I checked out last night's CVS (after Martin committed the new 
> mpeg2decoder), and I must say, this is getting very interesting for me now:
>  - I no longer have field parity artifacts on my G400 TV-out (DirectFB), 
> only every few seconds there seems to be a jump, but otherwise the image 
> is as it should be, I'm very pleased.
Nice to hear that it's working without any major problems for someone :-)


> As you see, I found some very distinct and reproducible scenarios, maybe 
> you can conclude few things from them, as you know your code best. for 
> instance, this A/V-sync stuff depending on the bitrate.
Can you send me how you start the vdr and with exactly what parameters, 
plugins etc.(send the command line or the appropriate parts of runvdr)? 
That would make it easy to conclude things.
If you are right and your soundcard repacks the pcm and sends it to 
SPDIF out, we will have trouble syncing... There seems to be a buffer 
either in the soundcard or in your ac3 decoder of unknown size which has 
to be taken into account and may be different for different machines. 
Hmm, I have to think about that... But I think we should wait for some 
more reports before concluding anything.

> 
> Did samething actually changed in the DirectFB code what caused the 
> benefic effect that I no longer see field parity artifacts not even on 
> horizontally scrollin text banners (except a jump every 1-3 seconds, 
> maybe a re-sync attempt, I don't know)? Or is it due to the fact that 
> the audio stream parsing or even decoding is done differently? Or did 
> you changed something in the threading scheme of the plugin?
I did not intend to change something, and I don't know what may have 
made the difference. Are you useing -ao dummy?

Concering this field parity issue, I aggree now with Stefan who already 
suggested a long time ago to add an option to sync the audio to the 
video ( not the other way around like we are doing it now). This kind of 
option make certainly sense for TV-out, and should finally solve these 
issues. The only problem is that we need a good resampler and the ffmpeg 
resampler can't cope with resampling rate changes. So this is on my todo 
list.
I will also consider an option to resample mono to stereo and 5.1 audio 
to stereo. This should not be to difficult.

Thank you for your report!

Martin


From torgeir at pobox.com  Fri Mar 18 16:32:34 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 18 Mar 2005 15:32:34 +0000
Subject: [Softdevice-devel] CVS from last night feedback  - field
	parity seems to be solved :-) , some audio issues remain
In-Reply-To: <423AF087.2080009@gmx.net>
References: <423AA25F.3030007@users.sourceforge.net>
	 <423AF087.2080009@gmx.net>
Message-ID: <1111159954.5517.11.camel@africa.netenviron.com>

On Fri, 2005-03-18 at 16:15 +0100, Martin Wache wrote:

> Concering this field parity issue, I aggree now with Stefan who already 
> suggested a long time ago to add an option to sync the audio to the 
> video ( not the other way around like we are doing it now). This kind of 
> option make certainly sense for TV-out, and should finally solve these 
> issues. 

It would also solve the issue of judder when using alsa dmix software
mixer which doesn't provide any sensible delay, but always returns 0.

http://developer.berlios.de/bugs/?
func=detailbug&bug_id=2971&group_id=2051

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Fri Mar 18 17:01:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 17:01:16 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field	parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <1111159954.5517.11.camel@africa.netenviron.com>
References: <423AA25F.3030007@users.sourceforge.net>	 <423AF087.2080009@gmx.net> <1111159954.5517.11.camel@africa.netenviron.com>
Message-ID: <423AFB4C.70009@gmx.net>

Torgeir Veimo wrote:
> On Fri, 2005-03-18 at 16:15 +0100, Martin Wache wrote:
> 
> 
>>Concering this field parity issue, I aggree now with Stefan who already 
>>suggested a long time ago to add an option to sync the audio to the 
>>video ( not the other way around like we are doing it now). This kind of 
>>option make certainly sense for TV-out, and should finally solve these 
>>issues. 
> 
> 
> It would also solve the issue of judder when using alsa dmix software
> mixer which doesn't provide any sensible delay, but always returns 0.
> 
> http://developer.berlios.de/bugs/?
> func=detailbug&bug_id=2971&group_id=2051
> 
I was not aware that this bug is still open. It's not our bug, it is the 
dmix software which is broken. Why are we not closing it?
Maybe you can call it a missing feature, but in my opinion it is not a 
bug in the softdevice.

Martin


From torgeir at pobox.com  Fri Mar 18 17:09:11 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 18 Mar 2005 16:09:11 +0000
Subject: [Softdevice-devel] CVS from last night feedback  -
	field	parity seems to be solved :-) , some audio issues remain
In-Reply-To: <423AFB4C.70009@gmx.net>
References: <423AA25F.3030007@users.sourceforge.net>
	 <423AF087.2080009@gmx.net> <1111159954.5517.11.camel@africa.netenviron.com>
	  <423AFB4C.70009@gmx.net>
Message-ID: <1111162151.5517.14.camel@africa.netenviron.com>

On Fri, 2005-03-18 at 17:01 +0100, Martin Wache wrote:
> Torgeir Veimo wrote:
> > On Fri, 2005-03-18 at 16:15 +0100, Martin Wache wrote:
> > 
> > 
> >>Concering this field parity issue, I aggree now with Stefan who already 
> >>suggested a long time ago to add an option to sync the audio to the 
> >>video ( not the other way around like we are doing it now). This kind of 
> >>option make certainly sense for TV-out, and should finally solve these 
> >>issues. 
> > 
> > 
> > It would also solve the issue of judder when using alsa dmix software
> > mixer which doesn't provide any sensible delay, but always returns 0.
> > 
> > http://developer.berlios.de/bugs/?
> > func=detailbug&bug_id=2971&group_id=2051
> > 
> I was not aware that this bug is still open. It's not our bug, it is the 
> dmix software which is broken. Why are we not closing it?
> Maybe you can call it a missing feature, but in my opinion it is not a 
> bug in the softdevice.

I don't think it's a bug in dmix either, there might be reasons why it
cannot provide the amount of buffered data. In any case, users perceive
it as a bug / missing feature, as both xine and mplayer can handle this
case without problems.

-- 
Torgeir Veimo <torgeir at pobox.com>



From ollo.diab at gmx.de  Fri Mar 18 17:54:16 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Fri, 18 Mar 2005 17:54:16 +0100 (MET)
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
References: <200503181458.00052.softdevice@ckollmeier.de>
Message-ID: <16075.1111164856@www6.gmx.net>

> Am Donnerstag, 17. M?rz 2005 21:22 schrieb Martin Wache:
> 
> > I just commited the new mpeg2decoder, now the PES stream is not
> > parsed anymore by the mpeg2decoder itself, but it is passed to
> > libavformat. ...
> 

Ok, I get some warnings during make plugins and later it does not show any
live TV while OSD works.

Please find below the build messages and then the console log:

make[1]: Entering directory `/root/mmbox/VDR/PLUGINS/src/softdevice-cvs'
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ softdevice.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ utils.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ i18n.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ video.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ mpeg2decoder.c
mpeg2decoder.c: In constructor
`cStreamDecoder::cStreamDecoder(AVCodecContext*)':
mpeg2decoder.c:123: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:123: Warnung: zu viele Argumente f?r Format
mpeg2decoder.c: In member function `virtual void cStreamDecoder::Action()':
mpeg2decoder.c:143: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:183: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `int cMpeg2Decoder::seek(offset_t, int)':
mpeg2decoder.c:1003: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `virtual void cMpeg2Decoder::Action()':
mpeg2decoder.c:1028: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:1075: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Start(bool)':
mpeg2decoder.c:1128: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Suspend()':
mpeg2decoder.c:1147: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Resume()':
mpeg2decoder.c:1156: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Play()':
mpeg2decoder.c:1180: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Freeze()':
mpeg2decoder.c:1193: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Stop(bool)':
mpeg2decoder.c:1211: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:1236: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `int cMpeg2Decoder::StillPicture(uchar*,
int)':
mpeg2decoder.c:1247: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:1259: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::Clear()':
mpeg2decoder.c:1269: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c:1272: Warnung: int format, different type arg (arg 2)
mpeg2decoder.c: In member function `void cMpeg2Decoder::TrickSpeed(int)':
mpeg2decoder.c:1280: Warnung: int format, different type arg (arg 2)
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ audio.c
audio.c: In member function `virtual int
cDummyAudioOut::SetParams(SampleContext&)':
audio.c:347: Warnung: unused variable 'err'
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ video-dummy.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ setup-softdevice.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -shared softdevice.o
utils.o i18n.o video.o mpeg2decoder.o audio.o video-dummy.o
setup-softdevice.o -lavcodec-cvs -lavformat-cvs -lasound -lz -o
libvdr-softdevice.so
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ video-fb.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -shared utils.o
video.o video-fb.o  -o libvdr-softdevice-fb.so
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ video-xv.c
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -c -DUSE_MMX
-DUSE_MMX2 -DUSE_3DNOW -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DFB_SUPPORT
-DFBDEV=\"/dev/fb0\" -DXV_SUPPORT -DSUSPEND_BY_KEY -I../../../include
-I../../../../DVB/include -I/usr/include/ffmpeg/ xscreensaver.c
xscreensaver.c:30: Warnung: 'dpms_on' defined but not used
g++ -g -O3 -mtune=athlon-xp -Wall -Woverloaded-virtual -shared video.o
video-xv.o xscreensaver.o -L/usr/X11R6/lib -lXi -lXext -lX11 -lm -lXv -o
libvdr-softdevice-xv.so
make[1]: Leaving directory `/root/mmbox/VDR/PLUGINS/src/softdevice-cvs'


tomshost:~/mmbox/VDR# ./runvdr
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 1 lavc
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(cvs) build(4744)
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 2040 x 2046
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
CMD[7861]:Start IsSuspended 0
init put byte finished
CMD[7861]:Neuer Thread gestartet: Mpeg2Decoder pid 8861
[MainMenuAction]
[setup-softdevice] storing data
[MainMenuAction]
[setup-softdevice] storing data
playmode not implemented... 0

The very last message makes me thinking ...

Thomas

-- 
DSL Komplett von GMX +++ Superg?nstig und stressfrei einsteigen!
AKTION "Kein Einrichtungspreis" nutzen: http://www.gmx.net/de/go/dsl


From M.Wache at gmx.net  Fri Mar 18 18:06:22 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 18:06:22 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <16075.1111164856@www6.gmx.net>
References: <200503181458.00052.softdevice@ckollmeier.de> <16075.1111164856@www6.gmx.net>
Message-ID: <423B0A8E.5090308@gmx.net>

Thomas Herrmann wrote:

> init put byte finished
> CMD[7861]:Neuer Thread gestartet: Mpeg2Decoder pid 8861
> [MainMenuAction]
> [setup-softdevice] storing data
> [MainMenuAction]
> [setup-softdevice] storing data
> playmode not implemented... 0
> 
> The very last message makes me thinking ...
> 
> Thomas
> 

Don't worry about the playmode, that message is okay.
To me this looks like the same like Torgeir reported. Please try to 
uncomment the while loop Torgeir mentioned:

"I fixed this by commenting out the while loop in line 1041 and 1042;

while (freezeMode && ThreadActive)
     usleep(10000);
"

or try to set freezeMode to false like I've suggested it:

Please try to add a "freezeMode=false;" statement somewhere before the 
"cThread::Start" call in cMpeg2Decoder::Start().


Martin


From stefan at lucke.in-berlin.de  Fri Mar 18 18:57:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 18 Mar 2005 18:57:39 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <423AEB3C.4000009@gmx.net>
References: <4239E702.7000805@gmx.net> <200503181458.00052.softdevice@ckollmeier.de> <423AEB3C.4000009@gmx.net>
Message-ID: <200503181857.39918.stefan@lucke.in-berlin.de>

On Freitag, 18. M?rz 2005 15:52, Martin Wache wrote:
> Carsten Kollmeier wrote:
> 
> > I checked out the changes in the cvs, but I can't get vdr to work 
> > with softdevice. Here is, what it tells me: (The last part of it, 
> > tell me if you need more)
> More information would be nice, I have some things which I would like 
> you to do:
> 
> Just to be sure, did you do a make clean in the softdevice directory?
> 
> I guess you don't have a core dump, but maybe you can produce one and 
> post a backtrace and print out of the line where the softdevice crashed?

Update cvs with your change a few minutes ago.
I with dfb-out I get the same error. Running from gdb I got the following:

[New Thread 180236 (LWP 3510)]
[New Thread 196621 (LWP 3511)]
CMD[5226]:Start IsSuspended 0
init put byte finished
[New Thread 213006 (LWP 3512)]
CMD[5231]:Neuer Thread gestartet: Mpeg2Decoder pid 3512
CMD[5764]:Neuer StreamDecoder type 3512
[New Thread 229391 (LWP 3513)]
CMD[5769]:Neuer Thread gestartet: pid:3513 type 0
Could not open /dev/rtc
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] (re)configured 0x08100609
player set audio track
NON player set audio track device
CMD[6524]:Neuer StreamDecoder type 3512
[New Thread 245776 (LWP 3514)]
CMD[6550]:Neuer Thread gestartet: pid:3514 type 1

Program received signal SIGFPE, Arithmetic exception.
[Switching to Thread 229391 (LWP 3513)]
0x40340e60 in cAlsaAudioOut::GetDelay() (this=0x8369190) at audio.c:111
111         return snd_pcm_status_get_delay(status) *1000 / currContext.samplerate;
Current language:  auto; currently c++
(gdb)

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Fri Mar 18 19:07:22 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Fri, 18 Mar 2005 19:07:22 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <423AF087.2080009@gmx.net>
References: <423AA25F.3030007@users.sourceforge.net> <423AF087.2080009@gmx.net>
Message-ID: <423B18DA.5010600@users.sourceforge.net>

Martin Wache wrote:
...
>> As you see, I found some very distinct and reproducible scenarios, maybe 
>> you can conclude few things from them, as you know your code best. for 
>> instance, this A/V-sync stuff depending on the bitrate.
> Can you send me how you start the vdr and with exactly what parameters, 
> plugins etc.(send the command line or the appropriate parts of runvdr)? 
> That would make it easy to conclude things.

I started vdr from a ssh console like:

  vdr -c /etc/vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo 
dfb:mgatv'

> If you are right and your soundcard repacks the pcm and sends it to 
> SPDIF out, we will have trouble syncing... There seems to be a buffer 
> either in the soundcard or in your ac3 decoder of unknown size which has 
> to be taken into account and may be different for different machines. 
> Hmm, I have to think about that... But I think we should wait for some 
> more reports before concluding anything.
> 
>> 
>> Did samething actually changed in the DirectFB code what caused the 
>> benefic effect that I no longer see field parity artifacts not even on 
>> horizontally scrollin text banners (except a jump every 1-3 seconds, 
>> maybe a re-sync attempt, I don't know)? Or is it due to the fact that 
>> the audio stream parsing or even decoding is done differently? Or did 
>> you changed something in the threading scheme of the plugin?
> I did not intend to change something, and I don't know what may have 
> made the difference. Are you useing -ao dummy?


Now that you asked me about -ao dummy, I tried it, and it seemed to 
behave the same. I thought this one disables sound for use with 
bitstreamout for FF-card owners who would want to decode with softdevice 
(might make sense for HDTV, right ;-) ?) I couldn't make detailed 
testing now, because we have to leave for now. Will check the ML when 
I'm back.

> Concering this field parity issue, I aggree now with Stefan who already 
> suggested a long time ago to add an option to sync the audio to the 
> video ( not the other way around like we are doing it now). This kind of 
> option make certainly sense for TV-out, and should finally solve these 
> issues. The only problem is that we need a good resampler and the ffmpeg 
> resampler can't cope with resampling rate changes. So this is on my todo 
> list.
> I will also consider an option to resample mono to stereo and 5.1 audio 
> to stereo. This should not be to difficult.

Hopefully these two things will be handled separately for MP2 and DD.

> Thank you for your report!

I thank you for this whole work ;-)



From M.Wache at gmx.net  Fri Mar 18 19:35:12 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 18 Mar 2005 19:35:12 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <200503181857.39918.stefan@lucke.in-berlin.de>
References: <4239E702.7000805@gmx.net> <200503181458.00052.softdevice@ckollmeier.de> <423AEB3C.4000009@gmx.net> <200503181857.39918.stefan@lucke.in-berlin.de>
Message-ID: <423B1F60.4080008@gmx.net>

Stefan Lucke wrote:
> On Freitag, 18. M?rz 2005 15:52, Martin Wache wrote:
> 
>>Carsten Kollmeier wrote:
>>
>>
>>>I checked out the changes in the cvs, but I can't get vdr to work 
>>>with softdevice. Here is, what it tells me: (The last part of it, 
>>>tell me if you need more)
>>
>>More information would be nice, I have some things which I would like 
>>you to do:
>>
>>Just to be sure, did you do a make clean in the softdevice directory?
>>
>>I guess you don't have a core dump, but maybe you can produce one and 
>>post a backtrace and print out of the line where the softdevice crashed?
> 
> 
> Update cvs with your change a few minutes ago.
> I with dfb-out I get the same error. Running from gdb I got the following:
> 
> [New Thread 180236 (LWP 3510)]
> [New Thread 196621 (LWP 3511)]
> CMD[5226]:Start IsSuspended 0
> init put byte finished
> [New Thread 213006 (LWP 3512)]
> CMD[5231]:Neuer Thread gestartet: Mpeg2Decoder pid 3512
> CMD[5764]:Neuer StreamDecoder type 3512
> [New Thread 229391 (LWP 3513)]
> CMD[5769]:Neuer Thread gestartet: pid:3513 type 0
> Could not open /dev/rtc
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] (re)configured 0x08100609
> player set audio track
> NON player set audio track device
> CMD[6524]:Neuer StreamDecoder type 3512
> [New Thread 245776 (LWP 3514)]
> CMD[6550]:Neuer Thread gestartet: pid:3514 type 1
> 
> Program received signal SIGFPE, Arithmetic exception.
> [Switching to Thread 229391 (LWP 3513)]
> 0x40340e60 in cAlsaAudioOut::GetDelay() (this=0x8369190) at audio.c:111
> 111         return snd_pcm_status_get_delay(status) *1000 / currContext.samplerate;
> Current language:  auto; currently c++
> (gdb)
> 

I just commited a fix: I initialize the samplerate with the default now. 
This should avoid a divide by zero. Can you please try again?

Thank you,

Martin


From stefan at lucke.in-berlin.de  Fri Mar 18 19:46:33 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 18 Mar 2005 19:46:33 +0100
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
In-Reply-To: <423B1F60.4080008@gmx.net>
References: <4239E702.7000805@gmx.net> <200503181857.39918.stefan@lucke.in-berlin.de> <423B1F60.4080008@gmx.net>
Message-ID: <200503181946.33625.stefan@lucke.in-berlin.de>

On Freitag, 18. M?rz 2005 19:35, Martin Wache wrote:
> Stefan Lucke wrote:

> > Program received signal SIGFPE, Arithmetic exception.
> > [Switching to Thread 229391 (LWP 3513)]
> > 0x40340e60 in cAlsaAudioOut::GetDelay() (this=0x8369190) at audio.c:111
> > 111         return snd_pcm_status_get_delay(status) *1000 / currContext.samplerate;
> > Current language:  auto; currently c++
> > (gdb)
> > 
> 
> I just commited a fix: I initialize the samplerate with the default now. 
> This should avoid a divide by zero. Can you please try again?

Works now, thanks.

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Sat Mar 19 11:38:59 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Sat, 19 Mar 2005 11:38:59 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <423AF087.2080009@gmx.net>
References: <423AA25F.3030007@users.sourceforge.net> <423AF087.2080009@gmx.net>
Message-ID: <423C0143.9060101@users.sourceforge.net>

Martin Wache wrote:
...
> If you are right and your soundcard repacks the pcm and sends it to 
> SPDIF out, we will have trouble syncing... There seems to be a buffer 
> either in the soundcard or in your ac3 decoder of unknown size which has 
> to be taken into account and may be different for different machines. 
> Hmm, I have to think about that... But I think we should wait for some 
> more reports before concluding anything.

I wanted to let you know, I checked for these off-sync problems when 
using vdr-xine viewed in df_xine, and there are no delays, everything is 
in sync on channels with various bitrates on MP2, even on Sat1/Pro7 with 
AC3. But xine has the "mono MP2" and the field parity issues softdevice 
had before the latest changes, too (of course, using the same Matrox 
G400 TV-out in DirectFB), and also switches channels slower than softdevice.

Lucian


From ollo.diab at gmx.de  Sat Mar 19 09:16:10 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Sat, 19 Mar 2005 09:16:10 +0100 (MET)
Subject: [Softdevice-devel] use libavformat in mpeg2decoder
References: <423B0A8E.5090308@gmx.net>
Message-ID: <16474.1111220170@www26.gmx.net>

> Thomas Herrmann wrote:
> 
> > init put byte finished
> > CMD[7861]:Neuer Thread gestartet: Mpeg2Decoder pid 8861
> > [MainMenuAction]
> > [setup-softdevice] storing data
> > [MainMenuAction]
> > [setup-softdevice] storing data
> > playmode not implemented... 0
> > 
> > The very last message makes me thinking ...
> > 
> > Thomas
> > 
> 
> Don't worry about the playmode, that message is okay.
> To me this looks like the same like Torgeir reported. Please try to 
> uncomment the while loop Torgeir mentioned:
> 
> "I fixed this by commenting out the while loop in line 1041 and 1042;
> 
> while (freezeMode && ThreadActive)
>      usleep(10000);
> "
> 
> or try to set freezeMode to false like I've suggested it:
> 
> Please try to add a "freezeMode=false;" statement somewhere before the 
> "cThread::Start" call in cMpeg2Decoder::Start().

Great! Both of it works!!

Thanks,   Thomas


> 
> 
> Martin
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
DSL Komplett von GMX +++ Superg?nstig und stressfrei einsteigen!
AKTION "Kein Einrichtungspreis" nutzen: http://www.gmx.net/de/go/dsl


From torgeir at pobox.com  Sat Mar 19 21:31:40 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 19 Mar 2005 20:31:40 +0000
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby
	Digital out via SPDIF
In-Reply-To: <1111018155.9075.24.camel@africa.netenviron.com>
References: <200503161128.26455.softdevice@ckollmeier.de>
	 <42386977.6020009@gmx.net>  <42387709.4010708@users.sourceforge.net>
	 <1111018155.9075.24.camel@africa.netenviron.com>
Message-ID: <1111264300.6661.6.camel@africa.netenviron.com>

On Thu, 2005-03-17 at 00:09 +0000, Torgeir Veimo wrote:
> On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> > 
> > 
> > P.S. this surely belongs to a new thread, but what about DirectFB
> > output 
> > on interlaced devices (TV-out of a Matrox G400 for example), has
> > there 
> > been any improvement in the field parity issues? The output is still 
> > jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> > completely turn of deinterlacing (as it is not needed at all on a an 
> > "interlaced-by-nature" device like a standard PAL TV with no fancy 
> > feateres) and just take care of the right field order?
> 
> In my testing I've found that commenting out all Flip() calls doesn't
> have any impact at all on operation, so I don't think there's double
> buffering involved when using I420, which would explain why I'm seeing
> tearing, and you are seeing field parity issues.

Applying tripple buffering improves the tearing situation tremendously
with my radeonfb. This patch doesn't force flip on vsync, so it might be
necessary to change to either one of 

videoSurface->Flip(NULL, DSFLIP_WAITFORSYNC); or
videoSurface->Flip(NULL, DSFLIP_ONSYNC);

around line 1100. 

This is just a rough initial patch so I'm interested in feedback. I've
only tested it with I420 pixelformat.

-- 
Torgeir Veimo <torgeir at pobox.com>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: triplebuffering.patch
Type: text/x-patch
Size: 2243 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050319/b6d029c8/attachment.bin>

From stefan at lucke.in-berlin.de  Sat Mar 19 22:40:49 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 19 Mar 2005 22:40:49 +0100
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby Digital out via SPDIF
Message-ID: <200503192240.49437.stefan@lucke.in-berlin.de>

Breaking thread (subject chage is not enough.

On Samstag, 19. M?rz 2005 21:31, Torgeir Veimo wrote:
> On Thu, 2005-03-17 at 00:09 +0000, Torgeir Veimo wrote:
> > On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> > > 
> > > 
> > > P.S. this surely belongs to a new thread, but what about DirectFB
> > > output 
> > > on interlaced devices (TV-out of a Matrox G400 for example), has
> > > there 
> > > been any improvement in the field parity issues? The output is still 
> > > jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> > > completely turn of deinterlacing (as it is not needed at all on a an 
> > > "interlaced-by-nature" device like a standard PAL TV with no fancy 
> > > feateres) and just take care of the right field order?
> > 
> > In my testing I've found that commenting out all Flip() calls doesn't
> > have any impact at all on operation, so I don't think there's double
> > buffering involved when using I420, which would explain why I'm seeing
> > tearing, and you are seeing field parity issues.

Sorry for delayed response. You are absolutely right.
Don't know why buffermode was not yet set for surface creation.
I've been at a similar location for setting buffermode, but my direction
today was onto via epia.

> 
> Applying tripple buffering improves the tearing situation tremendously
> with my radeonfb. This patch doesn't force flip on vsync, so it might be
> necessary to change to either one of 
> 
> videoSurface->Flip(NULL, DSFLIP_WAITFORSYNC); or
> videoSurface->Flip(NULL, DSFLIP_ONSYNC);
> 
> around line 1100. 
> 
> This is just a rough initial patch so I'm interested in feedback. I've
> only tested it with I420 pixelformat.

Thats no real feedback as I'm currently working on vdr1.2.1 .
I'll try that later, especially the impact of your change around
line 765 (comment was from me and indicates some problems with mga).

OSD drawing has be reworked as current mode is alot to cpu intensive
for epia.


-- 
Stefan Lucke



From marko.makela at hut.fi  Sun Mar 20 08:05:41 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 20 Mar 2005 09:05:41 +0200
Subject: [Softdevice-devel] Cannot get remote controls to work via softdevice
Message-ID: <20050320070541.GA431019@kosh.hut.fi>

Hi all,

I'm sorry if this is a FAQ, but I haven't found any document that would
answer my question.

I'm using VDR 1.3.22 with a recent softdevice plugin.  Initially, I tested
it with Xv output, but now I'm using DirectFB with a Matrox G450 card,
running Debian GNU/Linux unstable and 2.6.11.1 kernel with some video4linux
related patches.

I compiled linux_input support in DirectFB and disabled other input modules.
According to lsof, VDR keeps /dev/input/event* open.  However, the remote
control learning screen of softdevice-dfb does not react to anything:
keyboard, mouse, or the remote control of my cx88xx-based Hauppauge
Nova-T card.  In order to disable the annoying 10-second delay, I manually
entered a dummy line to remote.conf.

I can use the remote control via the vdr-remote plugin, at least if I
disable the linux_input module in /etc/directfbrc.

I had a similar problem with softdevice-xv: it wouldn't react to the keyboard,
no matter if the output window or the controlling terminal window has focus.
The 'F' key toggled between fullscreen and windowed output when the output
window had focus.

Ultimately, I'd like to use the remote control via the directfb library
instead of the vdr-remote plugin.  In my opinion, the fewer dependencies,
the better.

	Marko


From stefan at lucke.in-berlin.de  Sun Mar 20 10:27:47 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 20 Mar 2005 10:27:47 +0100
Subject: [Softdevice-devel] Cannot get remote controls to work via softdevice
In-Reply-To: <20050320070541.GA431019@kosh.hut.fi>
References: <20050320070541.GA431019@kosh.hut.fi>
Message-ID: <200503201027.48125.stefan@lucke.in-berlin.de>

On Sonntag, 20. M?rz 2005 08:05, Marko M?kel? wrote:
> Hi all,
> 
> I'm sorry if this is a FAQ, but I haven't found any document that would
> answer my question.
> 
> I'm using VDR 1.3.22 with a recent softdevice plugin.  Initially, I tested
> it with Xv output, but now I'm using DirectFB with a Matrox G450 card,
> running Debian GNU/Linux unstable and 2.6.11.1 kernel with some video4linux
> related patches.
> 
> I compiled linux_input support in DirectFB and disabled other input modules.
> According to lsof, VDR keeps /dev/input/event* open.  However, the remote
> control learning screen of softdevice-dfb does not react to anything:
> keyboard, mouse, or the remote control of my cx88xx-based Hauppauge
> Nova-T card.  In order to disable the annoying 10-second delay, I manually
> entered a dummy line to remote.conf.

Whats your /etc/directfbrc and which messages are printed to console ?

> 
> I can use the remote control via the vdr-remote plugin, at least if I
> disable the linux_input module in /etc/directfbrc.
> 
> I had a similar problem with softdevice-xv: it wouldn't react to the keyboard,
> no matter if the output window or the controlling terminal window has focus.
> The 'F' key toggled between fullscreen and windowed output when the output
> window had focus.

When we react upon 'f' for fullscreen toggle we should act on other keys
too. The logic is: catch internal used keys and pass all others to vdr
remote handling.

Please add the following line in file video-xv.c around line 440
after the call of XLookupString() to see which keys we get.
Remove all softdevice-xv.* entries from your remote.conf
and restart the key learning phase.
fprintf(stderr,"XV-Lookup: l = %d k = 0x%08x, %c\n", len, keysym, keysym);


-- 
Stefan Lucke



From noreply at berlios.de  Sun Mar 20 10:31:20 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Sun, 20 Mar 2005 10:31:20 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3588] softdevice-0.1.0 compiliert mit gcc-3.4 nicht
Message-ID: <200503200931.j2K9VKiK010591@unicorn.berlios.de>

Bug #3588, was updated on 2005-Mar-17 21:21
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Closed
Resolution: Fixed
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: softdevice-0.1.0 compiliert mit gcc-3.4 nicht

Details: softdevice 0.1.0 l?sst sich mit gcc-3.4 nicht compilieren
der fehler liegt in i18n.c
die genaue meldung lautet

i18n.c:265 error: too many initializers for 'const char* const[16]'

die zeile steht 12 mal da

Follow-Ups:

Date: 2005-Mar-20 10:31
By: lucke

Comment:
Compile fix for vdr-1.2.x is in cvs now.
-------------------------------------------------------

Date: 2005-Mar-18 00:43
By: sapier

Comment:
ok das wars jetzt compilierts
-------------------------------------------------------

Date: 2005-Mar-17 23:18
By: lucke

Comment:
Can you please surround all entries 17 to 20 in file i18n.c like the following:
    "",             // 16 TODO
#if VDRVERSNUM >= 10316
    "",             // 17 TODO
    "",             // 18 TODO
    "",             // 19 TODO
    "",             // 20 TODO
#endif

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3588&group_id=2051


From noreply at berlios.de  Sun Mar 20 10:33:53 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Sun, 20 Mar 2005 10:33:53 +0100 (CET)
Subject: [Softdevice-devel] [Bug #3589] vdr mit softdevice beendet sich sofort nach dem start
Message-ID: <200503200933.j2K9Xrcu010765@unicorn.berlios.de>

Bug #3589, was updated on 2005-Mar-17 21:26
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: vidix-out
Status: Closed
Resolution: Invalid
Bug Group: None
Priority: 5
Submitted by: sapier
Assigned to : none
Summary: vdr mit softdevice beendet sich sofort nach dem start

Details: vdr mit softdevice plugin versionen 0.0.7 bis einschliesslich 0.0.8 
beenden sich sobald vidix output eincompiliert ist.
(0.1.0 kann ich nicht testen da das nicht compiliert)

Also die versionen beenden sich AUCH wenn man via -vo xv angibt als ausgabedevice

gcc 3.4.1
aktuelles vidix cvs
radeon_vidix
vdr-1.2.6


Follow-Ups:

Date: 2005-Mar-20 10:33
By: lucke

Comment:
According to last message from bug reporter, it is not
reproducable anymore.
-------------------------------------------------------

Date: 2005-Mar-18 00:40
By: sapier

Comment:
?hh ja w?rd ich gerne liefern aber nachdem ich gerade eben die version 0.1.0 compilieren konnte (laufen tuts immer noch nich)
kann ich den bug f?r 0.0.7 -0.0.8 nicht mehr reproduzieren ... irgendwas mach ich jetzt anscheinend anders als vorher ich weiss nur nich wirklich was aber egal solanges geht solls mir recht sein

-------------------------------------------------------

Date: 2005-Mar-17 23:21
By: lucke

Comment:
So please give us some more details on what is written to syslog and to console.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=3589&group_id=2051


From M.Wache at gmx.net  Sun Mar 20 13:41:52 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 20 Mar 2005 13:41:52 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <423C0143.9060101@users.sourceforge.net>
References: <423AA25F.3030007@users.sourceforge.net> <423AF087.2080009@gmx.net> <423C0143.9060101@users.sourceforge.net>
Message-ID: <423D6F90.3090307@gmx.net>

Lucian Muresan wrote:
> Martin Wache wrote:
> ...
> 
>> If you are right and your soundcard repacks the pcm and sends it to 
>> SPDIF out, we will have trouble syncing... There seems to be a buffer 
>> either in the soundcard or in your ac3 decoder of unknown size which 
>> has to be taken into account and may be different for different 
>> machines. Hmm, I have to think about that... But I think we should 
>> wait for some more reports before concluding anything.
> 
> 
> I wanted to let you know, I checked for these off-sync problems when 
> using vdr-xine viewed in df_xine, and there are no delays, everything is 
> in sync on channels with various bitrates on MP2, even on Sat1/Pro7 with 
> AC3. But xine has the "mono MP2" and the field parity issues softdevice 
> had before the latest changes, too (of course, using the same Matrox 
> G400 TV-out in DirectFB), and also switches channels slower than 
> softdevice.
I just commited a few changes to the A-V sync. One change may be 
interesting for the SPDIF out off-sync problem: now video and audio wait 
for each other before starting. Before each of the stream was played as 
soon as data was available and syncing was done while playing. Now the 
syncronization between audio and video should be much better at the 
start, maybe this improves the situation for SPDIF out...

I have some more things which I like to now... Is it possible with your 
soundcard to have SPDIF out and analog out at one time? Is analog out 
and SPDIF out asynchron?
There is a menu entry A/V Delay in the softdevice menu, is it possible 
to syncronize SPDIF out and the video with this option? If you need a 
bigger range you can multiply setupStore.avOffset by ten in 
mpeg2decoder.c method cAudioStreamDecoder::GetPTS().
If you have a synchronized A/V stream for one station, what happens if 
you switch away and back again? Is the synchronisation still okay?
Can you please tell me offsets for some stations which correct the A/V 
syncronisations?

Bye,
Martin


From torgeir at pobox.com  Sun Mar 20 14:11:07 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 13:11:07 +0000
Subject: [Softdevice-devel] CVS from last night feedback  - field
	parity seems to be solved :-) , some audio issues remain
In-Reply-To: <423D6F90.3090307@gmx.net>
References: <423AA25F.3030007@users.sourceforge.net>
	 <423AF087.2080009@gmx.net> <423C0143.9060101@users.sourceforge.net>
	 <423D6F90.3090307@gmx.net>
Message-ID: <1111324267.6661.10.camel@africa.netenviron.com>

On Sun, 2005-03-20 at 13:41 +0100, Martin Wache wrote:
> I just commited a few changes to the A-V sync. One change may be
> interesting for the SPDIF out off-sync problem: now video and audio
> wait for each other before starting. Before each of the stream was
> played as soon as data was available and syncing was done while
> playing. Now the syncronization between audio and video should be much
> better at the start, maybe this improves the situation for SPDIF
> out...

I just tried it out, and channel change is a bit better now, but also a
bit slower.

> There is a menu entry A/V Delay in the softdevice menu, is it possible
> to syncronize SPDIF out and the video with this option

The avOffset doesn't seem to work anymore. I think we also need a way of
telling the mpeg2decoder of any implicit delays in any output method,
eg. when using triple buffering for directfb output, we need to
compensate for the additional two frames delay in the video.


-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sun Mar 20 14:47:53 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 13:47:53 +0000
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <200503162024.29120.softdevice@ckollmeier.de>
References: <200503161120.26876.softdevice@ckollmeier.de>
	 <200503161910.27616.stefan@lucke.in-berlin.de>
	 <200503162024.29120.softdevice@ckollmeier.de>
Message-ID: <1111326473.6661.13.camel@africa.netenviron.com>

On Wed, 2005-03-16 at 20:24 +0100, Carsten Kollmeier wrote:

> Uhmm, I will look: Ok, softdevice tells me, it uses I420, I'm not 
> shure wether DirectFB uses this too (What is the default, for I have 
> nothing configured in directfbrc?).
> 
> Could this be the problem with the slow output, for DirectFB has to 
> convert from I420? Then I will be testing dfb-output right away, for 
> I don't like the vidix-output I am using not very much.

What do you mean by slow output? Like if the picture is not completely
updated every second?


-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sun Mar 20 14:49:10 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 13:49:10 +0000
Subject: [Softdevice-devel] Cannot get remote controls to work via
	softdevice
In-Reply-To: <20050320070541.GA431019@kosh.hut.fi>
References: <20050320070541.GA431019@kosh.hut.fi>
Message-ID: <1111326550.6661.15.camel@africa.netenviron.com>

On Sun, 2005-03-20 at 09:05 +0200, Marko M?kel? wrote:
> 
> I compiled linux_input support in DirectFB and disabled other input
> modules.
> According to lsof, VDR keeps /dev/input/event* open. 

Did you also compile vdr with "make NO_KBD=1" ?

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sun Mar 20 15:14:14 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 14:14:14 +0000
Subject: [Softdevice-devel] softdevice & XvMC lib?
In-Reply-To: <42301A17.8040001@e-dition.fr>
References: <1110379814.5769.52.camel@atlantis.netenviron.com>
	 <17595.1110441004@www49.gmx.net>  <42301A17.8040001@e-dition.fr>
Message-ID: <1111328054.6661.30.camel@africa.netenviron.com>

On Thu, 2005-03-10 at 10:57 +0100, Nicolas Huillard wrote:
> Thomas Herrmann a ?crit :
> > Hi Torgeir,
> > 
> >>On Wed, 2005-03-09 at 15:30 +0100, Thomas Herrmann wrote:
> >>
> >>You'd have to search the ffmpeg devel mailing lists. Basically it's not
> >>enough to just build libavcodec with XvMC support, as the interaction
> >>with whatever output method is done through softdevice's video-* output
> >>code, which needs to get support for it as well.
> >>
> >>See also http://sourceforge.net/mailarchive/message.php?msg_id=9065904
> > 
> > ... I see. I've checked the ffmpeg cvs tree and can see the "HAVE_XVMC"
> > defines in the code. Just that the configure script does not support it.
> > Anyhow, I was able to build a XVMC enabled libavcodec by tweaking the
> > config.mak and Makefile.
> 
> Does this means that XvMC is now X/Xv-independent ?
> What I would ideally like to have is hardware MPEG2 decoding on DirectFB.

No, what is supported in libavcodec is _avoiding_ doing the idct and mc
steps, leaving this for the output method. 

It would be very nice to have idct and mc support in directfb, but the
current open source options are intel i8x0 and via, and only the latter
seems to be well supported in directfb. But lets hope David Airlie is
successful in getting it to work on radeons.

Also, the deinterlace options when using XvMC seems to be limited to
simple bob or weave, as it has to be done by the gfx hardware atm.

-- 
Torgeir Veimo <torgeir at pobox.com>



From softdevice at ckollmeier.de  Sun Mar 20 15:16:54 2005
From: softdevice at ckollmeier.de (Carsten Kollmeier)
Date: Sun, 20 Mar 2005 15:16:54 +0100
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <1111326473.6661.13.camel@africa.netenviron.com>
References: <200503161120.26876.softdevice@ckollmeier.de> <200503162024.29120.softdevice@ckollmeier.de> <1111326473.6661.13.camel@africa.netenviron.com>
Message-ID: <200503201516.54798.softdevice@ckollmeier.de>

Am Sonntag, 20. M?rz 2005 14:47 schrieb Torgeir Veimo:
> > Could this be the problem with the slow output, for DirectFB has
> > to convert from I420? Then I will be testing dfb-output right
> > away, for I don't like the vidix-output I am using not very
> > much.
>
> What do you mean by slow output? Like if the picture is not
> completely updated every second?

I mean the pictures run not very smooth. One issue is, that I suppose 
that the output gets not synced with the frequency of my monitor and 
therefore I get incomplete pictures especially on pans.

I also get framedrops or something what looks like that. On some 
channels (for example "WDR Dortmund" on Astra) the picture stops 
sometimes for approx <0,5 sec and picture and sound get more and 
more out of sync.

I'm setting up an testing system in the moment (for my wife doesn't 
like me to test on our TV-system), then I will be able to test it 
and share my observations in detail.

Carsten


From torgeir at pobox.com  Sun Mar 20 15:18:01 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 14:18:01 +0000
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha
	blending for XV
In-Reply-To: <200502102210.07149.stefan@lucke.in-berlin.de>
References: <29471.1107857667@www32.gmx.net> <420B9884.4070300@gmx.net>
	 <Pine.LNX.4.61.0502101942250.15545@tuomi.oulu.fi>
	 <200502102210.07149.stefan@lucke.in-berlin.de>
Message-ID: <1111328281.6661.33.camel@africa.netenviron.com>

On Thu, 2005-02-10 at 22:10 +0100, Stefan Lucke wrote:
> 
> > I have the same kind of problem here. With G400 CRTC2 & DFB I have
> to 
> > change the video to YUV2 and pixel aspect to PAL-TV every time. Any 
> > keywords to enable these?
> 
> Please use setup->plugins->softdevice.

Maybe it would be an idea to remove the softdevice main menu item, or to
make changes in it permanent?

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sun Mar 20 15:26:05 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 20 Mar 2005 14:26:05 +0000
Subject: [Softdevice-devel] directfb questions
In-Reply-To: <200503201516.54798.softdevice@ckollmeier.de>
References: <200503161120.26876.softdevice@ckollmeier.de>
	 <200503162024.29120.softdevice@ckollmeier.de>
	 <1111326473.6661.13.camel@africa.netenviron.com>
	 <200503201516.54798.softdevice@ckollmeier.de>
Message-ID: <1111328765.6661.42.camel@africa.netenviron.com>

On Sun, 2005-03-20 at 15:16 +0100, Carsten Kollmeier wrote:
> Am Sonntag, 20. M?rz 2005 14:47 schrieb Torgeir Veimo:
> > > Could this be the problem with the slow output, for DirectFB has
> > > to convert from I420? Then I will be testing dfb-output right
> > > away, for I don't like the vidix-output I am using not very
> > > much.
> >
> > What do you mean by slow output? Like if the picture is not
> > completely updated every second?
> 
> I mean the pictures run not very smooth. One issue is, that I suppose 
> that the output gets not synced with the frequency of my monitor and 
> therefore I get incomplete pictures especially on pans.

If you see vertical lines being broken in horizontal pans, that would
technically be called tearing. 

If you see some frames "missing" causing non-smooth motion, the
technical name would be judder.

> I also get framedrops or something what looks like that. On some 
> channels (for example "WDR Dortmund" on Astra) the picture stops 
> sometimes for approx <0,5 sec and picture and sound get more and 
> more out of sync.

It's also my own experience that using sync to vertical retrace on
matrox cards introduces sync issues. It doesn't happen when doing sync
to vertical trace using radeons. 

Am not sure why it only happens with matrox cards, but with Martins
forthcoming sync-to-video support, the situation should improve.

Have you tried both pixel formats on the radeon? The YUV2 pixel format
is really only supported on the matrox, where it uses the hardware
texture support and stretch blits, whereas I420 output uses the hardware
overlay. The former is tear-free, while the latter requires either
triple or double buffering to be tear-free.

Can you try I420 output with the triple/double buffering patch I posted
yesterday and see if it improves the situation?

> I'm setting up an testing system in the moment (for my wife doesn't 
> like me to test on our TV-system), then I will be able to test it 
> and share my observations in detail.

Understandable. :) In any case I think the WAF factor of softdevice
improves every day these days..

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun Mar 20 15:49:46 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 20 Mar 2005 15:49:46 +0100
Subject: [Softdevice-devel] Re: PATCH: OSD scaling && and real alpha blending for XV
In-Reply-To: <1111328281.6661.33.camel@africa.netenviron.com>
References: <29471.1107857667@www32.gmx.net> <200502102210.07149.stefan@lucke.in-berlin.de> <1111328281.6661.33.camel@africa.netenviron.com>
Message-ID: <200503201549.46472.stefan@lucke.in-berlin.de>

On Sonntag, 20. M?rz 2005 15:18, Torgeir Veimo wrote:
> On Thu, 2005-02-10 at 22:10 +0100, Stefan Lucke wrote:
> > 
> > > I have the same kind of problem here. With G400 CRTC2 & DFB I have
> > to 
> > > change the video to YUV2 and pixel aspect to PAL-TV every time. Any 
> > > keywords to enable these?
> > 
> > Please use setup->plugins->softdevice.
> 
> Maybe it would be an idea to remove the softdevice main menu item, or to
> make changes in it permanent?

That is done, at least it should be as from changelog 2005-03-10.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Mar 20 17:25:00 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 20 Mar 2005 17:25:00 +0100
Subject: [Softdevice-devel] vdr-1.2.1 works ! (but why?)
Message-ID: <200503201725.00810.stefan@lucke.in-berlin.de>

Hi,

don't know which part of recent cvs changes did it.
Current cvs version works for me in combination with streamdev
and vdr-1.2.1 (server is running vdr-1.2.1 too).
Channel switch time is much faster as with vdr-1.3.22 ;-) .

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Mar 20 21:23:01 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 20 Mar 2005 21:23:01 +0100
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <200503192240.49437.stefan@lucke.in-berlin.de>
References: <200503192240.49437.stefan@lucke.in-berlin.de>
Message-ID: <200503202123.02095.stefan@lucke.in-berlin.de>

On Samstag, 19. M?rz 2005 22:40, Stefan Lucke wrote:
> Breaking thread (subject chage is not enough.
> 
> On Samstag, 19. M?rz 2005 21:31, Torgeir Veimo wrote:
> > On Thu, 2005-03-17 at 00:09 +0000, Torgeir Veimo wrote:
> > > On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> > > > 
> > > > 
> > > > P.S. this surely belongs to a new thread, but what about DirectFB
> > > > output 
> > > > on interlaced devices (TV-out of a Matrox G400 for example), has
> > > > there 
> > > > been any improvement in the field parity issues? The output is still 
> > > > jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> > > > completely turn of deinterlacing (as it is not needed at all on a an 
> > > > "interlaced-by-nature" device like a standard PAL TV with no fancy 
> > > > feateres) and just take care of the right field order?
> > > 
> > > In my testing I've found that commenting out all Flip() calls doesn't
> > > have any impact at all on operation, so I don't think there's double
> > > buffering involved when using I420, which would explain why I'm seeing
> > > tearing, and you are seeing field parity issues.
> 
> Sorry for delayed response. You are absolutely right.
> Don't know why buffermode was not yet set for surface creation.
> I've been at a similar location for setting buffermode, but my direction
> today was onto via epia.
> 
> > 
> > Applying tripple buffering improves the tearing situation tremendously
> > with my radeonfb. This patch doesn't force flip on vsync, so it might be
> > necessary to change to either one of 
> > 
> > videoSurface->Flip(NULL, DSFLIP_WAITFORSYNC); or
> > videoSurface->Flip(NULL, DSFLIP_ONSYNC);
> > 
> > around line 1100. 
> > 
> > This is just a rough initial patch so I'm interested in feedback. I've
> > only tested it with I420 pixelformat.
> 
> Thats no real feedback as I'm currently working on vdr1.2.1 .
> I'll try that later, especially the impact of your change around
> line 765 (comment was from me and indicates some problems with mga).

So after a short test G550 vga out:
- using BES in modes I420 and YV12 viewing is
 complete jerky. removed clear has still negative effects, that is
 if OSD is active while videosurface changes, video is shown through
 OSD only until OSD disappears.
- It has no visible effect on YUY2 mode.

> 
> OSD drawing has be reworked as current mode is alot to cpu intensive
> for epia.


-- 
Stefan Lucke



From marko.makela at hut.fi  Sun Mar 20 23:18:35 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 21 Mar 2005 00:18:35 +0200
Subject: [Softdevice-devel] Cannot get remote controls to work via softdevice
In-Reply-To: <1111326550.6661.15.camel@africa.netenviron.com> <200503201027.48125.stefan@lucke.in-berlin.de>
References: <20050320070541.GA431019@kosh.hut.fi> <1111326550.6661.15.camel@africa.netenviron.com> <20050320070541.GA431019@kosh.hut.fi> <200503201027.48125.stefan@lucke.in-berlin.de>
Message-ID: <20050320221835.GA467991@kosh.hut.fi>

On Sun, Mar 20, 2005 at 10:27:47AM +0100, Stefan Lucke wrote:
> > I compiled linux_input support in DirectFB and disabled other input modules.
> > According to lsof, VDR keeps /dev/input/event* open.  However, the remote
> > control learning screen of softdevice-dfb does not react to anything:
> > keyboard, mouse, or the remote control of my cx88xx-based Hauppauge
> > Nova-T card.  In order to disable the annoying 10-second delay, I manually
> > entered a dummy line to remote.conf.
> 
> Whats your /etc/directfbrc and which messages are printed to console ?

I'll check that information when my VDR box is up and running again and
I have the time.  I guess I'll have to start VDR via an OpenSSH connection,
because I haven't figured out how to reliably switch virtual consoles while
vdr-softdevice is running on DirectFB.  (I also didn't figure out how to
run it without suid root.  The console-switching ioctl()s may need superuser
privileges.)

> > I had a similar problem with softdevice-xv: it wouldn't react to the keyboard,
> > no matter if the output window or the controlling terminal window has focus.
> > The 'F' key toggled between fullscreen and windowed output when the output
> > window had focus.
> 
> When we react upon 'f' for fullscreen toggle we should act on other keys
> too. The logic is: catch internal used keys and pass all others to vdr
> remote handling.
> 
> Please add the following line in file video-xv.c around line 440
> after the call of XLookupString() to see which keys we get.
> Remove all softdevice-xv.* entries from your remote.conf
> and restart the key learning phase.
> fprintf(stderr,"XV-Lookup: l = %d k = 0x%08x, %c\n", len, keysym, keysym);

I renamed remote.conf altogether.  Hmm, it certainly gets the keypresses,
and it sometimes recognizes that a key is being pressed.  I believe that
in all cases, it had something to do with the Left Alt, Shift or Ctrl key;
printable characters didn't seem to work at all.

On this system, I'm using softdevice-0.1.0pre1 and vdr-1.3.22.  I'm using
this kind of debugging statement in video-xv.c:

        len = XLookupString (&event. xkey, buffer, 80, &keysym, &compose);
fprintf(stderr,"XV-Lookup: l = %d k = 0x%08x, %p\n", len, keysym, xvRemote);
        switch (keysym)

Here's the result (compiled with "make NO_KBD=1" and
"make plugins {C,CXX}FLAGS=-g")

23:53:05 ~/video/vdr-1.3.22$LD_ASSUME_KERNEL=2.4.1 ./vdr -Psoftdevice -v /media/video
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 1 lavc
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(cvs) build(4743)
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
XV-Lookup: l = 1 k = 0x00000034, 0x81c8e18
XV-Lookup: l = 1 k = 0x00000032, 0x81c8e18
XV-Lookup: l = 1 k = 0x00000031, 0x81c8e18

(I picked the number keys 4, 2 and 1, because there didn't seem to be
any special meaning attached to them.)  I also tried running it inside
gdb.  Here's the stack trace from the 'default' case:

#0  cRemote::Put (this=0x0, Code=0, Repeat=183, Release=false) at remote.c:120
#1  0xb741338f in cXvRemote::PutKey (this=0x81c8ef8, key=51) at video-xv.c:242
#2  0xb741404a in cXvVideoOut::ProcessEvents (this=0x81bd890) at video-xv.c:515
#3  0xb74133ff in cXvRemote::Action (this=0x81c8ef8) at video-xv.c:256
#4  0x080e39a6 in cThread::StartThread (Thread=0x81c8f08) at thread.c:227
#5  0xb7f72e51 in pthread_start_thread () from /lib/libpthread.so.0
#6  0xb7f72ecf in pthread_start_thread_event () from /lib/libpthread.so.0
#7  0xb7e296ea in clone () from /lib/libc.so.6

Somehow, the keycode seems to be lost when cXvRemote::PutKey() calls
cRemote::Put().  But it most probably is just gdb acting up; I didn't
look at the machine instructions to see how the parameters are being
passed.

Could I be seeing the same bug on DirectFB?  Both systems are probably
running g++ (GCC) 3.3.5 (Debian 1:3.3.5-12).  Is it maybe something
nasty with the default function arguments in C++?  Nope, I tried removing
the defaults from that cRemote::Put method, but it didn't change anything.

It seems that this bug only affects the learning of the keys.  Once
vdr detects a keypress (on my last successful test, it took maybe 5 or 10
seconds after I had stopped pressing keys), it will register all keypresses
correctly.  Also, subsequent vdr runs will reliably react on the learned keys
without any noticeable delay.

	Marko


From torgeir at pobox.com  Mon Mar 21 03:04:11 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 21 Mar 2005 02:04:11 +0000
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby
	Digital out via SPDIF
In-Reply-To: <200503202123.02095.stefan@lucke.in-berlin.de>
References: <200503192240.49437.stefan@lucke.in-berlin.de>
	 <200503202123.02095.stefan@lucke.in-berlin.de>
Message-ID: <1111370651.6661.53.camel@africa.netenviron.com>

On Sun, 2005-03-20 at 21:23 +0100, Stefan Lucke wrote:
> On Samstag, 19. M?rz 2005 22:40, Stefan Lucke wrote:
> > Breaking thread (subject chage is not enough.
> > 
> > On Samstag, 19. M?rz 2005 21:31, Torgeir Veimo wrote:
> > > On Thu, 2005-03-17 at 00:09 +0000, Torgeir Veimo wrote:
> > > > On Wed, 2005-03-16 at 19:12 +0100, Lucian Muresan wrote:
> > > > > 
> > > > > 
> > > > > P.S. this surely belongs to a new thread, but what about DirectFB
> > > > > output 
> > > > > on interlaced devices (TV-out of a Matrox G400 for example), has
> > > > > there 
> > > > > been any improvement in the field parity issues? The output is still 
> > > > > jerky compared with 'mplayer -vo dfbmga' on the TV. Is it possible to 
> > > > > completely turn of deinterlacing (as it is not needed at all on a an 
> > > > > "interlaced-by-nature" device like a standard PAL TV with no fancy 
> > > > > feateres) and just take care of the right field order?
> > > > 
> > > > In my testing I've found that commenting out all Flip() calls doesn't
> > > > have any impact at all on operation, so I don't think there's double
> > > > buffering involved when using I420, which would explain why I'm seeing
> > > > tearing, and you are seeing field parity issues.
> > 
> > Sorry for delayed response. You are absolutely right.
> > Don't know why buffermode was not yet set for surface creation.
> > I've been at a similar location for setting buffermode, but my direction
> > today was onto via epia.

Was there a reply in this thread I missed?

> > > 
> > > Applying tripple buffering improves the tearing situation tremendously
> > > with my radeonfb. This patch doesn't force flip on vsync, so it might be
> > > necessary to change to either one of 
> > > 
> > > videoSurface->Flip(NULL, DSFLIP_WAITFORSYNC); or
> > > videoSurface->Flip(NULL, DSFLIP_ONSYNC);
> > > 
> > > around line 1100. 
> > > 
> > > This is just a rough initial patch so I'm interested in feedback. I've
> > > only tested it with I420 pixelformat.
> > 
> > Thats no real feedback as I'm currently working on vdr1.2.1 .
> > I'll try that later, especially the impact of your change around
> > line 765 (comment was from me and indicates some problems with mga).
> 
> So after a short test G550 vga out:
> - using BES in modes I420 and YV12 viewing is
>  complete jerky. removed clear has still negative effects, that is
>  if OSD is active while videosurface changes, video is shown through
>  OSD only until OSD disappears.

Yes it requires a flip with DSFLIP_WAITFORSYNC, otherwise it's very
jerky. There is still some occational judder, which might be related to
buffer starvation due to the refresh rate being higher than the mpeg2
stream rate.

> - It has no visible effect on YUY2 mode.

I'll provide a new patch where dlc.flags dont get DLCONF_BUFFERMODE
unless in I420 mode.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Mon Mar 21 03:41:35 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 21 Mar 2005 02:41:35 +0000
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby
	Digital out via SPDIF
In-Reply-To: <1111370651.6661.53.camel@africa.netenviron.com>
References: <200503192240.49437.stefan@lucke.in-berlin.de>
	 <200503202123.02095.stefan@lucke.in-berlin.de>
	 <1111370651.6661.53.camel@africa.netenviron.com>
Message-ID: <1111372895.6661.59.camel@africa.netenviron.com>

On Mon, 2005-03-21 at 02:04 +0000, Torgeir Veimo wrote:

> > > Thats no real feedback as I'm currently working on vdr1.2.1 .
> > > I'll try that later, especially the impact of your change around
> > > line 765 (comment was from me and indicates some problems with mga).
> > 
> > So after a short test G550 vga out:
> > - using BES in modes I420 and YV12 viewing is
> >  complete jerky. removed clear has still negative effects, that is
> >  if OSD is active while videosurface changes, video is shown through
> >  OSD only until OSD disappears.
> 
> Yes it requires a flip with DSFLIP_WAITFORSYNC, otherwise it's very
> jerky. There is still some occational judder, which might be related to
> buffer starvation due to the refresh rate being higher than the mpeg2
> stream rate.
> 
> > - It has no visible effect on YUY2 mode.
> 
> I'll provide a new patch where dlc.flags dont get DLCONF_BUFFERMODE
> unless in I420 mode.

Improved patch attached. This one forces wait for vsync for the flip.

It also contains an unrelated check for radeon to allow radeon specific
handling. What is your view on such things? There's already mgatv and
via specific handling in video-dfb.c.

directfb output has become much better for me now, so am switching to it
as the main output method in my htpc setup. :) 

-- 
Torgeir Veimo <torgeir at pobox.com>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: triplebuffering2.patch
Type: text/x-patch
Size: 2939 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050321/7c663f3a/attachment.bin>

From torgeir at pobox.com  Mon Mar 21 16:56:07 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 21 Mar 2005 15:56:07 +0000
Subject: [Softdevice-devel] Cannot get remote controls to work via
	softdevice
In-Reply-To: <20050320221835.GA467991@kosh.hut.fi>
References: <20050320070541.GA431019@kosh.hut.fi>
	 <1111326550.6661.15.camel@africa.netenviron.com>
	 <20050320070541.GA431019@kosh.hut.fi>
	 <200503201027.48125.stefan@lucke.in-berlin.de>
	 <20050320221835.GA467991@kosh.hut.fi>
Message-ID: <1111420567.27147.8.camel@africa.netenviron.com>

On Mon, 2005-03-21 at 00:18 +0200, Marko M?kel? wrote:
> It seems that this bug only affects the learning of the keys.  Once
> vdr detects a keypress (on my last successful test, it took maybe 5 or
> 10 seconds after I had stopped pressing keys), it will register all
> keypresses correctly.  Also, subsequent vdr runs will reliably react
> on the learned keys without any noticeable delay.


This sounds like a threading issue. vdr seems to be very noninteractive
when starting up, especially for command input. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Mon Mar 21 20:07:41 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 21 Mar 2005 20:07:41 +0100
Subject: [Softdevice-devel] vdr-1.2.1 works ! (but why?)
In-Reply-To: <200503201725.00810.stefan@lucke.in-berlin.de>
References: <200503201725.00810.stefan@lucke.in-berlin.de>
Message-ID: <423F1B7D.30202@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> don't know which part of recent cvs changes did it.
I tested it with vdr-1.2.6 and changed a few things in the buffering. 
cRingBufferLinear seems to behave quite different in 1.3.22.
Mostly the changes in read_packet were important, but I also allow 
greater corrections to the A/V sync...

Martin


From M.Wache at gmx.net  Wed Mar 23 10:11:34 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 23 Mar 2005 10:11:34 +0100
Subject: resend: Re: [Softdevice-devel] CVS from last night feedback  - field
 parity seems to be solved :-) , some audio issues remain]
Message-ID: <424132C6.3000302@gmx.net>

Since the softdevice list has been down I send this again:

Torgeir Veimo wrote:
> On Sun, 2005-03-20 at 13:41 +0100, Martin Wache wrote:
> 
>>I just commited a few changes to the A-V sync. One change may be
>>interesting for the SPDIF out off-sync problem: now video and audio
>>wait for each other before starting. Before each of the stream was
>>played as soon as data was available and syncing was done while
>>playing. Now the syncronization between audio and video should be much
>>better at the start, maybe this improves the situation for SPDIF
>>out...
> 
> 
> I just tried it out, and channel change is a bit better now, but also a
> bit slower.
I made it a bit faster again. I got some buffer underuns on some
channels. When we have a audio resampler we should tune this more.

> 
> 
>>There is a menu entry A/V Delay in the softdevice menu, is it possible
>>to syncronize SPDIF out and the video with this option
> 
> 
> The avOffset doesn't seem to work anymore. I think we also need a way of
> telling the mpeg2decoder of any implicit delays in any output method,
> eg. when using triple buffering for directfb output, we need to
> compensate for the additional two frames delay in the video.
> 
I fixed the avOffset, I just forgot to multiply it by 10, when changing
the pts values to 0.1ms units.

Bye,
Martin



From torgeir at pobox.com  Tue Mar 22 00:34:55 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 21 Mar 2005 23:34:55 +0000
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby
	Digital out via SPDIF
In-Reply-To: <200503202123.02095.stefan@lucke.in-berlin.de>
References: <200503192240.49437.stefan@lucke.in-berlin.de>
	 <200503202123.02095.stefan@lucke.in-berlin.de>
Message-ID: <1111448095.27147.15.camel@africa.netenviron.com>

On Sun, 2005-03-20 at 21:23 +0100, Stefan Lucke wrote:

> So after a short test G550 vga out:
> - using BES in modes I420 and YV12 viewing is
>  complete jerky. 

I see sometimes that vdr becomes quite jerky, am not sure if it's
related to the double / triple buffering. CPU usage goes much higher
with one thread occupying about 42% cpu and the other 22%. I don't think
I've seen this before, but it's a bit too early to conclude anything.

Cpu(s): 92.7% us,  7.3% sy,  0.0% ni,  0.0% id,  0.0% wa,  0.0% hi,
0.0% si
Mem:    515964k total,   509892k used,     6072k free,    41908k buffers
Swap:  1815304k total,        0k used,  1815304k free,   341224k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 6532 root      15   0  207m  40m 3188 S 42.9  8.1  64:25.86 vdr
 6622 root      15   0  207m  40m 3188 S 22.5  8.1  76:30.36 vdr

[...]

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Wed Mar 23 08:22:53 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 23 Mar 2005 09:22:53 +0200
Subject: [Softdevice-devel] video-dfb: Found workarounds for enabling the remote
Message-ID: <20050323072253.GA270093@kosh.hut.fi>

As VDR didn't want to learn keys, I added some debugging output to it and
redirected it to stderr.  From there, I got the codes for all keys on my
remote except KEY_FASTFORWARD (defined in <linux/input.h> as 208).  Maybe
this is a recent addition; evtest shows it as '?' but lists the code
correctly.  video-dfb.c doesn't get any code from this key.

Hmm, it looks like DirectFB/inputdrives/linux_input/linux_input.c lacks
this definition.  basic_keycodes[] is 208 elements.  After I added
DIKS_FASTFORWARD as its last element, after 207 (DIKS_PLAY), also this
key started working.  I'll report this to the DirectFB guys.

	Marko


From M.Wache at gmx.net  Mon Mar 21 20:10:22 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 21 Mar 2005 20:10:22 +0100
Subject: [Softdevice-devel] CVS from last night feedback  - field	parity
 seems to be solved :-) , some audio issues remain
In-Reply-To: <1111324267.6661.10.camel@africa.netenviron.com>
References: <423AA25F.3030007@users.sourceforge.net>	 <423AF087.2080009@gmx.net> <423C0143.9060101@users.sourceforge.net>	 <423D6F90.3090307@gmx.net> <1111324267.6661.10.camel@africa.netenviron.com>
Message-ID: <423F1C1E.2070509@gmx.net>

Torgeir Veimo wrote:
> On Sun, 2005-03-20 at 13:41 +0100, Martin Wache wrote:
> 
>>I just commited a few changes to the A-V sync. One change may be
>>interesting for the SPDIF out off-sync problem: now video and audio
>>wait for each other before starting. Before each of the stream was
>>played as soon as data was available and syncing was done while
>>playing. Now the syncronization between audio and video should be much
>>better at the start, maybe this improves the situation for SPDIF
>>out...
> 
> 
> I just tried it out, and channel change is a bit better now, but also a
> bit slower.
I made it a bit faster again. I got some buffer underuns on some 
channels. When we have a audio resampler we should tune this more.

> 
> 
>>There is a menu entry A/V Delay in the softdevice menu, is it possible
>>to syncronize SPDIF out and the video with this option
> 
> 
> The avOffset doesn't seem to work anymore. I think we also need a way of
> telling the mpeg2decoder of any implicit delays in any output method,
> eg. when using triple buffering for directfb output, we need to
> compensate for the additional two frames delay in the video.
> 
I fixed the avOffset, I just forgot to multiply it by 10, when changing 
the pts values to 0.1ms units.

Bye,
Martin


From marko.makela at hut.fi  Tue Mar 22 23:42:58 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 23 Mar 2005 00:42:58 +0200
Subject: [Softdevice-devel] Cannot get remote controls to work via softdevice
In-Reply-To: <1111420567.27147.8.camel@africa.netenviron.com>
References: <20050320070541.GA431019@kosh.hut.fi> <1111326550.6661.15.camel@africa.netenviron.com> <20050320070541.GA431019@kosh.hut.fi> <200503201027.48125.stefan@lucke.in-berlin.de> <20050320221835.GA467991@kosh.hut.fi> <1111420567.27147.8.camel@africa.netenviron.com>
Message-ID: <20050322224258.GA209819@kosh.hut.fi>

On Mon, Mar 21, 2005 at 03:56:07PM +0000, Torgeir Veimo wrote:
> On Mon, 2005-03-21 at 00:18 +0200, Marko M?kel? wrote:
> > It seems that this bug only affects the learning of the keys.  Once
> > vdr detects a keypress (on my last successful test, it took maybe 5 or
> > 10 seconds after I had stopped pressing keys), it will register all
> > keypresses correctly.  Also, subsequent vdr runs will reliably react
> > on the learned keys without any noticeable delay.
> 
> 
> This sounds like a threading issue. vdr seems to be very noninteractive
> when starting up, especially for command input. 

You are probably right.  I tested it with NPTL as well (after disabling
the nagging about LD_ASSUME_KERNEL in VDR), without success.

I added some debugging output to remote.c:

bool cRemote::Put(const char *Code, bool Repeat, bool Release)
{
  if (learning && this != learning)
     return false;
  eKeys Key = Keys.Get(Name(), Code);
fprintf(stderr, "Put %x '%s' %p %s\n", (unsigned) Key, Code, learning, unknownCode);

I also added a debug fprintf to video-dfb.c.  The '%s' in the above format
string matches that output.

On the first keypress, unknownCode was NULL.  It wasn't cleared between
successive keypresses.  Every time, Key was kNone and learning was pointing
to the same location.

I tried to manually write a key mapping to remote.conf.  That worked.  So,
the bug is in the vdr learning mode and not in the softdevice plugin.

Sometimes, vdr bypassed the learning mode, even though remote.conf
didn't exist.  Sometimes, the screen remains blank and vdr consumes
about 1 % of available processing power (Intel Celeron running at 900 MHz).
Has anyone tried to run vdr under Valgrind's helgrind tool?

I also noticed that the codes returned by vdr-softdevice-plugin's
video-dfb.c differ from those returned by vdr-remote-plugin.
Does DirectFB do some mapping on its own?  What if new codes are
introduced in <linux/input.h>? Does DirectFB need to be recompiled,
or does DirectFB merely add some prefix to the linux_input codes,
to differentiate between devices and other DirectFB-supported input
methods?

	Marko


From thauta at iki.fi  Wed Mar 23 21:21:03 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Wed, 23 Mar 2005 22:21:03 +0200 (EET)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
Message-ID: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>

First, I would like to thank everyone developing softdevice+DFB. After 
upgrading dfb to 0.9.22 and softdevice to cvs the problems with 
interlaced G400 tv-out and sync are gone. Excellent work! =)

Now I'm just wondering if anyone else is having juddering picture when 
using the OSD? Everything is fine until I open the OSD, then the 
video+audio start to judder. After the OSD disappears, it takes a few 
seconds until the video and audio are playing ok again. However the 
a-vsync gets lost and I have to change to a different channel and back to 
recover the a-vsync. The video seems to lag ~1 sec when using the OSD for 
3 secs to show the channel info.

I'm guessing now but is there a chance that the OSD doesn't use the same 
mechanism that the video does to sync the fields for TV? And somehow it's 
affecting the audio+video layers too. Well, ask away any needed details if 
anyone has suggestions.

My system is G400 w/ rgb-tvout, vdr 1.3.22, softdevice cvs from today and 
DFB 0.9.22.

[22:04:09] (VDR) #./vdr -v /tmp/vdr_save/ -P'softdevice -vo dfb:mgatv'
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 0 none
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YUV2)
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4747)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.22 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Multi Application Core. (2005-03-18 21:23)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(*) Direct/Thread: Running 'Fusion Dispatch' (MESSAGING, 2520)...
(*) DirectFB/Core: doing sync()...
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 2521)...
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) Direct/Modules: suppress module 'ps2mouse'
(*) Direct/Modules: suppress module 'serialmouse'
(*) Direct/Modules: suppress module 'sonypi'
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 2522)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G400 0.7 (convergence integrated media GmbH)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 33554432 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine 
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize 
SrcColorkey Deinterlace
[dfb] Supported video Modes are: 1280x1024 at 16 768x576 at 32 720x576 at 16 
768x576 at 16 768x576 at 32 800x600 at 16 1024x768 at 16 1280x1024 at 16 1600x1200 at 16 
640x400 at 16 400x300 at 16 320x240 at 16 320x200 at 16
[dfb] Enumeratig display Layers
Layer 2 FBDev Primary Layer  Type: graphics
   Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
   Caps: brightness contrast deinterlacing dst_colorkey screen_location 
surface
Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
   Caps: brightness contrast flicker_filtering hue field_parity saturation 
surface
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (Matrox CRTC2 Layer - [720x576])
osdSurface::
  - videoonly
  - flipping
videoSurface::
  - videoonly
[dfb] Using this layer for OSD: Matrox CRTC2 Layer
[dfb] Using this layer for Video out: Matrox CRTC2 Layer
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[dfb] (re)configured 0x00200806
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
CMD[2792]:Start IsSuspended 0
init put byte finished
CMD[2793]:Neuer Thread gestartet: Mpeg2Decoder pid 2527
CMD[3359]:Neuer StreamDecoder Pid: 2527 type 0
CMD[3359]:Neuer Thread gestartet: pid:2529 type 0
Set up to use linux RTC
CMD[4146]:Neuer StreamDecoder Pid: 2527 type 1
CMD[4177]:Neuer Thread gestartet: pid:2530 type 1
alsa-audio: SetParams
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[dfb] (re)configured 0x00200806
Input #0, mpeg, from 'test':
   Duration: N/A, bitrate: N/A
   Stream #0.0: Video: mpeg2video, 720x576, 25.00 fps, 10000 kb/s
   Stream #0.1: Audio: mp2, 48000 Hz, stereo, 224 kb/s
alsa-audio: Xrun
alsa-audio: Xrun
alsa-audio: Xrun
alsa-audio: Xrun
alsa-audio: Xrun
alsa-audio: Xrun
playmode not implemented... 0
CMD[9161]:Stop
CMD[9181]:Thread beendet : mpegDecoder pid 2527
CMD[9190]:thread finished pid: 2529 type 0
CMD[9211]:thread finished pid: 2530 type 1
CMD[9221]:Stop finished
GetSpuDecoder 0
Releasing DFB

Maybe these are somehow related to the problem. Noticed from the logs 
after a longer run:
alsa-audio: Xrun
[mpeg2video @ 0x407f56b0]00 motion_type at 16 15
[mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
[mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
[mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
[mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
[mpeg2video @ 0x407f56b0]ac-tex damaged at 1 16
[mpeg2video @ 0x407f56b0]Warning MVs not available
[mpeg2video @ 0x407f56b0]concealing 135 DC, 135 AC, 135 MV errors


Tomi Hautakoski
thauta at iki.fi
                            Queen Elizabeth rules, UK?


From stefan at lucke.in-berlin.de  Wed Mar 23 22:31:42 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 23 Mar 2005 22:31:42 +0100
Subject: tripple buffer dfb output Was: Re: [Softdevice-devel] Dolby Digital out via SPDIF
In-Reply-To: <1111372895.6661.59.camel@africa.netenviron.com>
References: <200503192240.49437.stefan@lucke.in-berlin.de> <1111370651.6661.53.camel@africa.netenviron.com> <1111372895.6661.59.camel@africa.netenviron.com>
Message-ID: <200503232231.42301.stefan@lucke.in-berlin.de>

On Montag, 21. M?rz 2005 03:41, Torgeir Veimo wrote:
> On Mon, 2005-03-21 at 02:04 +0000, Torgeir Veimo wrote:
> 
> > > > Thats no real feedback as I'm currently working on vdr1.2.1 .
> > > > I'll try that later, especially the impact of your change around
> > > > line 765 (comment was from me and indicates some problems with mga).
> > > 
> > > So after a short test G550 vga out:
> > > - using BES in modes I420 and YV12 viewing is
> > >  complete jerky. removed clear has still negative effects, that is
> > >  if OSD is active while videosurface changes, video is shown through
> > >  OSD only until OSD disappears.
> > 
> > Yes it requires a flip with DSFLIP_WAITFORSYNC, otherwise it's very
> > jerky. There is still some occational judder, which might be related to
> > buffer starvation due to the refresh rate being higher than the mpeg2
> > stream rate.
> > 
> > > - It has no visible effect on YUY2 mode.
> > 
> > I'll provide a new patch where dlc.flags dont get DLCONF_BUFFERMODE
> > unless in I420 mode.
> 
> Improved patch attached. This one forces wait for vsync for the flip.

This one works ok  for me. But I do not understand why previous one didn't.
I assume that there something complete wrong. I had a look at the old
version 0.0.6. There was Flip() commented out ;-) .

> 
> It also contains an unrelated check for radeon to allow radeon specific
> handling. What is your view on such things? There's already mgatv and
> via specific handling in video-dfb.c.

There is nothing to say against hardware specific adaptations like "via",
which have a different (inverse) understanding of alpha values ;;-).
If radeons only work correct without that flip then we should include
that change. But it looks more like either a driver problem or like
problem in our logic.

I currently work on the other approach to change the logic which
will reduce the "allways comple redraw osd".

> 
> directfb output has become much better for me now, so am switching to it
> as the main output method in my htpc setup. :) 

Nice to read. So the only remaing thing is A.. . Have said that
some times earlier .

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Wed Mar 23 22:47:08 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 23 Mar 2005 22:47:08 +0100
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
Message-ID: <200503232247.08118.stefan@lucke.in-berlin.de>

On Mittwoch, 23. M?rz 2005 21:21, Tomi Hautakoski wrote:
> First, I would like to thank everyone developing softdevice+DFB. After 
> upgrading dfb to 0.9.22 and softdevice to cvs the problems with 
> interlaced G400 tv-out and sync are gone. Excellent work! =)

Thanks.
So your setup works better than mine (G400+celeronIII 1.2GHz, very old dfb).
Whats your CPU power ?

> 
> Now I'm just wondering if anyone else is having juddering picture when 
> using the OSD? Everything is fine until I open the OSD, then the 
> video+audio start to judder. After the OSD disappears, it takes a few 
> seconds until the video and audio are playing ok again. However the 
> a-vsync gets lost and I have to change to a different channel and back to 
> recover the a-vsync. The video seems to lag ~1 sec when using the OSD for 
> 3 secs to show the channel info.

OSD drawing with dfb has to be rewritten, as it always draws complete osd
if only a small area has to be redrawn. To my experince this effect seems
to be worse with the channel info osd, which in term is refreshed for about
every frame. Vdr main menu menu is only refreshed after a few seconds.

A/V sync checking has to be move to the ouput method instead of decoder.

> 
> I'm guessing now but is there a chance that the OSD doesn't use the same 
> mechanism that the video does to sync the fields for TV? And somehow it's 
> affecting the audio+video layers too. Well, ask away any needed details if 
> anyone has suggestions.
> 
> My system is G400 w/ rgb-tvout, vdr 1.3.22, softdevice cvs from today and 
> DFB 0.9.22.



> Maybe these are somehow related to the problem. Noticed from the logs 
> after a longer run:
> alsa-audio: Xrun
> [mpeg2video @ 0x407f56b0]00 motion_type at 16 15
> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
> [mpeg2video @ 0x407f56b0]ac-tex damaged at 1 16
> [mpeg2video @ 0x407f56b0]Warning MVs not available
> [mpeg2video @ 0x407f56b0]concealing 135 DC, 135 AC, 135 MV errors

This is either related to a bad signal or some buffer problems.
Do you get buffer overflow messages in syslog ?

-- 
Stefan Lucke



From marko.makela at hut.fi  Wed Mar 23 23:09:28 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 24 Mar 2005 00:09:28 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
Message-ID: <20050323220928.GB430274@kosh.hut.fi>

On Wed, Mar 23, 2005 at 10:21:03PM +0200, Tomi Hautakoski wrote:
> Now I'm just wondering if anyone else is having juddering picture when 
> using the OSD? Everything is fine until I open the OSD, then the 
> video+audio start to judder. After the OSD disappears, it takes a few 
> seconds until the video and audio are playing ok again. However the 
> a-vsync gets lost and I have to change to a different channel and back to 
> recover the a-vsync.

I have very similar symptoms (900 MHz Celeron, dual-head Matrox G400 or G450;
I'm not sure which, outputting to a VGA monitor from the primary connector).
But for me, a-v sync will catch up in a few seconds once the OSD disappears.
Normally, there's 40-60% total CPU usage on my system.  There's not enough
processing power for CPU-hungry operations, such as deinterlacing,
color space transformations or alpha blending.

	Marko


From marko.makela at hut.fi  Wed Mar 23 23:29:25 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 24 Mar 2005 00:29:25 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
Message-ID: <20050323222925.GC430274@kosh.hut.fi>

Hi,

I'm setting up timed recordings with nvram-wakeup.  On shutdown, nvram-wakeup
complains that /dev/rtc is busy, unless I first manually suspend softdevice
playback.  I tried to solve the problem by adding a
PluginManager.StopPlugins() call right before SystemExec() in vdr.c, but
that didn't work reliably.

Is there any simple and reliable way to control the softdevice playback mode
from vdr.c?

Furthermore, I'd like to start with playback suspended when doing an
unattended timed recording.  In that way, corrupt DVB packets are less likely
to crash or hang VDR during recording.  I've heard that full-featured cards
may lock up when fed garbage, and I have experienced one repeatable softdevice
crash myself.

	Marko


From thauta at iki.fi  Wed Mar 23 23:54:28 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Thu, 24 Mar 2005 00:54:28 +0200 (EET)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503232247.08118.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
 <200503232247.08118.stefan@lucke.in-berlin.de>
Message-ID: <Pine.LNX.4.61.0503240038050.16692@tuomi.oulu.fi>

On Wed, 23 Mar 2005, Stefan Lucke wrote:
> So your setup works better than mine (G400+celeronIII 1.2GHz, very old dfb).
> Whats your CPU power ?

The same. I'm not sure if it was the new dfb or softdevice which made 
the difference but now I tested the system with live hockey (which seems 
to be good material for testing) and the picture was perfect.

> OSD drawing with dfb has to be rewritten, as it always draws complete osd
> if only a small area has to be redrawn. To my experince this effect seems
> to be worse with the channel info osd, which in term is refreshed for about
> every frame. Vdr main menu menu is only refreshed after a few seconds.

Yes, I have exactly the same symptoms here. I had to remove the EPG 
description field from the channel info and change the display time to 1 
sec to be able to change my channel without loosing the a-vsync 
completely. Still, nice to know that you have a hint what is causing the 
problem. =)

>> Maybe these are somehow related to the problem. Noticed from the logs
>> after a longer run:
>> alsa-audio: Xrun
>> [mpeg2video @ 0x407f56b0]00 motion_type at 16 15
>> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
>> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
>> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
>> [mpeg2video @ 0x407f56b0]MPEG motion vector out of boundary
>> [mpeg2video @ 0x407f56b0]ac-tex damaged at 1 16
>> [mpeg2video @ 0x407f56b0]Warning MVs not available
>> [mpeg2video @ 0x407f56b0]concealing 135 DC, 135 AC, 135 MV errors
>
> This is either related to a bad signal or some buffer problems.
> Do you get buffer overflow messages in syslog ?

Now that I know these don't have something to do with OSD I'm sure it's 
the fridge which makes the DVB-T signal go wild every time it starts. So 
we can ignore these. =)

Tomi Hautakoski
thauta at iki.fi
                            Queen Elizabeth rules, UK?


From thauta at iki.fi  Thu Mar 24 00:01:18 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Thu, 24 Mar 2005 01:01:18 +0200 (EET)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <20050323220928.GB430274@kosh.hut.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
 <20050323220928.GB430274@kosh.hut.fi>
Message-ID: <Pine.LNX.4.61.0503240055430.16692@tuomi.oulu.fi>

On Thu, 24 Mar 2005, Marko M?kel? wrote:
> I have very similar symptoms (900 MHz Celeron, dual-head Matrox G400 or G450;
> I'm not sure which, outputting to a VGA monitor from the primary connector).
> But for me, a-v sync will catch up in a few seconds once the OSD disappears.
> Normally, there's 40-60% total CPU usage on my system.  There's not enough
> processing power for CPU-hungry operations, such as deinterlacing,
> color space transformations or alpha blending.

I have tried lavc and some other software deints with a Celeron 1.2GHz but 
it's also lacking the necessary power to show the video without juddering.

A bit OT, but does anyone know is there a plugin for vdr to show the 
current cpu usage on the OSD? What I'm thinking is a bit like femon but 
for cpu power. Would be handy because the monitor is off when using mgatv.


Tomi Hautakoski
thauta at iki.fi
                            Queen Elizabeth rules, UK?

From M.Wache at gmx.net  Thu Mar 24 16:16:27 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 24 Mar 2005 16:16:27 +0100
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050323222925.GC430274@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi>
Message-ID: <4242D9CB.7090505@gmx.net>

Marko M?kel? wrote:
> Hi,
> 
> I'm setting up timed recordings with nvram-wakeup.  On shutdown, nvram-wakeup
> complains that /dev/rtc is busy, unless I first manually suspend softdevice
> playback.  I tried to solve the problem by adding a
> PluginManager.StopPlugins() call right before SystemExec() in vdr.c, but
> that didn't work reliably.
The softdevice tries to use the RTC for the A/V sync, I always wanted to 
add some option to disable this, but I never did. You can disable this 
by commenting all the lines in mpeg2decoder.c line 411 to 429 ( where it 
opens /dev/rtc and does the ioctl calls) and add a line like rtc_fd=-1;. 
The softdevice will then fallback to usleep() timing.
Or wait until I managed to add an option to disable the RTC timing, I 
hope that I manage soon.

> 
> Is there any simple and reliable way to control the softdevice playback mode
> from vdr.c?
As far as I now not. But maybe you can the softdevice's setupStore, then 
it would be possible..

> 
> Furthermore, I'd like to start with playback suspended when doing an
> unattended timed recording.  In that way, corrupt DVB packets are less likely
> to crash or hang VDR during recording.  I've heard that full-featured cards
> may lock up when fed garbage, and I have experienced one repeatable softdevice
> crash myself.
Actualy  on the start of vdr the softdevice should start in the same 
playback mode it was when the vdr was stopped, provided it saved the 
setupSore, but I never tried that.
What about this repeatable softdevice crash, was it due to bad signal 
quality, or something different? If you know how to reproducible crash 
the softdevice, then please tell us how, so that we can fix it.

Bye,
Martin


From torgeir at pobox.com  Thu Mar 24 16:52:01 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 24 Mar 2005 15:52:01 +0000
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
Message-ID: <1111679521.5508.18.camel@africa.netenviron.com>

On Wed, 2005-03-23 at 22:21 +0200, Tomi Hautakoski wrote:

> Now I'm just wondering if anyone else is having juddering picture when 
> using the OSD? Everything is fine until I open the OSD, then the 
> video+audio start to judder. After the OSD disappears, it takes a few 
> seconds until the video and audio are playing ok again. However the 
> a-vsync gets lost and I have to change to a different channel and back to 
> recover the a-vsync. The video seems to lag ~1 sec when using the OSD for 
> 3 secs to show the channel info.

Just curious, can you try replacing any Flip() operations in video-dfb.c
which uses DSFLIP_WAITFORSYNC or DSFLIP_ONSYNC semantics, with just
empty Flip(), operations? Eg. line 1074 (cvs version);

scrSurface->Flip(NULL, (setupStore->useMGAtv) ?
DSFLIP_WAITFORSYNC:DSFLIP_ONSYNC);

with 

scrSurface->Flip();


and the same in line 903 and see if it improves the av sync issue with
OSD displayed?

-- 
Torgeir Veimo <torgeir at pobox.com>



From thauta at iki.fi  Thu Mar 24 20:02:43 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Thu, 24 Mar 2005 21:02:43 +0200 (EET)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <1111679521.5508.18.camel@africa.netenviron.com>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
 <1111679521.5508.18.camel@africa.netenviron.com>
Message-ID: <Pine.LNX.4.61.0503242001310.11673@tuomi.oulu.fi>

On Thu, 24 Mar 2005, Torgeir Veimo wrote:
> Just curious, can you try replacing any Flip() operations in video-dfb.c
> which uses DSFLIP_WAITFORSYNC or DSFLIP_ONSYNC semantics, with just
> empty Flip(), operations? Eg. line 1074 (cvs version);
>
> scrSurface->Flip(NULL, (setupStore->useMGAtv) ?
> DSFLIP_WAITFORSYNC:DSFLIP_ONSYNC);
>
> with
>
> scrSurface->Flip();
>
> and the same in line 903 and see if it improves the av sync issue with
> OSD displayed?

Yes this fixed that issue but on the other hand it breaks the 
fieldparity and also causes the bottom third part of the OSD to 
flicker very much when the OSD is on.

Tomi Hautakoski
thauta at iki.fi
                  Do NOT look into laser with remaining eyeball!


From torgeir at pobox.com  Thu Mar 24 20:16:33 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 24 Mar 2005 19:16:33 +0000
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <Pine.LNX.4.61.0503242001310.11673@tuomi.oulu.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi>
	 <1111679521.5508.18.camel@africa.netenviron.com>
	 <Pine.LNX.4.61.0503242001310.11673@tuomi.oulu.fi>
Message-ID: <1111691793.5508.23.camel@africa.netenviron.com>

On Thu, 2005-03-24 at 21:02 +0200, Tomi Hautakoski wrote:

> Yes this fixed that issue but on the other hand it breaks the 
> fieldparity and also causes the bottom third part of the OSD to 
> flicker very much when the OSD is on.

Ok. Can you try restoring the flip w vsync on line 1074 and see if there
are still judder issues (leaving the osd flicker aside for a moment)?

-- 
Torgeir Veimo <torgeir at pobox.com>



From thauta at iki.fi  Thu Mar 24 21:31:16 2005
From: thauta at iki.fi (Tomi Hautakoski)
Date: Thu, 24 Mar 2005 22:31:16 +0200 (EET)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <1111691793.5508.23.camel@africa.netenviron.com>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> 
 <1111679521.5508.18.camel@africa.netenviron.com> 
 <Pine.LNX.4.61.0503242001310.11673@tuomi.oulu.fi> <1111691793.5508.23.camel@africa.netenviron.com>
Message-ID: <Pine.LNX.4.61.0503242227490.14726@tuomi.oulu.fi>

On Thu, 24 Mar 2005, Torgeir Veimo wrote:
> On Thu, 2005-03-24 at 21:02 +0200, Tomi Hautakoski wrote:
>> Yes this fixed that issue but on the other hand it breaks the
>> fieldparity and also causes the bottom third part of the OSD to
>> flicker very much when the OSD is on.
>
> Ok. Can you try restoring the flip w vsync on line 1074 and see if there
> are still judder issues (leaving the osd flicker aside for a moment)?

Ok, with this change the picture is the same as with the current cvs. 
Smooth when playing only the video but with OSD there are juddering 
issues with both audio and video.

Tomi Hautakoski
thauta at iki.fi
                  Do NOT look into laser with remaining eyeball!


From stefan at lucke.in-berlin.de  Sun Mar 27 11:46:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 27 Mar 2005 11:46:26 +0200
Subject: [Softdevice-devel] Re: [vdr] cannot set volume with softdevice and vdr-1.3.23
In-Reply-To: <20050327092351.GA3728@halim.local>
References: <20050327091954.GA3682@halim.local> <20050327092351.GA3728@halim.local>
Message-ID: <200503271146.26994.stefan@lucke.in-berlin.de>

On Sonntag, 27. M?rz 2005 11:23, Halim Sahin wrote:
> Hi,
> 
> My system configuration:
> vdr-1.3.23 
> softdevice last cvs snapshot from yesterday.
> Any ideas to solve this?

around line 476 in file softdevice .c SetVolume()
has been commented out.

//audioOut->SetVolume(Volume);

Martin was that intentionally  ?

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Mar 28 10:02:50 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 28 Mar 2005 10:02:50 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <Pine.LNX.4.61.0503240038050.16692@tuomi.oulu.fi>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503232247.08118.stefan@lucke.in-berlin.de> <Pine.LNX.4.61.0503240038050.16692@tuomi.oulu.fi>
Message-ID: <200503281002.50870.stefan@lucke.in-berlin.de>

On Mittwoch, 23. M?rz 2005 23:54, Tomi Hautakoski wrote:
> On Wed, 23 Mar 2005, Stefan Lucke wrote:
> > So your setup works better than mine (G400+celeronIII 1.2GHz, very old dfb).
> > Whats your CPU power ?
> 
> The same. I'm not sure if it was the new dfb or softdevice which made 
> the difference but now I tested the system with live hockey (which seems 
> to be good material for testing) and the picture was perfect.
> 
> > OSD drawing with dfb has to be rewritten, as it always draws complete osd
> > if only a small area has to be redrawn. To my experince this effect seems
> > to be worse with the channel info osd, which in term is refreshed for about
> > every frame. Vdr main menu menu is only refreshed after a few seconds.
> 
> Yes, I have exactly the same symptoms here. I had to remove the EPG 
> description field from the channel info and change the display time to 1 
> sec to be able to change my channel without loosing the a-vsync 
> completely. Still, nice to know that you have a hint what is causing the 
> problem. =)
> 

So hopefully I got it. OSD drawing is changed. Now there is no slowmotion
of video while the channel info OSD is shown on my epia. Tested that
also with Radeon-9200, G550 vga + tv-out and G400 as mentioned above.
On G400 I've still some problems but this is probably caused by the old
DFB version on that system (0.9.20). Other tests were done with DirectFB
cvs from 2005-02-26.

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Mon Mar 28 14:56:28 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 28 Mar 2005 14:56:28 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503281002.50870.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503232247.08118.stefan@lucke.in-berlin.de> <Pine.LNX.4.61.0503240038050.16692@tuomi.oulu.fi> <200503281002.50870.stefan@lucke.in-berlin.de>
Message-ID: <4247FEFC.70809@users.sourceforge.net>

Stefan Lucke wrote:
...
> 
> So hopefully I got it. OSD drawing is changed. Now there is no slowmotion
> of video while the channel info OSD is shown on my epia. Tested that
> also with Radeon-9200, G550 vga + tv-out and G400 as mentioned above.
> On G400 I've still some problems but this is probably caused by the old
> DFB version on that system (0.9.20). Other tests were done with DirectFB
> cvs from 2005-02-26.
> 

Hi,
I just tested today's CVS of softdevice with DirectFB-0.9.22 on my G400
DH TV-out and I must admit that the audio sync is OK now for supported
formats (stereo MP2 and AC3 software-decoded), even if on channel
switching it sometimes takes 1-2 seconds until it syncs, but that's OK
with me. OSD is OK, too, I'm seeing no problems. Unfortunately, the
field parity problems in the video are back again. So what could I try
to modify to have them sorted out again, but keep AV sync as it is now?
Keep up the good work!

Cheers,
Lucian


From stefan at lucke.in-berlin.de  Mon Mar 28 17:09:38 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 28 Mar 2005 17:09:38 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <4247FEFC.70809@users.sourceforge.net>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503281002.50870.stefan@lucke.in-berlin.de> <4247FEFC.70809@users.sourceforge.net>
Message-ID: <200503281709.38450.stefan@lucke.in-berlin.de>

On Montag, 28. M?rz 2005 14:56, Lucian Muresan wrote:
> Stefan Lucke wrote:
> ...
> > 
> > So hopefully I got it. OSD drawing is changed. Now there is no slowmotion
> > of video while the channel info OSD is shown on my epia. Tested that
> > also with Radeon-9200, G550 vga + tv-out and G400 as mentioned above.
> > On G400 I've still some problems but this is probably caused by the old
> > DFB version on that system (0.9.20). Other tests were done with DirectFB
> > cvs from 2005-02-26.
> > 

Now I'm on DFB-cvs 2005-02-26 with my G400 system too. Had to comment
out build of wm97xx and sis315.

> 
> Hi,
> I just tested today's CVS of softdevice with DirectFB-0.9.22 on my G400
> DH TV-out and I must admit that the audio sync is OK now for supported
> formats (stereo MP2 and AC3 software-decoded), even if on channel
> switching it sometimes takes 1-2 seconds until it syncs, but that's OK
> with me. OSD is OK, too, I'm seeing no problems. Unfortunately, the
> field parity problems in the video are back again. So what could I try
> to modify to have them sorted out again, but keep AV sync as it is now?
> Keep up the good work!

Field parity issue seems to be randomly either correct or wrong as my
recent changes should have no effect on interlaced/parity handling.
Did you try serveral channels and/or serval invocations of vdr ?

But I'll suggest the following change too, as it may have influence
on that issue (only compile checked).

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb-interl-01.diff
Type: text/x-diff
Size: 1227 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050328/26fd3f14/attachment.diff>

From stefan at lucke.in-berlin.de  Mon Mar 28 19:21:06 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 28 Mar 2005 19:21:06 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503281709.38450.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <4247FEFC.70809@users.sourceforge.net> <200503281709.38450.stefan@lucke.in-berlin.de>
Message-ID: <200503281921.06851.stefan@lucke.in-berlin.de>

On Montag, 28. M?rz 2005 17:09, Stefan Lucke wrote:
> On Montag, 28. M?rz 2005 14:56, Lucian Muresan wrote:

> > I just tested today's CVS of softdevice with DirectFB-0.9.22 on my G400
> > DH TV-out and I must admit that the audio sync is OK now for supported
> > formats (stereo MP2 and AC3 software-decoded), even if on channel
> > switching it sometimes takes 1-2 seconds until it syncs, but that's OK
> > with me. OSD is OK, too, I'm seeing no problems. Unfortunately, the
> > field parity problems in the video are back again. So what could I try
> > to modify to have them sorted out again, but keep AV sync as it is now?
> > Keep up the good work!
> 
> Field parity issue seems to be randomly either correct or wrong as my
> recent changes should have no effect on interlaced/parity handling.
> Did you try serveral channels and/or serval invocations of vdr ?

> But I'll suggest the following change too, as it may have influence
> on that issue (only compile checked).

After a short test: first part breaks setting the correct layer
configuration (set #if 1 to #if 0) .

I saw no field issues with news ticker of N24, but some problems
with a transmission of 1+. That was 16:9 downscaled to my 4:3 TV.

-- 
Stefan Lucke



From marko.makela at hut.fi  Tue Mar 29 08:20:16 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 29 Mar 2005 09:20:16 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <4242D9CB.7090505@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net>
Message-ID: <20050329062016.GA18816@kosh.hut.fi>

On Thu, Mar 24, 2005 at 04:16:27PM +0100, Martin Wache wrote:
> The softdevice tries to use the RTC for the A/V sync, I always wanted to 
> add some option to disable this, but I never did. You can disable this 
> by commenting all the lines in mpeg2decoder.c line 411 to 429 ( where it 
> opens /dev/rtc and does the ioctl calls) and add a line like rtc_fd=-1;. 
> The softdevice will then fallback to usleep() timing.
> Or wait until I managed to add an option to disable the RTC timing, I 
> hope that I manage soon.

I hope that you make it possible to enable and disable the RTC timing
while VDR is running.  I really only want to disable the RTC timing for
the short period when the VDR shutdown script is being invoked.

> >Is there any simple and reliable way to control the softdevice playback 
> >mode
> >from vdr.c?
> As far as I now not. But maybe you can the softdevice's setupStore, then 
> it would be possible..

Any hints for that?  I'm not at all familiar with the internals of VDR;
I started building my VDR setup only a couple of months ago.

> Actualy  on the start of vdr the softdevice should start in the same 
> playback mode it was when the vdr was stopped, provided it saved the 
> setupSore, but I never tried that.

That would be an easy workaround and safety option against crashes on
timed recordings.  Unfortunately, softdevice will start playing after reboot,
even if I disable the playback mode and hit 'OK' before hitting the Power
button.  The cropmode setting is properly restored.

> What about this repeatable softdevice crash, was it due to bad signal 
> quality, or something different? If you know how to reproducible crash 
> the softdevice, then please tell us how, so that we can fix it.

I'm sorry, I didn't save that clip.  That was stupid of me, because it was
really in the very first couple of frames of the saved clip.  I suspect it
was a bad signal, or some dropped packets.

Over the weekend, the nvram-wakeup magic worked, and I recorded a 16:9 film.
When I try to edit it (hit 'Pause' and '9' to go to the first edit mark I
managed to set), VDR will hang until the -w timeout, and on subsequent runs,
VDR will crash every time I press a key on the remote - presumably because
DirectFB is not properly uninitialized on the first run.  The remote control
is mapped via DirectFB's linux_input.  I'm using only the subtitles and
softdevice plugins on VDR 1.3.22.  I'll investigate this further.

I've noticed that softdevice doesn't normally react to changes in the aspect
ratio (4:3 or 16:9).  It does react when skipping in one-minute steps.

	Marko


From marko.makela at hut.fi  Tue Mar 29 09:09:40 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 29 Mar 2005 10:09:40 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050329062016.GA18816@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi>
Message-ID: <20050329070940.GB18816@kosh.hut.fi>

On Tue, Mar 29, 2005 at 09:20:16AM +0300, Marko M?kel? wrote:
> Over the weekend, the nvram-wakeup magic worked, and I recorded a 16:9 film.
> When I try to edit it (hit 'Pause' and '9' to go to the first edit mark I
> managed to set), VDR will hang until the -w timeout, and on subsequent runs,
> VDR will crash every time I press a key on the remote - presumably because
> DirectFB is not properly uninitialized on the first run.  The remote control
> is mapped via DirectFB's linux_input.  I'm using only the subtitles and
> softdevice plugins on VDR 1.3.22.  I'll investigate this further.

It seems that it's the fine-tuning of the edit marks with '4' and '6' keys
that will hang VDR.  VDR didn't hang when I let it play those parts of the
clip where the edit marks were set, or when skipping with 1-minute intervals.
I'll try with newer versions of VDR and the softdevice plugin later.  Are
there any hints how to debug VDR, or any documentation on the threads used
by VDR?

	Marko


From nhuillard at e-dition.fr  Tue Mar 29 11:57:45 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 29 Mar 2005 11:57:45 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050329070940.GB18816@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <20050329070940.GB18816@kosh.hut.fi>
Message-ID: <42492699.7060906@e-dition.fr>

Marko M?kel? a ?crit :
> On Tue, Mar 29, 2005 at 09:20:16AM +0300, Marko M?kel? wrote:
> 
>>Over the weekend, the nvram-wakeup magic worked, and I recorded a 16:9 film.
>>When I try to edit it (hit 'Pause' and '9' to go to the first edit mark I
>>managed to set), VDR will hang until the -w timeout, and on subsequent runs,
>>VDR will crash every time I press a key on the remote - presumably because
>>DirectFB is not properly uninitialized on the first run.  The remote control
>>is mapped via DirectFB's linux_input.  I'm using only the subtitles and
>>softdevice plugins on VDR 1.3.22.  I'll investigate this further.
> 
> It seems that it's the fine-tuning of the edit marks with '4' and '6' keys
> that will hang VDR.  VDR didn't hang when I let it play those parts of the
> clip where the edit marks were set, or when skipping with 1-minute intervals.
> I'll try with newer versions of VDR and the softdevice plugin later.  Are
> there any hints how to debug VDR, or any documentation on the threads used
> by VDR?

AFAIK, VDR still has deadlock problems when editing marks (particularly 
4 and 6 keys), and using NPTL instead of Linux threads. Try the latter, 
or confirm you're really using it. I had the same behaviour with the 
vdr-xine plugin.

-- 
NH


From lucianm at users.sourceforge.net  Tue Mar 29 12:32:39 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 29 Mar 2005 12:32:39 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503281921.06851.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <4247FEFC.70809@users.sourceforge.net> <200503281709.38450.stefan@lucke.in-berlin.de> <200503281921.06851.stefan@lucke.in-berlin.de>
Message-ID: <42492EC7.6040404@users.sourceforge.net>

Stefan Lucke wrote:
..
> 
>>But I'll suggest the following change too, as it may have influence
>>on that issue (only compile checked).
> 
> 
> After a short test: first part breaks setting the correct layer
> configuration (set #if 1 to #if 0) .
> 
> I saw no field issues with news ticker of N24, but some problems
> with a transmission of 1+. That was 16:9 downscaled to my 4:3 TV.

I tried you patch with #if 0 but this judder is still there. Don't even 
know now if it's the field parity or what. Maybe DirectFB allows me to 
make screenshots, at leastI've seen some option for the directfbrc file.

Regards,
Lucian




From stefan at lucke.in-berlin.de  Tue Mar 29 16:04:46 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 29 Mar 2005 16:04:46 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <42492EC7.6040404@users.sourceforge.net>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503281921.06851.stefan@lucke.in-berlin.de> <42492EC7.6040404@users.sourceforge.net>
Message-ID: <200503291604.46444.stefan@lucke.in-berlin.de>

On Dienstag, 29. M?rz 2005 12:32, Lucian Muresan wrote:
> Stefan Lucke wrote:
> ..
> > 
> >>But I'll suggest the following change too, as it may have influence
> >>on that issue (only compile checked).
> > 
> > 
> > After a short test: first part breaks setting the correct layer
> > configuration (set #if 1 to #if 0) .
> > 
> > I saw no field issues with news ticker of N24, but some problems
> > with a transmission of 1+. That was 16:9 downscaled to my 4:3 TV.
> 
> I tried you patch with #if 0 but this judder is still there. Don't even 
> know now if it's the field parity or what. Maybe DirectFB allows me to 
> make screenshots, at leastI've seen some option for the directfbrc file.

I don't believe that dfb way of screenshots works.
Whats you tv type 4:3 vs 16:9 ?
If its a 4:3 type, was/is the video shown 4:3 or 16:9 ?
Do you see judder on all channels ? and on each invocation ?
You previously said field parity issue is back. On which exact
version of video-dfb was it gone ?

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Mar 29 16:26:37 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 29 Mar 2005 16:26:37 +0200
Subject: [Softdevice-devel] Pause -> Play
Message-ID: <200503291626.37299.stefan@lucke.in-berlin.de>

Since changes of 2005-03-25 pause -> play transition does not work any more.
The only way is to kill -9 vdr :- (.
Tested that with vdr-1.3.7 too. Same result.
pmVideoOnly is present at vdr-1.3.11 and beyond.

-- 
Stefan Lucke



From torgeir at pobox.com  Tue Mar 29 16:30:07 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 29 Mar 2005 15:30:07 +0100
Subject: [Softdevice-devel] Pause -> Play
In-Reply-To: <200503291626.37299.stefan@lucke.in-berlin.de>
References: <200503291626.37299.stefan@lucke.in-berlin.de>
Message-ID: <1112106607.17123.1.camel@africa.netenviron.com>

On Tue, 2005-03-29 at 16:26 +0200, Stefan Lucke wrote:
> Since changes of 2005-03-25 pause -> play transition does not work any more.
> The only way is to kill -9 vdr :- (.
> Tested that with vdr-1.3.7 too. Same result.
> pmVideoOnly is present at vdr-1.3.11 and beyond.

Are you sure it's only since 2005-3-25? I think i've seen this problem
earlier than that, but only when there is no OSD (position slider)
present. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From lucianm at users.sourceforge.net  Tue Mar 29 16:35:39 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 29 Mar 2005 16:35:39 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503291604.46444.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503281921.06851.stefan@lucke.in-berlin.de> <42492EC7.6040404@users.sourceforge.net> <200503291604.46444.stefan@lucke.in-berlin.de>
Message-ID: <424967BB.6030909@users.sourceforge.net>

Stefan Lucke wrote:
...
> I don't believe that dfb way of screenshots works.
> Whats you tv type 4:3 vs 16:9 ?

It's a standard 4:3 PAL TV.

> If its a 4:3 type, was/is the video shown 4:3 or 16:9 ?

Aspect ration setting is set to "PAL 4:3" or something (I'm at wortk 
right now, don't remember the exact name), and I didn't notice any wrong 
shown aspect, I mean material broadcasted 4:3 looked OK, and on the rare 
16:9 broadcasts, softdevice seems to correctly scale the video.

> Do you see judder on all channels ? and on each invocation ?

On pretty all channels. I always call vdr with the softdevice from a ssh 
session with
vdr -c /etc/vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo:mgatv' 
-P'graphlcd -d noritake800'

> You previously said field parity issue is back. On which exact
> version of video-dfb was it gone ?

Well, I started that thread "CVS from last night feedback  - field 
parity seems to be solved :-) , some audio issues remain" on friday, the 
18.03. I would say it was the previuos version (1.19) of video-dfb.c and 
1.5 of video-dfb.h. But it could also happen that other changed code was 
the reason for that, Martin replied at that time he didn't change 
anything in video-dfb, but in mpeg2decoder.c, maybe rev 1.21 and/or 1.22 
where OK for me at that time.
I think the field parity problem coming back might be related to the 
syncing modifications, I don't know...

In a previous message you said you tested with "Radeon-9200, G550 vga + 
tv-out and G400 as mentioned above. On G400 I've still some problems but 
this is probably caused by the old DFB version on that system (0.9.20)"

Now I'm not getting it, did you test TV-out an both G450 and G400, and 
you see no field parity issues on scrolling newstickers like n24 and the 
like?

Tonight after getting back home from work I'll try to checkout again a 
softdevice CVS as of 18-19 march to see if I was right with the field 
parity, then I'll tell you the exact snapshot I tested if relevant, you 
might then test the very same version on G400 TV-out for yourself, would 
that help? Because for me the modifications spread all over in various 
areas of softdevice are still too complex to get the grand picture in my 
head to diagnose this...

Thank you all for the support,
Lucian


From stefan at lucke.in-berlin.de  Tue Mar 29 19:01:36 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 29 Mar 2005 19:01:36 +0200
Subject: [Softdevice-devel] Pause -> Play
In-Reply-To: <1112106607.17123.1.camel@africa.netenviron.com>
References: <200503291626.37299.stefan@lucke.in-berlin.de> <1112106607.17123.1.camel@africa.netenviron.com>
Message-ID: <200503291901.36175.stefan@lucke.in-berlin.de>

On Dienstag, 29. M?rz 2005 16:30, Torgeir Veimo wrote:
> On Tue, 2005-03-29 at 16:26 +0200, Stefan Lucke wrote:
> > Since changes of 2005-03-25 pause -> play transition does not work any more.
> > The only way is to kill -9 vdr :- (.
> > Tested that with vdr-1.3.7 too. Same result.
> > pmVideoOnly is present at vdr-1.3.11 and beyond.
> 
> Are you sure it's only since 2005-3-25? I think i've seen this problem
> earlier than that, but only when there is no OSD (position slider)
> present. 

Yes I'm sure. Did the the checkout with " .. co -D 2005-03-25 softdevice" 
and that version was ok. The checkout with " .. co -D 2005-03-26 softdevice"
which includes changes from 2005-03-25 was _not_ ok . In that co I had
to comment out the pmVideoOnly case section (vdr-1.3.7).


-- 
Stefan Lucke



From M.Wache at gmx.net  Tue Mar 29 19:08:49 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 29 Mar 2005 19:08:49 +0200
Subject: [Softdevice-devel] Pause -> Play
In-Reply-To: <200503291901.36175.stefan@lucke.in-berlin.de>
References: <200503291626.37299.stefan@lucke.in-berlin.de> <1112106607.17123.1.camel@africa.netenviron.com> <200503291901.36175.stefan@lucke.in-berlin.de>
Message-ID: <42498BA1.4060604@gmx.net>

Stefan Lucke wrote:
> On Dienstag, 29. M?rz 2005 16:30, Torgeir Veimo wrote:
> 
>>On Tue, 2005-03-29 at 16:26 +0200, Stefan Lucke wrote:
>>
>>>Since changes of 2005-03-25 pause -> play transition does not work any more.
>>>The only way is to kill -9 vdr :- (.
>>>Tested that with vdr-1.3.7 too. Same result.
>>>pmVideoOnly is present at vdr-1.3.11 and beyond.
>>
>>Are you sure it's only since 2005-3-25? I think i've seen this problem
>>earlier than that, but only when there is no OSD (position slider)
>>present. 
> 
> 
> Yes I'm sure. Did the the checkout with " .. co -D 2005-03-25 softdevice" 
> and that version was ok. The checkout with " .. co -D 2005-03-26 softdevice"
> which includes changes from 2005-03-25 was _not_ ok . In that co I had
> to comment out the pmVideoOnly case section (vdr-1.3.7).
> 
> 
I think I know what's wrong. In freeze mode vdr continues to send data, 
but no data is consumed, so at some point the buffers of the softdevice 
are full. When the softdevice receives more data in buffer full state it 
will dead lock in cMpeg2Deocder::Decode in the loop.
A fix would be not to accept any data in cMpeg2Deocer when freezeMode is 
true. Can you try this? I'm won't be able to do this before Friday...

Bye,
Martin


From stefan at lucke.in-berlin.de  Tue Mar 29 20:27:11 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 29 Mar 2005 20:27:11 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <424967BB.6030909@users.sourceforge.net>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503291604.46444.stefan@lucke.in-berlin.de> <424967BB.6030909@users.sourceforge.net>
Message-ID: <200503292027.11204.stefan@lucke.in-berlin.de>

On Dienstag, 29. M?rz 2005 16:35, Lucian Muresan wrote:
> Stefan Lucke wrote:
> ...
> > I don't believe that dfb way of screenshots works.
> > Whats you tv type 4:3 vs 16:9 ?
> 
> It's a standard 4:3 PAL TV.
> 
> > If its a 4:3 type, was/is the video shown 4:3 or 16:9 ?
> 
> Aspect ration setting is set to "PAL 4:3" or something (I'm at wortk 
> right now, don't remember the exact name), and I didn't notice any wrong 
> shown aspect, I mean material broadcasted 4:3 looked OK, and on the rare 
> 16:9 broadcasts, softdevice seems to correctly scale the video.
> 
> > Do you see judder on all channels ? and on each invocation ?
> 
> On pretty all channels. I always call vdr with the softdevice from a ssh 
> session with
> vdr -c /etc/vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo:mgatv' 
> -P'graphlcd -d noritake800'
> 
> > You previously said field parity issue is back. On which exact
> > version of video-dfb was it gone ?
> 
> Well, I started that thread "CVS from last night feedback  - field 
> parity seems to be solved :-) , some audio issues remain" on friday, the 
> 18.03. I would say it was the previuos version (1.19) of video-dfb.c and 
> 1.5 of video-dfb.h. But it could also happen that other changed code was 
> the reason for that, Martin replied at that time he didn't change 
> anything in video-dfb, but in mpeg2decoder.c, maybe rev 1.21 and/or 1.22 
> where OK for me at that time.

As Martin I'm of the opinion too, that changes any other module should
have no influence to tv-out via directfb. Interlaced flag and top or
bottom field flag is not taken from stream. It is set allways to
top first in video-dfb.c

> I think the field parity problem coming back might be related to the 
> syncing modifications, I don't know...
> 
> In a previous message you said you tested with "Radeon-9200, G550 vga + 
> tv-out and G400 as mentioned above. On G400 I've still some problems but 
> this is probably caused by the old DFB version on that system (0.9.20)"

A few mails before this, I said I managed to get DFB cvs version compiled
on my G400 tv-out (s-video) system. Forgot to mention that N24 news
ticker looks pretty well on that system now. The only problem is when
16:9 interlaced video is scaled down to 4:3 tv aspect. When setting
sofdevice options to "center cut out", these effects disappear. But
this is a different story.

My G550 tv-out system is on connected to a 7" LCD TV-monitor and looks
well too.

> 
> Now I'm not getting it, did you test TV-out an both G450 and G400, and 
> you see no field parity issues on scrolling newstickers like n24 and the 
> like?
> 
> Tonight after getting back home from work I'll try to checkout again a 
> softdevice CVS as of 18-19 march to see if I was right with the field 
> parity, then I'll tell you the exact snapshot I tested if relevant, you 
> might then test the very same version on G400 TV-out for yourself, would 
> that help? Because for me the modifications spread all over in various 
> areas of softdevice are still too complex to get the grand picture in my 
> head to diagnose this...

For debugging a added interlaced and top/bottom first change reporting.
With result that top_field_first is set allways and that interlaced flag
is unrelaiable (changeing every now and than).

With attached patch you'll get field order changes reported.

Mar 29 20:21:08 jarada vdr[6040]: [VideoOut]: field order changed to TOP field first (1)
Mar 29 20:21:08 jarada vdr[6040]: [VideoOut]: aspect changed (-100 -> 0 ; -100,000000 -> 1,777778)
Mar 29 20:21:08 jarada vdr[6040]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x432]

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: field-order-report-01.diff
Type: text/x-diff
Size: 1077 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050329/7c9fd089/attachment.diff>

From stefan at lucke.in-berlin.de  Tue Mar 29 20:46:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 29 Mar 2005 20:46:05 +0200
Subject: [Softdevice-devel] Pause -> Play
In-Reply-To: <42498BA1.4060604@gmx.net>
References: <200503291626.37299.stefan@lucke.in-berlin.de> <200503291901.36175.stefan@lucke.in-berlin.de> <42498BA1.4060604@gmx.net>
Message-ID: <200503292046.05692.stefan@lucke.in-berlin.de>

On Dienstag, 29. M?rz 2005 19:08, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Dienstag, 29. M?rz 2005 16:30, Torgeir Veimo wrote:
> > 
> >>On Tue, 2005-03-29 at 16:26 +0200, Stefan Lucke wrote:
> >>
> >>>Since changes of 2005-03-25 pause -> play transition does not work any more.
> >>>The only way is to kill -9 vdr :- (.
> >>>Tested that with vdr-1.3.7 too. Same result.
> >>>pmVideoOnly is present at vdr-1.3.11 and beyond.
> >>
> >>Are you sure it's only since 2005-3-25? I think i've seen this problem
> >>earlier than that, but only when there is no OSD (position slider)
> >>present. 
> > 
> > 
> > Yes I'm sure. Did the the checkout with " .. co -D 2005-03-25 softdevice" 
> > and that version was ok. The checkout with " .. co -D 2005-03-26 softdevice"
> > which includes changes from 2005-03-25 was _not_ ok . In that co I had
> > to comment out the pmVideoOnly case section (vdr-1.3.7).
> > 
> > 
> I think I know what's wrong. In freeze mode vdr continues to send data, 
> but no data is consumed, so at some point the buffers of the softdevice 
> are full. When the softdevice receives more data in buffer full state it 
> will dead lock in cMpeg2Deocder::Decode in the loop.
> A fix would be not to accept any data in cMpeg2Deocer when freezeMode is 
> true. Can you try this? I'm won't be able to do this before Friday...

I tried this, but it not that easy as

if (freezeMode)
  return 0;

after "!running" check (around line 1411). Yes I could enter playback mode after pause,
but the player feeds us with data and the time display increases
"current position" faster as in normal playback.


-- 
Stefan Lucke



From M.Wache at gmx.net  Tue Mar 29 20:57:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 29 Mar 2005 20:57:16 +0200
Subject: [Softdevice-devel] Pause -> Play
In-Reply-To: <200503292046.05692.stefan@lucke.in-berlin.de>
References: <200503291626.37299.stefan@lucke.in-berlin.de> <200503291901.36175.stefan@lucke.in-berlin.de> <42498BA1.4060604@gmx.net> <200503292046.05692.stefan@lucke.in-berlin.de>
Message-ID: <4249A50C.4080605@gmx.net>

Stefan Lucke wrote:
> On Dienstag, 29. M?rz 2005 19:08, Martin Wache wrote:
> 
>>Stefan Lucke wrote:
>>
>>>On Dienstag, 29. M?rz 2005 16:30, Torgeir Veimo wrote:
>>>
>>>
>>>>On Tue, 2005-03-29 at 16:26 +0200, Stefan Lucke wrote:
>>>>
>>>>
>>>>>Since changes of 2005-03-25 pause -> play transition does not work any more.
>>>>>The only way is to kill -9 vdr :- (.
>>>>>Tested that with vdr-1.3.7 too. Same result.
>>>>>pmVideoOnly is present at vdr-1.3.11 and beyond.
>>>>
>>>>Are you sure it's only since 2005-3-25? I think i've seen this problem
>>>>earlier than that, but only when there is no OSD (position slider)
>>>>present. 
>>>
>>>
>>>Yes I'm sure. Did the the checkout with " .. co -D 2005-03-25 softdevice" 
>>>and that version was ok. The checkout with " .. co -D 2005-03-26 softdevice"
>>>which includes changes from 2005-03-25 was _not_ ok . In that co I had
>>>to comment out the pmVideoOnly case section (vdr-1.3.7).
>>>
>>>
>>
>>I think I know what's wrong. In freeze mode vdr continues to send data, 
>>but no data is consumed, so at some point the buffers of the softdevice 
>>are full. When the softdevice receives more data in buffer full state it 
>>will dead lock in cMpeg2Deocder::Decode in the loop.
>>A fix would be not to accept any data in cMpeg2Deocer when freezeMode is 
>>true. Can you try this? I'm won't be able to do this before Friday...
> 
> 
> I tried this, but it not that easy as
> 
> if (freezeMode)
>   return 0;
> 
> after "!running" check (around line 1411). Yes I could enter playback mode after pause,
> but the player feeds us with data and the time display increases
> "current position" faster as in normal playback.
> 
> 
I guess this is because in softdevice.c PlayVideo doesn't return 
"result", but always "Length". So vdr thinks we processed the data in 
pause mode, but we actualy didn't

Martin


From jarppa81 at luukku.com  Tue Mar 29 21:31:20 2005
From: jarppa81 at luukku.com (Jari H)
Date: Tue, 29 Mar 2005 22:31:20 +0300 (EEST)
Subject: [Softdevice-devel] Juddering OSD with mgatv output
Message-ID: <1112124680763.jarppa81.133873.ju9F_mLabRisfEzRTJ0h1g@luukku.com>

> vdr -c /etc/vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo:mgatv' 
> -P'graphlcd -d noritake800'

I think that problem could be startup line:
vdr -P"softdevice -vo dfb:mgatv -L /usr/lib/vdr" ...

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From marko.makela at hut.fi  Tue Mar 29 23:26:23 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 30 Mar 2005 00:26:23 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <42492699.7060906@e-dition.fr>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <20050329070940.GB18816@kosh.hut.fi> <42492699.7060906@e-dition.fr>
Message-ID: <20050329212623.GA233600@kosh.hut.fi>

On Tue, Mar 29, 2005 at 11:57:45AM +0200, Nicolas Huillard wrote:

> >It seems that it's the fine-tuning of the edit marks with '4' and '6' keys
> >that will hang VDR.  VDR didn't hang when I let it play those parts of the
> >clip where the edit marks were set, or when skipping with 1-minute 
> >intervals.
> >I'll try with newer versions of VDR and the softdevice plugin later.  Are
> >there any hints how to debug VDR, or any documentation on the threads used
> >by VDR?
> 
> AFAIK, VDR still has deadlock problems when editing marks (particularly 
> 4 and 6 keys), and using NPTL instead of Linux threads. Try the latter, 
> or confirm you're really using it. I had the same behaviour with the 
> vdr-xine plugin.

Thanks for the advice!  After I forced LinuxThreads instead of NPTL, it
worked.  Also the whole played back okay after the clipping.

I really regret that I didn't preserve the corrupted clip that crashed
an earlier version of VDR and the softdevice plugin.  If I remember
correctly, it displayed some error messages or assertion failure about
audio.

By the way, when I first set up VDR, I used an em8300/ADV7175AKS card and the
dxr3 plugin.  There, I had to remove an assertion about malformed audio too,
in order to edit a clip (a different one).  With the dxr3 plugin, playback
is somehow delayed by a couple of seconds, and fine-tuning edit marks doesn't
give any visual feedback until playback is resumed.  I became a softdevice
user, because the card died and replacing the only chip with visible damage
didn't help.

To bring this back on topic: It seems that softdevice-plugin ignores the
softdevice.Suspend = 1 setting in setup.conf at startup, and always starts
with playback enabled.

	Marko


From lucianm at users.sourceforge.net  Wed Mar 30 00:20:53 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 30 Mar 2005 00:20:53 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <1112124680763.jarppa81.133873.ju9F_mLabRisfEzRTJ0h1g@luukku.com>
References: <1112124680763.jarppa81.133873.ju9F_mLabRisfEzRTJ0h1g@luukku.com>
Message-ID: <4249D4C5.5060305@users.sourceforge.net>

Jari H wrote:
>> vdr -c /etc/vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo:mgatv' 
>> -P'graphlcd -d noritake800'
> 
> I think that problem could be startup line:
> vdr -P"softdevice -vo dfb:mgatv -L /usr/lib/vdr" ...

Thanks a lot, that was really enlightening, although the 2 command lines 
work both on my setup (Now I think the one I used should have failed), 
they actually produce different results, see my other post.


From lucianm at users.sourceforge.net  Wed Mar 30 00:20:59 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 30 Mar 2005 00:20:59 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <200503292027.11204.stefan@lucke.in-berlin.de>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503291604.46444.stefan@lucke.in-berlin.de> <424967BB.6030909@users.sourceforge.net> <200503292027.11204.stefan@lucke.in-berlin.de>
Message-ID: <4249D4CB.7080805@users.sourceforge.net>

Stefan Lucke wrote:
...
> For debugging a added interlaced and top/bottom first change reporting.
> With result that top_field_first is set allways and that interlaced flag
> is unrelaiable (changeing every now and than).
> 
> With attached patch you'll get field order changes reported.
> 

Hi Stefan,

thank you for the debug patch. I've seen no filed order changes output 
in my log file. But after Jari H said it could be the command line he 
saw that I posted earlier today, well, yesterday, it's midnight now, I 
checked that damned line again, and I've got interesting news!
I only compiled softdevice with the DFB subplugin, but now I remember it 
once only had generic DFB support, and then the specialized mgatv was 
introduced by you. It happens that I invoked it almost all the time 
wrong (I didn't try it often, my vdr runs mainly in deamon mode for 
scheduled recordings from which I archive to DVDs right now, as I 
thought it wasn't enough WAF-ready to replace my cheap Aldi-receiver 
from last summer). Namely, I invoked it like
vdr ..... -P'softdevice -L /usr/lib/vdr -vo:mgatv'
which I think makes softdevice run on the "generic" directfb code path, 
as mgatv is probably ignored when invoked that way.
Then, after reading Jari's message (thanks a lot!), I invoked it as it 
is supposed to be invoked for Matrox TV-out:
vdr ..... -P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'

So the difference between theese 2 invokationa are that the first one 
gives me judder but synced audio, and the second one, tailored for 
Matrox G4xx TV-out gives me almost perfect video (no more field parity 
issues, just a little jump once in a while, maybe smoe sync-related 
catch-up), but the audio is off-sync again.

I didn't notice the first invocation was wrong, there was no error 
message, but the normal directfb output was chosen (maybe also because 
there is no other subplugin compiled in my case).

Maybe you're now able to find out what makes the non-mgatv code path in 
softdevice succeed in AV-sync and the mgatv path fail. Well, what about 
you, is AV in sync when using -vo dfb:mgatv (and not -vo:mgatv like I did)?

Lucian


From stefan at lucke.in-berlin.de  Wed Mar 30 08:55:21 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 30 Mar 2005 08:55:21 +0200
Subject: [Softdevice-devel] Juddering OSD with mgatv output
In-Reply-To: <4249D4CB.7080805@users.sourceforge.net>
References: <Pine.LNX.4.61.0503232147160.12630@tuomi.oulu.fi> <200503292027.11204.stefan@lucke.in-berlin.de> <4249D4CB.7080805@users.sourceforge.net>
Message-ID: <200503300855.21675.stefan@lucke.in-berlin.de>

On Mittwoch, 30. M?rz 2005 00:20, Lucian Muresan wrote:
> Stefan Lucke wrote:
> ...
> > For debugging a added interlaced and top/bottom first change reporting.
> > With result that top_field_first is set allways and that interlaced flag
> > is unrelaiable (changeing every now and than).
> > 
> > With attached patch you'll get field order changes reported.
> > 
> 
> Hi Stefan,
> 
> thank you for the debug patch. I've seen no filed order changes output 
> in my log file. 

As mpeg2 is most (only) top_field_first, this messages should appear
only once. After startup when we get the first frame.


> from last summer). Namely, I invoked it like
> vdr ..... -P'softdevice -L /usr/lib/vdr -vo:mgatv'

I saw the odd calling line too, but though as you wrote 
"Tonight after getting back home from work .." you just wrote
it down in the wrong way from memory.
Good to have some others on this list who can read carefully.


> Maybe you're now able to find out what makes the non-mgatv code path in 
> softdevice succeed in AV-sync and the mgatv path fail. Well, what about 
> you, is AV in sync when using -vo dfb:mgatv (and not -vo:mgatv like I did)?

I think your framebuffer is running at a higher refreshrate than 50Hz
and we can speed up when we a bit late.

-- 
Stefan Lucke



From M.Wache at gmx.net  Wed Mar 30 21:09:32 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 30 Mar 2005 21:09:32 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050329062016.GA18816@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi>
Message-ID: <424AF96C.8030001@gmx.net>

Marko M?kel? wrote:
> On Thu, Mar 24, 2005 at 04:16:27PM +0100, Martin Wache wrote:
> 
>>The softdevice tries to use the RTC for the A/V sync, I always wanted to 
>>add some option to disable this, but I never did. You can disable this 
>>by commenting all the lines in mpeg2decoder.c line 411 to 429 ( where it 
>>opens /dev/rtc and does the ioctl calls) and add a line like rtc_fd=-1;. 
>>The softdevice will then fallback to usleep() timing.
>>Or wait until I managed to add an option to disable the RTC timing, I 
>>hope that I manage soon.
> 
> 
> I hope that you make it possible to enable and disable the RTC timing
> while VDR is running.  I really only want to disable the RTC timing for
> the short period when the VDR shutdown script is being invoked.
I was about to add a switch the last weekend, but now I'm thinking about 
replacing the RTC timing by an signal triggered timing. I did not check 
the precision of this method yet but it looks very promising to me. So 
maybe we will get rid of the /dev/rtc usage at all.
> 
> 
>>>Is there any simple and reliable way to control the softdevice playback 
>>>mode
>>
>>>from vdr.c?
>>As far as I now not. But maybe you can the softdevice's setupStore, then 
>>it would be possible..
> 
> 
> Any hints for that?  I'm not at all familiar with the internals of VDR;
> I started building my VDR setup only a couple of months ago.
Check vdrs plugin.h/c: basically you should be able to use 
pluginMangager->GetPlugin("softdevice") to get a pointer to the 
softdevice plugin. Then call softdevice->SetupParse("Suspend","1"). 
Check with setup-softdevice.c.

> 
> 
>>Actualy  on the start of vdr the softdevice should start in the same 
>>playback mode it was when the vdr was stopped, provided it saved the 
>>setupSore, but I never tried that.
> 
> 
> That would be an easy workaround and safety option against crashes on
> timed recordings.  Unfortunately, softdevice will start playing after reboot,
> even if I disable the playback mode and hit 'OK' before hitting the Power
> button.  The cropmode setting is properly restored.
> 
> 
Did you try that with the latest CVS? The parsing of the Suspend option 
was missing, I added it a few days after your first mail.
>>What about this repeatable softdevice crash, was it due to bad signal 
>>quality, or something different? If you know how to reproducible crash 
>>the softdevice, then please tell us how, so that we can fix it.
> 
> 
> I'm sorry, I didn't save that clip.  That was stupid of me, because it was
> really in the very first couple of frames of the saved clip.  I suspect it
> was a bad signal, or some dropped packets.
Crashes caused by bad signal a mostly due to ffmpeg, so they are less 
interesting for us. Although we might have some bugs ( or missing 
checks) in our code too, which case crashes on bad signal.

> 
> Over the weekend, the nvram-wakeup magic worked, and I recorded a 16:9 film.
> When I try to edit it (hit 'Pause' and '9' to go to the first edit mark I
> managed to set), VDR will hang until the -w timeout, and on subsequent runs,

Thanks for your report, I'm currently not at home so I can not check it 
and fix it. But this may be related to the pause->play deadlock Stefan 
reported. I will try to fix it as soon as I'm at home again.

Martin


From stefan at lucke.in-berlin.de  Wed Mar 30 22:21:55 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 30 Mar 2005 22:21:55 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
Message-ID: <200503302221.55311.stefan@lucke.in-berlin.de>

Hi,

has anyone tried to modify softdevice that it would accept other
playback formats ? I tried as a hack to feed some DV frames
to our decoder but there was no result.

I'm trying to get DV camorders to cooperate with softdevice.
Right now detection is working, but there are a lot of other TODOs.

Mar 30 22:12:54 jarada vdr[2657]: [AVCHandler] number of connected devices changed 0 -> 1
Mar 30 22:12:54 jarada vdr[2657]:  -- nr 1
Mar 30 22:12:54 jarada vdr[2657]:  -- l(0) (DCR-TRV900E)
Mar 30 22:12:54 jarada vdr[2657]:  -- guid(0800460101633dbf)
Mar 30 22:12:54 jarada vdr[2657]:  -- id (DCR-TRV900E)
Mar 30 22:12:54 jarada vdr[2657]: info: Neues FireWire Ger?t: DCR-TRV900E
Mar 30 22:12:54 jarada kernel: ieee1394: Node added: ID:BUS[0-00:1023]  GUID[0800460101633dbf]
Mar 30 22:12:54 jarada kernel: ieee1394: Node changed: 0-00:1023 -> 0-01:1023

-- 
Stefan Lucke



From M.Wache at gmx.net  Wed Mar 30 22:53:36 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 30 Mar 2005 22:53:36 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <200503302221.55311.stefan@lucke.in-berlin.de>
References: <200503302221.55311.stefan@lucke.in-berlin.de>
Message-ID: <424B11D0.8060401@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> has anyone tried to modify softdevice that it would accept other
> playback formats ? 
Yes, I am working on a player which should be able to play almost all 
fileformats which are supported by libavformat. I tried .mp3 and .avi 
files with mpeg1 and mpeg4, all are working well with my player and the 
softdevice.
Unfortunatly I have to rely on some seek functions which are only 
available for ffmpeg-0.4.9pre1 ( and they already changed the parameters 
of one function in their current CVS )....

Up to now the player supports only very few functions: play, skip 1 
minute forward and skip 1 minute backward. That's all, no OSD support 
(except for choosing the file) and no pause, or fast forward/backward 
etc. yet....

Bye,
Martin


From nhuillard at e-dition.fr  Thu Mar 31 15:12:13 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 31 Mar 2005 15:12:13 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424B11D0.8060401@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net>
Message-ID: <424BF72D.90507@e-dition.fr>

Martin Wache a ?crit :
> Stefan Lucke wrote:
> 
>> Hi,
>>
>> has anyone tried to modify softdevice that it would accept other
>> playback formats ? 
> 
> Yes, I am working on a player which should be able to play almost all 
> fileformats which are supported by libavformat. I tried .mp3 and .avi 
> files with mpeg1 and mpeg4, all are working well with my player and the 
> softdevice.
> Unfortunatly I have to rely on some seek functions which are only 
> available for ffmpeg-0.4.9pre1 ( and they already changed the parameters 
> of one function in their current CVS )....
> 
> Up to now the player supports only very few functions: play, skip 1 
> minute forward and skip 1 minute backward. That's all, no OSD support 
> (except for choosing the file) and no pause, or fast forward/backward 
> etc. yet....

When you say "the player", do you mean that you link vdr-softdevice with 
something else than VDR ?
I so, you seem to be joining one of the goals of the defunct softmpeg 
VDR plug-in + lib, namely "provide a reusable library for software MPEG2 
playback using DirectFB".

How does "playing a DivX using VDR" fits in this scheme ?

-- 
NH


From stefan at lucke.in-berlin.de  Thu Mar 31 17:42:24 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 31 Mar 2005 17:42:24 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424B11D0.8060401@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net>
Message-ID: <200503311742.25030.stefan@lucke.in-berlin.de>

On Mittwoch, 30. M?rz 2005 22:53, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > has anyone tried to modify softdevice that it would accept other
> > playback formats ? 
> Yes, I am working on a player which should be able to play almost all 
> fileformats which are supported by libavformat. I tried .mp3 and .avi 
> files with mpeg1 and mpeg4, all are working well with my player and the 
> softdevice.

Does format recognition apply for file reading only (seeking in file) or
does it work for other "stream format as well ?

> Unfortunatly I have to rely on some seek functions which are only 
> available for ffmpeg-0.4.9pre1 ( and they already changed the parameters 
> of one function in their current CVS )....

There are already defines which depend on ffmpegs internal version
number as: "#if LIBAVCODEC_BUILD > 4686". So we'll get som others ;-) .


-- 
Stefan Lucke



From M.Wache at gmx.net  Thu Mar 31 18:34:00 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 31 Mar 2005 18:34:00 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424BF72D.90507@e-dition.fr>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net> <424BF72D.90507@e-dition.fr>
Message-ID: <424C2678.6090200@gmx.net>

Nicolas Huillard wrote:
> Martin Wache a ?crit :
> 
>> Stefan Lucke wrote:
>>
>>> Hi,
>>>
>>> has anyone tried to modify softdevice that it would accept other
>>> playback formats ? 
>>
>>
>> Yes, I am working on a player which should be able to play almost all 
>> fileformats which are supported by libavformat. I tried .mp3 and .avi 
>> files with mpeg1 and mpeg4, all are working well with my player and 
>> the softdevice.
>> Unfortunatly I have to rely on some seek functions which are only 
>> available for ffmpeg-0.4.9pre1 ( and they already changed the 
>> parameters of one function in their current CVS )....
>>
>> Up to now the player supports only very few functions: play, skip 1 
>> minute forward and skip 1 minute backward. That's all, no OSD support 
>> (except for choosing the file) and no pause, or fast forward/backward 
>> etc. yet....
> 
> 
> When you say "the player", do you mean that you link vdr-softdevice with 
> something else than VDR ?
I seem to have a talent to make you misunderstand me ;-)
No, with "the player" I mean a class which is derived from vdr's 
cPlayer, which reads packets of media files and feeds them to the 
softdevice (just like the dvdplayer does for vdr recordings or the 
dvd-plugin does for dvds). When I started it, it was a hack, but it will 
become a plugin for the vdr to be used with the softdevice.
> I so, you seem to be joining one of the goals of the defunct softmpeg 
> VDR plug-in + lib, namely "provide a reusable library for software MPEG2 
> playback using DirectFB".
No, I wont join these goals. Just being curious and because it is the 
second time you are asking this kind of question: would you like the 
softdevice to become a "reusable library"?
> 
> How does "playing a DivX using VDR" fits in this scheme ?
> 
Well, with my plugin it will be possible to playback divx using the vdr 
and the softdevice as output device. Just like now the mplayer plugin 
does with FF cards.
I'm developing this because right now the mplayer-plugin doesn't work 
with the softdevice. Since ffmpeg anyway supports all commen codecs it's 
    a change of maybe 20 lines in the softdevice to support my 
player-plugin.
Does this answer your questions?

Bye,
Martin



From stefan at lucke.in-berlin.de  Thu Mar 31 19:20:28 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 31 Mar 2005 19:20:28 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424C2678.6090200@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424BF72D.90507@e-dition.fr> <424C2678.6090200@gmx.net>
Message-ID: <200503311920.28897.stefan@lucke.in-berlin.de>

On Donnerstag, 31. M?rz 2005 18:34, Martin Wache wrote:
> Nicolas Huillard wrote:
> > Martin Wache a ?crit :
> > 
> >> Stefan Lucke wrote:
> >>
> >>> Hi,
> >>>
> >>> has anyone tried to modify softdevice that it would accept other
> >>> playback formats ? 
> >>
> >>
> >> Yes, I am working on a player which should be able to play almost all 
> >> fileformats which are supported by libavformat. I tried .mp3 and .avi 
> >> files with mpeg1 and mpeg4, all are working well with my player and 
> >> the softdevice.
> >> Unfortunatly I have to rely on some seek functions which are only 
> >> available for ffmpeg-0.4.9pre1 ( and they already changed the 
> >> parameters of one function in their current CVS )....
> >>
> >> Up to now the player supports only very few functions: play, skip 1 
> >> minute forward and skip 1 minute backward. That's all, no OSD support 
> >> (except for choosing the file) and no pause, or fast forward/backward 
> >> etc. yet....
> > 
> > 
> > When you say "the player", do you mean that you link vdr-softdevice with 
> > something else than VDR ?
> I seem to have a talent to make you misunderstand me ;-)
> No, with "the player" I mean a class which is derived from vdr's 
> cPlayer, which reads packets of media files and feeds them to the 
> softdevice (just like the dvdplayer does for vdr recordings or the 
> dvd-plugin does for dvds). When I started it, it was a hack, but it will 
> become a plugin for the vdr to be used with the softdevice.

Separate plugin ? Is that way easier or the only way, than integrating it direct into
softdevice ?


-- 
Stefan Lucke



From M.Wache at gmx.net  Thu Mar 31 19:24:27 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 31 Mar 2005 19:24:27 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <200503311742.25030.stefan@lucke.in-berlin.de>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net> <200503311742.25030.stefan@lucke.in-berlin.de>
Message-ID: <424C324B.4030903@gmx.net>

Stefan Lucke wrote:

> 
> Does format recognition apply for file reading only (seeking in file) or
> does it work for other "stream format as well ?
I think currently it only works for file reading. In fact I open the 
file in my player-plugin and send only packets to the softdevice. You 
could do it similar, have a look at the DecodePackt method. Auto 
detection of stream files is not that easy (since you can not seek 
there), but I think it can be done.
I will send my player to the list on saturday. Unfortunatly I don't have 
it with me...

> 
> 
>>Unfortunatly I have to rely on some seek functions which are only 
>>available for ffmpeg-0.4.9pre1 ( and they already changed the parameters 
>>of one function in their current CVS )....
> 
> 
> There are already defines which depend on ffmpegs internal version
> number as: "#if LIBAVCODEC_BUILD > 4686". So we'll get som others ;-) .
> 
Yes I know, I just did not have the time to have a look at which version 
the changed it. And I don't like having lots of #ifdefs in the code...


Bye,
Martin


From nhuillard at e-dition.fr  Thu Mar 31 19:25:37 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 31 Mar 2005 19:25:37 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424C2678.6090200@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net> <424BF72D.90507@e-dition.fr> <424C2678.6090200@gmx.net>
Message-ID: <424C3291.2030906@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
> 
>> Martin Wache a ?crit :

...

>>> Up to now the player supports only very few functions: play, skip 1 
>>> minute forward and skip 1 minute backward. That's all, no OSD support 
>>> (except for choosing the file) and no pause, or fast forward/backward 
>>> etc. yet....
>>
>> When you say "the player", do you mean that you link vdr-softdevice 
>> with something else than VDR ?
> 
> I seem to have a talent to make you misunderstand me ;-)
> No, with "the player" I mean a class which is derived from vdr's 
> cPlayer, which reads packets of media files and feeds them to the 
> softdevice (just like the dvdplayer does for vdr recordings or the 
> dvd-plugin does for dvds). When I started it, it was a hack, but it will 
> become a plugin for the vdr to be used with the softdevice.

Please forgive me : I don't know the internals of VDR, class names et al...

>> I so, you seem to be joining one of the goals of the defunct softmpeg 
>> VDR plug-in + lib, namely "provide a reusable library for software 
>> MPEG2 playback using DirectFB".
> 
> No, I wont join these goals. Just being curious and because it is the 
> second time you are asking this kind of question: would you like the 
> softdevice to become a "reusable library"?

I second you : it's not an important goal, since VDR itself is a 
powerful project to stick to.

>> How does "playing a DivX using VDR" fits in this scheme ?
>>
> Well, with my plugin it will be possible to playback divx using the vdr 
> and the softdevice as output device. Just like now the mplayer plugin 
> does with FF cards.
> I'm developing this because right now the mplayer-plugin doesn't work 
> with the softdevice. Since ffmpeg anyway supports all commen codecs it's 
>    a change of maybe 20 lines in the softdevice to support my 
> player-plugin.

The mplayer/mp3 plugin also add a user interface to the cPlayer-based 
player : this means you will have to copy/redevelop this interface too ? 
Maybe not for MP3, because it works as-is.

> Does this answer your questions?

It does ! And it also does answer in a way that pleases me (if that 
matters).
Thanks.

-- 
NH


From M.Wache at gmx.net  Thu Mar 31 19:38:00 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 31 Mar 2005 19:38:00 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <200503311920.28897.stefan@lucke.in-berlin.de>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424BF72D.90507@e-dition.fr> <424C2678.6090200@gmx.net> <200503311920.28897.stefan@lucke.in-berlin.de>
Message-ID: <424C3578.9090802@gmx.net>

Stefan Lucke wrote:

> Separate plugin ? Is that way easier or the only way, than integrating it direct into
> softdevice ?
> 
> 
I think it is the preferable way. I guess not all softdevice users want 
to have a media player integrated in the softdevice, for those who don't 
want an media player everything stays like it was. And those who want to 
have it just have to install the player plugin.
Another point is that the player plugin depends on >ffmpeg-0.4.9pre1 and 
I don't want to raise the dependency of the softdevice to ffmpeg-0.4.9pre1.
And then there are a few things which are easier for a seperate plugin...

Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Mar 31 20:48:21 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 31 Mar 2005 20:48:21 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424C324B.4030903@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <200503311742.25030.stefan@lucke.in-berlin.de> <424C324B.4030903@gmx.net>
Message-ID: <200503312048.21670.stefan@lucke.in-berlin.de>

On Donnerstag, 31. M?rz 2005 19:24, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > 
> > Does format recognition apply for file reading only (seeking in file) or
> > does it work for other "stream format as well ?
> I think currently it only works for file reading. In fact I open the 
> file in my player-plugin and send only packets to the softdevice. You 
> could do it similar, have a look at the DecodePackt method. Auto 
> detection of stream files is not that easy (since you can not seek 
> there), but I think it can be done.

In my case, I know that I'm reading dv, but I think I'll try that with
a separate player class. Perhaps I get in trouble with the
ringbuffer size. DV frames pal are of size 144000 bytes each.
When I remaind ffmpeg logic correct, a dv frame must be fed at once.
I'll see what the results are.

> I will send my player to the list on saturday. Unfortunatly I don't have 
> it with me...

I like to see it.

> > There are already defines which depend on ffmpegs internal version
> > number as: "#if LIBAVCODEC_BUILD > 4686". So we'll get som others ;-) .
> > 
> Yes I know, I just did not have the time to have a look at which version 
> the changed it. And I don't like having lots of #ifdefs in the code...

Me too, but it's sometimes required when internal structures change.

-- 
Stefan Lucke



From M.Wache at gmx.net  Thu Mar 31 21:19:39 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 31 Mar 2005 21:19:39 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424C3291.2030906@e-dition.fr>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net> <424BF72D.90507@e-dition.fr> <424C2678.6090200@gmx.net> <424C3291.2030906@e-dition.fr>
Message-ID: <424C4D4B.1070401@gmx.net>

Nicolas Huillard wrote:

> The mplayer/mp3 plugin also add a user interface to the cPlayer-based 
> player : this means you will have to copy/redevelop this interface too ? 
Yes, I will have to do that. That's the drawback of having an own 
cPlayer... On the other hand it would be not that easy to make the 
mplayer plugin work, and the solution would be different for every video 
out method ( which means also a lot of work, and I guess also some 
changes to the mplayer-plugin would be needed...). And hopefully I don't 
have to do it alone, since I want still to be able to work on the 
softdevice ;-)

> Maybe not for MP3, because it works as-is.
Great! I was about to ask if it's working since I hoped it would work 
after the transition to libavformat parsing. Did you also try the muggle 
plugin?
> 
>> Does this answer your questions?
> 
> 
> It does ! And it also does answer in a way that pleases me (if that 
> matters).
That's nice to hear :-)

Bye,
Martin



From marko.makela at hut.fi  Thu Mar 31 23:04:19 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 1 Apr 2005 00:04:19 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <424AF96C.8030001@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net>
Message-ID: <20050331210419.GB113658@kosh.hut.fi>

On Wed, Mar 30, 2005 at 09:09:32PM +0200, Martin Wache wrote:
> I was about to add a switch the last weekend, but now I'm thinking about 
> replacing the RTC timing by an signal triggered timing. I did not check 
> the precision of this method yet but it looks very promising to me. So 
> maybe we will get rid of the /dev/rtc usage at all.

I hope it won't consume more processing power than the RTC method.  I might
give oprofile a try, because my 900 MHz Celeron system does not seem to be
fast enough for fast moving scenes.  I recently ran oprofile on MySQL 5.0.3
and managed to get some 10% performance improvement for my test case after
some tweaks.

> Check vdrs plugin.h/c: basically you should be able to use
> pluginMangager->GetPlugin("softdevice") to get a pointer to the 
> softdevice plugin. Then call softdevice->SetupParse("Suspend","1"). 
> Check with setup-softdevice.c.

Thanks! Of course, a cleaner way would be to introduce a virtual method
void suspendPlayback(bool) that all plugins could override.  That would
have some chance of being included in some VDR release.  But let's hope
first that you can get rid of /dev/rtc without sacrificing processing
power.

> Did you try that with the latest CVS? The parsing of the Suspend option 
> was missing, I added it a few days after your first mail.

Now I tried the latest CVS on VDR 1.3.22 and 1.3.23, and subtitles-plugin
0.3.7 (http://www.virtanen.org/vdr/subtitles/).  Unfortunately, I don't
see any subtitles with the latest CVS, neither from live stream nor from
recordings.  I updated only the setup parsing code from the CVS version,
and it worked.  On a related note, does softdevice implement the GetSTC
method accurately?  The subtitles plugin needs that for displaying the
subtitles at the right time.  (They are usually transmitted a couple of
seconds before they should be displayed, and now it seems that the
subtitles are displayed too early.)

> Crashes caused by bad signal a mostly due to ffmpeg, so they are less 
> interesting for us. Although we might have some bugs ( or missing 
> checks) in our code too, which case crashes on bad signal.

Well, such crashes affect the overall usability of the product.  I think
it's a design flaw to have assertions fail on garbage input.  It's so likely
to get garbage DVB data.  Next time when I get such a crash, I promise to
save the clip and to analyze it further.

> >When I try to edit it (hit 'Pause' and '9' to go to the first edit mark I
> >managed to set), VDR will hang until the -w timeout, and on subsequent 
> >runs,
> 
> Thanks for your report, I'm currently not at home so I can not check it 
> and fix it. But this may be related to the pause->play deadlock Stefan 
> reported. I will try to fix it as soon as I'm at home again.

As someone suggested, using LinuxThreads instead of NPTL removed the hang.
Does anyone know if this is a bug in NPTL, or just changed semantics that
needs to be accounted for in the code?  I have the impression that also
MySQL prefers LinuxThreads over NPTL, but I don't know exactly why.

	Marko


