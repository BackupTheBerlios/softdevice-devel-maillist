From nhuillard at e-dition.fr  Fri Apr  1 12:16:09 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 01 Apr 2005 12:16:09 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <424C4D4B.1070401@gmx.net>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424B11D0.8060401@gmx.net> <424BF72D.90507@e-dition.fr> <424C2678.6090200@gmx.net> <424C3291.2030906@e-dition.fr> <424C4D4B.1070401@gmx.net>
Message-ID: <424D1F69.2000502@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
> 
>> Maybe not for MP3, because it works as-is.
> 
> Great! I was about to ask if it's working since I hoped it would work 
> after the transition to libavformat parsing. Did you also try the muggle 
> plugin?

Oops : I'll make sure to test *after* that transition... In fact, I 
didn't yet compile softdevice CVS.
I'll try to test muggle : that's the kind of things I can do to help 
(but AFAIR, muggle depends on mysql, which is a too heavy dependecy for 
my taste : I'll check that).

-- 
NH


From nhuillard at e-dition.fr  Fri Apr  1 12:29:33 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 01 Apr 2005 12:29:33 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050331210419.GB113658@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi>
Message-ID: <424D228D.2090504@e-dition.fr>

Marko M?kel? a ?crit :
>>Crashes caused by bad signal a mostly due to ffmpeg, so they are less 
>>interesting for us. Although we might have some bugs ( or missing 
>>checks) in our code too, which case crashes on bad signal.
> 
> Well, such crashes affect the overall usability of the product.  I think
> it's a design flaw to have assertions fail on garbage input.  It's so likely
> to get garbage DVB data.  Next time when I get such a crash, I promise to
> save the clip and to analyze it further.

Feeding softdevice with /dev/random could be a kind of test case... 
Maybe Martin's file player could be used for that.
I'll also provide recordings when I experience crashes.

> As someone suggested, using LinuxThreads instead of NPTL removed the hang.
> Does anyone know if this is a bug in NPTL, or just changed semantics that
> needs to be accounted for in the code?  I have the impression that also
> MySQL prefers LinuxThreads over NPTL, but I don't know exactly why.

There were long threads on the VDR ML (look for Rainer Zocholl, who was 
very active on this).
I think it's changed semantics, along with thread-unsafe code all-over 
VDR which didn't matter with LinuxThreads, but dead-lock with NPTL. 
There was a huge work on this around VDR 1.3.18 or so, but the problem 
is still not completely solved.

-- 
NH


From stefan at lucke.in-berlin.de  Sat Apr  2 10:32:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 2 Apr 2005 10:32:02 +0200
Subject: [Softdevice-devel] Other playback formats than mpeg2 ?
In-Reply-To: <200503312048.21670.stefan@lucke.in-berlin.de>
References: <200503302221.55311.stefan@lucke.in-berlin.de> <424C324B.4030903@gmx.net> <200503312048.21670.stefan@lucke.in-berlin.de>
Message-ID: <200504021032.02286.stefan@lucke.in-berlin.de>

On Donnerstag, 31. M?rz 2005 20:48, Stefan Lucke wrote:
> On Donnerstag, 31. M?rz 2005 19:24, Martin Wache wrote:
> > Stefan Lucke wrote:
> > 
> > > 
> > > Does format recognition apply for file reading only (seeking in file) or
> > > does it work for other "stream format as well ?
> > I think currently it only works for file reading. In fact I open the 
> > file in my player-plugin and send only packets to the softdevice. You 
> > could do it similar, have a look at the DecodePackt method. Auto 
> > detection of stream files is not that easy (since you can not seek 
> > there), but I think it can be done.
> 
> In my case, I know that I'm reading dv, but I think I'll try that with
> a separate player class. Perhaps I get in trouble with the
> ringbuffer size. DV frames pal are of size 144000 bytes each.
> When I remaind ffmpeg logic correct, a dv frame must be fed at once.
> I'll see what the results are.

Ok, managed to get some dv pictures (read from file) on the display.
Audio sample rate is not reported (in my case 32000). Whole clip is
displayed in slow motion. That seems to be related to our ringbuffersize.
After increasing it to cover at least 144000 bytes I get a better view,
but A/V sync is now an issue.

There seems to be a crash at the end of clip. With latest ffmpegs
cvs I got a crash at startup. Even gdb cannot tel useful information.

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 229391 (LWP 2751)]
0x00000000 in ?? ()
(gdb) bt
#0  0x00000000 in ?? ()
(gdb)

Changes to softdevice logic are not that much. Just a call to set a
format, so that mpeg decoder can choose the right for avformat.

cMpeg2Decoder::initStream()

   if (currentFormat == eFmtDV)
     fmt=av_find_input_format("dv");
   else
     fmt=av_find_input_format("mpeg");



-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  2 00:13:11 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 2 Apr 2005 00:13:11 +0200
Subject: Aspect ratio handling [WAS: Re: [Softdevice-devel] Ready for 0.0.9pre1]
In-Reply-To: <200503052038.35042.stefan@lucke.in-berlin.de>
References: <200503052038.35042.stefan@lucke.in-berlin.de>
Message-ID: <200504020013.11870.stefan@lucke.in-berlin.de>

On Samstag, 5. M?rz 2005 20:38, Stefan Lucke wrote:
> On Samstag, 5. M?rz 2005 19:58, Torgeir Veimo wrote:
> > On Fri, 2005-03-04 at 13:11 +0100, Nicolas Huillard wrote:
> > > Stefan Lucke a ?crit :
> > > > Has someone a pending modification or fix ?
> > > > 
> > > > If not, I'll release 0.0.9pre1 tomorrow .
> > 
> > There's still the aspect ratio bug on some channels here which change
> > a/r during commercial breaks. I'll try to get my head around it.
> 
> Is that the short sequence I got from you "T4: The O.C. There is a
> commercial in 16:9 format, followed by the 4:3 main movie. Excerpt from
> log with reported a/r changes:
> Mar  5 20:34:51 jarada vdr[3907]: [VideoOut]: aspect changed (9 -> 14 ; 1,333333 -> 1,777778)
> Mar  5 20:34:51 jarada vdr[3907]: [VideoOut]: 704x576 [0,0 704x576] -> 1024x576 [0,0 1024x576]
> Mar  5 20:34:52 jarada vdr[3908]: buffer usage: 100% (tid=196616)
> Mar  5 20:35:19 jarada vdr[3907]: [VideoOut]: aspect changed (14 -> 9 ; 1,777778 -> 1,333333)
> Mar  5 20:35:19 jarada vdr[3907]: [VideoOut]: 704x576 [0,0 704x576] -> 1024x576 [128,0 768x576]

Have to start here with my answer to compare the log messages.
Yes I've upgraded my ffmpeg's version to current cvs.

[softdevice] ffmpeg version(0.4.9-pre1) build(4751)

They changed something:
Apr  1 23:54:42 jarada vdr[14589]: [VideoOut]: resolution changed: W(720 -> 704); H(576 ->576)
Apr  1 23:54:42 jarada vdr[14589]: [VideoOut]: aspect changed (0 -> 14 ; 1,333333 -> 1,777778)
Apr  1 23:54:42 jarada vdr[14589]: [VideoOut]: 704x576 [0,0 704x576] -> 768x576 [0,72 768x432]
Apr  1 23:55:09 jarada vdr[14589]: [VideoOut]: aspect changed (14 -> 9 ; 1,777778 -> 1,777778)
Apr  1 23:55:09 jarada vdr[14589]: [VideoOut]: 704x576 [88,0 528x576] -> 768x576 [0,0 768x576]

As you see, they report the 2nd part now as 16:9 instead of 4:3 formerly.

-- 
Stefan Lucke



From marko.makela at hut.fi  Fri Apr  1 23:51:10 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 2 Apr 2005 00:51:10 +0300
Subject: [Softdevice-devel] Thoughts on testing and standards compliance
In-Reply-To: <424D228D.2090504@e-dition.fr>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424D228D.2090504@e-dition.fr>
Message-ID: <20050401215110.GB64921@kosh.hut.fi>

On Fri, Apr 01, 2005 at 12:29:33PM +0200, Nicolas Huillard wrote:
> Marko M??kel?? a ??crit :
> >>Crashes caused by bad signal a mostly due to ffmpeg, so they are less 
> >>interesting for us. Although we might have some bugs ( or missing 
> >>checks) in our code too, which case crashes on bad signal.
> >
> >Well, such crashes affect the overall usability of the product.  I think
> >it's a design flaw to have assertions fail on garbage input.  It's so 
> >likely
> >to get garbage DVB data.  Next time when I get such a crash, I promise to
> >save the clip and to analyze it further.
> 
> Feeding softdevice with /dev/random could be a kind of test case... 
> Maybe Martin's file player could be used for that.

If softdevice won't crash easily on entirely random byte streams, the
likelihood of crashing could be improved by making the stream look more
valid, in the spirit of this posting:
http://www.securityfocus.com/archive/1/378632/2004-10-15/2004-10-21/0
For instance, if there are any headers or trailers in the MPEG PES packets,
make them valid, but replace some or all of the payload with random bytes,
or insert, delete or transpose some bytes in the payload.

> There were long threads on the VDR ML (look for Rainer Zocholl, who was 
> very active on this).
> I think it's changed semantics, along with thread-unsafe code all-over 
> VDR which didn't matter with LinuxThreads, but dead-lock with NPTL. 
> There was a huge work on this around VDR 1.3.18 or so, but the problem 
> is still not completely solved.

Thanks, I suspected something like that.  I'm not sure if I found the
discussion you mentioned, but I found a long thread where he participated.
This message from Klaus is a bit alarming, as he doesn't seem interested
in these problems: http://linvdr.org/mailinglists/vdr/2004/11/msg00778.html
Another thing that caught my attention when I installed VDR for the first time
was the lack of UTF-8 support.

This is not the first time I encounter the "we don't support that platform"
attitude.  I think it's best to try to follow standards as closely as possible
with reasonable effort, and to test against as many implementations as
possible.  That increases the overall quality and helps to identify rarely
occurring bugs.

Well, excluding font bitmaps, VDR is only about 30,000 lines of code.  It
shouldn't be too hard to implement something similar based on softdevice and
budget cards like the Hauppauge Nova-T.  I'd like to have an easy to use
media station that allows simple DV editing and DVD authoring in addition to
recording, editing and playing DVB streams.  If VDR makes some inherent
assumptions about the stream format being MPEG, this may be too hard to
implement in the VDR framework.  But then again, the DV editing and DVD
authoring are not needed very often, and existing software for those tasks
is probably much more efficient to use than what can be achieved with a
remote control.

	Marko


From M.Wache at gmx.net  Sat Apr  2 16:32:31 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 02 Apr 2005 16:32:31 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050331210419.GB113658@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi>
Message-ID: <424EACFF.1080505@gmx.net>

Marko M?kel? wrote:
>
> I hope it won't consume more processing power than the RTC method.  I might
> give oprofile a try, because my 900 MHz Celeron system does not seem to be
> fast enough for fast moving scenes.  I recently ran oprofile on MySQL 5.0.3
> and managed to get some 10% performance improvement for my test case after
> some tweaks.
Go ahead, if there is an easy way to improve the performance of the 
softdevice we will certainly accept a patch.
What I was thinking about to introduce at some point is direct 
rendering, i.e. let ffmpeg write directly to the video memory. That 
would save some time since there would be no need of copying the 
pictures any more, but I want to finish the audio things first...

> Thanks! Of course, a cleaner way would be to introduce a virtual method
> void suspendPlayback(bool) that all plugins could override.  That would
> have some chance of being included in some VDR release. 
I doubt that a function like that would be included in the VDR. I think 
there was a discussion about this kind of function some time ago..

> 
> Now I tried the latest CVS on VDR 1.3.22 and 1.3.23, and subtitles-plugin
> 0.3.7 (http://www.virtanen.org/vdr/subtitles/).  Unfortunately, I don't
> see any subtitles with the latest CVS, neither from live stream nor from
> recordings.  I updated only the setup parsing code from the CVS version,
> and it worked.  
Just to be sure that I understand correctly: before the setup parsing 
update the subtitles plugin was working and now it's not working 
anymore? Strange, that's hard to explain. Did you try to go back to the 
old version?
On a related note, does softdevice implement the GetSTC
> method accurately?  The subtitles plugin needs that for displaying the
> subtitles at the right time.  (They are usually transmitted a couple of
> seconds before they should be displayed, and now it seems that the
> subtitles are displayed too early.)
> 
I thought GetSTC was implemented correctly, but I may be wrong. By the 
way I experienced an similar effect with subtitles in dvds, but I did 
not investigate it further...

> 
>>Crashes caused by bad signal a mostly due to ffmpeg, so they are less 
>>interesting for us. Although we might have some bugs ( or missing 
>>checks) in our code too, which case crashes on bad signal.
> 
> 
> Well, such crashes affect the overall usability of the product.  I think
> it's a design flaw to have assertions fail on garbage input.  It's so likely
> to get garbage DVB data.  Next time when I get such a crash, I promise to
> save the clip and to analyze it further.
I guess you are right. Every crash we can avoid it's worth working on it.

Bye,
Martin


From M.Wache at gmx.net  Mon Apr  4 12:04:00 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 04 Apr 2005 12:04:00 +0200
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file player for vdr with softdevice
Message-ID: <42511110.5000703@gmx.net>

Unfortunatly the sofdevice mailing list was down again during the 
weekend and did not accept this e-mail. So here I send it again...

Hi all,

so here is the first version of my media player for the vdr with
softdevice as output device. It plays .avi with various codecs (if
supported by ffmpeg) and .mp3.

It should compile together with >ffmpeg-0.4.9pre1 and  any recent vdr
version, but you will need the latest CVS version of the softdevice.
There is no chek for the softdevice version yet! So please make sure
that you checkout the latest version (from _today_ !) if you want to try
the plugin.

Have fun,

Martin

PS: Stefan and me have started a discussion wether to include this 
SoftPlay plugin into the SoftDevice while the mailing list was down...
Now I'm curious what you think about this. Basicly there are two ways:

-Include everything in the softdevice (only one plugin) and have compile
  options to decide what to be build.

-Seperate plugins: a softdevice mostly like it is now, and have a
  seperate plugin which implements the player capabilities.

Stefan prefers the first possibility, I prefer the first.
Which way would do you like better?

Bye,
Martin

-------------- next part --------------
A non-text attachment was scrubbed...
Name: vdr-softplay-0.0.1.tgz
Type: application/x-gzip
Size: 12127 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050404/482e0dea/attachment.bin>

From torgeir at pobox.com  Mon Apr  4 12:20:26 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 11:20:26 +0100
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file
	player for vdr with softdevice
In-Reply-To: <42511110.5000703@gmx.net>
References: <42511110.5000703@gmx.net>
Message-ID: <1112610026.26085.0.camel@africa>

On Mon, 2005-04-04 at 12:04 +0200, Martin Wache wrote:
> Unfortunatly the sofdevice mailing list was down again during the 
> weekend and did not accept this e-mail. So here I send it again...

I guess this also means the cvs commit list is down.

> so here is the first version of my media player for the vdr with
> softdevice as output device. It plays .avi with various codecs (if
> supported by ffmpeg) and .mp3.

Are you considering dvd support (w menus) as well? 

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Mon Apr  4 12:49:55 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 04 Apr 2005 12:49:55 +0200
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file player
 for vdr with softdevice
In-Reply-To: <42511110.5000703@gmx.net>
References: <42511110.5000703@gmx.net>
Message-ID: <42511BD3.9080105@e-dition.fr>

Martin Wache a ?crit :
> so here is the first version of my media player for the vdr with
> softdevice as output device. It plays .avi with various codecs (if
> supported by ffmpeg) and .mp3.

Great ! Congratulations !

> PS: Stefan and me have started a discussion wether to include this 
> SoftPlay plugin into the SoftDevice while the mailing list was down...
> Now I'm curious what you think about this. Basicly there are two ways:
> 
> -Include everything in the softdevice (only one plugin) and have compile
>  options to decide what to be build.
> 
> -Seperate plugins: a softdevice mostly like it is now, and have a
>  seperate plugin which implements the player capabilities.
> 
> Stefan prefers the first possibility, I prefer the first.
> Which way would do you like better?

 From the packager's point of view, I think the second solution would be 
a little better (don't have to create two packages : just compile 
everything, and let the user decide if he actually loads the player)
But it's not that important, in fact...
The real question seems to be : who will actually *not* want to have a 
media-player-capable softdevice VDR ? I mean, in the softdevice context, 
where you use the full-featured VGA card instead of the limited MPEG 
output of the DVB card, will there be a lot of people not wanting to 
view Divx, especially since VGA output is *the* way to view Divx ?

-- 
NH


From nhuillard at e-dition.fr  Mon Apr  4 14:44:56 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 04 Apr 2005 14:44:56 +0200
Subject: [Softdevice-devel] Thoughts on testing and standards compliance
In-Reply-To: <20050401215110.GB64921@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424D228D.2090504@e-dition.fr> <20050401215110.GB64921@kosh.hut.fi>
Message-ID: <425136C8.20102@e-dition.fr>

Marko M?kel? a ?crit :
> On Fri, Apr 01, 2005 at 12:29:33PM +0200, Nicolas Huillard wrote:

>>There were long threads on the VDR ML (look for Rainer Zocholl, who was 
>>very active on this).
>>I think it's changed semantics, along with thread-unsafe code all-over 
>>VDR which didn't matter with LinuxThreads, but dead-lock with NPTL. 
>>There was a huge work on this around VDR 1.3.18 or so, but the problem 
>>is still not completely solved.
> 
> Thanks, I suspected something like that.  I'm not sure if I found the
> discussion you mentioned, but I found a long thread where he participated.
> This message from Klaus is a bit alarming, as he doesn't seem interested
> in these problems: http://linvdr.org/mailinglists/vdr/2004/11/msg00778.html
> Another thing that caught my attention when I installed VDR for the first time
> was the lack of UTF-8 support.

UTF-8 is something Klaus does not like. I also think that DVB did not 
standardized over it, and simply uses 8-bit character sets (maybe 
sometimes without even transmiting which character set is used, which 
poses problems in some countries).

> This is not the first time I encounter the "we don't support that platform"
> attitude.  I think it's best to try to follow standards as closely as possible
> with reasonable effort, and to test against as many implementations as
> possible.  That increases the overall quality and helps to identify rarely
> occurring bugs.

WRT NTPL, the fact is that Klaus does not support that platform. But he 
will accept patches from anyone who can provide validated ones. The 
patch provider will also have to be trusted, thus prove his skills... 
The required level is quite high here, specially since the problem to 
solve is very hard and Klaus won't accept to compromise VDR's stability 
in the "normal" case.

WTR UTF8, Klaus simply does not like it, and see the need to add many 
transcoding frontiers to add in the core of VDR. The case is currently 
"let the user select which 8-bit character set he prefers". UTF8 would 
add transcoding from DVB streams, from and to files, etc. Many 
"unnecessary" steps (I regularly use UTF8, so I know what steps it 
involves when you have to exchange data with other systems).

> Well, excluding font bitmaps, VDR is only about 30,000 lines of code.  It
> shouldn't be too hard to implement something similar based on softdevice and
> budget cards like the Hauppauge Nova-T.

Well, that's still a lot of lines ! When I thought about what VDR really 
is, or what is could be replaced by (reasoning in terms of what 
libraries/programs provide the same core functionnality), I deduced that 
it's not that much (live TV = xine/mplayer, timer = cron, EPG = DB + 
scripting, recordings = xine/mplayer, OSD = the glue, etc...)
But the real value of VDR is the fact that it's expandable, really 
integrated, bug-free, has very few dependencies, has a strong community, 
attracts many developers, thus new plug-ins, etc.

> I'd like to have an easy to use
> media station that allows simple DV editing and DVD authoring in addition to
> recording, editing and playing DVB streams.  If VDR makes some inherent
> assumptions about the stream format being MPEG, this may be too hard to
> implement in the VDR framework.

Throwing the whole VDR just because the stream format is not expandable 
is not the solution.
Many people have ideas about improvements to VDR. I think the best bet 
is to wait for the 1.4 release and try to convince Klaus about some core 
things to add during the 1.5 cycle : some think about networking 
(multiple clients connected to a single VDR server), some think about 
streaming to anonymous clients, some think about handling more formats, 
some think about HDTV, etc.
I hope 1.5 will begin with a big brainstorming session !

> But then again, the DV editing and DVD
> authoring are not needed very often, and existing software for those tasks
> is probably much more efficient to use than what can be achieved with a
> remote control.

I also wanted to do too much with my VDR : many things *could* be done 
with a remote/OSD, but some are much better with a mouse, a 
hi-resolution screen, and stable software.

-- 
NH


From torgeir at pobox.com  Mon Apr  4 19:45:33 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 18:45:33 +0100
Subject: [Softdevice-devel] crash with latest cvs code
Message-ID: <1112636733.5044.3.camel@africa>

[XvVideoOut]: using area size 2048 x 2048
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
[New Thread 114696 (LWP 5510)]
[New Thread 131081 (LWP 5511)]
[New Thread 147466 (LWP 5513)]
CMD[2932]:SetPlayMode PmAudioVideo
CMD[2932]:Start IsSuspended 0
init put byte finished
[New Thread 163851 (LWP 5515)]
CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
BUF[3213]:av_read_frame start
BUF[3213]:read_packet: StreamBuffer: 0
[New Thread 180236 (LWP 5517)]
[Thread 131081 (LWP 5511) exited]
CMD[5861]:Stop
BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
CMD[5878]:Thread beendet : mpegDecoder pid 5515
[Thread 163851 (LWP 5515) exited]
CMD[5883]:Stop finished
GetSpuDecoder 0
[Thread 180236 (LWP 5517) exited]
[Thread 147466 (LWP 5513) exited]
[New Thread 196617 (LWP 5518)]
[New Thread 213002 (LWP 5519)]
CMD[6005]:SetPlayMode PmAudioVideo
CMD[6005]:Start IsSuspended 0
init put byte finished
[New Thread 229387 (LWP 5520)]
CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
BUF[6011]:av_read_frame start
BUF[6011]:read_packet: StreamBuffer: 0
[New Thread 245772 (LWP 5521)]
BUF[6408]:Decode b32eec88, Length 2048
BUF[6409]:Deocde finished
BUF[6409]:Decode b32efc88, Length 2048
BUF[6409]:Deocde finished
BUF[6409]:Decode b32f0488, Length 2048
BUF[6409]:Deocde finished
BUF[6409]:Decode b32f0c88, Length 2048
BUF[6409]:Deocde finished
BUF[6409]:Decode b32f1488, Length 2048
BUF[6409]:Deocde finished
BUF[6409]:Decode b32f1c88, Length 2048
BUF[6409]:Deocde finished
BUF[6418]:read_packet: sleeping while data (12288) in buffer
BUF[6418]:read_packet: got 12280 bytes
BUF[6418]:got packet from av_read_frame!
BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 229387 (LWP 5520)]
0xb78668af in cMpeg2Decoder::QueuePacket ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
(gdb) ba
#0  0xb78668af in cMpeg2Decoder::QueuePacket ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
#1  0xb7866c98 in cMpeg2Decoder::Action ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
#2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
thread.c:227
#3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
#4  0xb7f69e51 in pthread_start_thread_event ()
from /lib/i686/libpthread.so.0
#5  0xb7e0913a in clone () from /lib/i686/libc.so.6
(gdb)

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Mon Apr  4 21:20:51 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 04 Apr 2005 21:20:51 +0200
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <1112636733.5044.3.camel@africa>
References: <1112636733.5044.3.camel@africa>
Message-ID: <42519393.6060005@gmx.net>

Torgeir Veimo wrote:
> [XvVideoOut]: using area size 2048 x 2048
> Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> cSoftDevice::MakePrimaryDevice
> [New Thread 114696 (LWP 5510)]
> [New Thread 131081 (LWP 5511)]
> [New Thread 147466 (LWP 5513)]
> CMD[2932]:SetPlayMode PmAudioVideo
> CMD[2932]:Start IsSuspended 0
> init put byte finished
> [New Thread 163851 (LWP 5515)]
> CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
> BUF[3213]:av_read_frame start
> BUF[3213]:read_packet: StreamBuffer: 0
> [New Thread 180236 (LWP 5517)]
> [Thread 131081 (LWP 5511) exited]
> CMD[5861]:Stop
> BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
> CMD[5878]:Thread beendet : mpegDecoder pid 5515
> [Thread 163851 (LWP 5515) exited]
> CMD[5883]:Stop finished
> GetSpuDecoder 0
> [Thread 180236 (LWP 5517) exited]
> [Thread 147466 (LWP 5513) exited]
> [New Thread 196617 (LWP 5518)]
> [New Thread 213002 (LWP 5519)]
> CMD[6005]:SetPlayMode PmAudioVideo
> CMD[6005]:Start IsSuspended 0
> init put byte finished
> [New Thread 229387 (LWP 5520)]
> CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
> BUF[6011]:av_read_frame start
> BUF[6011]:read_packet: StreamBuffer: 0
> [New Thread 245772 (LWP 5521)]
> BUF[6408]:Decode b32eec88, Length 2048
> BUF[6409]:Deocde finished
> BUF[6409]:Decode b32efc88, Length 2048
> BUF[6409]:Deocde finished
> BUF[6409]:Decode b32f0488, Length 2048
> BUF[6409]:Deocde finished
> BUF[6409]:Decode b32f0c88, Length 2048
> BUF[6409]:Deocde finished
> BUF[6409]:Decode b32f1488, Length 2048
> BUF[6409]:Deocde finished
> BUF[6409]:Decode b32f1c88, Length 2048
> BUF[6409]:Deocde finished
> BUF[6418]:read_packet: sleeping while data (12288) in buffer
> BUF[6418]:read_packet: got 12280 bytes
> BUF[6418]:got packet from av_read_frame!
> BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
> 
> Program received signal SIGSEGV, Segmentation fault.
> [Switching to Thread 229387 (LWP 5520)]
> 0xb78668af in cMpeg2Decoder::QueuePacket ()
>    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> (gdb) ba
> #0  0xb78668af in cMpeg2Decoder::QueuePacket ()
>    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> #1  0xb7866c98 in cMpeg2Decoder::Action ()
>    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> #2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
> thread.c:227
> #3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
> #4  0xb7f69e51 in pthread_start_thread_event ()
> from /lib/i686/libpthread.so.0
> #5  0xb7e0913a in clone () from /lib/i686/libc.so.6
> (gdb)
> 

Sorry, right now I can't say why this happend. Can you tell me a bit 
more about how you produced this crash? Is it reproducible? Can you 
print the line where the softdevice crashed? Did you check the messages 
in the syslog?

Bye,
Martin


From marko.makela at hut.fi  Mon Apr  4 22:44:17 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 4 Apr 2005 23:44:17 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <424EACFF.1080505@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net>
Message-ID: <20050404204417.GA463081@kosh.hut.fi>

On Sat, Apr 02, 2005 at 04:32:31PM +0200, Martin Wache wrote:
> Go ahead, if there is an easy way to improve the performance of the 
> softdevice we will certainly accept a patch.
> What I was thinking about to introduce at some point is direct 
> rendering, i.e. let ffmpeg write directly to the video memory. That 
> would save some time since there would be no need of copying the 
> pictures any more, but I want to finish the audio things first...

It would be helpful to link libvdr-softdevice-dfb.so and libvdr-softdevice.so
statically with the vdr executable, so that complete stack traces can be
obtained.  For some reason, I was unable to get oprofile's opstack to work
yet.  (I had similar problems on other systems, so that's nothing new.)
Thus, I got the statistics for "vdr" and the softdevice libraries separately.
Here is the top for vdr when playing live stream:

CPU: PIII, speed 906.845 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 9000
samples  %        symbol name
11330    14.0482  cRemux::ScanVideoPacket(unsigned char const*, int, int, unsigned char&)
8735     10.8306  cSchedule::GetEvent(unsigned short, long) const
5337      6.6174  SI::CRC32::crc32(char const*, int, unsigned int)
3364      4.1711  cSectionHandler::Action()
2618      3.2461  cChannels::GetByChannelID(tChannelID, bool, bool)
2286      2.8344  cDevice::Action()
2055      2.5480  cTS2PES::instant_repack(unsigned char const*, int)
1813      2.2480  cSchedules::GetSchedule(tChannelID) const
1789      2.2182  cRingBufferLinear::Put(unsigned char const*, int)
1568      1.9442  cRingBuffer::UpdatePercentage(int)
[truncated]

And here is the list for libvdr-softdevice-dfb:

samples  %        symbol name
9980     84.3832  cDFBVideoOut::YUV(unsigned char*, unsigned char*, unsigned char*, int, int, int, int)
581       4.9125  cVideoOut::CheckAspectDimensions(AVFrame*, AVCodecContext*)
453       3.8302  cDFBVideoOut::SetParams()
425       3.5935  cVideoOut::CheckAspect(int, float)
343       2.9001  cDFBRemote::Action()
45        0.3805  cDFBVideoOut::ProcessEvents()
[complete list]

Finally, here is the list for libvdr-softdevice:

samples  %        symbol name
2986     26.1219  cVideoStreamDecoder::DecodePacket(AVPacket*)
1320     11.5475  cStreamDecoder::Action()
1083      9.4742  cMpeg2Decoder::read_packet(unsigned char*, int)
956       8.3632  cAudioStreamDecoder::DecodePacket(AVPacket*)
740       6.4736  cRelTimer::GetRelTime()
533       4.6628  cSoftRingBufferLinear::Available()
466       4.0766  cPacketQueue::PutPacket(AVPacket const&)
433       3.7879  cMpeg2Decoder::Action()
426       3.7267  cMpeg2Decoder::DecodePacket(AVFormatContext const*, AVPacket&)347       3.0356  cAlsaAudioOut::SetParams(SampleContext&)
323       2.8256  cAlsaAudioOut::Write(unsigned char*, int)
301       2.6332  cAudioStreamDecoder::GetPTS()
265       2.3183  cPacketQueue::GetReadPacket()
223       1.9508  cClock::GetPTS()
[truncated]

It seems that the percentages are relative to that executable only.  But the
numbers of samples should be global.  So, even though cDFBVideoOut::YUV()
seems to consume a large percentage of CPU cycles, at 9980 samples it's
behind cRemux::ScanVideoPacket(), which has been sampled 11330 times.

It'd be really helpful to link the plugins statically to vdr, because then
the percentage figures could be compared directly, and also stack traces would
look more meaningful.  How can that be done?

If you want to play with oprofile yourself, be sure to enable the following
in the kernel:
CONFIG_X86_UP_APIC=y
CONFIG_X86_UP_IOAPIC=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y
You may also need to add "lapic" to the kernel command line.  Otherwise,
oprofile will fall back to using a generic timer, which is not very useful
and does not even seem to work.

I did another profiling run when playing a recorded stream.  All charts were
quite different.  So, the profiling run definitely has to be repeatable
(always playing the same stream) in order to get meaningful results.

By the way, selecting YUY2 pixel format seems to hang some VDR thread after
hitting OK: neither the remote control nor the svdrp connection do nothing,
and the watchdog timer will expire.  It looks like I420 is the appropriate
format for my MGA G450 card.

> >Thanks! Of course, a cleaner way would be to introduce a virtual method
> >void suspendPlayback(bool) that all plugins could override.  That would
> >have some chance of being included in some VDR release. 
> I doubt that a function like that would be included in the VDR. I think 
> there was a discussion about this kind of function some time ago..

Okay.  Anyway, this will not be needed if you can figure out how to get
the timing right without using the RTC device.

> >Now I tried the latest CVS on VDR 1.3.22 and 1.3.23, and subtitles-plugin
> >0.3.7 (http://www.virtanen.org/vdr/subtitles/).  Unfortunately, I don't
> >see any subtitles with the latest CVS, neither from live stream nor from
> >recordings.  I updated only the setup parsing code from the CVS version,
> >and it worked.  
> Just to be sure that I understand correctly: before the setup parsing 
> update the subtitles plugin was working and now it's not working 
> anymore? Strange, that's hard to explain. Did you try to go back to the 
> old version?

I have a snapshot "softdevice-work.tar.gz" from about 3 weeks ago, which
I guess I downloaded from
http://www.lucke.in-berlin.de/vdr-softdevice-work.tar.gz when the berlios
server was unavailable.  (It worked on Saturday but didn't on Sunday, or
something like that.)

The CVS snapshot I took on March 31 didn't display any subtitles.  I haven't
tried a more recent CVS snapshot yet.  So, I took the old snapshot and
patched the setup parsing code there.

> On a related note, does softdevice implement the GetSTC
> >method accurately?  The subtitles plugin needs that for displaying the
> >subtitles at the right time.  (They are usually transmitted a couple of
> >seconds before they should be displayed, and now it seems that the
> >subtitles are displayed too early.)
> >
> I thought GetSTC was implemented correctly, but I may be wrong. By the 
> way I experienced an similar effect with subtitles in dvds, but I did 
> not investigate it further...

Of course, it could also be a problem in the stream itself.  I haven't seen
subtitles in any other DVB-T receiver, so I can't say for sure.  The
subtitles seem to work much better in softdevice than dxr3, where the
subtitles often appear in bursts.  However, sometimes the subtitles
could be one or two seconds too early.

Finally, I noticed another interesting thing: the subtitles will continue to
change, even if playback is suspended!

	Marko


From torgeir at pobox.com  Mon Apr  4 23:29:58 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 22:29:58 +0100
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <42519393.6060005@gmx.net>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net>
Message-ID: <1112650198.5044.13.camel@africa>

On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> > [XvVideoOut]: using area size 2048 x 2048
> > Subplugin successfully opend
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > cSoftDevice::MakePrimaryDevice
> > [New Thread 114696 (LWP 5510)]
> > [New Thread 131081 (LWP 5511)]
> > [New Thread 147466 (LWP 5513)]
> > CMD[2932]:SetPlayMode PmAudioVideo
> > CMD[2932]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 163851 (LWP 5515)]
> > CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
> > BUF[3213]:av_read_frame start
> > BUF[3213]:read_packet: StreamBuffer: 0
> > [New Thread 180236 (LWP 5517)]
> > [Thread 131081 (LWP 5511) exited]
> > CMD[5861]:Stop
> > BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
> > CMD[5878]:Thread beendet : mpegDecoder pid 5515
> > [Thread 163851 (LWP 5515) exited]
> > CMD[5883]:Stop finished
> > GetSpuDecoder 0
> > [Thread 180236 (LWP 5517) exited]
> > [Thread 147466 (LWP 5513) exited]
> > [New Thread 196617 (LWP 5518)]
> > [New Thread 213002 (LWP 5519)]
> > CMD[6005]:SetPlayMode PmAudioVideo
> > CMD[6005]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 229387 (LWP 5520)]
> > CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
> > BUF[6011]:av_read_frame start
> > BUF[6011]:read_packet: StreamBuffer: 0
> > [New Thread 245772 (LWP 5521)]
> > BUF[6408]:Decode b32eec88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32efc88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6418]:read_packet: sleeping while data (12288) in buffer
> > BUF[6418]:read_packet: got 12280 bytes
> > BUF[6418]:got packet from av_read_frame!
> > BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
> > 
> > Program received signal SIGSEGV, Segmentation fault.
> > [Switching to Thread 229387 (LWP 5520)]
> > 0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > (gdb) ba
> > #0  0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #1  0xb7866c98 in cMpeg2Decoder::Action ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
> > thread.c:227
> > #3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
> > #4  0xb7f69e51 in pthread_start_thread_event ()
> > from /lib/i686/libpthread.so.0
> > #5  0xb7e0913a in clone () from /lib/i686/libc.so.6
> > (gdb)
> > 
> 
> Sorry, right now I can't say why this happend. Can you tell me a bit 
> more about how you produced this crash? Is it reproducible? Can you 
> print the line where the softdevice crashed? Did you check the messages 
> in the syslog?

Yes, reproducible. Happens when starting up vdr. I'll see what's in the
syslog..

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Mon Apr  4 23:46:45 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 22:46:45 +0100
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <42519393.6060005@gmx.net>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net>
Message-ID: <1112651205.5044.22.camel@africa>

On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> > [XvVideoOut]: using area size 2048 x 2048
> > Subplugin successfully opend
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > cSoftDevice::MakePrimaryDevice
> > [New Thread 114696 (LWP 5510)]
> > [New Thread 131081 (LWP 5511)]
> > [New Thread 147466 (LWP 5513)]
> > CMD[2932]:SetPlayMode PmAudioVideo
> > CMD[2932]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 163851 (LWP 5515)]
> > CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
> > BUF[3213]:av_read_frame start
> > BUF[3213]:read_packet: StreamBuffer: 0
> > [New Thread 180236 (LWP 5517)]
> > [Thread 131081 (LWP 5511) exited]
> > CMD[5861]:Stop
> > BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
> > CMD[5878]:Thread beendet : mpegDecoder pid 5515
> > [Thread 163851 (LWP 5515) exited]
> > CMD[5883]:Stop finished
> > GetSpuDecoder 0
> > [Thread 180236 (LWP 5517) exited]
> > [Thread 147466 (LWP 5513) exited]
> > [New Thread 196617 (LWP 5518)]
> > [New Thread 213002 (LWP 5519)]
> > CMD[6005]:SetPlayMode PmAudioVideo
> > CMD[6005]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 229387 (LWP 5520)]
> > CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
> > BUF[6011]:av_read_frame start
> > BUF[6011]:read_packet: StreamBuffer: 0
> > [New Thread 245772 (LWP 5521)]
> > BUF[6408]:Decode b32eec88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32efc88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6418]:read_packet: sleeping while data (12288) in buffer
> > BUF[6418]:read_packet: got 12280 bytes
> > BUF[6418]:got packet from av_read_frame!
> > BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
> > 
> > Program received signal SIGSEGV, Segmentation fault.
> > [Switching to Thread 229387 (LWP 5520)]
> > 0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > (gdb) ba
> > #0  0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #1  0xb7866c98 in cMpeg2Decoder::Action ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
> > thread.c:227
> > #3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
> > #4  0xb7f69e51 in pthread_start_thread_event ()
> > from /lib/i686/libpthread.so.0
> > #5  0xb7e0913a in clone () from /lib/i686/libc.so.6
> > (gdb)
> > 
> 
> Sorry, right now I can't say why this happend. Can you tell me a bit 
> more about how you produced this crash? Is it reproducible? Can you 
> print the line where the softdevice crashed? Did you check the messages 
> in the syslog?


last syslog entries before crashing;

Apr  4 22:43:00 localhost vdr[8757]: switching to channel 1
Apr  4 22:43:00 localhost vdr[8766]: [VideoOut]: 736x576 [0,0 736x576]
-> 1024x576 [128,0 768x576]
Apr  4 22:43:03 localhost vdr[8769]: transfer thread started (pid=8769,
tid=131081)
Apr  4 22:43:03 localhost vdr[8770]: receiver on device 2 thread started
(pid=8770, tid=147466)
Apr  4 22:43:03 localhost vdr[8771]: TS buffer on device 2 thread
started (pid=8771, tid=163851)

I think it happens on line 1121;

if (AudioIdx != DONT_PLAY &&
    ic->streams[pkt.stream_index]->codec.codec_type == CODEC_TYPE_AUDIO
    && AudioIdx != pkt.stream_index) {


-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Tue Apr  5 00:13:50 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 23:13:50 +0100
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <42519393.6060005@gmx.net>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net>
Message-ID: <1112652830.5044.23.camel@africa>

On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> > [XvVideoOut]: using area size 2048 x 2048
> > Subplugin successfully opend
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > cSoftDevice::MakePrimaryDevice
> > [New Thread 114696 (LWP 5510)]
> > [New Thread 131081 (LWP 5511)]
> > [New Thread 147466 (LWP 5513)]
> > CMD[2932]:SetPlayMode PmAudioVideo
> > CMD[2932]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 163851 (LWP 5515)]
> > CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
> > BUF[3213]:av_read_frame start
> > BUF[3213]:read_packet: StreamBuffer: 0
> > [New Thread 180236 (LWP 5517)]
> > [Thread 131081 (LWP 5511) exited]
> > CMD[5861]:Stop
> > BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
> > CMD[5878]:Thread beendet : mpegDecoder pid 5515
> > [Thread 163851 (LWP 5515) exited]
> > CMD[5883]:Stop finished
> > GetSpuDecoder 0
> > [Thread 180236 (LWP 5517) exited]
> > [Thread 147466 (LWP 5513) exited]
> > [New Thread 196617 (LWP 5518)]
> > [New Thread 213002 (LWP 5519)]
> > CMD[6005]:SetPlayMode PmAudioVideo
> > CMD[6005]:Start IsSuspended 0
> > init put byte finished
> > [New Thread 229387 (LWP 5520)]
> > CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
> > BUF[6011]:av_read_frame start
> > BUF[6011]:read_packet: StreamBuffer: 0
> > [New Thread 245772 (LWP 5521)]
> > BUF[6408]:Decode b32eec88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32efc88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f0c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1488, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6409]:Decode b32f1c88, Length 2048
> > BUF[6409]:Deocde finished
> > BUF[6418]:read_packet: sleeping while data (12288) in buffer
> > BUF[6418]:read_packet: got 12280 bytes
> > BUF[6418]:got packet from av_read_frame!
> > BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
> > 
> > Program received signal SIGSEGV, Segmentation fault.
> > [Switching to Thread 229387 (LWP 5520)]
> > 0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > (gdb) ba
> > #0  0xb78668af in cMpeg2Decoder::QueuePacket ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #1  0xb7866c98 in cMpeg2Decoder::Action ()
> >    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> > #2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
> > thread.c:227
> > #3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
> > #4  0xb7f69e51 in pthread_start_thread_event ()
> > from /lib/i686/libpthread.so.0
> > #5  0xb7e0913a in clone () from /lib/i686/libc.so.6
> > (gdb)
> > 
> 
> Sorry, right now I can't say why this happend. Can you tell me a bit 
> more about how you produced this crash? Is it reproducible? Can you 
> print the line where the softdevice crashed? Did you check the messages 
> in the syslog?

It appears it's the ic->streams[pkt.stream_index]->codec reference that
causes a segfault.


-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Tue Apr  5 00:29:25 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 04 Apr 2005 23:29:25 +0100
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <1112652830.5044.23.camel@africa>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net>
	 <1112652830.5044.23.camel@africa>
Message-ID: <1112653765.5044.31.camel@africa>

On Mon, 2005-04-04 at 23:13 +0100, Torgeir Veimo wrote:
> 
> > 
> > Sorry, right now I can't say why this happend. Can you tell me a
> bit 
> > more about how you produced this crash? Is it reproducible? Can you 
> > print the line where the softdevice crashed? Did you check the
> messages 
> > in the syslog?
> 
> It appears it's the ic->streams[pkt.stream_index]->codec reference
> that
> causes a segfault.

Just to reply to myself :) it appears ic->streams[pkt.stream_index] is
NULL. Am using ffmpeg cvs nightly from yesterday, but I also tried an
older ffmpeg snapshot with the same results.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Tue Apr  5 12:57:53 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 12:57:53 +0200
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <1112652830.5044.23.camel@africa>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net> <1112652830.5044.23.camel@africa>
Message-ID: <42526F31.1050003@gmx.net>

Torgeir Veimo wrote:
> On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
> 
>>Torgeir Veimo wrote:
>>
>>>[XvVideoOut]: using area size 2048 x 2048
>>>Subplugin successfully opend
>>>[softdevice] Video Out seems to be OK
>>>[softdevice] Initializing Audio Out
>>>[softdevice] Audio out seems to be OK
>>>[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
>>>cSoftDevice::MakePrimaryDevice
>>>[New Thread 114696 (LWP 5510)]
>>>[New Thread 131081 (LWP 5511)]
>>>[New Thread 147466 (LWP 5513)]
>>>CMD[2932]:SetPlayMode PmAudioVideo
>>>CMD[2932]:Start IsSuspended 0
>>>init put byte finished
>>>[New Thread 163851 (LWP 5515)]
>>>CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
>>>BUF[3213]:av_read_frame start
>>>BUF[3213]:read_packet: StreamBuffer: 0
>>>[New Thread 180236 (LWP 5517)]
>>>[Thread 131081 (LWP 5511) exited]
>>>CMD[5861]:Stop
>>>BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
>>>CMD[5878]:Thread beendet : mpegDecoder pid 5515
>>>[Thread 163851 (LWP 5515) exited]
>>>CMD[5883]:Stop finished
>>>GetSpuDecoder 0
>>>[Thread 180236 (LWP 5517) exited]
>>>[Thread 147466 (LWP 5513) exited]
>>>[New Thread 196617 (LWP 5518)]
>>>[New Thread 213002 (LWP 5519)]
>>>CMD[6005]:SetPlayMode PmAudioVideo
>>>CMD[6005]:Start IsSuspended 0
>>>init put byte finished
>>>[New Thread 229387 (LWP 5520)]
>>>CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
>>>BUF[6011]:av_read_frame start
>>>BUF[6011]:read_packet: StreamBuffer: 0
>>>[New Thread 245772 (LWP 5521)]
>>>BUF[6408]:Decode b32eec88, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6409]:Decode b32efc88, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6409]:Decode b32f0488, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6409]:Decode b32f0c88, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6409]:Decode b32f1488, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6409]:Decode b32f1c88, Length 2048
>>>BUF[6409]:Deocde finished
>>>BUF[6418]:read_packet: sleeping while data (12288) in buffer
>>>BUF[6418]:read_packet: got 12280 bytes
>>>BUF[6418]:got packet from av_read_frame!
>>>BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
>>>
>>>Program received signal SIGSEGV, Segmentation fault.
>>>[Switching to Thread 229387 (LWP 5520)]
>>>0xb78668af in cMpeg2Decoder::QueuePacket ()
>>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
>>>(gdb) ba
>>>#0  0xb78668af in cMpeg2Decoder::QueuePacket ()
>>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
>>>#1  0xb7866c98 in cMpeg2Decoder::Action ()
>>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
>>>#2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
>>>thread.c:227
>>>#3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
>>>#4  0xb7f69e51 in pthread_start_thread_event ()
>>>from /lib/i686/libpthread.so.0
>>>#5  0xb7e0913a in clone () from /lib/i686/libc.so.6
>>>(gdb)
>>>
>>
>>Sorry, right now I can't say why this happend. Can you tell me a bit 
>>more about how you produced this crash? Is it reproducible? Can you 
>>print the line where the softdevice crashed? Did you check the messages 
>>in the syslog?
> 
> 
> It appears it's the ic->streams[pkt.stream_index]->codec reference that
> causes a segfault.
> 
> 
Still very strange... Did you change the version of ffmpeg? The 
structure ic should be initialized by libavformat in initputbyte and new 
streams should be added in av_read_packet, so this is not in the 
responsibility of the softdevice. However we could overwrite ic 
somewhere, or feed screwed up data to libavformat..
Which version of the softdevice did you use previously? Can you please 
try to go back in the CVS and try to identify the change which breaks 
the softdevice?
What also puzzels me is that the decoder is started and stoped again 
before it could process any data. And on the second try it crashes...
Sorry, I still have no clue :-(

Martin


From M.Wache at gmx.net  Tue Apr  5 18:11:32 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 18:11:32 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <20050404204417.GA463081@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi>
Message-ID: <4252B8B4.7070205@gmx.net>

Marko M?kel? wrote:
> On Sat, Apr 02, 2005 at 04:32:31PM +0200, Martin Wache wrote:
> 
>>Go ahead, if there is an easy way to improve the performance of the 
>>softdevice we will certainly accept a patch.
>>What I was thinking about to introduce at some point is direct 
>>rendering, i.e. let ffmpeg write directly to the video memory. That 
>>would save some time since there would be no need of copying the 
>>pictures any more, but I want to finish the audio things first...
> 
> 
> It would be helpful to link libvdr-softdevice-dfb.so and libvdr-softdevice.so
> statically with the vdr executable, so that complete stack traces can be
> obtained.  For some reason, I was unable to get oprofile's opstack to work
> yet.  (I had similar problems on other systems, so that's nothing new.)
> Thus, I got the statistics for "vdr" and the softdevice libraries separately.
> Here is the top for vdr when playing live stream:
> 
> CPU: PIII, speed 906.845 MHz (estimated)
> Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 9000
> samples  %        symbol name
> 11330    14.0482  cRemux::ScanVideoPacket(unsigned char const*, int, int, unsigned char&)
> 8735     10.8306  cSchedule::GetEvent(unsigned short, long) const
> 5337      6.6174  SI::CRC32::crc32(char const*, int, unsigned int)
> 3364      4.1711  cSectionHandler::Action()
> 2618      3.2461  cChannels::GetByChannelID(tChannelID, bool, bool)
> 2286      2.8344  cDevice::Action()
> 2055      2.5480  cTS2PES::instant_repack(unsigned char const*, int)
> 1813      2.2480  cSchedules::GetSchedule(tChannelID) const
> 1789      2.2182  cRingBufferLinear::Put(unsigned char const*, int)
> 1568      1.9442  cRingBuffer::UpdatePercentage(int)
> [truncated]
> 
> And here is the list for libvdr-softdevice-dfb:
> 
> samples  %        symbol name
> 9980     84.3832  cDFBVideoOut::YUV(unsigned char*, unsigned char*, unsigned char*, int, int, int, int)
> 581       4.9125  cVideoOut::CheckAspectDimensions(AVFrame*, AVCodecContext*)
> 453       3.8302  cDFBVideoOut::SetParams()
> 425       3.5935  cVideoOut::CheckAspect(int, float)
> 343       2.9001  cDFBRemote::Action()
> 45        0.3805  cDFBVideoOut::ProcessEvents()
> [complete list]
These numbers are quite like I would expect them...

> 
> Finally, here is the list for libvdr-softdevice:
> 
> samples  %        symbol name
> 2986     26.1219  cVideoStreamDecoder::DecodePacket(AVPacket*)
> 1320     11.5475  cStreamDecoder::Action()
Actualy this is quite interessting. Action() should do nothing except 
waiting for new packets and call DecodePacket() for each packet. I would 
not expect it use so much time. Sleeping and the call to DecodePacket 
should not count, so where does it spend the time? Maybe the mutex... I 
guess playing around in this function may give some improvements..
> 1083      9.4742  cMpeg2Decoder::read_packet(unsigned char*, int)
> 956       8.3632  cAudioStreamDecoder::DecodePacket(AVPacket*)
> 740       6.4736  cRelTimer::GetRelTime()
Ups, also much more than I thought...
> 533       4.6628  cSoftRingBufferLinear::Available()
> 466       4.0766  cPacketQueue::PutPacket(AVPacket const&)
> 433       3.7879  cMpeg2Decoder::Action()
> 426       3.7267  cMpeg2Decoder::DecodePacket(AVFormatContext const*, AVPacket&)347       3.0356  cAlsaAudioOut::SetParams(SampleContext&)
> 323       2.8256  cAlsaAudioOut::Write(unsigned char*, int)
> 301       2.6332  cAudioStreamDecoder::GetPTS()
> 265       2.3183  cPacketQueue::GetReadPacket()
> 223       1.9508  cClock::GetPTS()
> [truncated]

I never used oprofile before, only gprof so I don't now exactly what 
these numbers mean. What is samples exactly, I asume it is the overall 
cpu time spend in a function? Is there a statistic like numbers of calls 
and time consumed per call?

> 
> It seems that the percentages are relative to that executable only.  But the
> numbers of samples should be global.  So, even though cDFBVideoOut::YUV()
> seems to consume a large percentage of CPU cycles, at 9980 samples it's
> behind cRemux::ScanVideoPacket(), which has been sampled 11330 times.
> 
> It'd be really helpful to link the plugins statically to vdr, because then
> the percentage figures could be compared directly, and also stack traces would
> look more meaningful.  How can that be done?
You can disable USE_SUBPLUGINS in the softdevice makefile and you will 
get at least one library for the softdevice.
> 
> If you want to play with oprofile yourself, be sure to enable the following

I guess if I find the time I will try gprof. I know it much better and 
we can compare the results...

> 
> Okay.  Anyway, this will not be needed if you can figure out how to get
> the timing right without using the RTC device.
> 
I already tried using the sigalarm mechanism, the timing works nice also 
for greater sleeps times. Looks much better than usleep timing, also it 
is slightly less precise than RTC timing.

> 
> I have a snapshot "softdevice-work.tar.gz" from about 3 weeks ago, which
> I guess I downloaded from
> http://www.lucke.in-berlin.de/vdr-softdevice-work.tar.gz when the berlios
> server was unavailable.  (It worked on Saturday but didn't on Sunday, or
> something like that.)
Are the above oprof outputs from the old snapshot or from the new one? 
If it is the new one then please check if in your old snapshot in 
mpeg2decoder is a function "int cMpeg2Decoder::read_packet(uint8_t *buf, 
int buf_size)". About three weeks ago I introduced libavformat parsing 
into the softdevice and I like to know if the working version was before 
that or after that change.
> 
> The CVS snapshot I took on March 31 didn't display any subtitles.  I haven't
> tried a more recent CVS snapshot yet.  So, I took the old snapshot and
> patched the setup parsing code there.
> 
I guess I will try the subtitles plugin myself. I wonder if in Germany 
there are stations which provide subtitles...

> 
> Of course, it could also be a problem in the stream itself.  I haven't seen
> subtitles in any other DVB-T receiver, so I can't say for sure.  The
> subtitles seem to work much better in softdevice than dxr3, where the
> subtitles often appear in bursts.  However, sometimes the subtitles
> could be one or two seconds too early.
> 
> Finally, I noticed another interesting thing: the subtitles will continue to
> change, even if playback is suspended!
Now that is strange... GetSTC should not return anything meaningfull if 
the playback is suspended...

Bye,
Martin


From nhuillard at e-dition.fr  Tue Apr  5 18:34:39 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 05 Apr 2005 18:34:39 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <4252B8B4.7070205@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net>
Message-ID: <4252BE1F.6060304@e-dition.fr>

Martin Wache a ?crit :
> I never used oprofile before, only gprof so I don't now exactly what 
> these numbers mean. What is samples exactly, I asume it is the overall 
> cpu time spend in a function? Is there a statistic like numbers of calls 
> and time consumed per call?

What I understand from the description is that oprofile simply checks 
what's on top of the call stack at regular (timed) intervals. That's 
more statistical than gprof, but requires no tooling of the code.

My 0.02...

-- 
NH


From M.Wache at gmx.net  Tue Apr  5 19:26:49 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 19:26:49 +0200
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <4252BE1F.6060304@e-dition.fr>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net> <4252BE1F.6060304@e-dition.fr>
Message-ID: <4252CA59.9050706@gmx.net>

Nicolas Huillard wrote:
> Martin Wache a ?crit :
> 
>> I never used oprofile before, only gprof so I don't now exactly what 
>> these numbers mean. What is samples exactly, I asume it is the overall 
>> cpu time spend in a function? Is there a statistic like numbers of 
>> calls and time consumed per call?
> 
> 
> What I understand from the description is that oprofile simply checks 
> what's on top of the call stack at regular (timed) intervals. That's 
> more statistical than gprof, but requires no tooling of the code.
> 
> My 0.02...
> 
Ah, okay that makes sense. So I will try gprof, I guess it will be nice 
to compare with the oprofile...

Martin


From torgeir at pobox.com  Tue Apr  5 21:08:37 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 05 Apr 2005 20:08:37 +0100
Subject: [Softdevice-devel] crash with latest cvs code
In-Reply-To: <42526F31.1050003@gmx.net>
References: <1112636733.5044.3.camel@africa>  <42519393.6060005@gmx.net>
	 <1112652830.5044.23.camel@africa>  <42526F31.1050003@gmx.net>
Message-ID: <1112728117.8646.43.camel@africa>

On Tue, 2005-04-05 at 12:57 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> > On Mon, 2005-04-04 at 21:20 +0200, Martin Wache wrote:
> > 
> >>Torgeir Veimo wrote:
> >>
> >>>[XvVideoOut]: using area size 2048 x 2048
> >>>Subplugin successfully opend
> >>>[softdevice] Video Out seems to be OK
> >>>[softdevice] Initializing Audio Out
> >>>[softdevice] Audio out seems to be OK
> >>>[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> >>>cSoftDevice::MakePrimaryDevice
> >>>[New Thread 114696 (LWP 5510)]
> >>>[New Thread 131081 (LWP 5511)]
> >>>[New Thread 147466 (LWP 5513)]
> >>>CMD[2932]:SetPlayMode PmAudioVideo
> >>>CMD[2932]:Start IsSuspended 0
> >>>init put byte finished
> >>>[New Thread 163851 (LWP 5515)]
> >>>CMD[3213]:Neuer Thread gestartet: Mpeg2Decoder pid 5515
> >>>BUF[3213]:av_read_frame start
> >>>BUF[3213]:read_packet: StreamBuffer: 0
> >>>[New Thread 180236 (LWP 5517)]
> >>>[Thread 131081 (LWP 5511) exited]
> >>>CMD[5861]:Stop
> >>>BUF[5866]:cMpeg2Decoder Stream Error!!!!!!!!!!!!!!!!!!
> >>>CMD[5878]:Thread beendet : mpegDecoder pid 5515
> >>>[Thread 163851 (LWP 5515) exited]
> >>>CMD[5883]:Stop finished
> >>>GetSpuDecoder 0
> >>>[Thread 180236 (LWP 5517) exited]
> >>>[Thread 147466 (LWP 5513) exited]
> >>>[New Thread 196617 (LWP 5518)]
> >>>[New Thread 213002 (LWP 5519)]
> >>>CMD[6005]:SetPlayMode PmAudioVideo
> >>>CMD[6005]:Start IsSuspended 0
> >>>init put byte finished
> >>>[New Thread 229387 (LWP 5520)]
> >>>CMD[6011]:Neuer Thread gestartet: Mpeg2Decoder pid 5520
> >>>BUF[6011]:av_read_frame start
> >>>BUF[6011]:read_packet: StreamBuffer: 0
> >>>[New Thread 245772 (LWP 5521)]
> >>>BUF[6408]:Decode b32eec88, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6409]:Decode b32efc88, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6409]:Decode b32f0488, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6409]:Decode b32f0c88, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6409]:Decode b32f1488, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6409]:Decode b32f1c88, Length 2048
> >>>BUF[6409]:Deocde finished
> >>>BUF[6418]:read_packet: sleeping while data (12288) in buffer
> >>>BUF[6418]:read_packet: got 12280 bytes
> >>>BUF[6418]:got packet from av_read_frame!
> >>>BUF[6418]:QueuePacket AudioIdx: -1 VideoIdx -1 pkt.stream_index: 0
> >>>
> >>>Program received signal SIGSEGV, Segmentation fault.
> >>>[Switching to Thread 229387 (LWP 5520)]
> >>>0xb78668af in cMpeg2Decoder::QueuePacket ()
> >>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> >>>(gdb) ba
> >>>#0  0xb78668af in cMpeg2Decoder::QueuePacket ()
> >>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> >>>#1  0xb7866c98 in cMpeg2Decoder::Action ()
> >>>   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
> >>>#2  0x080d0740 in cThread::StartThread (Thread=0x85d0ef0) at
> >>>thread.c:227
> >>>#3  0xb7f69ce1 in pthread_start_thread () from /lib/i686/libpthread.so.0
> >>>#4  0xb7f69e51 in pthread_start_thread_event ()
> >>>from /lib/i686/libpthread.so.0
> >>>#5  0xb7e0913a in clone () from /lib/i686/libc.so.6
> >>>(gdb)
> >>>
> >>
> >>Sorry, right now I can't say why this happend. Can you tell me a bit 
> >>more about how you produced this crash? Is it reproducible? Can you 
> >>print the line where the softdevice crashed? Did you check the messages 
> >>in the syslog?
> > 
> > 
> > It appears it's the ic->streams[pkt.stream_index]->codec reference that
> > causes a segfault.
> > 
> > 
> Still very strange... Did you change the version of ffmpeg? The 
> structure ic should be initialized by libavformat in initputbyte and new 
> streams should be added in av_read_packet, so this is not in the 
> responsibility of the softdevice. However we could overwrite ic 
> somewhere, or feed screwed up data to libavformat..
> Which version of the softdevice did you use previously? Can you please 
> try to go back in the CVS and try to identify the change which breaks 
> the softdevice?
> What also puzzels me is that the decoder is started and stoped again 
> before it could process any data. And on the second try it crashes...
> Sorry, I still have no clue :-(

I've reverted back to ffmpeg 0.4.9pre1 which works ok. I might try to
find which ffmpeg update that broke it, but am a bit short of time
currently.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Tue Apr  5 21:26:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 5 Apr 2005 21:26:07 +0200
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file player for vdr with softdevice
In-Reply-To: <42511BD3.9080105@e-dition.fr>
References: <42511110.5000703@gmx.net> <42511BD3.9080105@e-dition.fr>
Message-ID: <200504052126.08079.stefan@lucke.in-berlin.de>

On Montag, 4. April 2005 12:49, Nicolas Huillard wrote:
> Martin Wache a ?crit :
> > so here is the first version of my media player for the vdr with
> > softdevice as output device. It plays .avi with various codecs (if
> > supported by ffmpeg) and .mp3.
> 
> Great ! Congratulations !
> 
> > PS: Stefan and me have started a discussion wether to include this 
> > SoftPlay plugin into the SoftDevice while the mailing list was down...
> > Now I'm curious what you think about this. Basicly there are two ways:
> > 
> > -Include everything in the softdevice (only one plugin) and have compile
> >  options to decide what to be build.
> > 
> > -Seperate plugins: a softdevice mostly like it is now, and have a
> >  seperate plugin which implements the player capabilities.
> > 
> > Stefan prefers the first possibility, I prefer the first.

The first too :-) ?, I thought the second.

> > Which way would do you like better?
> 
>  From the packager's point of view, I think the second solution would be 
> a little better (don't have to create two packages : just compile 
> everything, and let the user decide if he actually loads the player)
> But it's not that important, in fact...

As I got my own extension work right now, DV camcorder access,
I think makeing a separate plugin like soft-IEEE1394 is the better
way as there could be separate releases independant of
softdevice release cycle. (OT shouldn't we make a new one 0.1.1?).

So we get a bunch of plugins building the softdevice plugin family.
soft-player, soft-IEEE1394, ..

> The real question seems to be : who will actually *not* want to have a 
> media-player-capable softdevice VDR ? I mean, in the softdevice context, 
> where you use the full-featured VGA card instead of the limited MPEG 
> output of the DVB card, will there be a lot of people not wanting to 
> view Divx, especially since VGA output is *the* way to view Divx ?

If the additional plugins are more stable and have more features,
perhaps we can integrate them back (once we have something like ./configure).

PS:
The capability of my extension is:
	- detect (report via OSD message) plugged and removed firewire devices,
	- show live stream from DV camcorder,
	- some simple camcorder commands like: PLAY, PAUSE, FF, FRew.

Tanks to Martin's packet interface.

DV decoding is a bit more CPU intensive than mpeg decoding. My P4-2.2
is occupied between 50-60 %.

-- 
Stefan Lucke



From marko.makela at hut.fi  Tue Apr  5 21:46:02 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 5 Apr 2005 22:46:02 +0300
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <4252CA59.9050706@gmx.net> <4252BE1F.6060304@e-dition.fr> <4252B8B4.7070205@gmx.net>
References: <4252B8B4.7070205@gmx.net> <4252BE1F.6060304@e-dition.fr> <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net>
Message-ID: <20050405194602.GC7363@mail.kolumbus.fi>

On Tue, Apr 05, 2005 at 06:11:32PM +0200, Martin Wache wrote:
> >Finally, here is the list for libvdr-softdevice:
> >
> >samples  %        symbol name
> >2986     26.1219  cVideoStreamDecoder::DecodePacket(AVPacket*)
> >1320     11.5475  cStreamDecoder::Action()
> Actualy this is quite interessting. Action() should do nothing except 
> waiting for new packets and call DecodePacket() for each packet. I would 
> not expect it use so much time. Sleeping and the call to DecodePacket 
> should not count, so where does it spend the time? Maybe the mutex... I 
> guess playing around in this function may give some improvements..

The opannotate command will show the samples for individual machine
instructions.

> I never used oprofile before, only gprof so I don't now exactly what 
> these numbers mean. What is samples exactly, I asume it is the overall 
> cpu time spend in a function? Is there a statistic like numbers of calls 
> and time consumed per call?

Please have a look at http://oprofile.sourceforge.net/.  There are some
performance counters in every modern processor, and OProfile makes use of
them.  When you start it, you specify the counter(s) to use and a sampling
interval (the lower the number, the more frequently the samples will be
taken).  An NMI interrupt handler saves the samples in a buffer, and the
oprofile daemon collects the statistics and writes them out to a file.  This
causes a few percent overhead, and no instrumentation of the running programs
is necessary.  You can even profile kernel code, and you can start and stop
collecting samples any time you want.

Yes, the more samples, the more resources are consumed at that location.
CPU_CLK_UNHALTED measures CPU consumption.  I've also profiled some code
(not VDR) using DCU_MISS_OUTSTANDING, which measures data cache misses
(useful if you want to fine-tune things with __builtin_prefetch()).

> You can disable USE_SUBPLUGINS in the softdevice makefile and you will 
> get at least one library for the softdevice.

Thanks.  I also see a dlopen() call in plugin.c.

> >If you want to play with oprofile yourself, be sure to enable the following
> 
> I guess if I find the time I will try gprof. I know it much better and 
> we can compare the results...

Of course, this depends on what you mean by "better".  Oh, sorry, I misread
you: you didn't say "I know it's much better". :-)

I've used gprof years ago when there was no free software tool like oprofile.
(I didn't have access to Intel's VTune or DCPI for Digital UNIX.)
I have understood that gprof does not work with multi-threaded programs, and
I think you will have hard time using it in a dlopen()ed library.  Well,
actually the dlopen() might not be a problem, as long as all code is compiled
with gcc -pg.  For my doctoral thesis work, I wrote a program that generates
some C code on the fly and executes it.  I can't remember, but it could be
that it might actually have worked on the dlopen()ed code as well.

If you want to get meaningful statistics from gprof, you will have to disable
inlining, which degrades performance further.  Also, you will get junk from
the initialization and cleanup phases.

With oprofile, you can choose to collect samples for the interesting part
only, at a performance penalty of a few percent.  Already a run of 10 seconds
gives pretty good numbers.  The longer you run it, the more accurate it gets
due to the statistical nature of oprofile.  I'd let it collect samples for
a couple of minutes to get a pretty accurate view.  But isn't gprof somehow
statistical as well?

> Are the above oprof outputs from the old snapshot or from the new one? 

For the old snapshot.  I'll run the profiler again on a fresh CVS checkout
soon, maybe this evening.

> I guess I will try the subtitles plugin myself. I wonder if in Germany 
> there are stations which provide subtitles...

I've understood that the bitmap subtitles (http://www.virtanen.org/) are
used in Finland and in the UK.  In Sweden, they use textual subtitles.
You Germans are spoiled with dubbed programs.  Here, they only dub some
small children's programs and often in very bad quality (one actor tries
to imitate all voices).

If you'd like, I can provide you with some samples, e.g., "Creature Comforts"
by Aadrman Animations.  In tonight's show, all subtitles appeared to be
unsynchronized, appearing 5-10 seconds before the audio.

> >Finally, I noticed another interesting thing: the subtitles will continue 
> >to
> >change, even if playback is suspended!
> Now that is strange... GetSTC should not return anything meaningfull if 
> the playback is suspended...

When I suspend, the sound stops and the picture freezes, but the subtitle
overlay keeps changing.

> What I understand from the description is that oprofile simply checks 
> what's on top of the call stack at regular (timed) intervals. That's 
> more statistical than gprof, but requires no tooling of the code.

Actually, stack trace backtracking is optional, and it only works if the
program has been compiled with -fno-omit-frame-pointer.  I was unable to
enable backtracking yesterday, but I'll try again today.  It looks like
the default settings are stored in ~root/.oprofile/daemonrc.  It's a bit
of mystery to me if the settings can be changed once the oprofile module
has been loaded.  (It can't be unloaded from 2.6 kernels, if I've understood
correctly.)

> Ah, okay that makes sense. So I will try gprof, I guess it will be nice 
> to compare with the oprofile...

Sure, and please tell me if you got it to work.  I have never tried to use
gprof on a multi-threaded program.

	Marko


From marko.makela at hut.fi  Tue Apr  5 22:14:30 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 5 Apr 2005 23:14:30 +0300
Subject: [Softdevice-devel] Suspending the playback at shutdown
In-Reply-To: <4252B8B4.7070205@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net>
Message-ID: <20050405201430.GE7363@mail.kolumbus.fi>

Hi again,

> >Finally, here is the list for libvdr-softdevice:
> >
> >samples  %        symbol name
> >2986     26.1219  cVideoStreamDecoder::DecodePacket(AVPacket*)
> >1320     11.5475  cStreamDecoder::Action()
> Actualy this is quite interessting. Action() should do nothing except 
> waiting for new packets and call DecodePacket() for each packet. I would 
> not expect it use so much time. Sleeping and the call to DecodePacket 
> should not count, so where does it spend the time? Maybe the mutex... I 
> guess playing around in this function may give some improvements..

I ran the profiler again on the old snapshot, this time compiled as a single
library, with oprofile maximum callgraph depth of 6.  Now the top 98 percent
for the combined libvdr-softdevice looks like this:

CPU: PIII, speed 907.007 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 90000
samples  %        symbol name
1326     32.7488  cDFBVideoOut::YUV(unsigned char*, unsigned char*, unsigned char*, int, int, int, int)
434      10.7187  cVideoStreamDecoder::DecodePacket(AVPacket*)
399       9.8543  cVideoOut::Draw(cBitmap*, unsigned char*, int, bool)
298       7.3598  ScaleBitmap(cBitmap*, int&, int&, int&, int&, int, int, int, int)
185       4.5690  cMpeg2Decoder::read_packet(unsigned char*, int)
156       3.8528  cAudioStreamDecoder::DecodePacket(AVPacket*)
128       3.1613  cRelTimer::GetRelTime()
124       3.0625  cAlsaAudioOut::Write(unsigned char*, int)
103       2.5438  cVideoOut::CheckAspectDimensions(AVFrame*, AVCodecContext*)
95        2.3463  cSoftRingBufferLinear::Available()
84        2.0746  cStreamDecoder::Action()

I guess that this is expected.  Judging from the opannotate output for the
YUV method, it looks like there are some data cache misses.  Next, I'll
update to the current CVS snapshot and see if I can link the plugin statically
to VDR.

	Marko


From M.Wache at gmx.net  Tue Apr  5 22:14:47 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 22:14:47 +0200
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file player
 for vdr with softdevice
In-Reply-To: <200504052126.08079.stefan@lucke.in-berlin.de>
References: <42511110.5000703@gmx.net> <42511BD3.9080105@e-dition.fr> <200504052126.08079.stefan@lucke.in-berlin.de>
Message-ID: <4252F1B7.9050609@gmx.net>

Stefan Lucke wrote:
> On Montag, 4. April 2005 12:49, Nicolas Huillard wrote:
> 
>>Martin Wache a ?crit :
....

>>>-Include everything in the softdevice (only one plugin) and have compile
>>> options to decide what to be build.
>>>
>>>-Seperate plugins: a softdevice mostly like it is now, and have a
>>> seperate plugin which implements the player capabilities.
>>>
>>>Stefan prefers the first possibility, I prefer the first.
> 
> 
> The first too :-) ?, I thought the second.
This was a mistake :-/ I like the second one better..
But I was about to give in since the most people don't seem to care too 
much...

> 
> 
>>>Which way would do you like better?
>>
>> From the packager's point of view, I think the second solution would be 
>>a little better (don't have to create two packages : just compile 
>>everything, and let the user decide if he actually loads the player)
>>But it's not that important, in fact...
> 
> 
> As I got my own extension work right now, DV camcorder access,
> I think makeing a separate plugin like soft-IEEE1394 is the better
> way as there could be separate releases independant of
> softdevice release cycle. (OT shouldn't we make a new one 0.1.1?).
Yes, I think we should soon release a new version. What about releasing 
a 0.1.1 on sunday? I would like to finish a few things and disable the 
debuging output before the release...
> 
> So we get a bunch of plugins building the softdevice plugin family.
> soft-player, soft-IEEE1394, ..
And I guess we will get much more attention when announcing new plugins 
than just a new version of the softdevice ;-). Also I we could create a 
package which contains all soft-plugins.
> 
> 
>>The real question seems to be : who will actually *not* want to have a 
>>media-player-capable softdevice VDR ? I mean, in the softdevice context, 
>>where you use the full-featured VGA card instead of the limited MPEG 
>>output of the DVB card, will there be a lot of people not wanting to 
>>view Divx, especially since VGA output is *the* way to view Divx ?
> 
> 
> If the additional plugins are more stable and have more features,
> perhaps we can integrate them back (once we have something like ./configure).
This is a very good idea!

> 
> PS:
> The capability of my extension is:
> 	- detect (report via OSD message) plugged and removed firewire devices,
> 	- show live stream from DV camcorder,
> 	- some simple camcorder commands like: PLAY, PAUSE, FF, FRew.
> 
This sounds like a very nice tool! Unfortunatly I don't own a DV 
camcorder, so I can't try it...

Bye,
Martin


From stefan at lucke.in-berlin.de  Tue Apr  5 22:21:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 5 Apr 2005 22:21:58 +0200
Subject: OSD suspent (WAS: Re: [Softdevice-devel] Profiling tools)
Message-ID: <200504052221.58701.stefan@lucke.in-berlin.de>

On Dienstag, 5. April 2005 21:46, Marko M?kel? wrote:
> On Tue, Apr 05, 2005 at 06:11:32PM +0200, Martin Wache wrote:


> > I guess I will try the subtitles plugin myself. I wonder if in Germany 
> > there are stations which provide subtitles...
> 
> I've understood that the bitmap subtitles (http://www.virtanen.org/) are
> used in Finland and in the UK.  In Sweden, they use textual subtitles.
> You Germans are spoiled with dubbed programs.  Here, they only dub some
> small children's programs and often in very bad quality (one actor tries
> to imitate all voices).
> 
> If you'd like, I can provide you with some samples, e.g., "Creature Comforts"
> by Aadrman Animations.  In tonight's show, all subtitles appeared to be
> unsynchronized, appearing 5-10 seconds before the audio.

Having a sample stream with subtitles is very interesting.

> 
> > >Finally, I noticed another interesting thing: the subtitles will continue 
> > >to
> > >change, even if playback is suspended!
> > Now that is strange... GetSTC should not return anything meaningfull if 
> > the playback is suspended...

So they'll get displayed at arbitrary time.

> 
> When I suspend, the sound stops and the picture freezes, but the subtitle
> overlay keeps changing.

I think thats because our OSD handling is not suspend, as it doesn't allocate
resources (XV ports, alsa sound device) required by other programs
(mplayer plugin,.. )  to run.

Do you consider displaying of subtitles during suspend as a bug
or just as a funny thing ?

-- 
Stefan Lucke



From M.Wache at gmx.net  Tue Apr  5 22:35:14 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 22:35:14 +0200
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <20050405194602.GC7363@mail.kolumbus.fi>
References: <4252B8B4.7070205@gmx.net> <4252BE1F.6060304@e-dition.fr> <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net> <20050405194602.GC7363@mail.kolumbus.fi>
Message-ID: <4252F682.3040905@gmx.net>

Marko M?kel? wrote:
> On Tue, Apr 05, 2005 at 06:11:32PM +0200, Martin Wache wrote:
> 
>>>Finally, here is the list for libvdr-softdevice:
>>>
>>>samples  %        symbol name
>>>2986     26.1219  cVideoStreamDecoder::DecodePacket(AVPacket*)
>>>1320     11.5475  cStreamDecoder::Action()
>>
>>Actualy this is quite interessting. Action() should do nothing except 
>>waiting for new packets and call DecodePacket() for each packet. I would 
>>not expect it use so much time. Sleeping and the call to DecodePacket 
>>should not count, so where does it spend the time? Maybe the mutex... I 
>>guess playing around in this function may give some improvements..
> 
> 
> The opannotate command will show the samples for individual machine
> instructions.
> 
> 
>>I never used oprofile before, only gprof so I don't now exactly what 
>>these numbers mean. What is samples exactly, I asume it is the overall 
>>cpu time spend in a function? Is there a statistic like numbers of calls 
>>and time consumed per call?
> 
> 
> Please have a look at http://oprofile.sourceforge.net/.  There are some
> performance counters in every modern processor, and OProfile makes use of
> them.  When you start it, you specify the counter(s) to use and a sampling
> interval (the lower the number, the more frequently the samples will be
> taken).  An NMI interrupt handler saves the samples in a buffer, and the
> oprofile daemon collects the statistics and writes them out to a file.  This
> causes a few percent overhead, and no instrumentation of the running programs
> is necessary.  You can even profile kernel code, and you can start and stop
> collecting samples any time you want.
> 
> Yes, the more samples, the more resources are consumed at that location.
> CPU_CLK_UNHALTED measures CPU consumption.  I've also profiled some code
> (not VDR) using DCU_MISS_OUTSTANDING, which measures data cache misses
> (useful if you want to fine-tune things with __builtin_prefetch()).
> 
> 
>>You can disable USE_SUBPLUGINS in the softdevice makefile and you will 
>>get at least one library for the softdevice.
> 
> 
> Thanks.  I also see a dlopen() call in plugin.c.
> 
> 
>>>If you want to play with oprofile yourself, be sure to enable the following
>>
>>I guess if I find the time I will try gprof. I know it much better and 
>>we can compare the results...
> 
> 
> Of course, this depends on what you mean by "better".  Oh, sorry, I misread
> you: you didn't say "I know it's much better". :-)
I did not want to say that gprof is better. But I like the idea to have 
two tools and to be able to compare the results
> 
> I've used gprof years ago when there was no free software tool like oprofile.
> (I didn't have access to Intel's VTune or DCPI for Digital UNIX.)
> I have understood that gprof does not work with multi-threaded programs, and
There is a wrapper around pthread library which helps to get around this 
problem.
> I think you will have hard time using it in a dlopen()ed library.  Well,
> actually the dlopen() might not be a problem, as long as all code is compiled
> with gcc -pg.  For my doctoral thesis work, I wrote a program that generates
> some C code on the fly and executes it.  I can't remember, but it could be
> that it might actually have worked on the dlopen()ed code as well.
I just hacked vdr to link the softdevice staticaly...

> 
> If you want to get meaningful statistics from gprof, you will have to disable
> inlining, which degrades performance further.  Also, you will get junk from
> the initialization and cleanup phases.
Sure gprof is not perfect ;-)
> 
> With oprofile, you can choose to collect samples for the interesting part
> only, at a performance penalty of a few percent.  Already a run of 10 seconds
> gives pretty good numbers.  The longer you run it, the more accurate it gets
> due to the statistical nature of oprofile.  I'd let it collect samples for
> a couple of minutes to get a pretty accurate view.  But isn't gprof somehow
> statistical as well?
Yes, that's right the mechanism to collect the running times is also 
statistical ( and I guess since it is not done by the kernel less 
precise). But with gprof I get accurate function call acounting.
For instance the the GetReltime function seems to use much time. As long 
as I don't know how often it is called I don't know if a single call 
uses to much time or if we just call it to often.

> 
> Sure, and please tell me if you got it to work.  I have never tried to use
> gprof on a multi-threaded program.
Yes, I have it running but I used some really dirty hacks. I changed 
plugin.c not to dlopen any plugins, and instead of invoking creator() I 
just create a new cPluginSoftdevice. Then link all softdevice files 
staticaly and dependency to the vdr. Of course this hacked version can't 
use any other plugins than the softdevice...

The results are somehow similar to yours... I don't want to post a 
profiling now since it also contains all vdr functions and is realy huge.
And I found the reason for the Action() mystery: it seems that when one 
calls usleep() with smaller values than 10000 it waits in a busy loop. I 
thought it would just schedule the smallest possible time... So I will 
replace all usleeps > 10000, there are a few...
The GetRelTime function is just called very often and thus appears to 
use too much time.

Bye,
Martin


From marko.makela at hut.fi  Tue Apr  5 22:44:42 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 5 Apr 2005 23:44:42 +0300
Subject: OSD suspent (WAS: Re: [Softdevice-devel] Profiling tools)
In-Reply-To: <200504052221.58701.stefan@lucke.in-berlin.de>
References: <200504052221.58701.stefan@lucke.in-berlin.de>
Message-ID: <20050405204442.GH7363@mail.kolumbus.fi>

On Tue, Apr 05, 2005 at 10:21:58PM +0200, Stefan Lucke wrote:
> Having a sample stream with subtitles is very interesting.

Please contact me privately to get a sample.  Is one minute enough?

> > When I suspend, the sound stops and the picture freezes, but the subtitle
> > overlay keeps changing.
> 
> I think thats because our OSD handling is not suspend, as it doesn't allocate
> resources (XV ports, alsa sound device) required by other programs
> (mplayer plugin,.. )  to run.
> 
> Do you consider displaying of subtitles during suspend as a bug
> or just as a funny thing ?

Both. :-)  But I'd say it's not a critical bug.

Is there any tutorial on DirectFB or the Linux frame buffer in general?
I have some problems with virtual console switching.  Either the runnning
VDR will keep overwriting text on another virtual console, or the picture
gets blanked, and won't be restored when I switch back to the original
virtual console.  The subtitles will be displayed on other virtual consoles.

Ultimately, I'd like to use a video monitor on the second head of the
Matrox G450, but I haven't acquired a VGA connector yet so that I could
solder the SCART cable.

	Marko


From marko.makela at hut.fi  Tue Apr  5 23:12:20 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 6 Apr 2005 00:12:20 +0300
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <4252F682.3040905@gmx.net>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net> <20050405194602.GC7363@mail.kolumbus.fi> <4252F682.3040905@gmx.net>
Message-ID: <20050405211220.GI7363@mail.kolumbus.fi>

On Tue, Apr 05, 2005 at 10:35:14PM +0200, Martin Wache wrote:
> I just hacked vdr to link the softdevice staticaly...

I'd be interested in that patch.  The plugin.c code looked quite
complicated.

> Yes, that's right the mechanism to collect the running times is also 
> statistical ( and I guess since it is not done by the kernel less 
> precise). But with gprof I get accurate function call acounting.
> For instance the the GetReltime function seems to use much time. As long 
> as I don't know how often it is called I don't know if a single call 
> uses to much time or if we just call it to often.

Right, I didn't think about that.  It's quite different to code real-time
applications than interpreters or databases.

> The results are somehow similar to yours... I don't want to post a 
> profiling now since it also contains all vdr functions and is realy huge.
> And I found the reason for the Action() mystery: it seems that when one 
> calls usleep() with smaller values than 10000 it waits in a busy loop. I 
> thought it would just schedule the smallest possible time...

I believe that the granularity of usleep() used to be around 20 milliseconds,
due to some constraints of the scheduler.  Maybe that's why it's
busy-waiting.

Hmm, the disassembly in the opannotate output for cDFBVideoOut::YUV()
does not make much sense, e.g.,:

               :   1aa6c:       mov    %edx,0x4(%esp)
     1  0.0155 :   1aa70:       mov    %eax,(%esp)
   317  4.9185 :   1aa73:       call   1aa74 <_ZN12cDFBVideoOut3YUVEPhS0_S0_iiii+0x3d4>
    11  0.1707 :   1aa78:       mov    0xffffffac(%ebp),%ecx
    83  1.2878 :   1aa7b:       mov    0x20(%ebp),%eax

There are also some other call instructions jumping to %eip+1.
Maybe opannotate doesn't disassemble MMX instructions properly?

By the way, is cDFBVideoOut::YUV() needed for the Matrox G450?  Isn't the
card capable of doing YUV to RGB transform in hardware?  Or is it already
doing that?  I tried several runs, and this function is consuming over
40% of softdevice's time.  Hmm, it's pretty insignificant:
2764 samples in cDFBVideoOut::YUV(), 707906 samples somewhere in libavcodec,
1400 in libavformat, about 23000 in vdr, about 2000 in libdirectfb, about 100
in libdfb++.

Did you link all dependencies statically (i.e., ldd says that the
executable is statically linked)?

	Marko


From stefan at lucke.in-berlin.de  Tue Apr  5 23:25:17 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 5 Apr 2005 23:25:17 +0200
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file player for vdr with softdevice
In-Reply-To: <4252F1B7.9050609@gmx.net>
References: <42511110.5000703@gmx.net> <200504052126.08079.stefan@lucke.in-berlin.de> <4252F1B7.9050609@gmx.net>
Message-ID: <200504052325.17610.stefan@lucke.in-berlin.de>

On Dienstag, 5. April 2005 22:14, Martin Wache wrote:
> Stefan Lucke wrote:

> > 
> > As I got my own extension work right now, DV camcorder access,
> > I think makeing a separate plugin like soft-IEEE1394 is the better
> > way as there could be separate releases independant of
> > softdevice release cycle. (OT shouldn't we make a new one 0.1.1?).
> Yes, I think we should soon release a new version. What about releasing 
> a 0.1.1 on sunday? I would like to finish a few things and disable the 
> debuging output before the release...

I've no major pending issues to fix. Just a short test with older
vdr versions (1.2.x) . So it's up to you to signal OK.
I would like thursday evening more, as it's just before berlios
mailing list breakdown. ;-( .

> > 
> > So we get a bunch of plugins building the softdevice plugin family.
> > soft-player, soft-IEEE1394, ..
> And I guess we will get much more attention when announcing new plugins 
> than just a new version of the softdevice ;-). Also I we could create a 
> package which contains all soft-plugins.

Ack.

> > 
> > 
> > If the additional plugins are more stable and have more features,
> > perhaps we can integrate them back (once we have something like ./configure).
> This is a very good idea!

Anyone on that list who has experience with gnu autotools etc. and volunteers?
Someone with html knowledge to polish up our homepage is welcome tooo !

> 
> > 
> > PS:
> > The capability of my extension is:
> > 	- detect (report via OSD message) plugged and removed firewire devices,
> > 	- show live stream from DV camcorder,
> > 	- some simple camcorder commands like: PLAY, PAUSE, FF, FRew.
> > 
> This sounds like a very nice tool! Unfortunatly I don't own a DV 
> camcorder, so I can't try it...

I've only one device, so I can't test what happens when one is playing
while another one gets plugged in.

-- 
Stefan Lucke



From torgeir at pobox.com  Tue Apr  5 23:25:34 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 05 Apr 2005 22:25:34 +0100
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <20050405211220.GI7363@mail.kolumbus.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net>
	 <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net>
	 <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net>
	 <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net>
	 <20050405194602.GC7363@mail.kolumbus.fi> <4252F682.3040905@gmx.net>
	 <20050405211220.GI7363@mail.kolumbus.fi>
Message-ID: <1112736334.8646.46.camel@africa>

On Wed, 2005-04-06 at 00:12 +0300, Marko M?kel? wrote:
> 
> By the way, is cDFBVideoOut::YUV() needed for the Matrox G450?  Isn't
> the
> card capable of doing YUV to RGB transform in hardware?

Did you try both pixelformat I420 and YUV2?

(Btw, there's a new radeon R200 driver in DirectFB CVS that supports
YUV2 now.)

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Tue Apr  5 23:48:21 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 5 Apr 2005 23:48:21 +0200
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <20050405211220.GI7363@mail.kolumbus.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4252F682.3040905@gmx.net> <20050405211220.GI7363@mail.kolumbus.fi>
Message-ID: <200504052348.21267.stefan@lucke.in-berlin.de>

On Dienstag, 5. April 2005 23:12, Marko M?kel? wrote:
> On Tue, Apr 05, 2005 at 10:35:14PM +0200, Martin Wache wrote:

> > The results are somehow similar to yours... I don't want to post a 
> > profiling now since it also contains all vdr functions and is realy huge.
> > And I found the reason for the Action() mystery: it seems that when one 
> > calls usleep() with smaller values than 10000 it waits in a busy loop. I 
> > thought it would just schedule the smallest possible time...
> 
> I believe that the granularity of usleep() used to be around 20 milliseconds,
> due to some constraints of the scheduler.  Maybe that's why it's
> busy-waiting.

Which kernel version do you use ? 2.6.x ? On vdr list there were some
discussions according to usleep() below 2000 (2ms). On my system with
kernel 2.4.27pre5  uslee(x) seems to last at least 10000 ?secs.

I've no chance to test rtc timing, as on all systems chronyd is
running to sync the system clock and which occupies /dev/rtc too :-(.

> By the way, is cDFBVideoOut::YUV() needed for the Matrox G450?  Isn't the
> card capable of doing YUV to RGB transform in hardware?  Or is it already
> doing that?  I tried several runs, and this function is consuming over
> 40% of softdevice's time.  Hmm, it's pretty insignificant:
> 2764 samples in cDFBVideoOut::YUV(), 707906 samples somewhere in libavcodec,
> 1400 in libavformat, about 23000 in vdr, about 2000 in libdirectfb, about 100
> in libdfb++.

..::YUV() is  required to copy from ffmpeg's buffer to dfb (locking the
surface) before the actual copy is done. By this we have a buffer of
the previous shown frame, if we enter pause mode and have to refresh
OSD and still frame. YUV to RGB conversion is done in hardware.

-- 
Stefan Lucke



From M.Wache at gmx.net  Tue Apr  5 23:55:09 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 05 Apr 2005 23:55:09 +0200
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <20050405211220.GI7363@mail.kolumbus.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424EACFF.1080505@gmx.net> <20050404204417.GA463081@kosh.hut.fi> <4252B8B4.7070205@gmx.net> <20050405194602.GC7363@mail.kolumbus.fi> <4252F682.3040905@gmx.net> <20050405211220.GI7363@mail.kolumbus.fi>
Message-ID: <4253093D.2040600@gmx.net>

Marko M?kel? wrote:
> On Tue, Apr 05, 2005 at 10:35:14PM +0200, Martin Wache wrote:
> 
>>I just hacked vdr to link the softdevice staticaly...
> 
> 
> I'd be interested in that patch.  The plugin.c code looked quite
> complicated.
The patch is attachted, but you may have to adapt some changes to your 
situation.

> 
>>The results are somehow similar to yours... I don't want to post a 
>>profiling now since it also contains all vdr functions and is realy huge.
>>And I found the reason for the Action() mystery: it seems that when one 
>>calls usleep() with smaller values than 10000 it waits in a busy loop. I 
>>thought it would just schedule the smallest possible time...
> 
> 
> I believe that the granularity of usleep() used to be around 20 milliseconds,
> due to some constraints of the scheduler.  Maybe that's why it's
> busy-waiting.
> 
> Hmm, the disassembly in the opannotate output for cDFBVideoOut::YUV()
> does not make much sense, e.g.,:
> 
>                :   1aa6c:       mov    %edx,0x4(%esp)
>      1  0.0155 :   1aa70:       mov    %eax,(%esp)
>    317  4.9185 :   1aa73:       call   1aa74 <_ZN12cDFBVideoOut3YUVEPhS0_S0_iiii+0x3d4>
>     11  0.1707 :   1aa78:       mov    0xffffffac(%ebp),%ecx
>     83  1.2878 :   1aa7b:       mov    0x20(%ebp),%eax
> 
> There are also some other call instructions jumping to %eip+1.
> Maybe opannotate doesn't disassemble MMX instructions properly?
I read somewhere on the ffmpeg list that gcc-3.x doesn't optimize mmx 
instructions correctly, the example was somehow similar. But I just 
remember one comment: gcc = gnu crab creator.
gcc-2.95 was supposed to be fine.
On the other hand I think if the disassembly is correct this code would 
not execute correctly, it should crash. I don't know, I never looked at 
any disassembly of softdevice code...
> 
> By the way, is cDFBVideoOut::YUV() needed for the Matrox G450?  Isn't the
> card capable of doing YUV to RGB transform in hardware?  Or is it already
> doing that?  
Yes it's using the hardware YUV to RGB transformation. What you can try 
is to check how long the memcpy takes. On my machine with an AGP RagePro 
128 all memcpy together usually take 6-8ms (Xv-out but it should be 
similar for dfb-out). When I use my old PCI Mach64 it takes 20-30 ms (I 
don't remember the real value). So playback with my Mach64 is almost 
impossible ...

> Did you link all dependencies statically (i.e., ldd says that the
> executable is statically linked)?
No I just linked the softdevice statically to vdr.

Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: static.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050405/6494ad20/attachment.ksh>

From torgeir at pobox.com  Wed Apr  6 00:02:36 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 05 Apr 2005 23:02:36 +0100
Subject: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1: A media file
	player for vdr with softdevice
In-Reply-To: <200504052325.17610.stefan@lucke.in-berlin.de>
References: <42511110.5000703@gmx.net>
	 <200504052126.08079.stefan@lucke.in-berlin.de> <4252F1B7.9050609@gmx.net>
	 <200504052325.17610.stefan@lucke.in-berlin.de>
Message-ID: <1112738556.8646.53.camel@africa>

On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> omeone with html knowledge to polish up our homepage is welcome tooo !

I might take a stab at it. It's hosted somewhere else than berlios.de?

-- 
Torgeir Veimo <torgeir at pobox.com>



From va_modiri at yahoo.com  Wed Apr  6 06:30:30 2005
From: va_modiri at yahoo.com (Vahid Modiri)
Date: Tue, 5 Apr 2005 21:30:30 -0700 (PDT)
Subject: [Softdevice-devel] Problem with 2 DVB cards
Message-ID: <20050406043030.66159.qmail@web51010.mail.yahoo.com>

I am using 2 DVB cards simultaneously on a linux
machine.Does SVDRPSEND.pl have any
attribute to control both of cards remotely or I must
move the VDR control to each card manully before use
it?

Yours,
Vahid



		
__________________________________ 
Do you Yahoo!? 
Yahoo! Small Business - Try our new resources site!
http://smallbusiness.yahoo.com/resources/ 


From ollo.diab at gmx.de  Wed Apr  6 08:45:06 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Wed, 6 Apr 2005 08:45:06 +0200 (MEST)
Subject: [Softdevice-devel] crash with latest cvs code
References: <1112728117.8646.43.camel@africa>
Message-ID: <16530.1112769906@www1.gmx.net>

Hi Torgeir,

> 
> I've reverted back to ffmpeg 0.4.9pre1 which works ok. I might try to
> find which ffmpeg update that broke it, but am a bit short of time
> currently.

Please check which libavcodec library get actually linked to the
libsoftdevice. There might quite a few laying around on your harddisk,
because mplayer, xine, ffmpeg, ... each brings its own version. Take care to
not mix different versions of the libavcodec library and the header files
while compiling softdevice!

I currently use a ffmpeg cvs checkout from 04/04/2005 which works fine using
XV video out driver!

Regards,   Thomas

> 
> -- 
> Torgeir Veimo <torgeir at pobox.com>
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Handyrechnung zu hoch? Tipp: SMS und MMS mit GMX
Seien Sie so frei: Alle Infos unter http://www.gmx.net/de/go/freesms


From marko.makela at hut.fi  Wed Apr  6 09:21:11 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 6 Apr 2005 10:21:11 +0300
Subject: [Softdevice-devel] Profiling tools
In-Reply-To: <200504052348.21267.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <4252F682.3040905@gmx.net> <20050405211220.GI7363@mail.kolumbus.fi> <200504052348.21267.stefan@lucke.in-berlin.de>
Message-ID: <20050406072111.GA88688@kosh.hut.fi>

On Tue, Apr 05, 2005 at 11:48:21PM +0200, Stefan Lucke wrote:
> On Dienstag, 5. April 2005 23:12, Marko M?kel? wrote:
> > On Tue, Apr 05, 2005 at 10:35:14PM +0200, Martin Wache wrote:
> 
> > > The results are somehow similar to yours... I don't want to post a 
> > > profiling now since it also contains all vdr functions and is realy huge.
> > > And I found the reason for the Action() mystery: it seems that when one 
> > > calls usleep() with smaller values than 10000 it waits in a busy loop. I 
> > > thought it would just schedule the smallest possible time...
> > 
> > I believe that the granularity of usleep() used to be around 20 milliseconds,
> > due to some constraints of the scheduler.  Maybe that's why it's
> > busy-waiting.
> 
> Which kernel version do you use ? 2.6.x ? On vdr list there were some
> discussions according to usleep() below 2000 (2ms). On my system with
> kernel 2.4.27pre5  uslee(x) seems to last at least 10000 ?secs.

I'm using 2.6.11.6 with some video4linux patches.  I haven't measured the
usleep() granularity on that kernel; I was simply quoting my past experience
from earlier kernels.

> ..::YUV() is  required to copy from ffmpeg's buffer to dfb (locking the
> surface) before the actual copy is done. By this we have a buffer of
> the previous shown frame, if we enter pause mode and have to refresh
> OSD and still frame. YUV to RGB conversion is done in hardware.

I see.

The mystery calls in opannotate output seem to be memcpy() calls.  I really
need to link everything statically  in order to get meaningful results.

	Marko


From M.Wache at gmx.net  Wed Apr  6 10:18:27 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 06 Apr 2005 10:18:27 +0200
Subject: Towards sofdevice-0.1.1 was Re: [Softdevice-devel] [ANNOUNCE] Softplay-0.0.1:
 
In-Reply-To: <200504052325.17610.stefan@lucke.in-berlin.de>
References: <42511110.5000703@gmx.net> <200504052126.08079.stefan@lucke.in-berlin.de> <4252F1B7.9050609@gmx.net> <200504052325.17610.stefan@lucke.in-berlin.de>
Message-ID: <42539B53.5010409@gmx.net>

Stefan Lucke wrote:

> I've no major pending issues to fix. Just a short test with older
> vdr versions (1.2.x) . So it's up to you to signal OK.
> I would like thursday evening more, as it's just before berlios
> mailing list breakdown. ;-( .
Unfortunatly I won't have much time to work on the softdevice until the 
weekend. So if we release on thursday I won't be able to do anything.

There are also some feature request which should be easy to implement. 
For instance the startup in fullscreen mode for XV. I tried just to call 
ToggleFullScreen() at the end of the initialising of XV-out, this works 
without any problems for me. So we would just have to parse the 
parameters and if full screen is requested call ToggleFullScreen.

Also I would like to implement some safety checks for the packet mode, 
and of course remove all usleeps < 10000ms which are not needed.
I also thought about giveing the option of useing signal triggerd 
timing, but that should be tested before releasing it as default...

Martin


From nhuillard at e-dition.fr  Wed Apr  6 17:41:29 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 06 Apr 2005 17:41:29 +0200
Subject: [Softdevice-devel] Problem with 2 DVB cards
In-Reply-To: <20050406043030.66159.qmail@web51010.mail.yahoo.com>
References: <20050406043030.66159.qmail@web51010.mail.yahoo.com>
Message-ID: <42540329.5080601@e-dition.fr>

Vahid Modiri a ?crit :
> I am using 2 DVB cards simultaneously on a linux
> machine.Does SVDRPSEND.pl have any
> attribute to control both of cards remotely or I must
> move the VDR control to each card manully before use
> it?

You should direct this kind of question to the VDR mailing-list. This 
one is about a specific VDR plugin.
Specifically : svdrsend.pl will send commands to VDR, not to a 
particular card.

> Yours,
> Vahid

-- 
NH


From stefan at lucke.in-berlin.de  Wed Apr  6 19:39:19 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 6 Apr 2005 19:39:19 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <42539B53.5010409@gmx.net>
References: <42539B53.5010409@gmx.net>
Message-ID: <200504061939.19814.stefan@lucke.in-berlin.de>

On Donnerstag, 1. Januar 1970 00:59, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > I've no major pending issues to fix. Just a short test with older
> > vdr versions (1.2.x) . So it's up to you to signal OK.
> > I would like thursday evening more, as it's just before berlios
> > mailing list breakdown. ;-( .
> Unfortunatly I won't have much time to work on the softdevice until the 
> weekend. So if we release on thursday I won't be able to do anything.

Ok, then on sunday.

> 
> There are also some feature request which should be easy to implement. 
> For instance the startup in fullscreen mode for XV. I tried just to call 
> ToggleFullScreen() at the end of the initialising of XV-out, this works 
> without any problems for me. So we would just have to parse the 
> parameters and if full screen is requested call ToggleFullScreen.

That would be ok to (no high risk).

> 
> Also I would like to implement some safety checks for the packet mode, 
> and of course remove all usleeps < 10000ms which are not needed.
> I also thought about giveing the option of useing signal triggerd 
> timing, but that should be tested before releasing it as default...

Safty checks ok, but removing all usleeps < 2000?s, I'd like to veto.
I tried it once with sched_yield() but that caused a high cpu load.
Somewhere in the newer vdr versions there is another method
via timed wait but that will introduce some "#if VDRVERSNUM .."


-- 
Stefan Lucke



From M.Wache at gmx.net  Thu Apr  7 10:41:36 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 07 Apr 2005 10:41:36 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <200504061939.19814.stefan@lucke.in-berlin.de>
References: <42539B53.5010409@gmx.net> <200504061939.19814.stefan@lucke.in-berlin.de>
Message-ID: <4254F240.70904@gmx.net>

Stefan Lucke wrote:

>>Also I would like to implement some safety checks for the packet mode, 
>>and of course remove all usleeps < 10000ms which are not needed.
>>I also thought about giveing the option of useing signal triggerd 
>>timing, but that should be tested before releasing it as default...
> 
> 
> Safty checks ok, but removing all usleeps < 2000?s, I'd like to veto.

Sorry, what I meant was replacing all usleeps < 10000us with 
usleeps>=10000us. There are a few places where I just want to sleep, and 
I usually used usleep(5000), but this value turned out to be too small. 
It's the result of the profiling we did, but the effekt on the 
performance is small.

> I tried it once with sched_yield() but that caused a high cpu load.
> Somewhere in the newer vdr versions there is another method
> via timed wait but that will introduce some "#if VDRVERSNUM .."
> 
What I'm using is a reimplementation of the vdr class, adapted to our 
needs. So we won't need additional #ifdefs...
I like this method very much, for me it work really nice and I would 
like to make it the default method in the future.
I already have a testing version which contains the described changes, 
and the ability to skip frames if the cpu is to slow. For me this 
version works very nice.
But if you feel saver I can postbone these changes to after the next 
release.

This morning I checked my small todo-list and I found two more things 
which we probably should fix:

I get a compile error for DFB-out and DirectFB-0.9.21:

make[1]: Entering directory 
`/home/martin/vdr/vdr-1.3.23/PLUGINS/src/softdevice'g++ -O2 -Wall 
-Woverloaded-virtual -L/usr/local/include/ffmpeg/ -L/usr/local/lib -c 
-DUSE_MMX -DUSE_MMX2 -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE 
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DDFB_SUPPORT 
-DFB_SUPPORT -DFBDEV=\"/dev/fb0\" -DLIBXDPMS_SUPPORT -DXV_SUPPORT 
-DVIDIX_SUPPORT -DVIDIX_DIR=\"/usr/local/lib/vidix/\" 
-DFBDEV=\"/dev/fb0\" -DSUSPEND_BY_KEY -I../../../include 
-I../../../../DVB/include -I/usr/local/include/ffmpeg/ 
-I/usr/local/include/dfb++ -I/usr/local/include/directfb 
-I/usr/local/include/vidix video-dfb.c
video-dfb.c: In member function `void cDFBVideoOut::SetParams()':
video-dfb.c:598: error: `DLCONF_SURFACE_CAPS' undeclared (first use this
    function)
video-dfb.c:598: error: (Each undeclared identifier is reported only 
once for
    each function it appears in.)
video-dfb.c:599: error: 'struct DFBDisplayLayerConfig' has no member named '
    surface_caps'
make[1]: *** [video-dfb.o] Error 1
make[1]: Leaving directory 
`/home/martin/vdr/vdr-1.3.23/PLUGINS/src/softdevice'

Is there a way around this with some #ifdefs (even if I don't like them 
getting compile errors is worse...)?

The second issue is not really a bug in the softdevice, but a bug in the 
XServer:


[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa device set to: plughw:1,0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 0 none
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4718)
[XvVideoOut]: max area size 2048 x 2048
[XvVideoOut]: using area size 2048 x 2048
X Error of failed request:  BadAlloc (insufficient resources for operation)
   Major opcode of failed request:  141 (XVideo)
   Minor opcode of failed request:  19 ()
   Serial number of failed request:  150
   Current serial number in output stream:  152

These are the log messages:
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]:   XV_SATURATION
  XvGettable     XvSettable (       0 [0x00000000] -       31 
[0x0000001f]) (
   16 [0x00000010]
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]:   XV_DOUBLE_BUFFER
  XvGettable     XvSettable (       0 [0x00000000] -        1 
[0x00000001]) (
    1 [0x00000001]
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]: XvShmCreateImage 
Successful (0x827df60)
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]: shmget Successful 
(8388608 bytes)
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]: shmat Successful
Apr  7 09:19:05 Jupiter vdr[4876]: [XvVideoOut]: XShmAttach    rc = 1 
(should be OK)
Apr  7 09:19:06 Jupiter vdr[4883]: tuner on device 1 thread started 
(pid=4883, tid=16386)
Apr  7 09:19:06 Jupiter vdr[4884]: Section handler thread started 
(pid=4884, tid=32771)
Apr  7 09:19:08 Jupiter vdr[4876]: ERROR: thread 65541 won't end (waited 
2 seconds) - canceling it...

When I discovered this I spend some time trying to debug it but I did 
not succced, hardcoded the default resolution and forgot about it.
The strange thing is that everything goes fine, and then on the XSync we 
get the "Bad Alloc" error which seems to be uncatchable.

Can we do anything to get around this? Maybe a ENABLE_HDTV switch?

Martin






From stefan at lucke.in-berlin.de  Thu Apr  7 11:04:19 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  7 Apr 2005 11:04:19 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <4254F240.70904@gmx.net>
References: <42539B53.5010409@gmx.net> <200504061939.19814.stefan@lucke.in-berlin.de> <4254F240.70904@gmx.net>
Message-ID: <1112864659.4254f79309f67@webmail.in-berlin.de>

Quoting Martin Wache <M.Wache at gmx.net>:

>
> The second issue is not really a bug in the softdevice, but a bug in the
> XServer:
>
>

> [softdevice] ffmpeg version(0.4.9-pre1) build(4718)
> [XvVideoOut]: max area size 2048 x 2048
> [XvVideoOut]: using area size 2048 x 2048
> X Error of failed request:  BadAlloc (insufficient resources for operation)
>    Major opcode of failed request:  141 (XVideo)
>    Minor opcode of failed request:  19 ()
>    Serial number of failed request:  150
>    Current serial number in output stream:  152

> When I discovered this I spend some time trying to debug it but I did
> not succced, hardcoded the default resolution and forgot about it.
> The strange thing is that everything goes fine, and then on the XSync we
> get the "Bad Alloc" error which seems to be uncatchable.
>
> Can we do anything to get around this? Maybe a ENABLE_HDTV switch?
>

I get sometimes similar errors. I got them even in previous versions before
I used the max available area. That happens when I had one or several browser
windows of vdr-portal open. Closing them resolves the situation. It looks like
card memory is used for caching of pixmaps and when the xv should be realized on
screen, the xserver does not get enough contigues memory for that on the video
card.


From torgeir at pobox.com  Thu Apr  7 11:22:49 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 07 Apr 2005 10:22:49 +0100
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <1112864659.4254f79309f67@webmail.in-berlin.de>
References: <42539B53.5010409@gmx.net>
	 <200504061939.19814.stefan@lucke.in-berlin.de> <4254F240.70904@gmx.net>
	 <1112864659.4254f79309f67@webmail.in-berlin.de>
Message-ID: <1112865769.16216.4.camel@africa>

On Thu, 2005-04-07 at 11:04 +0200, Stefan Lucke wrote:
> 
> 
> I get sometimes similar errors. I got them even in previous versions
> before
> I used the max available area. That happens when I had one or several
> browser
> windows of vdr-portal open. Closing them resolves the situation. It
> looks like
> card memory is used for caching of pixmaps and when the xv should be
> realized on
> screen, the xserver does not get enough contigues memory for that on
> the video
> card.

We might to install a special X error handler. X errors can happen when
telling the screensaver to stay away as well. The one in xscreensaver.c
can be extended a bit to handle fallback on those errors.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Thu Apr  7 12:45:32 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  7 Apr 2005 12:45:32 +0200
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112869594.16216.6.camel@africa>
References: <42511110.5000703@gmx.net>  <200504052325.17610.stefan@lucke.in-berlin.de>  <1112738556.8646.53.camel@africa>  <200504061939.36912.stefan@lucke.in-berlin.de> <1112869594.16216.6.camel@africa>
Message-ID: <1112870732.42550f4caebf6@webmail.in-berlin.de>

Back to list.

Quoting Torgeir Veimo <torgeir at pobox.com>:

> On Wed, 2005-04-06 at 19:39 +0200, Stefan Lucke wrote:
> > Off list.
> >
> > On Mittwoch, 6. April 2005 00:02, Torgeir Veimo wrote:
> > > On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> > > > omeone with html knowledge to polish up our homepage is welcome tooo !
> > >
> > > I might take a stab at it. It's hosted somewhere else than berlios.de?
> >
> > No it's at berlios.

> Ok, I'll upload my initial version to a different pagename so we can
> preview the text. (I guess berlios doesn't have any provision for any
> wiki style editing, which would be handy in this case..)

There is wiki support, but at the start I only activated the minimum required
features. Should I activate wiki support ?

Stefan Lucke


From torgeir at pobox.com  Thu Apr  7 12:50:17 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 07 Apr 2005 11:50:17 +0100
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112870732.42550f4caebf6@webmail.in-berlin.de>
References: <42511110.5000703@gmx.net>
	 <200504052325.17610.stefan@lucke.in-berlin.de>
	 <1112738556.8646.53.camel@africa>
	 <200504061939.36912.stefan@lucke.in-berlin.de>
	 <1112869594.16216.6.camel@africa>
	 <1112870732.42550f4caebf6@webmail.in-berlin.de>
Message-ID: <1112871018.16216.9.camel@africa>

On Thu, 2005-04-07 at 12:45 +0200, Stefan Lucke wrote:
> Back to list.
> 
> Quoting Torgeir Veimo <torgeir at pobox.com>:
> 
> > On Wed, 2005-04-06 at 19:39 +0200, Stefan Lucke wrote:
> > > Off list.
> > >
> > > On Mittwoch, 6. April 2005 00:02, Torgeir Veimo wrote:
> > > > On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> > > > > omeone with html knowledge to polish up our homepage is welcome tooo !
> > > >
> > > > I might take a stab at it. It's hosted somewhere else than berlios.de?
> > >
> > > No it's at berlios.
> 
> > Ok, I'll upload my initial version to a different pagename so we can
> > preview the text. (I guess berlios doesn't have any provision for any
> > wiki style editing, which would be handy in this case..)
> 
> There is wiki support, but at the start I only activated the minimum required
> features. Should I activate wiki support ?

Yes that would be good.

I was thinking of doing a first page with a bit nicer design, black
background and then add a page with in details configuration for at
least DirectFB, maybe something on vidix (which I've only tried briefly
btw).

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Thu Apr  7 12:57:14 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  7 Apr 2005 12:57:14 +0200
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112871018.16216.9.camel@africa>
References: <42511110.5000703@gmx.net>  <200504052325.17610.stefan@lucke.in-berlin.de>  <1112738556.8646.53.camel@africa>  <200504061939.36912.stefan@lucke.in-berlin.de>  <1112869594.16216.6.camel@africa>  <1112870732.42550f4caebf6@webmail.in-berlin.de> <1112871018.16216.9.camel@africa>
Message-ID: <1112871434.4255120a5b981@webmail.in-berlin.de>

Quoting Torgeir Veimo <torgeir at pobox.com>:

> On Thu, 2005-04-07 at 12:45 +0200, Stefan Lucke wrote:
> > Back to list.
> >
> > Quoting Torgeir Veimo <torgeir at pobox.com>:
> >
> > > On Wed, 2005-04-06 at 19:39 +0200, Stefan Lucke wrote:
> > > > Off list.
> > > >
> > > > On Mittwoch, 6. April 2005 00:02, Torgeir Veimo wrote:
> > > > > On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> > > > > > omeone with html knowledge to polish up our homepage is welcome
> tooo !
> > > > >
> > > > > I might take a stab at it. It's hosted somewhere else than
> berlios.de?
> > > >
> > > > No it's at berlios.
> >
> > > Ok, I'll upload my initial version to a different pagename so we can
> > > preview the text. (I guess berlios doesn't have any provision for any
> > > wiki style editing, which would be handy in this case..)
> >
> > There is wiki support, but at the start I only activated the minimum
> required
> > features. Should I activate wiki support ?
>
> Yes that would be good.

Done. Let's see what happens.

>
> I was thinking of doing a first page with a bit nicer design, black
> background and then add a page with in details configuration for at
> least DirectFB, maybe something on vidix (which I've only tried briefly
> btw).


Stefan Lucke


From torgeir at pobox.com  Thu Apr  7 13:18:23 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 07 Apr 2005 12:18:23 +0100
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112871434.4255120a5b981@webmail.in-berlin.de>
References: <42511110.5000703@gmx.net>
	 <200504052325.17610.stefan@lucke.in-berlin.de>
	 <1112738556.8646.53.camel@africa>
	 <200504061939.36912.stefan@lucke.in-berlin.de>
	 <1112869594.16216.6.camel@africa>
	 <1112870732.42550f4caebf6@webmail.in-berlin.de>
	 <1112871018.16216.9.camel@africa>
	 <1112871434.4255120a5b981@webmail.in-berlin.de>
Message-ID: <1112872703.16216.15.camel@africa>

On Thu, 2005-04-07 at 12:57 +0200, Stefan Lucke wrote:
> Quoting Torgeir Veimo <torgeir at pobox.com>:
> 
> > On Thu, 2005-04-07 at 12:45 +0200, Stefan Lucke wrote:
> > > Back to list.
> > >
> > > Quoting Torgeir Veimo <torgeir at pobox.com>:
> > >
> > > > On Wed, 2005-04-06 at 19:39 +0200, Stefan Lucke wrote:
> > > > > Off list.
> > > > >
> > > > > On Mittwoch, 6. April 2005 00:02, Torgeir Veimo wrote:
> > > > > > On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> > > > > > > omeone with html knowledge to polish up our homepage is welcome
> > tooo !
> > > > > >
> > > > > > I might take a stab at it. It's hosted somewhere else than
> > berlios.de?
> > > > >
> > > > > No it's at berlios.
> > >
> > > > Ok, I'll upload my initial version to a different pagename so we can
> > > > preview the text. (I guess berlios doesn't have any provision for any
> > > > wiki style editing, which would be handy in this case..)
> > >
> > > There is wiki support, but at the start I only activated the minimum
> > required
> > > features. Should I activate wiki support ?
> >
> > Yes that would be good.
> 
> Done. Let's see what happens.
> 
> >
> > I was thinking of doing a first page with a bit nicer design, black
> > background and then add a page with in details configuration for at
> > least DirectFB, maybe something on vidix (which I've only tried briefly
> > btw).

Ok, I've started added content at
http://openfacts.berlios.de/index-en.phtml?title=Vdr_Softdevice

Have reused some parts of the old homepage, and will add more on the
various output methods as I go along. Please proofread and suggest
additional information.

Need to figure out how we can add or own styling information, and maybe
move the links to the OpenFact wiki to a links section.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Thu Apr  7 13:29:13 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 07 Apr 2005 12:29:13 +0100
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112872703.16216.15.camel@africa>
References: <42511110.5000703@gmx.net>
	 <200504052325.17610.stefan@lucke.in-berlin.de>
	 <1112738556.8646.53.camel@africa>
	 <200504061939.36912.stefan@lucke.in-berlin.de>
	 <1112869594.16216.6.camel@africa>
	 <1112870732.42550f4caebf6@webmail.in-berlin.de>
	 <1112871018.16216.9.camel@africa>
	 <1112871434.4255120a5b981@webmail.in-berlin.de>
	 <1112872703.16216.15.camel@africa>
Message-ID: <1112873353.16216.17.camel@africa>

On Thu, 2005-04-07 at 12:18 +0100, Torgeir Veimo wrote:
> On Thu, 2005-04-07 at 12:57 +0200, Stefan Lucke wrote:
> > Quoting Torgeir Veimo <torgeir at pobox.com>:
> > 
> > > On Thu, 2005-04-07 at 12:45 +0200, Stefan Lucke wrote:
> > > > Back to list.
> > > >
> > > > Quoting Torgeir Veimo <torgeir at pobox.com>:
> > > >
> > > > > On Wed, 2005-04-06 at 19:39 +0200, Stefan Lucke wrote:
> > > > > > Off list.
> > > > > >
> > > > > > On Mittwoch, 6. April 2005 00:02, Torgeir Veimo wrote:
> > > > > > > On Tue, 2005-04-05 at 23:25 +0200, Stefan Lucke wrote:
> > > > > > > > omeone with html knowledge to polish up our homepage is welcome
> > > tooo !
> > > > > > >
> > > > > > > I might take a stab at it. It's hosted somewhere else than
> > > berlios.de?
> > > > > >
> > > > > > No it's at berlios.
> > > >
> > > > > Ok, I'll upload my initial version to a different pagename so we can
> > > > > preview the text. (I guess berlios doesn't have any provision for any
> > > > > wiki style editing, which would be handy in this case..)
> > > >
> > > > There is wiki support, but at the start I only activated the minimum
> > > required
> > > > features. Should I activate wiki support ?
> > >
> > > Yes that would be good.
> > 
> > Done. Let's see what happens.
> > 
> > >
> > > I was thinking of doing a first page with a bit nicer design, black
> > > background and then add a page with in details configuration for at
> > > least DirectFB, maybe something on vidix (which I've only tried briefly
> > > btw).
> 
> Ok, I've started added content at
> http://openfacts.berlios.de/index-en.phtml?title=Vdr_Softdevice

It's a bit dangerous using this wiki, eg. I added an [[Installation]]
link and got it linked to a completely unrelated page in the OpenFact
wiki.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Thu Apr  7 17:46:25 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 07 Apr 2005 17:46:25 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <1112865769.16216.4.camel@africa>
References: <42539B53.5010409@gmx.net>	 <200504061939.19814.stefan@lucke.in-berlin.de> <4254F240.70904@gmx.net>	 <1112864659.4254f79309f67@webmail.in-berlin.de> <1112865769.16216.4.camel@africa>
Message-ID: <425555D1.4040700@gmx.net>

Torgeir Veimo wrote:
> On Thu, 2005-04-07 at 11:04 +0200, Stefan Lucke wrote:
> 
>>
>>I get sometimes similar errors. I got them even in previous versions
>>before
>>I used the max available area. That happens when I had one or several
>>browser
>>windows of vdr-portal open. Closing them resolves the situation. It
>>looks like
>>card memory is used for caching of pixmaps and when the xv should be
>>realized on
>>screen, the xserver does not get enough contigues memory for that on
>>the video
>>card.
For me this happens even when I only load gnome and vdr. I also tried 
the resolution 1280x768, which fails. I guess the XServer reporting that 
it is capable of doing 2048x2048 is just wrong.
> 
> 
> We might to install a special X error handler. X errors can happen when
> telling the screensaver to stay away as well. The one in xscreensaver.c
> can be extended a bit to handle fallback on those errors.
> 

I think this would be a good solution, we could fallback to the default 
resolution if there is not enough memory for HDTV. If there is not even 
enough for default resolution we can still give a meaningfull error message.
Would it be difficult to do this? E.g will it be possible to include 
this for the next release? I don't know programming X, but I will have a 
look at your error handler. I didn't even know that it's possible to 
install an error handler...

Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Apr  7 19:59:38 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 7 Apr 2005 19:59:38 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <425555D1.4040700@gmx.net>
References: <42539B53.5010409@gmx.net> <1112865769.16216.4.camel@africa> <425555D1.4040700@gmx.net>
Message-ID: <200504071959.38291.stefan@lucke.in-berlin.de>

On Donnerstag, 7. April 2005 17:46, Martin Wache wrote:
> Torgeir Veimo wrote:
> > On Thu, 2005-04-07 at 11:04 +0200, Stefan Lucke wrote:
> > 
> >>
> >>I get sometimes similar errors. I got them even in previous versions
> >>before
> >>I used the max available area. That happens when I had one or several
> >>browser
> >>windows of vdr-portal open. Closing them resolves the situation. It
> >>looks like
> >>card memory is used for caching of pixmaps and when the xv should be
> >>realized on
> >>screen, the xserver does not get enough contigues memory for that on
> >>the video
> >>card.
> For me this happens even when I only load gnome and vdr. I also tried 
> the resolution 1280x768, which fails. I guess the XServer reporting that 
> it is capable of doing 2048x2048 is just wrong.

One possibility. What card and what amount of memory does it have ?
Do you have dri/drm enabled ? If yes, please retry with dri/drm diabled.

> > 
> > 
> > We might to install a special X error handler. X errors can happen when
> > telling the screensaver to stay away as well. The one in xscreensaver.c
> > can be extended a bit to handle fallback on those errors.
> > 
> 
> I think this would be a good solution, we could fallback to the default 
> resolution if there is not enough memory for HDTV. If there is not even 
> enough for default resolution we can still give a meaningfull error message.

As you said XSync() spites out the error, this is very (too) late to take a
reasonable error action. The only one is to my opinion is: suspending
video-out.

So we need an OSD option XV max-area [YES|NO] default no. To take effect
restart vdr (immediate action would be something like suspend -> resume).

> Would it be difficult to do this? E.g will it be possible to include 
> this for the next release? I don't know programming X, but I will have a 
> look at your error handler. I didn't even know that it's possible to 
> install an error handler...
> 


-- 
Stefan Lucke



From M.Wache at gmx.net  Fri Apr  8 18:07:03 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 08 Apr 2005 18:07:03 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <200504071959.38291.stefan@lucke.in-berlin.de>
References: <42539B53.5010409@gmx.net> <1112865769.16216.4.camel@africa> <425555D1.4040700@gmx.net> <200504071959.38291.stefan@lucke.in-berlin.de>
Message-ID: <4256AC27.4030201@gmx.net>

Stefan Lucke wrote:
> On Donnerstag, 7. April 2005 17:46, Martin Wache wrote:
> 
>>Torgeir Veimo wrote:
>>
>>>On Thu, 2005-04-07 at 11:04 +0200, Stefan Lucke wrote:
>>>
>>>
>>>>I get sometimes similar errors. I got them even in previous versions
>>>>before
>>>>I used the max available area. That happens when I had one or several
>>>>browser
>>>>windows of vdr-portal open. Closing them resolves the situation. It
>>>>looks like
>>>>card memory is used for caching of pixmaps and when the xv should be
>>>>realized on
>>>>screen, the xserver does not get enough contigues memory for that on
>>>>the video
>>>>card.
>>
>>For me this happens even when I only load gnome and vdr. I also tried 
>>the resolution 1280x768, which fails. I guess the XServer reporting that 
>>it is capable of doing 2048x2048 is just wrong.
> 
> 
> One possibility. What card and what amount of memory does it have ?
> Do you have dri/drm enabled ? If yes, please retry with dri/drm diabled.
> 
> 
>>>
>>>We might to install a special X error handler. X errors can happen when
>>>telling the screensaver to stay away as well. The one in xscreensaver.c
>>>can be extended a bit to handle fallback on those errors.
>>>
>>
>>I think this would be a good solution, we could fallback to the default 
>>resolution if there is not enough memory for HDTV. If there is not even 
>>enough for default resolution we can still give a meaningfull error message.
> 
> 
> As you said XSync() spites out the error, this is very (too) late to take a
> reasonable error action. The only one is to my opinion is: suspending
> video-out.
I guess you are right...
> 
> So we need an OSD option XV max-area [YES|NO] default no. To take effect
> restart vdr (immediate action would be something like suspend -> resume).
> 
I think that would be possible. But since the time is limited I would 
suggest just to introduce a compiler option for this release and think 
about a more clever solution for the next...

Bye,
Martin
Martin


From stefan at lucke.in-berlin.de  Fri Apr  8 21:53:53 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 8 Apr 2005 21:53:53 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <4256AC27.4030201@gmx.net>
References: <42539B53.5010409@gmx.net> <200504071959.38291.stefan@lucke.in-berlin.de> <4256AC27.4030201@gmx.net>
Message-ID: <200504082153.53940.stefan@lucke.in-berlin.de>

On Freitag, 8. April 2005 18:07, Martin Wache wrote:
> Stefan Lucke wrote:

> > 
> > As you said XSync() spites out the error, this is very (too) late to take a
> > reasonable error action. The only one is to my opinion is: suspending
> > video-out.
> I guess you are right...
> > 
> > So we need an OSD option XV max-area [YES|NO] default no. To take effect
> > restart vdr (immediate action would be something like suspend -> resume).
> > 
> I think that would be possible. But since the time is limited I would 
> suggest just to introduce a compiler option for this release and think 
> about a more clever solution for the next...

OSD option which will take effect at vdr restart is ready to commit. The only
drawback is, that in case of permanent failure, users have to edit
setup.conf.
[some times later ..]
?and so this solution is bad. Even the merged version with command line
parameters does not work as they are overwritten by setup load :-( .

So the only way is a command line parameter which enables the max-area.
" ... -vo xv:max-area .. "
OSD setup, load and store are commented out, as we have to think about
that again, as any command line parameter should have priority over loaded
setup values.

-- 
Stefan Lucke



From M.Wache at gmx.net  Sat Apr  9 10:52:31 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 09 Apr 2005 10:52:31 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <200504082153.53940.stefan@lucke.in-berlin.de>
References: <42539B53.5010409@gmx.net> <200504071959.38291.stefan@lucke.in-berlin.de> <4256AC27.4030201@gmx.net> <200504082153.53940.stefan@lucke.in-berlin.de>
Message-ID: <425797CF.70008@gmx.net>

Stefan Lucke wrote:

> OSD option which will take effect at vdr restart is ready to commit. The only
> drawback is, that in case of permanent failure, users have to edit
> setup.conf.
> [some times later ..]
>  and so this solution is bad. Even the merged version with command line
> parameters does not work as they are overwritten by setup load :-( .
> 
> So the only way is a command line parameter which enables the max-area.
> " ... -vo xv:max-area .. "
> OSD setup, load and store are commented out, as we have to think about
> that again, as any command line parameter should have priority over loaded
> setup values.
> 

I just tried your fix, for me it works nicely. I also commited my 
changes, so I think we are ready for the final testing.
What about this compile issue with directFB-0.9.21? Is it easy to fix, 
or do we only support directFB-0.9.22 from now on?

Bye,
Martin


From stefan at lucke.in-berlin.de  Sat Apr  9 14:09:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 14:09:05 +0200
Subject: [Softdevice-devel] Re: Towards softdevice-0.1.1
In-Reply-To: <425797CF.70008@gmx.net>
References: <42539B53.5010409@gmx.net> <200504082153.53940.stefan@lucke.in-berlin.de> <425797CF.70008@gmx.net>
Message-ID: <200504091409.05544.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 10:52, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > OSD option which will take effect at vdr restart is ready to commit. The only
> > drawback is, that in case of permanent failure, users have to edit
> > setup.conf.
> > [some times later ..]
> >  and so this solution is bad. Even the merged version with command line
> > parameters does not work as they are overwritten by setup load :-( .
> > 
> > So the only way is a command line parameter which enables the max-area.
> > " ... -vo xv:max-area .. "
> > OSD setup, load and store are commented out, as we have to think about
> > that again, as any command line parameter should have priority over loaded
> > setup values.
> > 
> 
> I just tried your fix, for me it works nicely. I also commited my 
> changes, so I think we are ready for the final testing.
> What about this compile issue with directFB-0.9.21? Is it easy to fix, 
> or do we only support directFB-0.9.22 from now on?

Just commited a version check. I'm on 0.9.22 but a few days after
they intoduced this structure member they bumped the version
to 0.9.23. So the check is if greater than 0.9.22 (which fails for
me too) :-( . The detailed check would be the task of some sophisticated
configure script, checking individual members of structures ;-) .


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 15:39:42 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 15:39:42 +0200
Subject: [Softdevice-devel] some issues with current cvs
Message-ID: <200504091539.42728.stefan@lucke.in-berlin.de>

vdr-1.2.1 + vdr-1.3.22
1. fast forward and rewind only work when multispeed mode is enabled.
2. sometimes when entering pause mode, cpu usage goes up to 100%
   but that is not exact reproducable (50:50).
-- 
Stefan Lucke



From M.Wache at gmx.net  Sat Apr  9 15:45:11 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 09 Apr 2005 15:45:11 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504091539.42728.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de>
Message-ID: <4257DC67.8040107@gmx.net>

Stefan Lucke wrote:
> vdr-1.2.1 + vdr-1.3.22
> 1. fast forward and rewind only work when multispeed mode is enabled.
> 2. sometimes when entering pause mode, cpu usage goes up to 100%
>    but that is not exact reproducable (50:50).
I will have a look at this.
I just updated the README, it seem to ages old, could you please have a 
look at it and crosscheck my changes?

Martin


From M.Wache at gmx.net  Sat Apr  9 16:17:22 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 09 Apr 2005 16:17:22 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4257DC67.8040107@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257DC67.8040107@gmx.net>
Message-ID: <4257E3F2.9080303@gmx.net>

Martin Wache wrote:
> Stefan Lucke wrote:
> 
>> vdr-1.2.1 + vdr-1.3.22
>> 1. fast forward and rewind only work when multispeed mode is enabled.
>> 2. sometimes when entering pause mode, cpu usage goes up to 100%
>>    but that is not exact reproducable (50:50).
> 
> I will have a look at this.
> I just updated the README, it seem to ages old, could you please have a 
> look at it and crosscheck my changes?

I fixed both issues, well fix is probably not the right word, I "got 
around" the problems sounds better.
I need more time to check what vdr actually does in the different 
versions...

Martin


From stefan at lucke.in-berlin.de  Sat Apr  9 17:07:24 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 17:07:24 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4257E3F2.9080303@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257DC67.8040107@gmx.net> <4257E3F2.9080303@gmx.net>
Message-ID: <200504091707.24553.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 16:17, Martin Wache wrote:
> Martin Wache wrote:
> > Stefan Lucke wrote:
> > 
> >> vdr-1.2.1 + vdr-1.3.22
> >> 1. fast forward and rewind only work when multispeed mode is enabled.
> >> 2. sometimes when entering pause mode, cpu usage goes up to 100%
> >>    but that is not exact reproducable (50:50).
> > 
> > I will have a look at this.
> > I just updated the README, it seem to ages old, could you please have a 
> > look at it and crosscheck my changes?
> 
> I fixed both issues, well fix is probably not the right word, I "got 
> around" the problems sounds better.
> I need more time to check what vdr actually does in the different 
> versions...

Yes _most_ of them. No cpu busy any more and most speed changes
are ok :-) . 
My test was with vdr-1.3.22. Multispeed mode is disabled:
When entering slow forward from pause mode, picture
stays as it is. then after pressing rewind, back speed is faster than 1x
and then pressing forward. Forward speed is slowmotion now which is ok.

In vdr-1.2.1 it is the same except that audio is not muted "pmVideoOnly ??"
during slow forward. But that should not be a major issue.

But I come to a more serious bug. When aspect ratio changes in recordings.
changes from 4:3 to 16:9 gives a few frames garbage and on change from
16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
dissapears.

The funny thing is: this happens only with vdr-1.3.22.
vdr-1.2.1 has not such problems.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 17:39:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 17:39:30 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504091707.24553.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257E3F2.9080303@gmx.net> <200504091707.24553.stefan@lucke.in-berlin.de>
Message-ID: <200504091739.30134.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 17:07, Stefan Lucke wrote:
> On Samstag, 9. April 2005 16:17, Martin Wache wrote:
> > Martin Wache wrote:
> > > Stefan Lucke wrote:
> > > 
> > >> vdr-1.2.1 + vdr-1.3.22
> > >> 1. fast forward and rewind only work when multispeed mode is enabled.
> > >> 2. sometimes when entering pause mode, cpu usage goes up to 100%
> > >>    but that is not exact reproducable (50:50).
> > > 
> > > I will have a look at this.
> > > I just updated the README, it seem to ages old, could you please have a 
> > > look at it and crosscheck my changes?
> > 
> > I fixed both issues, well fix is probably not the right word, I "got 
> > around" the problems sounds better.
> > I need more time to check what vdr actually does in the different 
> > versions...
> 
> Yes _most_ of them. No cpu busy any more and most speed changes
> are ok :-) . 
> My test was with vdr-1.3.22. Multispeed mode is disabled:
> When entering slow forward from pause mode, picture
> stays as it is. then after pressing rewind, back speed is faster than 1x
> and then pressing forward. Forward speed is slowmotion now which is ok.
> 
> In vdr-1.2.1 it is the same except that audio is not muted "pmVideoOnly ??"
> during slow forward. But that should not be a major issue.
> 
> But I come to a more serious bug. When aspect ratio changes in recordings.
> changes from 4:3 to 16:9 gives a few frames garbage and on change from
> 16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> dissapears.
> 
> The funny thing is: this happens only with vdr-1.3.22.
> vdr-1.2.1 has not such problems.

Even more funny: after compiling with option -g it is gone (without gdb)!?
So I could not get a backtrace neiter with or without -g option from gdb
without -g and run from gdb I get an segfault at program termination.

add on:
upon the 2nd try I get a segfault when run with gdb and compiled with -g:

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 491551 (LWP 5833)]
0x4046c9e1 in ff_mpeg1_find_frame_end () from /usr/local/lib/libavcodec.so
(gdb) bt
#0  0x4046c9e1 in ff_mpeg1_find_frame_end () from /usr/local/lib/libavcodec.so
#1  0x4046c0b9 in ff_mpeg1_find_frame_end () from /usr/local/lib/libavcodec.so
#2  0x40372974 in avcodec_decode_video () from /usr/local/lib/libavcodec.so
#3  0x40309993 in cVideoStreamDecoder::DecodePacket(AVPacket*) (this=0x85ab6d0, pkt=0x85af8d4) at mpeg2decoder.c:480
#4  0x40308b89 in cStreamDecoder::Action() (this=0x85ab6d0) at mpeg2decoder.c:199
#5  0x080dbc40 in cThread::StartThread(cThread*) (Thread=0x85ab6d0) at thread.c:227
#6  0x40059f60 in pthread_start_thread () from /lib/i686/libpthread.so.0
#7  0x4005a0fe in pthread_start_thread_event () from /lib/i686/libpthread.so.0
#8  0x40270327 in clone () from /lib/i686/libc.so.6


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 17:56:57 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 17:56:57 +0200
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1112873353.16216.17.camel@africa>
References: <42511110.5000703@gmx.net> <1112872703.16216.15.camel@africa> <1112873353.16216.17.camel@africa>
Message-ID: <200504091756.57311.stefan@lucke.in-berlin.de>

On Donnerstag, 7. April 2005 13:29, Torgeir Veimo wrote:
> On Thu, 2005-04-07 at 12:18 +0100, Torgeir Veimo wrote:
> > On Thu, 2005-04-07 at 12:57 +0200, Stefan Lucke wrote:
> > > Quoting Torgeir Veimo <torgeir at pobox.com>:
> > > 
> > > > On Thu, 2005-04-07 at 12:45 +0200, Stefan Lucke wrote:

> > > > > There is wiki support, but at the start I only activated the minimum
> > > > required
> > > > > features. Should I activate wiki support ?
> > > >
> > > > Yes that would be good.
> > > 
> > > Done. Let's see what happens.
> > > 
> > > >
> > > > I was thinking of doing a first page with a bit nicer design, black
> > > > background and then add a page with in details configuration for at
> > > > least DirectFB, maybe something on vidix (which I've only tried briefly
> > > > btw).
> > 
> > Ok, I've started added content at
> > http://openfacts.berlios.de/index-en.phtml?title=Vdr_Softdevice
> 
> It's a bit dangerous using this wiki, eg. I added an [[Installation]]
> link and got it linked to a completely unrelated page in the OpenFact
> wiki.

Yes it seems to be dangerous as it doesn't require a login. Today's
morning I found some garbadge which I removed. You see that in
the change log.

-- 
Stefan Lucke



From M.Wache at gmx.net  Sat Apr  9 18:06:28 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 09 Apr 2005 18:06:28 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504091707.24553.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257DC67.8040107@gmx.net> <4257E3F2.9080303@gmx.net> <200504091707.24553.stefan@lucke.in-berlin.de>
Message-ID: <4257FD84.6020901@gmx.net>

Stefan Lucke wrote:

> 
> Yes _most_ of them. No cpu busy any more and most speed changes
> are ok :-) . 
> My test was with vdr-1.3.22. Multispeed mode is disabled:
> When entering slow forward from pause mode, picture
> stays as it is. then after pressing rewind, back speed is faster than 1x
> and then pressing forward. Forward speed is slowmotion now which is ok.
> 
> In vdr-1.2.1 it is the same except that audio is not muted "pmVideoOnly ??"
> during slow forward. But that should not be a major issue.
I think I fixed these issues, but I will investigate this further.

> 
> But I come to a more serious bug. When aspect ratio changes in recordings.
> changes from 4:3 to 16:9 gives a few frames garbage and on change from
> 16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> dissapears.
> 
Sorry, I don't have Torgeirs test stream and I don't have the 
possibility to download large things until monday :-(...

Martin


From torgeir at pobox.com  Sat Apr  9 19:17:56 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 09 Apr 2005 18:17:56 +0100
Subject: [Softdevice-devel] Re: website
In-Reply-To: <200504091756.57311.stefan@lucke.in-berlin.de>
References: <42511110.5000703@gmx.net> <1112872703.16216.15.camel@africa>
	 <1112873353.16216.17.camel@africa>
	 <200504091756.57311.stefan@lucke.in-berlin.de>
Message-ID: <1113067076.4970.3.camel@africa>

On Sat, 2005-04-09 at 17:56 +0200, Stefan Lucke wrote:

> Yes it seems to be dangerous as it doesn't require a login. Today's
> morning I found some garbadge which I removed. You see that in
> the change log.

Yes, it's spammers putting in links tho websites they want to get to the
top in google search hits.

We can just use the wiki as a scratch pad for the website and just
upload the texts when they're ready.

Btw; Martin, I think you need to put your name in the README file,
you've contributed alot to the project lately.. :)

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Apr  9 19:31:37 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 19:31:37 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4257FD84.6020901@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504091707.24553.stefan@lucke.in-berlin.de> <4257FD84.6020901@gmx.net>
Message-ID: <200504091931.37627.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 18:06, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > 
> > Yes _most_ of them. No cpu busy any more and most speed changes
> > are ok :-) . 
> > My test was with vdr-1.3.22. Multispeed mode is disabled:
> > When entering slow forward from pause mode, picture
> > stays as it is. then after pressing rewind, back speed is faster than 1x
> > and then pressing forward. Forward speed is slowmotion now which is ok.
> > 
> > In vdr-1.2.1 it is the same except that audio is not muted "pmVideoOnly ??"
> > during slow forward. But that should not be a major issue.
> I think I fixed these issues, but I will investigate this further.

Thank you very much. This seems to be fixed.

> 
> > 
> > But I come to a more serious bug. When aspect ratio changes in recordings.
> > changes from 4:3 to 16:9 gives a few frames garbage and on change from
> > 16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> > a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> > dissapears.
> > 
> Sorry, I don't have Torgeirs test stream and I don't have the 
> possibility to download large things until monday :-(...

Torgeirs test stream is not required. I've got the segfault  too with
one of my own recordings, when there is a 16:9 -> 4:3 transition.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 20:14:25 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 20:14:25 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4257FD84.6020901@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504091707.24553.stefan@lucke.in-berlin.de> <4257FD84.6020901@gmx.net>
Message-ID: <200504092014.25749.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 18:06, Martin Wache wrote:
> Stefan Lucke wrote:

> > But I come to a more serious bug. When aspect ratio changes in recordings.
> > changes from 4:3 to 16:9 gives a few frames garbage and on change from
> > 16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> > a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> > dissapears.
> > 
> Sorry, I don't have Torgeirs test stream and I don't have the 
> possibility to download large things until monday :-(...

Maybe thats related to the change they did, as I reported dvb instream
aspect ratio changes where not correct detected (action is codec reset now).
But why does that not influence vdr-1.2.1 ?

So we have to wait until you'll have a deeper look at that. At least to
my opinion it's a show stopper for a new release tomorrow.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 20:56:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 20:56:02 +0200
Subject: [Softdevice-devel] Re: website
In-Reply-To: <1113067076.4970.3.camel@africa>
References: <42511110.5000703@gmx.net> <200504091756.57311.stefan@lucke.in-berlin.de> <1113067076.4970.3.camel@africa>
Message-ID: <200504092056.02793.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 19:17, Torgeir Veimo wrote:
> On Sat, 2005-04-09 at 17:56 +0200, Stefan Lucke wrote:
> 
> > Yes it seems to be dangerous as it doesn't require a login. Today's
> > morning I found some garbadge which I removed. You see that in
> > the change log.
> 
> Yes, it's spammers putting in links tho websites they want to get to the
> top in google search hits.
> 
> We can just use the wiki as a scratch pad for the website and just
> upload the texts when they're ready.
> 
> Btw; Martin, I think you need to put your name in the README file,
> you've contributed alot to the project lately.. :)

He is in. The softdevice development team: ..
In the hall of fame section there are other people to mention
who spend code. But there should be no email addresses as they
could change and scanned.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat Apr  9 23:32:24 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 9 Apr 2005 23:32:24 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504092014.25749.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257FD84.6020901@gmx.net> <200504092014.25749.stefan@lucke.in-berlin.de>
Message-ID: <200504092332.24544.stefan@lucke.in-berlin.de>

On Samstag, 9. April 2005 20:14, Stefan Lucke wrote:
> On Samstag, 9. April 2005 18:06, Martin Wache wrote:
> > Stefan Lucke wrote:
> 
> > > But I come to a more serious bug. When aspect ratio changes in recordings.
> > > changes from 4:3 to 16:9 gives a few frames garbage and on change from
> > > 16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> > > a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> > > dissapears.
> > > 
> > Sorry, I don't have Torgeirs test stream and I don't have the 
> > possibility to download large things until monday :-(...
> 
> Maybe thats related to the change they did, as I reported dvb instream
> aspect ratio changes where not correct detected (action is codec reset now).
> But why does that not influence vdr-1.2.1 ?
> 
> So we have to wait until you'll have a deeper look at that. At least to
> my opinion it's a show stopper for a new release tomorrow.

Segfault was introduced on 2005-04-02. checkout with -D 2005-04-02 is ok
and -D 2005-04-03 segfaults.

-- 
Stefan Lucke



From M.Wache at gmx.net  Sun Apr 10 09:28:01 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 10 Apr 2005 09:28:01 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504092332.24544.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <4257FD84.6020901@gmx.net> <200504092014.25749.stefan@lucke.in-berlin.de> <200504092332.24544.stefan@lucke.in-berlin.de>
Message-ID: <4258D581.2040309@gmx.net>

Stefan Lucke wrote:
> On Samstag, 9. April 2005 20:14, Stefan Lucke wrote:
> 
>>On Samstag, 9. April 2005 18:06, Martin Wache wrote:
>>
>>>Stefan Lucke wrote:
>>
>>>>But I come to a more serious bug. When aspect ratio changes in recordings.
>>>>changes from 4:3 to 16:9 gives a few frames garbage and on change from
>>>>16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
>>>>a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
>>>>dissapears.
>>>>
>>>
>>>Sorry, I don't have Torgeirs test stream and I don't have the 
>>>possibility to download large things until monday :-(...
>>
>>Maybe thats related to the change they did, as I reported dvb instream
>>aspect ratio changes where not correct detected (action is codec reset now).
>>But why does that not influence vdr-1.2.1 ?
>>
>>So we have to wait until you'll have a deeper look at that. At least to
>>my opinion it's a show stopper for a new release tomorrow.
> 
> 
> Segfault was introduced on 2005-04-02. checkout with -D 2005-04-02 is ok
> and -D 2005-04-03 segfaults.
> 
For mpeg2decoder there was only a change on 2005-04-02, which was the 
introduction of the packet mode. Is this change included in the last 
working version? However I doubt that this change causes the segfaults. 
I suspect a error in libavcodec. Which version do you use?
The only possibility we could break things would be that we skip/add 
bytes on the input to libavformat, but why should we do that on aspect 
ratio changes (we don't even know about them before libavcodec passes 
the information to us...). Or tries vdr to detect the aspect ratio 
changes and does something?
This is very strange... I will check my recordings for aspect ratio 
changes...

Bye,
Martin


From stefan at lucke.in-berlin.de  Sun Apr 10 10:13:25 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 10:13:25 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4258D581.2040309@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504092332.24544.stefan@lucke.in-berlin.de> <4258D581.2040309@gmx.net>
Message-ID: <200504101013.25181.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 09:28, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Samstag, 9. April 2005 20:14, Stefan Lucke wrote:
> > 
> >>On Samstag, 9. April 2005 18:06, Martin Wache wrote:
> >>
> >>>Stefan Lucke wrote:
> >>
> >>>>But I come to a more serious bug. When aspect ratio changes in recordings.
> >>>>changes from 4:3 to 16:9 gives a few frames garbage and on change from
> >>>>16:9 to 4:3 (thats Torgeir's test stream) I get segfaults. When skipping back
> >>>>a few (2 or 3) times (back over 4:3-> 16:9 transition) viewable garbadge
> >>>>dissapears.
> >>>>
> >>>
> >>>Sorry, I don't have Torgeirs test stream and I don't have the 
> >>>possibility to download large things until monday :-(...
> >>
> >>Maybe thats related to the change they did, as I reported dvb instream
> >>aspect ratio changes where not correct detected (action is codec reset now).
> >>But why does that not influence vdr-1.2.1 ?
> >>
> >>So we have to wait until you'll have a deeper look at that. At least to
> >>my opinion it's a show stopper for a new release tomorrow.
> > 
> > 
> > Segfault was introduced on 2005-04-02. checkout with -D 2005-04-02 is ok
> > and -D 2005-04-03 segfaults.
> > 
> For mpeg2decoder there was only a change on 2005-04-02, which was the 
> introduction of the packet mode. Is this change included in the last 
> working version? 

No.  -D 2004-04-02 includes only changes up to 2005-04-01 inclusive.
I even backed out my change, but that pointer check before accessing
pan_scan info does not cause the segfault. I don't see any harm in your
change too. As it sometimes cross the aspect ratio change 16:9 -> 4:3
without segfaults, but with the following messages:

[mpeg2video @ 0x40612b08]invalid mb type in I Frame at 4 0
[mpeg2video @ 0x40612b08]Warning MVs not available
[mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
[mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
[mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors

I suspect a fault in ffmpeg too, or a fault related to threads, locking ..

> However I doubt that this change causes the segfaults. 
> I suspect a error in libavcodec. Which version do you use?

A cvs version from 2005-04-01 I guess with mpeg12.c update for
acpect ratio detection form Ivan Kalvachev (iive) from 2005-04-03.
But it the same which works without our change and which doesn't.

> The only possibility we could break things would be that we skip/add 
> bytes on the input to libavformat, but why should we do that on aspect 
> ratio changes (we don't even know about them before libavcodec passes 
> the information to us...). Or tries vdr to detect the aspect ratio 
> changes and does something?

I think vdr detects some and does something.

> This is very strange... I will check my recordings for aspect ratio 
> changes...

-- 
Stefan Lucke



From M.Wache at gmx.net  Sun Apr 10 11:19:25 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 10 Apr 2005 11:19:25 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504101013.25181.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504092332.24544.stefan@lucke.in-berlin.de> <4258D581.2040309@gmx.net> <200504101013.25181.stefan@lucke.in-berlin.de>
Message-ID: <4258EF9D.3020500@gmx.net>

Stefan Lucke wrote:

> No.  -D 2004-04-02 includes only changes up to 2005-04-01 inclusive.
> I even backed out my change, but that pointer check before accessing
> pan_scan info does not cause the segfault. I don't see any harm in your
> change too. As it sometimes cross the aspect ratio change 16:9 -> 4:3
> without segfaults, but with the following messages:
> 
> [mpeg2video @ 0x40612b08]invalid mb type in I Frame at 4 0
> [mpeg2video @ 0x40612b08]Warning MVs not available
> [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> 
> I suspect a fault in ffmpeg too, or a fault related to threads, locking ..
> 
For some reason we send junk to libavcodec. Please check if PlayVideo or 
PlayAudio is called with negative Length at any point. If it is called 
with negative length that would explain that we send junk to libavcodec.

> I think vdr detects some and does something.
Maybe it is some strange interaction of various reasons. Unfortunatly I 
did not find a recording with a transition. I usually convert all 
recordings to mpeg4 right after recording...
But I will have a look at what vdr does, maybe that helps understanding 
what happens...

Bye,
Martin


From stefan at lucke.in-berlin.de  Sun Apr 10 13:14:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 13:14:26 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <4258EF9D.3020500@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504101013.25181.stefan@lucke.in-berlin.de> <4258EF9D.3020500@gmx.net>
Message-ID: <200504101314.26249.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 11:19, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > No.  -D 2004-04-02 includes only changes up to 2005-04-01 inclusive.
> > I even backed out my change, but that pointer check before accessing
> > pan_scan info does not cause the segfault. I don't see any harm in your
> > change too. As it sometimes cross the aspect ratio change 16:9 -> 4:3
> > without segfaults, but with the following messages:
> > 
> > [mpeg2video @ 0x40612b08]invalid mb type in I Frame at 4 0
> > [mpeg2video @ 0x40612b08]Warning MVs not available
> > [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> > [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> > [mpeg2video @ 0x40612b08]concealing 1584 DC, 1584 AC, 1584 MV errors
> > 
> > I suspect a fault in ffmpeg too, or a fault related to threads, locking ..
> > 
> For some reason we send junk to libavcodec. Please check if PlayVideo or 
> PlayAudio is called with negative Length at any point. If it is called 
> with negative length that would explain that we send junk to libavcodec.

All avcodec_decode..() is done first, in a loop "while (size > 0)" so I don't
think thats the cause. Googling for "ff_mpeg1_find_frame_end" shows
a segfault with, guess what, vdr+softdevice, on vdr list some months ago.
FF_INPUT_BUFFER_PADDING_SIZE is a hint. Nicolas reported that.

from avcodec.h
/**
 * Required number of additionally allocated bytes at the end of the input bitstream for decoding.
 * this is mainly needed because some optimized bitstream readers read
 * 32 or 64 bit at once and could read over the end<br>
 * Note, if the first 23 bits of the additional bytes are not 0 then damaged
 * MPEG bitstreams could cause overread and segfault
 */
#define FF_INPUT_BUFFER_PADDING_SIZE 8

-- 
Stefan Lucke



From M.Wache at gmx.net  Sun Apr 10 13:46:06 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 10 Apr 2005 13:46:06 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504101314.26249.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504101013.25181.stefan@lucke.in-berlin.de> <4258EF9D.3020500@gmx.net> <200504101314.26249.stefan@lucke.in-berlin.de>
Message-ID: <425911FE.8030104@gmx.net>

>>For some reason we send junk to libavcodec. Please check if PlayVideo or 
>>PlayAudio is called with negative Length at any point. If it is called 
>>with negative length that would explain that we send junk to libavcodec.
> 
> 
> All avcodec_decode..() is done first, in a loop "while (size > 0)" so I don't
> think thats the cause. 
I didn't mean the call to DecodePacket, but before in softdevice.c. If 
PlayVideo or PlayFrame is called with a Length of -1 or -2 stupid things 
may happen due to the new packet mode.


Googling for "ff_mpeg1_find_frame_end" shows
> a segfault with, guess what, vdr+softdevice, on vdr list some months ago.
> FF_INPUT_BUFFER_PADDING_SIZE is a hint. Nicolas reported that.
> 
> from avcodec.h
> /**
>  * Required number of additionally allocated bytes at the end of the input bitstream for decoding.
>  * this is mainly needed because some optimized bitstream readers read
>  * 32 or 64 bit at once and could read over the end<br>
>  * Note, if the first 23 bits of the additional bytes are not 0 then damaged
>  * MPEG bitstreams could cause overread and segfault
>  */
> #define FF_INPUT_BUFFER_PADDING_SIZE 8
> 

This is already taken care of by libavformat. Check in 
libavformat/mpeg.c. They call av_new_packet() for each new packet, which 
is in libavformat/utils.c and correctly sets up the padding bytes...

I experienced some instabilities in libavcodec due to bad signal using 
the CVS recently. Ffmpeg-0.4.9pre1 seems to be more stable, did you try 
to go back to ffmpeg-0.4.9pre1?

Bye,
Martin


From ollo.diab at gmx.de  Sun Apr 10 17:38:49 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Sun, 10 Apr 2005 17:38:49 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
References: <425911FE.8030104@gmx.net>
Message-ID: <21847.1113147529@www73.gmx.net>

Hi Stefan & Martin,

thanks a lot for your work on softdevice plugin. It's getting better and
better!

But I have an issue with HDTV where softdevice started with -vo xv:max-area
does start to show HDTV picture, but keeps interrupting the decoding. I get
in the console window the folloing output:

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[ProcessArgs] xv: using max available area
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 1 lavc
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4752)
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 2040 x 2046
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
[softdevice] allocating picture buffer for resolution 720x576
[softdevice] allocating picture buffer for resolution 720x576
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088
[softdevice] allocating picture buffer for resolution 1920x1088

while the last message keeps repeating.

Any idea what goes wrong?

Thanks,   Thomas

BTW: The scaled HDTV output on a 720x576 window (when switching from STV to
HDTV channel) has an offset, means there are some rows on the right side cut
off the picture. By setting the window to full screen, one can see the whole
HDTV picture, but when switched back to small window, the right side
disappears again.


-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl


From stefan at lucke.in-berlin.de  Sun Apr 10 22:07:57 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 22:07:57 +0200
Subject: [Softdevice-devel] recent cvs & HDTV issue
In-Reply-To: <21847.1113147529@www73.gmx.net>
References: <425911FE.8030104@gmx.net> <21847.1113147529@www73.gmx.net>
Message-ID: <200504102207.57625.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 17:38, Thomas Herrmann wrote:
> Hi Stefan & Martin,
> 
> thanks a lot for your work on softdevice plugin. It's getting better and
> better!
> 
> But I have an issue with HDTV where softdevice started with -vo xv:max-area
> does start to show HDTV picture, but keeps interrupting the decoding. I get
> in the console window the folloing output:

> [softdevice] allocating picture buffer for resolution 720x576
> [softdevice] allocating picture buffer for resolution 720x576
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> 
> while the last message keeps repeating.
> 
> Any idea what goes wrong?
> 
> Thanks,   Thomas
> 
> BTW: The scaled HDTV output on a 720x576 window (when switching from STV to
> HDTV channel) has an offset, means there are some rows on the right side cut
> off the picture. By setting the window to full screen, one can see the whole
> HDTV picture, but when switched back to small window, the right side
> disappears again.

Can you post for both cases an excerpt of your syslog to see which
scaleing information we use and how the messgaes describing the
stream info look like ?

example:
vdr[7030]: [VideoOut]: aspect changed (9 -> 0 ; 1,333333 -> 1,333333)
vdr[7030]: [VideoOut]: 720x576 [0,0 720x576] -> 1024x576 [128,0 768x576]


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Apr 10 22:08:37 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 22:08:37 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <425911FE.8030104@gmx.net>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504101314.26249.stefan@lucke.in-berlin.de> <425911FE.8030104@gmx.net>
Message-ID: <200504102208.37340.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 13:46, Martin Wache wrote:

> I experienced some instabilities in libavcodec due to bad signal using 
> the CVS recently. Ffmpeg-0.4.9pre1 seems to be more stable, did you try 
> to go back to ffmpeg-0.4.9pre1?

Finally I think its ffmpegs change I triggered on April 2nd, which is
related to aspect ratio change detection. I backed out mpeg12.c change
from rev 1.227 to 1.228 and used my rejected patch instead. This
results in no segfaults and correct a/r change detection. I'm currently
discussing that on ffmpeg-devel.

If Thomas's mail would not be here, we would be ready for 0.1.1 .
But I'll have a look at that too.

-- 
Stefan Lucke



From marko.makela at hut.fi  Sun Apr 10 23:12:33 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 11 Apr 2005 00:12:33 +0300
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504102208.37340.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504101314.26249.stefan@lucke.in-berlin.de> <425911FE.8030104@gmx.net> <200504102208.37340.stefan@lucke.in-berlin.de>
Message-ID: <20050410211233.GB53784@kosh.hut.fi>

Stefan,

> If Thomas's mail would not be here, we would be ready for 0.1.1 .
> But I'll have a look at that too.

There is something wrong with DirectFB output of subtitles.  Xv output
works just fine, but DirectFB doesn't show any subtitles, while a snapshot
from a few weeks ago does (although not properly synchronized).

Martin suggested me to downgrade the cDFBVideoOut::Refresh() methods
in video-dfb.c to -r1.19.  I tried that, but then VDR wouldn't react
on the remote control.  Could you please advise, and perhaps also have
a look at the sample I emailed you about?  Martin is unable to test
DirectFB output on his system.

	Marko


From marko.makela at hut.fi  Sun Apr 10 23:29:13 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 11 Apr 2005 00:29:13 +0300
Subject: [Softdevice-devel] Thoughts on testing and standards compliance
In-Reply-To: <425136C8.20102@e-dition.fr>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <424D228D.2090504@e-dition.fr> <20050401215110.GB64921@kosh.hut.fi> <425136C8.20102@e-dition.fr>
Message-ID: <20050410212913.GC53784@kosh.hut.fi>

On Mon, Apr 04, 2005 at 02:44:56PM +0200, Nicolas Huillard wrote:
> UTF-8 is something Klaus does not like. I also think that DVB did not 
> standardized over it, and simply uses 8-bit character sets (maybe 
> sometimes without even transmiting which character set is used, which 
> poses problems in some countries).

I could imagine that someone in Poland would want to view some Russian
channels.  The most natural choice would be Unicode.  Otherwise, Polish
would need ISO 8859-2, and Russian would need some other 8-bit character
set.  (I'm not sure if there are any Russian DVB senders yet.  I live too
far from the border to receive anything from there with a normal antenna.)
Same thing on Balkan: I've been told that Croatian and Serbian are
roughly the same language.  One is written in Latin characters, possibly
with some diacritical marks, and the other is written in Cyrillic alphabet.
And someone might want to view Latin, Cyrillic and Greek EPG at the same
time.

> WTR UTF8, Klaus simply does not like it, and see the need to add many 
> transcoding frontiers to add in the core of VDR. The case is currently 
> "let the user select which 8-bit character set he prefers". UTF8 would 
> add transcoding from DVB streams, from and to files, etc. Many 
> "unnecessary" steps (I regularly use UTF8, so I know what steps it 
> involves when you have to exchange data with other systems).

I think that the iconv library could be worth looking at.  It could be a
compile-time option, i.e., read/write the summary.txt in UTF8 and generate
file names in UTF8.

Later on, VDR could use Unicode internally and combine all the 8-bit fonts
to a single Unicode font.  Admittedly, that would be a lot more work, and
then the iconv library (or similar) would be a mandatory dependence.

> >Well, excluding font bitmaps, VDR is only about 30,000 lines of code.  It
> >shouldn't be too hard to implement something similar based on softdevice 
> >and
> >budget cards like the Hauppauge Nova-T.
> 
> Well, that's still a lot of lines ! When I thought about what VDR really 
> is, or what is could be replaced by (reasoning in terms of what 
> libraries/programs provide the same core functionnality), I deduced that 
> it's not that much (live TV = xine/mplayer, timer = cron, EPG = DB + 
> scripting, recordings = xine/mplayer, OSD = the glue, etc...)
> But the real value of VDR is the fact that it's expandable, really 
> integrated, bug-free, has very few dependencies, has a strong community, 
> attracts many developers, thus new plug-ins, etc.

True.  It would probably take at least a man-year of full-time programming
to achieve something similar to VDR.  The advantages of VDR clearly outweigh
its problems.  And as I can't contribute much programming to this project,
I should really shut up.

I apologize if my message offended anyone.  I'm definitely going to use VDR
despite its small shortcomings.

	Marko


From stefan at lucke.in-berlin.de  Sun Apr 10 23:52:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 23:52:26 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <200504102208.37340.stefan@lucke.in-berlin.de>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <425911FE.8030104@gmx.net> <200504102208.37340.stefan@lucke.in-berlin.de>
Message-ID: <200504102352.26625.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 22:08, Stefan Lucke wrote:
> On Sonntag, 10. April 2005 13:46, Martin Wache wrote:
> 
> > I experienced some instabilities in libavcodec due to bad signal using 
> > the CVS recently. Ffmpeg-0.4.9pre1 seems to be more stable, did you try 
> > to go back to ffmpeg-0.4.9pre1?
> 
> Finally I think its ffmpegs change I triggered on April 2nd, which is
> related to aspect ratio change detection. I backed out mpeg12.c change
> from rev 1.227 to 1.228 and used my rejected patch instead. This
> results in no segfaults and correct a/r change detection. I'm currently
> discussing that on ffmpeg-devel.
> 
> If Thomas's mail would not be here, we would be ready for 0.1.1 .
> But I'll have a look at that too.

I think as this is a problem for a special stream from (HDTV) it
will be fixed in the near future. So I'm going to release 0.1.1 .

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Apr 10 23:57:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 10 Apr 2005 23:57:58 +0200
Subject: [Softdevice-devel] some issues with current cvs
In-Reply-To: <20050410211233.GB53784@kosh.hut.fi>
References: <200504091539.42728.stefan@lucke.in-berlin.de> <200504102208.37340.stefan@lucke.in-berlin.de> <20050410211233.GB53784@kosh.hut.fi>
Message-ID: <200504102357.58561.stefan@lucke.in-berlin.de>

On Sonntag, 10. April 2005 23:12, Marko M?kel? wrote:
> Stefan,
> 
> > If Thomas's mail would not be here, we would be ready for 0.1.1 .
> > But I'll have a look at that too.
> 
> There is something wrong with DirectFB output of subtitles.  Xv output
> works just fine, but DirectFB doesn't show any subtitles, while a snapshot
> from a few weeks ago does (although not properly synchronized).

Thanks for your samples. I'll have a look at that issue when I replace
the radeon with my martox on my development system.

> 
> Martin suggested me to downgrade the cDFBVideoOut::Refresh() methods
> in video-dfb.c to -r1.19.  I tried that, but then VDR wouldn't react
> on the remote control.  Could you please advise, and perhaps also have
> a look at the sample I emailed you about?  Martin is unable to test
> DirectFB output on his system.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Apr 11 00:12:38 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 11 Apr 2005 00:12:38 +0200
Subject: [Softdevice-devel] [ANNOUNCE] vdr-softdevice-0.1.1
Message-ID: <200504110012.38689.stefan@lucke.in-berlin.de>

Hello,

I'm pleased to announce a new release of vdr softdevice plugin.

In short words: softdevice plugin is for getting vdr to your desktop with
so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
DirectFB or vidix to your screen. Decoding is done via ffmpeg.

For compile options, please read the Makefile carefully and decide which of
the available output methods fit to your system.

Plugin's homepage is located at: http://softdevice.berlios.de/

Changelog since last release:

2005-04-10: softdevice-0.1.1
    - xv-out: add "-vo xv:full" option to start up in fullsceen mode
    - dfb-out: added dfb version check for struct access
    - replace unneeded usleep<10000usec with >=10000usec
    - add SIG_TIMING option (default: disabled, enable in mpeg2decoder.c)
    - introduce meaningful return values in packet mode.
    - disable debugging output.
2005-04-09:
    - xv-out: new command line option max-area to use the maximum
              available area for decoded frames. " .. -vo xv:max-area .. "
2005-04-02:
    - video.c: fix possible segfault if pan_scan info is not present
2005-03-28:
    - dfb-out: chg. OSD drawing to update only modified areas.
               chg. videolayer to double buffered.
               report surface capabilities in a single line
2005-03-25:
    - respect replay mode
    - disable WaitForSync in video only mode (trickspeed mode)
    - removed unused code
2005-03-20:
    - video.c, Draw(): set rgb to zero (colorkey) if alpha is zero.
    - preperations for sync on video option
    - syncronize audio and video start
    - all pts values now in units of 0.1ms (needed for 44.1kHz audio streams)
    - add SpuDecoder
2005-03-19:
    - fix compile problems for vdr-1.2.x (OSD ok, but _no_ A/V :-( ).
2005-03-17:
    - add left/right channel only support
    - be more precise in GetSTC
    - use libavformat for PES stream parsing
2005-03-15:
    - get cvs version of dvd-plugin work in _non_ ac3 mode
 2005-03-11:
    - xv-out: fix OSD misplacement in downscaleing mode (pseudo mode)
    - fix OSD misplacement for software alpha when in crop mode (info menu)
 2005-03-10:
    - xv-out: support max available area (pre for hdtv spport)
    - audio-out: new dummy device (-ao dummy:)
                 audio device constructor gets pointer to setup-store like video-out
    - save options when called via main menu


By subscribing to the to cvs list via
https://lists.berlios.de/mailman/listinfo/softdevice-cvs
you'll get informed about lastest changes.

For those who are interested in active development, subscribing to
https://lists.berlios.de/mailman/listinfo/softdevice-devel
is a good choice.

Members of softdevice development crew are:
Torgeir Veimo, Martin Wache and me, Stefan Lucke.

-- 
Stefan Lucke



From ollo.diab at gmx.de  Mon Apr 11 09:01:54 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Mon, 11 Apr 2005 09:01:54 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
References: <200504102207.57625.stefan@lucke.in-berlin.de>
Message-ID: <5074.1113202914@www4.gmx.net>

> > 
> > BTW: The scaled HDTV output on a 720x576 window (when switching from STV
> to
> > HDTV channel) has an offset, means there are some rows on the right side
> cut
> > off the picture. By setting the window to full screen, one can see the
> whole
> > HDTV picture, but when switched back to small window, the right side
> > disappears again.
> 
> Can you post for both cases an excerpt of your syslog to see which
> scaleing information we use and how the messgaes describing the
> stream info look like ?
> 
> example:
> vdr[7030]: [VideoOut]: aspect changed (9 -> 0 ; 1,333333 -> 1,333333)
> vdr[7030]: [VideoOut]: 720x576 [0,0 720x576] -> 1024x576 [128,0 768x576]

Hi Stefan,

do I need to enable debugging during compile of softdevice to get sch
messages? I have quickly greped through my syslog and didn'f find any such
message. I will take another look later today.

Anyhow, just to make it clear, the picture cut off on the right side of the
video as described before happens since the first time HDTV works.

Regards,   Thomas

> 
> 
> -- 
> Stefan Lucke
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Handyrechnung zu hoch? Tipp: SMS und MMS mit GMX
Seien Sie so frei: Alle Infos unter http://www.gmx.net/de/go/freesms


From stefan at lucke.in-berlin.de  Mon Apr 11 09:22:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 11 Apr 2005 09:22:58 +0200
Subject: [Softdevice-devel] recent cvs & HDTV issue
In-Reply-To: <5074.1113202914@www4.gmx.net>
References: <200504102207.57625.stefan@lucke.in-berlin.de> <5074.1113202914@www4.gmx.net>
Message-ID: <1113204178.425a25d2d792c@webmail.in-berlin.de>

Quoting Thomas Herrmann <ollo.diab at gmx.de>:

> > example:
> > vdr[7030]: [VideoOut]: aspect changed (9 -> 0 ; 1,333333 -> 1,333333)
> > vdr[7030]: [VideoOut]: 720x576 [0,0 720x576] -> 1024x576 [128,0 768x576]
>
> Hi Stefan,
>
> do I need to enable debugging during compile of softdevice to get sch
> messages?

No, they are written allways. They are written with dsyslog(), which is a define
and will actually translate to: syslog(LOG_DEBUG, ..). So it may depend
on your syslog configuration where they actually appear. Even you can change
logging information via vdr at runtime "-l n[.m]". Default is loglevel 3,
debug message are written.

> I have quickly greped through my syslog and didn'f find any such
> message. I will take another look later today.
>
> Anyhow, just to make it clear, the picture cut off on the right side of the
> video as described before happens since the first time HDTV works.
>

Ah. When in windowed mode, how much of the right side is cut off ?

Stefan Lucke


From ollo.diab at gmx.de  Mon Apr 11 10:50:18 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Mon, 11 Apr 2005 10:50:18 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
References: <1113204178.425a25d2d792c@webmail.in-berlin.de>
Message-ID: <6908.1113209418@www43.gmx.net>

> Quoting Thomas Herrmann <ollo.diab at gmx.de>:
> 
> > > example:
> > > vdr[7030]: [VideoOut]: aspect changed (9 -> 0 ; 1,333333 -> 1,333333)
> > > vdr[7030]: [VideoOut]: 720x576 [0,0 720x576] -> 1024x576 [128,0
> 768x576]
> >
> > Hi Stefan,
> >
> > do I need to enable debugging during compile of softdevice to get such
> > messages?
> 
> No, they are written allways. They are written with dsyslog(), which is a
> define
> and will actually translate to: syslog(LOG_DEBUG, ..). So it may depend
> on your syslog configuration where they actually appear. Even you can
> change
> logging information via vdr at runtime "-l n[.m]". Default is loglevel 3,
> debug message are written.
> 
> > I have quickly greped through my syslog and didn'f find any such
> > message. I will take another look later today.
> >
> > Anyhow, just to make it clear, the picture cut off on the right side of
> the
> > video as described before happens since the first time HDTV works.
> >
> 
> Ah. When in windowed mode, how much of the right side is cut off ?

I would guess 1/8th or 1/16th of the video width gets cut off. For instance
the logo of HD1 is not visuable when in windowed mode.

Thomas

> 
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Handyrechnung zu hoch? Tipp: SMS und MMS mit GMX
Seien Sie so frei: Alle Infos unter http://www.gmx.net/de/go/freesms


From M.Wache at gmx.net  Mon Apr 11 17:50:37 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 11 Apr 2005 17:50:37 +0200
Subject: [Softdevice-devel] recent cvs & HDTV issue
In-Reply-To: <21847.1113147529@www73.gmx.net>
References: <425911FE.8030104@gmx.net> <21847.1113147529@www73.gmx.net>
Message-ID: <425A9CCD.3000807@gmx.net>

Thomas Herrmann wrote:

> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> cSoftDevice::MakePrimaryDevice
> [softdevice] allocating picture buffer for resolution 720x576
> [softdevice] allocating picture buffer for resolution 720x576
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
> [softdevice] allocating picture buffer for resolution 1920x1088
These messages come frome the deinterlacing. Are you sure that you have 
enough CPU power to watch HDTV with lavc-deinterlacing enabled? If you 
don't have enought CPU power the video buffer runs full (by the way the 
A-V sync will be bad as well) and it will be cleared at some point, so 
some parts of the playback will be skipped.
To verify this you can enable the CMDDEB in mpeg2decoder.c (just 
uncomment the line starting with //#define CMDDEB(out..) and recompile).
Or just disable lavc-deinterlacing...

Bye,
Martin


From ollo.diab at gmx.de  Mon Apr 11 19:40:05 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Mon, 11 Apr 2005 19:40:05 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
Message-ID: <19214.1113241205@www15.gmx.net>

Hi Martin,

> Thomas Herrmann wrote:
> 
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > cSoftDevice::MakePrimaryDevice
> > [softdevice] allocating picture buffer for resolution 720x576
> > [softdevice] allocating picture buffer for resolution 720x576
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> These messages come frome the deinterlacing. Are you sure that you have 
> enough CPU power to watch HDTV with lavc-deinterlacing enabled? If you 
> don't have enought CPU power the video buffer runs full (by the way the 
> A-V sync will be bad as well) and it will be cleared at some point, so 
> some parts of the playback will be skipped.
> To verify this you can enable the CMDDEB in mpeg2decoder.c (just 
> uncomment the line starting with //#define CMDDEB(out..) and recompile).
> Or just disable lavc-deinterlacing...

You might be right. I just checked the syslog and do see some buffer
overruns. The odd thing is, I can watch HDTV streams (recorded with VDR
while suspending softdevice) with mplayer using the xv video out driver
without skips. So might be just to small buffers?

Please find attached the syslog as well as the console output when switching
from STV to HDTV and back.

Regards,   Thomas


> 
> Bye,
> Martin
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: softdev.log.gz
Type: application/gzip
Size: 3751 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050411/83620063/attachment.bin>

From ollo.diab at gmx.de  Mon Apr 11 19:40:05 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Mon, 11 Apr 2005 19:40:05 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
Message-ID: <19214.1113241205@www15.gmx.net>

Hi Martin,

> Thomas Herrmann wrote:
> 
> > [softdevice] Video Out seems to be OK
> > [softdevice] Initializing Audio Out
> > [softdevice] Audio out seems to be OK
> > [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> > cSoftDevice::MakePrimaryDevice
> > [softdevice] allocating picture buffer for resolution 720x576
> > [softdevice] allocating picture buffer for resolution 720x576
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> > [softdevice] allocating picture buffer for resolution 1920x1088
> These messages come frome the deinterlacing. Are you sure that you have 
> enough CPU power to watch HDTV with lavc-deinterlacing enabled? If you 
> don't have enought CPU power the video buffer runs full (by the way the 
> A-V sync will be bad as well) and it will be cleared at some point, so 
> some parts of the playback will be skipped.
> To verify this you can enable the CMDDEB in mpeg2decoder.c (just 
> uncomment the line starting with //#define CMDDEB(out..) and recompile).
> Or just disable lavc-deinterlacing...

You might be right. I just checked the syslog and do see some buffer
overruns. The odd thing is, I can watch HDTV streams (recorded with VDR
while suspending softdevice) with mplayer using the xv video out driver
without skips. So might be just to small buffers?

Please find attached the syslog as well as the console output when switching
from STV to HDTV and back.

Regards,   Thomas


> 
> Bye,
> Martin
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Sparen beginnt mit GMX DSL: http://www.gmx.net/de/go/dsl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: softdev.log.gz
Type: application/gzip
Size: 3751 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050411/83620063/attachment-0001.bin>

From torgeir at pobox.com  Mon Apr 11 19:44:47 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 11 Apr 2005 18:44:47 +0100
Subject: [Softdevice-devel] recent cvs & HDTV issue
In-Reply-To: <19214.1113241205@www15.gmx.net>
References: <19214.1113241205@www15.gmx.net>
Message-ID: <1113241487.8502.27.camel@africa>

On Mon, 2005-04-11 at 19:40 +0200, Thomas Herrmann wrote:

> The odd thing is, I can watch HDTV streams (recorded with VDR
> while suspending softdevice) with mplayer using the xv video out driver
> without skips. So might be just to small buffers?

Which gfx card do you use? mplayer might be using XvMC decoding if you
have an nvidia gfx card. It speeds up idct and motion compensation
decoding by doing it in hardware. mplayer should report so if it's the
case.

-- 
Torgeir Veimo <torgeir at pobox.com>



From ollo.diab at gmx.de  Mon Apr 11 20:28:26 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Mon, 11 Apr 2005 20:28:26 +0200 (MEST)
Subject: [Softdevice-devel] recent cvs & HDTV issue
References: <1113241487.8502.27.camel@africa>
Message-ID: <26284.1113244106@www81.gmx.net>

> On Mon, 2005-04-11 at 19:40 +0200, Thomas Herrmann wrote:
> 
> > The odd thing is, I can watch HDTV streams (recorded with VDR
> > while suspending softdevice) with mplayer using the xv video out driver
> > without skips. So might be just to small buffers?
> 
> Which gfx card do you use? mplayer might be using XvMC decoding if you
> have an nvidia gfx card. It speeds up idct and motion compensation
> decoding by doing it in hardware. mplayer should report so if it's the
> case.

Hi Torgeir,

yes indeed I do have an nVidia gfx caed, but I do start mplayer with xv to
check the system load while playing HDTV video (goes up to 90%). If maplyer
is strated with xvmc video out driver, the system load drops down to 40%
load. So I would like to see xvmc support in softdevice to have stable HDTV
video play.

Regards,   Thomas


> 
> -- 
> Torgeir Veimo <torgeir at pobox.com>
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
Handyrechnung zu hoch? Tipp: SMS und MMS mit GMX
Seien Sie so frei: Alle Infos unter http://www.gmx.net/de/go/freesms


From lucianm at users.sourceforge.net  Tue Apr 12 01:50:10 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 01:50:10 +0200
Subject: [Softdevice-devel] latest softdevice CVS & latest DirectFB & DFB++ cvs broken??
Message-ID: <425B0D32.6000007@users.sourceforge.net>

Hi,

I just wanted to try the latest CVS df_xine for DVD playback with menus 
under DirectFB, as the CVS history stated they fixed some field parity 
stuff, and this forced me to upgrade also the whole DirectFB stuff.

Did you also experience this with latest DirectFB? I can't find 
"GetCardCapabilities" anywhere in DirectFB or DFB++ sources...



g++ -march=athlon-tbird -O3 -pipe -fomit-frame-pointer -c -DUSE_MMX 
-DUSE_MMX2 -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE 
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DUSE_SUBPLUGINS -DDFB_SUPPORT 
-DPP_LIBAVCODEC -DSUSPEND_BY_KEY -I/usr/include/ -I/usr/include 
-I/usr/include/ffmpeg -I/usr/include/dfb++ -I/usr/include/directfb 
video-dfb.c
video-dfb.c: In function `void reportCardInfo(IDirectFB*)':
video-dfb.c:159: error: `DFBCardCapabilities' undeclared (first use this
    function)
video-dfb.c:159: error: (Each undeclared identifier is reported only 
once for
    each function it appears in.)
video-dfb.c:159: error: parse error before `;' token
video-dfb.c:161: error: `caps' undeclared (first use this function)
video-dfb.c:161: error: `GetCardCapabilities' undeclared (first use this
    function)
make: *** [video-dfb.o] Error 1



Lucian


From torgeir at pobox.com  Tue Apr 12 01:58:15 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 12 Apr 2005 00:58:15 +0100
Subject: [Softdevice-devel] latest softdevice CVS & latest DirectFB &
	DFB++ cvs broken??
In-Reply-To: <425B0D32.6000007@users.sourceforge.net>
References: <425B0D32.6000007@users.sourceforge.net>
Message-ID: <1113263895.8502.32.camel@africa>

On Tue, 2005-04-12 at 01:50 +0200, Lucian Muresan wrote:
> Hi,
> 
> I just wanted to try the latest CVS df_xine for DVD playback with menus 
> under DirectFB, as the CVS history stated they fixed some field parity 
> stuff, and this forced me to upgrade also the whole DirectFB stuff.
> 
> Did you also experience this with latest DirectFB? I can't find 
> "GetCardCapabilities" anywhere in DirectFB or DFB++ sources...

Yes, just comment out the body of the method that uses it for now..

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Tue Apr 12 07:41:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 12 Apr 2005 07:41:02 +0200
Subject: [Softdevice-devel] latest softdevice CVS & latest DirectFB & DFB++ cvs broken??
In-Reply-To: <1113263895.8502.32.camel@africa>
References: <425B0D32.6000007@users.sourceforge.net> <1113263895.8502.32.camel@africa>
Message-ID: <200504120741.02447.stefan@lucke.in-berlin.de>

On Dienstag, 12. April 2005 01:58, Torgeir Veimo wrote:
> On Tue, 2005-04-12 at 01:50 +0200, Lucian Muresan wrote:
> > Hi,
> > 
> > I just wanted to try the latest CVS df_xine for DVD playback with menus 
> > under DirectFB, as the CVS history stated they fixed some field parity 
> > stuff, and this forced me to upgrade also the whole DirectFB stuff.
> > 
> > Did you also experience this with latest DirectFB? I can't find 
> > "GetCardCapabilities" anywhere in DirectFB or DFB++ sources...
> 
> Yes, just comment out the body of the method that uses it for now..

Luckily that information is not used for further processing, so we
can remove that entierly. Otherwise it would require autogen ..
and we would have to include a configure script in releases as
autogen etc. is targeted at developers. Ah my configure script
generated for directfb is about 820KB and 150 KB compressed
(twice as much as our 0.1.1 release) !!

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Tue Apr 12 09:12:09 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 09:12:09 +0200
Subject: [Softdevice-devel] latest softdevice CVS & latest DirectFB &
 DFB++ cvs broken??
In-Reply-To: <200504120741.02447.stefan@lucke.in-berlin.de>
References: <425B0D32.6000007@users.sourceforge.net> <1113263895.8502.32.camel@africa> <200504120741.02447.stefan@lucke.in-berlin.de>
Message-ID: <425B74C9.6040607@users.sourceforge.net>

Stefan Lucke wrote:
...
>> > Did you also experience this with latest DirectFB? I can't find 
>> > "GetCardCapabilities" anywhere in DirectFB or DFB++ sources...
>> 
>> Yes, just comment out the body of the method that uses it for now..
> 
> Luckily that information is not used for further processing, so we
> can remove that entierly. Otherwise it would require autogen ..
> and we would have to include a configure script in releases as
> autogen etc. is targeted at developers. Ah my configure script
> generated for directfb is about 820KB and 150 KB compressed
> (twice as much as our 0.1.1 release) !!

Yes, thanks, both of you, I commented the whole thing out and now 
softdevice compiled properly. Unfortunately, working the same as with 
DirectFB-0.9.22, otherwise it's the only app linked against 0.9.23 which 
seems to at least start (not even df_xine from DirectFB-extra works 
properly anymire, I'll have to revert to previous DirectFB/DFB++). Well, 
as of softdevice, I'll start another thread...

Lucian


From lucianm at users.sourceforge.net  Tue Apr 12 09:35:24 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 09:35:24 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
Message-ID: <425B7A3C.4060102@users.sourceforge.net>

Hi!

Well, I promised another thread, now here it is. I tried the latest CVS 
of softdevice, and softdevice-0.1.1 as well, (tried the CVS version 
which I think is not yet too different from 0.1.1 also with 
DirectFB/DFB++ 0.9.22 and last CVS checkout, 0.9.23 as you know from my 
other posting), and it's no longer usable for me. I'm experiencing the 
biggest judder (looks like slow motion) and stuttering and AV 
off-syncronicity I've seen so far in softdevice, on my G400 TV-out. This 
time I invoked properly, I hope:

vdr -c /etc/vdr -L /usr/lib/vdr -P'graphlcd -d noritake800' 
-P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'


I did not find any noticeable debug output in the console or in the log.

Stefan, if I understood correctly, you have a Matrox card too but do not 
use it all the time? And you hooked it on the TV from the first head, 
not from the second, with RGB BNC cable? If you happen to try the Matrox 
card again, could you also please try the TV-out with DirectFB (either 
Composite, SCART/RGB or S-video will do, I only hope you've got that 
Matrox breakout cable(peitsche :-) )? I'm suspecting it's not related to 
differences between Matrox G400 and G450 or what else your card is, but 
it has to do with the Matrox TV-out in general, interlaced diplaying in 
the right field parity order (which now actually seems to be right, 
thanks for that) and syncing to audio...

Otherwise, thanks for the whole work up to now.

Lucian


From stefan at lucke.in-berlin.de  Tue Apr 12 10:14:47 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 12 Apr 2005 10:14:47 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425B7A3C.4060102@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net>
Message-ID: <1113293687.425b83777b309@webmail.in-berlin.de>

Quoting Lucian Muresan <lucianm at users.sourceforge.net>:
> Stefan, if I understood correctly, you have a Matrox card too but do not
> use it all the time?

No, the time I changed DFB out these checks, tests and development was done
with my G550 with VGA Monitor out _and_ TV composite out.

> And you hooked it on the TV from the first head,
> not from the second, with RGB BNC cable?

No, even that was done via TV out (2nd head) s-video and G400.

> If you happen to try the Matrox
> card again, could you also please try the TV-out with DirectFB (either
> Composite, SCART/RGB or S-video will do, I only hope you've got that
> Matrox breakout cable(peitsche :-) )?

Have to switch development system to matrox back (today). As I
have to implement field parity switch for DV tv-out.

Stefan Lucke


From torgeir at pobox.com  Tue Apr 12 10:23:20 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 12 Apr 2005 09:23:20 +0100
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425B7A3C.4060102@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net>
Message-ID: <1113294201.32648.1.camel@atlantis>

On Tue, 2005-04-12 at 09:35 +0200, Lucian Muresan wrote:
> 
> Well, I promised another thread, now here it is. I tried the latest
> CVS 
> of softdevice, and softdevice-0.1.1 as well, (tried the CVS version 
> which I think is not yet too different from 0.1.1 also with 
> DirectFB/DFB++ 0.9.22 and last CVS checkout, 0.9.23 as you know from
> my 
> other posting), and it's no longer usable for me. I'm experiencing
> the 
> biggest judder (looks like slow motion) and stuttering and AV 
> off-syncronicity I've seen so far in softdevice, on my G400 TV-out. 

This testing is with live tv or recording playback?

-- 
Torgeir Veimo <torgeir at pobox.com>



From lucianm at users.sourceforge.net  Tue Apr 12 10:26:16 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 10:26:16 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <1113293687.425b83777b309@webmail.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <1113293687.425b83777b309@webmail.in-berlin.de>
Message-ID: <425B8628.50309@users.sourceforge.net>

Stefan Lucke wrote:
> Quoting Lucian Muresan <lucianm at users.sourceforge.net>:
>> Stefan, if I understood correctly, you have a Matrox card too but do not
>> use it all the time?
> 
> No, the time I changed DFB out these checks, tests and development was done
> with my G550 with VGA Monitor out _and_ TV composite out.
> 
>> And you hooked it on the TV from the first head,
>> not from the second, with RGB BNC cable?
> 
> No, even that was done via TV out (2nd head) s-video and G400.
> 
>> If you happen to try the Matrox
>> card again, could you also please try the TV-out with DirectFB (either
>> Composite, SCART/RGB or S-video will do, I only hope you've got that
>> Matrox breakout cable(peitsche :-) )?
> 
> Have to switch development system to matrox back (today). As I
> have to implement field parity switch for DV tv-out.

Good to hear, thanks!

Lucian


From lucianm at users.sourceforge.net  Tue Apr 12 10:40:31 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 10:40:31 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425B8628.50309@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net> <1113293687.425b83777b309@webmail.in-berlin.de> <425B8628.50309@users.sourceforge.net>
Message-ID: <425B897F.2090902@users.sourceforge.net>

Lucian Muresan wrote:
..
>> Have to switch development system to matrox back (today). As I
>> have to implement field parity switch for DV tv-out.
> 
> Good to hear, thanks!
> 
> Lucian

Forgot to ask, do you also have SPDIF out?

Lucian


From lucianm at users.sourceforge.net  Tue Apr 12 10:29:44 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Tue, 12 Apr 2005 10:29:44 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <1113294201.32648.1.camel@atlantis>
References: <425B7A3C.4060102@users.sourceforge.net> <1113294201.32648.1.camel@atlantis>
Message-ID: <425B86F8.3070202@users.sourceforge.net>

Torgeir Veimo wrote:
> On Tue, 2005-04-12 at 09:35 +0200, Lucian Muresan wrote:
>> 
>> Well, I promised another thread, now here it is. I tried the latest
>> CVS 
>> of softdevice, and softdevice-0.1.1 as well, (tried the CVS version 
>> which I think is not yet too different from 0.1.1 also with 
>> DirectFB/DFB++ 0.9.22 and last CVS checkout, 0.9.23 as you know from
>> my 
>> other posting), and it's no longer usable for me. I'm experiencing
>> the 
>> biggest judder (looks like slow motion) and stuttering and AV 
>> off-syncronicity I've seen so far in softdevice, on my G400 TV-out. 
> 
> This testing is with live tv or recording playback?
> 

It was live TV, haven't tried recordings. Maybe I will try recordings 
playback tonight after work, but Stefan already said he will switch his 
dev system back to Matrox G400 back today and I hope he will find out 
what's going on.

Lucian


From stefan at lucke.in-berlin.de  Tue Apr 12 11:00:28 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 12 Apr 2005 11:00:28 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425B897F.2090902@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net> <1113293687.425b83777b309@webmail.in-berlin.de> <425B8628.50309@users.sourceforge.net> <425B897F.2090902@users.sourceforge.net>
Message-ID: <1113296428.425b8e2c41934@webmail.in-berlin.de>

Quoting Lucian Muresan <lucianm at users.sourceforge.net>:

> Lucian Muresan wrote:
> ..
> >> Have to switch development system to matrox back (today). As I
> >> have to implement field parity switch for DV tv-out.
> >
> > Good to hear, thanks!
> >
> > Lucian
>
> Forgot to ask, do you also have SPDIF out?

On my production system: yes. But it's hard to get a time slot for testing
there.
Only during night shift :-) .

Stefan Lucke


From M.Wache at gmx.net  Tue Apr 12 18:18:38 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 12 Apr 2005 18:18:38 +0200
Subject: [Softdevice-devel] recent cvs & HDTV issue
In-Reply-To: <19214.1113241205@www15.gmx.net>
References: <19214.1113241205@www15.gmx.net>
Message-ID: <425BF4DE.3040003@gmx.net>

Thomas Herrmann wrote:
> Hi Martin,
> 
> 
>>Thomas Herrmann wrote:
>>
>>
>>>[softdevice] Video Out seems to be OK
>>>[softdevice] Initializing Audio Out
>>>[softdevice] Audio out seems to be OK
>>>[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
>>>cSoftDevice::MakePrimaryDevice
>>>[softdevice] allocating picture buffer for resolution 720x576
>>>[softdevice] allocating picture buffer for resolution 720x576
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>>[softdevice] allocating picture buffer for resolution 1920x1088
>>
>>These messages come frome the deinterlacing. Are you sure that you have 
>>enough CPU power to watch HDTV with lavc-deinterlacing enabled? If you 
>>don't have enought CPU power the video buffer runs full (by the way the 
>>A-V sync will be bad as well) and it will be cleared at some point, so 
>>some parts of the playback will be skipped.
>>To verify this you can enable the CMDDEB in mpeg2decoder.c (just 
>>uncomment the line starting with //#define CMDDEB(out..) and recompile).
>>Or just disable lavc-deinterlacing...
> 
> 
> You might be right. I just checked the syslog and do see some buffer
> overruns. The odd thing is, I can watch HDTV streams (recorded with VDR
> while suspending softdevice) with mplayer using the xv video out driver
> without skips. So might be just to small buffers?
> 
I don't think it is too small buffers, even larger buffers will run full 
if we are too slow. They will just run full a bit later... Hmm ,after 
having a closer look at your log files, vdr clear the buffers every 2-3 
seconds. Maybe you are right and the buffers are too small for HDTV. But 
I don't think it is the only reason...

Did you try to disable deinterlacing? Does it work for you without 
deinterlacing? Did it work for you with softdevice-0.1.0 and 
deinterlacing *enabled*?

I guess I will try to change the buffering a bit, maybe it improves the 
situation...

Bye,
Martin


From stefan at lucke.in-berlin.de  Tue Apr 12 19:48:49 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 12 Apr 2005 19:48:49 +0200
Subject: [Softdevice-devel] DFB-out and subtitle plugin.
Message-ID: <200504121948.49375.stefan@lucke.in-berlin.de>

New Thread.

On Sonntag, 10. April 2005 23:57, Stefan Lucke wrote:
> On Sonntag, 10. April 2005 23:12, Marko M?kel? wrote:
> > Stefan,
> > 
> > > If Thomas's mail would not be here, we would be ready for 0.1.1 .
> > > But I'll have a look at that too.
> > 
> > There is something wrong with DirectFB output of subtitles.  Xv output
> > works just fine, but DirectFB doesn't show any subtitles, while a snapshot
> > from a few weeks ago does (although not properly synchronized).
> 
> Thanks for your samples. I'll have a look at that issue when I replace
> the radeon with my martox on my development system.
> 

Back on my matrox.

> > 
> > Martin suggested me to downgrade the cDFBVideoOut::Refresh() methods
> > in video-dfb.c to -r1.19.  I tried that, but then VDR wouldn't react
> > on the remote control.  Could you please advise, and perhaps also have
> > a look at the sample I emailed you about?  Martin is unable to test
> > DirectFB output on his system.

Still no subtitle plugin (it requires a patched :-( vdr right ?).
In Refresh method there is a TODO section. There may be a
coordinate mismatch between the drawing function and Refresh()
when Draw() does a downscale. Could you set the OSD  y and x
offsets to zero in OSD setup ?

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue Apr 12 23:18:17 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 12 Apr 2005 23:18:17 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425B7A3C.4060102@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net>
Message-ID: <200504122318.17123.stefan@lucke.in-berlin.de>

On Dienstag, 12. April 2005 09:35, Lucian Muresan wrote:
> Hi!
> 
> Well, I promised another thread, now here it is. I tried the latest CVS 
> of softdevice, and softdevice-0.1.1 as well, (tried the CVS version 
> which I think is not yet too different from 0.1.1 also with 
> DirectFB/DFB++ 0.9.22 and last CVS checkout, 0.9.23 as you know from my 
> other posting), and it's no longer usable for me. I'm experiencing the 
> biggest judder (looks like slow motion) and stuttering and AV 
> off-syncronicity I've seen so far in softdevice, on my G400 TV-out. This 
> time I invoked properly, I hope:
> 
> vdr -c /etc/vdr -L /usr/lib/vdr -P'graphlcd -d noritake800' 
> -P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'

Please try that with graphlcd disabled. I'm back on my G550 development
enviroment and I've seen _no_ major issue with tv-out composite.

There are some problems with flickering OSD when not all screen
backbuffers where cleared. Switched to triple buffering too which
seems to fix a "from time to time flicker" when OSD is shown.
And times the OSD _was_ not shown (subtitles ??).

I'll test that tomorrow on my production system.

There might be still an issue with A/V sync which needs some further
testing.

Attached is a cvs diff of my working version which needs some cleanups.
-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dfb-triple-01.diff
Type: text/x-diff
Size: 4412 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050412/faefcdca/attachment.diff>

From M.Wache at gmx.net  Wed Apr 13 00:01:48 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 13 Apr 2005 00:01:48 +0200
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
Message-ID: <425C454C.5050504@gmx.net>

Hi,

I check the buffer managment in the softdevice-0.1.1 and I found a few 
things which could be done better. I commited some changes which improve 
the situation a bit, but there a still some open questions.
Could you, Thomas and Lucian please test if this changes improve the 
performace for you?

Thank you,
Martin


From lucianm at users.sourceforge.net  Wed Apr 13 00:15:49 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 13 Apr 2005 00:15:49 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504122318.17123.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <200504122318.17123.stefan@lucke.in-berlin.de>
Message-ID: <425C4895.5000900@users.sourceforge.net>

Stefan Lucke wrote:
...
>> off-syncronicity I've seen so far in softdevice, on my G400 TV-out. This 
>> time I invoked properly, I hope:
>> 
>> vdr -c /etc/vdr -L /usr/lib/vdr -P'graphlcd -d noritake800' 
>> -P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'
> 
> Please try that with graphlcd disabled. I'm back on my G550 development
> enviroment and I've seen _no_ major issue with tv-out composite.

I tried without graphlcd now, and it's the same situation.

> There are some problems with flickering OSD when not all screen
> backbuffers where cleared. Switched to triple buffering too which
> seems to fix a "from time to time flicker" when OSD is shown.
> And times the OSD _was_ not shown (subtitles ??).
> 
> I'll test that tomorrow on my production system.
> 
> There might be still an issue with A/V sync which needs some further
> testing.
> 
> Attached is a cvs diff of my working version which needs some cleanups.

With this patch applied on on my checout from yesterday, the image gets 
very smooth, if it wasn't in slow motion and with audio skipping all the 
time, it might be well, but I can't really say so now.

I also noticed that on my 1GHz Duron, VDR + softdevice now only takes 
18-25% of the CPU, which is basically half it normally does on DVB 
streams with either mplayer, df_xine or even softdevice before theese 
latest kind of problems, so I'd say it's not gotten surprisingly double 
  as efficient due to some optimizations, as the image is only slow 
motion and audio skips all the time, but it seems to simply ignore the 
work it should do :-)
I will do a fresh checkout and try Martin's latest announced changes 
now, after that I'll probably go to bed.

Lucian


From lucianm at users.sourceforge.net  Wed Apr 13 00:40:14 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Wed, 13 Apr 2005 00:40:14 +0200
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
In-Reply-To: <425C454C.5050504@gmx.net>
References: <425C454C.5050504@gmx.net>
Message-ID: <425C4E4E.5050008@users.sourceforge.net>

Martin Wache wrote:
> Hi,
> 
> I check the buffer managment in the softdevice-0.1.1 and I found a few 
> things which could be done better. I commited some changes which improve 
> the situation a bit, but there a still some open questions.
> Could you, Thomas and Lucian please test if this changes improve the 
> performace for you?

Hi,

I checked out latest CVS and tried, but it doesn't improve the 
situation. Before I tried Stefan's patch on the CVS before your 
buffering changes, with just slightly smoother image, but also 
slow-motion and audio skipping. CPU usage is also strangely low, but a 
bit higher than before your changes, it goes from 20 to 30% (1GHz 
Duron), and normally, when all DVB stream frames are decoded and shown 
(with mplayer, df_xine or even softdevice before this whole thing 
started, I think at the time I tried softplay), CPU usage would be 
something between 45 and 55, maybe 60 sometimes (SDTV of course). 
Currently it behaves almost like in the better times I've had with 
softdevice when switching to HDTV on my 1GHz Duron, it was just 
super-slow motion and after some time crashed. At least it doesn't seem 
to crash now, but I also didn't let it run too much. This time, while 
this whole juddering I have some output which seems to repeat a lot, see 
below.

Lucian




</vdr -L /usr/lib/vdr -P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -L
[softdevice]   argv [3] = -vo
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 0 none
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (YUV2)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4743)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.23 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Multi Application Core. (2005-04-11 23:03)
(*) Direct/Memcpy: Using MMX optimized memcpy()
(*) Direct/Thread: Running 'Fusion Dispatch' (MESSAGING, 19852)...
(*) DirectFB/Core: doing sync()...
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 19887)...
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) Direct/Modules: suppress module 'ps2mouse'
(*) Direct/Modules: suppress module 'serialmouse'
(*) Direct/Modules: suppress module 'sonypi'
(*) Direct/Thread: Running 'Linux Input' (INPUT, 19888)...
(*) DirectFB/Input: AT Translated Set 2 keyboard (1) 0.1 (convergence 
integrated media GmbH)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 19889)...
(*) DirectFB/Input: PS/2 Generic Mouse (2) 0.1 (convergence integrated 
media GmbH)
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 19890)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: Matrox G400 0.7 (directfb.org)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] Supported video Modes are: 640x480 at 16 720x576 at 16 768x576 at 16 
800x600 at 16 1024x768 at 16 1280x1024 at 16 1280x1024 at 16 1600x1200 at 16 640x400 at 16 
400x300 at 16 320x240 at 16 320x200 at 16
[dfb] Enumeratig display Layers
Layer 2 FBDev Primary Layer  Type: graphics
   Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
   Caps: brightness contrast deinterlacing dst_colorkey screen_location 
surface
Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
   Caps: brightness contrast flicker_filtering hue field_parity 
saturation surface
[surface capabilities] scrSurface: videoonly double-buffered flipping 
interlaced
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (Matrox CRTC2 Layer - [720x576])
[surface capabilities] osdSurface: videoonly double-buffered flipping
[surface capabilities] videoSurface: videoonly
[dfb] Using this layer for OSD: Matrox CRTC2 Layer
[dfb] Using this layer for Video out: Matrox CRTC2 Layer
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[surface capabilities] videoSurface: videoonly
[dfb] (re)configured 0x00200806
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
cSoftDevice::MakePrimaryDevice
CMD[4045]:SetPlayMode PmAudioVideo
CMD[4045]:Start IsSuspended 0
CMD[4045]:init put byte finished
CMD[4161]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[5138]:new Video stream index.. old -1 new 0
CMD[5138]:Neuer StreamDecoder Pid: 19640 type 0
CMD[5148]:Neuer Thread gestartet: pid:19640 type 0
CMD[5436]:new Audio stream index.. old -1 new 1
CMD[5436]:Neuer StreamDecoder Pid: 19640 type 1
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface
[surface capabilities] videoSurface: videoonly
[dfb] (re)configured 0x00200806
CMD[5975]:Neuer Thread gestartet: pid:19640 type 1
CMD[1144]:Clear
CMD[1144]:Stop
CMD[1182]:Thread beendet : mpegDecoder pid 19640
CMD[1212]:thread finished pid: 19640 type 0
CMD[1282]:thread finished pid: 19640 type 1
CMD[1316]:Stop finished
CMD[1316]:Start IsSuspended 0
CMD[1316]:init put byte finished
CMD[1317]:Clear finished
CMD[1318]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[1815]:new Video stream index.. old -1 new 0
CMD[1815]:Neuer StreamDecoder Pid: 19640 type 0
CMD[1816]:Neuer Thread gestartet: pid:19640 type 0
CMD[1871]:new Audio stream index.. old -1 new 1
CMD[1871]:Neuer StreamDecoder Pid: 19640 type 1
CMD[1878]:Neuer Thread gestartet: pid:19640 type 1
CMD[9338]:Clear
CMD[9338]:Stop
CMD[9339]:Thread beendet : mpegDecoder pid 19640
CMD[9371]:thread finished pid: 19640 type 0
CMD[9394]:thread finished pid: 19640 type 1
CMD[9404]:Stop finished
CMD[9404]:Start IsSuspended 0
CMD[9404]:init put byte finished
CMD[9404]:Clear finished
CMD[9404]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[9991]:new Video stream index.. old -1 new 0
CMD[9991]:Neuer StreamDecoder Pid: 19640 type 0
CMD[9991]:new Audio stream index.. old -1 new 1
CMD[9991]:Neuer StreamDecoder Pid: 19640 type 1
CMD[9997]:Neuer Thread gestartet: pid:19640 type 0
CMD[9997]:Neuer Thread gestartet: pid:19640 type 1
CMD[2506]:Clear
CMD[2506]:Stop
CMD[2541]:Thread beendet : mpegDecoder pid 19640
CMD[2580]:thread finished pid: 19640 type 0
CMD[2591]:thread finished pid: 19640 type 1
CMD[2602]:Stop finished
CMD[2602]:Start IsSuspended 0
CMD[2602]:init put byte finished
CMD[2603]:Clear finished
CMD[2603]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[2916]:new Video stream index.. old -1 new 0
CMD[2916]:Neuer StreamDecoder Pid: 19640 type 0
CMD[2916]:new Audio stream index.. old -1 new 1
CMD[2916]:Neuer StreamDecoder Pid: 19640 type 1
CMD[2928]:Neuer Thread gestartet: pid:19640 type 0
CMD[2946]:Neuer Thread gestartet: pid:19640 type 1
CMD[4478]:Clear
CMD[4478]:Stop
CMD[4489]:Thread beendet : mpegDecoder pid 19640
CMD[4553]:thread finished pid: 19640 type 0
CMD[4592]:thread finished pid: 19640 type 1
CMD[4592]:Stop finished
CMD[4592]:Start IsSuspended 0
CMD[4593]:init put byte finished
CMD[4593]:Clear finished
CMD[4593]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[4859]:new Video stream index.. old -1 new 0
CMD[4860]:Neuer StreamDecoder Pid: 19640 type 0
CMD[4860]:Neuer Thread gestartet: pid:19640 type 0
CMD[4930]:new Audio stream index.. old -1 new 1
CMD[4930]:Neuer StreamDecoder Pid: 19640 type 1
CMD[4931]:Neuer Thread gestartet: pid:19640 type 1
CMD[2954]:Clear
CMD[2954]:Stop
CMD[2966]:Thread beendet : mpegDecoder pid 19640
CMD[3000]:thread finished pid: 19640 type 0
CMD[3008]:thread finished pid: 19640 type 1
CMD[3014]:Stop finished
CMD[3014]:Start IsSuspended 0
CMD[3014]:init put byte finished
CMD[3014]:Clear finished
CMD[3014]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[3622]:new Video stream index.. old -1 new 0
CMD[3622]:Neuer StreamDecoder Pid: 19640 type 0
CMD[3622]:Neuer Thread gestartet: pid:19640 type 0
CMD[3673]:new Audio stream index.. old -1 new 1
CMD[3673]:Neuer StreamDecoder Pid: 19640 type 1
CMD[3676]:Neuer Thread gestartet: pid:19640 type 1
CMD[2021]:Clear
CMD[2021]:Stop
CMD[2021]:Thread beendet : mpegDecoder pid 19640
CMD[2033]:thread finished pid: 19640 type 0
CMD[2044]:thread finished pid: 19640 type 1
CMD[2053]:Stop finished
CMD[2053]:Start IsSuspended 0
CMD[2054]:init put byte finished
CMD[2054]:Clear finished
CMD[2054]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[2488]:new Video stream index.. old -1 new 0
CMD[2488]:Neuer StreamDecoder Pid: 19640 type 0
CMD[2489]:Neuer Thread gestartet: pid:19640 type 0
CMD[2606]:new Audio stream index.. old -1 new 1
CMD[2607]:Neuer StreamDecoder Pid: 19640 type 1
CMD[2607]:Neuer Thread gestartet: pid:19640 type 1
CMD[5041]:Clear
CMD[5041]:Stop
CMD[5052]:Thread beendet : mpegDecoder pid 19640
CMD[5080]:thread finished pid: 19640 type 0
CMD[5092]:thread finished pid: 19640 type 1
CMD[5096]:Stop finished
CMD[5096]:Start IsSuspended 0
CMD[5097]:init put byte finished
CMD[5097]:Clear finished
CMD[5097]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[5388]:new Video stream index.. old -1 new 0
CMD[5388]:Neuer StreamDecoder Pid: 19640 type 0
CMD[5388]:Neuer Thread gestartet: pid:19640 type 0
CMD[5528]:new Audio stream index.. old -1 new 1
CMD[5528]:Neuer StreamDecoder Pid: 19640 type 1
CMD[5530]:Neuer Thread gestartet: pid:19640 type 1
CMD[4778]:Clear
CMD[4778]:Stop
CMD[4795]:Thread beendet : mpegDecoder pid 19640
CMD[4801]:thread finished pid: 19640 type 0
CMD[4814]:thread finished pid: 19640 type 1
CMD[4822]:Stop finished
CMD[4822]:Start IsSuspended 0
CMD[4822]:init put byte finished
CMD[4822]:Clear finished
CMD[4822]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[5111]:new Video stream index.. old -1 new 0
CMD[5111]:Neuer StreamDecoder Pid: 19640 type 0
CMD[5111]:new Audio stream index.. old -1 new 1
CMD[5111]:Neuer StreamDecoder Pid: 19640 type 1
CMD[5112]:Neuer Thread gestartet: pid:19640 type 0
CMD[5113]:Neuer Thread gestartet: pid:19640 type 1
CMD[3582]:Clear
CMD[3582]:Stop
CMD[3595]:Thread beendet : mpegDecoder pid 19640
CMD[3680]:thread finished pid: 19640 type 0
CMD[3680]:thread finished pid: 19640 type 1
CMD[3719]:Stop finished
CMD[3719]:Start IsSuspended 0
CMD[3720]:init put byte finished
CMD[3720]:Clear finished
CMD[3720]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[4018]:new Video stream index.. old -1 new 0
CMD[4018]:Neuer StreamDecoder Pid: 19640 type 0
CMD[4018]:Neuer Thread gestartet: pid:19640 type 0
CMD[4145]:new Audio stream index.. old -1 new 1
CMD[4145]:Neuer StreamDecoder Pid: 19640 type 1
CMD[4149]:Neuer Thread gestartet: pid:19640 type 1
CMD[4087]:Clear
CMD[4087]:Stop
CMD[4099]:Thread beendet : mpegDecoder pid 19640
CMD[4295]:thread finished pid: 19640 type 0
CMD[4302]:thread finished pid: 19640 type 1
CMD[4308]:Stop finished
CMD[4308]:Start IsSuspended 0
CMD[4308]:init put byte finished
CMD[4308]:Clear finished
CMD[4309]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[4900]:new Video stream index.. old -1 new 0
CMD[4900]:Neuer StreamDecoder Pid: 19640 type 0
CMD[4901]:new Audio stream index.. old -1 new 1
CMD[4901]:Neuer StreamDecoder Pid: 19640 type 1
CMD[4901]:Neuer Thread gestartet: pid:19640 type 0
CMD[4903]:Neuer Thread gestartet: pid:19640 type 1
CMD[0728]:Clear
CMD[0728]:Stop
CMD[0739]:Thread beendet : mpegDecoder pid 19640
CMD[0900]:thread finished pid: 19640 type 0
CMD[0903]:thread finished pid: 19640 type 1
CMD[0914]:Stop finished
CMD[0914]:Start IsSuspended 0
CMD[0914]:init put byte finished
CMD[0914]:Clear finished
CMD[0914]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[1492]:new Video stream index.. old -1 new 0
CMD[1492]:Neuer StreamDecoder Pid: 19640 type 0
CMD[1493]:Neuer Thread gestartet: pid:19640 type 0
CMD[1594]:new Audio stream index.. old -1 new 1
CMD[1594]:Neuer StreamDecoder Pid: 19640 type 1
CMD[1595]:Neuer Thread gestartet: pid:19640 type 1
CMD[5640]:Clear
CMD[5640]:Stop
CMD[5652]:Thread beendet : mpegDecoder pid 19640
CMD[5683]:thread finished pid: 19640 type 0
CMD[5686]:thread finished pid: 19640 type 1
CMD[5699]:Stop finished
CMD[5699]:Start IsSuspended 0
CMD[5699]:init put byte finished
CMD[5699]:Clear finished
CMD[5704]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[5869]:new Video stream index.. old -1 new 0
CMD[5869]:Neuer StreamDecoder Pid: 19640 type 0
CMD[5870]:Neuer Thread gestartet: pid:19640 type 0
CMD[6006]:new Audio stream index.. old -1 new 1
CMD[6006]:Neuer StreamDecoder Pid: 19640 type 1
CMD[6007]:Neuer Thread gestartet: pid:19640 type 1
CMD[0426]:Clear
CMD[0426]:Stop
CMD[0454]:Thread beendet : mpegDecoder pid 19640
CMD[0537]:thread finished pid: 19640 type 0
CMD[0547]:thread finished pid: 19640 type 1
CMD[0557]:Stop finished
CMD[0557]:Start IsSuspended 0
CMD[0557]:init put byte finished
CMD[0557]:Clear finished
CMD[0558]:Neuer Thread gestartet: Mpeg2Decoder pid 19640
CMD[1129]:new Video stream index.. old -1 new 0
CMD[1129]:Neuer StreamDecoder Pid: 19640 type 0
CMD[1129]:Neuer Thread gestartet: pid:19640 type 0
CMD[1233]:new Audio stream index.. old -1 new 1
CMD[1233]:Neuer StreamDecoder Pid: 19640 type 1
CMD[1236]:Neuer Thread gestartet: pid:19640 type 1
CMD[5621]:Stop
CMD[5635]:Thread beendet : mpegDecoder pid 19640
CMD[5672]:thread finished pid: 19640 type 0
CMD[5762]:thread finished pid: 19640 type 1
CMD[5773]:Stop finished
Releasing DFB


From stefan at lucke.in-berlin.de  Wed Apr 13 06:58:47 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 13 Apr 2005 06:58:47 +0200
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
In-Reply-To: <425C454C.5050504@gmx.net>
References: <425C454C.5050504@gmx.net>
Message-ID: <200504130658.47962.stefan@lucke.in-berlin.de>

On Mittwoch, 13. April 2005 00:01, Martin Wache wrote:
> Hi,
> 
> I check the buffer managment in the softdevice-0.1.1 and I found a few 
> things which could be done better. I commited some changes which improve 
> the situation a bit, but there a still some open questions.

Martin which delay method should be used now ?
For me its the old method:

CMD[4546]:Neuer Thread gestartet: pid:2457 type 0
Could not open /dev/rtc
 using OLD delay -- !!
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)
[dfb] creating new surface

#ifdef SIG_TIMING
{
static int once = 1;
if (once){fprintf(stderr," using new delay -- !!\n");once = 0;}
}
  Timer.Sleep(delay-1000);
  delay-=Timer.GetRelTime();
#else
{
static int once = 1;
if (once){fprintf(stderr," using OLD delay -- !!\n");once = 0;}
}

As SIG_TIMING is not defined ! I think you intended an other logic.

#define SIG_TIMING 0 // the old way
//#define SIG_TIMING 1 // the new way

#if !SIG_TIMING
 -- include the old stuff
#endif

#if SIG_TIMING
 -- do the new action --
#else
 -- do the old action --
#endif

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Wed Apr 13 07:22:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 13 Apr 2005 07:22:05 +0200
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
In-Reply-To: <200504130658.47962.stefan@lucke.in-berlin.de>
References: <425C454C.5050504@gmx.net> <200504130658.47962.stefan@lucke.in-berlin.de>
Message-ID: <200504130722.05414.stefan@lucke.in-berlin.de>

On Mittwoch, 13. April 2005 06:58, Stefan Lucke wrote:
> On Mittwoch, 13. April 2005 00:01, Martin Wache wrote:
> > Hi,
> > 
> > I check the buffer managment in the softdevice-0.1.1 and I found a few 
> > things which could be done better. I commited some changes which improve 
> > the situation a bit, but there a still some open questions.
> 
> Martin which delay method should be used now ?
> For me its the old method:
> 
> CMD[4546]:Neuer Thread gestartet: pid:2457 type 0
> Could not open /dev/rtc
>  using OLD delay -- !!
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> [dfb] creating new surface

Forget this. Should write only when I woke up complete.

-- 
Stefan Lucke



From M.Wache at gmx.net  Wed Apr 13 10:12:45 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 13 Apr 2005 10:12:45 +0200
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
In-Reply-To: <425C4E4E.5050008@users.sourceforge.net>
References: <425C454C.5050504@gmx.net> <425C4E4E.5050008@users.sourceforge.net>
Message-ID: <425CD47D.2000705@gmx.net>

Lucian Muresan wrote:

> 
> I checked out latest CVS and tried, but it doesn't improve the 
> situation. Before I tried Stefan's patch on the CVS before your 
> buffering changes, with just slightly smoother image, but also 
> slow-motion and audio skipping. CPU usage is also strangely low, but a 
> bit higher than before your changes, it goes from 20 to 30% (1GHz 
> Duron), and normally, when all DVB stream frames are decoded and shown 
> (with mplayer, df_xine or even softdevice before this whole thing 
> started, I think at the time I tried softplay), CPU usage would be 
> something between 45 and 55, maybe 60 sometimes (SDTV of course). 
> Currently it behaves almost like in the better times I've had with 
> softdevice when switching to HDTV on my 1GHz Duron, it was just 
> super-slow motion and after some time crashed. At least it doesn't seem 
> to crash now, but I also didn't let it run too much. This time, while 
> this whole juddering I have some output which seems to repeat a lot, see 
> below.

Hmm, from the logs you send this looks like the same problem that Thomas 
reported. I would like to ask you to do one of the following things (or 
if you like both...)

- What was the last version which worked for you? Go back in the CVS 
using the command:
"cvs -d:pserver:anonymous at cvs.softdevice.berlios.de:/cvsroot/softdevice 
co -D 2005-03-22 softdevice" (replace the date 2005-03-22 with the 
appropiate date) and  tell us the newest version of the CVS which works 
for you, and the first version which is broken. You can find some dates 
you can try in the CHANGELOG. With this information we can find the 
change which broke the softdevice for you and understand the problem.

- Enable our debugging output. Edit the file mpeg2decoder.c and 
uncomment the lines //#define BUFDEB... and //#define MPGDEB..., 
recompile, start vdr piping all output in a file, and stop vdr after 2-3 
minutes. Gzip or bzip the output and send it to me in a personal e-mail 
(the list wont accept it because of the length ). If the zipped output 
is still more than a few hundred KB you can cut the end away. By 
enableing the debugging output you tell the softdevice to log almost 
everything with timestamps. From this output we can find out where the 
softdevice spends it's time and hopefully find the problem.


Thank you,

Martin



From ollo.diab at gmx.de  Wed Apr 13 20:18:41 2005
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Wed, 13 Apr 2005 20:18:41 +0200 (MEST)
Subject: [Softdevice-devel] buffering issues in softdevice-0.1.1
References: <425C454C.5050504@gmx.net>
Message-ID: <28407.1113416321@www3.gmx.net>

Hi Martin,
> Hi,
> 
> I check the buffer managment in the softdevice-0.1.1 and I found a few 
> things which could be done better. I commited some changes which improve 
> the situation a bit, but there a still some open questions.
> Could you, Thomas and Lucian please test if this changes improve the 
> performace for you?

I just checked out the latest cvs and the situation improved. But still a
buffer overrun occures now every 4 to 5 seconds while watching HDTV, was
every second before latest change. So it seems you are on the right track,
keep going!  ;)

Regards,   Thomas

> 
> Thank you,
> Martin
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
> 

-- 
+++ NEU: GMX DSL_Flatrate! Schon ab 14,99 EUR/Monat! +++

GMX Garantie: Surfen ohne Tempo-Limit! http://www.gmx.net/de/go/dsl


From stefan at lucke.in-berlin.de  Thu Apr 14 23:17:20 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 14 Apr 2005 23:17:20 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <425C4895.5000900@users.sourceforge.net>
References: <425B7A3C.4060102@users.sourceforge.net> <200504122318.17123.stefan@lucke.in-berlin.de> <425C4895.5000900@users.sourceforge.net>
Message-ID: <200504142317.20423.stefan@lucke.in-berlin.de>

On Mittwoch, 13. April 2005 00:15, Lucian Muresan wrote:
> Stefan Lucke wrote:
> ...
> >> off-syncronicity I've seen so far in softdevice, on my G400 TV-out. This 
> >> time I invoked properly, I hope:
> >> 
> >> vdr -c /etc/vdr -L /usr/lib/vdr -P'graphlcd -d noritake800' 
> >> -P'softdevice -L /usr/lib/vdr -vo dfb:mgatv'
> > 
> > Please try that with graphlcd disabled. I'm back on my G550 development
> > enviroment and I've seen _no_ major issue with tv-out composite.
> 
> I tried without graphlcd now, and it's the same situation.
> 
> > There are some problems with flickering OSD when not all screen
> > backbuffers where cleared. Switched to triple buffering too which
> > seems to fix a "from time to time flicker" when OSD is shown.
> > And times the OSD _was_ not shown (subtitles ??).
> > 
> > I'll test that tomorrow on my production system.
> > 
> > There might be still an issue with A/V sync which needs some further
> > testing.
> > 
> > Attached is a cvs diff of my working version which needs some cleanups.
> 
> With this patch applied on on my checout from yesterday, the image gets 
> very smooth, if it wasn't in slow motion and with audio skipping all the 
> time, it might be well, but I can't really say so now.

So now I did the test on my prod system (posted patch applied) and
I'm very satisfied. Suprisingly the audio xruns are _not_audible.
Sound connection is via optical link to my surround decoder
logitech z-680. So ac3 passthrough should be done next.
This test was on a 1.2G PIII Celeron. Cpu load is between 30 and 50%.

The only thing I noticed that from time to time is a slight
judder as frames were repeated. THis my be caused when the receiving
framerate is slightly lower than matrox framerate. I should ask for
framerate adjustment on directfb list again.

-- 
Stefan Lucke



From torgeir at pobox.com  Thu Apr 14 23:53:54 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 14 Apr 2005 22:53:54 +0100
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504142317.20423.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net>
	 <200504122318.17123.stefan@lucke.in-berlin.de>
	 <425C4895.5000900@users.sourceforge.net>
	 <200504142317.20423.stefan@lucke.in-berlin.de>
Message-ID: <1113515634.16885.40.camel@africa>

On Thu, 2005-04-14 at 23:17 +0200, Stefan Lucke wrote:

> The only thing I noticed that from time to time is a slight
> judder as frames were repeated. THis my be caused when the receiving
> framerate is slightly lower than matrox framerate. I should ask for
> framerate adjustment on directfb list again.

I've been thinking about writing some code for detecting this, when the
framebuffer device implements FBIO_WAITFORVSYNC. A separate thread would
wait on vsync, each time it is called, it would atomically increment a
counter, and just wait for vsync again. The DirectFB output plugin would
decrement the same counter each time it calls Flip(). 

If there is frame starvation, the counter would over time grow, and it
would be possible to also detect judder due to other processes hijacking
the cpu by checking if abs(current_count - prev_count) > 1 at each call
to Flip().

I'm a bit busy with work and life in general, so haven't had the time to
look into it yet..

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Sat Apr 16 13:49:32 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 16 Apr 2005 14:49:32 +0300
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504122318.17123.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <200504122318.17123.stefan@lucke.in-berlin.de>
Message-ID: <20050416114932.GA272417@kosh.hut.fi>

On Tue, Apr 12, 2005 at 11:18:17PM +0200, Stefan Lucke wrote:
> There are some problems with flickering OSD when not all screen
> backbuffers where cleared. Switched to triple buffering too which
> seems to fix a "from time to time flicker" when OSD is shown.
> And times the OSD _was_ not shown (subtitles ??).
> 
> I'll test that tomorrow on my production system.

Do you have any news regarding this?  I just tried an up-to-date CVS snapshot
of softdevice today, and the subtitles weren't displayed.  Otherwise, the
OSD was fine.  I'm using VGA-style output on the primary head of Matrox G450.

It's not critical, but I'd like to gather some profiling statistics for
the whole software stack (including libavcodec), and it would be rather
pointless to do that on the old softdevice snapshot that works for me.

	Marko


From stefan at lucke.in-berlin.de  Sat Apr 16 20:01:48 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 16 Apr 2005 20:01:48 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <20050416114932.GA272417@kosh.hut.fi>
References: <425B7A3C.4060102@users.sourceforge.net> <200504122318.17123.stefan@lucke.in-berlin.de> <20050416114932.GA272417@kosh.hut.fi>
Message-ID: <200504162001.48974.stefan@lucke.in-berlin.de>

On Samstag, 16. April 2005 13:49, Marko M?kel? wrote:
> On Tue, Apr 12, 2005 at 11:18:17PM +0200, Stefan Lucke wrote:
> > There are some problems with flickering OSD when not all screen
> > backbuffers where cleared. Switched to triple buffering too which
> > seems to fix a "from time to time flicker" when OSD is shown.
> > And times the OSD _was_ not shown (subtitles ??).
> > 
> > I'll test that tomorrow on my production system.
> 
> Do you have any news regarding this?  I just tried an up-to-date CVS snapshot
> of softdevice today, and the subtitles weren't displayed.  Otherwise, the
> OSD was fine.  I'm using VGA-style output on the primary head of Matrox G450.

Did you try that with my patch posted on tuesday ? If there are still no
subtitles then this my be caused by coordinate mismatch between
drawing function (scaled down ??) and OSD backcopy which takes
OSD coordinates as given by vdr.

Did you set vdr OSD x/y offsets to zero ?


-- 
Stefan Lucke



From marko.makela at hut.fi  Sun Apr 17 14:36:37 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 17 Apr 2005 15:36:37 +0300
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504162001.48974.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <200504122318.17123.stefan@lucke.in-berlin.de> <20050416114932.GA272417@kosh.hut.fi> <200504162001.48974.stefan@lucke.in-berlin.de>
Message-ID: <20050417123637.GA245830@kosh.hut.fi>

On Sat, Apr 16, 2005 at 08:01:48PM +0200, Stefan Lucke wrote:
> On Samstag, 16. April 2005 13:49, Marko M?kel? wrote:
> > On Tue, Apr 12, 2005 at 11:18:17PM +0200, Stefan Lucke wrote:
> > > There are some problems with flickering OSD when not all screen
> > > backbuffers where cleared. Switched to triple buffering too which
> > > seems to fix a "from time to time flicker" when OSD is shown.
> > > And times the OSD _was_ not shown (subtitles ??).
> > > 
> > > I'll test that tomorrow on my production system.
> > 
> > Do you have any news regarding this?  I just tried an up-to-date CVS snapshot
> > of softdevice today, and the subtitles weren't displayed.  Otherwise, the
> > OSD was fine.  I'm using VGA-style output on the primary head of Matrox G450.
> 
> Did you try that with my patch posted on tuesday ? If there are still no
> subtitles then this my be caused by coordinate mismatch between
> drawing function (scaled down ??) and OSD backcopy which takes
> OSD coordinates as given by vdr.

Sorry, I assumed that you would commit it to CVS.  I now applied that patch, but
got still no subtitles with dfb output.  After recompiling with XV output, everything
worked fine.

> Did you set vdr OSD x/y offsets to zero ?

As the menus are displayed just fine, this might not solve the problem.  Which variable
do you mean?  I see several variables related to OSD x/y offsets.

Attached is a patch to mpeg2decoder.c that silences some compiler warnings.

	Marko
-------------- next part --------------
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.31
diff -u -r1.31 mpeg2decoder.c
--- mpeg2decoder.c	12 Apr 2005 21:58:32 -0000	1.31
+++ mpeg2decoder.c	17 Apr 2005 12:31:31 -0000
@@ -24,13 +24,13 @@
 #include "setup-softdevice.h"
 
 
-//#define MPGDEB(out...) {printf("mpegdec[%04d]:",getTimeMilis() % 10000);printf(out);}
+//#define MPGDEB(out...) {printf("mpegdec[%04d]:",int(getTimeMilis() % 10000));printf(out);}
 
 #ifndef MPGDEB
 #define MPGDEB(out...)
 #endif
 
-#define CMDDEB(out...) {printf("CMD[%04d]:",getTimeMilis() % 10000);printf(out);}
+#define CMDDEB(out...) {printf("CMD[%04d]:",int(getTimeMilis() % 10000));printf(out);}
 
 #ifndef CMDDEB
 #define CMDDEB(out...)
@@ -1095,7 +1095,7 @@
 };
 
 int cMpeg2Decoder::seek(offset_t offset, int whence) {
-   printf("unimplemented: seek offset %d whence %d\n",offset,whence);
+   printf("unimplemented: seek offset %d whence %d\n",int(offset),whence);
    return -EINVAL;
 };
 

From stefan at lucke.in-berlin.de  Sun Apr 17 19:32:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 17 Apr 2005 19:32:58 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <20050417123637.GA245830@kosh.hut.fi>
References: <425B7A3C.4060102@users.sourceforge.net> <200504162001.48974.stefan@lucke.in-berlin.de> <20050417123637.GA245830@kosh.hut.fi>
Message-ID: <200504171932.58149.stefan@lucke.in-berlin.de>

On Sonntag, 17. April 2005 14:36, Marko M?kel? wrote:
> On Sat, Apr 16, 2005 at 08:01:48PM +0200, Stefan Lucke wrote:
> > On Samstag, 16. April 2005 13:49, Marko M?kel? wrote:
> > > On Tue, Apr 12, 2005 at 11:18:17PM +0200, Stefan Lucke wrote:
> > > > There are some problems with flickering OSD when not all screen
> > > > backbuffers where cleared. Switched to triple buffering too which
> > > > seems to fix a "from time to time flicker" when OSD is shown.
> > > > And times the OSD _was_ not shown (subtitles ??).
> > > > 
> > > > I'll test that tomorrow on my production system.
> > > 
> > > Do you have any news regarding this?  I just tried an up-to-date CVS snapshot
> > > of softdevice today, and the subtitles weren't displayed.  Otherwise, the
> > > OSD was fine.  I'm using VGA-style output on the primary head of Matrox G450.
> > 
> > Did you try that with my patch posted on tuesday ? If there are still no
> > subtitles then this my be caused by coordinate mismatch between
> > drawing function (scaled down ??) and OSD backcopy which takes
> > OSD coordinates as given by vdr.
> 
> Sorry, I assumed that you would commit it to CVS.  I now applied that patch, but
> got still no subtitles with dfb output.  After recompiling with XV output, everything
> worked fine.

Now I've a patch vdr version myself to get subtitles. After a few tests,
 it starts to drive me crazy. Old versions of dfb-out work
(before 2005-03-27). But I just don't see the problem as all vdr
menues work. The only thing I know that it is _not_ a coordinate
scaling mismatch.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Apr 18 22:44:57 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 18 Apr 2005 22:44:57 +0200
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504171932.58149.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <20050417123637.GA245830@kosh.hut.fi> <200504171932.58149.stefan@lucke.in-berlin.de>
Message-ID: <200504182244.57174.stefan@lucke.in-berlin.de>

On Sonntag, 17. April 2005 19:32, Stefan Lucke wrote:
> On Sonntag, 17. April 2005 14:36, Marko M?kel? wrote:
> > On Sat, Apr 16, 2005 at 08:01:48PM +0200, Stefan Lucke wrote:
> > > On Samstag, 16. April 2005 13:49, Marko M?kel? wrote:
> > > > On Tue, Apr 12, 2005 at 11:18:17PM +0200, Stefan Lucke wrote:
> > > > > There are some problems with flickering OSD when not all screen
> > > > > backbuffers where cleared. Switched to triple buffering too which
> > > > > seems to fix a "from time to time flicker" when OSD is shown.
> > > > > And times the OSD _was_ not shown (subtitles ??).
> > > > > 
> > > > > I'll test that tomorrow on my production system.
> > > > 
> > > > Do you have any news regarding this?  I just tried an up-to-date CVS snapshot
> > > > of softdevice today, and the subtitles weren't displayed.  Otherwise, the
> > > > OSD was fine.  I'm using VGA-style output on the primary head of Matrox G450.
> > > 
> > > Did you try that with my patch posted on tuesday ? If there are still no
> > > subtitles then this my be caused by coordinate mismatch between
> > > drawing function (scaled down ??) and OSD backcopy which takes
> > > OSD coordinates as given by vdr.
> > 
> > Sorry, I assumed that you would commit it to CVS.  I now applied that patch, but
> > got still no subtitles with dfb output.  After recompiling with XV output, everything
> > worked fine.
> 
> Now I've a patch vdr version myself to get subtitles. After a few tests,
>  it starts to drive me crazy. Old versions of dfb-out work
> (before 2005-03-27). But I just don't see the problem as all vdr
> menues work. The only thing I know that it is _not_ a coordinate
> scaling mismatch.

But it _was_ a coordinate translation mismatch X0() and Y0() offsets
were missing . It is now in cvs with mgatv triple buffering.

-- 
Stefan Lucke



From steve at deltabbs.org  Mon Apr 18 23:21:56 2005
From: steve at deltabbs.org (Steve Brown)
Date: Mon, 18 Apr 2005 22:21:56 +0100
Subject: [Softdevice-devel] Compile problem with 0.1.1 - VDRPluginCreator syms
Message-ID: <426424F4.9050909@deltabbs.org>

Hi,

I seem to be having some trouble compiling softdevice-0.1.1 with GCC 
3.3.5 on Debian with options in Makefile for DFB only.

Other plugins seem to be fine, but if I do a 'vdr -h' vdr itself errors 
with "undefined symbol: VDRPluginCreator" although it still lists the 
versions of itself and plugins, except softdevice.

Naturally if I remove the softdevice plugin for the plugins directory, 
all is well.

I see there was an issue ages ago with GCC 3.4 but I see the patches 
mentioned around that time already see to be implemented.

What did I miss?

I'm not really expecting the results to be useable (assuming I can fix 
the compile issue) since I'm building for a EPIA platform (600MHz Ezra 
and CLE266 chipset), but it might be more useable that the DXR3 I've got ;-)

-S


From steve at deltabbs.org  Tue Apr 19 15:55:42 2005
From: steve at deltabbs.org (steve at deltabbs.org)
Date: Tue, 19 Apr 2005 14:55:42 +0100
Subject: [Softdevice-devel] Compile problem with 0.1.1 - VDRPluginCreator syms
In-Reply-To: <426424F4.9050909@deltabbs.org>
References: <426424F4.9050909@deltabbs.org>
Message-ID: <20050419135541.GA4135@deltabbs.org>

On Mon, Apr 18, 2005 at 10:21:56PM +0100, Steve Brown wrote:

Yes, bad form answering ones self I know:

> with "undefined symbol: VDRPluginCreator" although it still lists the 
> versions of itself and plugins, except softdevice.

That would be because the softdevice-dfb module isn't a plugin, but a library
used my the actual softdevice plugin...

I should have RTFM with eyes=open :-/

-S


From nhuillard at e-dition.fr  Tue Apr 19 17:39:45 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 19 Apr 2005 17:39:45 +0200
Subject: [Softdevice-devel] Compile problem with 0.1.1 - VDRPluginCreator
 syms
In-Reply-To: <426424F4.9050909@deltabbs.org>
References: <426424F4.9050909@deltabbs.org>
Message-ID: <42652641.1020206@e-dition.fr>

Steve Brown a ?crit :
> I'm not really expecting the results to be useable (assuming I can fix 
> the compile issue) since I'm building for a EPIA platform (600MHz Ezra 
> and CLE266 chipset), but it might be more useable that the DXR3 I've got 
> ;-)

Keep us informed of the suitability of the Ezra 600 ! And also don't 
despair : there could be a time in the future when the CLE266 would be 
used by softdevice, through libavcodec...

-- 
NH


From marko.makela at hut.fi  Tue Apr 19 18:17:17 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 19 Apr 2005 19:17:17 +0300
Subject: [Softdevice-devel] terrible judder and stuttering
In-Reply-To: <200504182244.57174.stefan@lucke.in-berlin.de>
References: <425B7A3C.4060102@users.sourceforge.net> <20050417123637.GA245830@kosh.hut.fi> <200504171932.58149.stefan@lucke.in-berlin.de> <200504182244.57174.stefan@lucke.in-berlin.de>
Message-ID: <20050419161717.GA496517@kosh.hut.fi>

On Mon, Apr 18, 2005 at 10:44:57PM +0200, Stefan Lucke wrote:
> > Now I've a patch vdr version myself to get subtitles. After a few tests,
> >  it starts to drive me crazy. Old versions of dfb-out work
> > (before 2005-03-27). But I just don't see the problem as all vdr
> > menues work. The only thing I know that it is _not_ a coordinate
> > scaling mismatch.
> 
> But it _was_ a coordinate translation mismatch X0() and Y0() offsets
> were missing . It is now in cvs with mgatv triple buffering.

Thanks, now the subtitles appear properly.

However, I noticed some severe slowdown in live video playback after stopping
the playback of a recording.  Then, I selected a recording again for
playback, and the juddering went on until I paused the playback for a
couple of seconds.  After that, live video played okay.  Any ideas?

	Marko


From nhuillard at e-dition.fr  Sun Apr 24 20:15:20 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 24 Apr 2005 20:15:20 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
Message-ID: <426BE238.9070507@e-dition.fr>

Hello,

I finally managed to compile and run 0.1.1, and plan to go in production 
with it (leaving vdr-xine behind) : you all did a great job with 
softdevice ! Lot of thanks !

As the subject tells : did anyone manage to regularly run softdevice as 
a non-root user ?
When running as root, DirectFB stops like below. I know it's a 
long-lasting thread, and I thought it was possible, but I can't manage 
to get the right conf.
My /etc/directfbrc :

fbdev=/dev/fb0
mode=720x576
depth=32
#pixelformat=AiRGB
pixelformat=ARGB
#sync
#disable-module=keyboard
disable-module=lirc
disable-module=joystick
disable-module=cle266
graphics-vt
#no-graphics-vt
no-vt-switch
no-vt-switching



vdr at vdr:plugins$ LD_ASSUME_KERNEL=2.4.21 /usr/bin/vdr-kbd -v /home/video 
-c /var/lib/vdr -r /usr/lib/vdr/vdr-recordingaction -s 
/usr/lib/vdr/vdr-shutdown -w 60 -P'softdevice -vo dfb:' --lirc 
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa device set to: default
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] deinterlace method set to 0 none
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(cvs) build(4752)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.21 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (with MMX support) 
(2004-08-05 20:17)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(!) DirectFB/FBDev/vt: FBIOGET_CON2FBMAP failed!
     --> Inappropriate ioctl for device
(!) DirectFB/FBDev/vt: FBIOPUT_CON2FBMAP failed!
     --> Inappropriate ioctl for device
(!) DirectFB/fbdev/vt: KD_GRAPHICS failed!
     --> Operation not permitted
(!) DirectFB/Core: Could not initialize 'system' core!
     --> Initialization error!
(!) [15036:    0.000] --> Caught signal 6 (sent by pid 15036, uid 108) <--
Killed


From torgeir at pobox.com  Sun Apr 24 20:35:08 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 24 Apr 2005 19:35:08 +0100
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <426BE238.9070507@e-dition.fr>
References: <426BE238.9070507@e-dition.fr>
Message-ID: <1114367708.3289.1.camel@africa>

On Sun, 2005-04-24 at 20:15 +0200, Nicolas Huillard wrote:
> Hello,
> 
> I finally managed to compile and run 0.1.1, and plan to go in production 
> with it (leaving vdr-xine behind) : you all did a great job with 
> softdevice ! Lot of thanks !
> 
> As the subject tells : did anyone manage to regularly run softdevice as 
> a non-root user ?
> When running as root, DirectFB stops like below. I know it's a 
> long-lasting thread, and I thought it was possible, but I can't manage 
> to get the right conf.
> My /etc/directfbrc :
> 
> fbdev=/dev/fb0

Do you really need this one?

> (!) DirectFB/FBDev/vt: FBIOGET_CON2FBMAP failed!
>      --> Inappropriate ioctl for device

What does dfbinfo say?

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Sun Apr 24 21:06:21 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 24 Apr 2005 21:06:21 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <1114367708.3289.1.camel@africa>
References: <426BE238.9070507@e-dition.fr> <1114367708.3289.1.camel@africa>
Message-ID: <426BEE2D.2010806@e-dition.fr>

Torgeir Veimo a ?crit :
> On Sun, 2005-04-24 at 20:15 +0200, Nicolas Huillard wrote:
> 
>>Hello,
>>
>>I finally managed to compile and run 0.1.1, and plan to go in production 
>>with it (leaving vdr-xine behind) : you all did a great job with 
>>softdevice ! Lot of thanks !
>>
>>As the subject tells : did anyone manage to regularly run softdevice as 
>>a non-root user ?
>>When running as root, DirectFB stops like below. I know it's a 
>>long-lasting thread, and I thought it was possible, but I can't manage 
>>to get the right conf.
>>My /etc/directfbrc :
>>
>>fbdev=/dev/fb0
> 
> Do you really need this one?

This is reminiscent of my first tests, a looooong tome ago. Not needed.

>>(!) DirectFB/FBDev/vt: FBIOGET_CON2FBMAP failed!
>>     --> Inappropriate ioctl for device
> 
> 
> What does dfbinfo say?

See below. As root, as the vdr user, with the without the no-vt option.

I also digged into my mail archive, and found a thread about that :
	Date: Fri, 7 Jan 2005 00:22:20 +0000
	From: Tony Houghton <h at realh.co.uk>
	To: directfb-users at directfb.org
	Subject: [directfb-users] Running without root privileges
Basically, the no-vt-* I put would work if vdr is run from the console, 
instead of my habit to run it from an SSH session.
The undocumented "no-vt" option allows to not manipulate /dev/tty at 
all, and VDR works from SSH, but the console cursor still blinks, the 
console screensaver timeout also disables the output, etc...
I run VDR from the run-vdr script written by Darren Salt in C for his 
Debian packages.
How is your /etc/directfbrc in that kind of production setup ?

-- 
NH
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dfbinfo.txt
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050424/5708b0e9/attachment.txt>

From torgeir at pobox.com  Sun Apr 24 21:12:46 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 24 Apr 2005 20:12:46 +0100
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <426BEE2D.2010806@e-dition.fr>
References: <426BE238.9070507@e-dition.fr> <1114367708.3289.1.camel@africa>
	 <426BEE2D.2010806@e-dition.fr>
Message-ID: <1114369966.3289.7.camel@africa>

On Sun, 2005-04-24 at 21:06 +0200, Nicolas Huillard wrote:
> Torgeir Veimo a ?crit :
> > On Sun, 2005-04-24 at 20:15 +0200, Nicolas Huillard wrote:
> > 
> >>Hello,
> >>
> >>I finally managed to compile and run 0.1.1, and plan to go in production 
> >>with it (leaving vdr-xine behind) : you all did a great job with 
> >>softdevice ! Lot of thanks !
> >>
> >>As the subject tells : did anyone manage to regularly run softdevice as 
> >>a non-root user ?
> >>When running as root, DirectFB stops like below. I know it's a 
> >>long-lasting thread, and I thought it was possible, but I can't manage 
> >>to get the right conf.
> >>My /etc/directfbrc :
> >>
> >>fbdev=/dev/fb0
> > 
> > Do you really need this one?
> 
> This is reminiscent of my first tests, a looooong tome ago. Not needed.

Ok, my /etc/directfb:

mode=1280x720
depth=32
graphics-vt
no-debug


> 	Subject: [directfb-users] Running without root privileges
> Basically, the no-vt-* I put would work if vdr is run from the console, 
> instead of my habit to run it from an SSH session.
> The undocumented "no-vt" option allows to not manipulate /dev/tty at 
> all, and VDR works from SSH, but the console cursor still blinks, the 
> console screensaver timeout also disables the output, etc...
> I run VDR from the run-vdr script written by Darren Salt in C for his 
> Debian packages.

I didn't know about this option. I can run vdr with dfb both from the
console and from a ssh session, which i usually do when debugging. My
run scripts is like this;

#!/bin/sh
cd /usr/local/src/VDR
export LD_ASSUME_KERNEL=2.4.1
export LANG=en_US
vdr -D 0 -D 1 -s "killall -9 vdr;/bin/false" -P"softdevice -vo dfb:"
-P"remote -i /dev/input/event1"  -P"dvd -C/dev/dvd"

> Screen (00) FBDev Primary Screen            (primary screen)
>    Caps:
> 
>      Layer (00) FBDev Primary Layer             (primary layer)
>         Type:
>         Caps:

[...]

It's a bit strange that there is no output of Caps, Type, etc. The
output I get in my radeon setup is the following;

Screen (00) Radeon200 Primary Screen        (primary screen)
   Caps: VSYNC POWER_MANAGEMENT

     Layer (00) FBDev Primary Layer             (primary layer)
        Type:    GRAPHICS
        Caps:    SURFACE BRIGHTNESS CONTRAST SATURATION

     Layer (01) Radeon200 Overlay
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY SCREEN_LOCATION DST_COLORKEY BRIGHTNESS
CONTRAST HUE SATURATION SCREEN_POSITION SCREEN_SIZE


Input (01) IMPS/2 Mouse                    (primary mouse)
   Type: MOUSE
   Caps: AXES BUTTONS
   Max. Axis: 2
[...]

But then again, I've never tried a Unichrome setup.


> vdr at vdr:plugins$ dfbinfo
> (*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
> 
>        ---------------------- DirectFB v0.9.21 ---------------------
>              (c) 2000-2002  convergence integrated media GmbH
>              (c) 2002-2004  convergence GmbH
>         -----------------------------------------------------------
> 
> (*) DirectFB/Core: Single Application Core. (with MMX support) (2004-08-05 20:17)
> (*) Direct/Memcpy: Using SSE optimized memcpy()
> (!) DirectFB/FBDev/vt: FBIOGET_CON2FBMAP failed!
>     --> Inappropriate ioctl for device
> (!) DirectFB/FBDev/vt: FBIOPUT_CON2FBMAP failed!
>     --> Inappropriate ioctl for device
> (!) DirectFB/fbdev/vt: KD_GRAPHICS failed!
>     --> Operation not permitted
> (!) DirectFB/Core: Could not initialize 'system' core!
>     --> Initialization error!
> (#) DirectFBError [DirectFBCreate() failed]: Initialization error!


Was this one with the no-vt option?

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun Apr 24 21:14:08 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 24 Apr 2005 21:14:08 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <426BE238.9070507@e-dition.fr>
References: <426BE238.9070507@e-dition.fr>
Message-ID: <200504242114.08605.stefan@lucke.in-berlin.de>

On Sonntag, 24. April 2005 20:15, Nicolas Huillard wrote:
> Hello,
> 
> I finally managed to compile and run 0.1.1, and plan to go in production 
> with it (leaving vdr-xine behind) : you all did a great job with 
> softdevice ! Lot of thanks !
> 
> As the subject tells : did anyone manage to regularly run softdevice as 
> a non-root user ?
> When running as root, DirectFB stops like below. I know it's a 
> long-lasting thread, and I thought it was possible, but I can't manage 
> to get the right conf.
> My /etc/directfbrc :
> 
> fbdev=/dev/fb0
> mode=720x576
> depth=32
> #pixelformat=AiRGB
> pixelformat=ARGB
> #sync
> #disable-module=keyboard
> disable-module=lirc
> disable-module=joystick
> disable-module=cle266
> graphics-vt
> #no-graphics-vt
> no-vt-switch
> no-vt-switching

Try option line:
no-vt
as DOK wrote on 2004-12-20 dfb-devel list. But he described that as new.
To use that, you may need to upgrade your directfb version ;-) .
(or look at thread "Running without root privileges" in directfb-users, Jan 2005).

> 
>         ---------------------- DirectFB v0.9.21 ---------------------
>               (c) 2000-2002  convergence integrated media GmbH
>               (c) 2002-2004  convergence GmbH
>          -----------------------------------------------------------
> 
> (*) DirectFB/Core: Single Application Core. (with MMX support) 
> (2004-08-05 20:17)

Stefan Lucke



From nhuillard at e-dition.fr  Sun Apr 24 21:30:24 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 24 Apr 2005 21:30:24 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <1114369966.3289.7.camel@africa>
References: <426BE238.9070507@e-dition.fr> <1114367708.3289.1.camel@africa>	 <426BEE2D.2010806@e-dition.fr> <1114369966.3289.7.camel@africa>
Message-ID: <426BF3D0.5000307@e-dition.fr>

Torgeir Veimo a ?crit :
> On Sun, 2005-04-24 at 21:06 +0200, Nicolas Huillard wrote:
> 
>>Torgeir Veimo a ?crit :
>>
>>>On Sun, 2005-04-24 at 20:15 +0200, Nicolas Huillard wrote:
>>>
>>>>As the subject tells : did anyone manage to regularly run softdevice as 
>>>>a non-root user ?
>>>>When running as root, DirectFB stops like below. I know it's a 
>>>>long-lasting thread, and I thought it was possible, but I can't manage 
>>>>to get the right conf.
>>>>
> Ok, my /etc/directfb:
> 
> mode=1280x720
> depth=32
> graphics-vt
> no-debug

I also tried this conf. Does not work.

I think this might be related to access mode on /dev/tty[0-9] and/or 
/dev/console.
Mine :

root at vdr:~# ll /dev/tty[0-9] /dev/console
crw-------  1 root tty  5, 1 Sep 17  2004 /dev/console
crw-------  1 vdr  vdr  4, 0 Sep 17  2004 /dev/tty0
crw-------  1 root root 4, 1 Apr 24 21:19 /dev/tty1
crw-------  1 root root 4, 2 Apr 24 21:19 /dev/tty2
crw-------  1 root root 4, 3 Apr 24 15:34 /dev/tty3
crw-------  1 root root 4, 4 Apr 24 15:34 /dev/tty4
crw-------  1 vdr  vdr  4, 5 Apr 24 21:19 /dev/tty5
crw-------  1 root root 4, 6 Aug 10  2004 /dev/tty6
crw--w----  1 root tty  4, 7 Mar 14  2002 /dev/tty7
crw--w----  1 root tty  4, 8 Mar 14  2002 /dev/tty8
crw--w----  1 root tty  4, 9 Mar 14  2002 /dev/tty9

/dev/tty5 pertaining to vdr:vdr at that time is the result of running 
VDR with the graphics-vt option, as root.
What does your /dev look like ?

I'll also upgrade DirectFB to the latest version : 0.9.22 or latest CVS ?

>>	Subject: [directfb-users] Running without root privileges
>>Basically, the no-vt-* I put would work if vdr is run from the console, 
>>instead of my habit to run it from an SSH session.
>>The undocumented "no-vt" option allows to not manipulate /dev/tty at 
>>all, and VDR works from SSH, but the console cursor still blinks, the 
>>console screensaver timeout also disables the output, etc...
>>I run VDR from the run-vdr script written by Darren Salt in C for his 
>>Debian packages.
> 
> I didn't know about this option. I can run vdr with dfb both from the
> console and from a ssh session, which i usually do when debugging. My
> run scripts is like this;
> 
> #!/bin/sh
> cd /usr/local/src/VDR
> export LD_ASSUME_KERNEL=2.4.1
> export LANG=en_US
> vdr -D 0 -D 1 -s "killall -9 vdr;/bin/false" -P"softdevice -vo dfb:"
> -P"remote -i /dev/input/event1"  -P"dvd -C/dev/dvd"

This is your testing script, right ?

>>Screen (00) FBDev Primary Screen            (primary screen)
>>   Caps:
>>
>>     Layer (00) FBDev Primary Layer             (primary layer)
>>        Type:
>>        Caps:
> 
> 
> [...]
> 
> It's a bit strange that there is no output of Caps, Type, etc. The
> output I get in my radeon setup is the following;

I also noticed. I don't think it worked like that last time I checked 
(loooong time ago). I'll definitely upgrade.

>>vdr at vdr:plugins$ dfbinfo
>>(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
>>
>>       ---------------------- DirectFB v0.9.21 ---------------------
>>             (c) 2000-2002  convergence integrated media GmbH
>>             (c) 2002-2004  convergence GmbH
>>        -----------------------------------------------------------
>>
>>(*) DirectFB/Core: Single Application Core. (with MMX support) (2004-08-05 20:17)
>>(*) Direct/Memcpy: Using SSE optimized memcpy()
>>(!) DirectFB/FBDev/vt: FBIOGET_CON2FBMAP failed!
>>    --> Inappropriate ioctl for device
>>(!) DirectFB/FBDev/vt: FBIOPUT_CON2FBMAP failed!
>>    --> Inappropriate ioctl for device
>>(!) DirectFB/fbdev/vt: KD_GRAPHICS failed!
>>    --> Operation not permitted
>>(!) DirectFB/Core: Could not initialize 'system' core!
>>    --> Initialization error!
>>(#) DirectFBError [DirectFBCreate() failed]: Initialization error!
> 
> 
> 
> Was this one with the no-vt option?

No : this is WITHOUT this option, that prevents any ioctl on VT
Any other no-vt-* option without this one does this output.

-- 
NH


From nhuillard at e-dition.fr  Sun Apr 24 21:37:49 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 24 Apr 2005 21:37:49 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <200504242114.08605.stefan@lucke.in-berlin.de>
References: <426BE238.9070507@e-dition.fr> <200504242114.08605.stefan@lucke.in-berlin.de>
Message-ID: <426BF58D.20903@e-dition.fr>

Stefan Lucke a ?crit :
> Try option line:
> no-vt
> as DOK wrote on 2004-12-20 dfb-devel list. But he described that as new.

I did, after that initial post.
But there are side effects : console screensaver, blinking cursor still 
there, etc.
How did you solve that ? I use the EPIA M10k with a 2.6.8.1 kernel 
patched with the viafb highly experimental frame-buffer driver (compiled 
2004-10-12 : time to upgrade to 2.6.11 ?)

> To use that, you may need to upgrade your directfb version ;-) .
> (or look at thread "Running without root privileges" in directfb-users, Jan 2005).

Do you recommend 0.9.22 or latest CVS ?

Thanks for your really great work. One thing I didn't realize until now 
is that softdevice is much more reactive than vdr-xine : pause/ff/rew is 
instantaneous, menus pop-up right, whereas vdr-xine showed delays up to 
the second, pausing displayed the still image one or more second after 
of before the playing.
Softdevice is really really nice !

-- 
NH


From nhuillard at e-dition.fr  Sun Apr 24 21:40:36 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 24 Apr 2005 21:40:36 +0200
Subject: [Softdevice-devel] softplay relaease ?
Message-ID: <426BF634.80500@e-dition.fr>

Didn't I read a few weeks ago that the softplay plugin would be a 
standalone plugin, that would still be released as part of softdevice ?
It does not seem to be in the released softdevice 0.1.1 : where do I get 
it ?

-- 
NH


From torgeir at pobox.com  Sun Apr 24 21:44:32 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 24 Apr 2005 20:44:32 +0100
Subject: [Softdevice-devel] softplay relaease ?
In-Reply-To: <426BF634.80500@e-dition.fr>
References: <426BF634.80500@e-dition.fr>
Message-ID: <1114371872.3289.13.camel@africa>

On Sun, 2005-04-24 at 21:40 +0200, Nicolas Huillard wrote:
> idn't I read a few weeks ago that the softplay plugin would be a 
> standalone plugin, that would still be released as part of
> softdevice ?
> It does not seem to be in the released softdevice 0.1.1 : where do I
> get 
> it ?

It's in softdevice cvs, module named softplay.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun Apr 24 21:59:06 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 24 Apr 2005 21:59:06 +0200
Subject: [Softdevice-devel] softplay relaease ?
In-Reply-To: <1114371872.3289.13.camel@africa>
References: <426BF634.80500@e-dition.fr> <1114371872.3289.13.camel@africa>
Message-ID: <200504242159.06692.stefan@lucke.in-berlin.de>

On Sonntag, 24. April 2005 21:44, Torgeir Veimo wrote:
> On Sun, 2005-04-24 at 21:40 +0200, Nicolas Huillard wrote:
> > idn't I read a few weeks ago that the softplay plugin would be a 
> > standalone plugin, that would still be released as part of
> > softdevice ?
> > It does not seem to be in the released softdevice 0.1.1 : where do I
> > get 
> > it ?
> 
> It's in softdevice cvs, module named softplay.

cvs -z3 -d:pserver:anonymous at cvs.softdevice.berlios.de:/cvsroot/softdevice co softplay

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Apr 24 22:12:51 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 24 Apr 2005 22:12:51 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <426BF58D.20903@e-dition.fr>
References: <426BE238.9070507@e-dition.fr> <200504242114.08605.stefan@lucke.in-berlin.de> <426BF58D.20903@e-dition.fr>
Message-ID: <200504242212.51110.stefan@lucke.in-berlin.de>

On Sonntag, 24. April 2005 21:37, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Try option line:
> > no-vt
> > as DOK wrote on 2004-12-20 dfb-devel list. But he described that as new.
> 
> I did, after that initial post.
> But there are side effects : console screensaver, blinking cursor still 
> there, etc.
> How did you solve that ? I use the EPIA M10k with a 2.6.8.1 kernel 
> patched with the viafb highly experimental frame-buffer driver (compiled 
> 2004-10-12 : time to upgrade to 2.6.11 ?)

I may suggest the following script:
-- cut --
# setup logfile name
LOGFILE=/var/log/my_vdr_logfile
#
# save prompt mode, hide prompt and switch cursor off
PSSAVE=${PS1}
export PS1=''
setterm -cursor off
#
# deactivate powersaving mode and clear screen
setterm -powersave off
clear
#
# start vdr
vdr PLACE_THE_USUAL_PARAMETER_HERE >${LOGFILE} 2>&1
# restore settings
export PS1=${PSSAVE}
setterm -default
-- cut --

> 
> > To use that, you may need to upgrade your directfb version ;-) .
> > (or look at thread "Running without root privileges" in directfb-users, Jan 2005).
> 

> Do you recommend 0.9.22 or latest CVS ?

To get the newest/latest feature/bugs: go with cvs. Cvs of softdevice
is required too, as there is a sudden API change in DirectFB.


-- 
Stefan Lucke



From nhuillard at e-dition.fr  Mon Apr 25 00:10:56 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 25 Apr 2005 00:10:56 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <200504242212.51110.stefan@lucke.in-berlin.de>
References: <426BE238.9070507@e-dition.fr> <200504242114.08605.stefan@lucke.in-berlin.de> <426BF58D.20903@e-dition.fr> <200504242212.51110.stefan@lucke.in-berlin.de>
Message-ID: <426C1970.3040408@e-dition.fr>

Stefan Lucke a ?crit :
> On Sonntag, 24. April 2005 21:37, Nicolas Huillard wrote:
> 
>>Stefan Lucke a ?crit :
>>
>>>Try option line:
>>>no-vt
>>>as DOK wrote on 2004-12-20 dfb-devel list. But he described that as new.
>>
>>I did, after that initial post.
>>But there are side effects : console screensaver, blinking cursor still 
>>there, etc.
>>How did you solve that ? I use the EPIA M10k with a 2.6.8.1 kernel 
>>patched with the viafb highly experimental frame-buffer driver (compiled 
>>2004-10-12 : time to upgrade to 2.6.11 ?)
> 
> 
> I may suggest the following script:
> -- cut --
> # setup logfile name
> LOGFILE=/var/log/my_vdr_logfile
> #
> # save prompt mode, hide prompt and switch cursor off
> PSSAVE=${PS1}
> export PS1=''
> setterm -cursor off
> #
> # deactivate powersaving mode and clear screen
> setterm -powersave off
> clear
> #
> # start vdr
> vdr PLACE_THE_USUAL_PARAMETER_HERE >${LOGFILE} 2>&1
> # restore settings
> export PS1=${PSSAVE}
> setterm -default
> -- cut --
> 
> 
>>>To use that, you may need to upgrade your directfb version ;-) .
>>>(or look at thread "Running without root privileges" in directfb-users, Jan 2005).
>>
> 
>>Do you recommend 0.9.22 or latest CVS ?
> 
> 
> To get the newest/latest feature/bugs: go with cvs. Cvs of softdevice
> is required too, as there is a sudden API change in DirectFB.

Upgraded to DirectFB CVS 20050424.
dfbinfo now shows good information (below). It still stops when no-vt is 
omited.
I'll use your setterm commands, but in a another more general place, 
somewhere near /etc/rcS.d/S05keymap.sh


vdr at vdr:video$ dfbinfo
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.23 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-04-24 21:20)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** 
[../../../lib/fusion/reactor.c:802]


Screen (00) FBDev Primary Screen            (primary screen)
    Caps: VSYNC POWER_MANAGEMENT

      Layer (00) FBDev Primary Layer             (primary layer)
         Type:    GRAPHICS
         Caps:    SURFACE BRIGHTNESS CONTRAST SATURATION

      Layer (01) VIA Unichrome Video
         Type:    GRAPHICS VIDEO STILL_PICTURE
         Caps:    SURFACE OPACITY SCREEN_LOCATION DEINTERLACING 
DST_COLORKEY LEVELS SCREEN_POSITION SCREEN_SIZE

      Layer (02) VIA Unichrome DVD Subpicture
         Type:    GRAPHICS VIDEO STILL_PICTURE
         Caps:    SURFACE OPACITY


-- 
NH


From nhuillard at e-dition.fr  Mon Apr 25 00:58:18 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 25 Apr 2005 00:58:18 +0200
Subject: [Softdevice-devel] Running softdevice:dfb as not root
In-Reply-To: <200504242212.51110.stefan@lucke.in-berlin.de>
References: <426BE238.9070507@e-dition.fr> <200504242114.08605.stefan@lucke.in-berlin.de> <426BF58D.20903@e-dition.fr> <200504242212.51110.stefan@lucke.in-berlin.de>
Message-ID: <426C248A.8070804@e-dition.fr>

Stefan Lucke a ?crit :
> On Sonntag, 24. April 2005 21:37, Nicolas Huillard wrote:
> 
>>Stefan Lucke a ?crit :
>>
>>>Try option line:
>>>no-vt
>>>as DOK wrote on 2004-12-20 dfb-devel list. But he described that as new.
>>
>>I did, after that initial post.
>>But there are side effects : console screensaver, blinking cursor still 
>>there, etc.
>>How did you solve that ? I use the EPIA M10k with a 2.6.8.1 kernel 
>>patched with the viafb highly experimental frame-buffer driver (compiled 
>>2004-10-12 : time to upgrade to 2.6.11 ?)
> 
> 
> I may suggest the following script:
> -- cut --
> # setup logfile name
> LOGFILE=/var/log/my_vdr_logfile
> #
> # save prompt mode, hide prompt and switch cursor off
> PSSAVE=${PS1}
> export PS1=''
> setterm -cursor off
> #
> # deactivate powersaving mode and clear screen
> setterm -powersave off
> clear
> #
> # start vdr
> vdr PLACE_THE_USUAL_PARAMETER_HERE >${LOGFILE} 2>&1
> # restore settings
> export PS1=${PSSAVE}
> setterm -default
> -- cut --

For the record, I modified the /etc/init.d/console-screen.sh Debian 
script, as follows :

     # screensaver stuff
     setterm_args=""
     if [ "$BLANK_TIME" ]; then
         setterm_args="$setterm_args -blank $BLANK_TIME"
     fi
     if [ "$BLANK_DPMS" ]; then
         setterm_args="$setterm_args -powersave $BLANK_DPMS"
     fi
     if [ "$POWERDOWN_TIME" ]; then
         setterm_args="$setterm_args -powerdown $POWERDOWN_TIME"
     fi
/+nh
     # Cursor state
     if [ "$CURSOR" ]; then
         setterm_args="$setterm_args -cursor $CURSOR"
     fi
/-nh
     if [ "$setterm_args" ]; then
         setterm $setterm_args
     fi


...and added the conf line in /etc/console-tools/config :
# Turn cursor off
CURSOR=off


My /etc/directfbrc is now :
mode=720x576
depth=32
pixelformat=ARGB
disable-module=lirc
disable-module=joystick
disable-module=cle266
no-vt

-- 
NH


From nhuillard at e-dition.fr  Mon Apr 25 01:05:52 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 25 Apr 2005 01:05:52 +0200
Subject: [Softdevice-devel] DirectFB 0.9.21 vs. current CVS
Message-ID: <426C2650.8060303@e-dition.fr>

On the same testing recording, the CPU usage increased from 35% using 
0.9.21 to 50% using CVS 20050424.
EPIA M10k / CLE266 / FFMPEG 20040509
For what it may serve.

-- 
NH


From torgeir at pobox.com  Mon Apr 25 03:16:45 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 25 Apr 2005 02:16:45 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t
Message-ID: <1114391805.3289.16.camel@africa>

Am starting to count Flip() calls when using DFB, but am only seeing 25
Flip() calls per second. Surely dvb-t transmits with 50fps?? Have tried
turning off deinterlacing with the same result. Any clues?
-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Mon Apr 25 06:51:28 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 25 Apr 2005 06:51:28 +0200
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114391805.3289.16.camel@africa>
References: <1114391805.3289.16.camel@africa>
Message-ID: <200504250651.28892.stefan@lucke.in-berlin.de>

On Montag, 25. April 2005 03:16, Torgeir Veimo wrote:
> Am starting to count Flip() calls when using DFB, but am only seeing 25
> Flip() calls per second. Surely dvb-t transmits with 50fps?? Have tried
> turning off deinterlacing with the same result. Any clues?

25Hz is ok. This are 50 half frames (top/bottom fields per second).
My problem when sometimes a short judder appeares is in contrast
to my initial thought the other way. TV refreshrate seems to be slower
than transmitted rate. As I see allways large negative numbers on the
delay call (-120000 and jumping). I'll try to increase the refreshrate
of my MGA cards by modifying directfb code (decrease the number of
lines, which should result in a shorter vsync pulse).

I moved the delay stuff to a syncTimer which could be
modified/overwritten by the actual output method. The current
disadvantage is that I have to turn USE_SUBPLUGINS off to avoid
linkage errors. So device controllable delays must be move into a
separate file.

For getting a stereo downmix of a ac3 track, number of channels
must be set fix to two in context->channels. This is when
ffmpeg is compiled with the following options :
./configure --enable-shared --enable-pp --enable-shared-pp  --enable-gpl --enable-a52

Stefan Lucke



From nhuillard at e-dition.fr  Mon Apr 25 10:14:09 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 25 Apr 2005 10:14:09 +0200
Subject: [Softdevice-devel] DirectFB 0.9.21 vs. current CVS
In-Reply-To: <426C2650.8060303@e-dition.fr>
References: <426C2650.8060303@e-dition.fr>
Message-ID: <426CA6D1.7000208@e-dition.fr>

Nicolas Huillard a ?crit :
> On the same testing recording, the CPU usage increased from 35% using 
> 0.9.21 to 50% using CVS 20050424.

It was not the same part of the recording : 720x576 vs. 544x576
The change in resolution explains the change in perf.

Sorry.

-- 
NH


From torgeir at pobox.com  Mon Apr 25 19:15:05 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 25 Apr 2005 18:15:05 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <200504250651.28892.stefan@lucke.in-berlin.de>
References: <1114391805.3289.16.camel@africa>
	 <200504250651.28892.stefan@lucke.in-berlin.de>
Message-ID: <1114449305.3289.37.camel@africa>

On Mon, 2005-04-25 at 06:51 +0200, Stefan Lucke wrote:
> On Montag, 25. April 2005 03:16, Torgeir Veimo wrote:
> > Am starting to count Flip() calls when using DFB, but am only seeing
> 25
> > Flip() calls per second. Surely dvb-t transmits with 50fps?? Have
> tried
> > turning off deinterlacing with the same result. Any clues?
> 
> 25Hz is ok. This are 50 half frames (top/bottom fields per second).

This is what i expected, but that libavcodec would emit these frames at
50 fps when not deinterlacing, and not combine them itself. I probably
need to find a transmission with progressive signal to see if it's
displayed at 50fps.

Also, if using a video type deinterlacer, I'd expect libavcodec to
deinterlace to 50 fps, and not 25 fps, as one would expect with a film
type deinterlacer. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Tue Apr 26 02:55:39 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 26 Apr 2005 01:55:39 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114449305.3289.37.camel@africa>
References: <1114391805.3289.16.camel@africa>
	 <200504250651.28892.stefan@lucke.in-berlin.de>
	 <1114449305.3289.37.camel@africa>
Message-ID: <1114476939.32332.6.camel@africa>

On Mon, 2005-04-25 at 18:15 +0100, Torgeir Veimo wrote:
> On Mon, 2005-04-25 at 06:51 +0200, Stefan Lucke wrote:
> > On Montag, 25. April 2005 03:16, Torgeir Veimo wrote:
> > > Am starting to count Flip() calls 

Here's a rough implementation of a counter using FBIO_WAITFORVSYNC
ioctl. There are some race issues, ideally, there would be a vsync
serial counter in the fb module implementation, and the count should be
returned from DFB's Flip() method. I might try to get it right even
without that.

Drift can be calculated as accumulated late / early frames. This version
only prints out a * when it detects a difference to last serial that is
not 2. 

There should probably be a way to turn it on and off interactively, eg
using the key j.

-- 
Torgeir Veimo <torgeir at pobox.com>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vsync.diff
Type: text/x-patch
Size: 5711 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050426/a5332a51/attachment.bin>

From torgeir at pobox.com  Tue Apr 26 02:59:39 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 26 Apr 2005 01:59:39 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114476939.32332.6.camel@africa>
References: <1114391805.3289.16.camel@africa>
	 <200504250651.28892.stefan@lucke.in-berlin.de>
	 <1114449305.3289.37.camel@africa>  <1114476939.32332.6.camel@africa>
Message-ID: <1114477179.32420.0.camel@africa>

On Tue, 2005-04-26 at 01:55 +0100, Torgeir Veimo wrote:
> On Mon, 2005-04-25 at 18:15 +0100, Torgeir Veimo wrote:
> > On Mon, 2005-04-25 at 06:51 +0200, Stefan Lucke wrote:
> > > On Montag, 25. April 2005 03:16, Torgeir Veimo wrote:
> > > > Am starting to count Flip() calls 
> 
> Here's a rough implementation of a counter using FBIO_WAITFORVSYNC
> ioctl.

It requires either a matrox fb module, or a radeon fb module with my
vsync ioctl patch.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Tue Apr 26 12:36:25 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 26 Apr 2005 12:36:25 +0200
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114476939.32332.6.camel@africa>
References: <1114391805.3289.16.camel@africa>  <200504250651.28892.stefan@lucke.in-berlin.de>  <1114449305.3289.37.camel@africa> <1114476939.32332.6.camel@africa>
Message-ID: <1114511785.426e19a99f70f@webmail.in-berlin.de>

Quoting Torgeir Veimo:

> On Mon, 2005-04-25 at 18:15 +0100, Torgeir Veimo wrote:
> > On Mon, 2005-04-25 at 06:51 +0200, Stefan Lucke wrote:
> > > On Montag, 25. April 2005 03:16, Torgeir Veimo wrote:
> > > > Am starting to count Flip() calls
>
> Here's a rough implementation of a counter using FBIO_WAITFORVSYNC
> ioctl. There are some race issues, ideally, there would be a vsync
> serial counter in the fb module implementation, and the count should be
> returned from DFB's Flip() method. I might try to get it right even
> without that.

The monitor thread should look at the currently used head, instead of
fixed /dev/fb0. I think it should work too when calling dfb method:
osdLayer->WaitForSync().

So for this test osdLayer should be public.

Stefan Lucke


From torgeir at pobox.com  Tue Apr 26 12:51:01 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 26 Apr 2005 11:51:01 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114511785.426e19a99f70f@webmail.in-berlin.de>
References: <1114391805.3289.16.camel@africa>
	 <200504250651.28892.stefan@lucke.in-berlin.de>
	 <1114449305.3289.37.camel@africa> <1114476939.32332.6.camel@africa>
	 <1114511785.426e19a99f70f@webmail.in-berlin.de>
Message-ID: <1114512661.32420.4.camel@africa>

On Tue, 2005-04-26 at 12:36 +0200, Stefan Lucke wrote:
> 
> 
> The monitor thread should look at the currently used head, instead of
> fixed /dev/fb0. I think it should work too when calling dfb method:
> osdLayer->WaitForSync().

I'm just worried that this method might just wait for the irq bit to get
high by polling, instead of using the ioctl. I need to verify that.

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Tue Apr 26 20:05:34 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 26 Apr 2005 21:05:34 +0300
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <20050331210419.GB113658@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi>
Message-ID: <20050426180534.GB8796@kosh.hut.fi>

On Fri, Apr 01, 2005 at 12:04:19AM +0300, Marko M?kel? wrote:
> Well, such crashes affect the overall usability of the product.  I think
> it's a design flaw to have assertions fail on garbage input.  It's so likely
> to get garbage DVB data.  Next time when I get such a crash, I promise to
> save the clip and to analyze it further.

Now I managed to get a repeatable crash with one particular clip.  It could
be related to aspect ratio change (4:3 for the announcement, 16:9 for the
program) or subtitles (although it still crashes without the "subtitles"
plugin being loaded in VDR 1.3.23).

I also got some other crashes recently, especially when using the pause,
fast forward, rewind, and slow motion functions in rapid succession.  Maybe
libavcodec can be left in inconsistent state during these functions?

It's kind of funny and lucky that a crash of the player thread does not always
stop the recording thread, but today it unfortunately did once, even though
the svdrp thread was still running.  On Sunday, there was a crash during or
after unattended recording.  The recording was complete.

I can upload the repeatably-crashing clip to an http server, but I don't want
to announce the URL in public.  So, could the interested parties please reply?

By the way, the "mute" function does not interrupt audio playback or make the
sound completely inaudible.  Can someone look at that?

	Marko


From stefan at lucke.in-berlin.de  Wed Apr 27 09:39:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 27 Apr 2005 09:39:26 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <20050426180534.GB8796@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi>
Message-ID: <1114587566.426f41ae0c0b6@webmail.in-berlin.de>

Quoting Marko M?kel?:

> On Fri, Apr 01, 2005 at 12:04:19AM +0300, Marko M?kel? wrote:
> > Well, such crashes affect the overall usability of the product.  I think
> > it's a design flaw to have assertions fail on garbage input.  It's so
> likely
> > to get garbage DVB data.  Next time when I get such a crash, I promise to
> > save the clip and to analyze it further.
>
> Now I managed to get a repeatable crash with one particular clip.  It could
> be related to aspect ratio change (4:3 for the announcement, 16:9 for the
> program) or subtitles (although it still crashes without the "subtitles"
> plugin being loaded in VDR 1.3.23).

I've some of crash situation my self. But I'll ve a look at your test
stream later this evening. For me it happens upon 4:3 -> 16:9 switch.
I think it is related to this:

http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html

You may try that with vdr running for gdb too.

>
> I also got some other crashes recently, especially when using the pause,
> fast forward, rewind, and slow motion functions in rapid succession.  Maybe
> libavcodec can be left in inconsistent state during these functions?

Please run vdr from gdb to get a back trace.
example:
  gdb ./ vdr
  set args your_usual_commandline for vdr

if vdr crashed:
  bt

>
> It's kind of funny and lucky that a crash of the player thread does not
> always
> stop the recording thread, but today it unfortunately did once, even though
> the svdrp thread was still running.  On Sunday, there was a crash during or
> after unattended recording.  The recording was complete.
>
> I can upload the repeatably-crashing clip to an http server, but I don't want
> to announce the URL in public.  So, could the interested parties please
> reply?

Thanks for your link I'll check that this evening.

>
> By the way, the "mute" function does not interrupt audio playback or make the
> sound completely inaudible.  Can someone look at that?

But you can controll volume setting via vdr ?

Stefan Lucke


From marko.makela at hut.fi  Wed Apr 27 11:27:37 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 27 Apr 2005 12:27:37 +0300
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <1114587566.426f41ae0c0b6@webmail.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de>
Message-ID: <20050427092737.GA99555@kosh.hut.fi>

On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> I've some of crash situation my self. But I'll ve a look at your test
> stream later this evening. For me it happens upon 4:3 -> 16:9 switch.
> I think it is related to this:
> 
> http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> 
> You may try that with vdr running for gdb too.

Thanks, I'll try that tonight.

> Please run vdr from gdb to get a back trace.
> example:
>   gdb ./ vdr
>   set args your_usual_commandline for vdr
> 
> if vdr crashed:
>   bt

I'd also try:
i thr
thr 1
bt
thr 2
bt
...
(Or is there a simpler way to extract the stack traces from all threads?)

> But you can controll volume setting via vdr ?

Yes.  If I set the volume to the minimum, it will be about the same level
as with the Mute button.  I'm using the computer's onboard AC97 audio
connected to a set of speakers that are powered from the PC's 12-volt
power supply.  The sound drivers are the ALSA drivers in Linux 2.6.11.6,
for a VIA sound controller if I remember correctly.

	Marko


From nhuillard at e-dition.fr  Wed Apr 27 12:44:27 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 27 Apr 2005 12:44:27 +0200
Subject: [Softdevice-devel] Aspect ratio handling
Message-ID: <426F6D0B.5010407@e-dition.fr>

Hello all,

I've connected my VDR/softdevice box to the TV (PAL 16/9), and have a 
few problems
with aspect ratio handling by softdevice vs. EPIA TV output size/aspect.

Hardware-wise :
* the EPIA M10k has a s-video output, driven by a VT1622 chip
* this chip receive configuration data from the viafb frame-buffer
kernel driver, upon mode change
* these data tables come from VIA, and have a few derivatives on various
files on the net (XFree drivers, viafb patches to the kernel, etc.)

TV-wise :
* with the tvoverscan module parameter, the output is adequately large
(there is really an overscan, that is the image goes beyond the edges of
the visible part of the screen, but I don't know how far)
* in 800x600 (not taking /etc/fb.modes into account), the image is
blurred by the anti-flicker filter : this is really bad, because VDR
does not need it, and blurring decrease quality
* in 720x576, the image is not blurred (the configuration data for this
mode might not have the anti-flicker option set : good), but there are
missing lines on the screen : about 24 lines (seems to be 600 - 576) are
not shown on the screen (the horizontal bar of the A is missing)
* I will check the viafb TV tables to tune them (remove anti-flicker in
800x600 or add the missing lines in 720x576), but they are very obscure

User-wise :
* I would like to have the video output of VDR covering the maximum
surface, not leaving blacks bars on top/bottom or left-right edges
* sat TV programs in France almost always have horizontal black bars in
the stream : a 2.35 aspect ratio is sent in a 720x576 frame, with 1/4
black at top and 1/4 black at bottom. Even 16/9 broadcasts have black
bars, that need to be removed when showed on the 16/9 screen

VDR/softdevice-wise :
* the pixel aspect ratio setting is something I don't seem to master
myself : I'm always confused by naming, meaning, etc.
* there are two setting : crop-mode and pixel format. This is not really
easy to find the right combination, and to change the setting when the
stream changes (not easy for me, thus undoable for the rest of the familly)
* the 800x600 ratio is not the same as 720x576 : 1.33 vs. 1.25. Along
with the fact that the TV is 16/9, not 4/3, I'm totally lost...
* the resize algo makes sure the whole image fit the screen : a 720x576
stream inside a 800x600 screen will never be wider than 750, even though
there are black bar on top and bottom

Questions :
* does anyone have already dug into the viafb TV tables (PAL 800x600,
720x576) ?
* is it possible to implement in softdevice aspect-ratio handling
something like "maximize the size of the image", along with the current
"make sure the image fits in the screen" ? This way a scaling that
currently scale an image to 750 wide with in-stream black bar on
top/bottom, would scale it to 800 wide cropping a few black lines on top
and bottom.
* can the softdevice plug-in receive LIRC events to change aspect ratio
on a single remote keypress ?

I will provide real sample values when I have them (stream sizes,
softdevice logs, approximate useful image sizes).

(just an idea after writing this : the crop-mode has the "none", "4:3"
and "16:9" options. Maybe I need a "16:9 screen on 4:3 resolution" vs.
"16:9 screen on 5:4 resolution" option, or this should adapt to the
actual resolution)

-- 
NH



From marko.makela at hut.fi  Wed Apr 27 20:38:49 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 27 Apr 2005 21:38:49 +0300
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <1114587566.426f41ae0c0b6@webmail.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de>
Message-ID: <20050427183849.GA330538@kosh.hut.fi>

On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> 
> You may try that with vdr running for gdb too.

I got a nice crash in libavcodec:

(gdb) bt full
#0  0xb7a1a358 in ff_mpeg1_encode_init () from /usr/lib/libavcodec-cvs.so
No symbol table info available.
#1  0xb7a1897d in ff_mpeg1_encode_init () from /usr/lib/libavcodec-cvs.so
No symbol table info available.
#2  0xb7a1bb35 in ff_mpeg1_encode_init () from /usr/lib/libavcodec-cvs.so
No symbol table info available.
#3  0xb7a1cdf3 in ff_mpeg1_find_frame_end () from /usr/lib/libavcodec-cvs.so
No symbol table info available.
#4  0xb7925179 in avcodec_decode_video () from /usr/lib/libavcodec-cvs.so
No symbol table info available.
#5  0xb7caabdd in cVideoStreamDecoder::DecodePacket ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
No symbol table info available.
#6  0xb7ca9c34 in cStreamDecoder::Action ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.23
No symbol table info available.
#7  0x080e3bc6 in cThread::StartThread (Thread=0x83e5c70) at thread.c:227
No locals.
#8  0xb7f77e51 in pthread_start_thread () from /lib/libpthread.so.0
No symbol table info available.
#9  0xb7f77ecf in pthread_start_thread_event () from /lib/libpthread.so.0
No symbol table info available.
#10 0xb7e2e92a in clone () from /lib/libc.so.6
---Type <return> to continue, or q <return> to quit---
No symbol table info available.
(gdb) i thr
  20 Thread 294925 (LWP 3249)  0xb7e25ada in poll () from /lib/libc.so.6
* 19 Thread 278540 (LWP 3248)  0xb7a1a358 in ff_mpeg1_encode_init ()
   from /usr/lib/libavcodec-cvs.so
  18 Thread 262155 (LWP 3247)  0xb7f7e456 in nanosleep ()
   from /lib/libpthread.so.0
  17 Thread 245770 (LWP 3246)  0xb7f7e456 in nanosleep ()
   from /lib/libpthread.so.0
  16 Thread 229385 (LWP 3245)  0xb7dceb7f in memcpy () from /lib/libc.so.6
  9 Thread 114696 (LWP 3237)  0xb7dfedb6 in nanosleep () from /lib/libc.so.6
  8 Thread 98311 (LWP 3236)  0xb7f7dabb in read () from /lib/libpthread.so.0
  7 Thread 81926 (LWP 3233)  0xb7f7dabb in read () from /lib/libpthread.so.0
  6 Thread 65541 (LWP 3229)  0xb7f7dabb in read () from /lib/libpthread.so.0
  5 Thread 49156 (LWP 3213)  0xb7f7a604 in __pthread_sigsuspend ()
   from /lib/libpthread.so.0
  4 Thread 32771 (LWP 3204)  0xb7e25ada in poll () from /lib/libc.so.6
  3 Thread 16386 (LWP 3203)  0xb7f7e456 in nanosleep ()
   from /lib/libpthread.so.0
  2 Thread 32769 (LWP 3202)  0xb7e25ada in poll () from /lib/libc.so.6
  1 Thread 16384 (LWP 3198)  0xb7f7e456 in nanosleep ()
   from /lib/libpthread.so.0
(gdb)

I'm using libavcodeccvs unofficially packaged for Debian GNU/Linux by
Christian Marillat, version 2:20050417-0.0 (10 days old).  I'll test
by compiling the current CVS from source when I come around to it.
Hmm, I wonder which audio decoder is used in DVB, i.e., which additional
libraries I will need.  Is it MPEG layer 2?  Certainly not AAC, or is it?
For the moment, I'm compiling it without any extra sound decoder libraries.

> > By the way, the "mute" function does not interrupt audio playback or
> > make the sound completely inaudible.  Can someone look at that?
> 
> But you can controll volume setting via vdr ?

I've now confirmed that the "mute" setting is equivalent to the smallest
possible volume level setting.  It is clearly audible from my speakers
to at least 10 meters distance, maybe 20 meters.

	Marko


From stefan at lucke.in-berlin.de  Wed Apr 27 21:13:47 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 27 Apr 2005 21:13:47 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <20050427183849.GA330538@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de> <20050427183849.GA330538@kosh.hut.fi>
Message-ID: <200504272113.47316.stefan@lucke.in-berlin.de>

On Mittwoch, 27. April 2005 20:38, Marko M?kel? wrote:
> On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> > http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> > 
> > You may try that with vdr running for gdb too.
> 
> I got a nice crash in libavcodec:

Some similar crash here. And that is suprising, as my ffmpeg has
a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
switch. Your stream has _no_ such switch and when reverting
ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
the segfault has gone.

> 
> > > By the way, the "mute" function does not interrupt audio playback or
> > > make the sound completely inaudible.  Can someone look at that?
> > 
> > But you can controll volume setting via vdr ?
> 
> I've now confirmed that the "mute" setting is equivalent to the smallest
> possible volume level setting.  It is clearly audible from my speakers
> to at least 10 meters distance, maybe 20 meters.

Can you try to replace (audio.c):
    setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
by:
    if(vol)
      setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
    else
      setVol = mixerMin;


-- 
Stefan Lucke



From nhuillard at e-dition.fr  Wed Apr 27 21:15:52 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 27 Apr 2005 21:15:52 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <20050427183849.GA330538@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de> <20050427183849.GA330538@kosh.hut.fi>
Message-ID: <426FE4E8.1000302@e-dition.fr>

Marko M?kel? a ?crit :
>>>By the way, the "mute" function does not interrupt audio playback or
>>>make the sound completely inaudible.  Can someone look at that?
>>
>>But you can controll volume setting via vdr ?
> 
> I've now confirmed that the "mute" setting is equivalent to the smallest
> possible volume level setting.  It is clearly audible from my speakers
> to at least 10 meters distance, maybe 20 meters.

I also experience the same problem, with the following setup : 
"Multimedia audio controller: VIA Technologies, Inc. VT8233/A/8235/8237 
AC97 Audio Controller" connected with stereo analog cable to hifi receiver.
When alsamixer PCM output is set to 0, the is still an audio output.
Also, when the output is more than 85%, the sound tends to be distorted. 
Since I use the receiver to set volume, I do not change VDR's volume 
setting at let it at 78% (200/255).
Also, OSD refresh is clearly audible (when sound is VDR muted) through 
the receiver at high amp.
I think Via audio chip are very very far from being Hifi components...

-- 
NH


From torgeir at pobox.com  Wed Apr 27 22:29:37 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 27 Apr 2005 21:29:37 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114512661.32420.4.camel@africa>
References: <1114391805.3289.16.camel@africa>
	 <200504250651.28892.stefan@lucke.in-berlin.de>
	 <1114449305.3289.37.camel@africa> <1114476939.32332.6.camel@africa>
	 <1114511785.426e19a99f70f@webmail.in-berlin.de>
	 <1114512661.32420.4.camel@africa>
Message-ID: <1114633777.4637.7.camel@africa>

On Tue, 2005-04-26 at 11:51 +0100, Torgeir Veimo wrote:
> On Tue, 2005-04-26 at 12:36 +0200, Stefan Lucke wrote:
> > 
> > 
> > The monitor thread should look at the currently used head, instead of
> > fixed /dev/fb0. I think it should work too when calling dfb method:
> > osdLayer->WaitForSync().
> 
> I'm just worried that this method might just wait for the irq bit to get
> high by polling, instead of using the ioctl. I need to verify that.

I am suspecting some of the judder I'm seeing is in fact might related
to each frame being Flip()'ed a bit too early hitting the vertical
refresh before it should be actually be shown. It might be an idea to
try a DirectFB video out implementation which doesn't call Flip()
immediately in the YUV method, but instead calls Flip() in a separate
thread that is just responsible for waiting for a vertical refresh and
flipping with the pattern waitForVSync(), Flip(), waitForVSync(), Flip()
etc., and use DSFLIP_WAITFORSYNC behaviour for Flip() calls.

Since this output method would be synchronized with the video output
framerate, it would be possible to detect framerate drift as well.

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Wed Apr 27 22:57:10 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 27 Apr 2005 23:57:10 +0300
Subject: [Softdevice-devel] VIA audio quality or lack thereof
In-Reply-To: <426FE4E8.1000302@e-dition.fr>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de> <20050427183849.GA330538@kosh.hut.fi> <426FE4E8.1000302@e-dition.fr>
Message-ID: <20050427205710.GA195670@kosh.hut.fi>

On Wed, Apr 27, 2005 at 09:15:52PM +0200, Nicolas Huillard wrote:
> I also experience the same problem, with the following setup : 
> "Multimedia audio controller: VIA Technologies, Inc. VT8233/A/8235/8237 
> AC97 Audio Controller" connected with stereo analog cable to hifi receiver.

For my setup, alsamixer reports the following:
Card: VIA 82C686A/B rev50
Chip: ICEnsemble ICE1232

Also, lspci -vv says it's "VIA Technologies, Inc. Onboard Audio on EP7KXA".

> Also, OSD refresh is clearly audible (when sound is VDR muted) through 
> the receiver at high amp.

Well, as my speakers are powered from the +12V from the ATX power supply,
I'm hearing hard disk accesses as well, even though I added a coil to
the +12V line.  Maybe I should build a relay circuit to control the original
linear power supply of the speakers as well as the power feed of the monitor.

> I think Via audio chip are very very far from being Hifi components...

It's certainly not the only problem with VIA hardware.  I wonder why I
haven't seen any hardware lockups - I've heard and read that VIA chipsets
may have some race conditions in DMA handling, e.g., when copying large
files over Ethernet or Firewire to an ATAPI hard disk.

I'll test the audio things and the ffmpeg changes tomorrow.

	Marko


From nhuillard at e-dition.fr  Thu Apr 28 01:39:47 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 28 Apr 2005 01:39:47 +0200
Subject: [Softdevice-devel] VIA audio quality or lack thereof
In-Reply-To: <20050427205710.GA195670@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <4242D9CB.7090505@gmx.net> <20050329062016.GA18816@kosh.hut.fi> <424AF96C.8030001@gmx.net> <20050331210419.GB113658@kosh.hut.fi> <20050426180534.GB8796@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de> <20050427183849.GA330538@kosh.hut.fi> <426FE4E8.1000302@e-dition.fr> <20050427205710.GA195670@kosh.hut.fi>
Message-ID: <427022C3.7070309@e-dition.fr>

Marko M?kel? a ?crit :
> On Wed, Apr 27, 2005 at 09:15:52PM +0200, Nicolas Huillard wrote:
> 
>>I also experience the same problem, with the following setup : 
>>"Multimedia audio controller: VIA Technologies, Inc. VT8233/A/8235/8237 
>>AC97 Audio Controller" connected with stereo analog cable to hifi receiver.
> 
> For my setup, alsamixer reports the following:
> Card: VIA 82C686A/B rev50
> Chip: ICEnsemble ICE1232

Here :
Card: VIA 8235
Chip: ICEnsemble VT1616i
You have the previous generation of the chip.

> Also, lspci -vv says it's "VIA Technologies, Inc. Onboard Audio on EP7KXA".
> 
>>Also, OSD refresh is clearly audible (when sound is VDR muted) through 
>>the receiver at high amp.
> 
> Well, as my speakers are powered from the +12V from the ATX power supply,
> I'm hearing hard disk accesses as well, even though I added a coil to
> the +12V line.  Maybe I should build a relay circuit to control the original
> linear power supply of the speakers as well as the power feed of the monitor.

Look at OWFS (http://owfs.sourceforge.net/) for controling the real 
world using your favorite Linux box. I drive the heaters of the whole 
house, ventilation, and monitor temperatures with this. The software 
project is very active (attractive, too), and the hardware parts 
(1-wire, from Dallas/Maxim) is pretty strong : you can drive a 100m 
network the same way you drive a chip 10cm away inside your computer 
case. 1-wire covers the range from I2C to X10, and more.

>>I think Via audio chip are very very far from being Hifi components...
> 
> It's certainly not the only problem with VIA hardware.  I wonder why I
> haven't seen any hardware lockups - I've heard and read that VIA chipsets
> may have some race conditions in DMA handling, e.g., when copying large
> files over Ethernet or Firewire to an ATAPI hard disk.

I regularly copy recordings from the ATA local disk to the network. No 
problems yet. I once had problems with the Ethernet port not working 
(blinking LED), with some power supply (wrong ground).

-- 
NH


From nhuillard at e-dition.fr  Thu Apr 28 12:06:31 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 28 Apr 2005 12:06:31 +0200
Subject: [Softdevice-devel] Does anyone have a PNG image to test s-video output ?
Message-ID: <4270B5A7.40106@e-dition.fr>

Hello,

I'm looking for a PNG image to test s-video output of the CLE266/VT1622.
That's something we call "mire" in french, showing squares, color bars,
diagonals, sizes, etc.
I need it in PNG (or so) format to display on the screen with dfbshow,
in 720x576 and 800x600 resolutions.
Google does not find anything for me (maybe because I don't have the
english word for it). I can also look for a DVB channel showing
something like that, but I'd prefer a static PNG without MPEG artifacts.

TIA

-- 
NH



From torgeir at pobox.com  Thu Apr 28 12:34:06 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Thu, 28 Apr 2005 11:34:06 +0100
Subject: [Softdevice-devel] Does anyone have a PNG image to test
	s-video output ?
In-Reply-To: <4270B5A7.40106@e-dition.fr>
References: <4270B5A7.40106@e-dition.fr>
Message-ID: <1114684446.4637.20.camel@africa>

On Thu, 2005-04-28 at 12:06 +0200, Nicolas Huillard wrote:
> Hello,
> 
> I'm looking for a PNG image to test s-video output of the CLE266/VT1622.
> That's something we call "mire" in french, showing squares, color bars,
> diagonals, sizes, etc.
> I need it in PNG (or so) format to display on the screen with dfbshow,
> in 720x576 and 800x600 resolutions.
> Google does not find anything for me (maybe because I don't have the
> english word for it). I can also look for a DVB channel showing
> something like that, but I'd prefer a static PNG without MPEG artifacts.

Something like http://web-tv.fr/images/mire.gif ? It's not png though.
Try using google image search ala 

http://images.google.co.uk/images?q=tv%20test%20picture

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Thu Apr 28 13:07:31 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 28 Apr 2005 13:07:31 +0200
Subject: [Softdevice-devel] Does anyone have a PNG image to test	s-video
 output ?
In-Reply-To: <1114684446.4637.20.camel@africa>
References: <4270B5A7.40106@e-dition.fr> <1114684446.4637.20.camel@africa>
Message-ID: <4270C3F3.5070702@e-dition.fr>

Torgeir Veimo a ?crit :
> On Thu, 2005-04-28 at 12:06 +0200, Nicolas Huillard wrote:
> 
>>Hello,
>>
>>I'm looking for a PNG image to test s-video output of the CLE266/VT1622.
>>That's something we call "mire" in french, showing squares, color bars,
>>diagonals, sizes, etc.
>>I need it in PNG (or so) format to display on the screen with dfbshow,
>>in 720x576 and 800x600 resolutions.
>>Google does not find anything for me (maybe because I don't have the
>>english word for it). I can also look for a DVB channel showing
>>something like that, but I'd prefer a static PNG without MPEG artifacts.
> 
> Something like http://web-tv.fr/images/mire.gif ? It's not png though.

That's it, except that this one is 640x480 and I'd rather not resize it, 
to clearly view the s-video artifacts on the TV.

> Try using google image search ala 
> 
> http://images.google.co.uk/images?q=tv%20test%20picture

It gets a lot of images, but none at the right size, and many are too 
blurred for my purpose.
Thanks for the advice.

Lucian Muresan privately sent attached images, and a link to the 
application that generate them.
See below for the record :

 > if you'd have a windows machine (maybe even if you'd have a windows
 > partition on your htpc) on which you could setup those resolutions, then
 > you could PrintScreen lots of "mire"-s (we call it identically in
 > romanian ;-) ) for various effects you'd want to analyze on your TV with
 > "Nokia Monitor Test":
 >
 > http://www.idg.pl/ftp/download/pc_2678/Ntest2.exe
 >
 > If you don't have access to a windows machine or can't generate those
 > pictures yourself, I attached some, maybe they're useful.

Thanks to all.

-- 
NH


From nhuillard at e-dition.fr  Thu Apr 28 13:11:49 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 28 Apr 2005 13:11:49 +0200
Subject: [Softdevice-devel] Does anyone have a PNG image to test	s-video
 output ?
In-Reply-To: <4270C3F3.5070702@e-dition.fr>
References: <4270B5A7.40106@e-dition.fr> <1114684446.4637.20.camel@africa> <4270C3F3.5070702@e-dition.fr>
Message-ID: <4270C4F5.6080201@e-dition.fr>

Nicolas Huillard a ?crit :
> Lucian Muresan privately sent attached images, and a link to the 
> application that generate them.

I uploaded the said images to http://nicolas.huillard.net/vdr/tv_test/

-- 
NH


From M.Wache at gmx.net  Thu Apr 28 19:10:35 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 28 Apr 2005 19:10:35 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <426F6D0B.5010407@e-dition.fr>
References: <426F6D0B.5010407@e-dition.fr>
Message-ID: <4271190B.9070002@gmx.net>

Nicolas Huillard wrote:

> * is it possible to implement in softdevice aspect-ratio handling
> something like "maximize the size of the image", along with the current
> "make sure the image fits in the screen" ? This way a scaling that
> currently scale an image to 750 wide with in-stream black bar on
> top/bottom, would scale it to 800 wide cropping a few black lines on top
> and bottom.
In principle everything is possible, we can crop/scale just like we want.

The problems are to find a solution which works for as many users as 
possible, and the detection of encoded black bars (ie 16:9 encoded as 
4:3 and probably with a channel symbol in the black bar).

I think an other problem is that almost all channels use different ways 
to encode their 16:9 programms to 4:3. Some just add black bars on top 
and bottom, others skip some parts (how much?) on the left and right and 
add smaller black bars.
So I guess the problem is that there is an endless list of possibilities 
and it is difficult to autodetect them...

> * can the softdevice plug-in receive LIRC events to change aspect ratio
> on a single remote keypress ?
No, vdr doesn't provide any keypress events to the plugins

Bye,
Martin


From nhuillard at e-dition.fr  Thu Apr 28 19:50:18 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 28 Apr 2005 19:50:18 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <4271190B.9070002@gmx.net>
References: <426F6D0B.5010407@e-dition.fr> <4271190B.9070002@gmx.net>
Message-ID: <4271225A.1060003@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
> 
>> * is it possible to implement in softdevice aspect-ratio handling
>> something like "maximize the size of the image", along with the current
>> "make sure the image fits in the screen" ? This way a scaling that
>> currently scale an image to 750 wide with in-stream black bar on
>> top/bottom, would scale it to 800 wide cropping a few black lines on top
>> and bottom.
> 
> In principle everything is possible, we can crop/scale just like we want.
> 
> The problems are to find a solution which works for as many users as 
> possible, and the detection of encoded black bars (ie 16:9 encoded as 
> 4:3 and probably with a channel symbol in the black bar).
> 
> I think an other problem is that almost all channels use different ways 
> to encode their 16:9 programms to 4:3. Some just add black bars on top 
> and bottom, others skip some parts (how much?) on the left and right and 
> add smaller black bars.
> So I guess the problem is that there is an endless list of possibilities 
> and it is difficult to autodetect them...

I'll try to think of a simple two-phase system :
* you describe your setup once : ratio of the screen, prefer to scale as 
wide/tall as possible, or the contrary, etc.
* a simple option switch between a few different possibilities, for easy 
scaling
My personnal choice would be relatively simple : scale horizontaly to 
fit the whole screen + scale vertically to fit 100% (4/3, distorted but 
the TV can reduce, or full-frame 16/9), 80% (or so, didn't made the 
calculation : to fit a 16/9 video with black bars exactly in the height 
of the screen), 65% (or so, to fit a 2.35 film with minimum black bars). 
I'm not so disturbed by distortion...
The current problem is that horizontal scaling takes place along with 
vertical, and a good vertical scaling is always bad horizontal (on 
800x600, but I'll probably switch back to 720x576).

>> * can the softdevice plug-in receive LIRC events to change aspect ratio
>> on a single remote keypress ?
> 
> No, vdr doesn't provide any keypress events to the plugins

Loosely related : is there a possibility for the plugin to switch the 
suspend state (not decoding) upon reception of a particular signal, or 
when VDR is doing it's EPG scan ? That would be useful to control CPU 
usage when nobody is in front.

-- 
NH


From marko.makela at hut.fi  Thu Apr 28 20:36:05 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 28 Apr 2005 21:36:05 +0300
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <200504272113.47316.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <1114587566.426f41ae0c0b6@webmail.in-berlin.de> <20050427183849.GA330538@kosh.hut.fi> <200504272113.47316.stefan@lucke.in-berlin.de>
Message-ID: <20050428183605.GA58796@kosh.hut.fi>

On Wed, Apr 27, 2005 at 09:13:47PM +0200, Stefan Lucke wrote:
> Some similar crash here. And that is suprising, as my ffmpeg has
> a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> switch. Your stream has _no_ such switch and when reverting
> ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> the segfault has gone.

Well, I didn't try reverting anything yet, but indeed, I get a different
crash with a self-compiled libavcodec, in mpeg1_decode_picture(), bswap.h:30

> > I've now confirmed that the "mute" setting is equivalent to the smallest
> > possible volume level setting.  It is clearly audible from my speakers
> > to at least 10 meters distance, maybe 20 meters.
> 
> Can you try to replace (audio.c):
>     setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
> by:
>     if(vol)
>       setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
>     else
>       setVol = mixerMin;

No difference.  You know the Finnish word "vika" (fault)?  Finnish people
jokingly ask if the computer is "VIAllinen" (faulty, or with VIA chipset).

Hmm, but in this case, it's not a hardware problem.  If I turn the volume
down or hit the mute key, alsamixer will indicate that the PCM level drops
to 0.  However, if I mute the PCM output or the master volume by pressing
the M key in alsamixer, the sound will become inaudible (even when I place
my ear next to the speaker).  Same thing if I turn the master volume to zero
rather than pressing M.

Would it be possible to map the mute function (or the minimum volume setting
if the mute function is not directly accessible to the plugin) to the muting
of the PCM channel?  Unfortunately I'm not familiar with multimedia stuff in
Linux, but I could try learning enough for this simple change if you prefer
to work on something else.

By the way, it looks like my patch to silence compiler warnings in
mpeg2decoder.c hasn't been committed to CVS yet.  Here it is again:

Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.31
diff -u -r1.31 mpeg2decoder.c
--- mpeg2decoder.c      12 Apr 2005 21:58:32 -0000      1.31
+++ mpeg2decoder.c      28 Apr 2005 18:33:17 -0000
@@ -24,13 +24,13 @@
 #include "setup-softdevice.h"


-//#define MPGDEB(out...) {printf("mpegdec[%04d]:",getTimeMilis() % 10000);printf(out);}
+//#define MPGDEB(out...) {printf("mpegdec[%04d]:",int(getTimeMilis() % 10000));printf(out);}

 #ifndef MPGDEB
 #define MPGDEB(out...)
 #endif

-#define CMDDEB(out...) {printf("CMD[%04d]:",getTimeMilis() % 10000);printf(out);}
+#define CMDDEB(out...) {printf("CMD[%04d]:",int(getTimeMilis() % 10000));printf(out);}

 #ifndef CMDDEB
 #define CMDDEB(out...)
@@ -1095,7 +1095,7 @@
 };

 int cMpeg2Decoder::seek(offset_t offset, int whence) {
-   printf("unimplemented: seek offset %d whence %d\n",offset,whence);
+   printf("unimplemented: seek offset %d whence %d\n",int(offset),whence);
    return -EINVAL;
 };

	Marko


From stefan at lucke.in-berlin.de  Fri Apr 29 12:21:40 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 29 Apr 2005 12:21:40 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <4271225A.1060003@e-dition.fr>
References: <426F6D0B.5010407@e-dition.fr> <4271190B.9070002@gmx.net> <4271225A.1060003@e-dition.fr>
Message-ID: <200504291221.40162.stefan@lucke.in-berlin.de>

On Donnerstag, 28. April 2005 19:50, Nicolas Huillard wrote:
> Martin Wache a ?crit :
> > Nicolas Huillard wrote:
> > 
> >> * is it possible to implement in softdevice aspect-ratio handling
> >> something like "maximize the size of the image", along with the current
> >> "make sure the image fits in the screen" ? This way a scaling that
> >> currently scale an image to 750 wide with in-stream black bar on
> >> top/bottom, would scale it to 800 wide cropping a few black lines on top
> >> and bottom.
> > 
> > In principle everything is possible, we can crop/scale just like we want.
> > 
> > The problems are to find a solution which works for as many users as 
> > possible, and the detection of encoded black bars (ie 16:9 encoded as 
> > 4:3 and probably with a channel symbol in the black bar).
> > 
> > I think an other problem is that almost all channels use different ways 
> > to encode their 16:9 programms to 4:3. Some just add black bars on top 
> > and bottom, others skip some parts (how much?) on the left and right and 
> > add smaller black bars.
> > So I guess the problem is that there is an endless list of possibilities 
> > and it is difficult to autodetect them...
> 
> I'll try to think of a simple two-phase system :
> * you describe your setup once : ratio of the screen, prefer to scale as 
> wide/tall as possible, or the contrary, etc.
> * a simple option switch between a few different possibilities, for easy 
> scaling

Yes, the physical setup which describes your TV /Monitor display aspect
can be defined in some menues. Selecting the something like center
cut out CropMode/Bildausschnitt should be available via some hotkey.

For that we need our own control, which gets all keys from vdr' remote.
We need an additional setup entry, which describes which logical
vdr USER_X key should be mapped to this functionality.



-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Apr 29 12:52:50 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 29 Apr 2005 12:52:50 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <20050428183605.GA58796@kosh.hut.fi>
References: <20050323222925.GC430274@kosh.hut.fi> <200504272113.47316.stefan@lucke.in-berlin.de> <20050428183605.GA58796@kosh.hut.fi>
Message-ID: <200504291252.50097.stefan@lucke.in-berlin.de>

On Donnerstag, 28. April 2005 20:36, Marko M?kel? wrote:
> On Wed, Apr 27, 2005 at 09:13:47PM +0200, Stefan Lucke wrote:
> > Some similar crash here. And that is suprising, as my ffmpeg has
> > a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> > switch. Your stream has _no_ such switch and when reverting
> > ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> > the segfault has gone.
> 
> Well, I didn't try reverting anything yet, but indeed, I get a different
> crash with a self-compiled libavcodec, in mpeg1_decode_picture(), bswap.h:30
> 
> > > I've now confirmed that the "mute" setting is equivalent to the smallest
> > > possible volume level setting.  It is clearly audible from my speakers
> > > to at least 10 meters distance, maybe 20 meters.
> > 
> > Can you try to replace (audio.c):
> >     setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
> > by:
> >     if(vol)
> >       setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
> >     else
> >       setVol = mixerMin;
> 
> No difference.  You know the Finnish word "vika" (fault)?  Finnish people
> jokingly ask if the computer is "VIAllinen" (faulty, or with VIA chipset).

:-)) .

> 
> Hmm, but in this case, it's not a hardware problem.  If I turn the volume
> down or hit the mute key, alsamixer will indicate that the PCM level drops
> to 0.  However, if I mute the PCM output or the master volume by pressing
> the M key in alsamixer, the sound will become inaudible (even when I place
> my ear next to the speaker).  Same thing if I turn the master volume to zero
> rather than pressing M.

I think that if "volume_0" != "mute" _is_ a hardware problem. But we could do
something else for volume 0 for "VIAllinen"  chipsets.

> 
> Would it be possible to map the mute function (or the minimum volume setting
> if the mute function is not directly accessible to the plugin) to the muting
> of the PCM channel?  Unfortunately I'm not familiar with multimedia stuff in
> Linux, but I could try learning enough for this simple change if you prefer
> to work on something else.

Patches are welcome.

> 
> By the way, it looks like my patch to silence compiler warnings in
> mpeg2decoder.c hasn't been committed to CVS yet.  Here it is again:

No need to repost. I've slight modified version is in my working files.
I got those warnings too with old gcc on my TV out system. 

But commiting will need some time as I'm still fighting with ac3 out,
which makes some progress. Now I get a downmixed 5.1-> 2.0
of old vdr (1.2.1 recordings too).

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Fri Apr 29 13:19:45 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 13:19:45 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <200504291221.40162.stefan@lucke.in-berlin.de>
References: <426F6D0B.5010407@e-dition.fr> <4271190B.9070002@gmx.net> <4271225A.1060003@e-dition.fr> <200504291221.40162.stefan@lucke.in-berlin.de>
Message-ID: <42721851.4040306@e-dition.fr>

Stefan Lucke a ?crit :
>>I'll try to think of a simple two-phase system :
>>* you describe your setup once : ratio of the screen, prefer to scale as 
>>wide/tall as possible, or the contrary, etc.
>>* a simple option switch between a few different possibilities, for easy 
>>scaling
> 
> Yes, the physical setup which describes your TV /Monitor display aspect
> can be defined in some menues. Selecting the something like center
> cut out CropMode/Bildausschnitt should be available via some hotkey.
> 
> For that we need our own control, which gets all keys from vdr' remote.
> We need an additional setup entry, which describes which logical
> vdr USER_X key should be mapped to this functionality.

Your implementation details seems to fit the bill ;-)
Since I'm no good at coding, but would do specs correctly, may I suggest 
that you all describe the streams and hardware you actually have, and 
what you would like to see, and I'll try to get the Right Thing that 
will be as simple as possible, please most people, and be usable for 
children. Warning : I'm no fast, as you could have experienced...

I first just need small explanation of what we could rely on :
* typical frame size you have (I use femon to show that)
* what "aspect ratio indicator" is broadcast with the stream (if any : 
femon show an aspect ratio icon, but it's always 4:3 for my channels)
* reading the softdevice code, I understand that we can stretch and move 
the image wherever we want : is it really free, or are there limits 
(problems when streching more than the visible size, etc.)

-- 
NH


From nhuillard at e-dition.fr  Fri Apr 29 13:48:29 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 13:48:29 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
Message-ID: <42721F0D.4090604@e-dition.fr>

Loosely related to aspect ratio handling.

On a 352x288 stream, scaled to full 800x600 DirectFB screen, the stream 
pixels appear clearly.
With other decoders, like vdr-xine / hardware decoding, the image is 
smoothed, as if it really were 800x600.
That's clearly visible on very small letters (5 pixel) : with 
softdevice, they're awful, with vdr-xine, they're really nice.

The test channel : M?t?o 
Express;OpenMux:10911:vC34:S13.0E:27500:5820:5830:0:0:5800:176:12000:0

My explanation : softdevice does scaling after decompression, whereas 
xine does scaling before decompression (one step or another in the 
decompression process).

Not that this channel is important to me, but every improvement in image 
quality is a good thing (particularly if it's easy to implement).

-- 
NH


From torgeir at pobox.com  Fri Apr 29 13:57:20 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 29 Apr 2005 12:57:20 +0100
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <42721F0D.4090604@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr>
Message-ID: <1114775840.3242.3.camel@africa>

On Fri, 2005-04-29 at 13:48 +0200, Nicolas Huillard wrote:
> 
> My explanation : softdevice does scaling after decompression, whereas 
> xine does scaling before decompression (one step or another in the 
> decompression process).

Softdevice is fully capable to scale properly using the hardware scaler
of the graphics card, so the pixelation you're seing must be caused by
something else. I display all output using 1280x720 screen resolution
with both DirectFB and Xv output. It's probably related to some
implementation details for your hardware, such as StrechBlitting. What
pixelformat are you using?


-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Fri Apr 29 14:23:03 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 14:23:03 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <1114775840.3242.3.camel@africa>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>
Message-ID: <42722727.6070102@e-dition.fr>

Torgeir Veimo a ?crit :
> On Fri, 2005-04-29 at 13:48 +0200, Nicolas Huillard wrote:
> 
>>My explanation : softdevice does scaling after decompression, whereas 
>>xine does scaling before decompression (one step or another in the 
>>decompression process).
> 
> Softdevice is fully capable to scale properly using the hardware scaler
> of the graphics card, so the pixelation you're seing must be caused by
> something else. I display all output using 1280x720 screen resolution
> with both DirectFB and Xv output. It's probably related to some
> implementation details for your hardware, such as StrechBlitting. What
> pixelformat are you using?

setup.conf says "softdevice.PixelFormat = 0", but I don't remember 
having selected I420 as setup-softdevice.c suggests.
I'm not in front, so I can't say.

Hardware is EPIA/CLE266 with libdirectfb-cvs 20050424 and the Unichrome 
0.4 DirectFB driver. The viafb frame-buffer driver is old (2004-09) but 
it shouldn't matter.

Do you mean that you get a good pixel interpolation when scaling from 
352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?

-- 
NH


From torgeir at pobox.com  Fri Apr 29 14:57:40 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 29 Apr 2005 13:57:40 +0100
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <42722727.6070102@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>
	 <42722727.6070102@e-dition.fr>
Message-ID: <1114779460.3242.5.camel@africa>

On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> Torgeir Veimo a ?crit :
> > On Fri, 2005-04-29 at 13:48 +0200, Nicolas Huillard wrote:
> > 
> >>My explanation : softdevice does scaling after decompression, whereas 
> >>xine does scaling before decompression (one step or another in the 
> >>decompression process).
> > 
> > Softdevice is fully capable to scale properly using the hardware scaler
> > of the graphics card, so the pixelation you're seing must be caused by
> > something else. I display all output using 1280x720 screen resolution
> > with both DirectFB and Xv output. It's probably related to some
> > implementation details for your hardware, such as StrechBlitting. What
> > pixelformat are you using?
> 
> setup.conf says "softdevice.PixelFormat = 0", but I don't remember 
> having selected I420 as setup-softdevice.c suggests.
> I'm not in front, so I can't say.
> 
> Hardware is EPIA/CLE266 with libdirectfb-cvs 20050424 and the Unichrome 
> 0.4 DirectFB driver. The viafb frame-buffer driver is old (2004-09) but 
> it shouldn't matter.
> 
> Do you mean that you get a good pixel interpolation when scaling from 
> 352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?

Are you talking about OSD text or text encoded in the actual
transmission?

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Fri Apr 29 15:16:23 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 15:16:23 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <1114779460.3242.5.camel@africa>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>
Message-ID: <427233A7.5020808@e-dition.fr>

Torgeir Veimo a ?crit :
> On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> 
>>Do you mean that you get a good pixel interpolation when scaling from 
>>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
> 
> Are you talking about OSD text or text encoded in the actual
> transmission?

Text encoded in the actual transmission.
Can't you see the channel on S13.0E (FTA) ?

M?t?o Express;OpenMux:10911:vC34:S13.0E:27500:5820:5830:0:0:5800:176:12000:0

-- 
NH


From nhuillard at e-dition.fr  Fri Apr 29 15:17:29 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 15:17:29 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <1114779460.3242.5.camel@africa>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>
Message-ID: <427233E9.40407@e-dition.fr>

Torgeir Veimo a ?crit :
> On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> 
>>Do you mean that you get a good pixel interpolation when scaling from 
>>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
> 
> Are you talking about OSD text or text encoded in the actual
> transmission?

Text encoded in the actual transmission.
Can't you see the channel on S13.0E (FTA) ?

M?t?o Express;OpenMux:10911:vC34:S13.0E:27500:5820:5830:0:0:5800:176:12000:0

The stream is mainly static, and text is very hard to miss.

-- 
NH



From torgeir at pobox.com  Fri Apr 29 15:27:47 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 29 Apr 2005 14:27:47 +0100
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <427233A7.5020808@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>
	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>
	 <427233A7.5020808@e-dition.fr>
Message-ID: <1114781267.3242.7.camel@africa>

On Fri, 2005-04-29 at 15:16 +0200, Nicolas Huillard wrote:
> Torgeir Veimo a ?crit :
> > On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> > 
> >>Do you mean that you get a good pixel interpolation when scaling from 
> >>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
> > 
> > Are you talking about OSD text or text encoded in the actual
> > transmission?
> 
> Text encoded in the actual transmission.
> Can't you see the channel on S13.0E (FTA) ?

Sorry, I'm trapped in a block flat in london, and can't put up my own
dish.. :( Have only DVB-T. Can you maybe do a short recording (<100MB)?

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Fri Apr 29 16:26:07 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 29 Apr 2005 16:26:07 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <1114781267.3242.7.camel@africa>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>	 <427233A7.5020808@e-dition.fr> <1114781267.3242.7.camel@africa>
Message-ID: <427243FF.1070209@e-dition.fr>

Torgeir Veimo a ?crit :
> On Fri, 2005-04-29 at 15:16 +0200, Nicolas Huillard wrote:
> 
>>Torgeir Veimo a ?crit :
>>
>>>On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
>>>
>>>>Do you mean that you get a good pixel interpolation when scaling from 
>>>>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
>>>
>>>Are you talking about OSD text or text encoded in the actual
>>>transmission?
>>
>>Text encoded in the actual transmission.
>>Can't you see the channel on S13.0E (FTA) ?
> 
> Sorry, I'm trapped in a block flat in london, and can't put up my own
> dish.. :( Have only DVB-T. Can you maybe do a short recording (<100MB)?

http://nicolas.huillard.net/vdr/meteo-express.tar.gz
16MB
It is dated 2004-06-30, but the content is exactly the same now. Just 
checked with Xine/Xv/nVidia : much better.

-- 
NH


From stefan at lucke.in-berlin.de  Fri Apr 29 19:10:23 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 29 Apr 2005 19:10:23 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <427243FF.1070209@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr> <1114781267.3242.7.camel@africa> <427243FF.1070209@e-dition.fr>
Message-ID: <200504291910.23518.stefan@lucke.in-berlin.de>

On Freitag, 29. April 2005 16:26, Nicolas Huillard wrote:
> Torgeir Veimo a ?crit :
> > On Fri, 2005-04-29 at 15:16 +0200, Nicolas Huillard wrote:
> > 
> >>Torgeir Veimo a ?crit :
> >>
> >>>On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> >>>
> >>>>Do you mean that you get a good pixel interpolation when scaling from 
> >>>>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
> >>>
> >>>Are you talking about OSD text or text encoded in the actual
> >>>transmission?
> >>
> >>Text encoded in the actual transmission.
> >>Can't you see the channel on S13.0E (FTA) ?
> > 
> > Sorry, I'm trapped in a block flat in london, and can't put up my own
> > dish.. :( Have only DVB-T. Can you maybe do a short recording (<100MB)?
> 
> http://nicolas.huillard.net/vdr/meteo-express.tar.gz
> 16MB
> It is dated 2004-06-30, but the content is exactly the same now. Just 
> checked with Xine/Xv/nVidia : much better.

Hm strange, even with matrox. Quality using YUV2 format is much better
than I420 format. Xv is like YUV2 as (I belive all driver do this)
I420 and YV12 are converted to YUV2. Using the latter on epia is
painfull as hw-stretch-blitting seems not really supported.

Perhaps I've to decouple YUV2 from stretchblitting and offer
that format for back-end scaler or stretch-blitter.

Ah, great day. Small  steps in AC3 and three new TODOs
(audio-mute, user selectable hotkey for aspect ratio switch,
YUV2 non-stretch-blit).

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Apr 29 21:38:32 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 29 Apr 2005 21:38:32 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <42721851.4040306@e-dition.fr>
References: <426F6D0B.5010407@e-dition.fr> <200504291221.40162.stefan@lucke.in-berlin.de> <42721851.4040306@e-dition.fr>
Message-ID: <200504292138.32941.stefan@lucke.in-berlin.de>

On Freitag, 29. April 2005 13:19, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> >>I'll try to think of a simple two-phase system :
> >>* you describe your setup once : ratio of the screen, prefer to scale as 
> >>wide/tall as possible, or the contrary, etc.
> >>* a simple option switch between a few different possibilities, for easy 
> >>scaling
> > 
> > Yes, the physical setup which describes your TV /Monitor display aspect
> > can be defined in some menues. Selecting the something like center
> > cut out CropMode/Bildausschnitt should be available via some hotkey.
> > 
> > For that we need our own control, which gets all keys from vdr' remote.
> > We need an additional setup entry, which describes which logical
> > vdr USER_X key should be mapped to this functionality.
> 
> Your implementation details seems to fit the bill ;-)
> Since I'm no good at coding, but would do specs correctly, may I suggest 
> that you all describe the streams and hardware you actually have, and 
> what you would like to see, and I'll try to get the Right Thing that 
> will be as simple as possible, please most people, and be usable for 
> children. Warning : I'm no fast, as you could have experienced...
> 
> I first just need small explanation of what we could rely on :
> * typical frame size you have (I use femon to show that)

Have a look at:
http://www.lucke.in-berlin.de/vdr-aspect-info.png

But that would require a modification of vdr and will not work on Klaus
favorite FF-Cards, as it would need some fedback from the displaying
device "hey tell me something about current stream".

> * what "aspect ratio indicator" is broadcast with the stream (if any : 
> femon show an aspect ratio icon, but it's always 4:3 for my channels)

To my knowledge, all free private broadcaster do this in that mode too
here in germany. UK is opposite to that. Only ARD, ZDF and co.
(?ffentlich-Rechtliche) transmit anamorphic 16:9.
One thing that could be possible is the some stations could
transmit aspect information via WSS. I know WSS is from analogue
TV, where it is transmitted on line 23. But guess what is possible:
Even on digital broadcasts the WSS information may be transmitted via
digital teletext streams ;;-) . I've never seen such a stream but dvbsnoop
is able to report them.

http://dvbsnoop.sourceforge.net/examples/example-pes-wss.html

> * reading the softdevice code, I understand that we can stretch and move 
> the image wherever we want : is it really free, or are there limits 
> (problems when streching more than the visible size, etc.)

As you've seen in video.c, there are no limits when it is done correct :-) .
Take an arbitray source region, scale it according to transmitted
acpect info onto the display region.

We can offer a free scaling capabilitiy. That was what I did first when
I implemented the adjustment according to the displaying device
(monitor, tv 4:4, tv 16:9, ..). But I decided to work with fixed values,
as this is easier to understand for average users.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Apr 29 21:56:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 29 Apr 2005 21:56:30 +0200
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <1114633777.4637.7.camel@africa>
References: <1114391805.3289.16.camel@africa> <1114512661.32420.4.camel@africa> <1114633777.4637.7.camel@africa>
Message-ID: <200504292156.30577.stefan@lucke.in-berlin.de>

On Mittwoch, 27. April 2005 22:29, Torgeir Veimo wrote:
> On Tue, 2005-04-26 at 11:51 +0100, Torgeir Veimo wrote:
> > On Tue, 2005-04-26 at 12:36 +0200, Stefan Lucke wrote:
> > > 
> > > 
> > > The monitor thread should look at the currently used head, instead of
> > > fixed /dev/fb0. I think it should work too when calling dfb method:
> > > osdLayer->WaitForSync().
> > 
> > I'm just worried that this method might just wait for the irq bit to get
> > high by polling, instead of using the ioctl. I need to verify that.
> 
> I am suspecting some of the judder I'm seeing is in fact might related
> to each frame being Flip()'ed a bit too early hitting the vertical
> refresh before it should be actually be shown. It might be an idea to
> try a DirectFB video out implementation which doesn't call Flip()
> immediately in the YUV method, but instead calls Flip() in a separate
> thread that is just responsible for waiting for a vertical refresh and
> flipping with the pattern waitForVSync(), Flip(), waitForVSync(), Flip()
> etc., and use DSFLIP_WAITFORSYNC behaviour for Flip() calls.

Having a separate thread (libsoftmpeg plugin logic) which does the
flip, has the advantage that we could return earlier to the calling
decoding thread. But those threads should be synced by thread
communication means:
mutex_lock(), cond_broadcast, ..

One thing I did not test is: does judder appear durng playback of
recordings too or only via live tv.

> 
> Since this output method would be synchronized with the video output
> framerate, it would be possible to detect framerate drift as well.


-- 
Stefan Lucke



From torgeir at pobox.com  Fri Apr 29 22:05:50 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 29 Apr 2005 21:05:50 +0100
Subject: [Softdevice-devel] refresh rate on dvb-t (device delay + ac3)
In-Reply-To: <200504292156.30577.stefan@lucke.in-berlin.de>
References: <1114391805.3289.16.camel@africa>
	 <1114512661.32420.4.camel@africa> <1114633777.4637.7.camel@africa>
	 <200504292156.30577.stefan@lucke.in-berlin.de>
Message-ID: <1114805150.3242.22.camel@africa>

On Fri, 2005-04-29 at 21:56 +0200, Stefan Lucke wrote:
> 
> One thing I did not test is: does judder appear durng playback of
> recordings too or only via live tv.

It's a bit strange. With an nvidia fx5200, I have cpu utilisation at
about 11%, but more judder than either a radeon 9100 and a radeon 7000
(all of this with Xv) with cpu utilisation at about 16%. (All on normal
tv transmissions. I haven't tried the nvidia using DirectFB, need to
wait until the fb module is properly debugged..

On recordings however i see major judder every second or so. I am
suspecting it might be due to the use of SATA, as I've heard about
others having similar problems, but not necessarily with softdevice. I
don't see it during recording, even with multiple simultaneous
recordings.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Fri Apr 29 23:14:10 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 29 Apr 2005 22:14:10 +0100
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <427243FF.1070209@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>
	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>
	 <427233A7.5020808@e-dition.fr> <1114781267.3242.7.camel@africa>
	 <427243FF.1070209@e-dition.fr>
Message-ID: <1114809250.3242.35.camel@africa>

On Fri, 2005-04-29 at 16:26 +0200, Nicolas Huillard wrote:

> http://nicolas.huillard.net/vdr/meteo-express.tar.gz
> 16MB
> It is dated 2004-06-30, but the content is exactly the same now. Just 
> checked with Xine/Xv/nVidia : much better.

This stream crashes softdevice on my computer, using both latest
libavcodec cvs and 0.4.9pre1.

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sat Apr 30 22:56:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 30 Apr 2005 22:56:30 +0200
Subject: [Softdevice-devel] Aspect ratio handling
In-Reply-To: <42721851.4040306@e-dition.fr>
References: <426F6D0B.5010407@e-dition.fr> <200504291221.40162.stefan@lucke.in-berlin.de> <42721851.4040306@e-dition.fr>
Message-ID: <200504302256.30356.stefan@lucke.in-berlin.de>

On Freitag, 29. April 2005 13:19, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> >>I'll try to think of a simple two-phase system :
> >>* you describe your setup once : ratio of the screen, prefer to scale as 
> >>wide/tall as possible, or the contrary, etc.
> >>* a simple option switch between a few different possibilities, for easy 
> >>scaling
> > 
> > Yes, the physical setup which describes your TV /Monitor display aspect
> > can be defined in some menues. Selecting the something like center
> > cut out CropMode/Bildausschnitt should be available via some hotkey.
> > 
> > For that we need our own control, which gets all keys from vdr' remote.
> > We need an additional setup entry, which describes which logical
> > vdr USER_X key should be mapped to this functionality.
> 
> Your implementation details seems to fit the bill ;-)
> Since I'm no good at coding, but would do specs correctly, may I suggest 
> that you all describe the streams and hardware you actually have, and 
> what you would like to see, and I'll try to get the Right Thing that 
> will be as simple as possible, please most people, and be usable for 
> children. Warning : I'm no fast, as you could have experienced...

Ok. It's not as clean as expected, but as xv and dfb have theire own
remotes .. . I commited a changed so that User1 .. User9 can be mapped
as a direct crop mode switch.
By that way we could additional match some other direct key bindings or
X_ATOM changes, which where handled by our remotes to vdr UserX keys.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun May  1 10:11:13 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 1 May 2005 10:11:13 +0200
Subject: Audio auto Mute WAS:(Re: [Softdevice-devel] Repeatable crash)
In-Reply-To: <200504291252.50097.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <20050428183605.GA58796@kosh.hut.fi> <200504291252.50097.stefan@lucke.in-berlin.de>
Message-ID: <200505011011.14078.stefan@lucke.in-berlin.de>

On Freitag, 29. April 2005 12:52, Stefan Lucke wrote:
> On Donnerstag, 28. April 2005 20:36, Marko M?kel? wrote:
> > On Wed, Apr 27, 2005 at 09:13:47PM +0200, Stefan Lucke wrote:
> > > Some similar crash here. And that is suprising, as my ffmpeg has
> > > a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> > > switch. Your stream has _no_ such switch and when reverting
> > > ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> > > the segfault has gone.
> > 
> > Well, I didn't try reverting anything yet, but indeed, I get a different
> > crash with a self-compiled libavcodec, in mpeg1_decode_picture(), bswap.h:30
> > 
> > > > I've now confirmed that the "mute" setting is equivalent to the smallest
> > > > possible volume level setting.  It is clearly audible from my speakers
> > > > to at least 10 meters distance, maybe 20 meters.
> > > 
> > > Can you try to replace (audio.c):
> > >     setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
> > > by:
> > >     if(vol)
> > >       setVol = (int) (((double)mixerMin+(mixerRange*volPercent))+0.5);
> > >     else
> > >       setVol = mixerMin;
> > 
> > No difference.  You know the Finnish word "vika" (fault)?  Finnish people
> > jokingly ask if the computer is "VIAllinen" (faulty, or with VIA chipset).
> 
> :-)) .
> 
> > 
> > Hmm, but in this case, it's not a hardware problem.  If I turn the volume
> > down or hit the mute key, alsamixer will indicate that the PCM level drops
> > to 0.  However, if I mute the PCM output or the master volume by pressing
> > the M key in alsamixer, the sound will become inaudible (even when I place
> > my ear next to the speaker).  Same thing if I turn the master volume to zero
> > rather than pressing M.
> 
> I think that if "volume_0" != "mute" _is_ a hardware problem. But we could do
> something else for volume 0 for "VIAllinen"  chipsets.
> 

Added mute toggle if volume == 0 -> mute else unmute.


-- 
Stefan Lucke



From marko.makela at hut.fi  Mon May  2 23:12:59 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 3 May 2005 00:12:59 +0300
Subject: Audio auto Mute WAS:(Re: [Softdevice-devel] Repeatable crash)
In-Reply-To: <200505011011.14078.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <20050428183605.GA58796@kosh.hut.fi> <200504291252.50097.stefan@lucke.in-berlin.de> <200505011011.14078.stefan@lucke.in-berlin.de>
Message-ID: <20050502211259.GD398132@kosh.hut.fi>

Hi Stefan,

> I think that if "volume_0" != "mute" _is_ a hardware problem.

Well, call me VIApologist :-) but I think it would be a waste of register
space to have two overlapping settings for the same condition, i.e.,
volume_0 would make the "mute" bit redundant.  However, since the difference
between "mute" and "volume_0" feels much bigger than the difference between
"volume_1" and "volume_2", I agree with you that it is a hardware problem.

> But we could do something else for volume 0 for "VIAllinen"  chipsets.

You mean "VIAllinen" motherboards, don't you? :-)

> Added mute toggle if volume == 0 -> mute else unmute.

Thanks, it works perfectly now.

	Marko


From nhuillard at e-dition.fr  Mon May  2 23:45:43 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 02 May 2005 23:45:43 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <1114809250.3242.35.camel@africa>
References: <42721F0D.4090604@e-dition.fr> <1114775840.3242.3.camel@africa>	 <42722727.6070102@e-dition.fr> <1114779460.3242.5.camel@africa>	 <427233A7.5020808@e-dition.fr> <1114781267.3242.7.camel@africa>	 <427243FF.1070209@e-dition.fr> <1114809250.3242.35.camel@africa>
Message-ID: <42769F87.3070500@e-dition.fr>

Torgeir Veimo a ?crit :
> On Fri, 2005-04-29 at 16:26 +0200, Nicolas Huillard wrote:
> 
>>http://nicolas.huillard.net/vdr/meteo-express.tar.gz
>>16MB
>>It is dated 2004-06-30, but the content is exactly the same now. Just 
>>checked with Xine/Xv/nVidia : much better.
> 
> This stream crashes softdevice on my computer, using both latest
> libavcodec cvs and 0.4.9pre1.

Does not crash here : softdevice 0.1.1 / libavcodec 20050409
...not a softdevice crash since 20050428 (even within 24h operation). Great.

-- 
NH


From nhuillard at e-dition.fr  Tue May  3 03:36:18 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 03 May 2005 03:36:18 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
Message-ID: <4276D592.5060809@e-dition.fr>

Hi,

After I have read and I hope understood what you all did describe, I can 
sum-up thing here :

1) option to set physical display size
* use choose from "16/9", "4/3", even "16/10", or so
* this is stored as a a decimal value : 1.777, 1.333, 1.6, etc.
* this may be stored as the physical H + V sizes of the screen (as X does)
* this option is selected once for all
* it is independent of the resolution of the screen : think about 16/9 
display at 800x600, or 16/10 at 1400x1050, or the new plasmas 16/9 at 
1024x1024
* maybe this option is already present in the standard config / DVB card 
/ video format option (from VDR's MANUAL : "Video format = 4:3     The 
video format (or aspect ratio) of the tv set in use (4:3 or 16:9)"
* display ratio, and display resolution can be used together to 
calculate the pixel aspect ratio : 800/600 / (16/9) = 0.75 ; 1280/768 / 
(16/9) = 0.9375 ; 720/576 / (4/3) = 0.9375 ; etc.

2) auto-detection of aspect ratio
* the WSS bit can be set by the broadcaster to set the aspect ratio to 
16/9 (I think the only time I saw it was with Arte on analog broadcast, 
because the TV switches to the full-frame display automagically)
* other auto-detect features can be used, to set wether the frame is 
meant to be viewed as 16/9 or 4/3 (or something else)
* if no detection is done (I don't expect anything here in France), the 
frame ratio will probably be advertised as 4/3
* this is something the user has no impact on

3) user-set programme aspect ratio
* the user may choose not to trust the broadcaster advertised aspect 
ratio (I won't)
* the user selects the actual image ratio inside the frame : 4/3, 16/9, 
1.85, 2.35, etc.
* the special value "trust the broadcaster" is simply the fact that the 
image fills the entire frame, whatever the aspect ratio ("full-frame")
* that would be the option the user changes most often : the one to 
match to a remote key

4) match between frame ratio and programme ratio
* the match between frame ratio and image ratio is obvious : if the 
broadcaster says the frame is 4:3 but I see a 16/9 image, the image 
fills (4/3) / (16/9) = 0.75, leaving horizontal black bars ; if the 
broadcaster says the frame is 16/9 but I see vertical black bars, the 
image is in fact 4/3
* the calculations begin to be difficult for me ;-)
* this match is used to crop the image : strip black bars, the right 
thickness, at the right places

5) scaling between the frame/image ratio and the screen
* once the image is cropped by the match between the frame and the 
image, it can be scaled to the screen
* scaling uses the calculated image size and the actual screen size
* it also uses the screen aspect ratio, in another crop stage : fitting 
a 4/3 image in a 16/9 screen, or a 16/9 image in a 4/3 screen, can be 
done by upscaling of downscaling

It might seem complicated, but user action is limited to selecting 
screen size or ratio once, and selecting the proper image ratio, if the 
programme doesn't include it. That's something I always do on my TV (but 
softdevice will do this much better, not loosing resolution).

-- 
NH


From nhuillard at e-dition.fr  Fri May  6 19:09:38 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 06 May 2005 19:09:38 +0200
Subject: [Softdevice-devel] softdevice 0.1.1 / dvd 0.3.6_b03 : no overlay on menus
Message-ID: <427BA4D2.8020107@e-dition.fr>

Hello,

As stated on the subject, with those version, there is no evidence of 
where the selection is in the menus (ie. blind selections).
Don't know if it's related to vdr-dvd or softdevice (0.1.1, no CVS yet).

-- 
NH


From stefan at lucke.in-berlin.de  Fri May  6 20:58:07 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 6 May 2005 20:58:07 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <200504291910.23518.stefan@lucke.in-berlin.de>
References: <42721F0D.4090604@e-dition.fr> <427243FF.1070209@e-dition.fr> <200504291910.23518.stefan@lucke.in-berlin.de>
Message-ID: <200505062058.07886.stefan@lucke.in-berlin.de>

On Freitag, 29. April 2005 19:10, Stefan Lucke wrote:
> On Freitag, 29. April 2005 16:26, Nicolas Huillard wrote:
> > Torgeir Veimo a ?crit :
> > > On Fri, 2005-04-29 at 15:16 +0200, Nicolas Huillard wrote:
> > > 
> > >>Torgeir Veimo a ?crit :
> > >>
> > >>>On Fri, 2005-04-29 at 14:23 +0200, Nicolas Huillard wrote:
> > >>>
> > >>>>Do you mean that you get a good pixel interpolation when scaling from 
> > >>>>352x288 to 1280x768 ? Good enough to make 5 source-pixel text pleasant ?
> > >>>
> > >>>Are you talking about OSD text or text encoded in the actual
> > >>>transmission?
> > >>
> > >>Text encoded in the actual transmission.
> > >>Can't you see the channel on S13.0E (FTA) ?
> > > 
> > > Sorry, I'm trapped in a block flat in london, and can't put up my own
> > > dish.. :( Have only DVB-T. Can you maybe do a short recording (<100MB)?
> > 
> > http://nicolas.huillard.net/vdr/meteo-express.tar.gz
> > 16MB
> > It is dated 2004-06-30, but the content is exactly the same now. Just 
> > checked with Xine/Xv/nVidia : much better.
> 
> Hm strange, even with matrox. Quality using YUV2 format is much better
> than I420 format. Xv is like YUV2 as (I belive all driver do this)
> I420 and YV12 are converted to YUV2. Using the latter on epia is
> painfull as hw-stretch-blitting seems not really supported.

Now it is better with matrox. I disabled the deinterlaceing option
of dfb, which is something like a line doubler ;-) .
Now epia looks better too.

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Sat May  7 00:14:16 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sat, 07 May 2005 00:14:16 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <200505062058.07886.stefan@lucke.in-berlin.de>
References: <42721F0D.4090604@e-dition.fr> <427243FF.1070209@e-dition.fr> <200504291910.23518.stefan@lucke.in-berlin.de> <200505062058.07886.stefan@lucke.in-berlin.de>
Message-ID: <427BEC38.7000409@e-dition.fr>

Stefan Lucke a ?crit :
>>Hm strange, even with matrox. Quality using YUV2 format is much better
>>than I420 format. Xv is like YUV2 as (I belive all driver do this)
>>I420 and YV12 are converted to YUV2. Using the latter on epia is
>>painfull as hw-stretch-blitting seems not really supported.
> 
> Now it is better with matrox. I disabled the deinterlaceing option
> of dfb, which is something like a line doubler ;-) .
> Now epia looks better too.

This makes me wonder : I really didn't see much interlacing-artifacts 
with softdevice (except in sports programs, which is not my taste). Is 
it due to this dfb deinterlacer option you just removed ?
I would have guessed that viewing a 576-lines interlaced material on 
576-24 lines (the bad PAL mode of the CLE266/VT1622), and even scaling 
the output at various sizes, would have made awful interlace artifacts 
visible. But not at all.
Should I get CVS to test your improvements ?

-- 
NH


From stefan at lucke.in-berlin.de  Sat May  7 01:07:23 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 May 2005 01:07:23 +0200
Subject: [Softdevice-devel] Image scaling vs. visible resolution
In-Reply-To: <427BEC38.7000409@e-dition.fr>
References: <42721F0D.4090604@e-dition.fr> <200505062058.07886.stefan@lucke.in-berlin.de> <427BEC38.7000409@e-dition.fr>
Message-ID: <200505070107.23148.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 00:14, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> >>Hm strange, even with matrox. Quality using YUV2 format is much better
> >>than I420 format. Xv is like YUV2 as (I belive all driver do this)
> >>I420 and YV12 are converted to YUV2. Using the latter on epia is
> >>painfull as hw-stretch-blitting seems not really supported.
> > 
> > Now it is better with matrox. I disabled the deinterlaceing option
> > of dfb, which is something like a line doubler ;-) .
> > Now epia looks better too.
> 
> This makes me wonder : I really didn't see much interlacing-artifacts 
> with softdevice (except in sports programs, which is not my taste). Is 
> it due to this dfb deinterlacer option you just removed ?
> I would have guessed that viewing a 576-lines interlaced material on 
> 576-24 lines (the bad PAL mode of the CLE266/VT1622), and even scaling 
> the output at various sizes, would have made awful interlace artifacts 
> visible. But not at all.
> Should I get CVS to test your improvements ?

Definitley yes. Setting DLOP_DEINTERLACING is that only one field
gets displayed -> line doubling .

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat May  7 13:47:17 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 May 2005 13:47:17 +0200
Subject: [Softdevice-devel] softplay: Now not playing at all: d_type == 0x00 !
Message-ID: <200505071347.17191.stefan@lucke.in-berlin.de>

Hi,

just tested the new directory support. But for some strange
reason d_type of struct dirent is _allways_ 0x00:
CMD[1412]:Neuer Thread gestartet: pid:15685 type 1
d_type 00 Name /data/MP3/. type 0
d_type 00 Name /data/MP3/.. type 0
d_type 00 Name /data/MP3/Alabama-Cheap_Seats.m3u type 0
d_type 00 Name /data/MP3/Alabama-Greatest_Hits.m3u type 0

The first two should be directories ;-) .

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat May  7 14:14:19 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 May 2005 14:14:19 +0200
Subject: [Softdevice-devel] softplay: Now not playing at all: d_type == 0x00 !
In-Reply-To: <200505071347.17191.stefan@lucke.in-berlin.de>
References: <200505071347.17191.stefan@lucke.in-berlin.de>
Message-ID: <200505071414.19074.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 13:47, Stefan Lucke wrote:
> Hi,
> 
> just tested the new directory support. But for some strange
> reason d_type of struct dirent is _allways_ 0x00:
> CMD[1412]:Neuer Thread gestartet: pid:15685 type 1
> d_type 00 Name /data/MP3/. type 0
> d_type 00 Name /data/MP3/.. type 0
> d_type 00 Name /data/MP3/Alabama-Cheap_Seats.m3u type 0
> d_type 00 Name /data/MP3/Alabama-Greatest_Hits.m3u type 0
> 
> The first two should be directories ;-) .

This is file system dependant:
for my reiser and nfs it is allways 0, but for an ext2 values are present.
No = 1, Entries = 27
DT_DIR:/boot/..
d_type 00 Name /boot/../. type 0
d_type 00 Name /boot/../.. type 0

CMD[2150]:Neuer Thread gestartet: pid:15961 type 1
d_type 04 Name /boot/. type 4
d_type 04 Name /boot/.. type 4
d_type 08 Name /boot/backup_mbr type 8


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat May  7 15:25:24 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 May 2005 15:25:24 +0200
Subject: [Softdevice-devel] softplay: Now not playing at all: d_type == 0x00 !
In-Reply-To: <200505071414.19074.stefan@lucke.in-berlin.de>
References: <200505071347.17191.stefan@lucke.in-berlin.de> <200505071414.19074.stefan@lucke.in-berlin.de>
Message-ID: <200505071525.24827.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 14:14, Stefan Lucke wrote:
> On Samstag, 7. Mai 2005 13:47, Stefan Lucke wrote:
> > Hi,
> > 
> > just tested the new directory support. But for some strange
> > reason d_type of struct dirent is _allways_ 0x00:
> > CMD[1412]:Neuer Thread gestartet: pid:15685 type 1
> > d_type 00 Name /data/MP3/. type 0
> > d_type 00 Name /data/MP3/.. type 0
> > d_type 00 Name /data/MP3/Alabama-Cheap_Seats.m3u type 0
> > d_type 00 Name /data/MP3/Alabama-Greatest_Hits.m3u type 0
> > 
> > The first two should be directories ;-) .
> 
> This is file system dependant:
> for my reiser and nfs it is allways 0, but for an ext2 values are present.
> No = 1, Entries = 27
> DT_DIR:/boot/..
> d_type 00 Name /boot/../. type 0
> d_type 00 Name /boot/../.. type 0
> 
> CMD[2150]:Neuer Thread gestartet: pid:15961 type 1
> d_type 04 Name /boot/. type 4
> d_type 04 Name /boot/.. type 4
> d_type 08 Name /boot/backup_mbr type 8

So a fallback to stat() in case d_type == 0 solves that for me.

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sp_stat.01.diff
Type: text/x-diff
Size: 927 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050507/cc81040c/attachment.diff>

From steve at deltabbs.org  Sat May  7 16:24:25 2005
From: steve at deltabbs.org (Steve Brown)
Date: Sat, 07 May 2005 15:24:25 +0100
Subject: [Softdevice-devel] Success report: VIA EPIA ME6000 & VDR & Streamdev & DirectFB & DFB++
Message-ID: <427CCF99.4030104@deltabbs.org>

Guys,

I'd like to report my success with softdevice on my Eden powered ME6000 
mini-itx mainboard built on Debian.

The ME6000 is a 600MHz VIA Eden powered mainboard with CLE266 chipset. I 
was really interested to get the accellerated MPEG decoder going, 
because with a 600MHz processor I really didn't think it was going to 
work with a software decoder solution.

I'm using:
Kernel 2.6.11
DirectFB-0.9.22
DFB++-0.9.22
VDR 1.3.23
Softdevice-0.1.1
Streamdev-0.3.3-pre3-geni

and this is configured as a diskless (Actually, I'm using a 16MB flash 
card to boot with the custom initrd image containing the USB WLAN driver 
and then mounting root on NFS) client with a USB Wireless NIC.
Yes, I like pain, and this setup produced plenty.

DirectFB *does have* support for the MPEG decoder in the CLE266. It 
seems support for that function is growing rapidly now the VIA drivers 
are in the open.

Softdevice makefile was configured for DFB_SUPPORT, FB_SUPPORT (Not 
actually needed), and DEFINES += -DUSE_MMX. The output methods were 
built as a single library.

Note that PP_LIBAVCODEC and MMX2 are _not_enabled, they require 
instructions not available in the Eden processor.

Performance.
On the whole, great. I'm using a 17inch LCD monitor for output. Sure, 
the quality doesn't come close to that produced on my main VDR box with 
FF DVB card and 32inch screen - if you look at the 17inch screen from 
one foot away you can see some (not too significant) MPEG artifacts 
inthe form of blockiness here and there - but from usual viewing 
position it's great. This system is in my main bedroom at the end of th bed.

The majority of channels are just fine, with maybe a few high bitrate 
ones that are too much for the decoding (or other) process. On these 
few, the A/V sync moves apart over a period of some secods and a brief 
<click> on the audio is heard and sync is restored. The process repeats.

On usual channels with plenty of movement, say MTV, processor 
utilisation is maybe 60-70% for the VDR and associated processes. On 
high quality channels it hits maybe 80% and having the OSD active may 
make the audio stutter slightly until it's cleared. This all gives a 
load average of around 1.0.

I _may_ be being unfair to softdevice, and it _could_ be the WLAN device 
located in a bad spot. I have moved it since I noticed the dodgy channel 
(I noticed it on BBC News 24 of all things) and I haven't noticed it 
since. Just managing expectations if anyone else was thinking of doing 
the same.

Conclusion.
Compared to my previous installation with a DXR3 card? It's on a 
different planet! The DXR3 would crash at least once per viewing sesion, 
the OSD menus were slow and clunky, scrolling through the channel list 
quickly would almost certainly kill it.

With the above softdevice setup, the menus are, oh, so slinky and 
snappy, the remote is very responsive (as it should be) and the A/V 
quality excellent. Changing channels is somehow quicker too.

Thanks very much to everyone who developed or contributed to the 
softdevice plugin, and the DirectFB project. Excellent work.

Steve


From stefan at lucke.in-berlin.de  Sat May  7 21:01:04 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 7 May 2005 21:01:04 +0200
Subject: [Softdevice-devel] softplay: pause handling
Message-ID: <200505072101.04483.stefan@lucke.in-berlin.de>

Hi,

hitting pause key in mp3 playback with softplay, I noticed that pause
does not toggle pause state. So I've to hit play to resume. After
resume, playback continues at offset: last_played+pause_time. Looks
like an internal timer continues to count.

-- 
Stefan Lucke



From M.Wache at gmx.net  Sat May  7 22:32:57 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 07 May 2005 22:32:57 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <200505072101.04483.stefan@lucke.in-berlin.de>
References: <200505072101.04483.stefan@lucke.in-berlin.de>
Message-ID: <427D25F9.2000109@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> hitting pause key in mp3 playback with softplay, I noticed that pause
> does not toggle pause state. So I've to hit play to resume. After
> resume, playback continues at offset: last_played+pause_time. Looks
> like an internal timer continues to count.
> 
Thanks for you report about the file type handling, I incorporated your 
fix in my changes to add basic playlist support.

I also noticed the strange behavior of the pause mode, but up to now I 
have no idea what causes this... At least making pause toggle the pause 
state is easy, I will do this.
Thanks for your reports, any comment on softplay his highly appreciated 
since I'm planning a first public release during the next week(s)..

Bye,
Martin


From nhuillard at e-dition.fr  Sun May  8 00:20:50 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 08 May 2005 00:20:50 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427D25F9.2000109@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net>
Message-ID: <427D3F42.7010206@e-dition.fr>

Martin Wache a ?crit :
> Thanks for your reports, any comment on softplay his highly appreciated 
> since I'm planning a first public release during the next week(s)..

I have no reports at all since I didn't yet compile your plugin :-(

If this plugin if meant to replace both vdr-mplayer (video playback, ie. 
no playlist, but good navigation inside the stream) and vdr-mp3 (audio, 
ie. strong playlist support), I can't resist to suggest my favourite 
playlist management tastes :
* I often use mp3blaster on the console
* it is based on directory browsing (no fancy database, et al : just 
plain directory tree)
* directories are added as directories (or albums) in the playlist : 
when you select a directory for playing, you see only the name of the 
"album", and must go inside to see titles
* "albums" can be inserted/removed freely in the current playing list
* other features are standard...

Manpages in french (sorry, Google didn't find anything else, this time) 
: http://www.delafond.org/traducmanfr/man/man1/mp3blaster.1.html

-- 
NH


From nhuillard at e-dition.fr  Sun May  8 00:27:28 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sun, 08 May 2005 00:27:28 +0200
Subject: [Softdevice-devel] softplay : UI proposal for playlists
Message-ID: <427D40D0.1040805@e-dition.fr>

If you don't want to go and test mp3blaster or read it's man pages, I 
can summarize things for you (but I can't do that tomorrow, and I would 
like to see what you already achieved before throwing away anything, ie. 
compile your plugin).
In the mean time, don't make the error to use the "up" key to go to the 
next title down in the list...

-- 
NH


From stefan at lucke.in-berlin.de  Sun May  8 01:19:34 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 May 2005 01:19:34 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427D25F9.2000109@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net>
Message-ID: <200505080119.34172.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 22:32, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > hitting pause key in mp3 playback with softplay, I noticed that pause
> > does not toggle pause state. So I've to hit play to resume. After
> > resume, playback continues at offset: last_played+pause_time. Looks
> > like an internal timer continues to count.
> > 
> Thanks for you report about the file type handling, I incorporated your 
> fix in my changes to add basic playlist support.
> 
> I also noticed the strange behavior of the pause mode, but up to now I 
> have no idea what causes this... At least making pause toggle the pause 
> state is easy, I will do this.
> Thanks for your reports, any comment on softplay his highly appreciated 
> since I'm planning a first public release during the next week(s)..

With new cvs version I noticed a strange behaviour in directory play mode.
Upon the next start of vdr when selecing softplay the first time, and
selecting the same dir again, the red error message is shown for
a short time, but then directory play starts ;-).

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun May  8 01:35:58 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 May 2005 01:35:58 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427D25F9.2000109@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net>
Message-ID: <200505080135.58144.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 22:32, Martin Wache wrote:
> Thanks for your reports, any comment on softplay his highly appreciated 
> since I'm planning a first public release during the next week(s)..

When selecting the ".." directory, some special action should be
considered to avoid directory name like:
Name /data/MP3/../MP3/../MP3/Blues type 4
Name /data/MP3/../MP3/../MP3/Bruce_Springsteen-Born_In_The_U.S.A..m3u type 8

Selecting ".." is almost the same as hitting the back key except for
the top level directory from "--media-path".

Showing the selected path in the title line would be nice too.
Very long directory names, which do not fit into this line they
should be shortend in a way that at least the last comonent(s) is/are
full visible like:

/a/very/very/long/and/funny/directory/name/of/my/music/category/artist/album

/a/..../category/artist/album

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun May  8 09:00:34 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 May 2005 09:00:34 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427D25F9.2000109@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net>
Message-ID: <200505080900.34737.stefan@lucke.in-berlin.de>

On Samstag, 7. Mai 2005 22:32, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > hitting pause key in mp3 playback with softplay, I noticed that pause
> > does not toggle pause state. So I've to hit play to resume. After
> > resume, playback continues at offset: last_played+pause_time. Looks
> > like an internal timer continues to count.
> > 
> Thanks for you report about the file type handling, I incorporated your 
> fix in my changes to add basic playlist support.
> 
> I also noticed the strange behavior of the pause mode, but up to now I 
> have no idea what causes this... At least making pause toggle the pause 
> state is easy, I will do this.

The jump is not last_played+puse_time. It is always for about
13 seconds as a new audio stream is reported after play. So the causer
is located in softdevice. Softdevice Play() is calling Trickspeed(1)
which in term sets:
  if (trickSpeed!=1) {
    if (aout)
      aout->Clear();
    AudioIdx=DONT_PLAY;
  } //else AudioIdx=NO_STREAM;

By commenting the else part like above, there are no jumps anymore
in softplay mp3 playback. We have to check the influence on other
playback types.

-- 
Stefan Lucke



From M.Wache at gmx.net  Sun May  8 11:48:14 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 08 May 2005 11:48:14 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <200505080119.34172.stefan@lucke.in-berlin.de>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <200505080119.34172.stefan@lucke.in-berlin.de>
Message-ID: <427DE05E.8010009@gmx.net>

Stefan Lucke wrote:

> 
> With new cvs version I noticed a strange behaviour in directory play mode.
> Upon the next start of vdr when selecing softplay the first time, and
> selecting the same dir again, the red error message is shown for
> a short time, but then directory play starts ;-).
> 

This is very strange, as softplay doesn't save anything to the next vdr 
session... What does the red error message say? Is it the "can't open 
file..." message? What file does it try to open?

Martin


From M.Wache at gmx.net  Sun May  8 11:48:24 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 08 May 2005 11:48:24 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427D3F42.7010206@e-dition.fr>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <427D3F42.7010206@e-dition.fr>
Message-ID: <427DE068.6020700@gmx.net>

Nicolas Huillard wrote:

> If this plugin if meant to replace both vdr-mplayer (video playback, ie. 
> no playlist, but good navigation inside the stream) and vdr-mp3 (audio, 
> ie. strong playlist support),
Yes, it's supposed to be the one for them all type of thing ;-)


> I can't resist to suggest my favourite 
> playlist management tastes :
> * I often use mp3blaster on the console
> * it is based on directory browsing (no fancy database, et al : just 
> plain directory tree)
> * directories are added as directories (or albums) in the playlist : 
> when you select a directory for playing, you see only the name of the 
> "album", and must go inside to see titles
> * "albums" can be inserted/removed freely in the current playing list
> * other features are standard...
Sounds like a neat interface. Right now you can add directories, but in 
the end just the files containing the directories are added. On the 
other hand I must say your suggestion sounds better to me (although it 
requires more work...)
How does mp3blaster handle shuffleing of playlists? Is it possible to 
shuffle different the contents of different albums? Right now I don't 
have a simple idea how to implement a shuffle function with your 
suggested interface... But I guess it just requires a bit more work.

> 
> Manpages in french (sorry, Google didn't find anything else, this time) 
> : http://www.delafond.org/traducmanfr/man/man1/mp3blaster.1.html
> 
Oh, hehm, my french is unfortunatly rather bad. The last time I tried to 
order peas in french I in fact ordered strawberries :-( I don't know 
why, I mean the french words are not at all similar... But at that 
moment I was really sure that I was ordering peas...

Martin


From M.Wache at gmx.net  Sun May  8 11:48:52 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 08 May 2005 11:48:52 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <200505080135.58144.stefan@lucke.in-berlin.de>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <200505080135.58144.stefan@lucke.in-berlin.de>
Message-ID: <427DE084.8050206@gmx.net>

Stefan Lucke wrote:

> When selecting the ".." directory, some special action should be
> considered to avoid directory name like:
> Name /data/MP3/../MP3/../MP3/Blues type 4
> Name /data/MP3/../MP3/../MP3/Bruce_Springsteen-Born_In_The_U.S.A..m3u type 8
> 
> Selecting ".." is almost the same as hitting the back key except for
> the top level directory from "--media-path".
My original plan was to remove the "." and ".." entries from the list, 
which would be the easiest way to get around the problem, but in the 
alpha stage I want to leave it like it is now.
> 
> Showing the selected path in the title line would be nice too.
> Very long directory names, which do not fit into this line they
> should be shortend in a way that at least the last comonent(s) is/are
> full visible like:
> 
> /a/very/very/long/and/funny/directory/name/of/my/music/category/artist/album
> 
> /a/..../category/artist/album
> 

Very good idea! I will add this feature.
Martin


From M.Wache at gmx.net  Sun May  8 11:49:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 08 May 2005 11:49:16 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <200505080900.34737.stefan@lucke.in-berlin.de>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <200505080900.34737.stefan@lucke.in-berlin.de>
Message-ID: <427DE09C.9040807@gmx.net>

Stefan Lucke wrote:

> 
> The jump is not last_played+puse_time. It is always for about
> 13 seconds as a new audio stream is reported after play. So the causer
> is located in softdevice. Softdevice Play() is calling Trickspeed(1)
> which in term sets:
>   if (trickSpeed!=1) {
>     if (aout)
>       aout->Clear();
>     AudioIdx=DONT_PLAY;
>   } //else AudioIdx=NO_STREAM;
> 
> By commenting the else part like above, there are no jumps anymore
> in softplay mp3 playback. We have to check the influence on other
> playback types.
> 
Great, this make sense! As far as I remember the AudioIdx=NO_STREAM is 
needed when changing from slow motion or fast forward/backward to normal 
playback. Could you try if this is still working (ie if there is sound 
when changing back to normal speed)? If not maybe something like this helps:

    if (trickSpeed!=1) {
      if (aout)
        aout->Clear();
      AudioIdx=DONT_PLAY;
    } else  if (AudioIdx==DONT_PLAY)
                 AudioIdx=NO_STREAM;

Bye,
Martin


From stefan at lucke.in-berlin.de  Sun May  8 19:23:49 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 May 2005 19:23:49 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427DE05E.8010009@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <200505080119.34172.stefan@lucke.in-berlin.de> <427DE05E.8010009@gmx.net>
Message-ID: <200505081923.50046.stefan@lucke.in-berlin.de>

On Sonntag, 8. Mai 2005 11:48, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > 
> > With new cvs version I noticed a strange behaviour in directory play mode.
> > Upon the next start of vdr when selecing softplay the first time, and
> > selecting the same dir again, the red error message is shown for
> > a short time, but then directory play starts ;-).
> > 
> 
> This is very strange, as softplay doesn't save anything to the next vdr 
> session... What does the red error message say? Is it the "can't open 
> file..." message? What file does it try to open?

In the log the filename is truncated, but I could se it for a short time:
unbekannt.m3u. So the mp3 plugin left a playlist file for this directory.
after removing this playlist file softplay acts normal. So you may
ignore this report, except for some special handling in the
file filter for *.m3u files :-) .

-- 
Stefan Lucke



From marko.makela at hut.fi  Sun May  8 21:41:23 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 8 May 2005 22:41:23 +0300
Subject: [Softdevice-devel] Blanking the screen when no video; standby mode
Message-ID: <20050508194123.GA155901@kosh.hut.fi>

Originally, I was an unhappy DXR3 card user.  The card ended my pains by
letting the magic smoke out.

However, there was one thing that the DXR3 plugin or the DXR3 card did
better than softdevice: it blanked the screen after a short while of no
video, such as when listening to the radio programs.  (The state-owned
Finnish broadcaster YLE is phasing out DAB and going for DVB-based digital
radio.)  Could the softdevice plugin have a similar timer?  Blanking the
screen would save power consumption and the operating life of CRT screens.

Another thing, which might better be asked on some generic VDR list
(but I'm not subscribed to those).  Is there any "standby" key that
tells VDR to stop playback and to cut the inactivity timer to zero?
You know, when VDR is recording or is about to start recording within
10 minutes, it will refuse to power down.  In my experience, pressing
the power button won't reset the inactivity timer, and thus the computer
won't shut down 5 minutes after the recording has been finished, but
3 hours after the power button was pressed.  (These times could be
slightly different, but you get the idea.)  My VDR box powers itself
on and off by nvram-wakeup.

	Marko


From stefan at lucke.in-berlin.de  Sun May  8 23:41:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 8 May 2005 23:41:05 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427DE09C.9040807@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <200505080900.34737.stefan@lucke.in-berlin.de> <427DE09C.9040807@gmx.net>
Message-ID: <200505082341.05731.stefan@lucke.in-berlin.de>

On Sonntag, 8. Mai 2005 11:49, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > 
> > The jump is not last_played+puse_time. It is always for about
> > 13 seconds as a new audio stream is reported after play. So the causer
> > is located in softdevice. Softdevice Play() is calling Trickspeed(1)
> > which in term sets:
> >   if (trickSpeed!=1) {
> >     if (aout)
> >       aout->Clear();
> >     AudioIdx=DONT_PLAY;
> >   } //else AudioIdx=NO_STREAM;
> > 
> > By commenting the else part like above, there are no jumps anymore
> > in softplay mp3 playback. We have to check the influence on other
> > playback types.
> > 
> Great, this make sense! As far as I remember the AudioIdx=NO_STREAM is 
> needed when changing from slow motion or fast forward/backward to normal 
> playback. Could you try if this is still working (ie if there is sound 
> when changing back to normal speed)? If not maybe something like this helps:
> 
>     if (trickSpeed!=1) {
>       if (aout)
>         aout->Clear();
>       AudioIdx=DONT_PLAY;
>     } else  if (AudioIdx==DONT_PLAY)
>                  AudioIdx=NO_STREAM;

Yep. That's better, as with my modification we'll loose sometimes audio.
Yours also improves pause/play transition of video playback too. committed.
-- 
Stefan Lucke



From nhuillard at e-dition.fr  Mon May  9 12:29:01 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 09 May 2005 12:29:01 +0200
Subject: [Softdevice-devel] Blanking the screen when no video; standby
 mode
In-Reply-To: <20050508194123.GA155901@kosh.hut.fi>
References: <20050508194123.GA155901@kosh.hut.fi>
Message-ID: <427F3B6D.7060501@e-dition.fr>

Marko M?kel? a ?crit :

I second both feature requests.

> However, there was one thing that the DXR3 plugin or the DXR3 card did
> better than softdevice: it blanked the screen after a short while of no
> video, such as when listening to the radio programs.  (The state-owned
> Finnish broadcaster YLE is phasing out DAB and going for DVB-based digital
> radio.)  Could the softdevice plugin have a similar timer?  Blanking the
> screen would save power consumption and the operating life of CRT screens.

Also useful when manually setting "playback" to "suspended". Or when 
switching channel and waiting for the new video to come out (or not come 
at all, when the channel configuration is not up-to-date).

> Another thing, which might better be asked on some generic VDR list
> (but I'm not subscribed to those).  Is there any "standby" key that
> tells VDR to stop playback and to cut the inactivity timer to zero?
> You know, when VDR is recording or is about to start recording within
> 10 minutes, it will refuse to power down.  In my experience, pressing
> the power button won't reset the inactivity timer, and thus the computer
> won't shut down 5 minutes after the recording has been finished, but
> 3 hours after the power button was pressed.  (These times could be
> slightly different, but you get the idea.)  My VDR box powers itself
> on and off by nvram-wakeup.

Stefan's implemnetation of remote controling softrdevice (for aspect 
ratio handling) could also be used for "suspending" softdevice output. 
The inactivity timout is also a good controler for suspending output.

-- 
NH


From nhuillard at e-dition.fr  Mon May  9 12:31:38 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 09 May 2005 12:31:38 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <200505080900.34737.stefan@lucke.in-berlin.de>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <200505080900.34737.stefan@lucke.in-berlin.de>
Message-ID: <427F3C0A.7040304@e-dition.fr>

Stefan Lucke a ?crit :
> The jump is not last_played+puse_time. It is always for about
> 13 seconds as a new audio stream is reported after play. So the causer
> is located in softdevice. Softdevice Play() is calling Trickspeed(1)
> which in term sets:
>   if (trickSpeed!=1) {
>     if (aout)
>       aout->Clear();
>     AudioIdx=DONT_PLAY;
>   } //else AudioIdx=NO_STREAM;
> 
> By commenting the else part like above, there are no jumps anymore
> in softplay mp3 playback. We have to check the influence on other
> playback types.

It may also explain the problem I have with the mp3 plugin. And I also 
experienced the same behaviour when playing a video recording : when 
playing it back, it first played very fast with no output at all. I 
wasn't able to reproduce it, though.

-- 
NH


From nhuillard at e-dition.fr  Mon May  9 13:01:35 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 09 May 2005 13:01:35 +0200
Subject: [Softdevice-devel] softplay: pause handling
In-Reply-To: <427DE068.6020700@gmx.net>
References: <200505072101.04483.stefan@lucke.in-berlin.de> <427D25F9.2000109@gmx.net> <427D3F42.7010206@e-dition.fr> <427DE068.6020700@gmx.net>
Message-ID: <427F430F.5010404@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
> 
>> I can't resist to suggest my favourite playlist management tastes :
>> * I often use mp3blaster on the console
>> * it is based on directory browsing (no fancy database, et al : just 
>> plain directory tree)
>> * directories are added as directories (or albums) in the playlist : 
>> when you select a directory for playing, you see only the name of the 
>> "album", and must go inside to see titles
>> * "albums" can be inserted/removed freely in the current playing list
>> * other features are standard...
> 
> Sounds like a neat interface. Right now you can add directories, but in 
> the end just the files containing the directories are added. On the 
> other hand I must say your suggestion sounds better to me (although it 
> requires more work...)
> How does mp3blaster handle shuffleing of playlists? Is it possible to 
> shuffle different the contents of different albums? Right now I don't 
> have a simple idea how to implement a shuffle function with your 
> suggested interface... But I guess it just requires a bit more work.

When I'm not lazy, I can provide this : 
http://nicolas.huillard.net/vdr/mp3blaster/
See the english man page and a screenshot.

Regarding shuffling : I never use it, but from the man, mp3blaster can 
shuffle albums between them, songs inside albums, or the whole playlist 
(it seems "a bit more work", yes, but I wouldn't miss it).
Albums (or "groups", as the man refers to) can be nested (but I've never 
used it).

Also :
* I never use ID3tags : they're often bad copies of the file naming 
convention ("[Artist]/[Album]/[order] - [title]", with sometimes 
"[Album]" = "[Year] - [Album]"), or just plain junk ("genre", for instance)
* the "--media-path" part of the selected path shown in the title bar (I 
only paraphrase Stefan, because I still didn't see it...) could just be 
removed from the display, ie. show "category/artist/album" when 
directory is 
/a/very/very/long/and/funny/directory/name/of/my/music/category/artist/album 
and --media-path=/a/very/very/long/and/funny/directory/name/of/my/music

-- 
NH


From patrick.boettcher at desy.de  Mon May  9 17:50:04 2005
From: patrick.boettcher at desy.de (Patrick Boettcher)
Date: Mon, 9 May 2005 17:50:04 +0200 (CEST)
Subject: [Softdevice-devel] Blanking the screen when no video; standby
 mode
In-Reply-To: <20050508194123.GA155901@kosh.hut.fi>
References: <20050508194123.GA155901@kosh.hut.fi>
Message-ID: <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>

On Sun, 8 May 2005, Marko M?kel? wrote:

> Originally, I was an unhappy DXR3 card user.  The card ended my pains by
> letting the magic smoke out.
>
> However, there was one thing that the DXR3 plugin or the DXR3 card did
> better than softdevice: it blanked the screen after a short while of no
> video, such as when listening to the radio programs.  (The state-owned
> Finnish broadcaster YLE is phasing out DAB and going for DVB-based digital
> radio.)  Could the softdevice plugin have a similar timer?  Blanking the
> screen would save power consumption and the operating life of CRT screens.

I second this request too. I thought that this is only a problem of 
softdevice using together with dfb:mga.

Vdr-xine solves this by playing the no-signel.pes file, which is a black 
stream. I don't know if it is possible to introduce this in softdevice 
too.

Btw. thanks for the great Plugin, it saves me a lot of nerves since my 
FF-card is faulty somehow. Besides the 16:9 and 4:3 switch-crashes it is 
rock-stable.

best regards,
Patrick.

--
   Mail: patrick.boettcher at desy.de
   WWW:  http://www.wi-bw.tfh-wildau.de/~pboettch/

From M.Wache at gmx.net  Mon May  9 18:05:57 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 09 May 2005 18:05:57 +0200
Subject: [Softdevice-devel] Blanking the screen when no video; standby
 mode
In-Reply-To: <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>
Message-ID: <427F8A65.20405@gmx.net>

Patrick Boettcher wrote:
> On Sun, 8 May 2005, Marko M?kel? wrote:
> 
>> Originally, I was an unhappy DXR3 card user.  The card ended my pains by
>> letting the magic smoke out.
>>
>> However, there was one thing that the DXR3 plugin or the DXR3 card did
>> better than softdevice: it blanked the screen after a short while of no
>> video, such as when listening to the radio programs.  (The state-owned
>> Finnish broadcaster YLE is phasing out DAB and going for DVB-based 
>> digital
>> radio.)  Could the softdevice plugin have a similar timer?  Blanking the
>> screen would save power consumption and the operating life of CRT 
>> screens.
> 
> 
> I second this request too. I thought that this is only a problem of 
> softdevice using together with dfb:mga.
> 
> Vdr-xine solves this by playing the no-signel.pes file, which is a black 
> stream. I don't know if it is possible to introduce this in softdevice too.
> 
In fact just blanking the screen is even easier for the softdevice, we 
just have to display a black frame, and don't need to have some .pes 
files around. So I will add this feature in the next few days.

Bye,
Martin


From M.Wache at gmx.net  Mon May  9 18:30:24 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 09 May 2005 18:30:24 +0200
Subject: [Softdevice-devel] softplay features / keys
Message-ID: <427F9020.7040408@gmx.net>

Hi all,

ok, here is a list of features that I'm currently working on or that I 
plan to include:

- playlist with album support similar to mp3blaster - almost done
- remove/add  files/albums during playback ( adding is already possible)
- shuffle the complete playlist - done (maybe I will also add per album 
shuffle a la mp3blaster in the future)
- .m3u support ( future )
- display cut down path in the title ( near future )
- saving of the softplay playlist ( future - how important is this feature?)
- reading and display of mp3 id tags (reading is already done by 
libavformat, but the information is not passed to the playlist - future 
- should one be able to disable this feature?)

Did I miss a feature request?

By pressing the red key during a playlist playback you enter a playlist 
display from where you can browse through the playlist, skip to a 
certain song and edit (not really yet) the playlist. The current title 
is automatically highlighted at the start and after some time of 
inactivity. I'm currently thinking about which keys to use during 
playlist playback, I guess it makes sense to use different keys from the 
single file playback (eg. movies) there. What kind of actions would be 
important for you to have a key for? Skip to next/last song? Skip 
forward/backward in the current song? Which keys should be used? 
Currently I tried to stick as close the what Klaus Schmidinger suggested 
  in the plugins manual, but a some things doesn't make sense for 
playlist playback.

Yesterday I rewrote the playlist support almost completly to get the 
album support, and now I've almost all features I already implemented 
the day before yesterday. I will commit these changes sometimes this 
evening.

Bye,
Martin


From nhuillard at e-dition.fr  Mon May  9 19:19:09 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 09 May 2005 19:19:09 +0200
Subject: [Softdevice-devel] softplay features / keys
In-Reply-To: <427F9020.7040408@gmx.net>
References: <427F9020.7040408@gmx.net>
Message-ID: <427F9B8D.6060609@e-dition.fr>

Martin Wache a ?crit :
> ok, here is a list of features that I'm currently working on or that I 
> plan to include:

Since you code faster than I think, I'll try not to forget anything and 
reply promptly !

> - playlist with album support similar to mp3blaster - almost done

Great !

> - remove/add  files/albums during playback ( adding is already possible)

Great !

> - shuffle the complete playlist - done (maybe I will also add per album 
> shuffle a la mp3blaster in the future)
> - .m3u support ( future )
> - display cut down path in the title ( near future )
> - saving of the softplay playlist ( future - how important is this 
> feature?)

Important, as in : "I really like it in XMMS/Winamp, but didn't yet find 
enough time to check if mp3blaster can do that (but mp3blaster stays in 
a screen terminal for days, rendering a save function useless)"

> - reading and display of mp3 id tags (reading is already done by 
> libavformat, but the information is not passed to the playlist - future 
> - should one be able to disable this feature?)

One should be able to disable junk ID3 tags. BTW, when speaking of ID3, 
I also/always mean OGG meta-tags...

> Did I miss a feature request?

I'll have to compile and see by myself... Since I tend to KISS, that may 
be enough...

> By pressing the red key during a playlist playback you enter a playlist 
> display from where you can browse through the playlist, skip to a 
> certain song and edit (not really yet) the playlist. The current title 
> is automatically highlighted at the start and after some time of 
> inactivity. I'm currently thinking about which keys to use during 
> playlist playback, I guess it makes sense to use different keys from the 
> single file playback (eg. movies) there. What kind of actions would be 
> important for you to have a key for? Skip to next/last song? Skip 
> forward/backward in the current song? Which keys should be used? 
> Currently I tried to stick as close the what Klaus Schmidinger suggested 
>  in the plugins manual, but a some things doesn't make sense for 
> playlist playback.

Maybe keys from the DVD plugin should be the model to follow, regarding 
albums as titles/chapters in the DVD realm.
Am I right to think replaying will work for both audio and video in 
either mode (playlist playback and single file playback) ?
In that case, the left/right/up/down keys should remain the same (ie. 
resp. rewind/fastforward/play/pause).
The DVD-plugin uses the numeric keys for title/chapter navigation. Could 
those keys be used for previous/next song, previous/next album, and so on ?
When the playlist is actually on-screen, the direction-keys can be used 
for navigation (down goes down, ie. select next song, right enters the 
album, etc.) OK can be used as in the channel-list view : play the song.

User interface is difficult to make right, and I think I miss the 
current state to discuss it clearly. I'll surely have more to say once I 
compile your plugin, and actually see it on screen.

> Yesterday I rewrote the playlist support almost completly to get the 
> album support, and now I've almost all features I already implemented 
> the day before yesterday. I will commit these changes sometimes this 
> evening.

Many thanks for your hard work !

-- 
NH


From stefan at lucke.in-berlin.de  Mon May  9 19:47:53 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 May 2005 19:47:53 +0200
Subject: [Softdevice-devel] Blanking the screen when no video; standby mode
In-Reply-To: <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>
Message-ID: <200505091947.53469.stefan@lucke.in-berlin.de>

On Montag, 9. Mai 2005 17:50, Patrick Boettcher wrote:
> On Sun, 8 May 2005, Marko M?kel? wrote:
> 
> > Originally, I was an unhappy DXR3 card user.  The card ended my pains by
> > letting the magic smoke out.
> >
> > However, there was one thing that the DXR3 plugin or the DXR3 card did
> > better than softdevice: it blanked the screen after a short while of no
> > video, such as when listening to the radio programs.  (The state-owned
> > Finnish broadcaster YLE is phasing out DAB and going for DVB-based digital
> > radio.)  Could the softdevice plugin have a similar timer?  Blanking the
> > screen would save power consumption and the operating life of CRT screens.
> 
> I second this request too. I thought that this is only a problem of 
> softdevice using together with dfb:mga.

I think we could do something in that direction as directfb supports some
suspend functionality for output connectors. Nver tried that, but ..

> 
> Vdr-xine solves this by playing the no-signel.pes file, which is a black 
> stream. I don't know if it is possible to introduce this in softdevice 
> too.
> 
> Btw. thanks for the great Plugin, it saves me a lot of nerves since my 
> FF-card is faulty somehow. Besides the 16:9 and 4:3 switch-crashes it is 
> rock-stable.

Which ffmpeg version (if cvs from which day) do you use ?
Can you try attached patch to see if it fexes that for you (too) ?


-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: parser-01.diff
Type: text/x-diff
Size: 1062 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050509/7e0666d3/attachment.diff>

From stefan at lucke.in-berlin.de  Mon May  9 20:02:04 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 May 2005 20:02:04 +0200
Subject: [Softdevice-devel] Blanking the screen when no video; standby mode
In-Reply-To: <427F8A65.20405@gmx.net>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de> <427F8A65.20405@gmx.net>
Message-ID: <200505092002.04350.stefan@lucke.in-berlin.de>

On Montag, 9. Mai 2005 18:05, Martin Wache wrote:
> Patrick Boettcher wrote:
> > On Sun, 8 May 2005, Marko M?kel? wrote:
> > 
> >> Originally, I was an unhappy DXR3 card user.  The card ended my pains by
> >> letting the magic smoke out.
> >>
> >> However, there was one thing that the DXR3 plugin or the DXR3 card did
> >> better than softdevice: it blanked the screen after a short while of no
> >> video, such as when listening to the radio programs.  (The state-owned
> >> Finnish broadcaster YLE is phasing out DAB and going for DVB-based 
> >> digital
> >> radio.)  Could the softdevice plugin have a similar timer?  Blanking the
> >> screen would save power consumption and the operating life of CRT 
> >> screens.
> > 
> > 
> > I second this request too. I thought that this is only a problem of 
> > softdevice using together with dfb:mga.
> > 
> > Vdr-xine solves this by playing the no-signel.pes file, which is a black 
> > stream. I don't know if it is possible to introduce this in softdevice too.
> > 
> In fact just blanking the screen is even easier for the softdevice, we 
> just have to display a black frame, and don't need to have some .pes 
> files around. So I will add this feature in the next few days.

Like offering an interface like device->PlayYUV() but with some
additional info that aspect ratio could be set correct ?

-- 
Stefan Lucke



From mvdbeek at gmx.de  Mon May  9 20:25:11 2005
From: mvdbeek at gmx.de (Marius van den Beek)
Date: Mon, 9 May 2005 20:25:11 +0200 (MEST)
Subject: [Softdevice-devel] Softplay : Bugs/features
Message-ID: <14900.1115663111@www82.gmx.net>

Hello

I've tried the new softplay-plugin and it works
really well for the recordings I converted to divx,
but some divx and mpg's I downloaded are distorted
or do not show picture at all.
I don't know if you already noticed that,
maybe I can send you a sample.
As to the features I think the suggestion from
Nicolas Huillard regarding the navigation is a good idea,
important to me seems the possibility to switch the audio-streams
(of avi's).
Thank you for the nice work

Marius

-- 
+++ Neu: Echte DSL-Flatrates von GMX - Surfen ohne Limits +++
Always online ab 4,99 Euro/Monat: http://www.gmx.net/de/go/dsl


From patrick.boettcher at desy.de  Mon May  9 22:46:54 2005
From: patrick.boettcher at desy.de (Patrick Boettcher)
Date: Mon, 9 May 2005 22:46:54 +0200 (CEST)
Subject: 16:9-switch-crash (was: Re: [Softdevice-devel] Blanking the screen
 when no video; standby mode)
In-Reply-To: <200505091947.53469.stefan@lucke.in-berlin.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de>
 <200505091947.53469.stefan@lucke.in-berlin.de>
Message-ID: <Pine.LNX.4.61.0505092232550.8489@pub2.ifh.de>

Hi Stefan,

On Mon, 9 May 2005, Stefan Lucke wrote:
>> Btw. thanks for the great Plugin, it saves me a lot of nerves since my
>> FF-card is faulty somehow. Besides the 16:9 and 4:3 switch-crashes it is
>> rock-stable.
>
> Which ffmpeg version (if cvs from which day) do you use ?

I'm using Marillat's libavcodeccvs-dev which claims to be from 2005-04-09 
in Debian.

> Can you try attached patch to see if it fexes that for you (too) ?

I'm using softdevice from CVS. Yesterday I 'cvs up'ed and it seems that 
the problem has gone. Today I watched "Speer und er" on ARD (which is the 
only channel which produces the crash). I'm not sure if this broadcast was 
16:9. If it was, there was no crash, but just a short distortion right at 
the beginning.

thanks,
Patrick.

--
   Mail: patrick.boettcher at desy.de
   WWW:  http://www.wi-bw.tfh-wildau.de/~pboettch/


From stefan at lucke.in-berlin.de  Mon May  9 22:47:27 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 May 2005 22:47:27 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <200504272113.47316.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <20050427183849.GA330538@kosh.hut.fi> <200504272113.47316.stefan@lucke.in-berlin.de>
Message-ID: <200505092247.27203.stefan@lucke.in-berlin.de>

On Mittwoch, 27. April 2005 21:13, Stefan Lucke wrote:
> On Mittwoch, 27. April 2005 20:38, Marko M?kel? wrote:
> > On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> > > http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> > > 
> > > You may try that with vdr running for gdb too.
> > 
> > I got a nice crash in libavcodec:
> 
> Some similar crash here. And that is suprising, as my ffmpeg has
> a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> switch. Your stream has _no_ such switch and when reverting
> ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> the segfault has gone.

That is wrong: this stream has a 4:3 -> 16:9 switch. I backed out
above mentioned mpeg12.c change and replaced it with my
proposted (and rejected change) 
see: http://article.gmane.org/gmane.comp.video.ffmpeg.devel/20933  .

and the result is a playback without crash and a correct
displayed aspect ratio change.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon May  9 23:18:32 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 9 May 2005 23:18:32 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <200504272113.47316.stefan@lucke.in-berlin.de>
References: <20050323222925.GC430274@kosh.hut.fi> <20050427183849.GA330538@kosh.hut.fi> <200504272113.47316.stefan@lucke.in-berlin.de>
Message-ID: <200505092318.32103.stefan@lucke.in-berlin.de>

On Mittwoch, 27. April 2005 21:13, Stefan Lucke wrote:
> On Mittwoch, 27. April 2005 20:38, Marko M?kel? wrote:
> > On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> > > http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> > > 
> > > You may try that with vdr running for gdb too.
> > 
> > I got a nice crash in libavcodec:
> 
> Some similar crash here. And that is suprising, as my ffmpeg has
> a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> switch. Your stream has _no_ such switch and when reverting
> ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> the segfault has gone.

Previous mail lost (even not in my send folder) ??

No thats wrong. There is a 4:3 -> 16:9 switch.
I backed out above mentioned change and used my patch send
to ffmpeg-devel from here:
http://article.gmane.org/gmane.comp.video.ffmpeg.devel/20933

The result is, that there is no crash anymore and aspect ratio
is detected right.

-- 
Stefan Lucke



From M.Wache at gmx.net  Mon May  9 23:37:38 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 09 May 2005 23:37:38 +0200
Subject: [Softdevice-devel] Blanking the screen when no video; standby
 mode
In-Reply-To: <200505092002.04350.stefan@lucke.in-berlin.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de> <427F8A65.20405@gmx.net> <200505092002.04350.stefan@lucke.in-berlin.de>
Message-ID: <427FD822.4030103@gmx.net>

Stefan Lucke wrote:

>>In fact just blanking the screen is even easier for the softdevice, we 
>>just have to display a black frame, and don't need to have some .pes 
>>files around. So I will add this feature in the next few days.
> 
> 
> Like offering an interface like device->PlayYUV() but with some
> additional info that aspect ratio could be set correct ?
> 
In fact I wanted to feed a sufficient large black frame to the device's 
YUV() function. It should continue using the current aspect ratio, or am 
I mistaken?
By the way, there is already a timer which could do this, currently it 
just handles the fallback to pseudo osd in software osd mode. And a nice 
sideeffect would be that we don't need the fallback anymore if we 
display a black frame :-)

Bye,
Martin


From M.Wache at gmx.net  Tue May 10 00:19:34 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 10 May 2005 00:19:34 +0200
Subject: [Softdevice-devel] softplay features / keys
In-Reply-To: <427F9B8D.6060609@e-dition.fr>
References: <427F9020.7040408@gmx.net> <427F9B8D.6060609@e-dition.fr>
Message-ID: <427FE1F6.2080005@gmx.net>

Nicolas Huillard wrote:

> Since you code faster than I think, I'll try not to forget anything and 
> reply promptly !
I guess I will have to slow down soon, I still have different things to 
do than coding...

> 
> Maybe keys from the DVD plugin should be the model to follow, regarding 
> albums as titles/chapters in the DVD realm.
> Am I right to think replaying will work for both audio and video in 
> either mode (playlist playback and single file playback) ?
> In that case, the left/right/up/down keys should remain the same (ie. 
> resp. rewind/fastforward/play/pause).
Good point. I was about not to have a rewind/fast forward function in 
playlist mode, and use those keys instead for next/previous file/album. 
But yes, the playlist mode is supposed to work also with video files.
What about the Green and Yellow button, they are supposed to skip 
forward/backward. Maybe I should use them for next/previous file?

> The DVD-plugin uses the numeric keys for title/chapter navigation. Could 
> those keys be used for previous/next song, previous/next album, and so on ?
Actualy that's one of the features of the DVD-plugin I don't really 
like. I can never remember which numeric key belongs to which function. 
Is there anyone who actualy uses these features and knows the keys and 
functions by heart? For me it's just not intuitive, but currently I 
don't have a much better idea.

> When the playlist is actually on-screen, the direction-keys can be used 
> for navigation (down goes down, ie. select next song, right enters the 
> album, etc.) OK can be used as in the channel-list view : play the song.
That's almost like it is now :-) Expect that left and right a currently 
unused (I think vdr skips pages when pressing left and right, but that 
can be changed). Opening albums works with OK, but currently the 
playlist is always expanded in replay mode. So albums are only visible 
in edit mode.
Right now the playlist is always shuffled, but just because I didn't add 
a switch for disable shuffleing.

> 
> User interface is difficult to make right,
That's true ;-) For me the most important thing would be that one 
doesn't have to read through pages of manual to be able to use the main 
features of the plugin. It should just behave like one would expect, but 
what is it that people expect?

> current state to discuss it clearly. I'll surely have more to say once I 
> compile your plugin, and actually see it on screen.
> 
>> Yesterday I rewrote the playlist support almost completly to get the 
>> album support, and now I've almost all features I already implemented 
>> the day before yesterday. I will commit these changes sometimes this 
>> evening.

I commited my last changes to the CVS, now adding and deleting to the 
current playlist during playback is possible, but not really stable 
right now. Maybe I have to rethink the shuffle support, this makes 
deleting and adding really complicated :-(

Good night,
Martin




From stefan at lucke.in-berlin.de  Tue May 10 08:57:49 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 10 May 2005 08:57:49 +0200
Subject: softplay: key navigation (WAS:[Softdevice-devel] softplay features / keys)
Message-ID: <1115708269.42805b6dddb1c@webmail.in-berlin.de>

Martin Wache wrote:
> Nicolas Huillard wrote:
> > The DVD-plugin uses the numeric keys for title/chapter navigation. Could
> > those keys be used for previous/next song, previous/next album, and so on ?
> Actualy that's one of the features of the DVD-plugin I don't really
> like. I can never remember which numeric key belongs to which function.
> Is there anyone who actualy uses these features and knows the keys and
> functions by heart? For me it's just not intuitive, but currently I
> don't have a much better idea.

I can't memorize dvd-plugins numbers for navigation too, but vdr has some
numbers for moving and selecting cut marks:
7 / 9:  prev / next mark (prev / next item of playlist ?
4 / 6:  move cut mark / back forward ( ?? ).


Stefan Lucke






From nhuillard at e-dition.fr  Tue May 10 10:51:14 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 10 May 2005 10:51:14 +0200
Subject: softplay: key navigation (WAS:[Softdevice-devel] softplay features
 / keys)
In-Reply-To: <1115708269.42805b6dddb1c@webmail.in-berlin.de>
References: <1115708269.42805b6dddb1c@webmail.in-berlin.de>
Message-ID: <42807602.8020407@e-dition.fr>

Stefan Lucke a ?crit :
> Martin Wache wrote:
> 
>>Nicolas Huillard wrote:
>>
>>>The DVD-plugin uses the numeric keys for title/chapter navigation. Could
>>>those keys be used for previous/next song, previous/next album, and so on ?
>>
>>Actualy that's one of the features of the DVD-plugin I don't really
>>like. I can never remember which numeric key belongs to which function.
>>Is there anyone who actualy uses these features and knows the keys and
>>functions by heart? For me it's just not intuitive, but currently I
>>don't have a much better idea.
> 
> I can't memorize dvd-plugins numbers for navigation too, but vdr has some
> numbers for moving and selecting cut marks:
> 7 / 9:  prev / next mark (prev / next item of playlist ?
> 4 / 6:  move cut mark / back forward ( ?? ).

I didn't yet play enough DVD with the DVD-plugin to say if memorizing is 
too difficult, but I definitely got used to that marks-moving keys. On 
the other side, I personnaly mark recordings, but my wife and the 
children will almost play recordings (plain or softplay) and DVDs. The 
keys should then be similar...

Side note : I didn't yet configure LIRC/VDR to respond to my second 
remote (the universal one coming with the receiver), which has DVD- and 
CD- and SAT-like controls. It would be cool to take care of that kind of 
problem (use many keys, like "rewind" + "4" to rewind, etc.). That 
remote also has a strange layout for the numeric keys (3 rows or 4 keys 
minus 2 instead of 3 x 3 + 1), which renders mnemonic numeric control 
impossible.

-- 
NH


From stefan at lucke.in-berlin.de  Tue May 10 11:31:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 10 May 2005 11:31:39 +0200
Subject: softplay: key navigation (WAS:[Softdevice-devel] softplay features / keys)
In-Reply-To: <42807602.8020407@e-dition.fr>
References: <1115708269.42805b6dddb1c@webmail.in-berlin.de> <42807602.8020407@e-dition.fr>
Message-ID: <1115717499.42807f7bcf8bd@webmail.in-berlin.de>

Quoting Nicolas Huillard :

> Stefan Lucke a ?crit :
> > Martin Wache wrote:
> >
> >>Nicolas Huillard wrote:
> >>
> >>>The DVD-plugin uses the numeric keys for title/chapter navigation. Could
> >>>those keys be used for previous/next song, previous/next album, and so on
> ?
> >>
> >>Actualy that's one of the features of the DVD-plugin I don't really
> >>like. I can never remember which numeric key belongs to which function.
> >>Is there anyone who actualy uses these features and knows the keys and
> >>functions by heart? For me it's just not intuitive, but currently I
> >>don't have a much better idea.
> >
> > I can't memorize dvd-plugins numbers for navigation too, but vdr has some
> > numbers for moving and selecting cut marks:
> > 7 / 9:  prev / next mark (prev / next item of playlist ?
> > 4 / 6:  move cut mark / back forward ( ?? ).
>
> I didn't yet play enough DVD with the DVD-plugin to say if memorizing is
> too difficult, but I definitely got used to that marks-moving keys. On
> the other side, I personnaly mark recordings, but my wife and the
> children will almost play recordings (plain or softplay) and DVDs. The
> keys should then be similar...

Same here: I do the cutting. Had a look at dvd-plugin. There are several
places where those keys are handled. But one place where "7" and "Channel-down"
are mapped to previous-title and "9" and "Channel-up" are mapped to next-title.

Green/yellow should to my opinion do a short jump 10/15 seconds, or better
a jump dependant of the current track length.
 - > 10 minutes like vdr +- 60 sec
 - >  5 minutes 15 sec
 - else 10 secs


Stefan Lucke


From M.Wache at gmx.net  Tue May 10 18:01:41 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 10 May 2005 18:01:41 +0200
Subject: softplay: key navigation (WAS:[Softdevice-devel] softplay features
 / keys)
In-Reply-To: <1115717499.42807f7bcf8bd@webmail.in-berlin.de>
References: <1115708269.42805b6dddb1c@webmail.in-berlin.de> <42807602.8020407@e-dition.fr> <1115717499.42807f7bcf8bd@webmail.in-berlin.de>
Message-ID: <4280DAE5.8050402@gmx.net>

Stefan Lucke wrote:

>>>I can't memorize dvd-plugins numbers for navigation too, but vdr has some
>>>numbers for moving and selecting cut marks:
>>>7 / 9:  prev / next mark (prev / next item of playlist ?
>>>4 / 6:  move cut mark / back forward ( ?? ).
>>
>>I didn't yet play enough DVD with the DVD-plugin to say if memorizing is
>>too difficult, but I definitely got used to that marks-moving keys. On
>>the other side, I personnaly mark recordings, but my wife and the
>>children will almost play recordings (plain or softplay) and DVDs. The
>>keys should then be similar...
> 
> 
> Same here: I do the cutting. Had a look at dvd-plugin. There are several
> places where those keys are handled. But one place where "7" and "Channel-down"
> are mapped to previous-title and "9" and "Channel-up" are mapped to next-title.
> 
So it seems that the dvd-plugin uses for moving to the next/previous 
title the same keys like vdr for jumping to the next/previous cut mark. 
That makes sense. 4/6 are used in the dvd-plugin to jump to the next 
part, also similar to vdr cutting. I haven't realized this up to now, 
maybe I will finally be able to memorize these keys ;-). So I guess it's 
the best to use these keys also.

> Green/yellow should to my opinion do a short jump 10/15 seconds, or better
> a jump dependant of the current track length.
>  - > 10 minutes like vdr +- 60 sec
>  - >  5 minutes 15 sec
>  - else 10 secs
> 
I don't think the separation between 15 sec and 10 sec is necessary, but 
otherwise a good idea. Unfortunatly libavformat sometimes has problems 
to predict the track length correctly, but lets see how good it works.

Bye,
Martin


From M.Wache at gmx.net  Tue May 10 18:15:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 10 May 2005 18:15:16 +0200
Subject: [Softdevice-devel] Softplay : Bugs/features
In-Reply-To: <14900.1115663111@www82.gmx.net>
References: <14900.1115663111@www82.gmx.net>
Message-ID: <4280DE14.7040704@gmx.net>

Marius van den Beek wrote:
> Hello
> 
> I've tried the new softplay-plugin and it works
> really well for the recordings I converted to divx,
> but some divx and mpg's I downloaded are distorted
> or do not show picture at all.
> I don't know if you already noticed that,
> maybe I can send you a sample.
The decoding of the streams is done by libavformat and libavcodec, so I 
don't have much influence on how streams are decoded. Sofplay just calls 
libavformat and hands the packets to the softdevice which decodes the 
packets using libavcodec.
So if some files are not decoded properly this is most likely because of 
some limitation in libavcodec or libavformat. To check this you can try 
to play the streams with ffplay (the player included in ffmpeg). If 
ffplay plays these files without problems, but softplay does not, then 
it is really a problem of softplay or the softdevice. Currently I know 
only one limitation, softplay is only capable of playing YUV420 encoded 
files, but since allmost all codecs (specially mpegXX and divx) use this 
pixel format I don't think that this is the problem.
Softplay prints a short description of the streams on the console when 
playing files, what does this description say?

> As to the features I think the suggestion from
> Nicolas Huillard regarding the navigation is a good idea,
> important to me seems the possibility to switch the audio-streams
> (of avi's).
Yes, I forgot to mention that important feature, it is planned as soon 
as the playlist support has stabelized. Thank you for reminding me!

Martin


From marko.makela at hut.fi  Wed May 11 07:59:14 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 11 May 2005 08:59:14 +0300
Subject: [Softdevice-devel] Blanking the screen when no video; standby mode
In-Reply-To: <200505091947.53469.stefan@lucke.in-berlin.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de> <200505091947.53469.stefan@lucke.in-berlin.de>
Message-ID: <20050511055914.GA444512@kosh.hut.fi>

On Mon, May 09, 2005 at 07:47:53PM +0200, Stefan Lucke wrote:
> > > Could the softdevice plugin have a similar timer?  Blanking the
> > > screen would save power consumption and the operating life of CRT screens.
> > 
> > I second this request too. I thought that this is only a problem of 
> > softdevice using together with dfb:mga.
> 
> I think we could do something in that direction as directfb supports some
> suspend functionality for output connectors. Nver tried that, but ..

I didn't think of DPMS, as the monitor I'm using is too old to support it.
But of course, it would be even better to use DPMS, to (almost) power off
the monitor with the remote control.  It would be nice if the "standby mode"
switch did all following things:

* suspend the playback
* blank the screen (black picture + DPMS off)
* mute the audio (to reduce noise, especially for onboard audio)
* set up the timer so that when any ongoing recording stops,
  the shutdown script will be called immediately

I'm planning to build a USB-controlled triac or relay circuit, similar to
the ones advertised at http://www.cleware.de/p-usbswitch.html.  (I can't
use those modules, because their drivers are closed source.)  The module
would control the power supply of the monitor (perhaps later a video beamer)
and the speakers.  I think USB is the only reasonable way to do this, because
the serial port is being phased out, and parallel port based control would
require an external power supply.

> Which ffmpeg version (if cvs from which day) do you use ?
> Can you try attached patch to see if it fexes that for you (too) ?

I tried ffmpeg cvs from a few days ago, and without your patch it still
crashes on the 4:3->16:9 switch of which I sent you a sample.  I'll try
applying your patch to ffmpeg later, maybe tonight or tomorrow.

	Marko


From mvdbeek at gmx.de  Wed May 11 16:15:02 2005
From: mvdbeek at gmx.de (Marius van den Beek)
Date: Wed, 11 May 2005 16:15:02 +0200 (MEST)
Subject: [Softdevice-devel] Softplay : Bugs/features
Message-ID: <1366.1115820902@www15.gmx.net>

Hi

I tried ffplay on the files that didn't play properly,
and the files played just as they should, so I think
it is a problem related to softdevice or softplay.
I hope you can reproduce and fix that.
Thank you

Marius

-- 
+++ Lassen Sie Ihren Gedanken freien Lauf... z.B. per FreeSMS +++
GMX bietet bis zu 100 FreeSMS/Monat: http://www.gmx.net/de/go/mail


From marko.makela at hut.fi  Wed May 11 18:33:28 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 11 May 2005 19:33:28 +0300
Subject: [Softdevice-devel] 4:3->16:9 crashes, interlacing options
In-Reply-To: <200505091947.53469.stefan@lucke.in-berlin.de>
References: <20050508194123.GA155901@kosh.hut.fi> <Pine.LNX.4.61.0505091738260.20329@pub4.ifh.de> <200505091947.53469.stefan@lucke.in-berlin.de>
Message-ID: <20050511163328.GA518934@kosh.hut.fi>

Stefan,

> > Btw. thanks for the great Plugin, it saves me a lot of nerves since my 
> > FF-card is faulty somehow. Besides the 16:9 and 4:3 switch-crashes it is 
> > rock-stable.
> 
> Which ffmpeg version (if cvs from which day) do you use ?
> Can you try attached patch to see if it fexes that for you (too) ?

I now tested a fresh ffmpeg snapshot with your patch applied.  Unfortunately,
it still crashes on the clip from which you have an extract, right before
the 4:3 -> 16:9 transition.  For some reason, I couldn't run it in gdb,
and attaching to the running process in gdb created a constant flow of
SIGTRAP when I tried to play the clip.  I'm running vdr-1.3.24 with
the patch from subtitles-0.3.7.  The only plugins loaded are softdevice
and subtitles.  It also crashes without -Psubtitles.

I tried to make sure that I'm running the patched ffmpeg (libavcodec.a).
I checked that /usr/local/lib/libavcodec.c matches with the one in the
source tree, and the date is later than parser.c and parser.o.  I also
did rm PLUGINS/src/softdevice/*.o; make plugins.

BTW, another thing: the softdevice settings menu now offers three interlacing
methods: "none", "lavc" and "linblend".  It looks like "linblend" will be
changed to "none" after pressing the OK key.  For some time, I think I got
a larger selection, but I'm not sure.  I compiled the libpostproc and enabled
it in the softdevice Makefile.

	Marko


From stefan at lucke.in-berlin.de  Wed May 11 21:51:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 11 May 2005 21:51:05 +0200
Subject: [Softdevice-devel] Repeatable crash
Message-ID: <200505112151.05330.stefan@lucke.in-berlin.de>

On Montag, 9. Mai 2005 22:47, Stefan Lucke wrote:
> On Mittwoch, 27. April 2005 21:13, Stefan Lucke wrote:
> > On Mittwoch, 27. April 2005 20:38, Marko M?kel? wrote:
> > > On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> > > > http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> > > > 
> > > > You may try that with vdr running for gdb too.
> > > 
> > > I got a nice crash in libavcodec:
> > 
> > Some similar crash here. And that is suprising, as my ffmpeg has
> > a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> > switch. Your stream has _no_ such switch and when reverting
> > ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> > the segfault has gone.
> 
> That is wrong: this stream has a 4:3 -> 16:9 switch. I backed out
> above mentioned mpeg12.c change and replaced it with my
> proposted (and rejected change) 
> see: http://article.gmane.org/gmane.comp.video.ffmpeg.devel/20933  .
> 
> and the result is a playback without crash and a correct
> displayed aspect ratio change.

Hm, softplay can play this one with corrrect aspect switch. But there are
some troubles with sync. I changed softdevice to use av_read_frame()
(with av_dup_packet()), and Marko's stream is playable too (got the
same sync problems). 
The traced pts/dts values seems to be randomly.

pkt.pts -84476179 pkt.dts -84476179
pkt.pts 10520433859 pkt.dts 10520420525
pkt.pts 10520424970 pkt.dts 10520424970
pkt.pts 10520429414 pkt.dts 10520429414
pkt.pts -9223372036854775808 pkt.dts 10520433859
pkt.pts 10520438303 pkt.dts 10520438303
pkt.pts -84473512 pkt.dts -84473512
pkt.pts -84470845 pkt.dts -84470845
pkt.pts -84468179 pkt.dts -84468179
pkt.pts 10520442748 pkt.dts 10520442748

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: segfault-02.diff
Type: text/x-diff
Size: 1048 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050511/39feffb3/attachment.diff>

From stefan at lucke.in-berlin.de  Wed May 11 21:51:10 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 11 May 2005 21:51:10 +0200
Subject: [Softdevice-devel] How to break threads
Message-ID: <200505112151.10159.stefan@lucke.in-berlin.de>

It is not enough just to change the subject of a replay, as there are still
references to the other mails. As a result a threading mail reader 
would show such a mail still under the original subject/thread.
So it's very hard to find a specific subject hidden by original subject.

Use new message to list and as a second the replay. Then cut and paste
the replay to the new message. done.

-- 
Stefan Lucke



From marko.makela at hut.fi  Thu May 12 08:16:21 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 12 May 2005 09:16:21 +0300
Subject: [Softdevice-devel] How to break threads
In-Reply-To: <200505112151.10159.stefan@lucke.in-berlin.de>
References: <200505112151.10159.stefan@lucke.in-berlin.de>
Message-ID: <20050512061621.GA305799@kosh.hut.fi>

On Wed, May 11, 2005 at 09:51:10PM +0200, Stefan Lucke wrote:
> It is not enough just to change the subject of a replay, as there are still
> references to the other mails. As a result a threading mail reader 
> would show such a mail still under the original subject/thread.
> So it's very hard to find a specific subject hidden by original subject.

Sorry, I didn't think of that.  I'm used to lower-volume mailing lists.
Moreover, some message readers (such as Gnus) hide duplicated subject lines
and only show the changed subjects within a thread.  Next time, I promise
to break the In-Reply-To chain when the subject changes.

	Marko


From stefan at lucke.in-berlin.de  Thu May 12 08:29:03 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 12 May 2005 08:29:03 +0200
Subject: [Softdevice-devel] How to break threads
In-Reply-To: <20050512061621.GA305799@kosh.hut.fi>
References: <200505112151.10159.stefan@lucke.in-berlin.de> <20050512061621.GA305799@kosh.hut.fi>
Message-ID: <1115879343.4282f7afb62f9@webmail.in-berlin.de>

Quoting Marko M?kel?:

> On Wed, May 11, 2005 at 09:51:10PM +0200, Stefan Lucke wrote:
> > It is not enough just to change the subject of a replay, as there are still
> > references to the other mails. As a result a threading mail reader
> > would show such a mail still under the original subject/thread.
> > So it's very hard to find a specific subject hidden by original subject.
>
> Sorry, I didn't think of that.  I'm used to lower-volume mailing lists.
> Moreover, some message readers (such as Gnus) hide duplicated subject lines
> and only show the changed subjects within a thread.  Next time, I promise
> to break the In-Reply-To chain when the subject changes.

Thats not only you. I think I did it sometimes wrong too. Yesterday I was
looking for the subject "Repeatable crash" were our troubles started, but it
was really hard to find. A mail reader which shows changed subject lines
is better in such cases.

Stefan Lucke


From nhuillard at e-dition.fr  Thu May 12 11:27:27 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 12 May 2005 11:27:27 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <4276D592.5060809@e-dition.fr>
References: <4276D592.5060809@e-dition.fr>
Message-ID: <4283217F.2000006@e-dition.fr>

I didn't have any reply/comments/etc.

Was I totally dreaming at 3:00 AM ?
Is it unimplementable ?
Or is it simply just so clear and so well defined that everybody agrees 
silently ? (I don't think the third option is the right one...)

Nicolas Huillard a ?crit :
> Hi,
> 
> After I have read and I hope understood what you all did describe, I can 
> sum-up thing here :
> 
> 1) option to set physical display size
> * use choose from "16/9", "4/3", even "16/10", or so
> * this is stored as a a decimal value : 1.777, 1.333, 1.6, etc.
> * this may be stored as the physical H + V sizes of the screen (as X does)
> * this option is selected once for all
> * it is independent of the resolution of the screen : think about 16/9 
> display at 800x600, or 16/10 at 1400x1050, or the new plasmas 16/9 at 
> 1024x1024
> * maybe this option is already present in the standard config / DVB card 
> / video format option (from VDR's MANUAL : "Video format = 4:3     The 
> video format (or aspect ratio) of the tv set in use (4:3 or 16:9)"
> * display ratio, and display resolution can be used together to 
> calculate the pixel aspect ratio : 800/600 / (16/9) = 0.75 ; 1280/768 / 
> (16/9) = 0.9375 ; 720/576 / (4/3) = 0.9375 ; etc.
> 
> 2) auto-detection of aspect ratio
> * the WSS bit can be set by the broadcaster to set the aspect ratio to 
> 16/9 (I think the only time I saw it was with Arte on analog broadcast, 
> because the TV switches to the full-frame display automagically)
> * other auto-detect features can be used, to set wether the frame is 
> meant to be viewed as 16/9 or 4/3 (or something else)
> * if no detection is done (I don't expect anything here in France), the 
> frame ratio will probably be advertised as 4/3
> * this is something the user has no impact on
> 
> 3) user-set programme aspect ratio
> * the user may choose not to trust the broadcaster advertised aspect 
> ratio (I won't)
> * the user selects the actual image ratio inside the frame : 4/3, 16/9, 
> 1.85, 2.35, etc.
> * the special value "trust the broadcaster" is simply the fact that the 
> image fills the entire frame, whatever the aspect ratio ("full-frame")
> * that would be the option the user changes most often : the one to 
> match to a remote key
> 
> 4) match between frame ratio and programme ratio
> * the match between frame ratio and image ratio is obvious : if the 
> broadcaster says the frame is 4:3 but I see a 16/9 image, the image 
> fills (4/3) / (16/9) = 0.75, leaving horizontal black bars ; if the 
> broadcaster says the frame is 16/9 but I see vertical black bars, the 
> image is in fact 4/3
> * the calculations begin to be difficult for me ;-)
> * this match is used to crop the image : strip black bars, the right 
> thickness, at the right places
> 
> 5) scaling between the frame/image ratio and the screen
> * once the image is cropped by the match between the frame and the 
> image, it can be scaled to the screen
> * scaling uses the calculated image size and the actual screen size
> * it also uses the screen aspect ratio, in another crop stage : fitting 
> a 4/3 image in a 16/9 screen, or a 16/9 image in a 4/3 screen, can be 
> done by upscaling of downscaling
> 
> It might seem complicated, but user action is limited to selecting 
> screen size or ratio once, and selecting the proper image ratio, if the 
> programme doesn't include it. That's something I always do on my TV (but 
> softdevice will do this much better, not loosing resolution).
> 

-- 
NH


From nhuillard at e-dition.fr  Thu May 12 11:44:40 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 12 May 2005 11:44:40 +0200
Subject: [Softdevice-devel] Success report: VIA EPIA ME6000 & VDR & Streamdev
 & DirectFB & DFB++
In-Reply-To: <427CCF99.4030104@deltabbs.org>
References: <427CCF99.4030104@deltabbs.org>
Message-ID: <42832588.3040808@e-dition.fr>

Steve Brown a ?crit :
> Guys,
> 
> I'd like to report my success with softdevice on my Eden powered ME6000 
> mini-itx mainboard built on Debian.

Great ! I knew it would work on that platform !

> The ME6000 is a 600MHz VIA Eden powered mainboard with CLE266 chipset. I 
> was really interested to get the accellerated MPEG decoder going, 
> because with a 600MHz processor I really didn't think it was going to 
> work with a software decoder solution.

Since I use a Celeron 466 since a few years for software DVD decoding on 
Windows, it would have been bad if a new Eden 600 wasn't up to the task.

> and this is configured as a diskless (Actually, I'm using a 16MB flash 
> card to boot with the custom initrd image containing the USB WLAN driver 
> and then mounting root on NFS) client with a USB Wireless NIC.
> Yes, I like pain, and this setup produced plenty.

You now have a (potentially ?) totally silent setup. I think it is 
really worth the effort.

> DirectFB *does have* support for the MPEG decoder in the CLE266. It 
> seems support for that function is growing rapidly now the VIA drivers 
> are in the open.

I'm really interested in CLE266 HW decoding with softdevice. I was told 
that libavcodec would make use of the HW decoding stuff, and softdevice 
would use it natively : do you have news in this area ?

> Note that PP_LIBAVCODEC and MMX2 are _not_enabled, they require 
> instructions not available in the Eden processor.

Eden instruction set is different from C3/Nehemiah (kind of PII vs. PIII).

> Performance.
> On the whole, great. I'm using a 17inch LCD monitor for output. Sure, 
> the quality doesn't come close to that produced on my main VDR box with 
> FF DVB card and 32inch screen - if you look at the 17inch screen from 
> one foot away you can see some (not too significant) MPEG artifacts 
> inthe form of blockiness here and there - but from usual viewing 
> position it's great. This system is in my main bedroom at the end of th 
> bed.

I sometime have perf problems (1Ghz C3/Nehemiah) when openning the 
recording list (directory scan), while recording a show, and viewing 
something else. The recording misses some frames and have a few seconds gap.
You might not have this problems with your NFS mount.

> Thanks very much to everyone who developed or contributed to the 
> softdevice plugin, and the DirectFB project. Excellent work.

Thanks for your report.

-- 
NH


From M.Wache at gmx.net  Thu May 12 17:43:20 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 12 May 2005 17:43:20 +0200
Subject: [Softdevice-devel] Softplay : Bugs/features
In-Reply-To: <1366.1115820902@www15.gmx.net>
References: <1366.1115820902@www15.gmx.net>
Message-ID: <42837998.8050905@gmx.net>

Marius van den Beek wrote:
> Hi
> 
> I tried ffplay on the files that didn't play properly,
> and the files played just as they should, so I think
> it is a problem related to softdevice or softplay.
> I hope you can reproduce and fix that.
> Thank you
> 
> Marius
> 
I will have a look at this, but I'm currently quite busy, so It may take 
some time...

Martin


From M.Wache at gmx.net  Thu May 12 18:10:58 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 12 May 2005 18:10:58 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <4283217F.2000006@e-dition.fr>
References: <4276D592.5060809@e-dition.fr> <4283217F.2000006@e-dition.fr>
Message-ID: <42838012.8090801@gmx.net>

Nicolas Huillard wrote:
> I didn't have any reply/comments/etc.
> 
> Was I totally dreaming at 3:00 AM ?
> Is it unimplementable ?
No, it is not unimplementable but quite a lot of work. The problem with 
the aspect ratio handling / cropping is that is it handled differently 
for every video out method. So one will have to change quite a lot of 
files and check if everything is still working for fb-out, directFB, 
vidix and X11.
In my opinion the better way would be to try to unify as much as 
possible of the four video out methods (eg, copying of the frames, some 
the osd, cropping ...)  and leave only the parts which are really 
different for every video out method ( like the initialization, 
allocating of the frames and so on) in the different video out classes.
Obviously this is even more work, but after doing this it is much easier 
to implement your suggestions.
In fact I planned do this unification at some point in the future and 
then I will certainly refer to you suggestions when implementing the 
aspect ratio handling. But please don't expect this to happen too soon 
:-(, but maybe someone else volunteers to do this?

> Or is it simply just so clear and so well defined that everybody agrees 
> silently ? (I don't think the third option is the right one...)
I like it, the general idea is clear, and to me it makes sense. So the 
reason I didn't comment is a bit laziness and to the most part agreement :-)

Martin


From M.Wache at gmx.net  Thu May 12 18:20:22 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 12 May 2005 18:20:22 +0200
Subject: [Softdevice-devel] HDTV with the softdevice
Message-ID: <42838246.2000701@gmx.net>

Hi list,

some weeks ago Thomas Herrmann reported that with HDTV the softdevice 
keeps on interrupting the decoding. I worked together with Thomas on 
this issue and it has been resolved, the main reason has been a too 
small buffer in the softdevice. Unfortunatly I got distracted before 
finishing the patch for the softdevice (I have to clean up again and 
merge recent changes in the cvs), so the patch is not yet in the CVS.

Many thanks to Thomas for his help and the testing he did!

Martin


From nhuillard at e-dition.fr  Thu May 12 18:30:32 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 12 May 2005 18:30:32 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <42838012.8090801@gmx.net>
References: <4276D592.5060809@e-dition.fr> <4283217F.2000006@e-dition.fr> <42838012.8090801@gmx.net>
Message-ID: <428384A8.1050203@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
...
>> Or is it simply just so clear and so well defined that everybody 
>> agrees silently ? (I don't think the third option is the right one...)
> 
> I like it, the general idea is clear, and to me it makes sense. So the 
> reason I didn't comment is a bit laziness and to the most part agreement 
> :-)

Thanks for this report. I'll wait the time you need (I bet you will be 
the fastest to implement this)...
In the mean time, I'll just modify the order of the options in the 
plugin menu, to make raspect ratio handling a bit easier.

-- 
NH


From stefan at lucke.in-berlin.de  Thu May 12 22:21:46 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 12 May 2005 22:21:46 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <4283217F.2000006@e-dition.fr>
References: <4276D592.5060809@e-dition.fr> <4283217F.2000006@e-dition.fr>
Message-ID: <200505122221.46821.stefan@lucke.in-berlin.de>

On Donnerstag, 12. Mai 2005 11:27, Nicolas Huillard wrote:
> I didn't have any reply/comments/etc.
> 
> Was I totally dreaming at 3:00 AM ?
> Is it unimplementable ?
> Or is it simply just so clear and so well defined that everybody agrees 
> silently ? (I don't think the third option is the right one...)

Long mails require long responses. But I think I've not totally understood
which parts should be done. To me most of it is done, as long as
current hardware supports scaleing.

> 
> Nicolas Huillard a ?crit :
> > Hi,
> > 
> > After I have read and I hope understood what you all did describe, I can 
> > sum-up thing here :
> > 
> > 1) option to set physical display size
> > * use choose from "16/9", "4/3", even "16/10", or so
> > * this is stored as a a decimal value : 1.777, 1.333, 1.6, etc.
> > * this may be stored as the physical H + V sizes of the screen (as X does)
> > * this option is selected once for all
> > * it is independent of the resolution of the screen : think about 16/9 
> > display at 800x600, or 16/10 at 1400x1050, or the new plasmas 16/9 at 
> > 1024x1024
> > * maybe this option is already present in the standard config / DVB card 
> > / video format option (from VDR's MANUAL : "Video format = 4:3     The 
> > video format (or aspect ratio) of the tv set in use (4:3 or 16:9)"
> > * display ratio, and display resolution can be used together to 
> > calculate the pixel aspect ratio : 800/600 / (16/9) = 0.75 ; 1280/768 / 
> > (16/9) = 0.9375 ; 720/576 / (4/3) = 0.9375 ; etc.

Most of that is done. We have an option to select the output geometry.
- Monitor (with square pixels)
- TV 4:3 non square pixel.
- TV 16:9 non square pixel.
and some other. What is missing is an arbitray user selectable ratio.

> > 
> > 2) auto-detection of aspect ratio
> > * the WSS bit can be set by the broadcaster to set the aspect ratio to 
> > 16/9 (I think the only time I saw it was with Arte on analog broadcast, 
> > because the TV switches to the full-frame display automagically)
> > * other auto-detect features can be used, to set wether the frame is 
> > meant to be viewed as 16/9 or 4/3 (or something else)
> > * if no detection is done (I don't expect anything here in France), the 
> > frame ratio will probably be advertised as 4/3
> > * this is something the user has no impact on

I see here no TODO.

> > 
> > 3) user-set programme aspect ratio
> > * the user may choose not to trust the broadcaster advertised aspect 
> > ratio (I won't)
> > * the user selects the actual image ratio inside the frame : 4/3, 16/9, 
> > 1.85, 2.35, etc.
> > * the special value "trust the broadcaster" is simply the fact that the 
> > image fills the entire frame, whatever the aspect ratio ("full-frame")
> > * that would be the option the user changes most often : the one to 
> > match to a remote key

User can override broadcasters setting. for dfb and xv, which have
their own remotes, this can be mapped to a user key. This is
implemented, no TODO.

> > 
> > 4) match between frame ratio and programme ratio
> > * the match between frame ratio and image ratio is obvious : if the 
> > broadcaster says the frame is 4:3 but I see a 16/9 image, the image 
> > fills (4/3) / (16/9) = 0.75, leaving horizontal black bars ; if the 
> > broadcaster says the frame is 16/9 but I see vertical black bars, the 
> > image is in fact 4/3
> > * the calculations begin to be difficult for me ;-)
> > * this match is used to crop the image : strip black bars, the right 
> > thickness, at the right places

Thats to my opinion a variant of 3.): let the user say it's 4:3 or
16:9 or trust the broad caster. no TODO.

> > 
> > 5) scaling between the frame/image ratio and the screen
> > * once the image is cropped by the match between the frame and the 
> > image, it can be scaled to the screen
> > * scaling uses the calculated image size and the actual screen size
> > * it also uses the screen aspect ratio, in another crop stage : fitting 
> > a 4/3 image in a 16/9 screen, or a 16/9 image in a 4/3 screen, can be 
> > done by upscaling of downscaling

Also a variant of 3.) . We can map a 4:3 image with cropping to a 16:9
screen without black boardes. No TODO.

What could be done is: let the user select/define a zoom region
of the current video (show F1 split screen advertising/race as
zoomed race only :-) ).

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Fri May 13 02:09:36 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 13 May 2005 02:09:36 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <200505122221.46821.stefan@lucke.in-berlin.de>
References: <4276D592.5060809@e-dition.fr> <4283217F.2000006@e-dition.fr> <200505122221.46821.stefan@lucke.in-berlin.de>
Message-ID: <4283F040.3030307@e-dition.fr>

Stefan Lucke a ?crit :
> On Donnerstag, 12. Mai 2005 11:27, Nicolas Huillard wrote:
> 
>>I didn't have any reply/comments/etc.
>>
>>Was I totally dreaming at 3:00 AM ?
>>Is it unimplementable ?
>>Or is it simply just so clear and so well defined that everybody agrees 
>>silently ? (I don't think the third option is the right one...)
> 
> Long mails require long responses. But I think I've not totally understood
> which parts should be done. To me most of it is done, as long as
> current hardware supports scaleing.

Thanks for your answer.
First of all : I referred to 0.1.1 (and still refers to it, until I 
update). You maybe already did something, so please forgive me if I 
didn't see it yet.
Next : I don't really know what have to be modified. This was just a 
first-try full-spec.

>>Nicolas Huillard a ?crit :
>>
>>>Hi,
>>>
>>>After I have read and I hope understood what you all did describe, I can 
>>>sum-up thing here :
>>>
>>>1) option to set physical display size
>>>* use choose from "16/9", "4/3", even "16/10", or so
>>>* this is stored as a a decimal value : 1.777, 1.333, 1.6, etc.
>>>* this may be stored as the physical H + V sizes of the screen (as X does)
>>>* this option is selected once for all
>>>* it is independent of the resolution of the screen : think about 16/9 
>>>display at 800x600, or 16/10 at 1400x1050, or the new plasmas 16/9 at 
>>>1024x1024
>>>* maybe this option is already present in the standard config / DVB card 
>>>/ video format option (from VDR's MANUAL : "Video format = 4:3     The 
>>>video format (or aspect ratio) of the tv set in use (4:3 or 16:9)"
>>>* display ratio, and display resolution can be used together to 
>>>calculate the pixel aspect ratio : 800/600 / (16/9) = 0.75 ; 1280/768 / 
>>>(16/9) = 0.9375 ; 720/576 / (4/3) = 0.9375 ; etc.
> 
> Most of that is done. We have an option to select the output geometry.
> - Monitor (with square pixels)
> - TV 4:3 non square pixel.
> - TV 16:9 non square pixel.
> and some other. What is missing is an arbitray user selectable ratio.

That's it.
TV aspect ratio in 0.1.1 is in fact resolution selection. Thus selecting 
TV 16:9 with a 800x600 mode does not yield the same result as selecting 
the same with a 720x576 mode.
But the TV didn't change, and it's ratio didn't change. Think about a 
16:9 plasma with a native 1024x1024 grid. It's still 16:9, and the 
output should be the same.
That change might be easy.

>>>2) auto-detection of aspect ratio
>>>* the WSS bit can be set by the broadcaster to set the aspect ratio to 
>>>16/9 (I think the only time I saw it was with Arte on analog broadcast, 
>>>because the TV switches to the full-frame display automagically)
>>>* other auto-detect features can be used, to set wether the frame is 
>>>meant to be viewed as 16/9 or 4/3 (or something else)
>>>* if no detection is done (I don't expect anything here in France), the 
>>>frame ratio will probably be advertised as 4/3
>>>* this is something the user has no impact on
> 
> I see here no TODO.

I can't really say. I think I didn't ever see actual auto-detection, 
since everything is broadcast the same (bad) way in France.
That one is really for completeness.

>>>3) user-set programme aspect ratio
>>>* the user may choose not to trust the broadcaster advertised aspect 
>>>ratio (I won't)
>>>* the user selects the actual image ratio inside the frame : 4/3, 16/9, 
>>>1.85, 2.35, etc.
>>>* the special value "trust the broadcaster" is simply the fact that the 
>>>image fills the entire frame, whatever the aspect ratio ("full-frame")
>>>* that would be the option the user changes most often : the one to 
>>>match to a remote key
> 
> User can override broadcasters setting. for dfb and xv, which have
> their own remotes, this can be mapped to a user key. This is
> implemented, no TODO.

I'll check that in CVS.

>>>4) match between frame ratio and programme ratio
>>>* the match between frame ratio and image ratio is obvious : if the 
>>>broadcaster says the frame is 4:3 but I see a 16/9 image, the image 
>>>fills (4/3) / (16/9) = 0.75, leaving horizontal black bars ; if the 
>>>broadcaster says the frame is 16/9 but I see vertical black bars, the 
>>>image is in fact 4/3
>>>* the calculations begin to be difficult for me ;-)
>>>* this match is used to crop the image : strip black bars, the right 
>>>thickness, at the right places
> 
> Thats to my opinion a variant of 3.): let the user say it's 4:3 or
> 16:9 or trust the broad caster. no TODO.

This is not a variant, just the consequence of the previous : select the 
show aspect ratio (2 or 3), then fit the show in the screen (4). Maybe 
my explanation is a bit too separated in steps.
2 or 3 is a way to add aspect ratio information to the show (automatic 
vs. manual). 4 does the calculation.

>>>5) scaling between the frame/image ratio and the screen
>>>* once the image is cropped by the match between the frame and the 
>>>image, it can be scaled to the screen
>>>* scaling uses the calculated image size and the actual screen size
>>>* it also uses the screen aspect ratio, in another crop stage : fitting 
>>>a 4/3 image in a 16/9 screen, or a 16/9 image in a 4/3 screen, can be 
>>>done by upscaling of downscaling
> 
> Also a variant of 3.) . We can map a 4:3 image with cropping to a 16:9
> screen without black boardes. No TODO.

Same answer : my explanation was a bit too stepped.

To summarize :
1) select the screen ratio once (not screen resolution, just ratio)
2, 3) select the show ratio (automatic vs. user-selected, preferably 
using the remote)
4) eliminate black bars by cropping, based on 1 and 2-3
5) scale to satisfy the once-set user preferences (loose parts of the 
image by zooming-in, or scale to fit the whole screen, or don't destroy 
aspect ratio or image size by adding black bars)

It's a bit late : I'll draw ASCII art another day...

> What could be done is: let the user select/define a zoom region
> of the current video (show F1 split screen advertising/race as
> zoomed race only :-) ).

Don't go too far. I already have problems with my wife when I toggle 
between the 4 zoom modes of the TV to find the right one... so selecting 
a screen region with the remote before zooming would be a bit to much 
for her patience...

-- 
NH


From jarppa81 at luukku.com  Fri May 13 10:28:22 2005
From: jarppa81 at luukku.com (Jari H)
Date: Fri, 13 May 2005 11:28:22 +0300 (EEST)
Subject: [Softdevice-devel] Aspect ratio : my proposal
Message-ID: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com>

I spoke with Stefan Lucke at begining of april conserning about aspect ratio. My proposal was:

>
> Proposal for aspect ratios:
> 4:3 Pan&scan
> 4:3 letterbox
> 16:9 letterbox
> 16:9 pan&scan
> 16:9 full ( no scaling )
> HQ scaling= maybe we could add some advanced(better that graphics gard)
> scaling methods for scaling to lcd/plasmas native resolution. There could be
> sinc and lanzos as methods and adjustment for resolution. And option for
> pan&scan and letterbox.

In other words,
In menu should be options:

Monitor Aspect:  4:3, 16:9, HQ
View mode: Letterbox, Pan&scan, Full
-------------------
HQ scaling method: Hardware, Sinc, Lanzos, ...
HQ scaling X: 640 -> 1600
HQ scaling Y: 400 -> 1200


"Monitor Aspect" would decide desired aspect. And "View mode"   how to implement aspect ratio. 
Letterbox; adds black bars if videos aspect is different than monitors aspect
Pan&Scan; cuts picture if videos aspect is different than monitors aspect
Full; If somebody wants or not, to correct aspect via tv remote control
These View mode options would be nice to be controlled via softdevice remote.

Information about "hq scaling":
http://htpcnews.com/main.php?id=ffdshowdvd_1

I think my proposal could be hard to implement right. But I think too that current aspect ratio controlling is quite poor :(

btw. I think that aspect ratio wont always work right with dvd-plugin. And should ac3 passtrough work? My wont :(

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From nhuillard at e-dition.fr  Fri May 13 12:29:37 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 13 May 2005 12:29:37 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com>
Message-ID: <42848191.7010405@e-dition.fr>

Jari H a ?crit :
> I spoke with Stefan Lucke at begining of april conserning about aspect ratio. My proposal was:
> 
> 
>>Proposal for aspect ratios:
>>4:3 Pan&scan
>>4:3 letterbox
>>16:9 letterbox
>>16:9 pan&scan
>>16:9 full ( no scaling )
>>HQ scaling= maybe we could add some advanced(better that graphics gard)
>>scaling methods for scaling to lcd/plasmas native resolution. There could be
>>sinc and lanzos as methods and adjustment for resolution. And option for
>>pan&scan and letterbox.
> 
> In other words,
> In menu should be options:
> 
> Monitor Aspect:  4:3, 16:9, HQ

"HQ" is not a monitor aspect ratio. It is best described as a 
resolution. But softdevice already knows the actual frame-buffer 
resolution : no use for the user to set this.
I think part of the problem with current 0.1.1 softdevice ratio handling 
is that actual aspect ratio is confused with actual screen resolution. 
Many screen have no standard pixel aspect (like 1024x1024 plasma at a 
16:9 aspect ratio, ie. pixels are really wide)

> View mode: Letterbox, Pan&scan, Full

In a perfect world, those simple setup would work automagically... if 
the broadcaster provides correct streams and information.
In my world (in France), a channel apparently always send the same video 
format, but add various black bars on various sides to fit the image in, 
taking for granted that everyone has the same old 4:3 TV set... To make 
things worse, each channel decides what it take for granted (some even 
broadcast a tiny image surrounded with black bars on every four sides, 
with the logo on the channel outside the movie).

I'll try to summarize my common cases with actual examples in a future 
thread.

> -------------------
> HQ scaling method: Hardware, Sinc, Lanzos, ...
> HQ scaling X: 640 -> 1600
> HQ scaling Y: 400 -> 1200
> 
> "Monitor Aspect" would decide desired aspect. And "View mode"   how to implement aspect ratio. 
> Letterbox; adds black bars if videos aspect is different than monitors aspect
> Pan&Scan; cuts picture if videos aspect is different than monitors aspect
> Full; If somebody wants or not, to correct aspect via tv remote control
> These View mode options would be nice to be controlled via softdevice remote.

I think we agree, but the words are different, and sample cases might be 
different in our minds too.

> Information about "hq scaling":
> http://htpcnews.com/main.php?id=ffdshowdvd_1

Interesting.
I already experienced DVB recording viewed in Xine with a nVidia FX5200 
hardware accelerated, displayed on a 17" CRT at 1600x1200 : that really 
is astounding, compared to the crap TV technology we still all have.

> I think my proposal could be hard to implement right. But I think too that current aspect ratio controlling is quite poor :(

Agreed.

> btw. I think that aspect ratio wont always work right with dvd-plugin. And should ac3 passtrough work? My wont :(

Stefan is working on AC/3. He'll make it work at it's best sooner or later.

-- 
NH


From stefan at lucke.in-berlin.de  Sat May 14 08:54:48 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 14 May 2005 08:54:48 +0200
Subject: [Softdevice-devel] Repeatable crash
In-Reply-To: <200505112151.05330.stefan@lucke.in-berlin.de>
References: <200505112151.05330.stefan@lucke.in-berlin.de>
Message-ID: <200505140854.48485.stefan@lucke.in-berlin.de>

On Mittwoch, 11. Mai 2005 21:51, Stefan Lucke wrote:
> On Montag, 9. Mai 2005 22:47, Stefan Lucke wrote:
> > On Mittwoch, 27. April 2005 21:13, Stefan Lucke wrote:
> > > On Mittwoch, 27. April 2005 20:38, Marko M?kel? wrote:
> > > > On Wed, Apr 27, 2005 at 09:39:26AM +0200, Stefan Lucke wrote:
> > > > > http://mplayerhq.hu/pipermail/ffmpeg-devel/2005-April/000027.html
> > > > > 
> > > > > You may try that with vdr running for gdb too.
> > > > 
> > > > I got a nice crash in libavcodec:
> > > 
> > > Some similar crash here. And that is suprising, as my ffmpeg has
> > > a private fix for my samples when ffmpegs crashes at 4:3 -> 16:9
> > > switch. Your stream has _no_ such switch and when reverting
> > > ffmpeg change of file mpeg12.c from 2004-04-03 (rev 1.227 -> 1.228)
> > > the segfault has gone.
> > 
> > That is wrong: this stream has a 4:3 -> 16:9 switch. I backed out
> > above mentioned mpeg12.c change and replaced it with my
> > proposted (and rejected change) 
> > see: http://article.gmane.org/gmane.comp.video.ffmpeg.devel/20933  .
> > 
> > and the result is a playback without crash and a correct
> > displayed aspect ratio change.
> 
> Hm, softplay can play this one with corrrect aspect switch. But there are
> some troubles with sync. I changed softdevice to use av_read_frame()
> (with av_dup_packet()), and Marko's stream is playable too (got the
> same sync problems). 

In between I got a crash even in softplay and randomly some great
disortions at aspect switch. I'm of the opinion that the real cause
is in ffmpegs code, but it is hard to convince them.

Can you try attached diff. 


-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: crash-03.diff
Type: text/x-diff
Size: 711 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050514/aa1d96cc/attachment.diff>

From stefan at lucke.in-berlin.de  Sat May 14 18:14:55 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 14 May 2005 18:14:55 +0200
Subject: [Softdevice-devel] Repeatable crash (SOLVED !!)
In-Reply-To: <200505140854.48485.stefan@lucke.in-berlin.de>
References: <200505112151.05330.stefan@lucke.in-berlin.de> <200505140854.48485.stefan@lucke.in-berlin.de>
Message-ID: <200505141814.55497.stefan@lucke.in-berlin.de>

On Samstag, 14. Mai 2005 08:54, Stefan Lucke wrote:
> On Mittwoch, 11. Mai 2005 21:51, Stefan Lucke wrote:
> 
> In between I got a crash even in softplay and randomly some great
> disortions at aspect switch. I'm of the opinion that the real cause
> is in ffmpegs code, but it is hard to convince them.
> 
> Can you try attached diff. 

Forget the patch. A fix for this is now in ffmpeg's cvs.

-- 
Stefan Lucke



From marko.makela at hut.fi  Sat May 14 21:48:50 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 14 May 2005 22:48:50 +0300
Subject: [Softdevice-devel] Repeatable crash (SOLVED, VERIFIED !!)
In-Reply-To: <200505141814.55497.stefan@lucke.in-berlin.de>
References: <200505112151.05330.stefan@lucke.in-berlin.de> <200505140854.48485.stefan@lucke.in-berlin.de> <200505141814.55497.stefan@lucke.in-berlin.de>
Message-ID: <20050514194850.GA446593@kosh.hut.fi>

Stefan,

On Sat, May 14, 2005 at 06:14:55PM +0200, Stefan Lucke wrote:
> On Samstag, 14. Mai 2005 08:54, Stefan Lucke wrote:
> > On Mittwoch, 11. Mai 2005 21:51, Stefan Lucke wrote:
> > 
> > In between I got a crash even in softplay and randomly some great
> > disortions at aspect switch. I'm of the opinion that the real cause
> > is in ffmpegs code, but it is hard to convince them.
> > 
> > Can you try attached diff. 
> 
> Forget the patch. A fix for this is now in ffmpeg's cvs.

Great, thanks! Now the clip with the fatal 4:3->16:9 switch plays nicely.
I got another 4:3->16:9 crash this morning, but it was on a live stream that
was not being recorded, so I can't test that one.

Do you have any opinion or educated guess how good the fix in ffmpeg's cvs
is?  Does it fix this problem once and for all, or is it just a kludge?

	Marko


From marko.makela at hut.fi  Sat May 14 21:59:51 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 14 May 2005 22:59:51 +0300
Subject: [Softdevice-devel] Slow motion, fast forward/rewind and sound
Message-ID: <20050514195951.GB446593@kosh.hut.fi>

I remember getting a crash some weeks ago when playing with the slow motion,
pause and fast forward/rewind keys in rapid succession.  I might have got
that kind of a crash last week when I was viewing something in slow motion.
It was a 4:3 program, no subtitles, most likely with mono sound (unless
DVB-T is always stereo).  Could there be some buffer overflow?

If I remember correctly, the audio will take a while to catch up after
restoring normal playback speed.  I guess this could also be because the
audio packets are being sent a few frames earlier than the corresponding
video frames.

A crazy idea: Would it be possible to play the audio also in fast-forward
mode?  If possible, offer two options: (a) decode and play every nth audio
frame, producing a chopping sound, or (b) decode everything and play every
nth sample, producing a high-pitched sound.  This would be useful when
watching slow-paced programs that lack subtitles.

This is definitely not a top priority thing, but it would most probably
differentiate softdevice from all full-featured cards and proprietary
recorders.  If you feel like it, implement these also for slow motion
and rewind, but not for the 1-minute skip. :-) Pitch correction could be
optional.

The credit for this idea goes to a friend of mine who was struggling with
math exams about 10 years ago.  The lectures were broadcast on campus TV,
and he had recorded them on his VCR.  When I visited him in the evening
before the exam, he was wondering whether he should modify his VCR to not
mute the sound during fast forward.  There was not enough time before the
exam to watch all the lectures at normal speed.

	Marko


From stefan at lucke.in-berlin.de  Sat May 14 22:55:09 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 14 May 2005 22:55:09 +0200
Subject: [Softdevice-devel] Repeatable crash (SOLVED, VERIFIED !!)
In-Reply-To: <20050514194850.GA446593@kosh.hut.fi>
References: <200505112151.05330.stefan@lucke.in-berlin.de> <200505141814.55497.stefan@lucke.in-berlin.de> <20050514194850.GA446593@kosh.hut.fi>
Message-ID: <200505142255.09085.stefan@lucke.in-berlin.de>

On Samstag, 14. Mai 2005 21:48, Marko M?kel? wrote:
> Stefan,
> 
> On Sat, May 14, 2005 at 06:14:55PM +0200, Stefan Lucke wrote:
> > On Samstag, 14. Mai 2005 08:54, Stefan Lucke wrote:
> > > On Mittwoch, 11. Mai 2005 21:51, Stefan Lucke wrote:
> > > 
> > > In between I got a crash even in softplay and randomly some great
> > > disortions at aspect switch. I'm of the opinion that the real cause
> > > is in ffmpegs code, but it is hard to convince them.
> > > 
> > > Can you try attached diff. 
> > 
> > Forget the patch. A fix for this is now in ffmpeg's cvs.
> 
> Great, thanks! Now the clip with the fatal 4:3->16:9 switch plays nicely.
> I got another 4:3->16:9 crash this morning, but it was on a live stream that
> was not being recorded, so I can't test that one.
> 
> Do you have any opinion or educated guess how good the fix in ffmpeg's cvs
> is?  Does it fix this problem once and for all, or is it just a kludge?

My opinion is that it really _fixes_ the problem, as the errounuosly freed
parse buffer to which other functions still hold pointers, is not freed
anymore when stream info changes.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sat May 14 23:24:08 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 14 May 2005 23:24:08 +0200
Subject: [Softdevice-devel] Repeatable crash (SOLVED, VERIFIED !!)
In-Reply-To: <200505142255.09085.stefan@lucke.in-berlin.de>
References: <200505112151.05330.stefan@lucke.in-berlin.de> <20050514194850.GA446593@kosh.hut.fi> <200505142255.09085.stefan@lucke.in-berlin.de>
Message-ID: <200505142324.08963.stefan@lucke.in-berlin.de>

On Samstag, 14. Mai 2005 22:55, Stefan Lucke wrote:
> On Samstag, 14. Mai 2005 21:48, Marko M?kel? wrote:
> > Stefan,
> > 
> > On Sat, May 14, 2005 at 06:14:55PM +0200, Stefan Lucke wrote:
> > > On Samstag, 14. Mai 2005 08:54, Stefan Lucke wrote:
> > > > On Mittwoch, 11. Mai 2005 21:51, Stefan Lucke wrote:
> > > > 
> > > > In between I got a crash even in softplay and randomly some great
> > > > disortions at aspect switch. I'm of the opinion that the real cause
> > > > is in ffmpegs code, but it is hard to convince them.
> > > > 
> > > > Can you try attached diff. 
> > > 
> > > Forget the patch. A fix for this is now in ffmpeg's cvs.
> > 
> > Great, thanks! Now the clip with the fatal 4:3->16:9 switch plays nicely.
> > I got another 4:3->16:9 crash this morning, but it was on a live stream that
> > was not being recorded, so I can't test that one.
> > 
> > Do you have any opinion or educated guess how good the fix in ffmpeg's cvs
> > is?  Does it fix this problem once and for all, or is it just a kludge?
> 
> My opinion is that it really _fixes_ the problem, as the errounuosly freed
> parse buffer to which other functions still hold pointers, is not freed
> anymore when stream info changes.

And it will fix even more crashes. Think of bad signal quality when
width or high are decoded wrong. This would previously cause freeing
of parse buffers too.

-- 
Stefan Lucke



From marko.makela at hut.fi  Sun May 15 10:55:08 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 15 May 2005 11:55:08 +0300
Subject: [Softdevice-devel] Repeatable crash (SOLVED, VERIFIED !!)
In-Reply-To: <200505142324.08963.stefan@lucke.in-berlin.de>
References: <200505112151.05330.stefan@lucke.in-berlin.de> <20050514194850.GA446593@kosh.hut.fi> <200505142255.09085.stefan@lucke.in-berlin.de> <200505142324.08963.stefan@lucke.in-berlin.de>
Message-ID: <20050515085508.GC417715@kosh.hut.fi>

On Sat, May 14, 2005 at 11:24:08PM +0200, Stefan Lucke wrote:
> > > Do you have any opinion or educated guess how good the fix in ffmpeg's cvs
> > > is?  Does it fix this problem once and for all, or is it just a kludge?
> > 
> > My opinion is that it really _fixes_ the problem, as the errounuosly freed
> > parse buffer to which other functions still hold pointers, is not freed
> > anymore when stream info changes.
> 
> And it will fix even more crashes. Think of bad signal quality when
> width or high are decoded wrong. This would previously cause freeing
> of parse buffers too.

How are memory leaks prevented?  Does it make use of some memory allocation
pool?  If there is some function to clean up the pool?  If yes, how often is
it called by softdevice?

	Marko


From marko.makela at hut.fi  Sun May 15 11:34:47 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 15 May 2005 12:34:47 +0300
Subject: [Softdevice-devel] Got SIGABRT when powering down near the end of clip
Message-ID: <20050515093447.GD417715@kosh.hut.fi>

This morning, with yesterday's CVS of softdevice and ffmpeg, vdr 1.3.24
crashed with signal 6 when I hit the Power key near the end of a previously
recorded clip that was being played back.  Normally, it would display the
"press any key to cancel" message, but vdr just crashed at that point
with signal 6 (SIGABRT).  I tried to repeat it, but the timing window appears
to be very narrow.  This smells like an assertion failure.  However, there
wasn't any assertion failure message in the VDR log.

	Marko


From moritzbeller at gmx.de  Sun May 15 19:16:39 2005
From: moritzbeller at gmx.de (Moritz Beller)
Date: Sun, 15 May 2005 19:16:39 +0200
Subject: [Softdevice-devel] Can't start softdevice from other directories than $SOURCEDIR
Message-ID: <20050515191639.62337b29@augustus>

Hello,

I can only start softdevice from within the $SOURCEDIRECTORY! 

Given I'm not in, no error message or anything occurs, it just doesn't
show the TV window and instead simply quits:

moritz at augustus / $ sudo vdr -Psoftdevice
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4718)
moritz at augustus / $ 

What could this be?

Moritz
--
(o_    web	http://www.4momo.de
//\    mail 	momo at 4momo dot de
V_/_   gpg	http://gpg.notlong.com


From momo.beller at t-online.de  Sun May 15 19:16:22 2005
From: momo.beller at t-online.de (Moritz Beller)
Date: Sun, 15 May 2005 19:16:22 +0200
Subject: [Softdevice-devel] Can't start softdevice from other directories than $SOURCEDIR
Message-ID: <20050515191622.17fbfc1f@augustus>

Hello,

I can only start softdevice from within the $SOURCEDIRECTORY! 

Given I'm not in, no error message or anything occurs, it just doesn't
show the TV window and instead simply quits:

moritz at augustus / $ sudo vdr -Psoftdevice
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4718)
moritz at augustus / $ 

What could this be?

Moritz
--
(o_    web	http://www.4momo.de
//\    mail 	momo at 4momo dot de
V_/_   gpg	http://gpg.notlong.com


From stefan at lucke.in-berlin.de  Sun May 15 20:33:42 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 15 May 2005 20:33:42 +0200
Subject: [Softdevice-devel] Can't start softdevice from other directories than $SOURCEDIR
In-Reply-To: <20050515191639.62337b29@augustus>
References: <20050515191639.62337b29@augustus>
Message-ID: <200505152033.42980.stefan@lucke.in-berlin.de>

On Sonntag, 15. Mai 2005 19:16, Moritz Beller wrote:
> Hello,
> 
> I can only start softdevice from within the $SOURCEDIRECTORY! 
> 
> Given I'm not in, no error message or anything occurs, it just doesn't
> show the TV window and instead simply quits:
> 
> moritz at augustus / $ sudo vdr -Psoftdevice
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice] initializing Plugin
> [softdevice] Initializing Video Out
> [softdevice] ffmpeg version(0.4.9-pre1) build(4718)
> moritz at augustus / $ 

What is written to /var/log/messages ?
Which output method(s) did you select at compile time ?
If you selected multiple methods, you'll have to specify the desired
one at runtime like: "./vdr -P 'softdevice -vo xv:'

-- 
Stefan Lucke



From torgeir at pobox.com  Sun May 15 21:00:35 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 15 May 2005 20:00:35 +0100
Subject: [Softdevice-devel] Can't start softdevice from other
	directories than $SOURCEDIR
In-Reply-To: <20050515191622.17fbfc1f@augustus>
References: <20050515191622.17fbfc1f@augustus>
Message-ID: <1116183635.3830.1.camel@africa>

On Sun, 2005-05-15 at 19:16 +0200, Moritz Beller wrote:
> 
> I can only start softdevice from within the $SOURCEDIRECTORY! 
> 
> Given I'm not in, no error message or anything occurs, it just doesn't
> show the TV window and instead simply quits:
> 
> moritz at augustus / $ sudo vdr -Psoftdevice
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice] initializing Plugin
> [softdevice] Initializing Video Out
> [softdevice] ffmpeg version(0.4.9-pre1) build(4718)

Check your syslog (enable debug output in syslog). Have you modified any
directory settings before compiling and installing vdr? Or do you maybe
have an old vdr version installed which might conflict?

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun May 15 22:45:31 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 15 May 2005 22:45:31 +0200
Subject: [Softdevice-devel] Got SIGABRT when powering down near the end of clip
In-Reply-To: <20050515093447.GD417715@kosh.hut.fi>
References: <20050515093447.GD417715@kosh.hut.fi>
Message-ID: <200505152245.31618.stefan@lucke.in-berlin.de>

On Sonntag, 15. Mai 2005 11:34, Marko M?kel? wrote:
> This morning, with yesterday's CVS of softdevice and ffmpeg, vdr 1.3.24
> crashed with signal 6 when I hit the Power key near the end of a previously
> recorded clip that was being played back.  Normally, it would display the
> "press any key to cancel" message, but vdr just crashed at that point
> with signal 6 (SIGABRT).  I tried to repeat it, but the timing window appears
> to be very narrow.  This smells like an assertion failure.  However, there
> wasn't any assertion failure message in the VDR log.

Can you show us the log messages at the time the SIGABRT happend ?

-- 
Stefan Lucke



From marko.makela at hut.fi  Sun May 15 22:52:33 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 15 May 2005 23:52:33 +0300
Subject: [Softdevice-devel] Got SIGABRT when powering down near the end of clip
In-Reply-To: <200505152245.31618.stefan@lucke.in-berlin.de>
References: <20050515093447.GD417715@kosh.hut.fi> <200505152245.31618.stefan@lucke.in-berlin.de>
Message-ID: <20050515205233.GE278279@kosh.hut.fi>

On Sun, May 15, 2005 at 10:45:31PM +0200, Stefan Lucke wrote:
> On Sonntag, 15. Mai 2005 11:34, Marko M?kel? wrote:
> > This morning, with yesterday's CVS of softdevice and ffmpeg, vdr 1.3.24
> > crashed with signal 6 when I hit the Power key near the end of a previously
> > recorded clip that was being played back.  Normally, it would display the
> > "press any key to cancel" message, but vdr just crashed at that point
> > with signal 6 (SIGABRT).  I tried to repeat it, but the timing window appears
> > to be very narrow.  This smells like an assertion failure.  However, there
> > wasn't any assertion failure message in the VDR log.
> 
> Can you show us the log messages at the time the SIGABRT happend ?

Sorry, no.  I stupidly removed the log file before attempting to reproduce
the crash, in order to get rid of output from earlier VDR usage.  My bad,
I didn't know that it's so hard to reproduce.  But it's not that hard either:
I've got crashes at powerdown earlier.  Next time, I'll be sure to preserve
the log file.

	Marko


From stefan at lucke.in-berlin.de  Mon May 16 19:57:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 16 May 2005 19:57:05 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal (WAS: [Softdevice-cvs] softdevice video-dfb.c,1.25,1.26 ..)
In-Reply-To: <200505161553.j4GFrFm00739@bat.berlios.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de>
Message-ID: <200505161957.05832.stefan@lucke.in-berlin.de>

On Montag, 16. Mai 2005 17:53, wachm wrote:
> Update of /cvsroot/softdevice/softdevice
> In directory sheep:/tmp/cvs-serv29824
> 
> Modified Files:
> 	video-dfb.c video-vidix.c video-xv.c video.c video.h 
> Log Message:
> - blank screen after some time with no signal

CHANGELOG entry is missing.

Can I deactivate this behaviour ?
I was just wondering why, when I use xv-out screen gets blanked when
I'm watching a recording and enter pause. Now that's the same with
dfb-out. This happens within a few seconds.

With xv it is even stranger. Minimizing and restoring, brings back an
old picture with rendered old OSD.

-- 
Stefan Lucke



From M.Wache at gmx.net  Mon May 16 21:39:44 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 16 May 2005 21:39:44 +0200
Subject: [Softdevice-devel] softplay development
Message-ID: <4288F700.4030107@gmx.net>

Hi,

I just commited my latest changes to softplay. Playlist support is now 
almost finished, adding and removing files from playlists is possible 
during playback and I fixed most of the crashes. If you still experience 
crashes with softplay please report them.
I also updated the readme to the new user interface, I hope you like it.
Some features are still missing, and some are work in progress (like 
fast forward/backward...)

Martin


From M.Wache at gmx.net  Mon May 16 21:40:27 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 16 May 2005 21:40:27 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
 (WAS: [Softdevice-cvs] softdevice video-dfb.c,1.25,1.26 ..)
In-Reply-To: <200505161957.05832.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505161957.05832.stefan@lucke.in-berlin.de>
Message-ID: <4288F72B.7070103@gmx.net>

Stefan Lucke wrote:
> On Montag, 16. Mai 2005 17:53, wachm wrote:
> 
>>Update of /cvsroot/softdevice/softdevice
>>In directory sheep:/tmp/cvs-serv29824
>>
>>Modified Files:
>>	video-dfb.c video-vidix.c video-xv.c video.c video.h 
>>Log Message:
>>- blank screen after some time with no signal
> 
> 
> CHANGELOG entry is missing.
I just added it.
> 
> Can I deactivate this behaviour ?
Not yet. I guess because you ask you want to be able to deactivate it?
> I was just wondering why, when I use xv-out screen gets blanked when
> I'm watching a recording and enter pause. Now that's the same with
> dfb-out. This happens within a few seconds.
Good point I missed this, it should be like this. Up to now there is no 
way to distinguish between pause mode and no signal. I will change this.

> 
> With xv it is even stranger. Minimizing and restoring, brings back an
> old picture with rendered old OSD.
> 
That is strange, I never had this behavior. Is there any recipe to 
reproduce this? Is this with pseudo alpha or software alpha?

Martin


From stefan at lucke.in-berlin.de  Mon May 16 23:23:24 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 16 May 2005 23:23:24 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <4288F72B.7070103@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505161957.05832.stefan@lucke.in-berlin.de> <4288F72B.7070103@gmx.net>
Message-ID: <200505162323.24854.stefan@lucke.in-berlin.de>

On Montag, 16. Mai 2005 21:40, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Montag, 16. Mai 2005 17:53, wachm wrote:
> > 
> >>Update of /cvsroot/softdevice/softdevice
> >>In directory sheep:/tmp/cvs-serv29824
> >>
> >>Modified Files:
> >>	video-dfb.c video-vidix.c video-xv.c video.c video.h 
> >>Log Message:
> >>- blank screen after some time with no signal
> > 
> > 
> > CHANGELOG entry is missing.
> I just added it.
> > 
> > Can I deactivate this behaviour ?
> Not yet. I guess because you ask you want to be able to deactivate it?

Yes. In pause mode I want to look a bit more than 2 or 3 seconds at
the picture.

> > I was just wondering why, when I use xv-out screen gets blanked when
> > I'm watching a recording and enter pause. Now that's the same with
> > dfb-out. This happens within a few seconds.
> Good point I missed this, it should be like this. Up to now there is no 
> way to distinguish between pause mode and no signal. I will change this.

As that's a desired behaviour and not a bug as I original thought, we
should have a device method, so that each out-method can act on it's
own upon idle calls. When xv-out is started by commandline in fullscreen
mode, we deactivate the screensaver and any power save modes. Even
with dfb there could be done more than a simple black screen.

> 
> > 
> > With xv it is even stranger. Minimizing and restoring, brings back an
> > old picture with rendered old OSD.
> > 
> That is strange, I never had this behavior. Is there any recipe to 
> reproduce this? Is this with pseudo alpha or software alpha?

That is with software osd drawing. Hmm, that was with MP3 playback
don't know if softplay or mp3 plugin. But now I cannot not reproduce
that now neither with softplay nor with mp3.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon May 16 23:25:52 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 16 May 2005 23:25:52 +0200
Subject: [Softdevice-devel] softplay does not compile
Message-ID: <200505162325.52166.stefan@lucke.in-berlin.de>

Hi,

current cvs version doe not compile anymore. ffmpeg is at cvs from saturday.

make[1]: Entering directory `/home/nfs/extra/src/video/DVB/vdr-1.3.22.jarada/PLUGINS/src/softplay'
g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ softplay.c
softplay.c: In member function `virtual eOSState
   cMenuDirectory::ProcessKey(eKeys)':
softplay.c:183: Warnung: unused variable `cPlayListItem*Item'
g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ SoftPlayer.c
/usr/local/include/ffmpeg/avformat.h: In member function `virtual void
   cSoftPlayer::Action()':
/usr/local/include/ffmpeg/avformat.h:588: error: too few arguments to function
   `int av_seek_frame(AVFormatContext*, int, long long int, int)'
SoftPlayer.c:151: error: at this point in file
SoftPlayer.c:179: Warnung: comparison between signed and unsigned integer
   expressions
make[1]: *** [SoftPlayer.o] Fehler 1

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue May 17 00:03:51 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 17 May 2005 00:03:51 +0200
Subject: [Softdevice-devel] softplay does not compile
In-Reply-To: <200505162325.52166.stefan@lucke.in-berlin.de>
References: <200505162325.52166.stefan@lucke.in-berlin.de>
Message-ID: <200505170003.51634.stefan@lucke.in-berlin.de>

On Montag, 16. Mai 2005 23:25, Stefan Lucke wrote:
> Hi,
> 
> current cvs version doe not compile anymore. ffmpeg is at cvs from saturday.
> 
> make[1]: Entering directory `/home/nfs/extra/src/video/DVB/vdr-1.3.22.jarada/PLUGINS/src/softplay'
> g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ softplay.c
> softplay.c: In member function `virtual eOSState
>    cMenuDirectory::ProcessKey(eKeys)':
> softplay.c:183: Warnung: unused variable `cPlayListItem*Item'
> g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ SoftPlayer.c
> /usr/local/include/ffmpeg/avformat.h: In member function `virtual void
>    cSoftPlayer::Action()':
> /usr/local/include/ffmpeg/avformat.h:588: error: too few arguments to function
>    `int av_seek_frame(AVFormatContext*, int, long long int, int)'
> SoftPlayer.c:151: error: at this point in file
> SoftPlayer.c:179: Warnung: comparison between signed and unsigned integer
>    expressions
> make[1]: *** [SoftPlayer.o] Fehler 1

So you need to check for:
#if LIBAVFORMAT_BUILD >= 4619

for passing the 4th  parameter.


-- 
Stefan Lucke



From M.Wache at gmx.net  Tue May 17 00:21:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 17 May 2005 00:21:16 +0200
Subject: [Softdevice-devel] softplay does not compile
In-Reply-To: <200505162325.52166.stefan@lucke.in-berlin.de>
References: <200505162325.52166.stefan@lucke.in-berlin.de>
Message-ID: <42891CDC.9020800@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> current cvs version doe not compile anymore. ffmpeg is at cvs from saturday.
> 
> make[1]: Entering directory `/home/nfs/extra/src/video/DVB/vdr-1.3.22.jarada/PLUGINS/src/softplay'
> g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ softplay.c
> softplay.c: In member function `virtual eOSState
>    cMenuDirectory::ProcessKey(eKeys)':
> softplay.c:183: Warnung: unused variable `cPlayListItem*Item'
> g++ -O2 -Wall -Woverloaded-virtual -c -D_GNU_SOURCE -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/local/include/ffmpeg/ SoftPlayer.c
> /usr/local/include/ffmpeg/avformat.h: In member function `virtual void
>    cSoftPlayer::Action()':
> /usr/local/include/ffmpeg/avformat.h:588: error: too few arguments to function
>    `int av_seek_frame(AVFormatContext*, int, long long int, int)'
> SoftPlayer.c:151: error: at this point in file
> SoftPlayer.c:179: Warnung: comparison between signed and unsigned integer
>    expressions
> make[1]: *** [SoftPlayer.o] Fehler 1
> 
I fixed it in the cvs. Thanks for the report!

Martin


From M.Wache at gmx.net  Tue May 17 00:21:20 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 17 May 2005 00:21:20 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <200505162323.24854.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505161957.05832.stefan@lucke.in-berlin.de> <4288F72B.7070103@gmx.net> <200505162323.24854.stefan@lucke.in-berlin.de>
Message-ID: <42891CE0.2070500@gmx.net>

Stefan Lucke wrote:

>>>I was just wondering why, when I use xv-out screen gets blanked when
>>>I'm watching a recording and enter pause. Now that's the same with
>>>dfb-out. This happens within a few seconds.
>>
>>Good point I missed this, it should be like this. Up to now there is no 
>>way to distinguish between pause mode and no signal. I will change this.
> 
> 
> As that's a desired behaviour and not a bug as I original thought, we
> should have a device method, so that each out-method can act on it's
> own upon idle calls. When xv-out is started by commandline in fullscreen
> mode, we deactivate the screensaver and any power save modes. Even
> with dfb there could be done more than a simple black screen.
Sorry, I was in hurry when I wrote my previous e-mail. It's a bug, I 
just forgot to think about what happens in pause mode, so the way I 
implemented this now it's the expected behavior to blank the screen in 
pause mode. But I did not intend to have it like this and I will change 
it, it just need to make pause mode available to the video out class.

It would be nice to have a real power save mode for both xv and dfb-out, 
but there is also the case when softplay is playing audio only files. In 
this case a working OSD is quite important and I think a black screen is 
nicer than some old picture from the TV. Of course, in the long term I 
would like to have the ability to load background pictures from 
.jpg/.png :-).
So I think we should have both methods with adjustable timeouts, or the 
powersave mode triggered by suspending of the replay?

Martin


From torgeir at pobox.com  Tue May 17 00:27:48 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 16 May 2005 23:27:48 +0100
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <42891CE0.2070500@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de>
	 <200505161957.05832.stefan@lucke.in-berlin.de> <4288F72B.7070103@gmx.net>
	 <200505162323.24854.stefan@lucke.in-berlin.de>  <42891CE0.2070500@gmx.net>
Message-ID: <1116282468.3892.34.camel@africa>

On Tue, 2005-05-17 at 00:21 +0200, Martin Wache wrote:
> 
> It would be nice to have a real power save mode for both xv and
> dfb-out, 

For Xv output, we disable DPMS when in fullscreen mode. We can probably
add some logic which turns back on DPMS when idle, and re-enables the
screensaver (which is the correct way to handle screen blanking under
X11). 

All the code for Xv output is there, we just need to define the proper
policies. 

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Tue May 17 00:59:11 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 16 May 2005 23:59:11 +0100
Subject: [Softdevice-devel] hdtv buffer patch
Message-ID: <1116284351.3892.37.camel@africa>

Is this patch in CVS now? I'd like to see if it fixes my vdr recording
playback judder issues.

-- 
Torgeir Veimo <torgeir at pobox.com>




From nhuillard at e-dition.fr  Tue May 17 12:05:47 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 17 May 2005 12:05:47 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <42891CE0.2070500@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505161957.05832.stefan@lucke.in-berlin.de> <4288F72B.7070103@gmx.net> <200505162323.24854.stefan@lucke.in-berlin.de> <42891CE0.2070500@gmx.net>
Message-ID: <4289C1FB.7060102@e-dition.fr>

Martin Wache a ?crit :
> nicer than some old picture from the TV. Of course, in the long term I 
> would like to have the ability to load background pictures from 
> .jpg/.png :-).

Maybe it's time for me to add my grain of salt : what about showing some 
kind of goom (http://sourceforge.net/projects/goom/) output when playing 
audio but no video... I don't know if it's a feature of the softplay or 
the softdevice plugin (goom when playin OGG / goom when listening to radio).

-- 
NH


From M.Wache at gmx.net  Tue May 17 18:06:32 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 17 May 2005 18:06:32 +0200
Subject: [Softdevice-devel] hdtv buffer patch
In-Reply-To: <1116284351.3892.37.camel@africa>
References: <1116284351.3892.37.camel@africa>
Message-ID: <428A1688.3010205@gmx.net>

Torgeir Veimo wrote:
> Is this patch in CVS now? I'd like to see if it fixes my vdr recording
> playback judder issues.
> 
No, not yet. I'm currently mainly working on softplay and the changes I 
committed to the softdevice are mainly softplay related ;-).
I hope I find some time soon to merge the patch to the current CVS, 
unfortunatly I played around quite a bit and I have to sort out what 
parts of my patch are usefull and which are not.
What are your vdr recording playback judder issues like? I wasn't aware 
that you reported any problems with the playback, maybe I missed the 
e-mail...

Martin


From torgeir at pobox.com  Tue May 17 18:11:26 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 17 May 2005 17:11:26 +0100
Subject: [Softdevice-devel] hdtv buffer patch
In-Reply-To: <428A1688.3010205@gmx.net>
References: <1116284351.3892.37.camel@africa>  <428A1688.3010205@gmx.net>
Message-ID: <1116346287.3891.10.camel@africa>

On Tue, 2005-05-17 at 18:06 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> > Is this patch in CVS now? I'd like to see if it fixes my vdr recording
> > playback judder issues.
> > 
> No, not yet. I'm currently mainly working on softplay and the changes I 
> committed to the softdevice are mainly softplay related ;-).
> I hope I find some time soon to merge the patch to the current CVS, 
> unfortunatly I played around quite a bit and I have to sort out what 
> parts of my patch are usefull and which are not.
> What are your vdr recording playback judder issues like? I wasn't aware 
> that you reported any problems with the playback, maybe I missed the 
> e-mail...

I've had the problem for a while, even before softdevice started using
libavformat. It manifests itself as late frames for about 10 - 20 frames
every other second or so. It's only during playback of recorded content.
I can have three simultaneous recordings going on and watch live tv
without any problems.

It's a sata based setup, which might be a cause. And I also see tearing
sometimes when it happens, which might indicate it is related to an irq
handler hogging the cpu.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Tue May 17 18:12:46 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 17 May 2005 18:12:46 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <4289C1FB.7060102@e-dition.fr>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505161957.05832.stefan@lucke.in-berlin.de> <4288F72B.7070103@gmx.net> <200505162323.24854.stefan@lucke.in-berlin.de> <42891CE0.2070500@gmx.net> <4289C1FB.7060102@e-dition.fr>
Message-ID: <428A17FE.1060003@gmx.net>

Nicolas Huillard wrote:
> Martin Wache a ?crit :
> 
>> nicer than some old picture from the TV. Of course, in the long term I 
>> would like to have the ability to load background pictures from 
>> .jpg/.png :-).
> 
> 
> Maybe it's time for me to add my grain of salt : what about showing some 
> kind of goom (http://sourceforge.net/projects/goom/) output when playing 
> audio but no video... I don't know if it's a feature of the softplay or 
> the softdevice plugin (goom when playin OGG / goom when listening to 
> radio).
> 
Sure, that would be really nice. However I think this is far future 
stuff... There are certainly features which are more needed, and one 
would have to change quite a lot to get this feature.

Martin


From stefan at lucke.in-berlin.de  Wed May 18 08:31:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 18 May 2005 08:31:05 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <42891CE0.2070500@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505162323.24854.stefan@lucke.in-berlin.de> <42891CE0.2070500@gmx.net>
Message-ID: <200505180831.05934.stefan@lucke.in-berlin.de>

On Dienstag, 17. Mai 2005 00:21, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> >>>I was just wondering why, when I use xv-out screen gets blanked when
> >>>I'm watching a recording and enter pause. Now that's the same with
> >>>dfb-out. This happens within a few seconds.
> >>
> >>Good point I missed this, it should be like this. Up to now there is no 
> >>way to distinguish between pause mode and no signal. I will change this.
> > 
> > 
> > As that's a desired behaviour and not a bug as I original thought, we
> > should have a device method, so that each out-method can act on it's
> > own upon idle calls. When xv-out is started by commandline in fullscreen
> > mode, we deactivate the screensaver and any power save modes. Even
> > with dfb there could be done more than a simple black screen.
> Sorry, I was in hurry when I wrote my previous e-mail. It's a bug, I 
> just forgot to think about what happens in pause mode, so the way I 
> implemented this now it's the expected behavior to blank the screen in 
> pause mode. But I did not intend to have it like this and I will change 
> it, it just need to make pause mode available to the video out class.

With dfb-out it seems to be fixed, but with xv-out not. Screen gets
blanked immedeately and the pause osd symbol appears at a different
position than play osd symbol  (software psd alpha blending).


-- 
Stefan Lucke



From torgeir at pobox.com  Wed May 18 13:17:16 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 18 May 2005 12:17:16 +0100
Subject: [Softdevice-devel] Re: [Softdevice-cvs] softdevice mpeg2decoder.c,1.34,1.35
 mpeg2decoder.h,1.22,1.23 video.c,1.17,1.18 video.h,1.11,1.12
 CHANGELOG,1.65,1.66
In-Reply-To: <200505171958.j4HJw8m21515@bat.berlios.de>
References: <200505171958.j4HJw8m21515@bat.berlios.de>
Message-ID: <1116415036.3753.19.camel@africa>

On Tue, 2005-05-17 at 21:58 +0200, wachm wrote:
> Update of /cvsroot/softdevice/softdevice
> In directory sheep:/tmp/cvs-serv16886
> 
> Modified Files:
> 	mpeg2decoder.c mpeg2decoder.h video.c video.h CHANGELOG 


> +     inline void FreezeMode(bool freeze)
> +     {freezeMode=freeze;};

Shouldn't this be virtual, so that I can override and take appropriate
action in video-xv.c? 

On freeze, DPMS and the screensaver should be reactivated for Xv output.
A blanking would then occur defined by the current X11 setup's blanking
timeout.

-- 
Torgeir Veimo <torgeir at pobox.com>



From nhuillard at e-dition.fr  Wed May 18 14:05:21 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 18 May 2005 14:05:21 +0200
Subject: [Softdevice-devel] softdevice debian package
Message-ID: <428B2F81.3090705@e-dition.fr>

Hello all,

After a short private mail exchange with Martin, I've uploaded my 
softdevice Debian package as-is on http://nicolas.huillard.net/vdr/debian/
It is in a "work for me" status... (EPIA, DirectFB, Debian sarge)
Build instructions attached.

TODO :
* add a softplay packaging
* clean-up dependencies
* contact the official VDR Debian team and provide my packages
* find a way to properly distribute them (the official VDR Debian being 
the obvious way)
* switch my VDR box to the Debian vdr-devel packages, in order to 
maintain proper packaging (I'm currently tracking Darren Salt's 
repository, reminiscent of my vdr-xine phase)

-- 
NH
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: notes-vdr-plugin-softdevice.txt
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050518/8f3697a1/attachment.txt>

From M.Wache at gmx.net  Wed May 18 18:13:40 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 18 May 2005 18:13:40 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <200505180831.05934.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505162323.24854.stefan@lucke.in-berlin.de> <42891CE0.2070500@gmx.net> <200505180831.05934.stefan@lucke.in-berlin.de>
Message-ID: <428B69B4.5080905@gmx.net>

Stefan Lucke wrote:

> With dfb-out it seems to be fixed, but with xv-out not. Screen gets
> blanked immedeately and the pause osd symbol appears at a different
> position than play osd symbol  (software psd alpha blending).
> 
> 
Hmm, that's a difficult one - the problem is on one side we want to have 
a fast responsive OSD, for this the screen has to be redrawn in software 
  alpha mode, but we havn't got the last frame any more...
I guess the only solution for this is to override libavcodec's get 
buffer/release buffer functions and always keep a pointer of the last 
frame. If we do that we can finally can also take screenshots with the 
softdevice.
I would like to postpone this change until I did the first release of 
softplay, which hopefully will be this weekend.

Martin


From M.Wache at gmx.net  Wed May 18 18:20:04 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 18 May 2005 18:20:04 +0200
Subject: [Softdevice-devel] Re: [Softdevice-cvs] softdevice mpeg2decoder.c,1.34,1.35
 mpeg2decoder.h,1.22,1.23 video.c,1.17,1.18 video.h,1.11,1.12 CHANGELOG,1.65,1.66
In-Reply-To: <1116415036.3753.19.camel@africa>
References: <200505171958.j4HJw8m21515@bat.berlios.de> <1116415036.3753.19.camel@africa>
Message-ID: <428B6B34.3030904@gmx.net>

Torgeir Veimo wrote:
> On Tue, 2005-05-17 at 21:58 +0200, wachm wrote:
> 
>>Update of /cvsroot/softdevice/softdevice
>>In directory sheep:/tmp/cvs-serv16886
>>
>>Modified Files:
>>	mpeg2decoder.c mpeg2decoder.h video.c video.h CHANGELOG 
> 
> 
> 
>>+     inline void FreezeMode(bool freeze)
>>+     {freezeMode=freeze;};
> 
> 
> Shouldn't this be virtual, so that I can override and take appropriate
> action in video-xv.c? 
Sorry, the documantation is completly missing. This function is only 
used to tell the video out that the softdevice switched to pause mode 
(freeze mode) or to play mode.

> 
> On freeze, DPMS and the screensaver should be reactivated for Xv output.
> A blanking would then occur defined by the current X11 setup's blanking
> timeout.
> 
I would like to suggest to use the Suspend()/Resume() functions for 
entering /leaving powersave mode. They are already called on 
suspend/resume of the playback for releasing/grabbing the xv-port and I 
think it makes sense to reenable DPMS and the screensaver on supending 
of the playback. Maybe we can even go further and enter a powersave mode 
on suspend of the playback?

Martin


From M.Wache at gmx.net  Wed May 18 18:27:53 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 18 May 2005 18:27:53 +0200
Subject: [Softdevice-devel] hdtv buffer patch
In-Reply-To: <1116346287.3891.10.camel@africa>
References: <1116284351.3892.37.camel@africa>  <428A1688.3010205@gmx.net> <1116346287.3891.10.camel@africa>
Message-ID: <428B6D09.2090402@gmx.net>

Torgeir Veimo wrote:

> 
> I've had the problem for a while, even before softdevice started using
> libavformat. It manifests itself as late frames for about 10 - 20 frames
> every other second or so. It's only during playback of recorded content.
> I can have three simultaneous recordings going on and watch live tv
> without any problems.
Now since you mentioned it maybe I have something similar, every few 
seconds the motion of the picture seems to be halted for a tiny moment 
and then jumps. But I would say it's only one or two late frames for me.
How bad is it for you?

Martin


From stefan at lucke.in-berlin.de  Wed May 18 21:47:30 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 18 May 2005 21:47:30 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <428B69B4.5080905@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505180831.05934.stefan@lucke.in-berlin.de> <428B69B4.5080905@gmx.net>
Message-ID: <200505182147.30950.stefan@lucke.in-berlin.de>

On Mittwoch, 18. Mai 2005 18:13, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> > With dfb-out it seems to be fixed, but with xv-out not. Screen gets
> > blanked immedeately and the pause osd symbol appears at a different
> > position than play osd symbol  (software psd alpha blending).
> > 
> > 
> Hmm, that's a difficult one - the problem is on one side we want to have 
> a fast responsive OSD, for this the screen has to be redrawn in software 
>   alpha mode, but we havn't got the last frame any more...
> I guess the only solution for this is to override libavcodec's get 
> buffer/release buffer functions and always keep a pointer of the last 
> frame. If we do that we can finally can also take screenshots with the 
> softdevice.

Shouldn't that extra buffering be done by the output method, as that
kind of OSD mixing is already done within dfb.

> I would like to postpone this change until I did the first release of 
> softplay, which hopefully will be this weekend.

Here I see some troubles, as softplay needs a change in softdevice
for pause handling. So there should be a release of softdevice too.
Hm, release 0.1.1 shows a similar behaviour so fixing that
can be delayed.

So there should be only changes to softdevice, if there are impacts
of latest ffmpeg time effects on softplay which have to be handled
in softdevice too.

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Thu May 19 17:25:40 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 19 May 2005 17:25:40 +0200
Subject: [Softdevice-devel] Status of XvMC with ffmpeg in softdevice
Message-ID: <428CAFF4.1050301@e-dition.fr>

Hello,

We already talked about future XvMC support in softdevice.

The ffmpeg-devel talks about ffmpeg having XvMC support, in a 
output-device-independent manner.
I think the XvMC wrapper library is independent of the actual X code, 
and also the Unichrome XvMC driver.

Is it possible to once have HW MPEG2 decoding on CLE266 using softdevice 
on DirectFB, given this infrastructure ? I this code too tightly 
dependent on X, that it will only ever work on X ?

Is someone interested in having that in softdevice ?

(I don't talk about time or actual coding, just ideas. I am also trying 
to evaluate if I will ever need to get back X in my VDR box)

-- 
NH


From nhuillard at e-dition.fr  Thu May 19 17:29:48 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 19 May 2005 17:29:48 +0200
Subject: [Softdevice-devel] DFB++ vs. ++DFB (was private mail)
In-Reply-To: <428CAE54.9090009@gmx.net>
References: <428B0CBD.5040903@gmx.net> <428B1385.9000808@e-dition.fr> <428B1E7C.5020709@gmx.net> <428B2D5C.1080802@e-dition.fr> <428B4BA1.4050808@gmx.net> <428B513A.9050208@e-dition.fr> <428B7131.6060305@gmx.net> <428B768A.1090806@e-dition.fr> <428CAE54.9090009@gmx.net>
Message-ID: <428CB0EC.2080601@e-dition.fr>

Martin Wache a ?crit :
> Nicolas Huillard wrote:
> 
>> BTW : did you see the ++DFB on the DirectFB 
>> site ? It is said to be much better/cleaner/efficient than DFB++.
>>
> Stefan does most of the directfb development, so I think it is his 
> choice what to use. In my opinion it would be the best just to use the 
> plain directfb interface, but as I said Stefan does the directfb 
> development, so I don't care too much ;-)

What Stephan has to say about ++DFB ?
 From what I read DFB++ is a layer adding actual binary code, but ++DFB 
really add quite nothing in the binary, but just adds a cleaner C++ 
interface.

-- 
NH


From M.Wache at gmx.net  Thu May 19 17:43:10 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 19 May 2005 17:43:10 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <200505182147.30950.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505180831.05934.stefan@lucke.in-berlin.de> <428B69B4.5080905@gmx.net> <200505182147.30950.stefan@lucke.in-berlin.de>
Message-ID: <428CB40E.3010500@gmx.net>

Stefan Lucke wrote:

>>Hmm, that's a difficult one - the problem is on one side we want to have 
>>a fast responsive OSD, for this the screen has to be redrawn in software 
>>  alpha mode, but we havn't got the last frame any more...
>>I guess the only solution for this is to override libavcodec's get 
>>buffer/release buffer functions and always keep a pointer of the last 
>>frame. If we do that we can finally can also take screenshots with the 
>>softdevice.
> 
> 
> Shouldn't that extra buffering be done by the output method, as that
> kind of OSD mixing is already done within dfb.
The trick is that this way we don't need extra buffering. If we override 
lavc getbuffer/relasebuffer functions we can decide when to reuse/free a 
frame buffer. So we can just keep the last frame a bit longer in case we 
need it again and free/reuse it when we got the next frame from lavc.

> 
>>I would like to postpone this change until I did the first release of 
>>softplay, which hopefully will be this weekend.
> 
> 
> Here I see some troubles, as softplay needs a change in softdevice
> for pause handling. So there should be a release of softdevice too.
> Hm, release 0.1.1 shows a similar behaviour so fixing that
> can be delayed.
> 
> So there should be only changes to softdevice, if there are impacts
> of latest ffmpeg time effects on softplay which have to be handled
> in softdevice too.
> 
I could not yet check these time effects, but I will do so this evening.

Haveing a softdevice release which works without any problems with 
softplay would be good, that sure. On the other hand I think it would be 
important to have the HDTV buffering issues fixed in the next release, 
but that requires a rework of my patch. Unfortunaltly I can do only one 
thing until the weekend: finish the HDTV buffering patch or finish softplay.
Maybe I should only release a pre version of softplay this weekend and 
we can have combined softdevice/softplay release on one of the following 
weekends?
Or we release the softdevice this weekend without the HDTV fix, that's 
up to you.
Well, I guess I will first have to find out what's the cause for the 
time issues of softplay. If a fix of this requires a change of the 
softdevice releasing softplay alone doesn't make much sense.

Martin


From M.Wache at gmx.net  Thu May 19 18:03:03 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 19 May 2005 18:03:03 +0200
Subject: [Softdevice-devel] Status of XvMC with ffmpeg in softdevice
In-Reply-To: <428CAFF4.1050301@e-dition.fr>
References: <428CAFF4.1050301@e-dition.fr>
Message-ID: <428CB8B7.5080109@gmx.net>

Nicolas Huillard wrote:
> Hello,
> 
> We already talked about future XvMC support in softdevice.
> 
> The ffmpeg-devel talks about ffmpeg having XvMC support, in a 
> output-device-independent manner.
Not completly output-device-independent. ffmpeg supports the NVidia type 
of XvMC, not the Unichorme XvMC (which are almost completly different). 
There are patches to ffmpeg which add Unichrome XvMC support, but I'm 
not sure if, and when they will be merged.

> I think the XvMC wrapper library is independent of the actual X code, 
> and also the Unichrome XvMC driver.
As far as I know that's not true. To my knowledge XvMC wrapper library 
is just a common interface to some card dependent functions which are 
provided by the Xserver.

> 
> Is it possible to once have HW MPEG2 decoding on CLE266 using softdevice 
> on DirectFB, given this infrastructure ?
Maybe this question can be better answered on the DirectFB list. I guess 
once DirectFB supports HW MPEG2, we will surely have a look at it and 
make use of it if it is possible.

> I this code too tightly 
> dependent on X, that it will only ever work on X ?
I think the current implementation of XvMC will never work without X. 
After all it is _X_vMC ;-)

> 
> Is someone interested in having that in softdevice ?
Interested: yes. In fact I now own a Unichrome Pro, so if it is possible 
without too much patching ffmpeg or X I would like to bring support into 
the softdevice. But to be honest up to now I didn't even get mplayer 
running with XvMC...

Martin


From nhuillard at e-dition.fr  Thu May 19 19:02:22 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 19 May 2005 19:02:22 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <428CB40E.3010500@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505180831.05934.stefan@lucke.in-berlin.de> <428B69B4.5080905@gmx.net> <200505182147.30950.stefan@lucke.in-berlin.de> <428CB40E.3010500@gmx.net>
Message-ID: <428CC69E.7000807@e-dition.fr>

Martin Wache a ?crit :
> Haveing a softdevice release which works without any problems with 
> softplay would be good, that sure. On the other hand I think it would be 
> important to have the HDTV buffering issues fixed in the next release, 
> but that requires a rework of my patch. Unfortunaltly I can do only one 
> thing until the weekend: finish the HDTV buffering patch or finish 
> softplay.
> Maybe I should only release a pre version of softplay this weekend and 
> we can have combined softdevice/softplay release on one of the following 
> weekends?
> Or we release the softdevice this weekend without the HDTV fix, that's 
> up to you.
> Well, I guess I will first have to find out what's the cause for the 
> time issues of softplay. If a fix of this requires a change of the 
> softdevice releasing softplay alone doesn't make much sense.

My uneducated advice : release early, release often... 
(http://www.catb.org/~esr/writings/cathedral-bazaar/cathedral-bazaar/ar01s04.html)
Don't call a release pre-"something". All releases are pre-"the next 
one". The only problem with "release often" is the time it takes to 
actually release. Version number is not an issue : just increase, 
increase, increase.
I'll suggest the first version of softplay will be 0.1.0 (or 0.0.0 if 
you feel like it).
Bug fixes will be 0.1.x until new features or notable improvements 
occur, that will trigger 0.2.0 and so on.
Softdevice is really late on version numbering (or is in sync with 
softplay ;-) : I suggest a fair competition on version numbering.

(I have a lot of packages I made at work, numbered 1.6.13, 1.19.3, 
1.8.1, 1.6.16, and all versions were needed, documented, installed, etc.)

-- 
NH


From stefan at lucke.in-berlin.de  Thu May 19 19:37:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 19 May 2005 19:37:26 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <428CB40E.3010500@gmx.net>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505182147.30950.stefan@lucke.in-berlin.de> <428CB40E.3010500@gmx.net>
Message-ID: <200505191937.26226.stefan@lucke.in-berlin.de>

On Donnerstag, 19. Mai 2005 17:43, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> >>Hmm, that's a difficult one - the problem is on one side we want to have 
> >>a fast responsive OSD, for this the screen has to be redrawn in software 
> >>  alpha mode, but we havn't got the last frame any more...
> >>I guess the only solution for this is to override libavcodec's get 
> >>buffer/release buffer functions and always keep a pointer of the last 
> >>frame. If we do that we can finally can also take screenshots with the 
> >>softdevice.
> > 
> > 
> > Shouldn't that extra buffering be done by the output method, as that
> > kind of OSD mixing is already done within dfb.
> The trick is that this way we don't need extra buffering. If we override 
> lavc getbuffer/relasebuffer functions we can decide when to reuse/free a 
> frame buffer. So we can just keep the last frame a bit longer in case we 
> need it again and free/reuse it when we got the next frame from lavc.

Hmm, that trick sound interesting. We should try that in the near future.

> 
> > 
> >>I would like to postpone this change until I did the first release of 
> >>softplay, which hopefully will be this weekend.
> > 
> > 
> > Here I see some troubles, as softplay needs a change in softdevice
> > for pause handling. So there should be a release of softdevice too.
> > Hm, release 0.1.1 shows a similar behaviour so fixing that
> > can be delayed.
> > 
> > So there should be only changes to softdevice, if there are impacts
> > of latest ffmpeg time effects on softplay which have to be handled
> > in softdevice too.
> > 
> I could not yet check these time effects, but I will do so this evening.
> 
> Haveing a softdevice release which works without any problems with 
> softplay would be good, that sure. On the other hand I think it would be 
> important to have the HDTV buffering issues fixed in the next release, 
> but that requires a rework of my patch. Unfortunaltly I can do only one 
> thing until the weekend: finish the HDTV buffering patch or finish softplay.

If I could choose: finishing/releasing softplay should have a
higher priority.

> Maybe I should only release a pre version of softplay this weekend and 
> we can have combined softdevice/softplay release on one of the following 
> weekends?
> Or we release the softdevice this weekend without the HDTV fix, that's 
> up to you.

Oh we can release current version as 0.1.2 .
HDTV ready or AC3 should increase the release counter :-) 
(0.2.0 / 0.3.0) .

> Well, I guess I will first have to find out what's the cause for the 
> time issues of softplay. If a fix of this requires a change of the 
> softdevice releasing softplay alone doesn't make much sense.

Ack.


-- 
Stefan Lucke



From nhuillard at e-dition.fr  Thu May 19 20:02:41 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 19 May 2005 20:02:41 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <200505191937.26226.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505182147.30950.stefan@lucke.in-berlin.de> <428CB40E.3010500@gmx.net> <200505191937.26226.stefan@lucke.in-berlin.de>
Message-ID: <428CD4C1.30402@e-dition.fr>

Stefan Lucke a ?crit :
> Oh we can release current version as 0.1.2 .
> HDTV ready or AC3 should increase the release counter :-) 
> (0.2.0 / 0.3.0) .

Great ;-)

-- 
NH


From stefan at lucke.in-berlin.de  Thu May 19 20:58:42 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 19 May 2005 20:58:42 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <42848191.7010405@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <42848191.7010405@e-dition.fr>
Message-ID: <200505192058.42110.stefan@lucke.in-berlin.de>

On Freitag, 13. Mai 2005 12:29, Nicolas Huillard wrote:
> Jari H a ?crit :

> I think part of the problem with current 0.1.1 softdevice ratio handling 
> is that actual aspect ratio is confused with actual screen resolution. 
> Many screen have no standard pixel aspect (like 1024x1024 plasma at a 
> 16:9 aspect ratio, ie. pixels are really wide)

Do you have such a device to verify code changes ?
Getting actual scaling information (from syslog) with current code
would be nice.

> 
> > View mode: Letterbox, Pan&scan, Full

What special action should be taken for PAN&SCAN ?


-- 
Stefan Lucke



From nhuillard at e-dition.fr  Fri May 20 13:11:28 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 20 May 2005 13:11:28 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <200505192058.42110.stefan@lucke.in-berlin.de>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <42848191.7010405@e-dition.fr> <200505192058.42110.stefan@lucke.in-berlin.de>
Message-ID: <428DC5E0.2060308@e-dition.fr>

Stefan Lucke a ?crit :
> On Freitag, 13. Mai 2005 12:29, Nicolas Huillard wrote:
> 
>>Jari H a ?crit :
> 
> 
>>I think part of the problem with current 0.1.1 softdevice ratio handling 
>>is that actual aspect ratio is confused with actual screen resolution. 
>>Many screen have no standard pixel aspect (like 1024x1024 plasma at a 
>>16:9 aspect ratio, ie. pixels are really wide)
> 
> Do you have such a device to verify code changes ?

Actually no. And I wouldn't buy that expensive one without being sure it 
would be handled correctly.
As of now, I can test with the 800x600 vs. 720x576 sizes on 16:9 CRT TV. 
What I saw was obvious, so I will see improvements.

> Getting actual scaling information (from syslog) with current code
> would be nice.

I can't find the stuff currently : either it's not in syslog (isn't this 
output on stdout/err ?), or ratio didn't change for many days (I have a 
log starting on 2005-05-17), or I can't figure the keywork to grep for...

>>>View mode: Letterbox, Pan&scan, Full
> 
> What special action should be taken for PAN&SCAN ?

I really don't know. Real pan&scan depend on panning information coming 
with the stream. I didn't ever see such information.
Without it, pan&scan is just cropping left and right sides of a 16:9 
movie sent inside a 4:3 frame.
I actually have the reverse problem (fitting 4:3 movie inside the 16:9 
screen), so I didn't really evaluated all possibilities.

-- 
NH


From stefan at lucke.in-berlin.de  Fri May 20 16:21:47 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 20 May 2005 16:21:47 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <428DC5E0.2060308@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <42848191.7010405@e-dition.fr> <200505192058.42110.stefan@lucke.in-berlin.de> <428DC5E0.2060308@e-dition.fr>
Message-ID: <1116598907.428df27b177a3@webmail.in-berlin.de>

Quoting Nicolas Huillard <nhuillard at e-dition.fr>:

> Stefan Lucke a ?crit :
> > On Freitag, 13. Mai 2005 12:29, Nicolas Huillard wrote:
> >
> >>Jari H a ?crit :
> >
> >
> >>I think part of the problem with current 0.1.1 softdevice ratio handling
> >>is that actual aspect ratio is confused with actual screen resolution.
> >>Many screen have no standard pixel aspect (like 1024x1024 plasma at a
> >>16:9 aspect ratio, ie. pixels are really wide)
> >
> > Do you have such a device to verify code changes ?
>
> Actually no. And I wouldn't buy that expensive one without being sure it
> would be handled correctly.
> As of now, I can test with the 800x600 vs. 720x576 sizes on 16:9 CRT TV.
> What I saw was obvious, so I will see improvements.

Can you change in file setup-softdevice.c:
char *videoAspectNames [] = {
        "Monitor",
        "TV  4:3 PAL",
        "TV 16:9 PAL",
        "5:4 as 4:3",
        "test 2",
        NULL
     };
struct sVideoAspectsValues {
  int   width,
        height;
} videoAspectValues [] = {
  { 768, 576},
  { 720, 576},
  { 540, 576},
  { 800, 576},
  {1280, 1024}, // <-- this line (corresponds to mode "test 2") to:
                // {324, 576},
  {768,576}
};


>
> > Getting actual scaling information (from syslog) with current code
> > would be nice.
>
> I can't find the stuff currently : either it's not in syslog (isn't this
> output on stdout/err ?), or ratio didn't change for many days (I have a
> log starting on 2005-05-17), or I can't figure the keywork to grep for...
>

They are written via dsyslog() so they should appear. They look like:
[VideoOut]: aspect changed (%d -> %d ; %f -> %f)
[VideoOut]: resolution changed: W(%d -> %d); H(%d ->%d)
[VideoOut]: %dx%d [%d,%d %dx%d] -> %dx%d [%d,%d %dx%d]


> >>>View mode: Letterbox, Pan&scan, Full
> >
> > What special action should be taken for PAN&SCAN ?
>
> I really don't know. Real pan&scan depend on panning information coming
> with the stream. I didn't ever see such information.
> Without it, pan&scan is just cropping left and right sides of a 16:9
> movie sent inside a 4:3 frame.

I've seen some stream with pan/scan info present but none with
usefull information. I would expect the pan/scan info should tell us
the region to display (focus) when user selects to crop.

Stefan Lucke


From M.Wache at gmx.net  Fri May 20 16:28:01 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 20 May 2005 16:28:01 +0200
Subject: [Softdevice-devel] blank screen after some time with no signal
In-Reply-To: <200505191937.26226.stefan@lucke.in-berlin.de>
References: <200505161553.j4GFrFm00739@bat.berlios.de> <200505182147.30950.stefan@lucke.in-berlin.de> <428CB40E.3010500@gmx.net> <200505191937.26226.stefan@lucke.in-berlin.de>
Message-ID: <428DF3F1.2060801@gmx.net>

Stefan Lucke wrote:


> 
> Oh we can release current version as 0.1.2 .
Ok, so we'll release softplay and softdevice togther this weekend. I 
still have a few minor fixes for softdevice which I will commit this 
evening.
> HDTV ready or AC3 should increase the release counter :-) 
> (0.2.0 / 0.3.0) .
Hmm, when I've fixed the buffering issue I'm still not shure if we 
should call it HDTV ready - I can't receive any live HTDV, so I can't 
test this.

> 
> 
>>Well, I guess I will first have to find out what's the cause for the 
>>time issues of softplay. If a fix of this requires a change of the 
>>softdevice releasing softplay alone doesn't make much sense.
I found the reason for the strange timing issue, I think it can be fixed 
in softplay, but I didn't try yet.

Martin


From nhuillard at e-dition.fr  Fri May 20 18:04:34 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 20 May 2005 18:04:34 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <1116598907.428df27b177a3@webmail.in-berlin.de>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <42848191.7010405@e-dition.fr> <200505192058.42110.stefan@lucke.in-berlin.de> <428DC5E0.2060308@e-dition.fr> <1116598907.428df27b177a3@webmail.in-berlin.de>
Message-ID: <428E0A92.9000902@e-dition.fr>

Stefan Lucke a ?crit :
> Quoting Nicolas Huillard <nhuillard at e-dition.fr>:
> 
>>As of now, I can test with the 800x600 vs. 720x576 sizes on 16:9 CRT TV.
>>What I saw was obvious, so I will see improvements.
> 
> Can you change in file setup-softdevice.c:
> char *videoAspectNames [] = {
>         "Monitor",
>         "TV  4:3 PAL",
>         "TV 16:9 PAL",
>         "5:4 as 4:3",
>         "test 2",
>         NULL
>      };
> struct sVideoAspectsValues {
>   int   width,
>         height;
> } videoAspectValues [] = {
>   { 768, 576},
>   { 720, 576},
>   { 540, 576},
>   { 800, 576},
>   {1280, 1024}, // <-- this line (corresponds to mode "test 2") to:
>                 // {324, 576},
>   {768,576}
> };

I think part of the problem is that "videoAspectValues" are actually 
"resolutionValues"...
I'll try that, but I think the solution is to code this as real aspect 
ratio, like this :
	{ 4, 3 },  // standard 4:3 ratio
	{ 16, 9 }, // standard 16:9 ratio
	{ 325, 240 }, // actual size of my 17" monitor, not exactly 4:3
(actual unit used is unimportant, since only the ratio is useful : this 
might only help tracking bugs in the usage of that info).

>>>Getting actual scaling information (from syslog) with current code
>>>would be nice.
>>
  > They are written via dsyslog() so they should appear. They look like:
> [VideoOut]: aspect changed (%d -> %d ; %f -> %f)
> [VideoOut]: resolution changed: W(%d -> %d); H(%d ->%d)
> [VideoOut]: %dx%d [%d,%d %dx%d] -> %dx%d [%d,%d %dx%d]

Got them, but since they are old, I can't remember exactly what they 
were supposed to show :

[VideoOut]: resolution changed: W(720 -> 544); H(576 ->576)
[VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
[VideoOut]: 544x576 [0,72 544x432] -> 720x576 [0,0 720x576]

-> a channel where everything is in 544x576 frames, containing 
full-frame 4:3 movies, or 16:9 with top/bottom black bars
-> I think softdevice was set in crop-mode = 16:9, pixel-aspect = 16:9 PAL
-> I would like an easy way to switch between 4:3 on the whole 16:9 
screen (scaling 1:1), eliminate top/bottom black bars (1.0 horizontal, 
1.x vertical scaling), maybe something in the middle (half the vertical 
expansion, when I want a big image and can affort the loss of top/bottom 
parts), and added right/left black bars (0.x horizontal, 1.0 vertical 
scaling)

[VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
[VideoOut]: 720x576 [0,72 720x432] -> 720x576 [0,0 720x576]

-> this channel is always 720x576, showing 4:3-full-frame, 
16:9-top/bottom-black and even 1.85 films with huge top/bottom bars
-> I think softdevice was set in crop-mode = 16:9, pixel-aspect = 16:9 PAL
-> kind is same aspect switch : reduce width to have a 4:3 ratio 
on-screen, full-frame on screen (100%), expand verticaly to various 
values, to minimize black bars.

-- 
NH


From stefan at lucke.in-berlin.de  Fri May 20 23:24:32 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 20 May 2005 23:24:32 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <428E0A92.9000902@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <1116598907.428df27b177a3@webmail.in-berlin.de> <428E0A92.9000902@e-dition.fr>
Message-ID: <200505202324.32147.stefan@lucke.in-berlin.de>

On Freitag, 20. Mai 2005 18:04, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Quoting Nicolas Huillard <nhuillard at e-dition.fr>:
> > 
> >>As of now, I can test with the 800x600 vs. 720x576 sizes on 16:9 CRT TV.
> >>What I saw was obvious, so I will see improvements.
> > 
> > Can you change in file setup-softdevice.c:
> > char *videoAspectNames [] = {
> >         "Monitor",
> >         "TV  4:3 PAL",
> >         "TV 16:9 PAL",
> >         "5:4 as 4:3",
> >         "test 2",
> >         NULL
> >      };
> > struct sVideoAspectsValues {
> >   int   width,
> >         height;
> > } videoAspectValues [] = {
> >   { 768, 576},
> >   { 720, 576},
> >   { 540, 576},
> >   { 800, 576},
> >   {1280, 1024}, // <-- this line (corresponds to mode "test 2") to:
> >                 // {324, 576},
> >   {768,576}
> > };
> 
> I think part of the problem is that "videoAspectValues" are actually 
> "resolutionValues"...

Above mentioned 324, 576 values are after a second thought wrong.

No they are not resolution values (they seem to be), they are scaling values.
Damm, why didn't I wrote down the formular by which I calculated (especially the one
800, 576) them, grr.

-- 
Stefan Lucke



From nhuillard at e-dition.fr  Sat May 21 12:51:27 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sat, 21 May 2005 12:51:27 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <200505202324.32147.stefan@lucke.in-berlin.de>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <1116598907.428df27b177a3@webmail.in-berlin.de> <428E0A92.9000902@e-dition.fr> <200505202324.32147.stefan@lucke.in-berlin.de>
Message-ID: <428F12AF.9050204@e-dition.fr>

Stefan Lucke a ?crit :
> On Freitag, 20. Mai 2005 18:04, Nicolas Huillard wrote:
> 
>>Stefan Lucke a ?crit :
>>
>>>Quoting Nicolas Huillard <nhuillard at e-dition.fr>:
>>>
>>>
>>>>As of now, I can test with the 800x600 vs. 720x576 sizes on 16:9 CRT TV.
>>>>What I saw was obvious, so I will see improvements.
>>>
>>>Can you change in file setup-softdevice.c:
>>>char *videoAspectNames [] = {
>>>        "Monitor",
>>>        "TV  4:3 PAL",
>>>        "TV 16:9 PAL",
>>>        "5:4 as 4:3",
>>>        "test 2",
>>>        NULL
>>>     };
>>>struct sVideoAspectsValues {
>>>  int   width,
>>>        height;
>>>} videoAspectValues [] = {
>>>  { 768, 576},
>>>  { 720, 576},
>>>  { 540, 576},
>>>  { 800, 576},
>>>  {1280, 1024}, // <-- this line (corresponds to mode "test 2") to:
>>>                // {324, 576},
>>>  {768,576}
>>>};
>>
>>I think part of the problem is that "videoAspectValues" are actually 
>>"resolutionValues"...
> 
> Above mentioned 324, 576 values are after a second thought wrong.
> 
> No they are not resolution values (they seem to be), they are scaling values.
> Damm, why didn't I wrote down the formular by which I calculated (especially the one
> 800, 576) them, grr.

My second thought led me to :

videoAspectValues [] = {
   { 16 / 9 }, // standard 16:9, coded as a float value
   { 4 / 3 }, // ie. 1,333333333
   { 325 / 240 }, // actual size of my 17" monitor, ie. 1,354166667
   ...

After all, screen aspect ratio is a ratio with no unit, not two dimensions.

Data :
	float screenAspectRatio = 16 / 9
	int screenResolutionX = 800
	int screenResolutionY = 600
Formula :
	float pixelAspectRatio = (screenResolutionX / screenResolutionY) / 
screenAspectRatio
		= 0.75 (ie. pixel height = 0.75 * pixel width)

If I change the DFB resolution to 720x576, I get pixelAspectRatio = 
0.703125 on my 16:9 TV, or 0.9375 on a 4:3 TV
800x600 on a 4:3 monitor give pixelAspectRatio = 1 (ie. square pixels)
The fact is the TV didn't change when I changed the resolution (I think 
this is the point where we don't agree : you have the point of view of 
the current code, I have a theoretical or user point of view)

This is the first step...
Next one is applying the same pixelAspectRatio to the frame (here comes 
the user-selectable thing).
Then find something to scale frame aspect ratio to screen aspect ratio, 
or something like that...

-- 
NH


From nhuillard at e-dition.fr  Sat May 21 14:26:50 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Sat, 21 May 2005 14:26:50 +0200
Subject: [Softdevice-devel] TV/monitor test bitmaps
Message-ID: <428F290A.8010503@e-dition.fr>

Thanks to Michael Reinelt, the bitmap collection I host now has new 
resolutions. Total is : 720x576, 800x600, 1024x768, 1280x768

See http://nicolas.huillard.net/vdr/tv_test/

-- 
NH


From torgeir at pobox.com  Sat May 21 21:07:47 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 21 May 2005 20:07:47 +0100
Subject: [Softdevice-devel] hdtv buffer patch
In-Reply-To: <428B6D09.2090402@gmx.net>
References: <1116284351.3892.37.camel@africa>  <428A1688.3010205@gmx.net>
	 <1116346287.3891.10.camel@africa>  <428B6D09.2090402@gmx.net>
Message-ID: <1116702467.3808.3.camel@africa>

On Wed, 2005-05-18 at 18:27 +0200, Martin Wache wrote:
> Torgeir Veimo wrote:
> 
> > 
> > I've had the problem for a while, even before softdevice started using
> > libavformat. It manifests itself as late frames for about 10 - 20 frames
> > every other second or so. It's only during playback of recorded content.
> > I can have three simultaneous recordings going on and watch live tv
> > without any problems.
> Now since you mentioned it maybe I have something similar, every few 
> seconds the motion of the picture seems to be halted for a tiny moment 
> and then jumps. But I would say it's only one or two late frames for me.
> How bad is it for you?

It's more than a few frames, usually about half a second. I'll try to
experiment a bit after the weekend..

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Mon May 23 21:14:46 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 23 May 2005 21:14:46 +0200
Subject: [Softdevice-devel] [vdr] [ANNOUNCE] vdr-softdevice-0.1.2
Message-ID: <200505232114.46027.stefan@lucke.in-berlin.de>

Sorry forgot to cc our list:

Hello,

softdevice team (Torgeir Veimo, Martin Wache and me, Stefan Lucke)
is pleased to announce a new release of vdr softdevice plugin.

Softdevice plugin is for getting vdr to your desktop with
so called budget cards. You'll get vdr output via framebuffer or X11-Xv or
DirectFB or vidix to your screen. Decoding is done via ffmpeg.

For compile options, please read the Makefile carefully and decide which of
the available output methods fit to your system.

Plugin's homepage is located at: http://softdevice.berlios.de/

Changelog since last release:

2005-05-22: softdevice-0.1.2
    - fix possible segfault in fb-mode when resolution is smaller than
      OSD default size
    - fix pplib deinterlacing
    - check libavcodec build of library against header
    - some more error messages
    - fix for aspect ratio calculation if sample_aspect_ratio.num == 0
    - README update for use of -L DIR usage
    - bugfix: don't blank screen in pause mode
    - blank screen after some time with no signal
    - offer selection of 14:9 mode
    - fix for pause-play transition of softplay, does improve same transiton
      of normal vdr recording playback too.
    - video-dfb: disabled deinterlacing option of dfb.
    - audio-out: some other preparations for ac3
                 selectiv set #channels to 2, to get 2ch downmix of 5.1
                 mute current mixer if volume is set to 0 and unmute if vol != 0
                 changed dsyslod to esyslog is case we exit()
    - syncing: switched to a sync timer which can be controlled by current
               selected output method
    - some preparations for ac3 out selection
    - xv-out & dfb-out: catch userX keys and map one of them to crop mode selection
    - dfb-out: commented out use of DFBCardCapabilities required for current DirectFB cvs.
    - dfb-out: triple buffering for mgatv,
               corrected x/y coordinates for OSD drawing (fix for subtitles plugin)
    - README: added contributor names mentioned in CHANGELOG
              added hint from Makefile about installing ffmpeg


By subscribing to the to cvs list via
https://lists.berlios.de/mailman/listinfo/softdevice-cvs
you'll get informed about lastest changes.

For those who are interested in active development, subscribing to
https://lists.berlios.de/mailman/listinfo/softdevice-devel
is a good choice.

-- 
Stefan Lucke



From marko.makela at hut.fi  Mon May 23 22:24:17 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 23 May 2005 23:24:17 +0300
Subject: [Softdevice-devel] Unrepeatable crashes
Message-ID: <20050523202417.GA199519@kosh.hut.fi>

I just got softdevice from cvs.  It segfaulted in
cPluginSoftDevice::ProcessArgs().  I fixed it by adding the "continue"
statement below:

    if ( !strcmp(argv[i], "softdevice") ) {
        i++;
        argc--;
        continue;
    };

Also, I did some spring cleaning of my video clips tonight.  I think I
found a clip from February that crashed softdevice previously.  It now
played fine, except for some skipping.  I think it was simply bad signal.

Now the screen gets black when playing radio.  Thank you!

I've got some more crashes lately, with a CVS taken a couple of weeks ago,
right before the discussion on screen blanking.  The last one was Signal 7,
but it might have been because of replacing the running libvdr-softdevice.so
file (I doubt that, but it's a possibility).  A previous one was Signal 11
without any apparent reason, when pressing the Timers button on the remote
control, the first keypress for VDR's lifetime (during timed recording).
The sound output was turned off, so I can't tell if it was already crashed.
It was showing a stationary outdoors picture, but there might have been some
wind noise in it.

Here are the relevant log snippets:

CMD[1282]:Play
CMD[1405]:new Audio stream index.. old -1 new 1
CMD[1467]:thread finished pid: 3400 type 1
CMD[1477]:Neuer StreamDecoder Pid: 3395 type 1
CMD[1544]:Neuer Thread gestartet: pid:3406 type 1
CMD[5582]:Stop
CMD[5618]:thread finished pid: 3398 type 0
CMD[5682]:thread finished pid: 3406 type 1
CMD[5691]:Stop finished
(!) [ 3612:    0.000] --> Caught signal 6 (sent by pid 3612, uid 1000) <--

I think that the above was on Saturday, when VDR was shut down during
the playback of a recording.

[dfb] (re)configuring Videolayer to 720 x 576 (540x576)
[dfb] creating new surface
[surface capabilities] videoSurface: videoonly
[dfb] (re)configured 0x00200806
(!) [ 2974:    0.000] --> Caught signal 11 (at 0x3336393e, invalid address) <--

This was probably the crash from pressing the Timers key.  I have to modify
my runvdr script so that it prints the timestamp also when starting vdr for
the first time.  Currently I have only this:

	date '+%Y-%m-%d %H:%M:%S killing VDR'
	killall -q -TERM vdr
	sleep 10
	date '+%Y-%m-%d %H:%M:%S restarting VDR'

[dfb] (re)configuring Videolayer to 720 x 576 (540x576)
[dfb] creating new surface
[surface capabilities] videoSurface: videoonly
[dfb] (re)configured 0x00200806
(!) [ 3066:    0.000] --> Caught signal 7 (at 0xb79f3e2e, non-existent physical
address) <--

Best regards,

	Marko


From marko.makela at hut.fi  Mon May 23 22:34:44 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 23 May 2005 23:34:44 +0300
Subject: [Softdevice-devel] Rapidly blinking black cursor in DFB output
Message-ID: <20050523203444.GB199519@kosh.hut.fi>

I'm using matroxfb on Linux 2.6.11.6, vdr 1.3.24, up-to-date softdevice
and DirectFB 0.9.22.

I'm running VDR as non-root (thanks to Nicolas and others who participated
in that thread).  Here is my /etc/directfbrc:

fbdev=/dev/fb0
mode=768x576
#vt-switch
#vt-switching
no-banner
no-debug
no-vt
depth=16

My problem is that although I have disabled the text cursor
(setterm -cursor off) and redirected all output to a file
("exec <&- >> vdr.log 2>&1" in my runvdr script), there appears
to be a rapidly blinking black square in the position where the
cursor should be.  (I tested "echo -n foo > /dev/tty1", and the
blinking spot moved horizontally.)

The cursor will continue its rapid blinking after pausing playback or
suspending softdevice (until the picture goes all black).

Note: the blinking appears unsynchronized to the screen.  Sometimes you
can see it more frequently, sometimes it is hidden better.  I usually see
the cursor only at the top left or bottom left position.  Again: note that
I have disabled the cursor (setterm -cursor off), but I keep getting this
rapidly blinking black 8?16 rectangle at the cursor position.

I don't remember seeing this when running with no-vt disabled and
vt-switch{,ing} enabled.  Does anyone else have similar problems?
If someone follows the DirectFB or kernel mailing list, please feel
free to forward this report.

	Marko


From marko.makela at hut.fi  Mon May 23 22:37:45 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 23 May 2005 23:37:45 +0300
Subject: [Softdevice-devel] Suspending playback of a recording makes it fast-forward
Message-ID: <20050523203745.GC199519@kosh.hut.fi>

This may be an old bug (I remember seeing some similar report a some time
ago), but if I suspend softdevice, the hard disk light will light up, and
VDR will apparently scan forward the MPEG stream as fast as possible,
until I enable playback again.  It would be better to pause the playback.

	Marko


From marko.makela at hut.fi  Mon May 23 22:48:55 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 23 May 2005 23:48:55 +0300
Subject: [Softdevice-devel] Glitches with aspect ratio selection
Message-ID: <20050523204855.GD199519@kosh.hut.fi>

If I pause a recording and go to the softdevice menu to change the aspect
ratio, nothing will happen until I enable playback again.  Suggested fix:
rescale the last decoded picture, if it's not too hard.

If I change the aspect ratio from 4:3 to 16:9, the top and bottom areas of
the screen (which should have black bars) will often blink between two
images (maybe the two last decoded frames, maybe there must be movement
in the top and bottom areas).  Note that the blinking may last for one or
two seconds when OSD is off, or indefinitely when OSD is on (e.g., when
you are still in the CropMode menu and haven't hit OK).
Suggested fix: schedule the blanking of the bars immediately when the
user-requested or program-requested aspect ratio changes.  

	Marko


From marko.makela at hut.fi  Tue May 24 11:46:20 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 24 May 2005 12:46:20 +0300
Subject: [Softdevice-devel] OProfile success story and some performance measurement tips
Message-ID: <20050524094620.GA386202@kosh.hut.fi>

Hi all,

At times, my 900 MHz Celeron system used to use over 90% CPU in VDR, and it
would drop frames in busy scenes.  After some profiling, I was able to cut
the CPU consumption to 60-70% of the original.

Last night I did some profiling with oprofile.  I had linked softdevice
statically against ffmpeg (compiled from CVS about two weeks ago), so
I could conveniently see which functions are consuming most of the time.
I'm typing this from memory, so there may be inaccuracies.

The biggest surprise was color space conversion.  If I remember correctly,
there are three settings: I420, YUY2 and YV12.  One might have blue and red
swapped on my Matrox G450 (I think) card, but the other two look okay.
Until now, I had used YV12 (I think), and wasted some 20-30 percent of
softdevice's CPU consumption in color space conversions.  After selecting
I420, the CPU load dropped by maybe 20 percent.

Another thing, which wasn't so surprising, was that lavc deinterlacing consumes
about 40% of softdevice's time.  After disabling deinterlacing, I couldn't
notice any dropped frames.  I didn't measure all the interlacing options that
are available with libpostproc.

My /root/.oprofile/daemonrc looks like this:

CHOSEN_EVENTS[0]=CPU_CLK_UNHALTED:90000:0:1:1
NR_CHOSEN=1
SEPARATE_LIB=1
SEPARATE_KERNEL=0
SEPARATE_THREAD=0
SEPARATE_CPU=0
VMLINUX=none
IMAGE_FILTER=
CPU_BUF_SIZE=0
CALLGRAPH=6

I used the following commands as root:

opcontrol --reset # clear the event log
opcontrol --start # start collecting samples from the running system
opcontrol --stop # stop collecting samples

Between --stop and --reset, I used the following command as the vdr user:

opreport -l PLUGINS/lib/libvdr-softdevice*.so | less

I could also have used opstack and opannotate, but I was happy with these
function-level results.  I believe that you will need at least kernel
2.6.11 in order to use opstack.  OProfile is available also for 2.4 kernels,
but it is not included in the kernel distribution.

Try to view the same clip at the same position for the same duration when
repeating the test with different settings.  After opcontrol --start,
view the clip for at least 10 seconds, and try to issue opcontrol --stop
at the same point of the clip each time.

Of course, you can also measure CPU consumption with top, but the load
will vary greatly, depending on the amount of activity on the screen.

	Marko


From nhuillard at e-dition.fr  Tue May 24 12:08:32 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 24 May 2005 12:08:32 +0200
Subject: [Softdevice-devel] Rapidly blinking black cursor in DFB output
In-Reply-To: <20050523203444.GB199519@kosh.hut.fi>
References: <20050523203444.GB199519@kosh.hut.fi>
Message-ID: <4292FD20.6080904@e-dition.fr>

Marko M?kel? a ?crit :
> My problem is that although I have disabled the text cursor
> (setterm -cursor off) and redirected all output to a file
> ("exec <&- >> vdr.log 2>&1" in my runvdr script), there appears
> to be a rapidly blinking black square in the position where the
> cursor should be.  (I tested "echo -n foo > /dev/tty1", and the
> blinking spot moved horizontally.)
> 
> The cursor will continue its rapid blinking after pausing playback or
> suspending softdevice (until the picture goes all black).
> 
> Note: the blinking appears unsynchronized to the screen.  Sometimes you
> can see it more frequently, sometimes it is hidden better.  I usually see
> the cursor only at the top left or bottom left position.  Again: note that
> I have disabled the cursor (setterm -cursor off), but I keep getting this
> rapidly blinking black 8?16 rectangle at the cursor position.
> 
> I don't remember seeing this when running with no-vt disabled and
> vt-switch{,ing} enabled.  Does anyone else have similar problems?
> If someone follows the DirectFB or kernel mailing list, please feel
> free to forward this report.

I did a lot of tests this past WE with the viafb kernel frame-buffer 
driver, and tried kernel 2.6.11 (instead of 2.6.8)
I can say that frame-buffer cursor handling changed between 2.6.8 and 
2.6.11, with a missing fb_info.cursor member (from the top of my head).
What the viafb OSS frame-buffer maintainer did was simply somment out 
the lines involving the fb_info.cursor struct member...

You may experience the same problem with your Matrox frame-buffer : 
cursor handling changed in the kernel, but the driver wasn't updated 
enough... resulting in a ghost blinking cursor (with no-vt).

-- 
NH


From nhuillard at e-dition.fr  Tue May 24 13:34:39 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 24 May 2005 13:34:39 +0200
Subject: [Softdevice-devel] viafb kernel frame-buffer driver : "state of the art"
Message-ID: <4293114F.3010303@e-dition.fr>

Hello all,

Before digging into the viafb code to improve the TV-out tables and add 
a 720x576noscale mode, I checked the various version available.

The version I had was :
* kernel 2.6.8.1 (Debian)
* epiawiki kernel patch, including the viafb driver
* compiled on 200410, IIRC

I wanted to compile a new viafb driver, along with latest kernel 2.6.11, 
to get any SkyStar 2 improvements available. Then start improving 
whatever TV-out tables I would have had then.

Available viafb sources, to my knowledge, are :
* Viaarena : latest 
http://www.viaarena.com/downloads/Source/linux-fbdev-kernel-src_20050203.tgz 
for 2.6 (download comments dated 2005-05-20)
* open-source code from 2.4, updated to 2.6, maintained by Andre Kriehn 
: http://patcher2k.012webpages.com/ (latest 2005-01-02)
* code from the DirectFB CVS (to my knowledge derived from patcher2k)
* patch from epiawiki.org (also to my knowledge derived from patcher2k)


VIA : this lastest source won't compile with 2.6.11 because of missing 
cursor member in fb_info struct. This fb_info.cursor is missing in 
2.6.11 source but not in 2.6.8. I since checked that patcher2k 
viafb_03.diff simply commented out references to that member in the source.
TV-out tables are greatly improved with that source : structure is much 
more readable, they added something which ressembles a noscale mode 
(underscan, fit, overscale : respectively "reduce the image to fit 
everything in the visible area", "reduce a little less to set border of 
the image just at the border of the visible area", "try to not scale at 
all, thus loosing some of the image"). The parameters are better than 
the ones from 2004-10, but all include a flicker filter that blur the 
image (that's not what I want, so tuning of the tables is still necessary).
The driver includes a so-called "accel" mode for kernel 2.6 only, which 
might or might not include anything else than cursor acceleration.
dfbinfo/dfbshow are not happy with this driver, as if necessary 
acceleration hooks were not present (I don't have any traces since I 
didn't finish my checks).
Since patcher2k simply removed the fb_info->cursor references, I still 
have to try this code with 2.6.11 and be sure I didn't miss something 
when I tested dfbinfo/dfbshow.
Maybe directfb users can comment on compatibility between this driver 
and DirectFB. Maybe it could work along with cle266vgaio kernel module 
for 2.6 ?


Patcher2k : I still have to try this driver with 2.6.11, since it should 
work with DirectFB (I think that's the one I have in my kernel).
Since my goal is to tune the TV-out tables, and the ones in there are 
ugly, I don't want to loose time on deprecated code.


DirectFB CVS : I don't know exactly where this code come from and what 
is it's status, but it is said to work well with DirectFB. The TV-out 
tables there are also ugly.


Since the documentation around those tv-out tables is not available, the 
best source for future updates seems to be Via itself (also the 
Unichrome team have done a real good work at this for XFree, but the 
overall code is quite different).

I now have to :
* check if the Via code will ever work with DirectFB (including all 2D 
acceleration)
* if the Via driver won't work with DirectFB, select the most 
appropriate source for this driver (any advice is welcome)
* tune and maybe improve tv-out tables

-- 
NH


From reinelt at eunet.at  Tue May 24 13:59:50 2005
From: reinelt at eunet.at (Michael Reinelt)
Date: Tue, 24 May 2005 13:59:50 +0200
Subject: [Softdevice-devel] viafb kernel frame-buffer driver : "state
 of the art"
In-Reply-To: <4293114F.3010303@e-dition.fr>
References: <4293114F.3010303@e-dition.fr>
Message-ID: <42931736.9090502@eunet.at>

Hello Nicolas and others,

I did some testing lately, and came to similar results.

I'm using a EPIA-M6000 board, VGA connected to a LCD TV set. I *don't*
use TV-out. I want to use VDR/softdevice/DirectFB/VGA. I've seen the
quality this combination delivers, its marvellous compared to the
S-Video I'm using at the moment.

the driver from viaarena does not work here with DirectFB and
softdevice, but provides correct modes.

The driver from Andre Kriehn works, but most of the video modes (not
only TV-out!) are incorrect. This driver seems to be quite buggy (I
tried to find out why some of the modes don't work, and found that
there's a problem with the refresh tables: there is a index into this
tables called 'resMode', this variable is initialized to a 720x576 mode,
but never assigned to).

I too think that the viaarena driver looks cleaner. Although I'm a bit
confused about the fact that the release date on viaarena says
2005-05-20, but the driver file is called
linux-fbdev-kernel-src_20050203.tgz... maybe a wrong file has been
released???

I'd appreciate very much a cleanup/merge of the different drivers, and
if I can be of any help anywhere, just let me know.


bye, Michael

-- 
Michael Reinelt <reinelt at eunet.at>
http://home.pages.at/reinelt
GPG-Key 0xDF13BA50
ICQ #288386781


From nhuillard at e-dition.fr  Tue May 24 15:51:12 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 24 May 2005 15:51:12 +0200
Subject: [Softdevice-devel] viafb kernel frame-buffer driver : "state
 of the art"
In-Reply-To: <42931736.9090502@eunet.at>
References: <4293114F.3010303@e-dition.fr> <42931736.9090502@eunet.at>
Message-ID: <42933150.5050700@e-dition.fr>

Michael Reinelt a ?crit :
> Hello Nicolas and others,
> 
> I did some testing lately, and came to similar results.
> 
> I'm using a EPIA-M6000 board, VGA connected to a LCD TV set. I *don't*
> use TV-out. I want to use VDR/softdevice/DirectFB/VGA. I've seen the
> quality this combination delivers, its marvellous compared to the
> S-Video I'm using at the moment.
> 
> the driver from viaarena does not work here with DirectFB and
> softdevice, but provides correct modes.
> 
> The driver from Andre Kriehn works, but most of the video modes (not
> only TV-out!) are incorrect. This driver seems to be quite buggy (I
> tried to find out why some of the modes don't work, and found that
> there's a problem with the refresh tables: there is a index into this
> tables called 'resMode', this variable is initialized to a 720x576 mode,
> but never assigned to).
> 
> I too think that the viaarena driver looks cleaner. Although I'm a bit
> confused about the fact that the release date on viaarena says
> 2005-05-20, but the driver file is called
> linux-fbdev-kernel-src_20050203.tgz... maybe a wrong file has been
> released???

The comments next to the file name also ask to quit all apps and run 
setup.exe to install the driver... I think the Linux guy at Via packaged 
the driver on 2005-02-03 but the webmaster put it online last friday, 
taking the standard comment without thinking a bit about it.

> I'd appreciate very much a cleanup/merge of the different drivers, and
> if I can be of any help anywhere, just let me know.

My first try : a diff to make the driver compile. Attached.
Just create a /usr/src/linux link pointing to the kernel source tree you 
would like to compile against (no other /usr/src/linux-* links must 
exist if you want to control things : check Makefile in viafb), and run 
"make" in the viafb directory.
make sure you at least selected the vesafb frmae-buffer driver, in order 
to have the cfb* functions compiled-in (used when accel=0).

root at vdr:Linux-FBDev-kernel-src_20050203# ln -sfn kernel-source-2.6.11 
/usr/src/linux
root at vdr:Linux-FBDev-kernel-src_20050203# make clean

Backup your /etc/fb.modes before typing "make install", or simply 
hand-install the kernel module :

cp viafb.ko /lib/modules/2.6.11/kernel/drivers/video
depmod -a
cp viafb.modes /etc/fb.modes
modprobe viafb mode=720x576 TV_ON=1 tv_system=2 tv_level=1 accel=1

I will recompile the kernel (missing vesafb) and test that tonight. last 
commands are untested yet.

-- 
NH
-------------- next part --------------
A non-text attachment was scrubbed...
Name: viafbdev.c.diff
Type: text/x-patch
Size: 5198 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050524/a6a44eb9/attachment.bin>

From stefan at lucke.in-berlin.de  Tue May 24 19:31:10 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 24 May 2005 19:31:10 +0200
Subject: [Softdevice-devel] DFB++ vs. ++DFB (was private mail)
In-Reply-To: <428CB0EC.2080601@e-dition.fr>
References: <428B0CBD.5040903@gmx.net> <428CAE54.9090009@gmx.net> <428CB0EC.2080601@e-dition.fr>
Message-ID: <200505241931.10300.stefan@lucke.in-berlin.de>

On Donnerstag, 19. Mai 2005 17:29, Nicolas Huillard wrote:
> Martin Wache a ?crit :
> > Nicolas Huillard wrote:
> > 
> >> BTW : did you see the ++DFB on the DirectFB 
> >> site ? It is said to be much better/cleaner/efficient than DFB++.
> >>
> > Stefan does most of the directfb development, so I think it is his 
> > choice what to use. In my opinion it would be the best just to use the 
> > plain directfb interface, but as I said Stefan does the directfb 
> > development, so I don't care too much ;-)
> 
> What Stephan has to say about ++DFB ?
>  From what I read DFB++ is a layer adding actual binary code, but ++DFB 
> really add quite nothing in the binary, but just adds a cleaner C++ 
> interface.

Changing the horses during the race ?
As long the DFB++ is not discontinued we should not do an unforced change.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Tue May 24 19:47:44 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 24 May 2005 19:47:44 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <428F12AF.9050204@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <200505202324.32147.stefan@lucke.in-berlin.de> <428F12AF.9050204@e-dition.fr>
Message-ID: <200505241947.44902.stefan@lucke.in-berlin.de>

On Samstag, 21. Mai 2005 12:51, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > On Freitag, 20. Mai 2005 18:04, Nicolas Huillard wrote:
> > 
> >>Stefan Lucke a ?crit :
> >>

> >>
> >>I think part of the problem is that "videoAspectValues" are actually 
> >>"resolutionValues"...
> > 
> > Above mentioned 324, 576 values are after a second thought wrong.
> > 
> > No they are not resolution values (they seem to be), they are scaling values.
> > Damm, why didn't I wrote down the formular by which I calculated (especially the one
> > 800, 576) them, grr.
> 
> My second thought led me to :
> 
> videoAspectValues [] = {
>    { 16 / 9 }, // standard 16:9, coded as a float value
>    { 4 / 3 }, // ie. 1,333333333
>    { 325 / 240 }, // actual size of my 17" monitor, ie. 1,354166667
>    ...
> 
> After all, screen aspect ratio is a ratio with no unit, not two dimensions.
> 
> Data :
> 	float screenAspectRatio = 16 / 9
> 	int screenResolutionX = 800
> 	int screenResolutionY = 600
> Formula :
> 	float pixelAspectRatio = (screenResolutionX / screenResolutionY) / 
> screenAspectRatio
> 		= 0.75 (ie. pixel height = 0.75 * pixel width)
> 
> If I change the DFB resolution to 720x576, I get pixelAspectRatio = 
> 0.703125 on my 16:9 TV, or 0.9375 on a 4:3 TV
> 800x600 on a 4:3 monitor give pixelAspectRatio = 1 (ie. square pixels)
> The fact is the TV didn't change when I changed the resolution (I think 
> this is the point where we don't agree : you have the point of view of 
> the current code, I have a theoretical or user point of view)

Yes I have the point of view of current code. As I said I could not
get the values for "5:4 as 4:3" recalculated, I think there is a bug
in the code. Hopefully I found it. You are right in user definable
aspect ratio selection. The attached patch is really preliminary.

I won't do calulations for all possible screen resolutions and display
geometrys. So output method has to calculate pixel aspect ratio
based on given screen resolution, with a little help from the driver
or user by specifying the display aspect.

> 
> This is the first step...
> Next one is applying the same pixelAspectRatio to the frame (here comes 
> the user-selectable thing).
> Then find something to scale frame aspect ratio to screen aspect ratio, 
> or something like that...
> 

-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: par_01.diff
Type: text/x-diff
Size: 1687 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050524/413034b3/attachment.diff>

From nhuillard at e-dition.fr  Tue May 24 19:53:43 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 24 May 2005 19:53:43 +0200
Subject: [Softdevice-devel] DFB++ vs. ++DFB (was private mail)
In-Reply-To: <200505241931.10300.stefan@lucke.in-berlin.de>
References: <428B0CBD.5040903@gmx.net> <428CAE54.9090009@gmx.net> <428CB0EC.2080601@e-dition.fr> <200505241931.10300.stefan@lucke.in-berlin.de>
Message-ID: <42936A27.2020603@e-dition.fr>

Stefan Lucke a ?crit :
> On Donnerstag, 19. Mai 2005 17:29, Nicolas Huillard wrote:
> 
>>Martin Wache a ?crit :
>>
>>>Nicolas Huillard wrote:
>>>
>>>>BTW : did you see the ++DFB on the DirectFB 
>>>>site ? It is said to be much better/cleaner/efficient than DFB++.
>>>
>>>Stefan does most of the directfb development, so I think it is his 
>>>choice what to use. In my opinion it would be the best just to use the 
>>>plain directfb interface, but as I said Stefan does the directfb 
>>>development, so I don't care too much ;-)
>>
>>What Stephan has to say about ++DFB ?
>> From what I read DFB++ is a layer adding actual binary code, but ++DFB 
>>really add quite nothing in the binary, but just adds a cleaner C++ 
>>interface.
> 
> Changing the horses during the race ?
> As long the DFB++ is not discontinued we should not do an unforced change.

Agreed.
It could be useful if there is a performance waste in this layer, or if 
coding is easier with ++DFB.
If your feeling is that neither is a problem, I'm perfectly OK with it.

-- 
NH


From nhuillard at e-dition.fr  Tue May 24 20:09:30 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 24 May 2005 20:09:30 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <200505241947.44902.stefan@lucke.in-berlin.de>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <200505202324.32147.stefan@lucke.in-berlin.de> <428F12AF.9050204@e-dition.fr> <200505241947.44902.stefan@lucke.in-berlin.de>
Message-ID: <42936DDA.3050309@e-dition.fr>

Stefan Lucke a ?crit :
> Yes I have the point of view of current code. As I said I could not
> get the values for "5:4 as 4:3" recalculated, I think there is a bug
> in the code. Hopefully I found it. You are right in user definable
> aspect ratio selection. The attached patch is really preliminary.

I'll just insist a little bit : the label of the option should not be 
"4:3 as 16:9", but "16:9" as it truly represents only the screen ratio. 
But you're working on this so I won't disturb you with this label 
detail. The rest of the patch should demonstrate that you understood me 
(if I had the point of view of the code...)

I'll try this patch as soon as I get a proper and recent viafb 
frame-buffer driver...

> I won't do calulations for all possible screen resolutions and display
> geometrys. So output method has to calculate pixel aspect ratio
> based on given screen resolution, with a little help from the driver
> or user by specifying the display aspect.

Actually, the X driver should provide that information in 
/etc/X11/XF86Config-4 :
Section "Monitor"
	...
	DisplaySize     590     330

I didn't ever see an equivalent in DirectFB, so user have to tell 
softdevice what is the actual size ratio (or aspect ratio) of the screen.

-- 
NH


From stefan at lucke.in-berlin.de  Tue May 24 21:12:05 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 24 May 2005 21:12:05 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <42936DDA.3050309@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <200505241947.44902.stefan@lucke.in-berlin.de> <42936DDA.3050309@e-dition.fr>
Message-ID: <200505242112.05709.stefan@lucke.in-berlin.de>

On Dienstag, 24. Mai 2005 20:09, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Yes I have the point of view of current code. As I said I could not
> > get the values for "5:4 as 4:3" recalculated, I think there is a bug
> > in the code. Hopefully I found it. You are right in user definable
> > aspect ratio selection. The attached patch is really preliminary.
> 
> I'll just insist a little bit : the label of the option should not be 
> "4:3 as 16:9", but "16:9" as it truly represents only the screen ratio. 

Yes, that's why I called it "very preliminary". There should be:
"Default" - if driver has a good guess like X11 with
    DisplayHeightMM(display, screen_number) or square pixel
"5:4"
"4:3"
"16:9"
and it will _not_ be called "Pixel Aspect", but "Display Aspect".

> Actually, the X driver should provide that information in 
> /etc/X11/XF86Config-4 :
> Section "Monitor"
> 	...
> 	DisplaySize     590     330

That's why/what I asked on directfb-dev.

But X has it's own idea of handling supplied values:
from XF86Config:    DisplaySize  340 272

from xdpyinfo:

screen #0:
  dimensions:    1280x1024 pixels (342x274 millimeters)



-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Wed May 25 00:17:40 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 25 May 2005 00:17:40 +0200
Subject: [Softdevice-devel] Aspect ratio : my proposal
In-Reply-To: <42936DDA.3050309@e-dition.fr>
References: <1115972902548.jarppa81.30066.BxMbuQHAlhdPGqYYNyKLMQ@luukku.com> <200505241947.44902.stefan@lucke.in-berlin.de> <42936DDA.3050309@e-dition.fr>
Message-ID: <200505250017.40164.stefan@lucke.in-berlin.de>

On Dienstag, 24. Mai 2005 20:09, Nicolas Huillard wrote:
> Stefan Lucke a ?crit :
> > Yes I have the point of view of current code. As I said I could not
> > get the values for "5:4 as 4:3" recalculated, I think there is a bug
> > in the code. Hopefully I found it. You are right in user definable
> > aspect ratio selection. The attached patch is really preliminary.
> 
> I'll just insist a little bit : the label of the option should not be 
> "4:3 as 16:9", but "16:9" as it truly represents only the screen ratio. 
> But you're working on this so I won't disturb you with this label 
> detail. The rest of the patch should demonstrate that you understood me 
> (if I had the point of view of the code...)

Perhaps you like that one more. I call it semi final.
_AND_ I need some more testers (feedback) before commiting.


-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: par_03.diff
Type: text/x-diff
Size: 9408 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050525/944fde53/attachment.diff>

From nhuillard at e-dition.fr  Wed May 25 16:07:34 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 25 May 2005 16:07:34 +0200
Subject: [Softdevice-devel] viafb kernel frame-buffer driver : "state
 of the art"
In-Reply-To: <42933150.5050700@e-dition.fr>
References: <4293114F.3010303@e-dition.fr> <42931736.9090502@eunet.at> <42933150.5050700@e-dition.fr>
Message-ID: <429486A6.6020507@e-dition.fr>

Nicolas Huillard a ?crit :
> Michael Reinelt a ?crit :
> 
>> I'd appreciate very much a cleanup/merge of the different drivers, and
>> if I can be of any help anywhere, just let me know.

The work is harder than I thought, specially to make the driver work 
with DirectFB. Didn't test with dump console (I have no keyboard on the 
box, so testing is not obvious, and my goal is softdevice, so...).

> My first try : a diff to make the driver compile. Attached.
> Just create a /usr/src/linux link pointing to the kernel source tree you 
> would like to compile against (no other /usr/src/linux-* links must 
> exist if you want to control things : check Makefile in viafb), and run 
> "make" in the viafb directory.
> make sure you at least selected the vesafb frmae-buffer driver, in order 
> to have the cfb* functions compiled-in (used when accel=0).
> 
> root at vdr:Linux-FBDev-kernel-src_20050203# ln -sfn kernel-source-2.6.11 
> /usr/src/linux
> root at vdr:Linux-FBDev-kernel-src_20050203# make clean
> 
> Backup your /etc/fb.modes before typing "make install", or simply 
> hand-install the kernel module :
> 
> cp viafb.ko /lib/modules/2.6.11/kernel/drivers/video
> depmod -a
> cp viafb.modes /etc/fb.modes
> modprobe viafb mode=720x576 TV_ON=1 tv_system=2 tv_level=1 accel=1
> 
> I will recompile the kernel (missing vesafb) and test that tonight. last 
> commands are untested yet.

Tested. Updated the patch. Attached.
The problem is that pixel format and vertical virtual size are not 
handled correctly. Tuning /etc/fb.modes or /etc/directfb (pixelformat, 
mode, etc.) does not improve things very much.
DirectFB is from CVS today. Any idea where to look for, in order to make 
the viafb frame-buffer driver and the unichrome gfxdriver agree on some 
things.

fbset reports a wrong rgba :
mode "720x576-60"
     # D: 32.668 MHz, H: 35.820 kHz, V: 60.000 Hz
     geometry 720 576 720 576 32
     timings 30611 96 24 17 1 72 3
     accel true
     rgba 0/0,0/0,0/0,0/0
endmode

dfbshow reports a wrong yres / vyres wrt actual vsize (with 
pixelformat=ARGB) :

vdr at vdr:.tv_test$ dfbshow 720x576_01.png
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.23 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-05-25 12:12)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** 
[../../../lib/fusion/reactor.c:802]
(!) DirectFB/FBDev: yres 1152, vyres 1152, offset 1152
  (!?!)  *** BUG [panning buffer out of range] *** 
[../../../systems/fbdev/fbdev.c:1411 in dfb_fbdev_pan()]
(*) Direct/Interface: Loaded 'PNG' implementation of 
'IDirectFBImageProvider'.
(!) DirectFB/FBDev: yres 1152, vyres 1152, offset 1152
  (!?!)  *** BUG [panning buffer out of range] *** 
[../../../systems/fbdev/fbdev.c:1411 in dfb_fbdev_pan()]

Caught exception!
   -- IDirectFBSurface::Flip(DFBRegion*, DFBSurfaceFlipFlags) -> 
Internal bug!


It reports bad pixelformat when not specified in /etc/directfbrc, and 
does not raise exception (I stop it using ^C) :

vdr at vdr:.tv_test$ dfbshow 720x576_01.png
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

        ---------------------- DirectFB v0.9.23 ---------------------
              (c) 2000-2002  convergence integrated media GmbH
              (c) 2002-2004  convergence GmbH
         -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-05-25 12:12)
(*) Direct/Memcpy: Using MMXEXT optimized memcpy()
(*) Direct/Modules: suppress module 'joystick'
(*) Direct/Modules: suppress module 'lirc'
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** 
[../../../lib/fusion/reactor.c:802]
(!) DirectFB/FBDev: Unsupported pixelformat: rgba 0/0, 0/0, 0/0, 0/0 (32bit)
  (!!!)  *** WARNING [fbdev driver possibly buggy] *** 
[../../../systems/fbdev/fbdev.c:1621 in dfb_fbdev_set_mode()]
  (!!!)  *** ONCE [unsupported destination format] *** 
[../../../../src/gfx/generic/generic.c:5913 in gAcquire()]
(*) Direct/Interface: Loaded 'PNG' implementation of 
'IDirectFBImageProvider'.
(!) [13386:    0.000] --> Caught signal 2 (sent by the kernel) <--
Killed


-- 
NH
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Linux-FBDev-kernel-src_20050203.diff
Type: text/x-patch
Size: 7526 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050525/c3470e75/attachment.bin>

From M.Wache at gmx.net  Wed May 25 17:28:16 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 25 May 2005 17:28:16 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <20050523202417.GA199519@kosh.hut.fi>
References: <20050523202417.GA199519@kosh.hut.fi>
Message-ID: <42949990.2030206@gmx.net>

Marko M?kel? wrote:
> I just got softdevice from cvs.  It segfaulted in
> cPluginSoftDevice::ProcessArgs().  I fixed it by adding the "continue"
> statement below:
> 
>     if ( !strcmp(argv[i], "softdevice") ) {
>         i++;
>         argc--;
>         continue;
>     };
> 
Ooops, that's my fault. I will fix it in the CVS, thank you for the report!

> I've got some more crashes lately, with a CVS taken a couple of weeks ago,
> right before the discussion on screen blanking.  The last one was Signal 7,
> but it might have been because of replacing the running libvdr-softdevice.so
> file (I doubt that, but it's a possibility).  A previous one was Signal 11
> without any apparent reason, when pressing the Timers button on the remote
> control, the first keypress for VDR's lifetime (during timed recording).
> The sound output was turned off, so I can't tell if it was already crashed.
> It was showing a stationary outdoors picture, but there might have been some
> wind noise in it.
> 
> Here are the relevant log snippets:
> 
> CMD[1282]:Play
> CMD[1405]:new Audio stream index.. old -1 new 1
> CMD[1467]:thread finished pid: 3400 type 1
> CMD[1477]:Neuer StreamDecoder Pid: 3395 type 1
> CMD[1544]:Neuer Thread gestartet: pid:3406 type 1
> CMD[5582]:Stop
> CMD[5618]:thread finished pid: 3398 type 0
> CMD[5682]:thread finished pid: 3406 type 1
> CMD[5691]:Stop finished
> (!) [ 3612:    0.000] --> Caught signal 6 (sent by pid 3612, uid 1000) <--
> 
> I think that the above was on Saturday, when VDR was shut down during
> the playback of a recording.
> 
> [dfb] (re)configuring Videolayer to 720 x 576 (540x576)
> [dfb] creating new surface
> [surface capabilities] videoSurface: videoonly
> [dfb] (re)configured 0x00200806
> (!) [ 2974:    0.000] --> Caught signal 11 (at 0x3336393e, invalid address) <--
> 
> This was probably the crash from pressing the Timers key.  I have to modify
> my runvdr script so that it prints the timestamp also when starting vdr for
> the first time.  Currently I have only this:
> 
> 	date '+%Y-%m-%d %H:%M:%S killing VDR'
> 	killall -q -TERM vdr
> 	sleep 10
> 	date '+%Y-%m-%d %H:%M:%S restarting VDR'
> 
> [dfb] (re)configuring Videolayer to 720 x 576 (540x576)
> [dfb] creating new surface
> [surface capabilities] videoSurface: videoonly
> [dfb] (re)configured 0x00200806
> (!) [ 3066:    0.000] --> Caught signal 7 (at 0xb79f3e2e, non-existent physical
> address) <--
> 

Unfortunatly it is very difficult to find the reasons for these crashes 
just with this information. It is possible to enable core dumps in your 
system, so that we can have this additional information? It would make 
finding the problem a lot easier...

Thank you,
Martin



From M.Wache at gmx.net  Wed May 25 17:38:51 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 25 May 2005 17:38:51 +0200
Subject: [Softdevice-devel] Suspending playback of a recording makes it
 fast-forward
In-Reply-To: <20050523203745.GC199519@kosh.hut.fi>
References: <20050523203745.GC199519@kosh.hut.fi>
Message-ID: <42949C0B.2060800@gmx.net>

Marko M?kel? wrote:
> This may be an old bug (I remember seeing some similar report a some time
> ago), but if I suspend softdevice, the hard disk light will light up, and
> VDR will apparently scan forward the MPEG stream as fast as possible,
> until I enable playback again.  It would be better to pause the playback.
> 
The problem here is that currently there is now way for the softdevice 
to tell if it is playing a recording or live - tv. I think we could use 
cStatus (or whatever it is called) but actually I have never checked.
When the softdevice enters pause mode during playback of a recording it 
just doesn't accept any data any more, this is not possible during 
live-tv, vdr will complain a lot about buffer overflows.
So we need to know if we are playing a recording or live-tv and 
currently I don't know an appropriate way to get to know that. Using 
cStatus I don't like very much for two reasons: I think it is not meant 
to be used for this, and as far as I remember it is a quite recent 
feature so it won't work for all vdr versions.
If you find an simple and reliable way to distinguish replaying of a 
recording and live-tv, pausing the recording during suspend is no 
problem ;-)

Martin


From M.Wache at gmx.net  Wed May 25 18:25:41 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 25 May 2005 18:25:41 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <20050524094620.GA386202@kosh.hut.fi>
References: <20050524094620.GA386202@kosh.hut.fi>
Message-ID: <4294A705.6070508@gmx.net>

Marko M?kel? wrote:
> Hi all,
> 
> At times, my 900 MHz Celeron system used to use over 90% CPU in VDR, and it
> would drop frames in busy scenes.  After some profiling, I was able to cut
> the CPU consumption to 60-70% of the original.
> 
> Last night I did some profiling with oprofile.  I had linked softdevice
> statically against ffmpeg (compiled from CVS about two weeks ago), so
> I could conveniently see which functions are consuming most of the time.
> I'm typing this from memory, so there may be inaccuracies.
> 
> The biggest surprise was color space conversion.  If I remember correctly,
> there are three settings: I420, YUY2 and YV12.  One might have blue and red
> swapped on my Matrox G450 (I think) card, but the other two look okay.
> Until now, I had used YV12 (I think), and wasted some 20-30 percent of
> softdevice's CPU consumption in color space conversions.  After selecting
> I420, the CPU load dropped by maybe 20 percent.
Maybe we should write somewhere that people should use I420 if possible 
(it is the native colorspace for mpeg2). YV12 is only there for people 
owning a graphics card which can't do I420 or YUV2. But I think 
I420/YUV2 is the default, or am I wrong?

> 
> Another thing, which wasn't so surprising, was that lavc deinterlacing consumes
> about 40% of softdevice's time.  After disabling deinterlacing, I couldn't
> notice any dropped frames.  I didn't measure all the interlacing options that
> are available with libpostproc.
Hmm, isn't no deinterlacing also the default?
I guess you don't even need deintelacing because the Matrox can do it in 
hardware ;-)

Probably we should check again the default settings and write a short 
description about the options somewhere in the Readme.
> 
> My /root/.oprofile/daemonrc looks like this:
> 
> CHOSEN_EVENTS[0]=CPU_CLK_UNHALTED:90000:0:1:1
> NR_CHOSEN=1
> SEPARATE_LIB=1
> SEPARATE_KERNEL=0
> SEPARATE_THREAD=0
> SEPARATE_CPU=0
> VMLINUX=none
> IMAGE_FILTER=
> CPU_BUF_SIZE=0
> CALLGRAPH=6
> 
Is it possible to measure cache misses with your processor?
The reason I'm asking is that currently the softdevice decodes a 
complete picture, sleeps until it is to be shown, copies the picture to 
the video memory and flips the page.
The sleep between decoding and copying is asking for cache misses. Apart 
from that for most boards / processors one frame doesn't fit into the 
cache. Fortunatly libavcodec has a callback which is called as soon as 
one slice of the picture has been decoded, so that the copying can be 
done while that slice is still in the cache.
I'm currently thinking of using that feature in the softdevice, but it 
would be nice to have some hard numbers on the improvement especially 
for processors with small caches to decide how important that feature is.
In fact it is not that difficult to implement, but it would take some 
time to do it right ;-)

Martin


From stefan at lucke.in-berlin.de  Wed May 25 21:52:44 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 25 May 2005 21:52:44 +0200
Subject: [Softdevice-devel] OProfile success story and some performance measurement tips
In-Reply-To: <4294A705.6070508@gmx.net>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net>
Message-ID: <200505252152.44421.stefan@lucke.in-berlin.de>

On Mittwoch, 25. Mai 2005 18:25, Martin Wache wrote:
> Marko M?kel? wrote:
> > Hi all,
> > 
> > At times, my 900 MHz Celeron system used to use over 90% CPU in VDR, and it
> > would drop frames in busy scenes.  After some profiling, I was able to cut
> > the CPU consumption to 60-70% of the original.
> > 
> > Last night I did some profiling with oprofile.  I had linked softdevice
> > statically against ffmpeg (compiled from CVS about two weeks ago), so
> > I could conveniently see which functions are consuming most of the time.
> > I'm typing this from memory, so there may be inaccuracies.
> > 
> > The biggest surprise was color space conversion.  If I remember correctly,
> > there are three settings: I420, YUY2 and YV12.  One might have blue and red
> > swapped on my Matrox G450 (I think) card, but the other two look okay.
> > Until now, I had used YV12 (I think), and wasted some 20-30 percent of
> > softdevice's CPU consumption in color space conversions.  After selecting
> > I420, the CPU load dropped by maybe 20 percent.
> Maybe we should write somewhere that people should use I420 if possible 
> (it is the native colorspace for mpeg2). YV12 is only there for people 
> owning a graphics card which can't do I420 or YUV2. But I think 
> I420/YUV2 is the default, or am I wrong?

The native format is YV12. But someone does mess it up. That someone
is either X11 or (directfb and vidix). For X11 we allocate and YV12 surface
format and for the others I have to use I420 ;-) .

For X11 it would be best to request data in YUY2 format from ffmpeg,
as I believe their conversions are more optimized than X11 ones.
Many X11xv-out drivers do a convert from YV12 to YUV2
in plain c-code. Look for routine names like copymungeddata().


-- 
Stefan Lucke



From marko.makela at hut.fi  Wed May 25 22:14:40 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 25 May 2005 23:14:40 +0300
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <42949990.2030206@gmx.net>
References: <20050523202417.GA199519@kosh.hut.fi> <42949990.2030206@gmx.net>
Message-ID: <20050525201440.GA187661@kosh.hut.fi>

On Wed, May 25, 2005 at 05:28:16PM +0200, Martin Wache wrote:
> Unfortunatly it is very difficult to find the reasons for these crashes 
> just with this information. It is possible to enable core dumps in your 
> system, so that we can have this additional information? It would make 
> finding the problem a lot easier...

Sure.  It seems it will be just a matter of adding ulimit -c unlimited
to the runvdr script.  I'll also add "sysctl kernel.core_pattern=core.%p"
to the startup scripts in order to ensure that the files are less likely
to be overwritten (in case there are multiple crashes).  Both SIGABRT
and SIGSEGV seem to create a core dump by default (I tested with /bin/cat
and an explicit kill from another virtual console.)

	Marko


From marko.makela at hut.fi  Wed May 25 22:30:48 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 25 May 2005 23:30:48 +0300
Subject: [Softdevice-devel] OProfile success story and some performance measurement tips
In-Reply-To: <4294A705.6070508@gmx.net>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net>
Message-ID: <20050525203048.GC187661@kosh.hut.fi>

On Wed, May 25, 2005 at 06:25:41PM +0200, Martin Wache wrote:
> Hmm, isn't no deinterlacing also the default?

Probably yes, but I have been messing with the settings.  I just wanted
to show you how useful it is to run oprofile. :-)

> I guess you don't even need deintelacing because the Matrox can do it in 
> hardware ;-)

As a matter of fact, I've considered replacing the SuperVGA monitor and
separate speakers with a Commodore 1084S (a.k.a. Philips CM8833 colour
video monitor with built-in stereo speakers).  I even bought a VGA
connector so that I could solder the SCART cable, but I haven't come
around to it yet.

> Is it possible to measure cache misses with your processor?

I guess so.  If not on the Celeron of my VDR box, I can play some recordings
on this Pentium-M and look for DCU_MISS_OUTSTANDING
(number of cycles while DCU miss outstanding; DCU=data cache unit) or
DATA_MEM_REFS (all memory references, cachable and non).
opcontrol --list-events lists all possible events, but I can't start up
my VDR box now.

> The reason I'm asking is that currently the softdevice decodes a 
> complete picture, sleeps until it is to be shown, copies the picture to 
> the video memory and flips the page.
> The sleep between decoding and copying is asking for cache misses.

You could perhaps also add explicit prefetch instructions, i.e.,
__builtin_prefetch().  I don't know which processors have the opcodes.
At least the Pentium-M does.  But that would only help for reading
the MPEG stream.

> Apart from that for most boards / processors one frame doesn't fit into the 
> cache.

Right, this Pentium-M should have 1 megabyte of cache, which is less than one
uncompressed frame, unless I'm mistaken.  The Celeron probably has much less.

	Marko


From marko.makela at hut.fi  Wed May 25 22:50:40 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 25 May 2005 23:50:40 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
Message-ID: <20050525205040.GD187661@kosh.hut.fi>

This may be a bit off-topic for this list, but I have built a simple 10A
power control box that has a switch (ON/OFF/programmatic), a fuse and a
solid-state relay.  The box is installed in an extension cord, and it
allows me to control the power of the outlets behind it.  The total cost
of parts was about 20 euros, including the material for the case.
A German company makes a USB controlled power outlet for more than double
the price, and the drivers are proprietary.

In the switch position "programmatic", the power is controlled by an RS-232
handshaking line from the PC.  This allows the VDR to power the monitor and
speakers on and off as needed.  I would like to connect the relay to the
softdevice "suspended" flag, i.e., when softdevice playback is suspended,
the display will be off.

Here comes the hard part: When the box starts from ATX timer (nvram-wakeup),
softdevice should be initially suspended (and the monitor should remain
powered off).  Otherwise (box started from power button or wake-on-LAN
(triggered by remote control)), softdevice should start with playback
enabled.  Is there any way to find out how the system was powered on?

Last but not least, if playback is suspended, pressing any key on the remote
control should enable playback.  Or perhaps there already is a remote control
key for toggling the playback state; I remember seeing something like that
in the menu.

I lied a bit above: I've tested the solid-state relay (surplus stock
from 1981) separately using a battery pack as the control voltage source.
It survived the degaussing spike from my monitor, repeatedly.  I have to
drill one more hole to the case and connect the wires to get it into
production use.

	Marko


From nhuillard at e-dition.fr  Thu May 26 10:28:59 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 26 May 2005 10:28:59 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <200505252152.44421.stefan@lucke.in-berlin.de>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <200505252152.44421.stefan@lucke.in-berlin.de>
Message-ID: <429588CB.8000700@e-dition.fr>

Stefan Lucke a ?crit :
> The native format is YV12. But someone does mess it up. That someone
> is either X11 or (directfb and vidix). For X11 we allocate and YV12 surface
> format and for the others I have to use I420 ;-) .

Isn't that conversion done in hardware, at least with DirectFB on a 
CLE266. The list of hardware supported conversion is impressive with 
this chip 
(http://www.directfb.org/index.php?path=Main%2FSupport%2FGraphics&driver=unichrome)
Hum. after re-reading this page, I see that all hardware conversions 
involve RGB of some kind, not [UVY]*

> For X11 it would be best to request data in YUY2 format from ffmpeg,
> as I believe their conversions are more optimized than X11 ones.
> Many X11xv-out drivers do a convert from YV12 to YUV2
> in plain c-code. Look for routine names like copymungeddata().

Every optimization is useful. I'll also try oprofile.
Wandering through the Debain sarge packages, I also found qprof 
(http://www.hpl.hp.com/research/linux/qprof/) and prospect 
(http://packages.debian.org/testing/devel/prospect).

-- 
NH


From nhuillard at e-dition.fr  Thu May 26 10:35:23 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 26 May 2005 10:35:23 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <20050525203048.GC187661@kosh.hut.fi>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <20050525203048.GC187661@kosh.hut.fi>
Message-ID: <42958A4B.3040500@e-dition.fr>

Marko M?kel? a ?crit :
>>Apart from that for most boards / processors one frame doesn't fit into the 
>>cache.
> 
> Right, this Pentium-M should have 1 megabyte of cache, which is less than one
> uncompressed frame, unless I'm mistaken.  The Celeron probably has much less.

My target system :
vendor_id       : CentaurHauls
model name      : VIA Nehemiah
cpu MHz         : 999.938
cache size      : 64 KB

A standard desktop :
vendor_id       : AuthenticAMD
model name      : AMD Athlon(TM) XP 2200+
cpu MHz         : 1800.109
cache size      : 256 KB

A server of mine :
vendor_id       : GenuineIntel
model name      : Pentium III (Coppermine)
cpu MHz         : 996.911
cache size      : 256 KB

-- 
NH


From nhuillard at e-dition.fr  Thu May 26 10:47:13 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 26 May 2005 10:47:13 +0200
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state
 relay
In-Reply-To: <20050525205040.GD187661@kosh.hut.fi>
References: <20050525205040.GD187661@kosh.hut.fi>
Message-ID: <42958D11.2010306@e-dition.fr>

Marko M?kel? a ?crit :
> Here comes the hard part: When the box starts from ATX timer (nvram-wakeup),
> softdevice should be initially suspended (and the monitor should remain
> powered off).  Otherwise (box started from power button or wake-on-LAN
> (triggered by remote control)), softdevice should start with playback
> enabled.  Is there any way to find out how the system was powered on?

Test at boot time if the nvram timer is within a small time-frame : less 
than 1 minute ago).
I guess anything else would involve hardware of chipset control.
I was about to suggest something to indicate why the box was shut down, 
but that's not really the same (it might have shut down because of the 
timer, but waken up interactively).
Maybe the right solution is not to shut down ? Just deep/not-so-deep 
sleep ? Using ACPI events you could on some platform get the event that 
triggered the wake-up, after the wake-up occured.

-- 
NH


From marko.makela at hut.fi  Thu May 26 11:05:39 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 26 May 2005 12:05:39 +0300
Subject: [Softdevice-devel] OProfile success story and some performance measurement tips
In-Reply-To: <429588CB.8000700@e-dition.fr>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <200505252152.44421.stefan@lucke.in-berlin.de> <429588CB.8000700@e-dition.fr>
Message-ID: <20050526090539.GA3474@localhost.localdomain>

Nicolas,

> Every optimization is useful. I'll also try oprofile.
> Wandering through the Debain sarge packages, I also found qprof 
> (http://www.hpl.hp.com/research/linux/qprof/) and prospect 
> (http://packages.debian.org/testing/devel/prospect).

The latter is a front-end to oprofile.  I have only used opcontrol,
opreport, opstack and opannotate; I don't need graphical front-ends. :-)

Qprof could be a direct descendant of DEC's DCPI profiling tools.
I remember reading a paper where they presented some performance
improvements made on AltaVista (if anyone remembers the AltaVista
search engine: I guess one reason to set it up was to demonstrate
the performance of the 64-bit Digital Alpha processor family.)

BTW, be sure to enable the local APIC in the kernel and at boot time
"lapic" parameter if it's disabled by the BIOS.  Otherwise oprofile
won't work, or it will fall back to timer interrupts, which are an
inaccurate subsitute for CPU_CLK_UNHALTED measurements.

	Marko


From marko.makela at hut.fi  Thu May 26 11:14:11 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 26 May 2005 12:14:11 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <42958D11.2010306@e-dition.fr>
References: <20050525205040.GD187661@kosh.hut.fi> <42958D11.2010306@e-dition.fr>
Message-ID: <20050526091411.GB3474@localhost.localdomain>

On Thu, May 26, 2005 at 10:47:13AM +0200, Nicolas Huillard wrote:
> Marko M?kel? a ?crit :
> >Here comes the hard part: When the box starts from ATX timer 
> >(nvram-wakeup),
> >softdevice should be initially suspended (and the monitor should remain
> >powered off).  Otherwise (box started from power button or wake-on-LAN
> >(triggered by remote control)), softdevice should start with playback
> >enabled.  Is there any way to find out how the system was powered on?
> 
> Test at boot time if the nvram timer is within a small time-frame : less 
> than 1 minute ago).
> I guess anything else would involve hardware of chipset control.

I have another idea.  As I'm going to build an ATtiny12 based IR decoder
and wake-on-LAN trigger, I could monitor the system's +5V line with the
ATtiny12.  If the +5V line was brought up as a result of pressing the
Power key on the remote, we know that the box was powered up by the user.
Otherwise it was powered up non-interactively, and softdevice should
remain suspended.  (Let's pretend that the power button on the front panel
does not exist or is not for interactive use.)

Maybe this information could be passed to VDR by having the ATtiny12 send
manufactured "unsuspend" keycodes to the Hauppauge Nova-T IR receiver
port until an IR code pulse arrives from the receiver module.

> Maybe the right solution is not to shut down ? Just deep/not-so-deep 
> sleep ? Using ACPI events you could on some platform get the event that 
> triggered the wake-up, after the wake-up occured.

That's not a solution for me.

	Marko


From nhuillard at e-dition.fr  Thu May 26 11:31:50 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 26 May 2005 11:31:50 +0200
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state
 relay
In-Reply-To: <20050526091411.GB3474@localhost.localdomain>
References: <20050525205040.GD187661@kosh.hut.fi> <42958D11.2010306@e-dition.fr> <20050526091411.GB3474@localhost.localdomain>
Message-ID: <42959786.5070704@e-dition.fr>

Marko M?kel? a ?crit :
> I have another idea.  As I'm going to build an ATtiny12 based IR decoder
> and wake-on-LAN trigger, I could monitor the system's +5V line with the
> ATtiny12.  If the +5V line was brought up as a result of pressing the
> Power key on the remote, we know that the box was powered up by the user.
> Otherwise it was powered up non-interactively, and softdevice should
> remain suspended.  (Let's pretend that the power button on the front panel
> does not exist or is not for interactive use.)

Than you got the hardware !
You don't have to monitor the +5V line, since the ATtiny itself will 
trigger the power-up, and will the only one to trigger an interactive 
power-up.
You can also connect the power button on the front panel to an input pin 
on the ATtiny, to also trigger the wake-on-lan and pass that info to the 
system.

> Maybe this information could be passed to VDR by having the ATtiny12 send
> manufactured "unsuspend" keycodes to the Hauppauge Nova-T IR receiver
> port until an IR code pulse arrives from the receiver module.

You can also input that information to the OS using the parallel or 
serial port : just set some line up for a long enough delay (1 min), 
letting VDR know why it was powered up.

-- 
NH


From marko.makela at hut.fi  Thu May 26 11:47:47 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 26 May 2005 12:47:47 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <42959786.5070704@e-dition.fr>
References: <20050525205040.GD187661@kosh.hut.fi> <42958D11.2010306@e-dition.fr> <20050526091411.GB3474@localhost.localdomain> <42959786.5070704@e-dition.fr>
Message-ID: <20050526094747.GD3474@localhost.localdomain>

On Thu, May 26, 2005 at 11:31:50AM +0200, Nicolas Huillard wrote:
> Marko M?kel? a ?crit :
> >I have another idea.  As I'm going to build an ATtiny12 based IR decoder
> >and wake-on-LAN trigger, I could monitor the system's +5V line with the
> >ATtiny12.  If the +5V line was brought up as a result of pressing the
> >Power key on the remote, we know that the box was powered up by the user.
> >Otherwise it was powered up non-interactively, and softdevice should
> >remain suspended.  (Let's pretend that the power button on the front panel
> >does not exist or is not for interactive use.)
> 
> Than you got the hardware !
> You don't have to monitor the +5V line, since the ATtiny itself will 
> trigger the power-up, and will the only one to trigger an interactive 
> power-up.
> You can also connect the power button on the front panel to an input pin 
> on the ATtiny, to also trigger the wake-on-lan and pass that info to the 
> system.

Well, I'm aiming for a simple device that will have four connectors:
to IR receiver module (+5V, GND, RC5 out), to TV card (+5V, GND, RC5 in),
to network card (Wake-on-LAN), and to mainboard (Wake-on-LAN).  Ideally,
I'd hotglue the circuit on the Hauppauge Nova-T card, but the prototype
will be plugged to the IR receiver jack.  That way, I can return the
card for warranty replacement if the smoke comes out. :-)

> >Maybe this information could be passed to VDR by having the ATtiny12 send
> >manufactured "unsuspend" keycodes to the Hauppauge Nova-T IR receiver
> >port until an IR code pulse arrives from the receiver module.
> 
> You can also input that information to the OS using the parallel or 
> serial port : just set some line up for a long enough delay (1 min), 
> letting VDR know why it was powered up.

True, or I could even input that information indefinitely on a spare
input pin.  The cx23882 on the Hauppauge card might have a spare GPIO
pin, but reading the pin would probably require changes to the kernel.

	Marko


From nhuillard at e-dition.fr  Thu May 26 12:30:50 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Thu, 26 May 2005 12:30:50 +0200
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state
 relay
In-Reply-To: <20050526094747.GD3474@localhost.localdomain>
References: <20050525205040.GD187661@kosh.hut.fi> <42958D11.2010306@e-dition.fr> <20050526091411.GB3474@localhost.localdomain> <42959786.5070704@e-dition.fr> <20050526094747.GD3474@localhost.localdomain>
Message-ID: <4295A55A.1060309@e-dition.fr>

Marko M?kel? a ?crit :
> On Thu, May 26, 2005 at 11:31:50AM +0200, Nicolas Huillard wrote:
> 
>>Marko M?kel? a ?crit :
>>
>>>I have another idea.  As I'm going to build an ATtiny12 based IR decoder
>>>and wake-on-LAN trigger, I could monitor the system's +5V line with the
>>>ATtiny12.  If the +5V line was brought up as a result of pressing the
>>>Power key on the remote, we know that the box was powered up by the user.
>>>Otherwise it was powered up non-interactively, and softdevice should
>>>remain suspended.  (Let's pretend that the power button on the front panel
>>>does not exist or is not for interactive use.)
>>
>>Than you got the hardware !
>>You don't have to monitor the +5V line, since the ATtiny itself will 
>>trigger the power-up, and will the only one to trigger an interactive 
>>power-up.
>>You can also connect the power button on the front panel to an input pin 
>>on the ATtiny, to also trigger the wake-on-lan and pass that info to the 
>>system.
> 
> Well, I'm aiming for a simple device that will have four connectors:
> to IR receiver module (+5V, GND, RC5 out), to TV card (+5V, GND, RC5 in),
> to network card (Wake-on-LAN), and to mainboard (Wake-on-LAN).  Ideally,
> I'd hotglue the circuit on the Hauppauge Nova-T card, but the prototype
> will be plugged to the IR receiver jack.  That way, I can return the
> card for warranty replacement if the smoke comes out. :-)

Do you know the Wake-on-LIRC project ? (http://markh.de/wakeonlirc/)
I thought you were using it, thus induced you were in the same setup 
(custom IR receiver connected to serial and wol : no 
proprietary/specific connector or driver, just plain serial).
Wake-on-LIRC is GPL, so you could hack it to make it work as you like 
(and everyone could benefit, regardless of the DVB card used ;-) ).

>>>Maybe this information could be passed to VDR by having the ATtiny12 send
>>>manufactured "unsuspend" keycodes to the Hauppauge Nova-T IR receiver
>>>port until an IR code pulse arrives from the receiver module.
>>
>>You can also input that information to the OS using the parallel or 
>>serial port : just set some line up for a long enough delay (1 min), 
>>letting VDR know why it was powered up.
> 
> True, or I could even input that information indefinitely on a spare
> input pin.  The cx23882 on the Hauppauge card might have a spare GPIO
> pin, but reading the pin would probably require changes to the kernel.

owfs, using the 1-wire chips, would have provided a really easy way to 
ask the chips what happenned (using the alarm bit inside the chip, 
accessed with a simple cat command), and connect everything to a single 
serial or USB port (IR trigger + solid-state relay + whatever you want 
and don't even need, like temperature sensor, rpm counter for your fan 
or power meter).
For those who don't know that yet : http://owfs.sourceforge.net/

-- 
NH


From marko.makela at hut.fi  Thu May 26 12:47:49 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 26 May 2005 13:47:49 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <4295A55A.1060309@e-dition.fr>
References: <20050525205040.GD187661@kosh.hut.fi> <42958D11.2010306@e-dition.fr> <20050526091411.GB3474@localhost.localdomain> <42959786.5070704@e-dition.fr> <20050526094747.GD3474@localhost.localdomain> <4295A55A.1060309@e-dition.fr>
Message-ID: <20050526104749.GG3474@localhost.localdomain>

On Thu, May 26, 2005 at 12:30:50PM +0200, Nicolas Huillard wrote:
> Do you know the Wake-on-LIRC project ? (http://markh.de/wakeonlirc/)
> I thought you were using it

No, I had a look at it and contacted the developer to find out if he
is interested in supporting slightly different hardware, i.e., if
I should try to patch his code or write my own.  It seems it's easier
to write my own (also GPL'd, of course).  If I remember correctly, his
code is mostly based on polling.  I'll try to use interrupts for
everything, to keep the ATtiny12 in power-saving mode.

My hardware will be much simpler: connectors, wire, an ATtiny12, and
a diode between the +5V supply from the Hauppauge card and the +5V
supply from the Wake-on-LAN connector.  Even the diode could be dropped,
but then the ATtiny12 might fry if the Wake-on-LAN cable is not
connected.

	Marko


From reinelt at eunet.at  Thu May 26 12:54:06 2005
From: reinelt at eunet.at (Michael Reinelt)
Date: Thu, 26 May 2005 12:54:06 +0200
Subject: [Softdevice-devel] [ANNOUNCE] tig - test image generator
Message-ID: <4295AACE.9010207@eunet.at>

Hi there,

some of you probably know the test images Nicolas Huillard provides at
http://nicolas.huillard.net/vdr/tv_test/

I created some of them, but as there are so many resolutions out there,
I decided to write a little tool called 'tig' that creates test images
in high quality for any resolution you may need.

Have a look at http://tig.bulix.org

Note that tig is in a very early stage, may contain lots of bugs, and
provides only two different images at the moment. But this will change
rapidly....


have fun, Michael

-- 
Michael Reinelt <reinelt at eunet.at>
http://home.pages.at/reinelt
GPG-Key 0xDF13BA50
ICQ #288386781


From M.Wache at gmx.net  Thu May 26 23:31:49 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 26 May 2005 23:31:49 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <20050525203048.GC187661@kosh.hut.fi>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <20050525203048.GC187661@kosh.hut.fi>
Message-ID: <42964045.5010903@gmx.net>

Marko M?kel? wrote:

> 
> I guess so.  If not on the Celeron of my VDR box, I can play some recordings
> on this Pentium-M and look for DCU_MISS_OUTSTANDING
> (number of cycles while DCU miss outstanding; DCU=data cache unit) or
> DATA_MEM_REFS (all memory references, cachable and non).
> opcontrol --list-events lists all possible events, but I can't start up
> my VDR box now.
Sounds good. I never tried to do it until now but also my new AMD64 
seems to have this option, but I will check again. Do you have any 
experience on this? Maybe there is something on the web how to measure 
the cache performance, I'll have a look. I started to use oprofile, it 
seems to be a really powerfull tool. I didn't see any example on 
measureing cache performance yet, although it should be possible.

So if also Nicolas joins the profiling we will get quite a nice sample 
of different processor/cache sizes :-)
What video-out method do you prefer? I usually use Xv so my first step 
would be to use Xv, but on my new box the X11 drivers are not in a good 
shape. So maybe I will try DirectFB...

> 
> 
>>The reason I'm asking is that currently the softdevice decodes a 
>>complete picture, sleeps until it is to be shown, copies the picture to 
>>the video memory and flips the page.
>>The sleep between decoding and copying is asking for cache misses.
> 
> 
> You could perhaps also add explicit prefetch instructions, i.e.,
> __builtin_prefetch().  I don't know which processors have the opcodes.
> At least the Pentium-M does.  But that would only help for reading
> the MPEG stream.
Prefetch calls are already used as far as I know (at least for the 
software alpha blending I'm sure), but as you already said for copying 
they don't help.

Martin


From M.Wache at gmx.net  Thu May 26 23:31:56 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 26 May 2005 23:31:56 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <20050525201440.GA187661@kosh.hut.fi>
References: <20050523202417.GA199519@kosh.hut.fi> <42949990.2030206@gmx.net> <20050525201440.GA187661@kosh.hut.fi>
Message-ID: <4296404C.5040109@gmx.net>

Marko M?kel? wrote:
> On Wed, May 25, 2005 at 05:28:16PM +0200, Martin Wache wrote:
> 
>>Unfortunatly it is very difficult to find the reasons for these crashes 
>>just with this information. It is possible to enable core dumps in your 
>>system, so that we can have this additional information? It would make 
>>finding the problem a lot easier...
> 
> 
> Sure.  It seems it will be just a matter of adding ulimit -c unlimited
> to the runvdr script.  I'll also add "sysctl kernel.core_pattern=core.%p"
> to the startup scripts in order to ensure that the files are less likely
> to be overwritten (in case there are multiple crashes).  Both SIGABRT
> and SIGSEGV seem to create a core dump by default (I tested with /bin/cat
> and an explicit kill from another virtual console.)
> 
And please compile the softdevice with the -g switch enabled, it is not 
the default!

I played a bit crash-me yesterday, I moved my antenna to get a bad 
signal and waited until the softdevice crashed. And indeed it payed off: 
I found a few places where I forgot to check pointers and one _really_ 
silly bug which caused a lot of problems on bad signal.
Now I can watch a station with almost no signal ( mostly noise, 
sometimes pieces of words, or parts of picture, or some movements 
nothing someone would want to watch) for more than a quater of an hour. 
There are still a few crashes which I couldn't track down yet, they 
happen in ffmpeg but the cause may be in the softdevice.
I will commit these fixes together with the HDTV patch (which I started 
to merge, but is not fully completed yet) hopefully on sunday, but I 
will send you an e-mail. So please update your installation to this 
version  when it's available before sending bug reports :-)

Looking forward for some more crash reports from you, and hoping that it 
will take long until you have something to report ;-)
Martin


From M.Wache at gmx.net  Thu May 26 23:32:08 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 26 May 2005 23:32:08 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <200505252152.44421.stefan@lucke.in-berlin.de>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <200505252152.44421.stefan@lucke.in-berlin.de>
Message-ID: <42964058.9030801@gmx.net>

Stefan Lucke wrote:

>>Maybe we should write somewhere that people should use I420 if possible 
>>(it is the native colorspace for mpeg2). YV12 is only there for people 
>>owning a graphics card which can't do I420 or YUV2. But I think 
>>I420/YUV2 is the default, or am I wrong?
> 
> 
> The native format is YV12. But someone does mess it up. That someone
> is either X11 or (directfb and vidix). For X11 we allocate and YV12 surface
> format and for the others I have to use I420 ;-) .
Yes, of course I messed it up the native format is YV12, but since for 
I420 the main difference is the swapped U and V plane at least I was not 
totally wrong :-/

So YV12/I420, if hardware accelerated are the prefered colorspaces. YUY2 
is a packed format so it will always require a format conversion.

> For X11 it would be best to request data in YUY2 format from ffmpeg,
> as I believe their conversions are more optimized than X11 ones.
> Many X11xv-out drivers do a convert from YV12 to YUV2
> in plain c-code. Look for routine names like copymungeddata().
But there are also cards which can do the planar modes in hardware, for 
instance my Rage128 and one of my Mach64 (note that not all Mach64 seem 
to support the planar modes).
In case of one of those cards it is much more preferable to use the 
native YV12 mode.

Martin



From stefan at lucke.in-berlin.de  Fri May 27 00:11:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 27 May 2005 00:11:39 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <4296404C.5040109@gmx.net>
References: <20050523202417.GA199519@kosh.hut.fi> <20050525201440.GA187661@kosh.hut.fi> <4296404C.5040109@gmx.net>
Message-ID: <200505270011.39381.stefan@lucke.in-berlin.de>

On Donnerstag, 26. Mai 2005 23:31, Martin Wache wrote:
> Marko M?kel? wrote:
> > On Wed, May 25, 2005 at 05:28:16PM +0200, Martin Wache wrote:
> > 
> >>Unfortunatly it is very difficult to find the reasons for these crashes 
> >>just with this information. It is possible to enable core dumps in your 
> >>system, so that we can have this additional information? It would make 
> >>finding the problem a lot easier...
> > 
> > 
> > Sure.  It seems it will be just a matter of adding ulimit -c unlimited
> > to the runvdr script.  I'll also add "sysctl kernel.core_pattern=core.%p"
> > to the startup scripts in order to ensure that the files are less likely
> > to be overwritten (in case there are multiple crashes).  Both SIGABRT
> > and SIGSEGV seem to create a core dump by default (I tested with /bin/cat
> > and an explicit kill from another virtual console.)
> > 
> And please compile the softdevice with the -g switch enabled, it is not 
> the default!

We should add -g as a default to Makefile. 

> 
> I played a bit crash-me yesterday, I moved my antenna to get a bad 
> signal and waited until the softdevice crashed. And indeed it payed off: 
> I found a few places where I forgot to check pointers and one _really_ 
> silly bug which caused a lot of problems on bad signal.
> Now I can watch a station with almost no signal ( mostly noise, 
> sometimes pieces of words, or parts of picture, or some movements 
> nothing someone would want to watch) for more than a quater of an hour. 
> There are still a few crashes which I couldn't track down yet, they 
> happen in ffmpeg but the cause may be in the softdevice.
> I will commit these fixes together with the HDTV patch (which I started 
> to merge, but is not fully completed yet) hopefully on sunday, but I 

Does this interfere with my posted aspect ratio patch ? 
I'll do some aditional work on directfb out. Coupling YUV2 to
stretchblit, and other formats to BES is eventually not required. So
I'll try to separate this.
You can even post a diff of an uncompleted state of work, as I somtimes
have crashes with bad signal too. Not allways in ffmpeg. When a
crash is in softdevice, it looks like a syncing issue between threads.

-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Fri May 27 01:28:14 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Fri, 27 May 2005 01:28:14 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <200505270011.39381.stefan@lucke.in-berlin.de>
References: <20050523202417.GA199519@kosh.hut.fi> <20050525201440.GA187661@kosh.hut.fi> <4296404C.5040109@gmx.net> <200505270011.39381.stefan@lucke.in-berlin.de>
Message-ID: <42965B8E.30306@users.sourceforge.net>

Stefan Lucke wrote:
> On Donnerstag, 26. Mai 2005 23:31, Martin Wache wrote:
>> Marko M?kel? wrote:
>> > On Wed, May 25, 2005 at 05:28:16PM +0200, Martin Wache wrote:
>> > 
>> >>Unfortunatly it is very difficult to find the reasons for these crashes 
>> >>just with this information. It is possible to enable core dumps in your 
>> >>system, so that we can have this additional information? It would make 
>> >>finding the problem a lot easier...
>> > 
>> > 
>> > Sure.  It seems it will be just a matter of adding ulimit -c unlimited
>> > to the runvdr script.  I'll also add "sysctl kernel.core_pattern=core.%p"
>> > to the startup scripts in order to ensure that the files are less likely
>> > to be overwritten (in case there are multiple crashes).  Both SIGABRT
>> > and SIGSEGV seem to create a core dump by default (I tested with /bin/cat
>> > and an explicit kill from another virtual console.)
>> > 
>> And please compile the softdevice with the -g switch enabled, it is not 
>> the default!
> 
> We should add -g as a default to Makefile. 
> 
>> 
>> I played a bit crash-me yesterday, I moved my antenna to get a bad 
>> signal and waited until the softdevice crashed. And indeed it payed off: 
>> I found a few places where I forgot to check pointers and one _really_ 
>> silly bug which caused a lot of problems on bad signal.
>> Now I can watch a station with almost no signal ( mostly noise, 
>> sometimes pieces of words, or parts of picture, or some movements 
>> nothing someone would want to watch) for more than a quater of an hour. 
>> There are still a few crashes which I couldn't track down yet, they 
>> happen in ffmpeg but the cause may be in the softdevice.
>> I will commit these fixes together with the HDTV patch (which I started 
>> to merge, but is not fully completed yet) hopefully on sunday, but I 
> 
> Does this interfere with my posted aspect ratio patch ? 
> I'll do some aditional work on directfb out. Coupling YUV2 to
> stretchblit, and other formats to BES is eventually not required. So
> I'll try to separate this.
> You can even post a diff of an uncompleted state of work, as I somtimes
> have crashes with bad signal too. Not allways in ffmpeg. When a
> crash is in softdevice, it looks like a syncing issue between threads.

Hi,

I hadn't time to try softdevice for a long time now, but now I checked 
0.1.2 and it looks very well again on my Matrox G400 TV-out (SCART-RGB, 
DirectFB). You might remember I started a thread on this ML once, about 
terrible judder. Now it's all gone, the fields are displayed in the 
right order, no more combs, it's really nice, except some (maybe) 
syncing attemp from time to time where the image jumps a little (only 
noticeable on constantly moving scenes (like scrolling text), or very 
slow motion scenes).
I also had few crashes in my testings, maybe also due to bad signal when 
switching between LNBs via 4/1 diseqc switch.

On the audio side, now there is no more AC3 decoding (maybe becasue I 
set DD5.1 SPDIF in softdevice's setup, which is not yet implemented, am 
I right?). I'll wait for the *real* AC3 passthrough feature, I hope 
that's not too hard to do.
Mono MP2 is still muted on the SPDIF (don't know if on analog speakers 
on my C-Media soundcard too, I have no analogue connection and also am a 
bit afraid to mess with the ALSA configuration), maybe an upmix to 2 
channels is required here (I  think you might actually test this on CNN 
on Astra 19.2).

To sum up, I'm glad that it works pretty well again on my G400 CRTC2 
with DFB, I know the rest is more or less on the TODO list. Thank you, 
and keep up the good work!

Lucian


From M.Wache at gmx.net  Fri May 27 10:10:21 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Fri, 27 May 2005 10:10:21 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <200505270011.39381.stefan@lucke.in-berlin.de>
References: <20050523202417.GA199519@kosh.hut.fi> <20050525201440.GA187661@kosh.hut.fi> <4296404C.5040109@gmx.net> <200505270011.39381.stefan@lucke.in-berlin.de>
Message-ID: <4296D5ED.4070901@gmx.net>

Stefan Lucke wrote:
> On Donnerstag, 26. Mai 2005 23:31, Martin Wache wrote:
> 
>>Marko M?kel? wrote:
>>
>>>On Wed, May 25, 2005 at 05:28:16PM +0200, Martin Wache wrote:
>>>
>>>
>>>>Unfortunatly it is very difficult to find the reasons for these crashes 
>>>>just with this information. It is possible to enable core dumps in your 
>>>>system, so that we can have this additional information? It would make 
>>>>finding the problem a lot easier...
>>>
>>>
>>>Sure.  It seems it will be just a matter of adding ulimit -c unlimited
>>>to the runvdr script.  I'll also add "sysctl kernel.core_pattern=core.%p"
>>>to the startup scripts in order to ensure that the files are less likely
>>>to be overwritten (in case there are multiple crashes).  Both SIGABRT
>>>and SIGSEGV seem to create a core dump by default (I tested with /bin/cat
>>>and an explicit kill from another virtual console.)
>>>
>>
>>And please compile the softdevice with the -g switch enabled, it is not 
>>the default!
> 
> 
> We should add -g as a default to Makefile. 
> 
> 
>>I played a bit crash-me yesterday, I moved my antenna to get a bad 
>>signal and waited until the softdevice crashed. And indeed it payed off: 
>>I found a few places where I forgot to check pointers and one _really_ 
>>silly bug which caused a lot of problems on bad signal.
>>Now I can watch a station with almost no signal ( mostly noise, 
>>sometimes pieces of words, or parts of picture, or some movements 
>>nothing someone would want to watch) for more than a quater of an hour. 
>>There are still a few crashes which I couldn't track down yet, they 
>>happen in ffmpeg but the cause may be in the softdevice.
>>I will commit these fixes together with the HDTV patch (which I started 
>>to merge, but is not fully completed yet) hopefully on sunday, but I 
> 
> 
> Does this interfere with my posted aspect ratio patch ? 
No, not the HDTV patch.
> I'll do some aditional work on directfb out. Coupling YUV2 to
> stretchblit, and other formats to BES is eventually not required. So
> I'll try to separate this.
> You can even post a diff of an uncompleted state of work, as I somtimes
> have crashes with bad signal too. Not allways in ffmpeg. When a
> crash is in softdevice, it looks like a syncing issue between threads.
> 
Hmm, yes, that's probably the _very_ silly bug I've found. In 
QueuePacket(), when I want to restart the video, I stop the videoOut, 
delete the _audioOut_ and set the pointer to videoOut to null.
The result is quite unpredictable, sometimes the videoOut doesn't 
restart properly, sometimes the softdevice crashes in BufferFill and 
sometimes in the audioOut class (which happens supprisingly seldom).

Martin


From stefan at lucke.in-berlin.de  Fri May 27 10:26:59 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 27 May 2005 10:26:59 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <4296D5ED.4070901@gmx.net>
References: <20050523202417.GA199519@kosh.hut.fi> <200505270011.39381.stefan@lucke.in-berlin.de> <4296D5ED.4070901@gmx.net>
Message-ID: <200505271026.59640.stefan@lucke.in-berlin.de>

On Freitag, 27. Mai 2005 10:10, Martin Wache wrote:
> Stefan Lucke wrote:
> > On Donnerstag, 26. Mai 2005 23:31, Martin Wache wrote:

> >>I played a bit crash-me yesterday, I moved my antenna to get a bad 
> >>signal and waited until the softdevice crashed. And indeed it payed off: 
> >>I found a few places where I forgot to check pointers and one _really_ 
> >>silly bug which caused a lot of problems on bad signal.
> >>Now I can watch a station with almost no signal ( mostly noise, 
> >>sometimes pieces of words, or parts of picture, or some movements 
> >>nothing someone would want to watch) for more than a quater of an hour. 
> >>There are still a few crashes which I couldn't track down yet, they 
> >>happen in ffmpeg but the cause may be in the softdevice.
> >>I will commit these fixes together with the HDTV patch (which I started 
> >>to merge, but is not fully completed yet) hopefully on sunday, but I 
> > 
> > 
> > Does this interfere with my posted aspect ratio patch ? 
> No, not the HDTV patch.
> > I'll do some aditional work on directfb out. Coupling YUV2 to
> > stretchblit, and other formats to BES is eventually not required. So
> > I'll try to separate this.
> > You can even post a diff of an uncompleted state of work, as I somtimes
> > have crashes with bad signal too. Not allways in ffmpeg. When a
> > crash is in softdevice, it looks like a syncing issue between threads.
> > 
> Hmm, yes, that's probably the _very_ silly bug I've found. In 
> QueuePacket(), when I want to restart the video, I stop the videoOut, 
> delete the _audioOut_ and set the pointer to videoOut to null.
> The result is quite unpredictable, sometimes the videoOut doesn't 
> restart properly, sometimes the softdevice crashes in BufferFill and 
> sometimes in the audioOut class (which happens supprisingly seldom).

That seems to be the same direction I was looking. I tried to fix that
by adding mutex.Lock() around the deallocation all (all?) functions
which access video or audio out. But that was not enough so I
didn't commit that. If you found the real bug, thats fine.

Stefan Lucke



From nhuillard at e-dition.fr  Fri May 27 11:02:22 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 27 May 2005 11:02:22 +0200
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <4296404C.5040109@gmx.net>
References: <20050523202417.GA199519@kosh.hut.fi> <42949990.2030206@gmx.net> <20050525201440.GA187661@kosh.hut.fi> <4296404C.5040109@gmx.net>
Message-ID: <4296E21E.2040706@e-dition.fr>

Martin Wache a ?crit :

> Looking forward for some more crash reports from you, and hoping that it 
> will take long until you have something to report ;-)

Wouldn't it be quite easy to create a main() function for crash-testing 
and performance-tuning needs ?
Something like a pseudo VDR that will link everything needed, and play a 
recording which name is given on the command-line.
That would make performance comparable between many platforms, users, 
even runs. And crash-test would only require pseudo stream generation.

-- 
NH


From marko.makela at hut.fi  Fri May 27 17:31:19 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 27 May 2005 18:31:19 +0300
Subject: [Softdevice-devel] OProfile success story and some performance measurement tips
In-Reply-To: <42964045.5010903@gmx.net>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <20050525203048.GC187661@kosh.hut.fi> <42964045.5010903@gmx.net>
Message-ID: <20050527153119.GA230371@kosh.hut.fi>

Martin,

> >I guess so.  If not on the Celeron of my VDR box, I can play some 
> >recordings
> >on this Pentium-M and look for DCU_MISS_OUTSTANDING
> >(number of cycles while DCU miss outstanding; DCU=data cache unit) or
> >DATA_MEM_REFS (all memory references, cachable and non).
> >opcontrol --list-events lists all possible events, but I can't start up
> >my VDR box now.
> Sounds good. I never tried to do it until now but also my new AMD64 
> seems to have this option, but I will check again.

DCU_MISS_OUTSTANDING is available on Pentium III, including Celeron.

> Do you have any experience on this?

I measured InnoDB performance and found out that data cache miss made
a single machine instruction use several percent of total execution
time in one test case.  It was accessing the InnoDB adaptive hash index,
which of course wouldn't fit in the cache memory.  Actually, the execution
time was reported for an instruction one or two positions after the actual
data fetch.  I guess this is due to pipelining.

I just made a measurement with 
opcontrol --event=DCU_MISS_OUTSTANDING:7500
on the beginning of a recorded clip, containing mostly computer-generated
images but also some talking heads.  Here's the top from
opreport -t1 -l PLUGINS/lib/libvdr-softdevice.so.1.3.24:

CPU: PIII, speed 906.672 MHz (estimated)
Counted DCU_MISS_OUTSTANDING events (number of cycles while DCU miss
outstanding) with a unit mask of 0x00 (No unit mask) count 7500
samples  %        symbol name
80123    15.5482  put_pixels16_mmx
67713    13.1400  put_pixels16_xy2_mmx
59967    11.6369  put_pixels8_mmx
30927     6.0015  avg_pixels16_xy2_mmx2
30779     5.9728  put_pixels16_y2_mmx2
29456     5.7161  put_pixels16_x2_mmx2
29079     5.6429  avg_pixels16_mmx2
21563     4.1844  avg_pixels8_mmx2
21021     4.0792  put_pixels8_x2_mmx2
19272     3.7398  put_pixels8_y2_mmx2
13639     2.6467  avg_pixels16_x2_mmx2
12241     2.3754  put_pixels8_xy2_mmx
12058     2.3399  avg_pixels16_y2_mmx2
12000     2.3287  mpeg2_decode_block_non_intra
8700      1.6883  avg_pixels8_x2_mmx2
7610      1.4768  avg_pixels8_y2_mmx2
6530      1.2672  mpeg2_decode_block_intra
6382      1.2385  ff_mpeg1_find_frame_end
5872      1.1395  avg_pixels8_xy2_mmx2
5625      1.0916  mpeg_decode_mb

The {put,avg}_pixels functions are in ffmpeg,
file libavcodec/i386/dsputil_mmx.c.  According to opstack output,
they are called by MPV_motion.  If I'm guessing right, these
functions are accessing the decompressed picture data.  Maybe
explicit prefetch instructions would help after all?

> Maybe there is something on the web how to measure the cache performance,
> I'll have a look.

If you don't find anything, just collect some samples with oprofile
(and don't forget "opcontrol --reset" between "opcontrol --stop" and
"opcontrol --start") and make repeatable and controlled experiments,
not modifying too many parameters (or lines of code) at a time.

As I'm writing this, I'm replaying the same portion of the clip with
DATA_MEM_REFS:7500.  I think it might be more fruitful to pay attention
to this performance counter, as it could reveal some unnecessary memory
accesses that do not happen to show up as cache misses.  Yes, here the
top 99% percentile looks different:

CPU: PIII, speed 906.672 MHz (estimated)
Counted DATA_MEM_REFS events (all memory references, cachable and non)
with a unit mask of 0x00 (No unit mask) count 7500
samples  %        symbol name
108722   15.8219  ff_simple_idct_add_mmx
84480    12.2941  mpeg2_decode_block_non_intra
63379     9.2233  ff_mpa_synth_filter
44302     6.4471  cStreamDecoder::BufferFill()
43877     6.3853  mpeg_decode_mb
28323     4.1217  MPV_decode_mb
26280     3.8244  mpeg2_decode_block_intra
25913     3.7710  MPV_motion
25898     3.7688  put_pixels16_mmx
23264     3.3855  put_pixels8_mmx
22451     3.2672  add_pixels_clamped_mmx
22208     3.2318  mpeg_decode_motion
20633     3.0026  clear_blocks_mmx
20561     2.9922  ff_simple_idct_put_mmx
16520     2.4041  mp_decode_layer2
13938     2.0283  dct32
12643     1.8399  cMpeg2Decoder::BufferFill()
11050     1.6081  cSoftDevice::Poll(cPoller&, int)
10729     1.5614  mpeg_decode_slice
10110     1.4713  put_pixels16_xy2_mmx
7299      1.0622  ff_mpeg1_find_frame_end
7287      1.0605  avg_pixels8_mmx2

> So if also Nicolas joins the profiling we will get quite a nice sample 
> of different processor/cache sizes :-)

I hope that the VIAllinen processors are supported by oprofile. :-)

> What video-out method do you prefer? I usually use Xv so my first step 
> would be to use Xv, but on my new box the X11 drivers are not in a good 
> shape. So maybe I will try DirectFB...

I prefer DirectFB, as my box tries to be a single-purpose box that can
be controlled by the remote control.  But I do have an X11 installation
that can be used if needed.  Anyway, I think it's easier to make measurements
when everything is in a single process.

By the way, DirectFB wasn't linked statically in my experiments.  The numbers
of samples logged for libdfb++ and libdirect were insignificant (about 50
total in the DATA_MEM_REFS case).  Also VDR wasn't linked statically,
because I was too lazy to dig up your patch for that.  For VDR, the top for
the DATA_MEM_REFS case looks like this:
CPU: PIII, speed 906.672 MHz (estimated)
Counted DATA_MEM_REFS events (all memory references, cachable and non) with a unit mask of 0x00 (No unit mask) count 7500
samples  %        symbol name
17894    29.8139  cDvbPlayer::Action()
8546     14.2388  cMutex::Lock()
5635      9.3887  anonymous symbol from section .plt
4879      8.1291  cNonBlockingFileReader::Read(int, unsigned char*, int)
4156      6.9245  cPoller::cPoller(int, bool)
3506      5.8415  cThreadLock::Lock(cThread*)
2983      4.9701  cThreadLock::cThreadLock(cThread*)
2881      4.8001  cRingBufferFrame::Get()
2386      3.9754  cMutex::Unlock()
2321      3.8671  cPoller::Add(int, bool)
1463      2.4376  cDvbPlayer::NextFile(unsigned char, int)

Total number of samples is about 17894/.298139 = 60018.  For softdevice,
the total is about 108722/.158219 = 687161, over ten times more.  So, I
think we can concentrate on libvdr-softdevice in the DATA_MEM_REFS case.

> >You could perhaps also add explicit prefetch instructions, i.e.,
> >__builtin_prefetch().  I don't know which processors have the opcodes.
> >At least the Pentium-M does.  But that would only help for reading
> >the MPEG stream.
> Prefetch calls are already used as far as I know (at least for the 
> software alpha blending I'm sure), but as you already said for copying 
> they don't help.

You can prefetch also for write access.  A cache line is something like
16 or 32 bytes.  If you're writing 1 byte, you will need to read and write
the whole cache line.  So, prefetching can help.

I've heard that some Intel processors have automatic prefetching.
Nevertheless, it might be useful to experiment with explicit prefetch
instructions.

	Marko


From leo at calidae.net  Fri May 27 18:03:37 2005
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Fri, 27 May 2005 18:03:37 +0200
Subject: [Softdevice-devel] undefined symbol: dts_frame
Message-ID: <429744D9.6090304@calidae.net>

Well, finally I  have obtained vdr with softdevice build from source.
Now when I start vdr with:

./vdr -P "softdevice -vo=dfb:"

I get:

vdr: ./PLUGINS/lib/libvdr-softdevice.so.1.3.24: undefined symbol: dts_frame

I think I'm near the end of the way...

Thanks


From stefan at lucke.in-berlin.de  Fri May 27 22:36:46 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 27 May 2005 22:36:46 +0200
Subject: [Softdevice-devel] undefined symbol: dts_frame
In-Reply-To: <429744D9.6090304@calidae.net>
References: <429744D9.6090304@calidae.net>
Message-ID: <200505272236.46743.stefan@lucke.in-berlin.de>

On Freitag, 27. Mai 2005 18:03, Leo M?rquez wrote:
> Well, finally I  have obtained vdr with softdevice build from source.
> Now when I start vdr with:
> 
> ./vdr -P "softdevice -vo=dfb:"
> 
> I get:
> 
> vdr: ./PLUGINS/lib/libvdr-softdevice.so.1.3.24: undefined symbol: dts_frame

This question came up on 2005-01-07 first.
http://lists.berlios.de/pipermail/softdevice-devel/2005q1/000140.html

That time, it seemed to be related to compile options of fmpeg and a
debian shipped libavcodec.

-- 
Stefan Lucke



From marko.makela at hut.fi  Sat May 28 14:56:13 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 28 May 2005 15:56:13 +0300
Subject: [Softdevice-devel] Unrepeatable crashes
In-Reply-To: <4296404C.5040109@gmx.net>
References: <20050523202417.GA199519@kosh.hut.fi> <42949990.2030206@gmx.net> <20050525201440.GA187661@kosh.hut.fi> <4296404C.5040109@gmx.net>
Message-ID: <20050528125613.GA3155@localhost.localdomain>

On Thu, May 26, 2005 at 11:31:56PM +0200, Martin Wache wrote:
> I found a few places where I forgot to check pointers and one _really_ 
> silly bug which caused a lot of problems on bad signal.

You told me not to report bugs for the old code, but I thought I'd share
this.  I got a crash this morning, when my 23-month-old son pressed the
Power button for too long time, so that it would repeat 3 or 4 times.
VDR crashed with SIGABRT.  In the log, a few lines before the SIGABRT
notice, I saw a message "pure virtual method called".  From my
experience with g++ and its runtime, one possible cause of this message
is invoking the methods of a freed object.

I completed the assembly of my relay box and I'm right now figuring out
how to raise RTS, or why raising RTS does not do anything.

Any ideas how to bind a "toggle suspend" key to the remote control?
Maybe I'll just copy the code from the "toggle cropmode" logic.

	Marko


From stefan at lucke.in-berlin.de  Sat May 28 18:24:20 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 28 May 2005 18:24:20 +0200
Subject: pure virtual method called (WAS: Re: [Softdevice-devel] Unrepeatable crashes)
Message-ID: <200505281824.20226.stefan@lucke.in-berlin.de>

On Samstag, 28. Mai 2005 14:56, Marko M?kel? wrote:
> On Thu, May 26, 2005 at 11:31:56PM +0200, Martin Wache wrote:
> > I found a few places where I forgot to check pointers and one _really_ 
> > silly bug which caused a lot of problems on bad signal.
> 
> You told me not to report bugs for the old code, but I thought I'd share
> this.  I got a crash this morning, when my 23-month-old son pressed the
> Power button for too long time, so that it would repeat 3 or 4 times.
> VDR crashed with SIGABRT.  In the log, a few lines before the SIGABRT
> notice, I saw a message "pure virtual method called". 

Whats the list of your loaded plugins ?
I saw this message some time ago with streamdev plugin. I think we
need a gdb bt for such a crash.

> From my
> experience with g++ and its runtime, one possible cause of this message
> is invoking the methods of a freed object.
> 

Ack.

-- 
Stefan Lucke



From marko.makela at hut.fi  Sun May 29 08:38:59 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 29 May 2005 09:38:59 +0300
Subject: pure virtual method called (WAS: Re: [Softdevice-devel] Unrepeatable crashes)
In-Reply-To: <200505281824.20226.stefan@lucke.in-berlin.de>
References: <200505281824.20226.stefan@lucke.in-berlin.de>
Message-ID: <20050529063859.GA3073@localhost.localdomain>

On Sat, May 28, 2005 at 06:24:20PM +0200, Stefan Lucke wrote:
> On Samstag, 28. Mai 2005 14:56, Marko M?kel? wrote:
> > On Thu, May 26, 2005 at 11:31:56PM +0200, Martin Wache wrote:
> > > I found a few places where I forgot to check pointers and one _really_ 
> > > silly bug which caused a lot of problems on bad signal.
> > 
> > You told me not to report bugs for the old code, but I thought I'd share
> > this.  I got a crash this morning, when my 23-month-old son pressed the
> > Power button for too long time, so that it would repeat 3 or 4 times.
> > VDR crashed with SIGABRT.  In the log, a few lines before the SIGABRT
> > notice, I saw a message "pure virtual method called". 
> 
> Whats the list of your loaded plugins ?

-Psoftdevice -Psubtitles.  I'm running vdr 1.3.24 with the patches from
subtitles 0.3.7.

> I saw this message some time ago with streamdev plugin. I think we
> need a gdb bt for such a crash.

I found the core file.  Here is a backtrace:

bt full
#0  0xb794a961 in cSoftOsd::~cSoftOsd ()
   from ./PLUGINS/lib/libvdr-softdevice.so.1.3.24
No symbol table info available.
#1  0xb779b0c9 in SubtitlesViewer::Hide (this=0x82fe330) at viewer.c:51
        lock = {mutex = 0x82d44a0, locked = true}
#2  0x080ef348 in NonInteractiveOsdPatch::cOsdController::Unsubscribe (
    this=0x81b4e98, listener=0x82fe330) at osdcontroller.c:93
        llo = (NonInteractiveOsdPatch::cListenerListObject *) 0x84e27f8
        iMutex = {mutex = 0x0, locked = false}
#3  0xb7799685 in ~cSubtitlesReceiver (this=0x82fe1f0) at receiver.c:36
No locals.
#4  0xb77a2008 in ~cSubtitlesChangedHandler (this=0xb77ad0c0)
    at subfilter.c:329
No locals.
#5  0xb77a5602 in __tcf_0 () at subfilter.c:449
No locals.
#6  0xb7d82de1 in __cxa_finalize () from /lib/libc.so.6
No symbol table info available.
#7  0xb7798980 in __do_global_dtors_aux ()
   from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
No symbol table info available.
#8  0xb77a71b6 in _fini () from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
No symbol table info available.
#9  0xb7e5f4a8 in _dl_close () from /lib/libc.so.6
No symbol table info available.
#10 0x00000033 in ?? ()
No symbol table info available.


It looks like I'll have to report this to the author of libvdr-subtitles.

	Marko


From stefan at lucke.in-berlin.de  Sun May 29 10:05:08 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 29 May 2005 10:05:08 +0200
Subject: pure virtual method called (WAS: Re: [Softdevice-devel] Unrepeatable crashes)
In-Reply-To: <20050529063859.GA3073@localhost.localdomain>
References: <200505281824.20226.stefan@lucke.in-berlin.de> <20050529063859.GA3073@localhost.localdomain>
Message-ID: <200505291005.08653.stefan@lucke.in-berlin.de>

On Sonntag, 29. Mai 2005 08:38, Marko M?kel? wrote:
> On Sat, May 28, 2005 at 06:24:20PM +0200, Stefan Lucke wrote:
> > On Samstag, 28. Mai 2005 14:56, Marko M?kel? wrote:
> > > On Thu, May 26, 2005 at 11:31:56PM +0200, Martin Wache wrote:
> > > > I found a few places where I forgot to check pointers and one _really_ 
> > > > silly bug which caused a lot of problems on bad signal.
> > > 
> > > You told me not to report bugs for the old code, but I thought I'd share
> > > this.  I got a crash this morning, when my 23-month-old son pressed the
> > > Power button for too long time, so that it would repeat 3 or 4 times.
> > > VDR crashed with SIGABRT.  In the log, a few lines before the SIGABRT
> > > notice, I saw a message "pure virtual method called". 
> > 
> > Whats the list of your loaded plugins ?
> 
> -Psoftdevice -Psubtitles.  I'm running vdr 1.3.24 with the patches from
> subtitles 0.3.7.
> 
> > I saw this message some time ago with streamdev plugin. I think we
> > need a gdb bt for such a crash.
> 
> I found the core file.  Here is a backtrace:
> 

> bt full
> #0  0xb794a961 in cSoftOsd::~cSoftOsd ()
>    from ./PLUGINS/lib/libvdr-softdevice.so.1.3.24
> No symbol table info available.
> #1  0xb779b0c9 in SubtitlesViewer::Hide (this=0x82fe330) at viewer.c:51
>         lock = {mutex = 0x82d44a0, locked = true}

> 
> It looks like I'll have to report this to the author of libvdr-subtitles.

No, crash is softdevice. It seems to be a locking/thread issue.
We have to wait for Martin's fix and look if that is fixed too.


-- 
Stefan Lucke



From marko.makela at hut.fi  Sun May 29 10:36:07 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 29 May 2005 11:36:07 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <20050525205040.GD187661@kosh.hut.fi>
References: <20050525205040.GD187661@kosh.hut.fi>
Message-ID: <20050529083607.GD477139@kosh.hut.fi>

On Wed, May 25, 2005 at 11:50:40PM +0300, Marko M?kel? wrote:
> This may be a bit off-topic for this list, but I have built a simple 10A
> power control box that has a switch (ON/OFF/programmatic), a fuse and a
> solid-state relay.
[...]
> In the switch position "programmatic", the power is controlled by an RS-232
> handshaking line from the PC.  This allows the VDR to power the monitor and
> speakers on and off as needed.  I would like to connect the relay to the
> softdevice "suspended" flag, i.e., when softdevice playback is suspended,
> the display will be off.

Okay, I finally have completed the unit, but haven't integrated it to
softdevice yet.  I would appreciate some insight there; how to implement
this hook for all playback methods (DirectFB, Xv and so on).  I've attached
a minimal test program for controlling the relay.  The test program has the
getchar() loop, because the TxD line will be released and the relay will be
switched off on close().

The relay is controlled via TxD, because I noticed that I had fried RTS
on both serial ports when I had tested a connection with a faulty cable.
(TxD/RxD were crossed over but RTS/CTS were not).  The schematic diagram
is simple.  TxD and GND are connected to the inputs of the solid-state
relay via a diode, so that the relay will only connect if TxD > GND, that
is, a BREAK signal is present on the RS-232 port.  On the 230-volt side,
there is a fuse and a ON-OFF-ON switch for bypassing the relay.

If anyone is interested in building this (I surely can't be the only one
who wants to control the whole VDR equipment with a single remote control),
I can provide more information and pictures.

	Marko
-------------- next part --------------
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/ioctl.h>
#include <fcntl.h>

int
main (int argc, char** argv)
{
  int fd;
  int bit;
  if (argc != 3) {
    fprintf (stderr, "Usage: %s /dev/ttyS0 0|1\n", argv[0]);
    return EXIT_FAILURE;
  }

  bit = atoi (argv[2]);
  fd = open (argv[1], O_RDWR | O_NOCTTY | O_NONBLOCK);

  if (fd < 0) {
    perror ("open");
    return EXIT_FAILURE;
  }
  if (ioctl (fd, bit ? TIOCSBRK : TIOCCBRK, 0)) {
    perror ("ioctl");
    return EXIT_FAILURE;
  }
  while (getchar() != EOF);
  if (close (fd)) {
    perror ("close");
    return EXIT_FAILURE;
  }
  return EXIT_SUCCESS;
}

From stefan at lucke.in-berlin.de  Sun May 29 13:29:54 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 29 May 2005 13:29:54 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
Message-ID: <200505291329.54431.stefan@lucke.in-berlin.de>

Hi,

with latest changes I get many xrun messages in syslog. They are audible too.
A/V sync seems to not ok. That is during live view.

May 29 13:23:57 jarada vdr[3357]: [softdevice-audio]: xrun
May 29 13:24:44 jarada last message repeated 15 times
May 29 13:25:49 jarada last message repeated 21 times
May 29 13:26:49 jarada last message repeated 12 times
May 29 13:27:49 jarada last message repeated 13 times
May 29 13:28:49 jarada last message repeated 2 times

-- 
Stefan Lucke



From M.Wache at gmx.net  Sun May 29 15:06:15 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 29 May 2005 15:06:15 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <200505291329.54431.stefan@lucke.in-berlin.de>
References: <200505291329.54431.stefan@lucke.in-berlin.de>
Message-ID: <4299BE47.7070805@gmx.net>

Stefan Lucke wrote:
> Hi,
> 
> with latest changes I get many xrun messages in syslog. They are audible too.
> A/V sync seems to not ok. That is during live view.
> 
> May 29 13:23:57 jarada vdr[3357]: [softdevice-audio]: xrun
> May 29 13:24:44 jarada last message repeated 15 times
> May 29 13:25:49 jarada last message repeated 21 times
> May 29 13:26:49 jarada last message repeated 12 times
> May 29 13:27:49 jarada last message repeated 13 times
> May 29 13:28:49 jarada last message repeated 2 times
> 
The cause for this is that I reduced the buffer sizes, I plan to make it 
possible to choose between "good seeking" (that is currently the 
default), a save buffer (like it was bevore), and HDTV buffers.
The good seeking buffer is as large as the FF card buffers, that means 
that when seeking backward vdr will correctly guess the current position.
Right now the switch to choose the buffer size is still missing, so one 
can't chosse yet :-(, but I'll add this feature soon.

Martin


From juniper81 at gmail.com  Sun May 29 18:48:57 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Sun, 29 May 2005 19:48:57 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
Message-ID: <b7bb36410505290948421de228@mail.gmail.com>

Hey,

My problem is that recorded files don't play smoothly. There's lots of
glitches in the video. Live TV plays greatly. I'm using softdevice
with DirectFB with mgatv output method. Here's some info of my system:

Software:

- Fedora core 2 linux
- vdr 1.3.23
- softdevice 0.1.2
- DirecFB 0.9.23
- ffmpeg 0.4.9-pre1, build 4748

Hardware:

- AMD Athlon XP 1700+ processor
- Matrox G450 graphics card
- IBM-DJNA-352030 5400 rpm hard disk drive
- D-link DWL-510 Wireless LAN card

Previously I had problems with live tv as well (while recording if I
remember correctly) but it turned out that DMA was not turned on for
HDD. I'm not sure is it fast enough even now. hdparm says:

 Timing buffer-cache reads:   828 MB in  2.00 seconds = 413.86 MB/sec
 Timing buffered disk reads:   42 MB in  3.01 seconds =  13.96 MB/sec

Currently the /video partition is on ext3 filesystem. I have
considered trying ReiserFS but that seems to need kernel patching &
compilation and quite a lot of things to do so I've been a bit
reluctant doing it if it isn't necessary.

One thing that might cause problems is that Matrox and SBLive seem to
use same IRQ. The problem is that I don't know how to tell SBLive to
use a different one. But I think that IRQ sharing isn't causing this
because I guess glitches should appear in live tv also.

Another problem I'm facing is that when vdr starts it looks every time
for a remote control. This means more annoying waiting in startup. I
have compiled VDR with options NO_KBD and REMOTE=LIRC because I use
lirc.


From torgeir at pobox.com  Sun May 29 21:49:27 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 29 May 2005 20:49:27 +0100
Subject: [Softdevice-devel] Problems while playing recordings and in
	startup
In-Reply-To: <b7bb36410505290948421de228@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>
Message-ID: <1117396167.14625.17.camel@africa>

On Sun, 2005-05-29 at 19:48 +0300, Ari Koponen wrote:

> My problem is that recorded files don't play smoothly. 

I have the same problem. This isn't a SATA harddrive, is it? I was
suspecting it might be a SATA controller/disc issue.

> - IBM-DJNA-352030 5400 rpm hard disk drive

> Previously I had problems with live tv as well (while recording if I
> remember correctly) but it turned out that DMA was not turned on for
> HDD. I'm not sure is it fast enough even now. hdparm says:
> 
>  Timing buffer-cache reads:   828 MB in  2.00 seconds = 413.86 MB/sec
>  Timing buffered disk reads:   42 MB in  3.01 seconds =  13.96 MB/sec

See if changing readahead improves the situation. Try eg. 

hdparm -t -a8192 /dev/hda

This improves it slightly for me, but not completely.

> But I think that IRQ sharing isn't causing this
> because I guess glitches should appear in live tv also.

I agree with this. I can record multiple recordings at once with no
problems. (athlon 2500+, SATA harddrives, DirectFB/Xv output)

> Another problem I'm facing is that when vdr starts it looks every time
> for a remote control. This means more annoying waiting in startup. I
> have compiled VDR with options NO_KBD and REMOTE=LIRC because I use
> lirc.

The DirectFB output method implements keyboard input as well.

-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Sun May 29 22:00:48 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 29 May 2005 21:00:48 +0100
Subject: [Softdevice-devel] Problems while playing recordings and in
	startup
In-Reply-To: <b7bb36410505290948421de228@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>
Message-ID: <1117396848.14625.20.camel@africa>

On Sun, 2005-05-29 at 19:48 +0300, Ari Koponen wrote:
> 
>  Timing buffer-cache reads:   828 MB in  2.00 seconds = 413.86 MB/sec
>  Timing buffered disk reads:   42 MB in  3.01 seconds =  13.96 MB/sec

This wasn't very fast though. On my machine with IDE discs using
UDMA100;

/dev/hda:
 Timing cached reads:   1548 MB in  2.00 seconds = 774.12 MB/sec
 Timing buffered disk reads:  126 MB in  3.01 seconds =  41.91 MB/sec

/dev/hdb:
 Timing cached reads:   1628 MB in  2.00 seconds = 813.31 MB/sec
 Timing buffered disk reads:   80 MB in  3.04 seconds =  26.30 MB/sec

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Sun May 29 22:15:18 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 29 May 2005 22:15:18 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <1117396167.14625.17.camel@africa>
References: <b7bb36410505290948421de228@mail.gmail.com> <1117396167.14625.17.camel@africa>
Message-ID: <200505292215.18239.stefan@lucke.in-berlin.de>

On Sonntag, 29. Mai 2005 21:49, Torgeir Veimo wrote:
> On Sun, 2005-05-29 at 19:48 +0300, Ari Koponen wrote:
> 
> > My problem is that recorded files don't play smoothly. 
> 
> I have the same problem. This isn't a SATA harddrive, is it? I was
> suspecting it might be a SATA controller/disc issue.
> 
> > - IBM-DJNA-352030 5400 rpm hard disk drive
> 
> > Previously I had problems with live tv as well (while recording if I
> > remember correctly) but it turned out that DMA was not turned on for
> > HDD. I'm not sure is it fast enough even now. hdparm says:
> > 
> >  Timing buffer-cache reads:   828 MB in  2.00 seconds = 413.86 MB/sec
> >  Timing buffered disk reads:   42 MB in  3.01 seconds =  13.96 MB/sec

Mine are (SAMSUNG SV1204H  120G):
/dev/hda:
 Timing buffer-cache reads:   1380 MB in  2.00 seconds = 690.00 MB/sec
 Timing buffered disk reads:  114 MB in  3.01 seconds =  37.87 MB/sec

> 
> See if changing readahead improves the situation. Try eg. 
> 
> hdparm -t -a8192 /dev/hda

Did you both play around with '-u' option of hdparm (unmasking
other interrupts)? But read man hdparm before changing.


-- 
Stefan Lucke



From lucianm at users.sourceforge.net  Mon May 30 02:33:56 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 30 May 2005 02:33:56 +0200
Subject: [Softdevice-devel] [patch] DirectFB-0.9.23 (GetDeviceDescription)
Message-ID: <429A5F74.5080105@users.sourceforge.net>

Hi,

I had this tiny patch around from version 0.1.1 of the softdevice but 
forgot to submit. Now, even if in version 0.1.2 you commented out the 
actual code in reportCardInfo, you might find it useful to bring it all 
back :-).

Regards,
Lucian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice-0.1.2_dfb-0.9.23.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050530/7e0e116d/attachment.ksh>

From marko.makela at hut.fi  Mon May 30 09:10:42 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 30 May 2005 10:10:42 +0300
Subject: [Softdevice-devel] Repeatable crash with latest CVS
Message-ID: <20050530071042.GA234001@kosh.hut.fi>

I have a recording with a 4:3 -> 16:9 transition.  When rewinding it at
triple speed, a Signal 11 sometimes occurs.   I made a short clip that can be
fast-forwarded and rewinded some times (maybe 5-10) to trigger the crash
on my system.  Here is the stack trace from the core dump:

#0  0xb77e0873 in dfb_gfxcard_state_check ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#1  0xb77e0a7a in dfb_gfxcard_fillrectangles ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#2  0xb77c1a39 in IDirectFBSurface_Clear ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#3  0x00000001 in ?? ()
#4  0x00000000 in ?? ()
#5  0x00000000 in ?? ()
#6  0x00000000 in ?? ()
#7  0x00000000 in ?? ()
#8  0x00000000 in ?? ()
#9  0x00000000 in ?? ()
#10 0x08276468 in ?? ()
#11 0x00000000 in ?? ()
#12 0x00000000 in ?? ()
#13 0x00000000 in ?? ()
#14 0x00000000 in ?? ()
#15 0x00000000 in ?? ()
#16 0xb7816e14 in __JCR_LIST__ () from /usr/local/lib/libdfb++-0.9.so.22
#17 0x082218a0 in ?? ()
#18 0x08276810 in ?? ()
#19 0xbffff908 in ?? ()
---Type <return> to continue, or q <return> to quit---
#20 0xb7809749 in IDirectFBSurface::Clear (this=0x0, r=32 ' ', g=1 '\001',
    b=1 '\001', a=0 '\0') at idirectfbsurface.cpp:137
Previous frame inner to this frame (corrupt stack?)

(Sorry, I should compile directfb with -g and as a static library only,
and perhaps upgrade to newest version (I'm using 0.9.22).  This time, I
added a -g switch to the softdevice Makefile, but of course it wouldn't
help here.)

I'll send pointers to the clip to Martin and Stefan privately.

	Marko


From juniper81 at gmail.com  Mon May 30 13:02:10 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Mon, 30 May 2005 14:02:10 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <1117396167.14625.17.camel@africa>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
Message-ID: <b7bb364105053004023c8956b8@mail.gmail.com>

> See if changing readahead improves the situation. Try eg.
> 
> hdparm -t -a8192 /dev/hda
> 
> This improves it slightly for me, but not completely.
> 

I don't think that this or -u option that Stefan mentioned has any
noticable effects. Yesterday I tried to output to monitor using
DirectFB and it looked a lot better.

I see that my HDD is pretty slow but anyway softplay seems to play
DivX avi-files very well so I don't think that the problem is in my
HDD.

> > Another problem I'm facing is that when vdr starts it looks every time
> > for a remote control. This means more annoying waiting in startup. I
> > have compiled VDR with options NO_KBD and REMOTE=LIRC because I use
> > lirc.
> 
> The DirectFB output method implements keyboard input as well.
> 
So what should I do? I tried to disable DirectFB keyboard module with
disable-module=keyboard in directfbrc but that didn't solve it.


From marko.makela at hut.fi  Mon May 30 13:27:11 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 30 May 2005 14:27:11 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb364105053004023c8956b8@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com> <1117396167.14625.17.camel@africa> <b7bb364105053004023c8956b8@mail.gmail.com>
Message-ID: <20050530112711.GF265586@kosh.hut.fi>

On Mon, May 30, 2005 at 02:02:10PM +0300, Ari Koponen wrote:
> I see that my HDD is pretty slow but anyway softplay seems to play
> DivX avi-files very well so I don't think that the problem is in my
> HDD.

Could it be that the DVB stream places additional load on the bus,
causing the hard drive to wait for I/O slots and the processor to
wait for I/O?

> > The DirectFB output method implements keyboard input as well.
> > 
> So what should I do? I tried to disable DirectFB keyboard module with
> disable-module=keyboard in directfbrc but that didn't solve it.

You could also disable the "input" module of DirectFB as well, because
the keyboard can show up as /dev/input/event0 or some such.  First, however,
have a look at the title of the VDR screen.  Which remote control mapping
does it want to learn?

I had a similar problem when I set up my VDR box.  There seems to be some
locking issue that prevents softdevice from relaying the first remote key
event to VDR in learning mode.  It only worked once in 20..100 tries for
me.  I finally entered the mapping by adding some fprintf() to the
softdevice code, blindly pressing the keys, and manually editing the
VDR remote control configuration file.

	Marko


From M.Wache at gmx.net  Mon May 30 17:51:46 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 30 May 2005 17:51:46 +0200
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state
 relay
In-Reply-To: <20050529083607.GD477139@kosh.hut.fi>
References: <20050525205040.GD187661@kosh.hut.fi> <20050529083607.GD477139@kosh.hut.fi>
Message-ID: <429B3692.20901@gmx.net>

Marko M?kel? wrote:
> Okay, I finally have completed the unit, but haven't integrated it to
> softdevice yet.  I would appreciate some insight there; how to implement
> this hook for all playback methods (DirectFB, Xv and so on).  I've attached
On suspend cMpeg2Decoder::Suspend() is called, on resume 
cMpeg2Decoder::Resume(), is this what you wanted to know?
There are also Video out specific routines Suspend() and Resume(), the 
generic cVideoOut:Suspend()/Resume() routines are currently not called 
by Xv, otherwise you could also use these routines.

Martin


From M.Wache at gmx.net  Mon May 30 18:08:28 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 30 May 2005 18:08:28 +0200
Subject: [Softdevice-devel] OProfile success story and some performance
 measurement tips
In-Reply-To: <20050527153119.GA230371@kosh.hut.fi>
References: <20050524094620.GA386202@kosh.hut.fi> <4294A705.6070508@gmx.net> <20050525203048.GC187661@kosh.hut.fi> <42964045.5010903@gmx.net> <20050527153119.GA230371@kosh.hut.fi>
Message-ID: <429B3A7C.4030508@gmx.net>

Marko M?kel? wrote:

> If you don't find anything, just collect some samples with oprofile
> (and don't forget "opcontrol --reset" between "opcontrol --stop" and
> "opcontrol --start") and make repeatable and controlled experiments,
> not modifying too many parameters (or lines of code) at a time.
> 
> As I'm writing this, I'm replaying the same portion of the clip with
> DATA_MEM_REFS:7500.  I think it might be more fruitful to pay attention
> to this performance counter, as it could reveal some unnecessary memory
> accesses that do not happen to show up as cache misses.  Yes, here the
> top 99% percentile looks different:
> 
> CPU: PIII, speed 906.672 MHz (estimated)
> Counted DATA_MEM_REFS events (all memory references, cachable and non)
> with a unit mask of 0x00 (No unit mask) count 7500
> samples  %        symbol name
> 108722   15.8219  ff_simple_idct_add_mmx
> 84480    12.2941  mpeg2_decode_block_non_intra
> 63379     9.2233  ff_mpa_synth_filter
> 44302     6.4471  cStreamDecoder::BufferFill()
> 43877     6.3853  mpeg_decode_mb
> 28323     4.1217  MPV_decode_mb
> 26280     3.8244  mpeg2_decode_block_intra
> 25913     3.7710  MPV_motion
> 25898     3.7688  put_pixels16_mmx
> 23264     3.3855  put_pixels8_mmx
> 22451     3.2672  add_pixels_clamped_mmx
> 22208     3.2318  mpeg_decode_motion
> 20633     3.0026  clear_blocks_mmx
> 20561     2.9922  ff_simple_idct_put_mmx
> 16520     2.4041  mp_decode_layer2
> 13938     2.0283  dct32
> 12643     1.8399  cMpeg2Decoder::BufferFill()
> 11050     1.6081  cSoftDevice::Poll(cPoller&, int)
> 10729     1.5614  mpeg_decode_slice
> 10110     1.4713  put_pixels16_xy2_mmx
> 7299      1.0622  ff_mpeg1_find_frame_end
> 7287      1.0605  avg_pixels8_mmx2
> 
What makes me think here is the the reference to BufferFill(). It is 
just a call to find out if the buffers of the softdevice are filled, so 
it's basically just top pointer-bottom pointer for both audio buffer and 
video buffer. Nothing which should be on position 4 of the list???

I still didn't install oprofile on my old Athlon, but I will do so as 
soon as I find the time and give it a try. I'll have to properly 
implement a fast_memcpy, but see below...

> 
>>>You could perhaps also add explicit prefetch instructions, i.e.,
>>>__builtin_prefetch().  I don't know which processors have the opcodes.
>>>At least the Pentium-M does.  But that would only help for reading
>>>the MPEG stream.
>>
>>Prefetch calls are already used as far as I know (at least for the 
>>software alpha blending I'm sure), but as you already said for copying 
>>they don't help.
> 
> 
> You can prefetch also for write access.  A cache line is something like
> 16 or 32 bytes.  If you're writing 1 byte, you will need to read and write
> the whole cache line.  So, prefetching can help.
Since you mention it, you are right, my thinking was a bit to naive. Now 
I remember that the kernel memcpy is optimized for mmx and it uses 
prefetching, that was where I looked when I wrote the AlphaBlend stuff.
Currently the softdevice uses plain libc memcpy for copying data to the 
video memory, which is not optimized at all. Yesterday I had a look at 
mplayer, and adapted their fast_memcpy to the softdevice. Guess what the 
speed advantage is?
It's about 20% on my box using Xv!!!!! In principle this can be used for 
DirectFB and Vidix as well (only plain fb won't benefit from fast_memcpy).

Martin


From M.Wache at gmx.net  Mon May 30 18:15:11 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 30 May 2005 18:15:11 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb364105053004023c8956b8@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>	 <1117396167.14625.17.camel@africa> <b7bb364105053004023c8956b8@mail.gmail.com>
Message-ID: <429B3C0F.8090305@gmx.net>

Ari Koponen wrote:

> I see that my HDD is pretty slow but anyway softplay seems to play
> DivX avi-files very well so I don't think that the problem is in my
> HDD.
Softplay also plays vdr recordings, so this would be the ultimate test 
to see if the problems are really just due to the data rate.

You can also uncomment the printfs in cSoftdevice::Poll (file softdevice.c):

   if ( decoder->BufferFill() > 90 ) {
      //fprintf(stderr,"[softdevice] Buffer filled, TimeoutMs %d, fill 
%d\n",
      //  TimeoutMs,decoder->BufferFill());

maybe you can move them even before the "if"-statement, so you will 
always get the buffer fill messages. They will come about every 100ms, 
so they will probably flood your console. In case of replay of a 
recording the buffer fill should always be above 80 percent or so.

Martin


From juniper81 at gmail.com  Mon May 30 20:02:18 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Mon, 30 May 2005 21:02:18 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <429B3C0F.8090305@gmx.net>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
Message-ID: <b7bb3641050530110227f2b313@mail.gmail.com>

On 5/30/05, Martin Wache <M.Wache at gmx.net> wrote:
> Ari Koponen wrote:
> 
> > I see that my HDD is pretty slow but anyway softplay seems to play
> > DivX avi-files very well so I don't think that the problem is in my
> > HDD.
> Softplay also plays vdr recordings, so this would be the ultimate test
> to see if the problems are really just due to the data rate.

Interestingly Softplay seems to replay vdr recordings flawlessly! 

> 
> You can also uncomment the printfs in cSoftdevice::Poll (file softdevice.c):
> 
>    if ( decoder->BufferFill() > 90 ) {
>       //fprintf(stderr,"[softdevice] Buffer filled, TimeoutMs %d, fill
> %d\n",
>       //  TimeoutMs,decoder->BufferFill());
> 
> maybe you can move them even before the "if"-statement, so you will
> always get the buffer fill messages. They will come about every 100ms,
> so they will probably flood your console. In case of replay of a
> recording the buffer fill should always be above 80 percent or so.

I also tried uncommenting those statements inside the "if" block and
with softplay the buffer fill was constantly 91% and with softdevice
output it varied somewhat but was all the time over 90 %.

- Ari


From juniper81 at gmail.com  Mon May 30 20:08:58 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Mon, 30 May 2005 21:08:58 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <20050530112711.GF265586@kosh.hut.fi>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com>
	 <20050530112711.GF265586@kosh.hut.fi>
Message-ID: <b7bb3641050530110849c62d3e@mail.gmail.com>

> > > The DirectFB output method implements keyboard input as well.
> > >
> > So what should I do? I tried to disable DirectFB keyboard module with
> > disable-module=keyboard in directfbrc but that didn't solve it.
> 
> You could also disable the "input" module of DirectFB as well, because
> the keyboard can show up as /dev/input/event0 or some such.  First, however,
> have a look at the title of the VDR screen.  Which remote control mapping
> does it want to learn?

It says that it wants to learn RC unit. Hmm.. What command should I
use in directfbrc to disable the "input" module? I tried the option
disable-module=input and disable-module=linux-input but I didn't see
any messages about those in the startup log so I guess they weren't
correctly spelled.

> 
> I had a similar problem when I set up my VDR box.  There seems to be some
> locking issue that prevents softdevice from relaying the first remote key
> event to VDR in learning mode.  It only worked once in 20..100 tries for
> me.  I finally entered the mapping by adding some fprintf() to the
> softdevice code, blindly pressing the keys, and manually editing the
> VDR remote control configuration file.
> 

Is this a problem of softdevice or vdr itself? Has anyone informed the
vdr developers of this problem?

- Ari


From torgeir at pobox.com  Mon May 30 20:41:54 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Mon, 30 May 2005 19:41:54 +0100
Subject: [Softdevice-devel] Problems while playing recordings and in
	startup
In-Reply-To: <b7bb3641050530110227f2b313@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
Message-ID: <1117478514.14424.0.camel@africa>

On Mon, 2005-05-30 at 21:02 +0300, Ari Koponen wrote:
> On 5/30/05, Martin Wache <M.Wache at gmx.net> wrote:
> > Ari Koponen wrote:
> > 
> > > I see that my HDD is pretty slow but anyway softplay seems to play
> > > DivX avi-files very well so I don't think that the problem is in my
> > > HDD.
> > Softplay also plays vdr recordings, so this would be the ultimate test
> > to see if the problems are really just due to the data rate.
> 
> Interestingly Softplay seems to replay vdr recordings flawlessly! 

This works very well on my system too..

-- 
Torgeir Veimo <torgeir at pobox.com>



From stefan at lucke.in-berlin.de  Mon May 30 20:58:17 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 30 May 2005 20:58:17 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb3641050530110849c62d3e@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com> <20050530112711.GF265586@kosh.hut.fi> <b7bb3641050530110849c62d3e@mail.gmail.com>
Message-ID: <200505302058.17842.stefan@lucke.in-berlin.de>

On Montag, 30. Mai 2005 20:08, Ari Koponen wrote:
> > > > The DirectFB output method implements keyboard input as well.
> > > >
> > > So what should I do? I tried to disable DirectFB keyboard module with
> > > disable-module=keyboard in directfbrc but that didn't solve it.
> > 
> > You could also disable the "input" module of DirectFB as well, because
> > the keyboard can show up as /dev/input/event0 or some such.  First, however,
> > have a look at the title of the VDR screen.  Which remote control mapping
> > does it want to learn?
> 
> It says that it wants to learn RC unit. Hmm.. What command should I
> use in directfbrc to disable the "input" module? I tried the option
> disable-module=input and disable-module=linux-input but I didn't see
> any messages about those in the startup log so I guess they weren't
> correctly spelled.

On my prod systems (chich runs still with dxr3) I disabled in /etc/directfbrc:
disable-module=lirc


-- 
Stefan Lucke



From marko.makela at hut.fi  Mon May 30 21:40:11 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 30 May 2005 22:40:11 +0300
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <429B3692.20901@gmx.net>
References: <20050525205040.GD187661@kosh.hut.fi> <20050529083607.GD477139@kosh.hut.fi> <429B3692.20901@gmx.net>
Message-ID: <20050530194011.GA100333@kosh.hut.fi>

On Mon, May 30, 2005 at 05:51:46PM +0200, Martin Wache wrote:
> Marko M?kel? wrote:
> >Okay, I finally have completed the unit, but haven't integrated it to
> >softdevice yet.  I would appreciate some insight there; how to implement
> >this hook for all playback methods (DirectFB, Xv and so on).
> On suspend cMpeg2Decoder::Suspend() is called, on resume 
> cMpeg2Decoder::Resume(), is this what you wanted to know?

Yes, thanks a lot, Martin!  Attached is my patch for controlling the relay
with the IsSuspended flag.  You will also need to add a line to
/video/setup.conf that looks like this:

softdevice.serialfd = /dev/ttyS0

If this line is missing or if the open() call on the device fails, the ioctl
to set or clear the BREAK condition will not be executed.  Consider the name
of this option a working title; I'm not good at inventing names.

The patch doesn't contain any close() call, but it could be added to the
cSetupStore destructor, if there were one.  The file descriptor will be
implicitly closed (and the equipment behind the relay box will be powered
off) when the vdr process ends.

Another question: what is the easiest way to bind the Suspend flag to
remote control keys (toggle, on, off)?  I'll probably have my wake-on-remote
device send fake "suspend=off" events once per second until the remote control
is touched, if the system was powered up by the remote control.  So, I'd
need to bind this fake keycode to suspend=off, and a real key on the remote
to suspend=toggle.

	Marko
-------------- next part --------------
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.38
diff -u -r1.38 mpeg2decoder.c
--- mpeg2decoder.c	29 May 2005 10:13:59 -0000	1.38
+++ mpeg2decoder.c	30 May 2005 19:26:04 -0000
@@ -8,6 +8,7 @@
 
 #include <math.h>
 #include <sched.h>
+#include <sys/ioctl.h>
 
 #include <vdr/plugin.h>
 
@@ -976,6 +977,7 @@
   decoding=false;
   IsSuspended=false;
   Speed=1;
+  FlipRelay();
 }
 
 cMpeg2Decoder::~cMpeg2Decoder()
@@ -1210,6 +1212,14 @@
     mutex.Unlock();
 }
 
+void cMpeg2Decoder::FlipRelay()
+{
+  int fd = setupStore.serialfd;
+fprintf(stderr, "FlipRelay %d %d\n", fd, IsSuspended);
+  if (fd >= 0)
+    ioctl(fd, IsSuspended ? TIOCCBRK : TIOCSBRK, 0);
+}
+
 void cMpeg2Decoder::Suspend()
 {
   CMDDEB("Suspend\n");
@@ -1217,6 +1227,7 @@
   audioOut->Suspend();
   videoOut->Suspend();
   IsSuspended=true;
+  FlipRelay();
 }
 
 void cMpeg2Decoder::Resume()
@@ -1241,6 +1252,7 @@
 
   Start();
   IsSuspended=false;
+  FlipRelay();
 }
 
 void cMpeg2Decoder::Play(void)
Index: mpeg2decoder.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.h,v
retrieving revision 1.24
diff -u -r1.24 mpeg2decoder.h
--- mpeg2decoder.h	29 May 2005 10:13:59 -0000	1.24
+++ mpeg2decoder.h	30 May 2005 19:26:04 -0000
@@ -305,6 +305,7 @@
     void Freeze(void);
     void Stop(bool GetMutex=true);
     void Clear(void);
+    void FlipRelay(void);
     void Suspend(void);
     void Resume(void);
     void TrickSpeed(int Speed);
Index: setup-softdevice.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/setup-softdevice.c,v
retrieving revision 1.18
diff -u -r1.18 setup-softdevice.c
--- setup-softdevice.c	29 May 2005 19:50:44 -0000	1.18
+++ setup-softdevice.c	30 May 2005 19:26:04 -0000
@@ -152,6 +152,7 @@
   strcpy (alsaDevice, "");
   strcpy (alsaSPDIFDevice, "hw:0,2");
   voArgs = aoArgs = NULL;
+  serialfd = -1;
 }
 
 bool cSetupStore::SetupParse(const char *Name, const char *Value)
@@ -246,6 +247,11 @@
     ac3Mode = atoi (Value);
     fprintf(stderr, "[setup-softdevice] alsa ac3Mode set to: %d\n", ac3Mode);
     ac3Mode = clamp (0, ac3Mode, 3);
+  } else if (!strcasecmp(Name, "serialfd")) {
+    serialfd = open(Value, O_RDWR | O_NOCTTY | O_NONBLOCK);
+    if (serialfd < 0)
+      fprintf(stderr, "[setup-softdevice] serialfd %s open failed: %m\n",
+              Value, errno);
   }  else  return false;
 
   return true;
Index: setup-softdevice.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/setup-softdevice.h,v
retrieving revision 1.13
diff -u -r1.13 setup-softdevice.h
--- setup-softdevice.h	29 May 2005 19:50:44 -0000	1.13
+++ setup-softdevice.h	30 May 2005 19:26:04 -0000
@@ -47,6 +47,7 @@
     char  alsaSPDIFDevice [ALSA_DEVICE_NAME_LENGTH];
     char  *voArgs;
     char  *aoArgs;
+    int   serialfd;
 };
 
 #define OSDMODE_PSEUDO    0

From marko.makela at hut.fi  Mon May 30 20:45:35 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 30 May 2005 21:45:35 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb3641050530110849c62d3e@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com> <1117396167.14625.17.camel@africa> <b7bb364105053004023c8956b8@mail.gmail.com> <20050530112711.GF265586@kosh.hut.fi> <b7bb3641050530110849c62d3e@mail.gmail.com>
Message-ID: <20050530184535.GA3051@localhost.localdomain>

On Mon, May 30, 2005 at 09:08:58PM +0300, Ari Koponen wrote:
> It says that it wants to learn RC unit.

It should also say the name of the device, e.g., KBD if you didn't
compile vdr.o with make NO_KBD=1, or something like "softdevice-xv"
or "softdevice-dfb" for softdevice.

> Hmm.. What command should I use in directfbrc to disable the "input"
> module? I tried the option disable-module=input and
> disable-module=linux-input but I didn't see any messages about those
> in the startup log so I guess they weren't correctly spelled.

If the event module is missing from the kernel, it shouldn't make a
difference.  The remote control of my Hauppauge Nova-T PCI 90002
is connected via the /dev/input/event* interface, and the keycodes
are translated by the kernel, DirectFB and vdr.  I had to add some
missing keys to the kernel and DirectFB.  Last time I checked,
video4linux modules doesn't have a maintainer any more.  I'm not sure
if the DirectFB bug report I filed has been processed.

> > I had a similar problem when I set up my VDR box.  There seems to be some
> > locking issue that prevents softdevice from relaying the first remote key
> > event to VDR in learning mode.  It only worked once in 20..100 tries for
> > me.  I finally entered the mapping by adding some fprintf() to the
> > softdevice code, blindly pressing the keys, and manually editing the
> > VDR remote control configuration file.
> > 
> 
> Is this a problem of softdevice or vdr itself? Has anyone informed the
> vdr developers of this problem?

I don't know which one is at fault.  I didn't have that problem when I used
the dxr3 plugin.  You should find the discussion in the mailing list archives
from 2 or 3 months ago.

	Marko


From nhuillard at e-dition.fr  Tue May 31 10:31:14 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 31 May 2005 10:31:14 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
Message-ID: <429C20D2.6010606@e-dition.fr>

Any idea anyone ?


-------- Message original --------
Sujet: Re: Softdevice and via
Date: Mon, 30 May 2005 21:58:40 +0200
De: Rene Bredlau <murray at blubber.de>
Pour: Nicolas Huillard <nhuillard at e-dition.fr>

Hi,

Nicolas Huillard wrote:
> Rene Bredlau a ?crit :
> 
>> i saw your postings on the vdr mailinglist. I think i am trying
>> something similar to you setup. But at the moment i am stucked with a
>> problem.
>>
>> Vdr ist starting up and i can see a picture and the OSD. But the colors
>> are wrong for the live picture :-(( Do you gave any idea what causing
>> this?
> 
> Try to adjust the pixel format in the softdevice setup menu : one of
> I420, YUV2, etc.

on I420 the collors are wrong mainly blue. and on the third option the
colors look good but the picture is flickering. And also the tone is
breaking up.  Any idea?

> ...and post this kind of question to the softdevice or vdr
> mailing-lists. Just in case I don't reply fast enough or you mail is
> automatically marked as junk...
> 
> If your problem is not solved, add version numbers and config stuff to
> you post (including Linux distro, ffmpeg version, output method for
> softdevice, frame-buffer setup if using DirectFB, etc.)

-- 
So long
	.\\urray


From stefan at lucke.in-berlin.de  Tue May 31 11:28:53 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 31 May 2005 11:28:53 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <429C20D2.6010606@e-dition.fr>
References: <429C20D2.6010606@e-dition.fr>
Message-ID: <1117531733.429c2e55c0c45@webmail.in-berlin.de>

Quoting Nicolas Huillard <nhuillard at e-dition.fr>:

> Any idea anyone ?

Which hardware ??

He should use either I420 or YV12. The difference between them is just
the swapped color components. YUV2 with directfb automatically activates
stretchBlit(), which should not be used on via.


Stefan Lucke


>
>
> -------- Message original --------
> Sujet: Re: Softdevice and via
> Date: Mon, 30 May 2005 21:58:40 +0200
> De: Rene Bredlau <murray at blubber.de>
> Pour: Nicolas Huillard <nhuillard at e-dition.fr>
>
> Hi,
>
> Nicolas Huillard wrote:
> > Rene Bredlau a ?crit :
> >
> >> i saw your postings on the vdr mailinglist. I think i am trying
> >> something similar to you setup. But at the moment i am stucked with a
> >> problem.
> >>
> >> Vdr ist starting up and i can see a picture and the OSD. But the colors
> >> are wrong for the live picture :-(( Do you gave any idea what causing
> >> this?
> >
> > Try to adjust the pixel format in the softdevice setup menu : one of
> > I420, YUV2, etc.
>
> on I420 the collors are wrong mainly blue. and on the third option the
> colors look good but the picture is flickering. And also the tone is
> breaking up.  Any idea?
>
> > ...and post this kind of question to the softdevice or vdr
> > mailing-lists. Just in case I don't reply fast enough or you mail is
> > automatically marked as junk...
> >
> > If your problem is not solved, add version numbers and config stuff to
> > you post (including Linux distro, ffmpeg version, output method for
> > softdevice, frame-buffer setup if using DirectFB, etc.)
>
> --
> So long
> 	.\\urray
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel
>




From murray at blubber.de  Tue May 31 11:41:09 2005
From: murray at blubber.de (Rene Bredlau)
Date: Tue, 31 May 2005 11:41:09 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <1117531733.429c2e55c0c45@webmail.in-berlin.de>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de>
Message-ID: <429C3135.4000602@blubber.de>

Hi,

Stefan Lucke wrote:
>>Any idea anyone ?
> 
> 
> Which hardware ??
> 
> He should use either I420 or YV12. The difference between them is just
> the swapped color components. YUV2 with directfb automatically activates
> stretchBlit(), which should not be used on via.
i420 and YV12 giv wrong colors, I420 looks a little bit better, but i
think blue is somehow missing there. YUV2 gives me a somehow broken
picture. some parts of the screen are not drawn und the picture is not
constantly update (the audio is breaking up then too). But the parts of
the picture is can see when YUV2 is active have correct colors.

i am using the the viafb from patcher2k on 2.6.11.11 kernel. I tried it
with Diretfb(++) 0.9.22 and with the cvs snapshot from yesterday.

> 
> 
> Stefan Lucke
> 
> 
> 
>>
>>-------- Message original --------
>>Sujet: Re: Softdevice and via
>>Date: Mon, 30 May 2005 21:58:40 +0200
>>De: Rene Bredlau <murray at blubber.de>
>>Pour: Nicolas Huillard <nhuillard at e-dition.fr>
>>
>>Hi,
>>
>>Nicolas Huillard wrote:
>>
>>>Rene Bredlau a ?crit :
>>>
>>>
>>>>i saw your postings on the vdr mailinglist. I think i am trying
>>>>something similar to you setup. But at the moment i am stucked with a
>>>>problem.
>>>>
>>>>Vdr ist starting up and i can see a picture and the OSD. But the colors
>>>>are wrong for the live picture :-(( Do you gave any idea what causing
>>>>this?
>>>
>>>Try to adjust the pixel format in the softdevice setup menu : one of
>>>I420, YUV2, etc.
>>
>>on I420 the collors are wrong mainly blue. and on the third option the
>>colors look good but the picture is flickering. And also the tone is
>>breaking up.  Any idea?
>>
>>
>>>...and post this kind of question to the softdevice or vdr
>>>mailing-lists. Just in case I don't reply fast enough or you mail is
>>>automatically marked as junk...
>>>
>>>If your problem is not solved, add version numbers and config stuff to
>>>you post (including Linux distro, ffmpeg version, output method for
>>>softdevice, frame-buffer setup if using DirectFB, etc.)
>>
>>--
>>So long
>>	.\\urray
>>_______________________________________________
>>Softdevice-devel mailing list
>>Softdevice-devel at lists.berlios.de
>>http://lists.berlios.de/mailman/listinfo/softdevice-devel
>>
> 
> 
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel

-- 
So long
	.\\urray


From nhuillard at e-dition.fr  Tue May 31 11:51:52 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 31 May 2005 11:51:52 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <1117531733.429c2e55c0c45@webmail.in-berlin.de>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de>
Message-ID: <429C33B8.5050804@e-dition.fr>

(please CC Rene Bredlau <murray at blubber.de> since I don't know if he has 
finally subscribed to this list).

Stefan Lucke a ?crit :
> Quoting Nicolas Huillard <nhuillard at e-dition.fr>:
> 
>>Any idea anyone ?
> 
> Which hardware ??

Seems to be "via". Rene directly mailed me, so I assume he has an EPIA 
M10k. I also assumed DirectFB.

> He should use either I420 or YV12. The difference between them is just
> the swapped color components. YUV2 with directfb automatically activates
> stretchBlit(), which should not be used on via.

See below : neither are satisfactory, with different results.

@Rene : please detail your setup and what you tried.

> Stefan Lucke

Thanks.

>>-------- Message original --------
>>Sujet: Re: Softdevice and via
>>Date: Mon, 30 May 2005 21:58:40 +0200
>>De: Rene Bredlau <murray at blubber.de>
>>Pour: Nicolas Huillard <nhuillard at e-dition.fr>
>>
>>Hi,
>>
>>Nicolas Huillard wrote:
>>
>>>Rene Bredlau a ?crit :
>>>
>>>>i saw your postings on the vdr mailinglist. I think i am trying
>>>>something similar to you setup. But at the moment i am stucked with a
>>>>problem.
>>>>
>>>>Vdr ist starting up and i can see a picture and the OSD. But the colors
>>>>are wrong for the live picture :-(( Do you gave any idea what causing
>>>>this?
>>>
>>>Try to adjust the pixel format in the softdevice setup menu : one of
>>>I420, YUV2, etc.
>>
>>on I420 the collors are wrong mainly blue. and on the third option the
>>colors look good but the picture is flickering. And also the tone is
>>breaking up.  Any idea?
>>
>>>...and post this kind of question to the softdevice or vdr
>>>mailing-lists. Just in case I don't reply fast enough or you mail is
>>>automatically marked as junk...
>>>
>>>If your problem is not solved, add version numbers and config stuff to
>>>you post (including Linux distro, ffmpeg version, output method for
>>>softdevice, frame-buffer setup if using DirectFB, etc.)
>>
>>--
>>So long
>>	.\\urray

-- 
NH


From nhuillard at e-dition.fr  Tue May 31 12:33:55 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Tue, 31 May 2005 12:33:55 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <429C38C3.3080005@blubber.de>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de> <429C33B8.5050804@e-dition.fr> <429C38C3.3080005@blubber.de>
Message-ID: <429C3D93.6040804@e-dition.fr>

Rene Bredlau a ?crit :
>>>Which hardware ??
>>
>>Seems to be "via". Rene directly mailed me, so I assume he has an EPIA
>>M10k. I also assumed DirectFB.
> 
> lspci give the following output:
> 000:00:00.0 Host bridge: VIA Technologies, Inc. VT8623 [Apollo CLE266]
> 0000:00:01.0 PCI bridge: VIA Technologies, Inc. VT8633 [Apollo Pro266 AGP]
> 0000:00:08.0 Ethernet controller: Realtek Semiconductor Co., Ltd.
> RTL-8139/8139C/8139C+ (rev 10)
> 0000:00:09.0 FireWire (IEEE 1394): VIA Technologies, Inc. IEEE 1394 Host
> Controller (rev 80)
> 0000:00:10.0 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB
> 1.1 Controller (rev 80)
> 0000:00:10.1 USB Controller: VIA Technologies, Inc. VT82xxxxx UHCI USB
> 1.1 Controller (rev 80)
> 0000:00:10.3 USB Controller: VIA Technologies, Inc. USB 2.0 (rev 82)
> 0000:00:11.0 ISA bridge: VIA Technologies, Inc. VT8235 ISA Bridge
> 0000:00:11.1 IDE interface: VIA Technologies, Inc.
> VT82C586A/B/VT82C686/A/B/VT823x/A/C PIPC Bus Master IDE (rev 06)
> 0000:00:11.5 Multimedia audio controller: VIA Technologies, Inc.
> VT8233/A/8235/8237 AC97 Audio Controller (rev 50)
> 0000:01:00.0 VGA compatible controller: VIA Technologies, Inc. VT8623
> [Apollo CLE266] integrated CastleRock graphics (rev 03)

This is an EPIA M.

I currently have :
* kernel 2.6.8
* viafb from epiawiki
* (I spend a lot of time trying 2.6.11 with viafb from viaarena : 
doesn't work wit DirectFB)
* DirectFB CVS quite recent
* softdevice 0.1.1 (shame on me)
* ffmepg from the Marillat's Debian repository

Everything is working correctly, except with high bitrate video (> 
5Mbps), or with DVD with AC/3 (software decoding, until Stefan finishes 
digital passthrough (AC/3 + DTS, I hope)), where the CPU starts to 
suffer and skips frames and audio starts to "shirp".

(high bitrate video : white snow falling randomly on dark sky, or 
furious torrent in full-screen. I don't have the recordings though...)

-- 
NH


From murray at blubber.de  Tue May 31 16:29:40 2005
From: murray at blubber.de (Rene Bredlau)
Date: Tue, 31 May 2005 16:29:40 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <429C3D93.6040804@e-dition.fr>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de> <429C33B8.5050804@e-dition.fr> <429C38C3.3080005@blubber.de> <429C3D93.6040804@e-dition.fr>
Message-ID: <429C74D4.2060802@blubber.de>

Hi,

Nicolas Huillard wrote:
> Rene Bredlau a ?crit :
> This is an EPIA M.
> 
> I currently have :
> * kernel 2.6.8
> * viafb from epiawiki
> * (I spend a lot of time trying 2.6.11 with viafb from viaarena :
> doesn't work wit DirectFB)
> * DirectFB CVS quite recent
> * softdevice 0.1.1 (shame on me)
> * ffmepg from the Marillat's Debian repository
> 
> Everything is working correctly, except with high bitrate video (>
> 5Mbps), or with DVD with AC/3 (software decoding, until Stefan finishes
> digital passthrough (AC/3 + DTS, I hope)), where the CPU starts to
> suffer and skips frames and audio starts to "shirp".
> 
> (high bitrate video : white snow falling randomly on dark sky, or
> furious torrent in full-screen. I don't have the recordings though...)
> 

I tried the viafb from epiawiki but with the same results. Btw: fdbshow
shows me a testpicutre (Convergenc.png) with the right colors.

Can you send me your directfbrc and the insmode line you are using (and
maybe other things that could be wrong.

-- 
So long
	.\\urray


From juniper81 at gmail.com  Tue May 31 17:00:15 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Tue, 31 May 2005 18:00:15 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <20050530184535.GA3051@localhost.localdomain>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com>
	 <20050530112711.GF265586@kosh.hut.fi>
	 <b7bb3641050530110849c62d3e@mail.gmail.com>
	 <20050530184535.GA3051@localhost.localdomain>
Message-ID: <b7bb3641050531080057650189@mail.gmail.com>

On 5/30/05, Marko M?kel? <marko.makela at hut.fi> wrote:
> On Mon, May 30, 2005 at 09:08:58PM +0300, Ari Koponen wrote:
>
> It should also say the name of the device, e.g., KBD if you didn't
> compile vdr.o with make NO_KBD=1, or something like "softdevice-xv"
> or "softdevice-dfb" for softdevice.

Oh, you mean that. It was softdevice-dfb. 

> > Hmm.. What command should I use in directfbrc to disable the "input"
> > module? I tried the option disable-module=input and
> > disable-module=linux-input but I didn't see any messages about those
> > in the startup log so I guess they weren't correctly spelled.
> 
> If the event module is missing from the kernel, it shouldn't make a
> difference.  The remote control of my Hauppauge Nova-T PCI 90002
> is connected via the /dev/input/event* interface, and the keycodes
> are translated by the kernel, DirectFB and vdr.  I had to add some
> missing keys to the kernel and DirectFB. 

Ok, this starts to sound too complicated for me so I think I'll just
wait and see if someone fixes this bug on some sunny day. Thanks
anyway for help.


From murray at blubber.de  Tue May 31 19:04:02 2005
From: murray at blubber.de (Rene Bredlau)
Date: Tue, 31 May 2005 19:04:02 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <429C74D4.2060802@blubber.de>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de> <429C33B8.5050804@e-dition.fr> <429C38C3.3080005@blubber.de> <429C3D93.6040804@e-dition.fr> <429C74D4.2060802@blubber.de>
Message-ID: <429C9902.8030908@blubber.de>

Hi,

maybe i found something more:

dfblayer -f I420

gives me a not supported (see output below, same for YV12 maybe this is
causing my problems.

(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.

       ---------------------- DirectFB v0.9.23 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-05-30 23:27)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(*) Direct/Modules: suppress module 'linux_input'
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 1850)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)

FBDev Primary Layer

(#) DirectFBError [IDirectFBDisplayLayer::TestConfiguration() failed]:
Not supported!


Rene Bredlau wrote:
> Hi,
> 
> Nicolas Huillard wrote:
> 
>>Rene Bredlau a ?crit :
>>This is an EPIA M.
>>
>>I currently have :
>>* kernel 2.6.8
>>* viafb from epiawiki
>>* (I spend a lot of time trying 2.6.11 with viafb from viaarena :
>>doesn't work wit DirectFB)
>>* DirectFB CVS quite recent
>>* softdevice 0.1.1 (shame on me)
>>* ffmepg from the Marillat's Debian repository
>>
>>Everything is working correctly, except with high bitrate video (>
>>5Mbps), or with DVD with AC/3 (software decoding, until Stefan finishes
>>digital passthrough (AC/3 + DTS, I hope)), where the CPU starts to
>>suffer and skips frames and audio starts to "shirp".
>>
>>(high bitrate video : white snow falling randomly on dark sky, or
>>furious torrent in full-screen. I don't have the recordings though...)
>>
> 
> 
> I tried the viafb from epiawiki but with the same results. Btw: fdbshow
> shows me a testpicutre (Convergenc.png) with the right colors.
> 
> Can you send me your directfbrc and the insmode line you are using (and
> maybe other things that could be wrong.
> 

-- 
So long
	.\\urray


From stefan at lucke.in-berlin.de  Tue May 31 19:16:54 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 31 May 2005 19:16:54 +0200
Subject: [Softdevice-devel] Connecting the "suspended" flag to a solid-state relay
In-Reply-To: <20050530194011.GA100333@kosh.hut.fi>
References: <20050525205040.GD187661@kosh.hut.fi> <429B3692.20901@gmx.net> <20050530194011.GA100333@kosh.hut.fi>
Message-ID: <200505311916.55087.stefan@lucke.in-berlin.de>

On Montag, 30. Mai 2005 21:40, Marko M?kel? wrote:
> On Mon, May 30, 2005 at 05:51:46PM +0200, Martin Wache wrote:
> > Marko M?kel? wrote:
> > >Okay, I finally have completed the unit, but haven't integrated it to
> > >softdevice yet.  I would appreciate some insight there; how to implement
> > >this hook for all playback methods (DirectFB, Xv and so on).
> > On suspend cMpeg2Decoder::Suspend() is called, on resume 
> > cMpeg2Decoder::Resume(), is this what you wanted to know?
> 
> Yes, thanks a lot, Martin!  Attached is my patch for controlling the relay
> with the IsSuspended flag.  You will also need to add a line to
> /video/setup.conf that looks like this:
> 
> softdevice.serialfd = /dev/ttyS0
> 

There should be a more general way to do such communications. Next
could be to send some commands via signal line toggeling over usb or
transmitting an udp packet.
vdr has the possibility to execute commands and it is possible to bind
them to userX keys.

The minimum we could to is sending such key events to vdr like we do
already in one case.


-- 
Stefan Lucke



From marko.makela at hut.fi  Tue May 31 19:38:43 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 31 May 2005 20:38:43 +0300
Subject: [Softdevice-devel] Communicating status changes to an external program
In-Reply-To: <200505311916.55087.stefan@lucke.in-berlin.de>
References: <20050525205040.GD187661@kosh.hut.fi> <429B3692.20901@gmx.net> <20050530194011.GA100333@kosh.hut.fi> <200505311916.55087.stefan@lucke.in-berlin.de>
Message-ID: <20050531173843.GA406196@kosh.hut.fi>

On Tue, May 31, 2005 at 07:16:54PM +0200, Stefan Lucke wrote:
> > Yes, thanks a lot, Martin!  Attached is my patch for controlling the relay
> > with the IsSuspended flag.  You will also need to add a line to
> > /video/setup.conf that looks like this:
> > 
> > softdevice.serialfd = /dev/ttyS0
> > 
> 
> There should be a more general way to do such communications.

I agree.  Perhaps a popen(3) pipe to a user-specified command?  It would
print out status changes in setup.conf format, e.g., lines like

softdevice.IsSuspended=0
softdevice.IsSuspended=1
CurrentChannel=1
softdevice.aspect=4:3
softdevice.IsSuspended=0
CurrentChannel=2
softdevice.aspect=16:9

Then the user-written command (which could be written in any language)
would react on the interesting lines.

The softdevice.aspect setting I just made up would signal changes in
the MPEG-2 stream.  They could be used in someone's home theatre to
control the black curtains on the sides of the projector screen.

I think this would be better done in the VDR layer than in the plugins.
Until someone implements that, I'm going to stick with my patch.

> vdr has the possibility to execute commands and it is possible to bind
> them to userX keys.
> 
> The minimum we could to is sending such key events to vdr like we do
> already in one case.

Oh yes: I can modify softdevice to intercept the suspend=off and
suspend=toggle keycodes I'm going to need in my setup.  Thanks for
the idea! (I don't know if that is what you meant by your comment,
and that kind of a patch obviously can't be applied to the official
softdevice tree.)

	Marko


From stefan at lucke.in-berlin.de  Wed Jun  1 08:01:44 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed, 1 Jun 2005 08:01:44 +0200
Subject: [Softdevice-devel] [Fwd: Re: Softdevice and via]
In-Reply-To: <429C3135.4000602@blubber.de>
References: <429C20D2.6010606@e-dition.fr> <1117531733.429c2e55c0c45@webmail.in-berlin.de> <429C3135.4000602@blubber.de>
Message-ID: <200506010801.44210.stefan@lucke.in-berlin.de>

On Dienstag, 31. Mai 2005 11:41, Rene Bredlau wrote:
> Hi,
> 
> Stefan Lucke wrote:
> >>Any idea anyone ?
> > 
> > 
> > Which hardware ??
> > 
> > He should use either I420 or YV12. The difference between them is just
> > the swapped color components. YUV2 with directfb automatically activates
> > stretchBlit(), which should not be used on via.
> i420 and YV12 giv wrong colors, I420 looks a little bit better, but i
> think blue is somehow missing there. YUV2 gives me a somehow broken
> picture. some parts of the screen are not drawn und the picture is not
> constantly update (the audio is breaking up then too). But the parts of
> the picture is can see when YUV2 is active have correct colors.
> 

On my epia I do:
modprobe snd-via82xx
modprobe viafb mode=1024x768 bpp=32 refresh=60 TVon=0

/etc/directfbrc :
#mode  = 1024x768
mode = 1280x1024
#pixelformat=AiRGB
pixelformat=ARGB
disable-module=cle266

-- 
Stefan Lucke



From leo at calidae.net  Fri Jun  3 12:50:47 2005
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Fri, 03 Jun 2005 12:50:47 +0200
Subject: [Softdevice-devel] why I don't see anything?
Message-ID: <42A03607.8060409@calidae.net>

An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050603/b6519abb/attachment.html>

From nhuillard at e-dition.fr  Fri Jun  3 13:10:45 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 03 Jun 2005 13:10:45 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A03607.8060409@calidae.net>
References: <42A03607.8060409@calidae.net>
Message-ID: <42A03AB5.2060908@e-dition.fr>

Leo M?rquez a ?crit :
> Hi,
> 
> I'm setting up vdr with softdevice dfb and viafb unichrome.
> All seems to be ok but I don't see anything in my monitor when I start vdr. I have:
> 
> vdr:/usr/src/VDR# ./vdr -P"softdevice -vo dfb:"
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> [softdevice] initializing Plugin
> [softdevice] Initializing Video Out
> [softdevice] ffmpeg version(cvs) build(4752)
> [dfb] init
> 
>        ---------------------- DirectFB v0.9.22 ---------------------
>              (c) 2000-2002  convergence integrated media GmbH
>              (c) 2002-2004  convergence GmbH
>         -----------------------------------------------------------
> 
> (*) DirectFB/Core: Single Application Core. (2005-05-27 21:18)
> (*) Direct/Memcpy: Using SSE optimized memcpy()
> (*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 15996)...
> (*) Direct/Thread: Running 'PS/2 Input' (INPUT, 16007)...
>  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
> (*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
> (*) Direct/Thread: Running 'LiRC Input' (INPUT, 16008)...
> (*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media GmbH)
> (*) Direct/Thread: Running 'Keyboard Input' (INPUT, 16009)...
> (*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
> (*) DirectFB/Genefx: MMX detected and enabled
> (*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
> (*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
> [dfb] Supported video Modes are: 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 
> 640x480 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 
> 800x600 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
> 1024x768 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 
> 1280x960 at 8 1280x960 at 16 1280x960 at 32 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 
> 1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8
> [dfb] Enumeratig display Layers
> Layer 0 FBDev Primary Layer  Type: graphics
>   Caps: brightness contrast saturation surface
> Layer 1 VIA Unichrome Video  Type: graphics picture video
>   Caps: deinterlacing dst_colorkey opacity screen_location surface
> uc_overlay: color-keying is disabled
> [surface capabilities] scrSurface: primary videoonly double-buffered flipping
> [dfb] width = 640, height = 480
> [dfb] got fmt = 0x00418c04 bpp = 32
> [dfb] Using this layer for OSD: (FBDev Primary Layer - [640x480])
> [surface capabilities] osdSurface: videoonly double-buffered flipping
>  (!!!)  *** WARNING [letting unprivileged IDirectFBDisplayLayer::GetSurface() 
> call pass until cooperative level handling is finished] *** 
> [idirectfbdisplaylayer.c:170 in IDirectFBDisplayLayer_GetSurface()]
> [surface capabilities] videoSurface: videoonly
> [dfb] Configuring CooperativeLevel for Overlay
> [dfb] Configuring CooperativeLevel for OSD
> [dfb] Using this layer for OSD: FBDev Primary Layer
> [dfb] Using this layer for Video out: VIA Unichrome Video
> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
> Caught: action=IDirectFBDisplayLayer::SetLevel(int), result=Not supported! 
> Failed: SetLevel()
> uc_overlay: color-keying is enabled
> uc_overlay: color-keying is enabled
> uc_overlay: color-keying is enabled
> uc_overlay: color-keying is enabled
> [surface capabilities] videoSurface: videoonly double-buffered flipping
> [dfb] (re)configured 0x08100609
> Subplugin successfully opend
> [softdevice] Video Out seems to be OK
> [softdevice] Initializing Audio Out
> [softdevice] Audio out seems to be OK
> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
> 
> And the syslog says:
> 
> Jun  3 18:50:12 localhost vdr[15983]: VDR version 1.3.24 started
> Jun  3 18:50:12 localhost vdr[15983]: loading plugin: 
> ./PLUGINS/lib/libvdr-softdevice.so.1.3.24
> Jun  3 18:50:12 localhost vdr[15983]: loading /video/setup.conf
> Jun  3 18:50:12 localhost vdr[15983]: loading /video/sources.conf
> Jun  3 18:50:12 localhost vdr[15983]: loading /video/channels.conf
> Jun  3 18:50:12 localhost vdr[15983]: reading EPG data from /video/epg.data
> Jun  3 18:50:12 localhost vdr[15983]: probing /dev/dvb/adapter0/frontend0
> Jun  3 18:50:12 localhost vdr[15983]: probing /dev/dvb/adapter1/frontend0
> Jun  3 18:50:12 localhost vdr[15983]: found 2 video devices
> Jun  3 18:50:12 localhost vdr[15983]: initializing plugin: softdevice (0.1.2): A 
> software emulated MPEG2 device
> Jun  3 18:50:13 localhost vdr[15986]: tuner on device 1 thread started 
> (pid=15986, tid=16386)
> Jun  3 18:50:13 localhost vdr[15987]: Section handler thread started (pid=15987, 
> tid=32771)
> Jun  3 18:50:13 localhost vdr[15989]: tuner on device 2 thread started 
> (pid=15989, tid=49156)
> Jun  3 18:50:13 localhost vdr[15990]: Section handler thread started (pid=15990, 
> tid=65541)
> Jun  3 18:50:13 localhost udev[15993]: creating device node '/dev/vcs7'
> Jun  3 18:50:13 localhost udev[15995]: creating device node '/dev/vcsa7'
> Jun  3 18:50:13 localhost kernel: /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: 
> IR port opened
> Jun  3 18:50:13 localhost kernel: setmode x:640 y:480 bpp:32
> Jun  3 18:50:13 localhost vdr[15983]: [softdevice] videoOut OK !
> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Opening alsa device default
> Jun  3 18:50:13 localhost vdr[16010]: DFB remote control thread started (pid=16010)
> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Device opened! Ready to 
> play
> Jun  3 18:50:13 localhost vdr[15983]: setting primary device to 2
> Jun  3 18:50:13 localhost kernel: /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: 
> IR port closed
> Jun  3 18:50:13 localhost kernel: /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: 
> IR port opened
> Jun  3 18:50:13 localhost vdr[15983]: SVDRP listening on port 2001
> Jun  3 18:50:13 localhost vdr[15983]: loading /video/themes/sttng-default.theme
> Jun  3 18:50:13 localhost vdr[15983]: starting plugin: softdevice
> Jun  3 18:50:13 localhost vdr[15983]: loading /video/themes/sttng-default.theme
> Jun  3 18:50:13 localhost vdr[15983]: remote control softdevice-dfb - learning keys
> Jun  3 18:50:13 localhost vdr[16011]: LIRC remote control thread started 
> (pid=16011, tid=180236)
> Jun  3 18:50:13 localhost vdr[16012]: KBD remote control thread started 
> (pid=16012, tid=196621)
> Jun  3 18:50:20 localhost dhclient: DHCPREQUEST on eth0 to 192.168.0.110 port 67
> Jun  3 18:50:20 localhost dhclient: DHCPACK from 192.168.0.110
> Jun  3 18:50:20 localhost dhclient: bound to 192.168.0.234 -- renewal in 300 
> seconds.
> Jun  3 18:50:23 localhost vdr[15983]: remote control LIRC - learning keys
> Jun  3 18:50:33 localhost vdr[15983]: remote control KBD - learning keys
> Jun  3 18:50:43 localhost vdr[15983]: switching to channel 1
> Jun  3 18:50:48 localhost vdr[15983]: ERROR: device 1 has no lock, can't attach 
> receiver!
> Jun  3 18:50:49 localhost vdr[16019]: transfer thread started (pid=16019, 
> tid=213006)
> 
> 
> And all black in my CRT monitor.
> I have no tried with another monitor. Do you recommend me try it?
> What more could be happen?

I see many things here :
* in a previous mail, you talk about grub options (vga=791) : maybe you 
have both vesafb and viafb, the former driving the screen thus you have 
a black screen
* you are still in a learning keys phase : I don't remember how I solved 
this a year ago, but search the ML archive about this (both vdr and 
softdevice ML, I think).
* lastest line in log ("device 1 has no lock") makes me wonder if you 
reall have a DVB card, connected to a dish, and pointed to a satellite, 
or you might have no channels.conf file yet. You'd better first check if 
softdevice works (OSD is shown), and download a small test recording 
from my site (http://nicolas.huillard.net/vdr/meteo-express.tar.gz for 
instance : extract it in /video)

-- 
NH


From Stefan.Doermann at itt.com  Fri Jun  3 13:20:54 2005
From: Stefan.Doermann at itt.com (Doermann, Stefan - FHS)
Date: Fri, 3 Jun 2005 13:20:54 +0200
Subject: [Softdevice-devel] Softdevice 0.1.2 and vidix
Message-ID: <89DA0C8396353141B701CE3927F77C7502371158@FALNEXCH2.emea.itt.net>


Hi list,

I do have some questions about the latest softdevice 0.1.2:
a) When compiling softdevice with vidix support, vdr keeps restarting. Obviously softdevice causes an seg. fault. This hasn't happened with 0.1.1. I also tried CVS from 30th of mai, with the same result. Has anybody noticed a similar behaviour ?
b) When I compile both vidix and dfb support, always vidix is chosen, no matter what plugin I add to the command line.

Softplay:
Softplay works quite good with avi (DIVX or XVID) and of course mpeg2 formats, but mpeg1 files as contained in vcd can not be played. Is this normal ?

I am using FFMPEG cvs from mai, vdr-1.3.25, vidix-0.9.9.1 and directfb-0.9.22 on P3B with celeron 1400.
Thanks in advance.

Best regards, Mit freundlichen Gr?ssen,

Stefan Doermann
ITT Fluid Handling Systems
Project manager
Unnauer Weg 7a
50767 K?ln / Germany
Fon: 0049 (0) 221 7910 842
Fax: 0049 (0) 221 7910 472
Mobile: 0049 (0) 1726351965
Mail: stefan.doermann at itt.com




************************************
This e-mail and any files transmitted with it are proprietary and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender. Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of ITT Industries, Inc. The recipient should check this e-mail and any attachments for the presence of viruses. ITT Industries accepts no liability for any damage caused by any virus transmitted by this e-mail.
************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050603/c687918f/attachment.html>

From leo at calidae.net  Fri Jun  3 13:20:18 2005
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Fri, 03 Jun 2005 13:20:18 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A03AB5.2060908@e-dition.fr>
References: <42A03607.8060409@calidae.net> <42A03AB5.2060908@e-dition.fr>
Message-ID: <42A03CF2.4080709@calidae.net>

En/na Nicolas Huillard ha escrit:

> Leo M?rquez a ?crit :
>
>> Hi,
>>
>> I'm setting up vdr with softdevice dfb and viafb unichrome.
>> All seems to be ok but I don't see anything in my monitor when I 
>> start vdr. I have:
>>
>> vdr:/usr/src/VDR# ./vdr -P"softdevice -vo dfb:"
>> [softdevice] processing args
>> [softdevice]   argv [0] = softdevice
>> [softdevice] initializing Plugin
>> [softdevice] Initializing Video Out
>> [softdevice] ffmpeg version(cvs) build(4752)
>> [dfb] init
>>
>>        ---------------------- DirectFB v0.9.22 ---------------------
>>              (c) 2000-2002  convergence integrated media GmbH
>>              (c) 2002-2004  convergence GmbH
>>         -----------------------------------------------------------
>>
>> (*) DirectFB/Core: Single Application Core. (2005-05-27 21:18)
>> (*) Direct/Memcpy: Using SSE optimized memcpy()
>> (*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 15996)...
>> (*) Direct/Thread: Running 'PS/2 Input' (INPUT, 16007)...
>>  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
>> (*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
>> (*) Direct/Thread: Running 'LiRC Input' (INPUT, 16008)...
>> (*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media GmbH)
>> (*) Direct/Thread: Running 'Keyboard Input' (INPUT, 16009)...
>> (*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
>> (*) DirectFB/Genefx: MMX detected and enabled
>> (*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
>> (*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
>> [dfb] Supported video Modes are: 640x480 at 8 640x480 at 8 640x480 at 8 
>> 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 
>> 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
>> 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1152x864 at 8 1152x864 at 8 
>> 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1280x960 at 8 1280x960 at 16 
>> 1280x960 at 32 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 
>> 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8
>> [dfb] Enumeratig display Layers
>> Layer 0 FBDev Primary Layer  Type: graphics
>>   Caps: brightness contrast saturation surface
>> Layer 1 VIA Unichrome Video  Type: graphics picture video
>>   Caps: deinterlacing dst_colorkey opacity screen_location surface
>> uc_overlay: color-keying is disabled
>> [surface capabilities] scrSurface: primary videoonly double-buffered 
>> flipping
>> [dfb] width = 640, height = 480
>> [dfb] got fmt = 0x00418c04 bpp = 32
>> [dfb] Using this layer for OSD: (FBDev Primary Layer - [640x480])
>> [surface capabilities] osdSurface: videoonly double-buffered flipping
>>  (!!!)  *** WARNING [letting unprivileged 
>> IDirectFBDisplayLayer::GetSurface() call pass until cooperative level 
>> handling is finished] *** [idirectfbdisplaylayer.c:170 in 
>> IDirectFBDisplayLayer_GetSurface()]
>> [surface capabilities] videoSurface: videoonly
>> [dfb] Configuring CooperativeLevel for Overlay
>> [dfb] Configuring CooperativeLevel for OSD
>> [dfb] Using this layer for OSD: FBDev Primary Layer
>> [dfb] Using this layer for Video out: VIA Unichrome Video
>> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
>> Caught: action=IDirectFBDisplayLayer::SetLevel(int), result=Not 
>> supported! Failed: SetLevel()
>> uc_overlay: color-keying is enabled
>> uc_overlay: color-keying is enabled
>> uc_overlay: color-keying is enabled
>> uc_overlay: color-keying is enabled
>> [surface capabilities] videoSurface: videoonly double-buffered flipping
>> [dfb] (re)configured 0x08100609
>> Subplugin successfully opend
>> [softdevice] Video Out seems to be OK
>> [softdevice] Initializing Audio Out
>> [softdevice] Audio out seems to be OK
>> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
>>
>> And the syslog says:
>>
>> Jun  3 18:50:12 localhost vdr[15983]: VDR version 1.3.24 started
>> Jun  3 18:50:12 localhost vdr[15983]: loading plugin: 
>> ./PLUGINS/lib/libvdr-softdevice.so.1.3.24
>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/setup.conf
>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/sources.conf
>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/channels.conf
>> Jun  3 18:50:12 localhost vdr[15983]: reading EPG data from 
>> /video/epg.data
>> Jun  3 18:50:12 localhost vdr[15983]: probing 
>> /dev/dvb/adapter0/frontend0
>> Jun  3 18:50:12 localhost vdr[15983]: probing 
>> /dev/dvb/adapter1/frontend0
>> Jun  3 18:50:12 localhost vdr[15983]: found 2 video devices
>> Jun  3 18:50:12 localhost vdr[15983]: initializing plugin: softdevice 
>> (0.1.2): A software emulated MPEG2 device
>> Jun  3 18:50:13 localhost vdr[15986]: tuner on device 1 thread 
>> started (pid=15986, tid=16386)
>> Jun  3 18:50:13 localhost vdr[15987]: Section handler thread started 
>> (pid=15987, tid=32771)
>> Jun  3 18:50:13 localhost vdr[15989]: tuner on device 2 thread 
>> started (pid=15989, tid=49156)
>> Jun  3 18:50:13 localhost vdr[15990]: Section handler thread started 
>> (pid=15990, tid=65541)
>> Jun  3 18:50:13 localhost udev[15993]: creating device node '/dev/vcs7'
>> Jun  3 18:50:13 localhost udev[15995]: creating device node '/dev/vcsa7'
>> Jun  3 18:50:13 localhost kernel: 
>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port opened
>> Jun  3 18:50:13 localhost kernel: setmode x:640 y:480 bpp:32
>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice] videoOut OK !
>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Opening alsa 
>> device default
>> Jun  3 18:50:13 localhost vdr[16010]: DFB remote control thread 
>> started (pid=16010)
>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Device 
>> opened! Ready to play
>> Jun  3 18:50:13 localhost vdr[15983]: setting primary device to 2
>> Jun  3 18:50:13 localhost kernel: 
>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port closed
>> Jun  3 18:50:13 localhost kernel: 
>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port opened
>> Jun  3 18:50:13 localhost vdr[15983]: SVDRP listening on port 2001
>> Jun  3 18:50:13 localhost vdr[15983]: loading 
>> /video/themes/sttng-default.theme
>> Jun  3 18:50:13 localhost vdr[15983]: starting plugin: softdevice
>> Jun  3 18:50:13 localhost vdr[15983]: loading 
>> /video/themes/sttng-default.theme
>> Jun  3 18:50:13 localhost vdr[15983]: remote control softdevice-dfb - 
>> learning keys
>> Jun  3 18:50:13 localhost vdr[16011]: LIRC remote control thread 
>> started (pid=16011, tid=180236)
>> Jun  3 18:50:13 localhost vdr[16012]: KBD remote control thread 
>> started (pid=16012, tid=196621)
>> Jun  3 18:50:20 localhost dhclient: DHCPREQUEST on eth0 to 
>> 192.168.0.110 port 67
>> Jun  3 18:50:20 localhost dhclient: DHCPACK from 192.168.0.110
>> Jun  3 18:50:20 localhost dhclient: bound to 192.168.0.234 -- renewal 
>> in 300 seconds.
>> Jun  3 18:50:23 localhost vdr[15983]: remote control LIRC - learning 
>> keys
>> Jun  3 18:50:33 localhost vdr[15983]: remote control KBD - learning keys
>> Jun  3 18:50:43 localhost vdr[15983]: switching to channel 1
>> Jun  3 18:50:48 localhost vdr[15983]: ERROR: device 1 has no lock, 
>> can't attach receiver!
>> Jun  3 18:50:49 localhost vdr[16019]: transfer thread started 
>> (pid=16019, tid=213006)
>>
>>
>> And all black in my CRT monitor.
>> I have no tried with another monitor. Do you recommend me try it?
>> What more could be happen?
>
>
> I see many things here :
> * in a previous mail, you talk about grub options (vga=791) : maybe 
> you have both vesafb and viafb, the former driving the screen thus you 
> have a black screen

Yes, In the kernel configure I have VESA and CLE266 marked with an *.
Now I'm compiling kernel without vesa, only CLE.
But... in grub have I to quit the vga option?

> * you are still in a learning keys phase : I don't remember how I 
> solved this a year ago, but search the ML archive about this (both vdr 
> and softdevice ML, I think).

In my previous install of VDR in a normal computer I have resolved with 
the remote plugin and a remote control from a ff haupagge dvb-s card. 
Now I use lirc to can use the soundgraph imon remote that cames with the 
silverstone lc11M case.

> * lastest line in log ("device 1 has no lock") makes me wonder if you 
> reall have a DVB card, connected to a dish, and pointed to a 
> satellite, or you might have no channels.conf file yet. 

I have one budget dvb-t card not connected to the antena and one ff 
dvb-s card not conected to the dish yet.

> You'd better first check if softdevice works (OSD is shown), and 
> download a small test recording from my site 
> (http://nicolas.huillard.net/vdr/meteo-express.tar.gz for instance : 
> extract it in /video)

Thanks, I agree with you, the first step is view OSD.
And a curiousity, http://nicolas.huillard.net/vdr/ is your real VDR box?

Thanks for all

Leo


From Stefan.Doermann at itt.com  Fri Jun  3 13:36:42 2005
From: Stefan.Doermann at itt.com (Doermann, Stefan - FHS)
Date: Fri, 3 Jun 2005 13:36:42 +0200
Subject: [Softdevice-devel] shown memory using VIDIX
Message-ID: <89DA0C8396353141B701CE3927F77C750237115A@FALNEXCH2.emea.itt.net>


Hi list,

Propably someone else noticed the same. I am using a Matrox G450 double head with 32MB.
When softdevice starts with VIDIX support it is initalizing only 16MB. cat /proc/mtrr shows 32MB, so I am wondering what needs to be changed within the vidix driver.
Is there an option when VIDIX driver is loaded ?
I couldn't find any information about this yet.

Best regards, Mit freundlichen Gr?ssen,

Stefan Doermann
ITT Fluid Handling Systems
Project manager
Unnauer Weg 7a
50767 K?ln / Germany
Fon: 0049 (0) 221 7910 842
Fax: 0049 (0) 221 7910 472
Mobile: 0049 (0) 1726351965
Mail: stefan.doermann at itt.com




************************************
This e-mail and any files transmitted with it are proprietary and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender. Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of ITT Industries, Inc. The recipient should check this e-mail and any attachments for the presence of viruses. ITT Industries accepts no liability for any damage caused by any virus transmitted by this e-mail.
************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050603/13af767b/attachment.html>

From nhuillard at e-dition.fr  Fri Jun  3 14:16:36 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 03 Jun 2005 14:16:36 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A03CF2.4080709@calidae.net>
References: <42A03607.8060409@calidae.net> <42A03AB5.2060908@e-dition.fr> <42A03CF2.4080709@calidae.net>
Message-ID: <42A04A24.9030300@e-dition.fr>

Leo M?rquez a ?crit :
> En/na Nicolas Huillard ha escrit:
> 
>> Leo M?rquez a ?crit :
>>
>>> Hi,
>>>
>>> I'm setting up vdr with softdevice dfb and viafb unichrome.
>>> All seems to be ok but I don't see anything in my monitor when I 
>>> start vdr. I have:
>>>
>>> vdr:/usr/src/VDR# ./vdr -P"softdevice -vo dfb:"
>>> [softdevice] processing args
>>> [softdevice]   argv [0] = softdevice
>>> [softdevice] initializing Plugin
>>> [softdevice] Initializing Video Out
>>> [softdevice] ffmpeg version(cvs) build(4752)
>>> [dfb] init
>>>
>>>        ---------------------- DirectFB v0.9.22 ---------------------
>>>              (c) 2000-2002  convergence integrated media GmbH
>>>              (c) 2002-2004  convergence GmbH
>>>         -----------------------------------------------------------
>>>
>>> (*) DirectFB/Core: Single Application Core. (2005-05-27 21:18)
>>> (*) Direct/Memcpy: Using SSE optimized memcpy()
>>> (*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 15996)...
>>> (*) Direct/Thread: Running 'PS/2 Input' (INPUT, 16007)...
>>>  (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
>>> (*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
>>> (*) Direct/Thread: Running 'LiRC Input' (INPUT, 16008)...
>>> (*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media GmbH)
>>> (*) Direct/Thread: Running 'Keyboard Input' (INPUT, 16009)...
>>> (*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
>>> (*) DirectFB/Genefx: MMX detected and enabled
>>> (*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
>>> (*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
>>> [dfb] Supported video Modes are: 640x480 at 8 640x480 at 8 640x480 at 8 
>>> 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 
>>> 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
>>> 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1152x864 at 8 1152x864 at 8 
>>> 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1280x960 at 8 1280x960 at 16 
>>> 1280x960 at 32 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 
>>> 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8
>>> [dfb] Enumeratig display Layers
>>> Layer 0 FBDev Primary Layer  Type: graphics
>>>   Caps: brightness contrast saturation surface
>>> Layer 1 VIA Unichrome Video  Type: graphics picture video
>>>   Caps: deinterlacing dst_colorkey opacity screen_location surface
>>> uc_overlay: color-keying is disabled
>>> [surface capabilities] scrSurface: primary videoonly double-buffered 
>>> flipping
>>> [dfb] width = 640, height = 480
>>> [dfb] got fmt = 0x00418c04 bpp = 32
>>> [dfb] Using this layer for OSD: (FBDev Primary Layer - [640x480])
>>> [surface capabilities] osdSurface: videoonly double-buffered flipping
>>>  (!!!)  *** WARNING [letting unprivileged 
>>> IDirectFBDisplayLayer::GetSurface() call pass until cooperative level 
>>> handling is finished] *** [idirectfbdisplaylayer.c:170 in 
>>> IDirectFBDisplayLayer_GetSurface()]
>>> [surface capabilities] videoSurface: videoonly
>>> [dfb] Configuring CooperativeLevel for Overlay
>>> [dfb] Configuring CooperativeLevel for OSD
>>> [dfb] Using this layer for OSD: FBDev Primary Layer
>>> [dfb] Using this layer for Video out: VIA Unichrome Video
>>> [dfb] (re)configuring Videolayer to 720 x 576 (720x576)
>>> Caught: action=IDirectFBDisplayLayer::SetLevel(int), result=Not 
>>> supported! Failed: SetLevel()
>>> uc_overlay: color-keying is enabled
>>> uc_overlay: color-keying is enabled
>>> uc_overlay: color-keying is enabled
>>> uc_overlay: color-keying is enabled
>>> [surface capabilities] videoSurface: videoonly double-buffered flipping
>>> [dfb] (re)configured 0x08100609
>>> Subplugin successfully opend
>>> [softdevice] Video Out seems to be OK
>>> [softdevice] Initializing Audio Out
>>> [softdevice] Audio out seems to be OK
>>> [softdevice] A/V devices initialized, now initializing MPEG2 Decoder
>>>
>>> And the syslog says:
>>>
>>> Jun  3 18:50:12 localhost vdr[15983]: VDR version 1.3.24 started
>>> Jun  3 18:50:12 localhost vdr[15983]: loading plugin: 
>>> ./PLUGINS/lib/libvdr-softdevice.so.1.3.24
>>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/setup.conf
>>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/sources.conf
>>> Jun  3 18:50:12 localhost vdr[15983]: loading /video/channels.conf
>>> Jun  3 18:50:12 localhost vdr[15983]: reading EPG data from 
>>> /video/epg.data
>>> Jun  3 18:50:12 localhost vdr[15983]: probing 
>>> /dev/dvb/adapter0/frontend0
>>> Jun  3 18:50:12 localhost vdr[15983]: probing 
>>> /dev/dvb/adapter1/frontend0
>>> Jun  3 18:50:12 localhost vdr[15983]: found 2 video devices
>>> Jun  3 18:50:12 localhost vdr[15983]: initializing plugin: softdevice 
>>> (0.1.2): A software emulated MPEG2 device
>>> Jun  3 18:50:13 localhost vdr[15986]: tuner on device 1 thread 
>>> started (pid=15986, tid=16386)
>>> Jun  3 18:50:13 localhost vdr[15987]: Section handler thread started 
>>> (pid=15987, tid=32771)
>>> Jun  3 18:50:13 localhost vdr[15989]: tuner on device 2 thread 
>>> started (pid=15989, tid=49156)
>>> Jun  3 18:50:13 localhost vdr[15990]: Section handler thread started 
>>> (pid=15990, tid=65541)
>>> Jun  3 18:50:13 localhost udev[15993]: creating device node '/dev/vcs7'
>>> Jun  3 18:50:13 localhost udev[15995]: creating device node '/dev/vcsa7'
>>> Jun  3 18:50:13 localhost kernel: 
>>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port opened
>>> Jun  3 18:50:13 localhost kernel: setmode x:640 y:480 bpp:32
>>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice] videoOut OK !
>>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Opening alsa 
>>> device default
>>> Jun  3 18:50:13 localhost vdr[16010]: DFB remote control thread 
>>> started (pid=16010)
>>> Jun  3 18:50:13 localhost vdr[15983]: [softdevice-audio] Device 
>>> opened! Ready to play
>>> Jun  3 18:50:13 localhost vdr[15983]: setting primary device to 2
>>> Jun  3 18:50:13 localhost kernel: 
>>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port closed
>>> Jun  3 18:50:13 localhost kernel: 
>>> /usr/src/lirc/drivers/lirc_imon/lirc_imon.c: IR port opened
>>> Jun  3 18:50:13 localhost vdr[15983]: SVDRP listening on port 2001
>>> Jun  3 18:50:13 localhost vdr[15983]: loading 
>>> /video/themes/sttng-default.theme
>>> Jun  3 18:50:13 localhost vdr[15983]: starting plugin: softdevice
>>> Jun  3 18:50:13 localhost vdr[15983]: loading 
>>> /video/themes/sttng-default.theme
>>> Jun  3 18:50:13 localhost vdr[15983]: remote control softdevice-dfb - 
>>> learning keys
>>> Jun  3 18:50:13 localhost vdr[16011]: LIRC remote control thread 
>>> started (pid=16011, tid=180236)
>>> Jun  3 18:50:13 localhost vdr[16012]: KBD remote control thread 
>>> started (pid=16012, tid=196621)
>>> Jun  3 18:50:20 localhost dhclient: DHCPREQUEST on eth0 to 
>>> 192.168.0.110 port 67
>>> Jun  3 18:50:20 localhost dhclient: DHCPACK from 192.168.0.110
>>> Jun  3 18:50:20 localhost dhclient: bound to 192.168.0.234 -- renewal 
>>> in 300 seconds.
>>> Jun  3 18:50:23 localhost vdr[15983]: remote control LIRC - learning 
>>> keys
>>> Jun  3 18:50:33 localhost vdr[15983]: remote control KBD - learning keys
>>> Jun  3 18:50:43 localhost vdr[15983]: switching to channel 1
>>> Jun  3 18:50:48 localhost vdr[15983]: ERROR: device 1 has no lock, 
>>> can't attach receiver!
>>> Jun  3 18:50:49 localhost vdr[16019]: transfer thread started 
>>> (pid=16019, tid=213006)
>>>
>>> And all black in my CRT monitor.
>>> I have no tried with another monitor. Do you recommend me try it?
>>> What more could be happen?
>>
>> I see many things here :
>> * in a previous mail, you talk about grub options (vga=791) : maybe 
>> you have both vesafb and viafb, the former driving the screen thus you 
>> have a black screen
> 
> Yes, In the kernel configure I have VESA and CLE266 marked with an *.
> Now I'm compiling kernel without vesa, only CLE.

Compile the frame-buffer driver as a module (CLE only, with <M> in front 
in the menuconfig). That's better when dealing with kernel 
loading/unloading, etc.

> But... in grub have I to quit the vga option?

Yes. Just to simplify the setup at first. When you will have everthing 
OK, you can compile-in the CLE266 kernel frame-buffer (<Y>), and boot 
with a graphic mode to have a beautiful boot-up screen...

>> * you are still in a learning keys phase : I don't remember how I 
>> solved this a year ago, but search the ML archive about this (both vdr 
>> and softdevice ML, I think).
> 
> In my previous install of VDR in a normal computer I have resolved with 
> the remote plugin and a remote control from a ff haupagge dvb-s card. 
> Now I use lirc to can use the soundgraph imon remote that cames with the 
> silverstone lc11M case.
> 
>> * lastest line in log ("device 1 has no lock") makes me wonder if you 
>> reall have a DVB card, connected to a dish, and pointed to a 
>> satellite, or you might have no channels.conf file yet. 
> 
> I have one budget dvb-t card not connected to the antena and one ff 
> dvb-s card not conected to the dish yet.

Then VDR is up. You just have to see the OSD and view a recording. The 
proceed to live TV with all the wires...

>> You'd better first check if softdevice works (OSD is shown), and 
>> download a small test recording from my site 
>> (http://nicolas.huillard.net/vdr/meteo-express.tar.gz for instance : 
>> extract it in /video)
> 
> Thanks, I agree with you, the first step is view OSD.
> And a curiousity, http://nicolas.huillard.net/vdr/ is your real VDR box?

No. This is my hosting platform with lots of bandwidth. I upload 
VDR-related things there, including test recordings, test images, etc. 
BTW, I can use this space if anyone needs to upload files for sharing 
and does not have the necessary infrastructure.
My VDR is behind a parano?ac firewall and network setup at home. The 
first one to reach it will win the hability to read my list of 
recordings, and a stay in jail ;-)

-- 
NH


From leo at calidae.net  Fri Jun  3 17:47:24 2005
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Fri, 03 Jun 2005 17:47:24 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A04A24.9030300@e-dition.fr>
References: <42A03607.8060409@calidae.net> <42A03AB5.2060908@e-dition.fr> <42A03CF2.4080709@calidae.net> <42A04A24.9030300@e-dition.fr>
Message-ID: <42A07B8C.6070507@calidae.net>

>>
>> Yes, In the kernel configure I have VESA and CLE266 marked with an *.
>> Now I'm compiling kernel without vesa, only CLE.
>
>
> Compile the frame-buffer driver as a module (CLE only, with <M> in 
> front in the menuconfig). That's better when dealing with kernel 
> loading/unloading, etc.
>
Now I have viafb as module and when I do modprobe viafb i see in syslog:

Jun  3 23:34:04 localhost kernel: viafb: VIA UNICHROME framebuffer 1.0 
initializing
Jun  3 23:34:04 localhost kernel: viafb: viafb : F8E00000
Jun  3 23:34:04 localhost kernel: viafb: framebuffer size = 32 Mb
Jun  3 23:34:04 localhost kernel: viafb: Found Device Rev:0
Jun  3 23:34:04 localhost kernel: mtrr: MTRR 4 not used
Jun  3 23:34:04 localhost kernel: mtrr: 0xd8000000,0x2000000 overlaps 
existing 0xd8000000,0x800000
Jun  3 23:34:04 localhost kernel: viafb: X:720 Y:576
Jun  3 23:34:04 localhost kernel: viafb: mode=720  bpp=32  refresh=255  
TVon=0  TVtype=2
Jun  3 23:34:04 localhost kernel: viafb: VQ start:1FC0000  end:1FFFFFF  
size:40000
Jun  3 23:34:04 localhost kernel: viafb: Cursor start:1FBF000  
end:1FBFFFF  size:1000
Jun  3 23:34:04 localhost kernel: viafb: mode=720  bpp=32  refresh=255  
TVon=0  TVtype=2
Jun  3 23:34:04 localhost kernel: setmode x:720 y:576 bpp:32
Jun  3 23:34:04 localhost kernel: setmode x:720 y:576 bpp:32
Jun  3 23:34:04 localhost kernel: Console: switching to colour frame 
buffer device 90x36
Jun  3 23:34:04 localhost kernel: viafb: irq handler installed, 
IRQ(0x200) = 80080c00
Jun  3 23:34:04 localhost kernel: fb0: UNICHROME frame buffer device
Jun  3 23:34:04 localhost udev[3099]: creating device node '/dev/fb0'

And when start VDR:

vdr:/usr/src/VDR# ./vdr -P"softdevice -vo dfb:"
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(cvs) build(4752)
[dfb] init

       ---------------------- DirectFB v0.9.22 ---------------------
             (c) 2000-2002  convergence integrated media GmbH
             (c) 2002-2004  convergence GmbH
        -----------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2005-05-27 21:18)
(*) Direct/Memcpy: Using SSE optimized memcpy()
(*) Direct/Thread: Running 'VT Switcher' (CRITICAL, 3194)...
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 3205)...
 (!!!)  *** UNIMPLEMENTED [fusion_reactor_set_lock] *** [reactor.c:802]
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (Convergence GmbH)
(*) Direct/Thread: Running 'LiRC Input' (INPUT, 3206)...
(*) DirectFB/Input: LIRC Device 0.2 (convergence integrated media GmbH)
(*) Direct/Thread: Running 'Keyboard Input' (INPUT, 3207)...
(*) DirectFB/Input: Keyboard 0.9 (convergence integrated media GmbH)
(*) DirectFB/Genefx: MMX detected and enabled
(*) DirectFB/Graphics: VIA/S3G UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] Supported video Modes are: 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 
640x480 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 
800x600 at 8 800x600 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
1024x768 at 8 1024x768 at 8 1024x768 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 
1152x864 at 8 1152x864 at 8 1152x864 at 8 1280x960 at 8 1280x960 at 16 1280x960 at 32 
1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 
1600x1200 at 8 1600x1200 at 8
[dfb] Enumeratig display Layers
Layer 0 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 VIA Unichrome Video  Type: graphics picture video
  Caps: deinterlacing dst_colorkey opacity screen_location surface
uc_overlay: color-keying is disabled
[surface capabilities] scrSurface: primary videoonly double-buffered 
flipping
[dfb] width = 640, height = 480
[dfb] got fmt = 0x00418c04 bpp = 32
[dfb] Using this layer for OSD: (FBDev Primary Layer - [640x480])
[surface capabilities] osdSurface: videoonly double-buffered flipping

What about this line?:

 (!!!)  *** WARNING [letting unprivileged 
IDirectFBDisplayLayer::GetSurface() call pass until cooperative level 
handling is finished] *** [idirectfbdisplaylayer.c:170 in 
IDirectFBDisplayLayer_GetSurface()]

[surface capabilities] videoSurface: videoonly
[dfb] Configuring CooperativeLevel for Overlay
[dfb] Configuring CooperativeLevel for OSD
[dfb] Using this layer for OSD: FBDev Primary Layer
[dfb] Using this layer for Video out: VIA Unichrome Video
[dfb] (re)configuring Videolayer to 720 x 576 (720x576)

And this?:

Caught: action=IDirectFBDisplayLayer::SetLevel(int), result=Not 
supported! Failed: SetLevel()


uc_overlay: color-keying is enabled
uc_overlay: color-keying is enabled
uc_overlay: color-keying is enabled
uc_overlay: color-keying is enabled
[surface capabilities] videoSurface: videoonly double-buffered flipping
[dfb] (re)configured 0x08100609
Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder

What more can I try?
My patience is great but I'm trying to set up this a lot of days.
Thanks

Leo.


From M.Wache at gmx.net  Sat Jun  4 21:36:44 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Jun 2005 21:36:44 +0200
Subject: [Softdevice-devel] Repeatable crash with latest CVS
In-Reply-To: <20050530071042.GA234001@kosh.hut.fi>
References: <20050530071042.GA234001@kosh.hut.fi>
Message-ID: <42A202CC.5080106@gmx.net>

Marko M?kel? wrote:
> I have a recording with a 4:3 -> 16:9 transition.  When rewinding it at
> triple speed, a Signal 11 sometimes occurs.   I made a short clip that can be
> fast-forwarded and rewinded some times (maybe 5-10) to trigger the crash
> on my system.  Here is the stack trace from the core dump:

Thanks for your report, up to now I could not reproduce the crash on my 
box, but I didn't try very hard yet ;-)
 From your stack trace it looks like this bug will be very difficult to 
find (as always when the stack gets corrupted...)

Martin


From M.Wache at gmx.net  Sat Jun  4 21:36:53 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Jun 2005 21:36:53 +0200
Subject: [Softdevice-devel] Softdevice 0.1.2 and vidix
In-Reply-To: <89DA0C8396353141B701CE3927F77C7502371158@FALNEXCH2.emea.itt.net>
References: <89DA0C8396353141B701CE3927F77C7502371158@FALNEXCH2.emea.itt.net>
Message-ID: <42A202D5.5060009@gmx.net>

Doermann, Stefan - FHS wrote:
> Hi list,
>  
> I do have some questions about the latest softdevice 0.1.2:
> a) When compiling softdevice with vidix support, vdr keeps restarting. 
> Obviously softdevice causes an seg. fault. This hasn't happened with 
> 0.1.1. I also tried CVS from 30th of mai, with the same result. Has 
> anybody noticed a similar behaviour ?
For me vidix works just like in version 0.1.1. Is there something in the 
logs which could give a hint what causes the segfault? Or could you 
enable core dumps in your system and send me the backtrace?
> b) When I compile both vidix and dfb support, always vidix is chosen, no 
> matter what plugin I add to the command line.
What is the exact command line you use to start the softdevice with dfb 
support?
>  
> Softplay:
> Softplay works quite good with avi (DIVX or XVID) and of course mpeg2 
> formats, but mpeg1 files as contained in vcd can not be played. Is this 
> normal ? 
I have a single file with a mpeg1 encoded move, this one plays without 
any trouble. Also I don't know why vcd should not be played properly 
since they are supported by ffmpeg as far as I know.
What happens if you try to play these files? Do you get only audio?

Bye,
Martin


From M.Wache at gmx.net  Sat Jun  4 21:37:03 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sat, 04 Jun 2005 21:37:03 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in	startup
In-Reply-To: <1117478514.14424.0.camel@africa>
References: <b7bb36410505290948421de228@mail.gmail.com>	 <1117396167.14625.17.camel@africa>	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>	 <b7bb3641050530110227f2b313@mail.gmail.com> <1117478514.14424.0.camel@africa>
Message-ID: <42A202DF.6000707@gmx.net>

Torgeir Veimo wrote:
>>>Softplay also plays vdr recordings, so this would be the ultimate test
>>>to see if the problems are really just due to the data rate.
>>
>>Interestingly Softplay seems to replay vdr recordings flawlessly! 
> 
> 
> This works very well on my system too..
> 
Sorry for my late answer, I was quite busy the last days...
I guess it is proven that the problems are not due to slow harddisks.

It must be something in the way vdr access the data, since the buffers 
of the softdevice are full, it is either like Torgeir suspects some 
interrupt handler which takes all the cpu time or some other process. 
Are you starting vdr as root or non-root? When vdr is started as root it 
uses real-time schedule policies, so maybe the problem fanishes if vdr 
is started as root.
What is the overall response of the computer during these "hangs"? Can 
you move the mouse smoothly? What does top show on (how many vdr 
processes are there and how much cpu time do they use?)

Martin


From stefan at lucke.in-berlin.de  Sun Jun  5 09:14:06 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 5 Jun 2005 09:14:06 +0200
Subject: [Softdevice-devel] Softdevice 0.1.2 and vidix
In-Reply-To: <42A202D5.5060009@gmx.net>
References: <89DA0C8396353141B701CE3927F77C7502371158@FALNEXCH2.emea.itt.net> <42A202D5.5060009@gmx.net>
Message-ID: <200506050914.06098.stefan@lucke.in-berlin.de>

On Samstag, 4. Juni 2005 21:36, Martin Wache wrote:
> Doermann, Stefan - FHS wrote:
> > Hi list,
> >  
> > I do have some questions about the latest softdevice 0.1.2:
> > a) When compiling softdevice with vidix support, vdr keeps restarting. 
> > Obviously softdevice causes an seg. fault. This hasn't happened with 
> > 0.1.1. I also tried CVS from 30th of mai, with the same result. Has 
> > anybody noticed a similar behaviour ?
> For me vidix works just like in version 0.1.1. Is there something in the 
> logs which could give a hint what causes the segfault? Or could you 
> enable core dumps in your system and send me the backtrace?

For me it is crashing too :-) . I'm currently hunting this bug.
The crash is in YUV() method of vidix. It seems to be called when
the layer of vidix is not initialized (memcpy() line 410). One of
the last changes, calls YUV() from video.c too.

There is to my opinion another race/crash possibility, as constructor
of cVideoOut now starts a thread while derived classes aren't complete
initialized.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Jun  5 14:50:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 5 Jun 2005 14:50:26 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <4299BE47.7070805@gmx.net>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <4299BE47.7070805@gmx.net>
Message-ID: <200506051450.26169.stefan@lucke.in-berlin.de>

On Sonntag, 29. Mai 2005 15:06, Martin Wache wrote:
> Stefan Lucke wrote:
> > Hi,
> > 
> > with latest changes I get many xrun messages in syslog. They are audible too.
> > A/V sync seems to not ok. That is during live view.
> > 
> > May 29 13:23:57 jarada vdr[3357]: [softdevice-audio]: xrun
> > May 29 13:24:44 jarada last message repeated 15 times
> > May 29 13:25:49 jarada last message repeated 21 times
> > May 29 13:26:49 jarada last message repeated 12 times
> > May 29 13:27:49 jarada last message repeated 13 times
> > May 29 13:28:49 jarada last message repeated 2 times
> > 
> The cause for this is that I reduced the buffer sizes, I plan to make it 
> possible to choose between "good seeking" (that is currently the 
> default), a save buffer (like it was bevore), and HDTV buffers.
> The good seeking buffer is as large as the FF card buffers, that means 
> that when seeking backward vdr will correctly guess the current position.
> Right now the switch to choose the buffer size is still missing, so one 
> can't chosse yet :-(, but I'll add this feature soon.

un  5 14:34:04 jarada vdr[3189]: buffer usage: 60% (tid=294919)
Jun  5 14:34:04 jarada vdr[3189]: buffer usage: 70% (tid=294919)
Jun  5 14:34:05 jarada vdr[3189]: buffer usage: 80% (tid=294919)
Jun  5 14:34:06 jarada vdr[3193]: [softdevice-audio]: xrun
Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 90% (tid=294919)
Jun  5 14:34:14 jarada vdr[3188]: clearing transfer buffer to avoid overflows
Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 0% (tid=294919)
Jun  5 14:34:15 jarada vdr[3219]: [softdevice-audio]: xrun
Jun  5 14:34:25 jarada vdr[3219]: [softdevice-audio]: xrun

There must be something else. I played around with various buffer sizes,
without success.

-- 
Stefan Lucke



From prelude at kapsi.fi  Sun Jun  5 19:10:31 2005
From: prelude at kapsi.fi (prelude)
Date: Sun, 05 Jun 2005 20:10:31 +0300
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
Message-ID: <42A33207.1070903@kapsi.fi>

Hello

Some reason vdr-softdevice crash every time when it try to create 
surface :-/

<clip>
#./vdr -c /var/lib/vdr -L 
/root/CVS/vdr/vdr-1.3.23_sofdevice/PLUGINS/lib/ -P "softdevice -vo 
'dfb:mgatv'"
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg version(0.4.9-pre1) build(4745)
[dfb] init
(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
....
(*) DirectFB/Graphics: Matrox G400 0.7 (directfb.org)
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] Supported video Modes are: 720x576 at 16 720x576 at 32 720x576 at 16 
640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 768x576 at 32 800x600 at 8 
800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 
1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
1024x768 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 
1152x864 at 8 1280x960 at 8 1280x960 at 16 1280x960 at 32 1024x1024 at 8 1280x1024 at 8 
1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 
1600x1200 at 8
[dfb] Enumeratig display Layers
Layer 2 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
  Caps: brightness contrast deinterlacing dst_colorkey screen_location 
surface
Layer 0 Matrox CRTC2 Layer  Type: graphics picture video
  Caps: brightness contrast flicker_filtering hue field_parity 
saturation surface
[surface capabilities] scrSurface: videoonly flipping interlaced 
triple-buffered
[dfb] width = 720, height = 576
[dfb] got fmt = 0x00418c04 bpp = 32
(!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
(!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
Killed
<clip>

Problem coming from line 431 in video-dfb.c
   osdSurface   = dfb->CreateSurface (osdDsc);

Any idea how i can get it working?

System:
DirectFB, DFB++, lite, etc sources are from CVS (taken today) (df_xine, 
mplayer, all DFB examples working fine)
softdevice Source: vdr-softdevice-0.1.2.tgz and allso from CVS (Both 
make same error and both compiling whitout any error or warning) 
<http://download.berlios.de/softdevice/vdr-softdevice-0.1.2.tgz>

_________
#cat /etc/directfbrc
matrox-crtc2
matrox-tv-standard=pal
primary-layer=2
hardware
mode=720x576
depth=32
pixelformat=ARGB
no-vt-switch
_________







From juniper81 at gmail.com  Sun Jun  5 19:23:25 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Sun, 5 Jun 2005 20:23:25 +0300
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <42A33207.1070903@kapsi.fi>
References: <42A33207.1070903@kapsi.fi>
Message-ID: <b7bb3641050605102371e6bbed@mail.gmail.com>

> [dfb] width = 720, height = 576
> [dfb] got fmt = 0x00418c04 bpp = 32
> (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
> (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
> Killed
> <clip>
> 
> Problem coming from line 431 in video-dfb.c
>    osdSurface   = dfb->CreateSurface (osdDsc);
> 
> Any idea how i can get it working?
>

I think I had similar issues few months ago (although on G450)  but
can't remember for sure how I solved them. I just have a wild guess
that it might have been related to the fusion module. Are you using
the fusion module? If I remember correctly softdevice didn't work that
enabled.

How about the graphics card memory, is DirectFB seeing all the memory
your card has? If not you could apply the full memory kernel patch
that comes with DFB.

- Ari


From stefan at lucke.in-berlin.de  Sun Jun  5 22:40:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 5 Jun 2005 22:40:26 +0200
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <b7bb3641050605102371e6bbed@mail.gmail.com>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com>
Message-ID: <200506052240.26857.stefan@lucke.in-berlin.de>

On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
> > [dfb] width = 720, height = 576
> > [dfb] got fmt = 0x00418c04 bpp = 32
> > (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
> > (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
> > Killed
> > <clip>
> > 
> > Problem coming from line 431 in video-dfb.c
> >    osdSurface   = dfb->CreateSurface (osdDsc);
> > 
> > Any idea how i can get it working?
> >
> 
> I think I had similar issues few months ago (although on G450)  but
> can't remember for sure how I solved them. I just have a wild guess
> that it might have been related to the fusion module. Are you using
> the fusion module? If I remember correctly softdevice didn't work that
> enabled.
> 
> How about the graphics card memory, is DirectFB seeing all the memory
> your card has? If not you could apply the full memory kernel patch
> that comes with DFB.

Good idea, but unfortunately reporting video memory is disabled
for directfb incompatibilty break.. So the question is:
Is matrox full memory patch applied to the kernel ?


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Jun  5 22:59:37 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 5 Jun 2005 22:59:37 +0200
Subject: [Softdevice-devel] Softdevice 0.1.2 and vidix
In-Reply-To: <200506050914.06098.stefan@lucke.in-berlin.de>
References: <89DA0C8396353141B701CE3927F77C7502371158@FALNEXCH2.emea.itt.net> <42A202D5.5060009@gmx.net> <200506050914.06098.stefan@lucke.in-berlin.de>
Message-ID: <200506052259.37783.stefan@lucke.in-berlin.de>

On Sonntag, 5. Juni 2005 09:14, Stefan Lucke wrote:
> On Samstag, 4. Juni 2005 21:36, Martin Wache wrote:
> > Doermann, Stefan - FHS wrote:
> > > Hi list,
> > >  
> > > I do have some questions about the latest softdevice 0.1.2:
> > > a) When compiling softdevice with vidix support, vdr keeps restarting. 
> > > Obviously softdevice causes an seg. fault. This hasn't happened with 
> > > 0.1.1. I also tried CVS from 30th of mai, with the same result. Has 
> > > anybody noticed a similar behaviour ?
> > For me vidix works just like in version 0.1.1. Is there something in the 
> > logs which could give a hint what causes the segfault? Or could you 
> > enable core dumps in your system and send me the backtrace?
> 
> For me it is crashing too :-) . I'm currently hunting this bug.
> The crash is in YUV() method of vidix. It seems to be called when
> the layer of vidix is not initialized (memcpy() line 410). One of
> the last changes, calls YUV() from video.c too.

A fix for vidix crash is in cvs now.


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Sun Jun  5 23:04:45 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 5 Jun 2005 23:04:45 +0200
Subject: [Softdevice-devel] shown memory using VIDIX
In-Reply-To: <89DA0C8396353141B701CE3927F77C750237115A@FALNEXCH2.emea.itt.net>
References: <89DA0C8396353141B701CE3927F77C750237115A@FALNEXCH2.emea.itt.net>
Message-ID: <200506052304.45737.stefan@lucke.in-berlin.de>

On Freitag, 3. Juni 2005 13:36, Doermann, Stefan - FHS wrote:
> 
> Hi list,
> 
> Propably someone else noticed the same. I am using a Matrox G450 double head with 32MB.
> When softdevice starts with VIDIX support it is initalizing only 16MB. cat /proc/mtrr shows 32MB, so I am wondering what needs to be changed within the vidix driver.
> Is there an option when VIDIX driver is loaded ?

Detecting the full memory size of matrox card is sometime problematic.
Even with matrox full memory patch (for directFB) applies to my kernel,
vidix still reports only 16M. Perhaps memory is counted per head.

-- 
Stefan Lucke



From prelude at kapsi.fi  Sun Jun  5 23:53:28 2005
From: prelude at kapsi.fi (prelude)
Date: Mon, 06 Jun 2005 00:53:28 +0300
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <200506052240.26857.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com> <200506052240.26857.stefan@lucke.in-berlin.de>
Message-ID: <42A37458.4090808@kapsi.fi>

Stefan Lucke wrote:

>On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
>  
>
>>>[dfb] width = 720, height = 576
>>>[dfb] got fmt = 0x00418c04 bpp = 32
>>>(!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
>>>(!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
>>>Killed
>>><clip>
>>>
>>>Problem coming from line 431 in video-dfb.c
>>>   osdSurface   = dfb->CreateSurface (osdDsc);
>>>
>>>Any idea how i can get it working?
>>>
>>>      
>>>
>>I think I had similar issues few months ago (although on G450)  but
>>can't remember for sure how I solved them. I just have a wild guess
>>that it might have been related to the fusion module. Are you using
>>the fusion module? If I remember correctly softdevice didn't work that
>>enabled.
>>
>>How about the graphics card memory, is DirectFB seeing all the memory
>>your card has? If not you could apply the full memory kernel patch
>>that comes with DFB.
>>    
>>
>
>Good idea, but unfortunately reporting video memory is disabled
>for directfb incompatibilty break.. So the question is:
>Is matrox full memory patch applied to the kernel ?
>
>
>  
>
Yes it is. (matroxfb-full-memory-linux-2.6.6.patch)
And kernel version is 2.6.10.

I allso tested DirectFB whitout fushion ("modprobe -r fusion" and 
compiling all whitout "--enable-multi" option) but result was same.
I dont know where i can look how mutch memory DFB use :-/
But my  /proc/mtrr looks like that:
reg00: base=0x00000000 (   0MB), size= 512MB: write-back, count=1
reg01: base=0xf4000000 (3904MB), size=  16MB: write-combining, count=1
reg07: base=0xf8000000 (3968MB), size=  64MB: write-combining, count=1

and df reports:
Filesystem           1K-blocks      Used Available Use% Mounted on
...
devfs                     5120      2884      2236  57% /dev
tmpfs                  1048576       396   1048180   1% /dev/shm






From lucianm at users.sourceforge.net  Mon Jun  6 01:36:15 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 06 Jun 2005 01:36:15 +0200
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <200506052240.26857.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com> <200506052240.26857.stefan@lucke.in-berlin.de>
Message-ID: <42A38C6F.2090005@users.sourceforge.net>

Stefan Lucke wrote:
> On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
>> > [dfb] width = 720, height = 576
>> > [dfb] got fmt = 0x00418c04 bpp = 32
>> > (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
>> > (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
>> > Killed
>> > <clip>
>> > 
>> > Problem coming from line 431 in video-dfb.c
>> >    osdSurface   = dfb->CreateSurface (osdDsc);
>> > 
>> > Any idea how i can get it working?
>> >
>> 
>> I think I had similar issues few months ago (although on G450)  but
>> can't remember for sure how I solved them. I just have a wild guess
>> that it might have been related to the fusion module. Are you using
>> the fusion module? If I remember correctly softdevice didn't work that
>> enabled.
>> 
>> How about the graphics card memory, is DirectFB seeing all the memory
>> your card has? If not you could apply the full memory kernel patch
>> that comes with DFB.
> 
> Good idea, but unfortunately reporting video memory is disabled
> for directfb incompatibilty break.. So the question is:

I sent a simple patch to this, I guess a week ago. Did it get lost? Here 
it is again.

Regards,
Lucian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice-0.1.2_dfb-0.9.23.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050606/3598c02c/attachment.ksh>

From lucianm at users.sourceforge.net  Mon Jun  6 02:00:05 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 06 Jun 2005 02:00:05 +0200
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <42A38C6F.2090005@users.sourceforge.net>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com> <200506052240.26857.stefan@lucke.in-berlin.de> <42A38C6F.2090005@users.sourceforge.net>
Message-ID: <42A39205.8070607@users.sourceforge.net>

Lucian Muresan wrote:
> Stefan Lucke wrote:
>> On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
>>> > [dfb] width = 720, height = 576
>>> > [dfb] got fmt = 0x00418c04 bpp = 32
>>> > (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
>>> > (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
>>> > Killed
>>> > <clip>
>>> > 
>>> > Problem coming from line 431 in video-dfb.c
>>> >    osdSurface   = dfb->CreateSurface (osdDsc);
>>> > 
>>> > Any idea how i can get it working?
>>> >
>>> 
>>> I think I had similar issues few months ago (although on G450)  but
>>> can't remember for sure how I solved them. I just have a wild guess
>>> that it might have been related to the fusion module. Are you using
>>> the fusion module? If I remember correctly softdevice didn't work that
>>> enabled.
>>> 
>>> How about the graphics card memory, is DirectFB seeing all the memory
>>> your card has? If not you could apply the full memory kernel patch
>>> that comes with DFB.
>> 
>> Good idea, but unfortunately reporting video memory is disabled
>> for directfb incompatibilty break.. So the question is:
> 
> I sent a simple patch to this, I guess a week ago. Did it get lost? Here 
> it is again.

Sorry, previous one was missing the reported RAM line. Corrected patch 
attached,

Lucian
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice-0.1.2_dfb-0.9.23.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050606/63f75689/attachment.ksh>

From stefan at lucke.in-berlin.de  Mon Jun  6 08:26:50 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Jun 2005 08:26:50 +0200
Subject: [Softdevice-devel] [patch] DirectFB-0.9.23 (GetDeviceDescription)
In-Reply-To: <429A5F74.5080105@users.sourceforge.net>
References: <429A5F74.5080105@users.sourceforge.net>
Message-ID: <200506060826.50315.stefan@lucke.in-berlin.de>

On Montag, 30. Mai 2005 02:33, Lucian Muresan wrote:
> Hi,
> 
> I had this tiny patch around from version 0.1.1 of the softdevice but 
> forgot to submit. Now, even if in version 0.1.2 you commented out the 
> actual code in reportCardInfo, you might find it useful to bring it all 
> back :-).
> 

Thanks commited (latest version with RAM reporting).

This was not forgotten. I just dind't try, because I expect a failure
on some systems. But as long as we have no configure script
(I'm working on one) it will eventually fail for some people.
They have to re-checkout directfb.

-- 
Stefan Lucke



From juniper81 at gmail.com  Mon Jun  6 09:11:05 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Mon, 6 Jun 2005 10:11:05 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <42A202DF.6000707@gmx.net>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>
Message-ID: <b7bb36410506060011715e86a3@mail.gmail.com>

> It must be something in the way vdr access the data, since the buffers
> of the softdevice are full, it is either like Torgeir suspects some
> interrupt handler which takes all the cpu time or some other process.
> Are you starting vdr as root or non-root? 

I'm starting it as root.

> What is the overall response of the computer during these "hangs"? Can
> you move the mouse smoothly? What does top show on (how many vdr
> processes are there and how much cpu time do they use?)

I don't have a mouse so I can't try. Here's some stats from top:

live TV:

used CPU time:  ~40%
number of vdr processes: 2 - 4

replaying recording through softdevice:

used CPU time: ~50 - 70 %
number of vdr processess: 3 - 6

replaying through softplay:

used CPU time : ~40%
number of vdr processes: 2 - 3

Although I should mention that the test system is not the same as
before because I upgraded softdevice to the recent CVS on saturday and
vdr to 1.3.25 and ffmpeg to some other version. I say some other
because I couldn't compile softdevice with the recent cvs of ffmpeg. I
guess I should start a new thread about that  issue..


From juniper81 at gmail.com  Mon Jun  6 10:08:38 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Mon, 6 Jun 2005 11:08:38 +0300
Subject: [Softdevice-devel] Compiling problems with recent ffmpeg CVS
Message-ID: <b7bb3641050606010823d7b884@mail.gmail.com>

On weekend I noticed that softdevice 0.1.2 fails to compile with this
kind of error message:

g++ -g -O2 -Wall -Woverloaded-virtual -c -DUSE_MMX -DUSE_MMX2
-DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DDFB_SUPPORT -I../../../include
-I../DVB/include -I/root/libavcodec/include/ffmpeg
-I/usr/local/include/dfb++ -I/usr/local/include/directfb
mpeg2decoder.c
mpeg2decoder.c: In member function `void cMpeg2Decoder::initStream()':
mpeg2decoder.c:1030: error: invalid conversion from `int (*)(void*, long long 
   int, int)' to `offset_t (*)(void*, long long int, int)'
make[1]: *** [mpeg2decoder.o] Error 1


Compiling at least with ffmpeg CVS snapshot 20050304 works.


From prelude at kapsi.fi  Mon Jun  6 11:32:18 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Mon, 6 Jun 2005 12:32:18 +0300 (EEST)
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <42A39205.8070607@users.sourceforge.net>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com>
 <200506052240.26857.stefan@lucke.in-berlin.de> <42A38C6F.2090005@users.sourceforge.net>
 <42A39205.8070607@users.sourceforge.net>
Message-ID: <Pine.LNX.4.62.0506061228500.12980@lakka>


On Mon, 6 Jun 2005, Lucian Muresan wrote:

> Lucian Muresan wrote:
>> Stefan Lucke wrote:
>>> On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
>>>> > [dfb] width = 720, height = 576
>>>> > [dfb] got fmt = 0x00418c04 bpp = 32
>>>> > (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0) <--
>>>> > (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
>>>> > Killed
>>>> > <clip>
>>>> > > Problem coming from line 431 in video-dfb.c
>>>> >    osdSurface   = dfb->CreateSurface (osdDsc);
>>>> > > Any idea how i can get it working?
>>>> >
>>>> How about the graphics card memory, is DirectFB seeing all the memory
>>>> your card has? If not you could apply the full memory kernel patch
>>>> that comes with DFB.
>>> 
>>> Good idea, but unfortunately reporting video memory is disabled
>>> for directfb incompatibilty break.. So the question is:
>> 
>> I sent a simple patch to this, I guess a week ago. Did it get lost? Here it 
>> is again.
>
> Sorry, previous one was missing the reported RAM line. Corrected patch 
> attached,
>
> Lucian

I added that patch to source and now it's report:

(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] RAM: 8388608 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine FillTriangle Blit StretchBlit All

That 8MB look's pretty low so maybe that is problem.
Now i need to find how i can add more memory to DFB.




From stefan at lucke.in-berlin.de  Mon Jun  6 12:11:43 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon,  6 Jun 2005 12:11:43 +0200
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <Pine.LNX.4.62.0506061228500.12980@lakka>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com> <200506052240.26857.stefan@lucke.in-berlin.de> <42A38C6F.2090005@users.sourceforge.net> <42A39205.8070607@users.sourceforge.net> <Pine.LNX.4.62.0506061228500.12980@lakka>
Message-ID: <1118052703.42a4215fb8698@webmail.in-berlin.de>

Quoting Tommi Lundell :

>
>
> On Mon, 6 Jun 2005, Lucian Muresan wrote:
>
> > Lucian Muresan wrote:
> >> Stefan Lucke wrote:
> >>> On Sonntag, 5. Juni 2005 19:23, Ari Koponen wrote:
> >>>> > [dfb] width = 720, height = 576
> >>>> > [dfb] got fmt = 0x00418c04 bpp = 32
> >>>> > (!) [ 6288:    1.152] --> Caught signal 6 (sent by pid 6288, uid 0)
> <--
> >>>> > (!) Direct/Thread: Killing 'Fusion Dispatch' (6294)!
> >>>> > Killed
> >>>> > <clip>
> >>>> > > Problem coming from line 431 in video-dfb.c
> >>>> >    osdSurface   = dfb->CreateSurface (osdDsc);
> >>>> > > Any idea how i can get it working?
> >>>> >
> >>>> How about the graphics card memory, is DirectFB seeing all the memory
> >>>> your card has? If not you could apply the full memory kernel patch
> >>>> that comes with DFB.
> >>>
> >>> Good idea, but unfortunately reporting video memory is disabled
> >>> for directfb incompatibilty break.. So the question is:
> >>
> >> I sent a simple patch to this, I guess a week ago. Did it get lost? Here
> it
> >> is again.
> >
> > Sorry, previous one was missing the reported RAM line. Corrected patch
> > attached,
> >
> > Lucian
>
> I added that patch to source and now it's report:
>
> (*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
> [dfb] RAM: 8388608 bytes
> [dfb] Accellerated Functions: FillRectange DrawRectange DrawLine FillTriangle
> Blit StretchBlit All
>
> That 8MB look's pretty low so maybe that is problem.
> Now i need to find how i can add more memory to DFB.

Ack. What does fbset -i report ?

Stefan Lucke


From leo at calidae.net  Mon Jun  6 14:23:26 2005
From: leo at calidae.net (=?ISO-8859-1?Q?Leo_M=E1rquez?=)
Date: Mon, 06 Jun 2005 14:23:26 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A07B8C.6070507@calidae.net>
References: <42A03607.8060409@calidae.net> <42A03AB5.2060908@e-dition.fr> <42A03CF2.4080709@calidae.net> <42A04A24.9030300@e-dition.fr> <42A07B8C.6070507@calidae.net>
Message-ID: <42A4403E.4070006@calidae.net>

Hi again,

I think that my problem is with my /etc/directfbrc. I haven't touch it.
I have connected the epia s-video to a Tv and I see ok the console. But 
when I do modprobe viafb I lost the image and see white lines. I have 
taked a look to the epia bios and no see the option LCD+TV (i have a lcd 
15" monitor and my TV).
Then I can't probe the two outputs at same time.
I understand I have to set up the /etc/directfbrc file with corrects 
values to see VDR in my lcd or TV.
How can I know this values for my TV? For the LCD I supose that any 
habitual resolution works (1024x768 for example).
Now I'm at work and I don't know that I have in /etc/directfbrc and 
can't probe it.
Any additional orientation to my suppositions will be thanked for.

Leo.



From lucianm at users.sourceforge.net  Mon Jun  6 14:32:57 2005
From: lucianm at users.sourceforge.net (Lucian Muresan)
Date: Mon, 06 Jun 2005 14:32:57 +0200
Subject: [Softdevice-devel] [patch] DirectFB-0.9.23 (GetDeviceDescription)
In-Reply-To: <200506060826.50315.stefan@lucke.in-berlin.de>
References: <429A5F74.5080105@users.sourceforge.net> <200506060826.50315.stefan@lucke.in-berlin.de>
Message-ID: <42A44279.5020905@users.sourceforge.net>

Stefan Lucke wrote:
> On Montag, 30. Mai 2005 02:33, Lucian Muresan wrote:
> 
>>Hi,
>>
>>I had this tiny patch around from version 0.1.1 of the softdevice but 
>>forgot to submit. Now, even if in version 0.1.2 you commented out the 
>>actual code in reportCardInfo, you might find it useful to bring it all 
>>back :-).
>>
> 
> 
> Thanks commited (latest version with RAM reporting).
> 
> This was not forgotten. I just dind't try, because I expect a failure
> on some systems. But as long as we have no configure script
> (I'm working on one) it will eventually fail for some people.
> They have to re-checkout directfb.
> 

Thanks for commiting, I have to apologize again for sending the wrong 
patch in the first place. Somehow I've got you picking the wrong patch 
after all, I've just looked in the web-based CVS browser and the RAM 
reporting line is missing in Rev 1.28 of video-dfb.c. Please add it, I'm 
sorry as I caused all this by sending the wrong patch.

Regards,
Lucian


From prelude at kapsi.fi  Mon Jun  6 15:06:59 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Mon, 6 Jun 2005 16:06:59 +0300 (EEST)
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <1118052703.42a4215fb8698@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <b7bb3641050605102371e6bbed@mail.gmail.com>
 <200506052240.26857.stefan@lucke.in-berlin.de> <42A38C6F.2090005@users.sourceforge.net>
 <42A39205.8070607@users.sourceforge.net> <Pine.LNX.4.62.0506061228500.12980@lakka>
 <1118052703.42a4215fb8698@webmail.in-berlin.de>
Message-ID: <Pine.LNX.4.62.0506061601240.19925@lakka>


On Mon, 6 Jun 2005, Stefan Lucke wrote:

>> That 8MB look's pretty low so maybe that is problem.
>> Now i need to find how i can add more memory to DFB.
>
> Ack. What does fbset -i report ?
>
> Stefan Lucke


# fbset -i -fb /dev/fb/0

mode "640x480-60"
     # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz
     geometry 640 480 640 13107 8
     timings 39721 40 24 32 11 96 2
     accel true
     rgba 8/0,8/0,8/0,0/0
endmode

Frame buffer device information:
     Name        : MATROX
     Address     : 0xf4000000
     Size        : 8388608
     Type        : PACKED PIXELS
     Visual      : PSEUDOCOLOR
     XPanStep    : 8
     YPanStep    : 1
     YWrapStep   : 0
     LineLength  : 640
     MMIO Address: 0xf2000000
     MMIO Size   : 16384
     Accelerator : Matrox G400
___
# fbset -i -fb /dev/fb/1

mode "640x480-60"
     # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz
     geometry 640 480 640 480 32
     timings 39721 48 16 33 10 96 2
     rgba 8/16,8/8,8/0,8/24
endmode

Frame buffer device information:
     Name        : MATROX DH
     Address     : 0xf4800000
     Size        : 8388608
     Type        : PACKED PIXELS
     Visual      : TRUECOLOR
     XPanStep    : 8
     YPanStep    : 1
     YWrapStep   : 0
     LineLength  : 2560
     MMIO Address: 0xf2000000
     MMIO Size   : 16384
     Accelerator : No

___
# cat /var/log/dmesg
matroxfb: Matrox G400 (AGP) detected
matroxfb: MTRR's turned on
matroxfb: 640x480x8bpp (virtual: 640x26214)
matroxfb: framebuffer at 0xF4000000, mapped to 0xe0880000, size 16777216
Console: switching to colour frame buffer device 80x30
fb0: MATROX frame buffer device
Linux agpgart interface v0.100 (c) Dave Jones
agpgart: Detected AMD 761 chipset
agpgart: Maximum main memory to use for agp memory: 439M
agpgart: AGP aperture is 64M @ 0xf8000000

____
# lspci -v
0000:01:05.0 VGA compatible controller: Matrox Graphics, Inc. MGA G400 AGP 
(rev 04) (prog-if 00 [VGA])
         Subsystem: Matrox Graphics, Inc. Marvel G400 AGP
         Flags: bus master, medium devsel, latency 64, IRQ 11
         Memory at f4000000 (32-bit, prefetchable) [size=f3ff0000]
         Memory at f2000000 (32-bit, non-prefetchable) [size=16K]
         Memory at f1800000 (32-bit, non-prefetchable) [size=8M]
         Expansion ROM at 00010000 [disabled]
         Capabilities: [dc] Power Management version 2
         Capabilities: [f0] AGP version 2.0

__
Do i understand right that both fb can use 8MB memory (total 16MB)?
If so then DFB memory is ok if i understand right.




From nhuillard at e-dition.fr  Mon Jun  6 15:39:54 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 06 Jun 2005 15:39:54 +0200
Subject: [Softdevice-devel] why I don't see anything?
In-Reply-To: <42A4403E.4070006@calidae.net>
References: <42A03607.8060409@calidae.net> <42A03AB5.2060908@e-dition.fr> <42A03CF2.4080709@calidae.net> <42A04A24.9030300@e-dition.fr> <42A07B8C.6070507@calidae.net> <42A4403E.4070006@calidae.net>
Message-ID: <42A4522A.8010902@e-dition.fr>

Leo M?rquez a ?crit :
> Hi again,
> 
> I think that my problem is with my /etc/directfbrc. I haven't touch it.
> I have connected the epia s-video to a Tv and I see ok the console. But 
> when I do modprobe viafb I lost the image and see white lines. I have 
> taked a look to the epia bios and no see the option LCD+TV (i have a lcd 
> 15" monitor and my TV).

The BIOS option would have enabled the TV-out at boot-up. There is also 
an auto-detect feature in the VT1622 chip, that can activate TV-out when 
a TV is actually connected. I think I've upgraded the BIOS of my board, 
and maybe that option appeared at that time.
So : you're OK on the BIOS front.

> Then I can't probe the two outputs at same time.

Did you pass the TV-out parameter when loading the viafb module ? When 
you load it, it overrides the BIOS defaults, and may activate a wrong setup.
My modprobe is (for kernel 2.6):

modprobe viafb mode=720x576 bpp=32 refresh=50 TVon=1 TVoverscan=1

This *may* relies on /etc/fb.modes, where I have :

mode "720x576-74"
     # D: 41.475 MHz, H: 44.693 kHz, V: 74.488 Hz
     geometry 720 576 720 1152 32
     timings 24111 88 32 16 4 88 4
     rgba 8/16,8/8,8/0,8/24
endmode

DirectFB tests will also rely on /etc/directfbrc :

mode=720x576
depth=32
pixelformat=ARGB
disable-module=lirc
disable-module=joystick
disable-module=cle266
no-vt

> I understand I have to set up the /etc/directfbrc file with corrects 
> values to see VDR in my lcd or TV.

Only modprobe params are used to set output device type (TV and/or VGA). 
frame-buffer manipulation programs also rely on /etc/fb.modes (timings, 
geometry). Maybe differing options will make TV out useless.
All those stuff are still a bit unclear for me, and also a little buggy...

> How can I know this values for my TV? For the LCD I supose that any 
> habitual resolution works (1024x768 for example).

TV-out mist work only if you set TVon=1 on the modprobe line (add maybe 
also TVtype et al. : check those options), *and* the selected mode have 
a TV-out settings ready-made (1024x768 works, 800x600 also, some modes 
work only in PAL, others only in NTSC, many in both). This may also only 
work if the /etc/fb.modes have right timings.

> Now I'm at work and I don't know that I have in /etc/directfbrc and 
> can't probe it.
> Any additional orientation to my suppositions will be thanked for.

The viafb tarball from viaarena contains a fb.modes file with mode 
sections that could work better than mine (they do not work better in my 
case, though).

-- 
NH


From ospite at studenti.unina.it  Mon Jun  6 16:02:02 2005
From: ospite at studenti.unina.it (A.O.)
Date: Mon, 6 Jun 2005 16:02:02 +0200
Subject: [Softdevice-devel] An initial solution for bug #002971 ?
Message-ID: <20050606160202.35ecaea4.ospite@studenti.unina.it>

Hi,

maybe i found an initial solution for bug #002971, about the buzzy sound
someone experienced with softdevice. I took the idea form mplayer
libao2/ao_alsa.c, it seems that the Data buffer has to be aligned at
sample boundary... but i'm not very expert in such things, maybe other
things have to be checked before closing the bug.

Anyway, i attach here a little patch that cures the buzz effect on my
setup (i use the snd_cs46xx alsa driver on a Thinkpad T20), the sound is
now shiny and clear but i'm experiencing some crashes when going
fullscreen or on channel change.

[OT] Is it planned a key-passthrough feature in softdevice? Let me be
clearer: when i push a key when the softdevice window has the focus i
wish that the keypress is delivered to vdr itself, i know there
could be some conflicts with keys undestood by softdevice, but we can
avoid these using a modifier key for softdevice key-commands.

Thanks for the really great plugin.

Have a good time,
   Antonio.

P.S. Please CC me, i'm not subscribed to the list.
-- 
Public key: http://studenti.unina.it/~ospite/aopubkey.asc
  Web Site: http://studenti.unina.it/~ospite
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice_alsa.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050606/f0c4145c/attachment.ksh>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050606/f0c4145c/attachment.pgp>

From marko.makela at hut.fi  Mon Jun  6 17:33:34 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 6 Jun 2005 18:33:34 +0300
Subject: [Softdevice-devel] Repeatable crash with latest CVS
In-Reply-To: <42A202CC.5080106@gmx.net>
References: <20050530071042.GA234001@kosh.hut.fi> <42A202CC.5080106@gmx.net>
Message-ID: <20050606153334.GA133462@kosh.hut.fi>

On Sat, Jun 04, 2005 at 09:36:44PM +0200, Martin Wache wrote:
> Marko M?kel? wrote:
> >I have a recording with a 4:3 -> 16:9 transition.  When rewinding it at
> >triple speed, a Signal 11 sometimes occurs.   I made a short clip that can 
> >be
> >fast-forwarded and rewinded some times (maybe 5-10) to trigger the crash
> >on my system.  Here is the stack trace from the core dump:
> 
> Thanks for your report, up to now I could not reproduce the crash on my 
> box, but I didn't try very hard yet ;-)

I got it twice today on the first try when rewinding the clip from the end
to the beginning at triple speed.  The second time was within gdb, running
vdr 1.3.24 with the patch from subtitles-0.3.7 and with only the softdevice
plugin loaded, using DirectFB 0.9.22 playback on a Matrox G400 or G450 card
on VGA monitor with 4:3 cropping:

(gdb) bt full
#0  0xb7dceb7f in memcpy () from /lib/libc.so.6
No symbol table info available.
#1  0xb79523da in cDFBVideoOut::YUV (this=0x82247c8,
    Py=0xb64fcb30 '\200' <repeats 200 times>...,
    Pu=0x8313bc8 '\200' <repeats 200 times>...,
    Pv=0x83a0940 '\200' <repeats 200 times>..., Width=720, Height=576,
    Ystride=752, UVstride=376) at video-dfb.c:1021
        dst = (uint8_t *) 0xb779bee0 <Address 0xb779bee0 out of bounds>
        pitch = 576
        hi = 288
#2  0xb7948e21 in cVideoStreamDecoder::DecodePacket (this=0x82d91c0,
    pkt=0x82bdcd0) at mpeg2decoder.c:594
        findPTS = -1216758048
        aPTS = 13256359796953190256
        pts_corr = 80
        dispTime = 360
        len = 0
        got_picture = 32
        data = (uint8_t *) 0x82a0f90 ""
        size = 2029
#3  0xb7947ca4 in cStreamDecoder::Action (this=0x82d91c0) at mpeg2decoder.c:185
        pkt = (AVPacket *) 0x82bdcd0
#4  0x080e3ca6 in cThread::StartThread (Thread=0x82d91c0) at thread.c:227
No locals.
#5  0xb7f77e51 in pthread_start_thread () from /lib/libpthread.so.0
No symbol table info available.
#6  0xb7f77ecf in pthread_start_thread_event () from /lib/libpthread.so.0
No symbol table info available.
#7  0xb7e2e92a in clone () from /lib/libc.so.6
No symbol table info available.

> From your stack trace it looks like this bug will be very difficult to 
> find (as always when the stack gets corrupted...)

The above stack trace doesn't look like totally corrupted.  Here's a bit
more analysis:

(gdb) up
#1  0xb79523da in cDFBVideoOut::YUV (this=0x82247c8,
    Py=0xb64fcb30 '\200' <repeats 200 times>...,
    Pu=0x8313bc8 '\200' <repeats 200 times>...,
    Pv=0x83a0940 '\200' <repeats 200 times>..., Width=720, Height=576,
    Ystride=752, UVstride=376) at video-dfb.c:1021
1021          memcpy(dst, Pv+sxoff/2, swidth/2);
Current language:  auto; currently c++
(gdb) p *this
$1 = {<cVideoOut> = {<cThread> = {_vptr.cThread = 0xb7bf4fa8, running = true,
      childTid = 49156, mutex = {mutex = {__m_reserved = 0, __m_count = 0,
          __m_owner = 0x0, __m_kind = 2, __m_lock = {__status = 0,
            __spinlock = 0}}, locked = 0}, description = 0x0,
      static emergencyExitRequested = false}, osdMutex = {mutex = {
        __m_reserved = 0, __m_count = 0, __m_owner = 0x0, __m_kind = 2,
        __m_lock = {__status = 0, __spinlock = 0}}, locked = 0}, OSDxOfs = 54,
    OSDyOfs = 427, OSDw = 624, OSDh = 104, OSDpresent = true,
    OSDpseudo_alpha = true, current_osdMode = 0, Xres = 736, Yres = 576,
    Bpp = 32, dx = 0, dy = 0, dwidth = 768, dheight = 576, old_x = 0,
    old_y = 0, old_dwidth = 0, old_dheight = 0, screenPixelAspect = 0,
    fwidth = 720, fheight = 576, swidth = 720, sheight = 576, sxoff = 0,
    syoff = 0, lwidth = 768, lheight = 576, lxoff = 0, lyoff = 0, flags = 0,
    display_aspect = 0, current_aspect = 1, currentPixelFormat = 0,
    aspect_changed = 0, current_afd = 1, parValues = {1, 0.9375, 1,
      1.3333333333333333, 1.2000000000000002}, setupStore = 0xb7c623e0,
    osd = 0x83bf428, active = true, OSDdirty = false, freezeMode = false,
    PixelMask = 0x0, Osd_changed = 0, OsdPy = 0xb6730008 "",
    OsdPu = 0x82280b0 '\177' <repeats 200 times>...,
    OsdPv = 0x8241ec0 '\177' <repeats 200 times>...,
    OsdPAlphaY = 0xb66c8008 "", OsdPAlphaUV = 0x825bcd0 "", OsdHeight = 576,
    OsdWidth = 736, OsdRefreshCounter = 0}, osdLayer = 0x8278420,
  videoLayer = 0x8278f88, scrDsc = {flags = 9, caps = 533, width = 0,
    height = 0, pixelformat = DSPF_ARGB, preallocated = {{data = 0x0,
        pitch = 0}, {data = 0x0, pitch = 0}}, palette = {entries = 0x0,
      size = 0}}, osdDsc = {flags = 15, caps = 532, width = 736, height = 576,
    pixelformat = DSPF_ARGB, preallocated = {{data = 0x0, pitch = 0}, {
        data = 0x0, pitch = 0}}, palette = {entries = 0x0, size = 0}},
  vidDsc = {flags = 15, caps = DSCAPS_VIDEOONLY, width = 540, height = 576,
    pixelformat = DSPF_I420, preallocated = {{data = 0x0, pitch = 0}, {
        data = 0x0, pitch = 0}}, palette = {entries = 0x0, size = 0}},
  osdSurface = 0x8279880, videoSurface = 0xb6512cd8, scrSurface = 0x82794a8,
  pixelformat = DSPF_I420, dfbRemote = 0x8279a00, events = 0x8279b90,
  deinterlace = false, alphablend = false, useStretchBlit = false,
  osdClrBack = false, isVIAUnichrome = false, clearAlpha = 0,
  clearBackCount = 2, clearBackground = 0, dfb = 0x8277d00}
(gdb) up
#2  0xb7948e21 in cVideoStreamDecoder::DecodePacket (this=0x82d91c0,
    pkt=0x82bdcd0) at mpeg2decoder.c:594
594         videoOut->YUV(picture->data[0], picture->data[1],picture->data[2],
(gdb) p *this
$2 = {<cStreamDecoder> = {<cThread> = {_vptr.cThread = 0xb7bf3408,
      running = true, childTid = 376844, mutex = {mutex = {__m_reserved = 0,
          __m_count = 0, __m_owner = 0x0, __m_kind = 2, __m_lock = {
            __status = 0, __spinlock = 0}}, locked = 0}, description = 0x0,
      static emergencyExitRequested = false}, PacketQueue = {MaxPackets = 150,
      queue = 0x82bce60, FirstPacket = 84, LastPacket = 61,
      EnablePut = {<cRelTimer> = {_vptr.cRelTimer = 0xb7bf4610,
          lastTime = 1394350295}, mutex = {__m_reserved = 0, __m_count = 0,
          __m_owner = 0x0, __m_kind = 0, __m_lock = {__status = 0,
            __spinlock = 0}}, cond = {__c_lock = {__status = 0,
            __spinlock = 0}, __c_waiting = 0x0,
          __padding = '\0' <repeats 27 times>, __align = 0},
        got_signal = false}, EnableGet = {<cRelTimer> = {
          _vptr.cRelTimer = 0xb7bf4610, lastTime = 1394176623}, mutex = {
          __m_reserved = 0, __m_count = 0, __m_owner = 0x0, __m_kind = 0,
          __m_lock = {__status = 0, __spinlock = 0}}, cond = {__c_lock = {
            __status = 0, __spinlock = 0}, __c_waiting = 0x0,
          __padding = '\0' <repeats 27 times>, __align = 0},
        got_signal = true}}, syncTimer = 0x83deff8, freezeMode = false,
    pts = 12884901888, frame = 3, codec = 0xb7c53b00, context = 0x82d8e78,
    mutex = {mutex = {__m_reserved = 0, __m_count = 0, __m_owner = 0xbe3ffbe0,
        __m_kind = 2, __m_lock = {__status = 1, __spinlock = 0}}, locked = 1},
    active = true, running = true}, clock = 0x827a23c, pts_values = {{
      coded_frame_no = 0, pts = 704986713, duration = 0}, {coded_frame_no = 1,
      pts = 704981913, duration = 0}, {coded_frame_no = 2, pts = 704977113,
      duration = 0}, {coded_frame_no = 3, pts = 704972313, duration = 0}, {
      coded_frame_no = 4, pts = 704967513, duration = 0}, {coded_frame_no = 5,
      pts = 704962713, duration = 0}, {coded_frame_no = -1, pts = -1,
      duration = -1}, {coded_frame_no = -1, pts = -1, duration = -1}, {
      coded_frame_no = -1, pts = -1, duration = -1}, {coded_frame_no = -1,
      pts = -1, duration = -1}}, lastPTSidx = 6, lastCodedPictNo = 5,
  lastPTS = 704957913, lastDuration = 0, picture = 0x8279ba0, avpic_src = {
    data = {0x0, 0x0, 0x0, 0x0}, linesize = {0, 0, 0, 0}}, avpic_dest = {
    data = {0x0, 0x0, 0x0, 0x0}, linesize = {0, 0, 0, 0}}, width = 720,
  height = 576, currentDeintMethod = 0, currentMirrorMode = 0,
  pic_buf_lavc = 0x0, pic_buf_pp = 0x0, pic_buf_mirror = 0x0, ppmode = 0x0,
  ppcontext = 0x0, videoOut = 0x82247c8, hurry_up = 1, offset = 10301,
  delay = -89966, trickspeed = 1, default_frametime = 400}
(gdb) up
#3  0xb7947ca4 in cStreamDecoder::Action (this=0x82d91c0) at mpeg2decoder.c:185
185              DecodePacket(pkt);
(gdb) p *this
$3 = {<cThread> = {_vptr.cThread = 0xb7bf3408, running = true,
    childTid = 376844, mutex = {mutex = {__m_reserved = 0, __m_count = 0,
        __m_owner = 0x0, __m_kind = 2, __m_lock = {__status = 0,
          __spinlock = 0}}, locked = 0}, description = 0x0,
    static emergencyExitRequested = false}, PacketQueue = {MaxPackets = 150,
    queue = 0x82bce60, FirstPacket = 84, LastPacket = 61,
    EnablePut = {<cRelTimer> = {_vptr.cRelTimer = 0xb7bf4610,
        lastTime = 1394350295}, mutex = {__m_reserved = 0, __m_count = 0,
        __m_owner = 0x0, __m_kind = 0, __m_lock = {__status = 0,
          __spinlock = 0}}, cond = {__c_lock = {__status = 0, __spinlock = 0},
        __c_waiting = 0x0, __padding = '\0' <repeats 27 times>, __align = 0},
      got_signal = false}, EnableGet = {<cRelTimer> = {
        _vptr.cRelTimer = 0xb7bf4610, lastTime = 1394176623}, mutex = {
        __m_reserved = 0, __m_count = 0, __m_owner = 0x0, __m_kind = 0,
        __m_lock = {__status = 0, __spinlock = 0}}, cond = {__c_lock = {
          __status = 0, __spinlock = 0}, __c_waiting = 0x0,
        __padding = '\0' <repeats 27 times>, __align = 0},
      got_signal = true}}, syncTimer = 0x83deff8, freezeMode = false,
  pts = 12884901888, frame = 3, codec = 0xb7c53b00, context = 0x82d8e78,
  mutex = {mutex = {__m_reserved = 0, __m_count = 0, __m_owner = 0xbe3ffbe0,
      __m_kind = 2, __m_lock = {__status = 1, __spinlock = 0}}, locked = 1},
  active = true, running = true}
(gdb) up
#4  0x080e3ca6 in cThread::StartThread (Thread=0x82d91c0) at thread.c:227
227       Thread->Action();

I hope that this will help you further.

	Marko


From M.Wache at gmx.net  Mon Jun  6 17:39:18 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 06 Jun 2005 17:39:18 +0200
Subject: [Softdevice-devel] An initial solution for bug #002971 ?
In-Reply-To: <20050606160202.35ecaea4.ospite@studenti.unina.it>
References: <20050606160202.35ecaea4.ospite@studenti.unina.it>
Message-ID: <42A46E26.9060705@gmx.net>

A.O. wrote:
> Hi,
> 
> maybe i found an initial solution for bug #002971, about the buzzy sound
> someone experienced with softdevice. I took the idea form mplayer
> libao2/ao_alsa.c, it seems that the Data buffer has to be aligned at
> sample boundary... but i'm not very expert in such things, maybe other
> things have to be checked before closing the bug.
> 
> Anyway, i attach here a little patch that cures the buzz effect on my
> setup (i use the snd_cs46xx alsa driver on a Thinkpad T20), the sound is
> now shiny and clear but i'm experiencing some crashes when going
> fullscreen or on channel change.
I'm not sure if the explanation and the patch is correct, but you 
definitely found a bug in audio.c. The pointer Data has to be increased 
for sure when not all data has been accepted by snd_pcm_wait. I will 
check your patch... Thank you for reporting this!

By the way I own a soundcard with a cs46xx chipset and to me the driver 
seems not to be stable, at first I thougth it would be due to the 
softdevice, but I also had some hard crashes (->_no_ response at all 
from the computer) when playing mp3 with xmms. Now all these issues are 
gone after a change of the soundcard.

> 
> [OT] Is it planned a key-passthrough feature in softdevice? Let me be
> clearer: when i push a key when the softdevice window has the focus i
> wish that the keypress is delivered to vdr itself, i know there
> could be some conflicts with keys undestood by softdevice, but we can
> avoid these using a modifier key for softdevice key-commands.
Are you using Xv-out? Xv-out currently takes some keys (for brightness 
etc. control) which are not passed to vdr. Is this what you mean?
All other keys are passed to vdr, and the long term plan is to make 
these brightness etc. controls available from the osd, so that we can 
stop using those keys.

Martin


From M.Wache at gmx.net  Mon Jun  6 17:51:40 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 06 Jun 2005 17:51:40 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb36410506060011715e86a3@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>	 <1117396167.14625.17.camel@africa>	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>	 <b7bb3641050530110227f2b313@mail.gmail.com>	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net> <b7bb36410506060011715e86a3@mail.gmail.com>
Message-ID: <42A4710C.2040401@gmx.net>

Ari Koponen wrote:

> live TV:
> 
> used CPU time:  ~40%
> number of vdr processes: 2 - 4
> 
> replaying recording through softdevice:
> 
> used CPU time: ~50 - 70 %
> number of vdr processess: 3 - 6
> 
> replaying through softplay:
> 
> used CPU time : ~40%
> number of vdr processes: 2 - 3
So there seems to be some process which takes unnecessarily takes CPU 
time when replaying a recording... Unfortunatly I'm still a bit short on 
time, but I will check on my box if I also see the difference. Than we 
have to find out which process takes the CPU time and see how we can fix 
it. On my system there is usually one thread which takes about 20-30% of 
the cpu time, this is the video decoding thread, all others take less 
than 10% cpu time. Is it the same for you when replaying a recording?

> 
> Although I should mention that the test system is not the same as
> before because I upgraded softdevice to the recent CVS on saturday and
> vdr to 1.3.25 and ffmpeg to some other version. I say some other
> because I couldn't compile softdevice with the recent cvs of ffmpeg. I
> guess I should start a new thread about that  issue..
Did this change the behavior when replaying a recording?

Martin


From stefan at lucke.in-berlin.de  Mon Jun  6 20:34:55 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Jun 2005 20:34:55 +0200
Subject: [Softdevice-devel] [patch] DirectFB-0.9.23 (GetDeviceDescription)
In-Reply-To: <42A44279.5020905@users.sourceforge.net>
References: <429A5F74.5080105@users.sourceforge.net> <200506060826.50315.stefan@lucke.in-berlin.de> <42A44279.5020905@users.sourceforge.net>
Message-ID: <200506062034.55117.stefan@lucke.in-berlin.de>

On Montag, 6. Juni 2005 14:32, Lucian Muresan wrote:
> Stefan Lucke wrote:
> > On Montag, 30. Mai 2005 02:33, Lucian Muresan wrote:
> > 
> >>Hi,
> >>
> >>I had this tiny patch around from version 0.1.1 of the softdevice but 
> >>forgot to submit. Now, even if in version 0.1.2 you commented out the 
> >>actual code in reportCardInfo, you might find it useful to bring it all 
> >>back :-).
> >>
> > 
> > 
> > Thanks commited (latest version with RAM reporting).
> > 
> > This was not forgotten. I just dind't try, because I expect a failure
> > on some systems. But as long as we have no configure script
> > (I'm working on one) it will eventually fail for some people.
> > They have to re-checkout directfb.
> > 
> 
> Thanks for commiting, I have to apologize again for sending the wrong 
> patch in the first place. Somehow I've got you picking the wrong patch 
> after all, I've just looked in the web-based CVS browser and the RAM 
> reporting line is missing in Rev 1.28 of video-dfb.c. Please add it, I'm 
> sorry as I caused all this by sending the wrong patch.

That was my fault. I thought that I had seen the ram message, but
obviously it is/ was not there.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Jun  6 20:54:44 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Jun 2005 20:54:44 +0200
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <Pine.LNX.4.62.0506061601240.19925@lakka>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka>
Message-ID: <200506062054.44899.stefan@lucke.in-berlin.de>

On Montag, 6. Juni 2005 15:06, Tommi Lundell wrote:
> 
> On Mon, 6 Jun 2005, Stefan Lucke wrote:
> 
> >> That 8MB look's pretty low so maybe that is problem.
> >> Now i need to find how i can add more memory to DFB.
> >
> > Ack. What does fbset -i report ?
> >
> > Stefan Lucke
> 

> Frame buffer device information:
>      Name        : MATROX
>      Address     : 0xf4000000
>      Size        : 8388608

> ___
> # cat /var/log/dmesg
> matroxfb: Matrox G400 (AGP) detected
> matroxfb: MTRR's turned on
> matroxfb: 640x480x8bpp (virtual: 640x26214)
> matroxfb: framebuffer at 0xF4000000, mapped to 0xe0880000, size 16777216

> __
> Do i understand right that both fb can use 8MB memory (total 16MB)?
> If so then DFB memory is ok if i understand right.

Could you check that your "matrox full memory patch" is still present ?
At my system (G550) I've only /dev/fb0. /dev/fb1 is reportet with
"no such device". With my G400 system fb0 is reported as 32M and
fb1 with 8M :-). Yes card has only 32M

Are the matrox drivers compiled in or loaded as modules, as they should ?


-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Jun  6 21:55:36 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Jun 2005 21:55:36 +0200
Subject: [Softdevice-devel] Repeatable crash with latest CVS
In-Reply-To: <20050606153334.GA133462@kosh.hut.fi>
References: <20050530071042.GA234001@kosh.hut.fi> <42A202CC.5080106@gmx.net> <20050606153334.GA133462@kosh.hut.fi>
Message-ID: <200506062155.36956.stefan@lucke.in-berlin.de>

On Montag, 6. Juni 2005 17:33, Marko M?kel? wrote:
> On Sat, Jun 04, 2005 at 09:36:44PM +0200, Martin Wache wrote:
> > Marko M?kel? wrote:
> > >I have a recording with a 4:3 -> 16:9 transition.  When rewinding it at
> > >triple speed, a Signal 11 sometimes occurs.   I made a short clip that can 
> > >be
> > >fast-forwarded and rewinded some times (maybe 5-10) to trigger the crash
> > >on my system.  Here is the stack trace from the core dump:
> > 
> > Thanks for your report, up to now I could not reproduce the crash on my 
> > box, but I didn't try very hard yet ;-)
> 
> I got it twice today on the first try when rewinding the clip from the end
> to the beginning at triple speed.  The second time was within gdb, running
> vdr 1.3.24 with the patch from subtitles-0.3.7 and with only the softdevice
> plugin loaded, using DirectFB 0.9.22 playback on a Matrox G400 or G450 card
> on VGA monitor with 4:3 cropping:
> 
> (gdb) bt full
> #0  0xb7dceb7f in memcpy () from /lib/libc.so.6
> No symbol table info available.
> #1  0xb79523da in cDFBVideoOut::YUV (this=0x82247c8,
>     Py=0xb64fcb30 '\200' <repeats 200 times>...,
>     Pu=0x8313bc8 '\200' <repeats 200 times>...,
>     Pv=0x83a0940 '\200' <repeats 200 times>..., Width=720, Height=576,
>     Ystride=752, UVstride=376) at video-dfb.c:1021
>         dst = (uint8_t *) 0xb779bee0 <Address 0xb779bee0 out of bounds>
>         pitch = 576
>         hi = 288

I don't understand that: When hi = 288 we should have left the loop as
hi < sheight/2 (with sheight = 576) should be evaluate FALSE.
pitch seems to strange too. When width is 720, pitch should be a
reasonable value above that (768 ?).


-- 
Stefan Lucke



From M.Wache at gmx.net  Mon Jun  6 23:00:01 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 06 Jun 2005 23:00:01 +0200
Subject: [Softdevice-devel] Compiling problems with recent ffmpeg CVS
In-Reply-To: <b7bb3641050606010823d7b884@mail.gmail.com>
References: <b7bb3641050606010823d7b884@mail.gmail.com>
Message-ID: <42A4B951.8010705@gmx.net>

Ari Koponen wrote:
> On weekend I noticed that softdevice 0.1.2 fails to compile with this
> kind of error message:
> 
> g++ -g -O2 -Wall -Woverloaded-virtual -c -DUSE_MMX -DUSE_MMX2
> -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE
> -DPLUGINLIBDIR='"./PLUGINS/lib"' -DDFB_SUPPORT -I../../../include
> -I../DVB/include -I/root/libavcodec/include/ffmpeg
> -I/usr/local/include/dfb++ -I/usr/local/include/directfb
> mpeg2decoder.c
> mpeg2decoder.c: In member function `void cMpeg2Decoder::initStream()':
> mpeg2decoder.c:1030: error: invalid conversion from `int (*)(void*, long long 
>    int, int)' to `offset_t (*)(void*, long long int, int)'
> make[1]: *** [mpeg2decoder.o] Error 1
> 
That should be fixed now. Thanks for the report.

Martin


From M.Wache at gmx.net  Mon Jun  6 23:00:10 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 06 Jun 2005 23:00:10 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <200506051450.26169.stefan@lucke.in-berlin.de>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <4299BE47.7070805@gmx.net> <200506051450.26169.stefan@lucke.in-berlin.de>
Message-ID: <42A4B95A.102@gmx.net>

Stefan Lucke wrote:

>>The cause for this is that I reduced the buffer sizes, I plan to make it 
>>possible to choose between "good seeking" (that is currently the 
>>default), a save buffer (like it was bevore), and HDTV buffers.
>>The good seeking buffer is as large as the FF card buffers, that means 
>>that when seeking backward vdr will correctly guess the current position.
>>Right now the switch to choose the buffer size is still missing, so one 
>>can't chosse yet :-(, but I'll add this feature soon.
> 
> 
> un  5 14:34:04 jarada vdr[3189]: buffer usage: 60% (tid=294919)
> Jun  5 14:34:04 jarada vdr[3189]: buffer usage: 70% (tid=294919)
> Jun  5 14:34:05 jarada vdr[3189]: buffer usage: 80% (tid=294919)
> Jun  5 14:34:06 jarada vdr[3193]: [softdevice-audio]: xrun
> Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 90% (tid=294919)
> Jun  5 14:34:14 jarada vdr[3188]: clearing transfer buffer to avoid overflows
> Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 0% (tid=294919)
> Jun  5 14:34:15 jarada vdr[3219]: [softdevice-audio]: xrun
> Jun  5 14:34:25 jarada vdr[3219]: [softdevice-audio]: xrun
> 
> There must be something else. I played around with various buffer sizes,
> without success.
> 
Sorry, I have not finished the buffer size selection yet. Which buffer 
size did you increase? Did you choose one of the combinations from 
mpeg2decoder.h?

Martin


From M.Wache at gmx.net  Mon Jun  6 23:00:21 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Mon, 06 Jun 2005 23:00:21 +0200
Subject: [Softdevice-devel] An initial solution for bug #002971 ?
In-Reply-To: <42A46E26.9060705@gmx.net>
References: <20050606160202.35ecaea4.ospite@studenti.unina.it> <42A46E26.9060705@gmx.net>
Message-ID: <42A4B965.5000109@gmx.net>

Martin Wache wrote:
> A.O. wrote:
> 
>> Hi,
>>
>> maybe i found an initial solution for bug #002971, about the buzzy sound
>> someone experienced with softdevice. I took the idea form mplayer
>> libao2/ao_alsa.c, it seems that the Data buffer has to be aligned at
>> sample boundary... but i'm not very expert in such things, maybe other
>> things have to be checked before closing the bug.
>>
>> Anyway, i attach here a little patch that cures the buzz effect on my
>> setup (i use the snd_cs46xx alsa driver on a Thinkpad T20), the sound is
>> now shiny and clear but i'm experiencing some crashes when going
>> fullscreen or on channel change.
> 
> I'm not sure if the explanation and the patch is correct, but you 
> definitely found a bug in audio.c. The pointer Data has to be increased 
> for sure when not all data has been accepted by snd_pcm_wait. I will 
> check your patch... Thank you for reporting this!

I checked the patch, it looks correct and I applied it.
Thank you again!

Martin


From prelude at kapsi.fi  Mon Jun  6 23:30:18 2005
From: prelude at kapsi.fi (prelude)
Date: Tue, 07 Jun 2005 00:30:18 +0300
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <200506062054.44899.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de>
Message-ID: <42A4C06A.6070204@kapsi.fi>

Stefan Lucke wrote:

>Could you check that your "matrox full memory patch" is still present ?
>At my system (G550) I've only /dev/fb0. /dev/fb1 is reportet with
>"no such device". With my G400 system fb0 is reported as 32M and
>fb1 with 8M :-). Yes card has only 32M
>
>Are the matrox drivers compiled in or loaded as modules, as they should ?
>
>
>  
>

I checked that pach from 
"/usr/src/linux/drivers/video/matrox/matroxfb_base.c" and patch is ok.
        fix->smem_start = ACCESS_FBINFO(video.base) + 
ACCESS_FBINFO(curr.ydstorg.bytes);
       fix->smem_len = ACCESS_FBINFO(video.len) - 
ACCESS_FBINFO(curr.ydstorg.bytes);

And ".config" i have:
# Graphics support
#
CONFIG_FB=y
CONFIG_FB_MODE_HELPERS=y
CONFIG_FB_TILEBLITTING=y
CONFIG_FB_VGA16=m
CONFIG_VIDEO_SELECT=y
CONFIG_FB_INTEL=m
CONFIG_FB_MATROX=y
CONFIG_FB_MATROX_G100A=y
CONFIG_FB_MATROX_G100=y
CONFIG_FB_MATROX_I2C=m
CONFIG_FB_MATROX_MAVEN=m
CONFIG_FB_MATROX_MULTIHEAD=y
CONFIG_FB_VIRTUAL=m

#
# Console display driver support
#
CONFIG_VGA_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_FONT_8x8=y
CONFIG_FONT_8x16=y

#
# Logo configuration
#
CONFIG_LOGO=y
CONFIG_LOGO_LINUX_MONO=y
CONFIG_LOGO_LINUX_VGA16=y
CONFIG_LOGO_LINUX_CLUT224=y

__________
lsmod:
matroxfb_crtc2         10432  0
i2c_matroxfb            5056  0
i2c_algo_bit            9928  2 cx88xx,i2c_matroxfb
i2c_dev                 9856  0
fusion                 32324  0








From stefan at lucke.in-berlin.de  Mon Jun  6 23:46:16 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 6 Jun 2005 23:46:16 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <42A4B95A.102@gmx.net>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <200506051450.26169.stefan@lucke.in-berlin.de> <42A4B95A.102@gmx.net>
Message-ID: <200506062346.16419.stefan@lucke.in-berlin.de>

On Montag, 6. Juni 2005 23:00, Martin Wache wrote:
> Stefan Lucke wrote:
> 
> >>The cause for this is that I reduced the buffer sizes, I plan to make it 
> >>possible to choose between "good seeking" (that is currently the 
> >>default), a save buffer (like it was bevore), and HDTV buffers.
> >>The good seeking buffer is as large as the FF card buffers, that means 
> >>that when seeking backward vdr will correctly guess the current position.
> >>Right now the switch to choose the buffer size is still missing, so one 
> >>can't chosse yet :-(, but I'll add this feature soon.
> > 
> > 
> > un  5 14:34:04 jarada vdr[3189]: buffer usage: 60% (tid=294919)
> > Jun  5 14:34:04 jarada vdr[3189]: buffer usage: 70% (tid=294919)
> > Jun  5 14:34:05 jarada vdr[3189]: buffer usage: 80% (tid=294919)
> > Jun  5 14:34:06 jarada vdr[3193]: [softdevice-audio]: xrun
> > Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 90% (tid=294919)
> > Jun  5 14:34:14 jarada vdr[3188]: clearing transfer buffer to avoid overflows
> > Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 0% (tid=294919)
> > Jun  5 14:34:15 jarada vdr[3219]: [softdevice-audio]: xrun
> > Jun  5 14:34:25 jarada vdr[3219]: [softdevice-audio]: xrun
> > 
> > There must be something else. I played around with various buffer sizes,
> > without success.
> > 
> Sorry, I have not finished the buffer size selection yet. Which buffer 
> size did you increase? Did you choose one of the combinations from 
> mpeg2decoder.h?

Yes.
MIN_BUF_SIZE is used as buffer size for init_but_byte and as a threshold
for enabling a signal.
I'm wondering if I'm the only one who noticed that, could that be caused
by my old/ stable kernel 2.4.27 ?

But:

#define PACKET_BUF_SIZE 150

This one is unused as:
public:
    cPacketQueue(int maxPackets=150);

-- 
Stefan Lucke



From Stefan.Doermann at itt.com  Tue Jun  7 09:00:58 2005
From: Stefan.Doermann at itt.com (Doermann, Stefan - FHS)
Date: Tue, 7 Jun 2005 09:00:58 +0200
Subject: AW: [Softdevice-devel] Softdevice 0.1.2 and vidix
Message-ID: <89DA0C8396353141B701CE3927F77C7502371161@FALNEXCH2.emea.itt.net>

Thanks Stefan, good job. I tried the CVS version yesterday. It works, no more restarts. What made wondering was that the file size of libsoftdevice.so has increased from 130kByte to 640kByte. I need to test a bit more, but it seems that there are no more chrashes when you switch from one channel with 4:3 to a different one with 16:9. One issue I noticed is about OSD. Using "software" osd on YUV (with or without deinterlacing) causes that no osd is shown. This option works only i402 (first pixel option, sorry I can't remember) but causes at my system 50% CPU load, whereas YUV without deinterlacing (best picture) is between 23-30%.
Thanks for this great plugin.  

Best regards, Mit freundlichen Gr?ssen,

Stefan Doermann
ITT Fluid Handling Systems
Project manager
Unnauer Weg 7a
50767 K?ln / Germany
Fon: 0049 (0) 221 7910 842
Fax: 0049 (0) 221 7910 472
Mobile: 0049 (0) 1726351965
Mail: stefan.doermann at itt.com



-----Urspr?ngliche Nachricht-----
Von: softdevice-devel-admin at berlios.de [mailto:softdevice-devel-admin at berlios.de] Im Auftrag von Stefan Lucke
Gesendet: Sonntag, 5. Juni 2005 23:00
An: softdevice-devel at berlios.de
Betreff: Re: [Softdevice-devel] Softdevice 0.1.2 and vidix


On Sonntag, 5. Juni 2005 09:14, Stefan Lucke wrote:
> On Samstag, 4. Juni 2005 21:36, Martin Wache wrote:
> > Doermann, Stefan - FHS wrote:
> > > Hi list,
> > > 
> > > I do have some questions about the latest softdevice 0.1.2:
> > > a) When compiling softdevice with vidix support, vdr keeps
> > > restarting.
> > > Obviously softdevice causes an seg. fault. This hasn't happened with
> > > 0.1.1. I also tried CVS from 30th of mai, with the same result. Has
> > > anybody noticed a similar behaviour ?
> > For me vidix works just like in version 0.1.1. Is there something in
> > the
> > logs which could give a hint what causes the segfault? Or could you
> > enable core dumps in your system and send me the backtrace?
>
> For me it is crashing too :-) . I'm currently hunting this bug. The
> crash is in YUV() method of vidix. It seems to be called when the
> layer of vidix is not initialized (memcpy() line 410). One of the last
> changes, calls YUV() from video.c too.

A fix for vidix crash is in cvs now.


--
Stefan Lucke

_______________________________________________
Softdevice-devel mailing list
Softdevice-devel at lists.berlios.de http://lists.berlios.de/mailman/listinfo/softdevice-devel

************************************
This e-mail and any files transmitted with it are proprietary and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender. Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of ITT Industries, Inc. The recipient should check this e-mail and any attachments for the presence of viruses. ITT Industries accepts no liability for any damage caused by any virus transmitted by this e-mail.
************************************


From Stefan.Doermann at itt.com  Tue Jun  7 09:09:35 2005
From: Stefan.Doermann at itt.com (Doermann, Stefan - FHS)
Date: Tue, 7 Jun 2005 09:09:35 +0200
Subject: AW: [Softdevice-devel] Softdevice 0.1.2 and vidix
Message-ID: <89DA0C8396353141B701CE3927F77C7502371162@FALNEXCH2.emea.itt.net>

Martin, when I try to play my mpeg1 files with softplay the sound is distorted, it is just a noise. Same effect with the picture. If I am not wrong, I am using an CVS version of ffmpeg, a month old. Surely this effect is related to ffmpeg. I have to test a different version. Anyway your plugin is great. On DIVX or XVID files I have noticed a CPU load of 12-18% using 1280x1024 (P3B; Celeron 1400; Matrox G450DH).

Best regards, Mit freundlichen Gr?ssen,

Stefan Doermann
ITT Fluid Handling Systems
Project manager
Unnauer Weg 7a
50767 K?ln / Germany
Fon: 0049 (0) 221 7910 842
Fax: 0049 (0) 221 7910 472
Mobile: 0049 (0) 1726351965
Mail: stefan.doermann at itt.com



-----Urspr?ngliche Nachricht-----
Von: softdevice-devel-admin at berlios.de [mailto:softdevice-devel-admin at berlios.de] Im Auftrag von Martin Wache
Gesendet: Samstag, 4. Juni 2005 21:37
An: softdevice-devel at berlios.de
Betreff: Re: [Softdevice-devel] Softdevice 0.1.2 and vidix


Doermann, Stefan - FHS wrote:
> Hi list,
> 
> I do have some questions about the latest softdevice 0.1.2:
> a) When compiling softdevice with vidix support, vdr keeps restarting.
> Obviously softdevice causes an seg. fault. This hasn't happened with
> 0.1.1. I also tried CVS from 30th of mai, with the same result. Has
> anybody noticed a similar behaviour ?
For me vidix works just like in version 0.1.1. Is there something in the
logs which could give a hint what causes the segfault? Or could you
enable core dumps in your system and send me the backtrace?
> b) When I compile both vidix and dfb support, always vidix is chosen,
> no
> matter what plugin I add to the command line.
What is the exact command line you use to start the softdevice with dfb
support?
> 
> Softplay:
> Softplay works quite good with avi (DIVX or XVID) and of course mpeg2
> formats, but mpeg1 files as contained in vcd can not be played. Is this
> normal ?
I have a single file with a mpeg1 encoded move, this one plays without
any trouble. Also I don't know why vcd should not be played properly
since they are supported by ffmpeg as far as I know.
What happens if you try to play these files? Do you get only audio?

Bye,
Martin
_______________________________________________
Softdevice-devel mailing list
Softdevice-devel at lists.berlios.de http://lists.berlios.de/mailman/listinfo/softdevice-devel

************************************
This e-mail and any files transmitted with it are proprietary and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender. Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of ITT Industries, Inc. The recipient should check this e-mail and any attachments for the presence of viruses. ITT Industries accepts no liability for any damage caused by any virus transmitted by this e-mail.
************************************


From M.Wache at gmx.net  Tue Jun  7 18:44:12 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 07 Jun 2005 18:44:12 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <200506062346.16419.stefan@lucke.in-berlin.de>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <200506051450.26169.stefan@lucke.in-berlin.de> <42A4B95A.102@gmx.net> <200506062346.16419.stefan@lucke.in-berlin.de>
Message-ID: <42A5CEDC.6050602@gmx.net>

Stefan Lucke wrote:

>>>un  5 14:34:04 jarada vdr[3189]: buffer usage: 60% (tid=294919)
>>>Jun  5 14:34:04 jarada vdr[3189]: buffer usage: 70% (tid=294919)
>>>Jun  5 14:34:05 jarada vdr[3189]: buffer usage: 80% (tid=294919)
>>>Jun  5 14:34:06 jarada vdr[3193]: [softdevice-audio]: xrun
>>>Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 90% (tid=294919)
>>>Jun  5 14:34:14 jarada vdr[3188]: clearing transfer buffer to avoid overflows
>>>Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 0% (tid=294919)
>>>Jun  5 14:34:15 jarada vdr[3219]: [softdevice-audio]: xrun
>>>Jun  5 14:34:25 jarada vdr[3219]: [softdevice-audio]: xrun
Is this DVB-S?

>>>
>>>There must be something else. I played around with various buffer sizes,
>>>without success.
>>>
>>
>>Sorry, I have not finished the buffer size selection yet. Which buffer 
>>size did you increase? Did you choose one of the combinations from 
>>mpeg2decoder.h?
> 
> 
> Yes.
> MIN_BUF_SIZE is used as buffer size for init_but_byte and as a threshold
> for enabling a signal.
> I'm wondering if I'm the only one who noticed that, could that be caused
> by my old/ stable kernel 2.4.27 ?
> 
> But:
> 
> #define PACKET_BUF_SIZE 150
> 
> This one is unused as:
> public:
>     cPacketQueue(int maxPackets=150);
> 
Yes, that's wrong, that should read:

      cPacketQueue(int maxPackets=PACKET_BUF_SIZE);

and this is the relevant buffer size, it should be enough if you change 
this one. Sorry that it is not working correctly now, but as I said it 
is work in progress...

Martin


From M.Wache at gmx.net  Tue Jun  7 18:52:20 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 07 Jun 2005 18:52:20 +0200
Subject: AW: [Softdevice-devel] Softdevice 0.1.2 and vidix
In-Reply-To: <89DA0C8396353141B701CE3927F77C7502371162@FALNEXCH2.emea.itt.net>
References: <89DA0C8396353141B701CE3927F77C7502371162@FALNEXCH2.emea.itt.net>
Message-ID: <42A5D0C4.7090206@gmx.net>

Doermann, Stefan - FHS wrote:
> Martin, when I try to play my mpeg1 files with softplay the sound is distorted, 
> it is just a noise. Same effect with the picture. If I am not wrong, I am using 
 > an CVS version of ffmpeg, a month old. Surely this effect is related 
to ffmpeg.
 > I have to test a different version. Anyway your plugin is great. On 
DIVX or XVID
 > files I have noticed a CPU load of 12-18% using 1280x1024 (P3B; 
Celeron 1400; Matrox G450DH).
> 
It is not necessarily a misfeature of ffmpeg, the correct test would be 
to try to play the files with ffplay included in ffmpeg. If ffplay plays 
the file correctly it's obviously a bug in softplay or softdevice ;-)

Martin


From juniper81 at gmail.com  Tue Jun  7 19:28:15 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Tue, 7 Jun 2005 20:28:15 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <42A4710C.2040401@gmx.net>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>
	 <b7bb36410506060011715e86a3@mail.gmail.com> <42A4710C.2040401@gmx.net>
Message-ID: <b7bb36410506071028797f5f45@mail.gmail.com>

On 6/6/05, Martin Wache <M.Wache at gmx.net> wrote:

> So there seems to be some process which takes unnecessarily takes CPU
> time when replaying a recording... Unfortunatly I'm still a bit short on
> time, but I will check on my box if I also see the difference. Than we
> have to find out which process takes the CPU time and see how we can fix
> it. On my system there is usually one thread which takes about 20-30% of
> the cpu time, this is the video decoding thread, all others take less
> than 10% cpu time. Is it the same for you when replaying a recording?

There seems to be one process that takes 30 - 40 % and another that
takes 20 - 30 % and the rest take under 10 %. So indeed, there seems
to be a process that eats quite a lot cpu time.

> >
> > Although I should mention that the test system is not the same as
> > before because I upgraded softdevice to the recent CVS on saturday and
> > vdr to 1.3.25 and ffmpeg to some other version. I say some other
> > because I couldn't compile softdevice with the recent cvs of ffmpeg. I
> > guess I should start a new thread about that  issue..
> Did this change the behavior when replaying a recording?

I don't think that it had any major improvements. But now I can test
with a new version of ffmpeg, thank you for the fix!
 
- Ari


From marko.makela at hut.fi  Tue Jun  7 22:16:41 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 7 Jun 2005 23:16:41 +0300
Subject: [Softdevice-devel] Repeatable crash with latest CVS
In-Reply-To: <200506062155.36956.stefan@lucke.in-berlin.de>
References: <20050530071042.GA234001@kosh.hut.fi> <42A202CC.5080106@gmx.net> <20050606153334.GA133462@kosh.hut.fi> <200506062155.36956.stefan@lucke.in-berlin.de>
Message-ID: <20050607201641.GB135019@kosh.hut.fi>

On Mon, Jun 06, 2005 at 09:55:36PM +0200, Stefan Lucke wrote:
> On Montag, 6. Juni 2005 17:33, Marko M?kel? wrote:
> > On Sat, Jun 04, 2005 at 09:36:44PM +0200, Martin Wache wrote:
> > > Marko M?kel? wrote:
> > > >I have a recording with a 4:3 -> 16:9 transition.  When rewinding it at
> > > >triple speed, a Signal 11 sometimes occurs.   I made a short clip that can 
> > > >be
> > > >fast-forwarded and rewinded some times (maybe 5-10) to trigger the crash
> > > >on my system.  Here is the stack trace from the core dump:
> > > 
> > > Thanks for your report, up to now I could not reproduce the crash on my 
> > > box, but I didn't try very hard yet ;-)
> > 
> > I got it twice today on the first try when rewinding the clip from the end
> > to the beginning at triple speed.  The second time was within gdb, running
> > vdr 1.3.24 with the patch from subtitles-0.3.7 and with only the softdevice
> > plugin loaded, using DirectFB 0.9.22 playback on a Matrox G400 or G450 card
> > on VGA monitor with 4:3 cropping:
> > 
> > (gdb) bt full
> > #0  0xb7dceb7f in memcpy () from /lib/libc.so.6
> > No symbol table info available.
> > #1  0xb79523da in cDFBVideoOut::YUV (this=0x82247c8,
> >     Py=0xb64fcb30 '\200' <repeats 200 times>...,
> >     Pu=0x8313bc8 '\200' <repeats 200 times>...,
> >     Pv=0x83a0940 '\200' <repeats 200 times>..., Width=720, Height=576,
> >     Ystride=752, UVstride=376) at video-dfb.c:1021
> >         dst = (uint8_t *) 0xb779bee0 <Address 0xb779bee0 out of bounds>
> >         pitch = 576
> >         hi = 288
> 
> I don't understand that: When hi = 288 we should have left the loop as
> hi < sheight/2 (with sheight = 576) should be evaluate FALSE.
> pitch seems to strange too. When width is 720, pitch should be a
> reasonable value above that (768 ?).

Could you suggest some assertions to add to the code, or some other way to
narrow down the problem?  The display mode I'm using is 768?576 at 75 Hz.
The end of the kernel log looks like this:
ACPI: PCI interrupt 0000:00:10.2[A] -> GSI 18 (level, low) -> IRQ 18
cx88[0]/2: found at 0000:00:10.2, rev: 5, irq: 18, latency: 64, mmio: 0xdd000000cx88[0]/2: cx2388x based dvb card
DVB: registering new adapter (cx88[0]).
DVB: registering frontend 0 (Hauppauge Nova-T DVB-T)...
ACPI: PCI interrupt 0000:00:0e.0[A] -> GSI 16 (level, low) -> IRQ 16
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832
matroxfb: cannot set xres to 800, rounded up to 832

In the syslog, I see this:

Jun  7 23:10:45 vdr vdr[3111]: setting watchdog timer to 60 seconds
Jun  7 23:10:46 vdr vdr[3132]: [VideoOut]: aspect changed (-100 -> 8 ; -100.000000 -> 1.333333)
Jun  7 23:10:46 vdr vdr[3132]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x576]
Jun  7 23:10:46 vdr vdr[3125]: setting audio track to 1
Jun  7 23:10:47 vdr vdr[3135]: [softdevice-audio] samplerate: 48000Hz, channels: #2
Jun  7 23:10:47 vdr vdr[3135]: [softdevice-audio] Period size 1152 Buffer size 9216
Jun  7 23:10:47 vdr vdr[3135]: [softdevice-audio] Hardware initialized

Note that it says 720?576 and 768?576. /etc/directfbrc says mode=768x576,
and the only matching mode in /etc/fb.modes is this one:

mode "768x576-75"
    # D: 49.188 MHz, H: 46.580 kHz, V: 75.008 Hz
    geometry 768 576 768 576 32
    timings 20330 128 32 32 8 128 5
endmode

	Marko


From ospite at studenti.unina.it  Tue Jun  7 23:28:23 2005
From: ospite at studenti.unina.it (A.O.)
Date: Tue, 7 Jun 2005 23:28:23 +0200
Subject: [Softdevice-devel] An initial solution for bug #002971 ?
In-Reply-To: <42A4B965.5000109@gmx.net>
References: <20050606160202.35ecaea4.ospite@studenti.unina.it>
	<42A46E26.9060705@gmx.net>
	<42A4B965.5000109@gmx.net>
Message-ID: <20050607232823.3c0612e3.ospite@studenti.unina.it>

On Mon, 06 Jun 2005 23:00:21 +0200
Martin Wache <M.Wache at gmx.net> wrote:


> > I'm not sure if the explanation and the patch is correct, but you 
> > definitely found a bug in audio.c. The pointer Data has to be
> > increased  for sure when not all data has been accepted by
> > snd_pcm_wait. I will  check your patch... Thank you for reporting
> > this!
> 
> I checked the patch, it looks correct and I applied it.
> Thank you again!

Well, i found some other glitches. One about the handling of EPIPE error
in Write(), we can fix it in two different ways, i think.
I attach two _alternative_ patches.
The error caused a Segfault because the Data pointer was incremented
also when err == -EPIPE... I attach two _alternative_ patches.
Other fixes about a check on audio_size in mpeg2decoder.c, and i
also added a cast to make the code compile with ffmpeg-CVS.

And then a question: looking at mplayer's code (libao2/ao_alsa.c) the
case of -EINTR returned from snd_pcm_mmap_writei() is not handled in any
particular way, should we really return on this error, or we can just
continue looping?

Now softdevice works almost flawlessly for me.
I say _almost_ because of some exits when playing insanely with the
f-key :) I will investigate more... if i find something i will open
another thread, don't worry.

Take care,
  Antonio.

-- 
Public key: http://studenti.unina.it/~ospite/aopubkey.asc
  Web Site: http://studenti.unina.it/~ospite
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice_alsa-02.0.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050607/caf7212c/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: softdevice_alsa-02.1.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050607/caf7212c/attachment-0001.ksh>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050607/caf7212c/attachment.pgp>

From marko.makela at hut.fi  Wed Jun  8 00:11:47 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 8 Jun 2005 01:11:47 +0300
Subject: [Softdevice-devel] How to get 15 kHz SCART RGB output on Matrox G450?
Message-ID: <20050607221147.GC135019@kosh.hut.fi>

I'm sorry for asking this FAQ, but I couldn't figure out how to get a
picture from the second head of my Matrox G450 card to a 50 Hz RGB monitor
(Commodore 1084S a.k.a. Philips CM8833).  I believe I got the right
directfbrc settings except for the video timings.  The colors are correct,
but the video signal is clearly wrong (hsync looks like 30 kHz or 45 kHz
instead of 15.625 kHz).

The fbset command doesn't seem to allow the timings to be set independently
for the second head.  fbset -fb /dev/fb1 mode_name seems to ignore the
settings.  I also tried setting /dev/fb0 to the "my-pal-32" mode defined at
http://softdevice.berlios.de/.  Although the output on the second head did
change, the monitor was still unable to sync to it.

When I tested the dfb:mgatv output, the first head showed the text console.
When I tested the default DirectFB output, both heads showed the TV picture.
On the second head, the timings were clearly different from what I would
have with -vo dfb:mgatv.  It may have used the 768x576-75Hz timings on both
heads.

With the default DirectFB output, it seems that DirectFB will pick the first
mode in /etc/fb.modes that matches the requested resolution.  -vo dfb:mgatv
seems to behave differently.

How is the dfb:mgatv output supposed to work?  Can anyone help me?
I'm using kernel 2.6.11.7 if that matters.

	Marko


From nhuillard at e-dition.fr  Wed Jun  8 10:46:53 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Wed, 08 Jun 2005 10:46:53 +0200
Subject: [Softdevice-devel] Repeatable crash with latest CVS
In-Reply-To: <20050607201641.GB135019@kosh.hut.fi>
References: <20050530071042.GA234001@kosh.hut.fi> <42A202CC.5080106@gmx.net> <20050606153334.GA133462@kosh.hut.fi> <200506062155.36956.stefan@lucke.in-berlin.de> <20050607201641.GB135019@kosh.hut.fi>
Message-ID: <42A6B07D.9000408@e-dition.fr>

Marko M?kel? a ?crit :
> Jun  7 23:10:46 vdr vdr[3132]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x576]

720x576 is the size of the stream, whereas 768x576 is the size of the 
frame-buffer. Everything's OK there.

-- 
NH


From M.Wache at gmx.net  Wed Jun  8 18:05:05 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Wed, 08 Jun 2005 18:05:05 +0200
Subject: [Softdevice-devel] An initial solution for bug #002971 ?
In-Reply-To: <20050607232823.3c0612e3.ospite@studenti.unina.it>
References: <20050606160202.35ecaea4.ospite@studenti.unina.it>	<42A46E26.9060705@gmx.net>	<42A4B965.5000109@gmx.net> <20050607232823.3c0612e3.ospite@studenti.unina.it>
Message-ID: <42A71731.5030504@gmx.net>

A.O. schrieb:
> On Mon, 06 Jun 2005 23:00:21 +0200
> Martin Wache <M.Wache at gmx.net> wrote:
> 
> Well, i found some other glitches. One about the handling of EPIPE error
> in Write(), we can fix it in two different ways, i think.
> I attach two _alternative_ patches.
> The error caused a Segfault because the Data pointer was incremented
> also when err == -EPIPE... I attach two _alternative_ patches.
I already added a patch checking for err>0 before err is used to
calculate Data and size right after applying your first patch. So this
is already fixed in the CVS.
The check for audio_size<0 is interessting and since it can't hurt I
will change the condition accordingly, but up to know I never noticed an
overflow in audio_size.

> Other fixes about a check on audio_size in mpeg2decoder.c, and i
> also added a cast to make the code compile with ffmpeg-CVS.
This is also fixed in the CVS since yesterday ;-)

> 
> And then a question: looking at mplayer's code (libao2/ao_alsa.c) the
> case of -EINTR returned from snd_pcm_mmap_writei() is not handled in any
> particular way, should we really return on this error, or we can just
> continue looping?
Stefan had sometimes -EINTR on his box. I never experienced this so I
don't know for sure what is the best. But since returning means just to
loose one sample I don't think that returning hurts as long as it
happens only on rare occasions.

> 
> Now softdevice works almost flawlessly for me.
Nice to hear :-)

> I say _almost_ because of some exits when playing insanely with the
> f-key :)
Probably this is just a locking issue... Did you try to lock the
xv_mutex in toggleFullscreen()?
> I will investigate more... if i find something i will open
> another thread, don't worry.
Bugfixes are always welcome :-) But please, send patches against the
latest CVS ;-)

Martin


From prelude at kapsi.fi  Wed Jun  8 22:57:55 2005
From: prelude at kapsi.fi (prelude)
Date: Wed, 08 Jun 2005 23:57:55 +0300
Subject: [Softdevice-devel] Softdevice + directfb + g400 TV out problem.
In-Reply-To: <42A4C06A.6070204@kapsi.fi>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi>
Message-ID: <42A75BD3.5020508@kapsi.fi>

prelude wrote:

> Stefan Lucke wrote:
>
>> Could you check that your "matrox full memory patch" is still present ?
>> At my system (G550) I've only /dev/fb0. /dev/fb1 is reportet with
>> "no such device". With my G400 system fb0 is reported as 32M and
>> fb1 with 8M :-). Yes card has only 32M
>>
>> Are the matrox drivers compiled in or loaded as modules, as they 
>> should ?
>>

First of all THX. I got picture on my TV screen now :-)

Probably problem was my kernel modules so following config working to my 
computer:
kernel: 2.6.12-rc6

CONFIG_FB=y
CONFIG_FB_CFB_FILLRECT=y
CONFIG_FB_CFB_COPYAREA=y
CONFIG_FB_CFB_IMAGEBLIT=y
CONFIG_FB_SOFT_CURSOR=y
CONFIG_FB_MODE_HELPERS=y
CONFIG_FB_TILEBLITTING=y
CONFIG_FB_VGA16=m
CONFIG_FB_VESA=y
CONFIG_VIDEO_SELECT=y
CONFIG_FB_MATROX=y
CONFIG_FB_MATROX_G=y
CONFIG_FB_MATROX_I2C=m
CONFIG_FB_MATROX_MAVEN=m

#
# Console display driver support
#
CONFIG_VGA_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_FONT_8x8=y
CONFIG_FONT_8x16=y

#
# Logo configuration
#
CONFIG_LOGO=y
CONFIG_LOGO_LINUX_MONO=y
CONFIG_LOGO_LINUX_VGA16=y
CONFIG_LOGO_LINUX_CLUT224=y

__

Fusion module is installed and DireFB compiled whit option "--enable-multi".

__
# fbset -i -fb /dev/fb/0

mode "640x480-60"
    # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz
    geometry 640 480 640 13107 8
    timings 39721 40 24 32 11 96 2
    accel true
    rgba 8/0,8/0,8/0,0/0
endmode

Frame buffer device information:
    Name        : MATROX
    Address     : 0xf4000000
    Size        : 16777216
    Type        : PACKED PIXELS
    Visual      : PSEUDOCOLOR
    XPanStep    : 8
    YPanStep    : 1
    YWrapStep   : 0
    LineLength  : 640
    MMIO Address: 0xf2000000
    MMIO Size   : 16384
    Accelerator : Matrox G400

# fbset -i -fb /dev/fb/1

mode "640x480-60"
    # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz
    geometry 640 480 640 480 32
    timings 39721 48 16 33 10 96 2
    rgba 8/16,8/8,8/0,8/24
endmode

Frame buffer device information:
    Name        : MATROX DH
    Address     : 0xf4800000
    Size        : 8388608
    Type        : PACKED PIXELS
    Visual      : TRUECOLOR
    XPanStep    : 8
    YPanStep    : 1
    YWrapStep   : 0
    LineLength  : 2560
    MMIO Address: 0xf2000000
    MMIO Size   : 16384
    Accelerator : No
___


Now softdevice runnig fine :-)





From marko.makela at hut.fi  Thu Jun  9 08:48:58 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 9 Jun 2005 09:48:58 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <42A75BD3.5020508@kapsi.fi>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi> <42A75BD3.5020508@kapsi.fi>
Message-ID: <20050609064858.GA3328@localhost.localdomain>

On Wed, Jun 08, 2005 at 11:57:55PM +0300, prelude wrote:
> Fusion module is installed and DireFB compiled whit option "--enable-multi".

Is that essential?

> # fbset -i -fb /dev/fb/0
> 
> mode "640x480-60"
>    # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz
[clip]

> mode "640x480-60"
>    # D: 25.176 MHz, H: 31.469 kHz, V: 59.942 Hz

How can you possibly get a picture on a TV with these settings?  The
line frequency should be around 15 kHz, shouldn't it?

Here are my frame buffer settings for the Matrox G450:

fbset -i -fb /dev/fb1

mode "768x576-50"
    # D: 14.766 MHz, H: 15.776 kHz, V: 50.482 Hz
    geometry 768 576 768 576 32
    timings 67723 104 0 44 1 64 4
    csync high
    bcast true
    laced true
    accel true
    rgba 8/16,8/8,8/0,8/24
endmode

Frame buffer device information:
    Name        : MATROX DH
    Address     : 0xd7800000
    Size        : 8388608
    Type        : PACKED PIXELS
    Visual      : TRUECOLOR
    XPanStep    : 8
    YPanStep    : 1
    YWrapStep   : 0
    LineLength  : 3072
    MMIO Address: 0xd9efc000
    MMIO Size   : 16384
    Accelerator : No

fbset -i -fb /dev/fb0

mode "768x576-75"
    # D: 49.188 MHz, H: 46.580 kHz, V: 75.008 Hz
    geometry 768 576 768 1152 32
    timings 20330 128 32 32 8 128 5
    rgba 8/16,8/8,8/0,8/24
endmode

Frame buffer device information:
    Name        : MATROX
    Address     : 0xd6000000
    Size        : 16777216
    Type        : PACKED PIXELS
    Visual      : TRUECOLOR
    XPanStep    : 8
    YPanStep    : 1
    YWrapStep   : 0
    LineLength  : 3072
    MMIO Address: 0xd9efc000
    MMIO Size   : 16384
    Accelerator : Matrox G400

I have the RGB SCART monitor on the second head and the VGA multisync
monitor on the first head.  The first head is fine, but the second
head probably gets 46 kHz horizontal sync instead of the 15 kHz/50 Hz
composite sync.  Yep, the oscilloscope shows 11 pulses in 250 ?s,
and 11/250 ?s = 44 kHz.  I didn't notice any vertical sync pattern in
the composite sync signal.  Here's the directfbrc:

fbdev=/dev/fb0
mode=768x576
#vt-switch
#vt-switching
no-banner
no-debug
no-vt
depth=16
#disable-module=linux_input

If I use -P'softdevice -vo dfb:mgatv' and the following directfbrc,
the oscilloscope shows that the composite sync is constantly at GND!

cat > /etc/directfbrc << EOF
system=fbdev
fbdev=/dev/fb0
matrox-crtc2
matrox-tv-standard=pal
matrox-cable-type=scart-rgb
videoram-limit=32768
depth=16
mode=768x576
pixelformat=YV12
primary-layer=2
hardware
mmx
screenshot-dir=/tmp
#vt-switch
#vt-switching
no-banner
no-debug
no-vt
graphics-vt
EOF

Hmm, how should I set primary-layer?  Or should I set fbdev=/dev/fb1
instead of /dev/fb0?  Nope, it won't fly:

(*) DirectFB/Config: Parsing config file '/etc/directfbrc'.
(*) DirectFB/Core: Single Application Core. (2005-03-19 19:30)
(!) [ 3230:    0.000] --> Caught signal 11 (at 0xe091, invalid address)
<--
Killed

dfbinfo shows the following:

Screen (00) FBDev Primary Screen            (primary screen)
   Caps: VSYNC POWER_MANAGEMENT

     Layer (02) FBDev Primary Layer
        Type:    GRAPHICS
        Caps:    SURFACE BRIGHTNESS CONTRAST SATURATION

     Layer (01) Matrox Backend Scaler
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE SCREEN_LOCATION DEINTERLACING DST_COLORKEY BRIGHTNESS CONTRAST SCREEN_POSITION SCREEN_SIZE

Screen (01) Matrox CRTC2 Screen
   Caps: VSYNC ENCODERS OUTPUTS

   Encoder (0)
     Type:           TV
     Caps:           TV_STANDARDS
     TV Standards:   PAL NTSC


   Output (0)
     Caps:       CONNECTORS SIGNAL_SEL CONNECTOR_SEL
     Connectors: SCART YC CVBS
     Signals:    YC CVBS RGB


     Layer (00) Matrox CRTC2 Layer              (primary layer)
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE FLICKER_FILTERING BRIGHTNESS CONTRAST HUE SATURATION FIELD_PARITY ALPHA_RAMP

     Layer (03) Matrox CRTC2 Sub-Picture
        Type:    GRAPHICS VIDEO STILL_PICTURE
        Caps:    SURFACE OPACITY ALPHACHANNEL

I guess primary-layer=2 is for the first head (VGA) and primary-layer=0
should be for the second head (SCART RGB)?  However, DirectFB won't
start with primary-layer=0:

[dfb] Enumeratig display Layers
(!) DirectFB/core/layers: Could not set primary region config!
    --> Not supported!
(!) [ 3817:    0.000] --> Caught signal 6 (sent by pid 3817, uid 1000) <--
Killed

	Marko


From stefan at lucke.in-berlin.de  Thu Jun  9 10:13:43 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  9 Jun 2005 10:13:43 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <20050609064858.GA3328@localhost.localdomain>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi> <42A75BD3.5020508@kapsi.fi> <20050609064858.GA3328@localhost.localdomain>
Message-ID: <1118304823.42a7fa3770f8e@webmail.in-berlin.de>

Quoting Marko M?kel? :


>
> I have the RGB SCART monitor on the second head and the VGA multisync
> monitor on the first head.  The first head is fine, but the second
> head probably gets 46 kHz horizontal sync instead of the 15 kHz/50 Hz
> composite sync.  Yep, the oscilloscope shows 11 pulses in 250 ?s,
> and 11/250 ?s = 44 kHz.  I didn't notice any vertical sync pattern in
> the composite sync signal.  Here's the directfbrc:
>
> fbdev=/dev/fb0
> mode=768x576
> #vt-switch
> #vt-switching
> no-banner
> no-debug
> no-vt
> depth=16
> #disable-module=linux_input
>
> If I use -P'softdevice -vo dfb:mgatv' and the following directfbrc,
> the oscilloscope shows that the composite sync is constantly at GND!
>
> cat > /etc/directfbrc << EOF
> system=fbdev
> fbdev=/dev/fb0

Why /dev/fb0 here ?

> matrox-crtc2
> matrox-tv-standard=pal
> matrox-cable-type=scart-rgb
> videoram-limit=32768
> depth=16
> mode=768x576

mode=720x576 !!!!

> pixelformat=YV12

Pixelformat for "mgatv" should/must be ARGB.
Depth sould be 32.

> primary-layer=2
> hardware
> mmx
> screenshot-dir=/tmp
> #vt-switch
> #vt-switching
> no-banner
> no-debug
> no-vt
> graphics-vt
> EOF
>
> Hmm, how should I set primary-layer?  Or should I set fbdev=/dev/fb1
> instead of /dev/fb0?  Nope, it won't fly:
>

>
> dfbinfo shows the following:
>
> Screen (00) FBDev Primary Screen            (primary screen)
>    Caps: VSYNC POWER_MANAGEMENT
>
>      Layer (02) FBDev Primary Layer
>         Type:    GRAPHICS
>         Caps:    SURFACE BRIGHTNESS CONTRAST SATURATION
>
>      Layer (01) Matrox Backend Scaler
>         Type:    GRAPHICS VIDEO STILL_PICTURE
>         Caps:    SURFACE SCREEN_LOCATION DEINTERLACING DST_COLORKEY
> BRIGHTNESS CONTRAST SCREEN_POSITION SCREEN_SIZE
>
> Screen (01) Matrox CRTC2 Screen
>    Caps: VSYNC ENCODERS OUTPUTS
>
>    Encoder (0)
>      Type:           TV
>      Caps:           TV_STANDARDS
>      TV Standards:   PAL NTSC
>
>
>    Output (0)
>      Caps:       CONNECTORS SIGNAL_SEL CONNECTOR_SEL
>      Connectors: SCART YC CVBS
>      Signals:    YC CVBS RGB
>
>
>      Layer (00) Matrox CRTC2 Layer              (primary layer)
>         Type:    GRAPHICS VIDEO STILL_PICTURE
>         Caps:    SURFACE FLICKER_FILTERING BRIGHTNESS CONTRAST HUE SATURATION
> FIELD_PARITY ALPHA_RAMP
>
>      Layer (03) Matrox CRTC2 Sub-Picture
>         Type:    GRAPHICS VIDEO STILL_PICTURE
>         Caps:    SURFACE OPACITY ALPHACHANNEL
>
> I guess primary-layer=2 is for the first head (VGA) and primary-layer=0
> should be for the second head (SCART RGB)?  However, DirectFB won't
> start with primary-layer=0:

Layers work each on one head. Usually layer 0 (prim) is the plain
frame buffer area. On head_0 you have the backendscaler as layer 1.
on head_1 there are additional layers: layer 2 for tvout and layer 3
which is a subpicture layer of layer 3 which is unused by softdevice
due to it's limited color capabilities (4bit alpha + 4bit color).


Stefan Lucke


From marko.makela at hut.fi  Thu Jun  9 12:26:28 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 9 Jun 2005 13:26:28 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <1118304823.42a7fa3770f8e@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi> <42A75BD3.5020508@kapsi.fi> <20050609064858.GA3328@localhost.localdomain> <1118304823.42a7fa3770f8e@webmail.in-berlin.de>
Message-ID: <20050609102628.GA292244@kosh.hut.fi>

Stefan,

> > If I use -P'softdevice -vo dfb:mgatv' and the following directfbrc,
> > the oscilloscope shows that the composite sync is constantly at GND!
> >
> > cat > /etc/directfbrc << EOF
> > system=fbdev
> > fbdev=/dev/fb0
> 
> Why /dev/fb0 here ?

/dev/fb1 didn't work (Signal 11).

> 
> > matrox-crtc2
> > matrox-tv-standard=pal
> > matrox-cable-type=scart-rgb
> > videoram-limit=32768
> > depth=16
> > mode=768x576
> 
> mode=720x576 !!!!

Could you please tell me how this setting is related to /etc/fb.modes?
The "my-pal-32" mode at http://softdevice.berlios.de/ defines
the visible resolution as 768x576.

> > pixelformat=YV12
> 
> Pixelformat for "mgatv" should/must be ARGB.
> Depth sould be 32.

Thanks, I'll try these.

> which is a subpicture layer of layer 3 which is unused by softdevice
> due to it's limited color capabilities (4bit alpha + 4bit color).

Is it a 16-color palette, or perhaps something fixed like RGBI?  How many
colors does the OSD actually use?  The theme I'm using (startrek I think)
doesn't seem to use more than 8 colors (yellow, blue, red, green,
transparent, maybe white, maybe black).  Maybe the bitmapped subtitles
need many shades of gray for anti-aliasing?

	Marko


From stefan at lucke.in-berlin.de  Thu Jun  9 13:11:13 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu,  9 Jun 2005 13:11:13 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <20050609102628.GA292244@kosh.hut.fi>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi> <42A75BD3.5020508@kapsi.fi> <20050609064858.GA3328@localhost.localdomain> <1118304823.42a7fa3770f8e@webmail.in-berlin.de> <20050609102628.GA292244@kosh.hut.fi>
Message-ID: <1118315472.42a823d0f4180@webmail.in-berlin.de>

Quoting Marko M?kel? <marko.makela at hut.fi>:

> Stefan,
>
> > > If I use -P'softdevice -vo dfb:mgatv' and the following directfbrc,
> > > the oscilloscope shows that the composite sync is constantly at GND!
> > >
> > > cat > /etc/directfbrc << EOF
> > > system=fbdev
> > > fbdev=/dev/fb0
> >
> > Why /dev/fb0 here ?
>
> /dev/fb1 didn't work (Signal 11).

Drop it. Comment it out.

>
> >
> > > matrox-crtc2
> > > matrox-tv-standard=pal
> > > matrox-cable-type=scart-rgb
> > > videoram-limit=32768
> > > depth=16
> > > mode=768x576
> >
> > mode=720x576 !!!!
>
> Could you please tell me how this setting is related to /etc/fb.modes?
> The "my-pal-32" mode at http://softdevice.berlios.de/ defines
> the visible resolution as 768x576.
>

These modes are for connecting head 0 "monitor out" (not using the "tv out"
feature). When "tv out" feature is used, you do not need a corresponding
fb.mode. DirectFB knows the timeing required for that by selecting
"matrox-tv-standard=xxx".

> > > pixelformat=YV12
> >
> > Pixelformat for "mgatv" should/must be ARGB.
> > Depth sould be 32.
>
> Thanks, I'll try these.
>
> > which is a subpicture layer of layer 3 which is unused by softdevice
> > due to it's limited color capabilities (4bit alpha + 4bit color).
>
> Is it a 16-color palette, or perhaps something fixed like RGBI?  How many
> colors does the OSD actually use?  The theme I'm using (startrek I think)
> doesn't seem to use more than 8 colors (yellow, blue, red, green,
> transparent, maybe white, maybe black).  Maybe the bitmapped subtitles
> need many shades of gray for anti-aliasing?
>

It's a palette. For simple OSDs this would be enough but some other OSDs
will fail. On the fly switching drawing mode is to my opinion to complicated
and maintaining additional drawing modes would exceed our developing time.

Stefan Lucke


From marko.makela at hut.fi  Thu Jun  9 18:43:08 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Thu, 9 Jun 2005 19:43:08 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <1118315472.42a823d0f4180@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118052703.42a4215fb8698@webmail.in-berlin.de> <Pine.LNX.4.62.0506061601240.19925@lakka> <200506062054.44899.stefan@lucke.in-berlin.de> <42A4C06A.6070204@kapsi.fi> <42A75BD3.5020508@kapsi.fi> <20050609064858.GA3328@localhost.localdomain> <1118304823.42a7fa3770f8e@webmail.in-berlin.de> <20050609102628.GA292244@kosh.hut.fi> <1118315472.42a823d0f4180@webmail.in-berlin.de>
Message-ID: <20050609164308.GA3723@localhost.localdomain>

On Thu, Jun 09, 2005 at 01:11:13PM +0200, Stefan Lucke wrote:
> These modes are for connecting head 0 "monitor out" (not using the "tv out"
> feature). When "tv out" feature is used, you do not need a corresponding
> fb.mode. DirectFB knows the timeing required for that by selecting
> "matrox-tv-standard=xxx".

I see.  However, still no success.  If I omit the primary-layer setting
or set it to primary-layer=0, I get almost 6 pulses in 200 ?s, that is
6/200 ?s = 30 kHz.  I didn't notice any vsync pulses, no matter what
scale I chose on the oscilloscope, and neither did my monitor.  Setting
primary-layer=2 will make the sync constant GND.  Here's what dfb prints
out at startup:

(!) DirectFB/FBDev: Specified mode (720x576) not supported or not
defined in '/etc/fb.modes'!
(!) DirectFB/FBDev: Using default mode (768x576) instead!
(*) DirectFB/Core/WM: Default 0.2 (Convergence GmbH)
[dfb] Supported video Modes are: 768x576 at 32 768x576 at 32 1280x960 at 16
1280x960 at 32
[dfb] Enumeratig display Layers
Layer 0 FBDev Primary Layer  Type: graphics
  Caps: brightness contrast saturation surface
Layer 1 Matrox Backend Scaler  Type: graphics picture video
  Caps: brightness contrast deinterlacing dst_colorkey screen_location surface
Layer 2 Matrox CRTC2 Layer  Type: graphics picture video
  Caps: brightness contrast flicker_filtering hue field_parity saturation
  surface

Hmm, primary-layer=1 looks different: no sync pulses (sync=GND), but there is
something sync-like on the RGB lines.  Only primary-layer=0 gives me
sync pulses.  The sync line I'm using is pin 13 of the VGA connector if
I remember correctly.

Now my /etc/directfbrc is like this:

system=fbdev
fbdev=/dev/fb1
matrox-crtc2
matrox-tv-standard=pal
matrox-cable-type=scart-rgb
depth=32
mode=720x576
pixelformat=ARGB
no-banner
debug
no-vt

	Marko


From stefan at lucke.in-berlin.de  Thu Jun  9 20:33:54 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 9 Jun 2005 20:33:54 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <20050609164308.GA3723@localhost.localdomain>
References: <42A33207.1070903@kapsi.fi> <1118315472.42a823d0f4180@webmail.in-berlin.de> <20050609164308.GA3723@localhost.localdomain>
Message-ID: <200506092033.54541.stefan@lucke.in-berlin.de>

On Donnerstag, 9. Juni 2005 18:43, Marko M?kel? wrote:
> On Thu, Jun 09, 2005 at 01:11:13PM +0200, Stefan Lucke wrote:
> > These modes are for connecting head 0 "monitor out" (not using the "tv out"
> > feature). When "tv out" feature is used, you do not need a corresponding
> > fb.mode. DirectFB knows the timeing required for that by selecting
> > "matrox-tv-standard=xxx".
> 
> I see.  However, still no success.  If I omit the primary-layer setting
> or set it to primary-layer=0, I get almost 6 pulses in 200 ?s, that is
> 6/200 ?s = 30 kHz.  I didn't notice any vsync pulses, no matter what
> scale I chose on the oscilloscope, and neither did my monitor.  Setting
> primary-layer=2 will make the sync constant GND.  Here's what dfb prints
> out at startup:

For tv-out primary-layer=2 is correct.
Which pins do you choose when connecting your oscilloscope ?

Directly connect DDC lines 12 -> 15. !!!

G550/G450 tv-out (2nd head connector):
RGB:
	Used pins are R(1), G(2), B(3), RGB_SWITCH(9) via 75Ohm resistor,
	Composit(14) via 680Ohm

Composite + Y/C:
	Composite(1), Y(2), C(3)

G400:
RGB:
	R(1), G(2), B(3), Composite(4), RGB_Enable(13)


Matrox schematics are available via link on softdevice page or:
http://forum.matrox.com/mga/viewforum.php?f=52&sid=a1c50e38759f99f96d4bf184cfef9c78

> Hmm, primary-layer=1 looks different: no sync pulses (sync=GND), but there is
> something sync-like on the RGB lines.  Only primary-layer=0 gives me
> sync pulses.  The sync line I'm using is pin 13 of the VGA connector if
> I remember correctly.

Pin 13 is H-sync, Pin 14 is V-sync in vga mode.

-- 
Stefan Lucke



From prelude at kapsi.fi  Thu Jun  9 20:39:31 2005
From: prelude at kapsi.fi (prelude)
Date: Thu, 09 Jun 2005 21:39:31 +0300
Subject: [Softdevice-devel] No sound whit Softdevice.
Message-ID: <42A88CE3.8040202@kapsi.fi>

Hello

I think that i am some sort problem magnet :-/

Anyway now to my problem.

I have  ICE1712 [Envy24] based sound card in my vdr machine and it is 
connected to my hifi system whit optical spdif cable.
All other programs witch uses alsa work's fine but some reason i cannot 
get sound when i use softdevice.

I have try ed all possible options what i can imagine (following) but 
because i dont know nothing about ALSA it is not much:

-ao alsa
-ao dummy:
-ao alsa:plughw:0,0
-ao alsa:hw:0,0

Any idea what i do wrong?
(I don't know is there sounds in analog outputs because that computer is 
in my balcony.)




From M.Wache at gmx.net  Thu Jun  9 22:39:33 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 09 Jun 2005 22:39:33 +0200
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <b7bb36410506071028797f5f45@mail.gmail.com>
References: <b7bb36410505290948421de228@mail.gmail.com>	 <1117396167.14625.17.camel@africa>	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>	 <b7bb3641050530110227f2b313@mail.gmail.com>	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>	 <b7bb36410506060011715e86a3@mail.gmail.com> <42A4710C.2040401@gmx.net> <b7bb36410506071028797f5f45@mail.gmail.com>
Message-ID: <42A8A905.3060400@gmx.net>

Ari Koponen schrieb:
> On 6/6/05, Martin Wache <M.Wache at gmx.net> wrote:
> 
> 
>>So there seems to be some process which takes unnecessarily takes CPU
>>time when replaying a recording... Unfortunatly I'm still a bit short on
>>time, but I will check on my box if I also see the difference. Than we
>>have to find out which process takes the CPU time and see how we can fix
>>it. On my system there is usually one thread which takes about 20-30% of
>>the cpu time, this is the video decoding thread, all others take less
>>than 10% cpu time. Is it the same for you when replaying a recording?
> 
> 
> There seems to be one process that takes 30 - 40 % and another that
> takes 20 - 30 % and the rest take under 10 %. So indeed, there seems
> to be a process that eats quite a lot cpu time.
> 
I just check on my box, I don't have an additional thread which takes so
much CPU time when replaying a recording.

Torgeir? What do you also have one thread which takes additional CPU time?

I don't know how good you know debugging tools, but if you know gdb,
could you try to attach to the additional thread and try to find out
what it is doing? (Basically it just call gdb, enter "attach PID" and
then "backtrace". Vdr will crash after this, so you will have to kill it
with kill -9. Do this several times, and hopefully you will get the
position where the time is spent.)
The other possibility would be to try to profile vdr while playing a
recording with some profiling tool.

Martin


From juniper81 at gmail.com  Fri Jun 10 08:03:17 2005
From: juniper81 at gmail.com (Ari Koponen)
Date: Fri, 10 Jun 2005 09:03:17 +0300
Subject: [Softdevice-devel] Problems while playing recordings and in startup
In-Reply-To: <42A8A905.3060400@gmx.net>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>
	 <b7bb36410506060011715e86a3@mail.gmail.com> <42A4710C.2040401@gmx.net>
	 <b7bb36410506071028797f5f45@mail.gmail.com> <42A8A905.3060400@gmx.net>
Message-ID: <b7bb3641050609230315c19461@mail.gmail.com>

On 6/9/05, Martin Wache <M.Wache at gmx.net> wrote:
> I don't know how good you know debugging tools, but if you know gdb,
> could you try to attach to the additional thread and try to find out
> what it is doing? (Basically it just call gdb, enter "attach PID" and
> then "backtrace". Vdr will crash after this, so you will have to kill it
> with kill -9. Do this several times, and hopefully you will get the
> position where the time is spent.)
> The other possibility would be to try to profile vdr while playing a
> recording with some profiling tool.
> 

Ok, I'll try when I find some time although linux debugging tools
aren't very familiar to me. IMO gdb has very bad user interface.. DDD
helps a bit but I'm neither a guru in configuring X nor the network to
get it working over another computer. But I'll try it locally from the
vdr box maybe next week.

- Ari


From marko.makela at hut.fi  Fri Jun 10 09:11:46 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 10 Jun 2005 10:11:46 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <200506092033.54541.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118315472.42a823d0f4180@webmail.in-berlin.de> <20050609164308.GA3723@localhost.localdomain> <200506092033.54541.stefan@lucke.in-berlin.de>
Message-ID: <20050610071146.GA3607@localhost.localdomain>

On Thu, Jun 09, 2005 at 08:33:54PM +0200, Stefan Lucke wrote:
> Which pins do you choose when connecting your oscilloscope ?

I used R(1), G(2), B(3), GND (6,7,8) and HSYNC(13).  I had wired
HSYNC to SCART pin 20, in the spirit of the cable at
http://www.sm.go.dlr.de/%7Ebob/scart/scart.gif

Obviously, I mixed up the paragraphs "RGB via VGA connector" and
"RGB, S-Video and Composit via card specific TV-Out" at
http://softdevice.berlios.de.  After all, the G450 only has two
VGA-like connectors.

> Directly connect DDC lines 12 -> 15. !!!

> 	Used pins are R(1), G(2), B(3), RGB_SWITCH(9) via 75Ohm resistor,
> 	Composit(14) via 680Ohm

My monitor is exceptional in that it ignores the RGB_SWITCH; it has a
mechanical RGB/CVBS switch in the front panel.  My critical mistake was
to use the wrong pin for composite (13 instead of 14) and not to connect
the lines 12 and 15.

> Matrox schematics are available via link on softdevice page or:
> http://forum.matrox.com/mga/viewforum.php?f=52

Thanks, I got it now.  I'll try this tonight and let you know.

By the way, will softdevice have to do a color space conversion
(YUV->RGB), given that the TV-out frame buffer uses ARGB format?
Would it make more sense to use the "my-pal-32" timings on the
primary head?  I guess there's no simple way to make the same
VGA->SCART cable work on both heads.

	Marko


From stefan at lucke.in-berlin.de  Fri Jun 10 10:28:54 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 10 Jun 2005 10:28:54 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <20050610071146.GA3607@localhost.localdomain>
References: <42A33207.1070903@kapsi.fi> <1118315472.42a823d0f4180@webmail.in-berlin.de> <20050609164308.GA3723@localhost.localdomain> <200506092033.54541.stefan@lucke.in-berlin.de> <20050610071146.GA3607@localhost.localdomain>
Message-ID: <1118392134.42a94f46ae115@webmail.in-berlin.de>

Quoting Marko M?kel? :

> By the way, will softdevice have to do a color space conversion
> (YUV->RGB), given that the TV-out frame buffer uses ARGB format?
> Would it make more sense to use the "my-pal-32" timings on the
> primary head?  I guess there's no simple way to make the same
> VGA->SCART cable work on both heads.

YUV -> RGB conversion is done in hardware during stretch_bilt.

my-pal-32 timings are used for display via vga. The disadvantage
of that method is, that it is not possible to select field parity.

For "tv-out" field parity select is possible and will be adjusted
(in future) to current video material. Currently it is fixed
to top field first.

Stefan Lucke



From torgeir at pobox.com  Fri Jun 10 18:03:54 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 10 Jun 2005 17:03:54 +0100
Subject: [Softdevice-devel] Problems while playing recordings and in
	startup
In-Reply-To: <42A8A905.3060400@gmx.net>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>
	 <b7bb36410506060011715e86a3@mail.gmail.com> <42A4710C.2040401@gmx.net>
	 <b7bb36410506071028797f5f45@mail.gmail.com>  <42A8A905.3060400@gmx.net>
Message-ID: <1118419435.3151.74.camel@africa>

On Thu, 2005-06-09 at 22:39 +0200, Martin Wache wrote:
> 
> I just check on my box, I don't have an additional thread which takes
> so much CPU time when replaying a recording.
> 
> Torgeir? What do you also have one thread which takes additional CPU
> time?

Yes. I have one consuming about 15 - 30% cpu. This is the
cDvbPlayer::Action() thread;

top;
  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
11007 root      16   0  124m  21m 5440 S 21.0  4.3   0:28.16 vdr
11009 root      15   0  124m  21m 5440 S 17.7  4.3   0:22.00 vdr

/var/log/messages;
Jun 10 16:56:54 localhost vdr[11007]: dvbplayer thread started
(pid=11007, tid=245770)

Using the gdb attach method proved to be a bit difficult, I only seem to
get 

(gdb) ba
#0  0xb7dcee26 in nanosleep () from /lib/i686/libc.so.6
#1  0x00000001 in ?? ()
#2  0xb323fd50 in ?? ()
#3  0x00000000 in ?? ()


-- 
Torgeir Veimo <torgeir at pobox.com>



From torgeir at pobox.com  Fri Jun 10 18:07:33 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Fri, 10 Jun 2005 17:07:33 +0100
Subject: [Softdevice-devel] Problems while playing recordings and in
	startup
In-Reply-To: <1118419435.3151.74.camel@africa>
References: <b7bb36410505290948421de228@mail.gmail.com>
	 <1117396167.14625.17.camel@africa>
	 <b7bb364105053004023c8956b8@mail.gmail.com> <429B3C0F.8090305@gmx.net>
	 <b7bb3641050530110227f2b313@mail.gmail.com>
	 <1117478514.14424.0.camel@africa> <42A202DF.6000707@gmx.net>
	 <b7bb36410506060011715e86a3@mail.gmail.com> <42A4710C.2040401@gmx.net>
	 <b7bb36410506071028797f5f45@mail.gmail.com>  <42A8A905.3060400@gmx.net>
	 <1118419435.3151.74.camel@africa>
Message-ID: <1118419653.3151.75.camel@africa>

On Fri, 2005-06-10 at 17:03 +0100, Torgeir Veimo wrote:
> On Thu, 2005-06-09 at 22:39 +0200, Martin Wache wrote:
> > 
> > I just check on my box, I don't have an additional thread which takes
> > so much CPU time when replaying a recording.
> > 
> > Torgeir? What do you also have one thread which takes additional CPU
> > time?
> 
> Yes. I have one consuming about 15 - 30% cpu. This is the
> cDvbPlayer::Action() thread;

> Using the gdb attach method proved to be a bit difficult, I only seem to
> get 
> 
> (gdb) ba
> #0  0xb7dcee26 in nanosleep () from /lib/i686/libc.so.6
> #1  0x00000001 in ?? ()
> #2  0xb323fd50 in ?? ()
> #3  0x00000000 in ?? ()

Can this be the usleep(10000) in cSoftDevice::Poll() ?

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Fri Jun 10 19:10:37 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 10 Jun 2005 20:10:37 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <1118392134.42a94f46ae115@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118315472.42a823d0f4180@webmail.in-berlin.de> <20050609164308.GA3723@localhost.localdomain> <200506092033.54541.stefan@lucke.in-berlin.de> <20050610071146.GA3607@localhost.localdomain> <1118392134.42a94f46ae115@webmail.in-berlin.de>
Message-ID: <20050610171037.GB6749@localhost.localdomain>

On Fri, Jun 10, 2005 at 10:28:54AM +0200, Stefan Lucke wrote:
> YUV -> RGB conversion is done in hardware during stretch_bilt.

Hmm, somehow I got some judder while playing a recording that was
perfectly okay with VGA output.

> my-pal-32 timings are used for display via vga. The disadvantage
> of that method is, that it is not possible to select field parity.
> 
> For "tv-out" field parity select is possible and will be adjusted
> (in future) to current video material. Currently it is fixed
> to top field first.

What are the symptomps of wrong field parity?  I got some wavy output
on the screen, i.e., vertical lines in horizontal motion would look like
blurry waves:

\
/
\
/

One more thing: could it be that the composite sync of the Matrox G450
TV output violates the standard during vertical retrace (i.e.,
MacroVision)?  The top visible lines on my monitor were shifted to the
right.  The problem is not as bad as with the DXR3, which omitted
horizontal sync pulses for several dozen lines during vertical retrace,
and then output a very narrow and high spike (over 1 volt if I remember
correctly) a bit before starting to output the picture.  I haven't
measured the G450 composite sync output yet.

Oh well, I may revert back to VGA.  It has problems with horizontal
scrolling and interlaced video, but at least the picture is sharp,
and I have no other use for the monitor.  Is there some easy way
to specify which directfbrc to use on the -Psoftdevice command line?

	Marko


From marko.makela at hut.fi  Fri Jun 10 22:01:02 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 10 Jun 2005 23:01:02 +0300
Subject: [Softdevice-devel] Poor performance and crashes on G450 SCART-RGB output
Message-ID: <20050610200102.GB387709@kosh.hut.fi>

I profiled softdevice with SCART RGB output on the Matrox G450, maybe a
week old softdevice, vdr 1.3.24 and DirectFB 0.9.22.  ffmpeg has been linked
statically with softdevice, but DirectFB and VDR are not.

The processor time usage really tells it:

CPU: PIII, speed 906.618 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 90000
samples  %        symbol name
57132    25.3435  cDFBVideoOut::YUV(unsigned char*, unsigned char*, unsigned char*, int, int, int, int)
14163     6.2826  put_pixels16_xy2_mmx
13877     6.1558  ff_simple_idct_add_mmx
13762     6.1048  cStreamDecoder::BufferFill()
13366     5.9291  put_pixels8_mmx
12849     5.6997  put_pixels16_mmx
8186      3.6313  mpeg2_decode_block_non_intra
8108      3.5967  mpeg_decode_mb

Okay, so it's converting color spaces in software.  When I tried to change
the pixel format from YUV2 by pressing the Left button, vdr immediately
crashed.  It won't change when I press the Right button.  Here's the backtrace:

#0  0xb788b400 in dfb_system_video_memory_virtual ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#1  0xb788862e in dfb_surface_software_lock ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#2  0xb788856f in dfb_surface_soft_lock ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#3  0xb785d64b in IDirectFBSurface_Lock ()
   from /usr/local/lib/libdirectfb-0.9.so.22
#4  0xb78a545e in IDirectFBSurface::Lock (this=0xa57000, flags=0, ptr=0x0,
    pitch=0x0) at idirectfbsurface.cpp:116
#5  0xb79edcfd in cDFBVideoOut::Refresh (this=0x822b658, Bitmap=0x82f80e8)
    at video-dfb.c:839
#6  0xb79df5f5 in cSoftOsd::Flush (this=0x8211598) at softdevice.c:137
#7  0x080d8f5b in cSkinSTTNGDisplayMenu::Flush (this=0x8208990)
    at skinsttng.c:597
#8  0x080d4bd8 in cSkins::Flush (this=0x81b1a84) at skins.h:43
#9  0x080a1790 in cInterface::GetKey (this=0x8289b00, Wait=true)
    at interface.c:35
#10 0x080eb8aa in main (argc=1118428321, argv=0x820a2f0) at osdbase.h:79

I also get a crash when selecting "Restart VDR" (or whatever it is in
English) from the Settings menu.  This also happens with DirectFB VGA
output.  I'm using VDR 1.3.24 with the patch from subtitles-0.3.7,
and with -Psoftdevice -Psubtitles, no other plugins:

(gdb) bt full
#0  0x0841b0c0 in ?? ()
No symbol table info available.
#1  0xb7943544 in ~cSoftOsd (this=0x828aa78) at softdevice.c:113
No locals.
#2  0xb77930c9 in SubtitlesViewer::Hide (this=0x82ee490) at viewer.c:51
        lock = {mutex = 0x83bec78, locked = true}
#3  0x080ef348 in NonInteractiveOsdPatch::cOsdController::Unsubscribe (
    this=0x81b4e98, listener=0x82ee490) at osdcontroller.c:93
        llo = (NonInteractiveOsdPatch::cListenerListObject *) 0x8210650
        iMutex = {mutex = 0x0, locked = false}
#4  0xb7791685 in ~cSubtitlesReceiver (this=0x82ee350) at receiver.c:36
No locals.
#5  0xb779a008 in ~cSubtitlesChangedHandler (this=0xb77a50c0)
    at subfilter.c:329
No locals.
#6  0xb779d602 in __tcf_0 () at subfilter.c:449
No locals.
#7  0xb7d82de1 in __cxa_finalize () from /lib/libc.so.6
No symbol table info available.
#8  0xb7790980 in __do_global_dtors_aux ()
   from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
No symbol table info available.
#9  0xb779f1b6 in _fini () from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
No symbol table info available.
#10 0xb7e5f4a8 in _dl_close () from /lib/libc.so.6
No symbol table info available.
#11 0x00000021 in ?? ()
No symbol table info available.

The same crash happens even without -Psubtitles, when using the svdrp
connection (HITK Setup, HITK Right, HITK OK, HITK OK).

#0  0xb7943541 in ~cSoftOsd (this=0x82b8be0) at softdevice.c:113
113         videoOut->CloseOSD();
(gdb) bt
#0  0xb7943541 in ~cSoftOsd (this=0x82b8be0) at softdevice.c:113
#1  0xb77930c9 in SubtitlesViewer::Hide (this=0x8296b08) at viewer.c:51
#2  0x080ef348 in NonInteractiveOsdPatch::cOsdController::Unsubscribe (
    this=0x81b4e98, listener=0x8296b08) at osdcontroller.c:93
#3  0xb7791685 in ~cSubtitlesReceiver (this=0x82969c8) at receiver.c:36
#4  0xb779a008 in ~cSubtitlesChangedHandler (this=0xb77a50c0)
    at subfilter.c:329
#5  0xb779d602 in __tcf_0 () at subfilter.c:449
#6  0xb7d82de1 in __cxa_finalize () from /lib/libc.so.6
#7  0xb7790980 in __do_global_dtors_aux ()
   from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
#8  0xb779f1b6 in _fini () from ./PLUGINS/lib/libvdr-subtitles.so.1.3.24
#9  0xb7e5f4a8 in _dl_close () from /lib/libc.so.6
#10 0x00000022 in ?? ()
Previous frame inner to this frame (corrupt stack?)

It looks like vdr will update setup.conf before crashing.
softdevice.PixelFormat used to be 0 (with VGA output) but
got somehow changed to 2 (I didn't touch it in the OSD).
If I manually change it to 1 in setup.conf, it'll get
changed to YUV2 (I guess that is 2).  If playback is
suspended, VDR won't immediately crash after changing
the pixel format.  I even have time to change it to I420
before it will crash.  Is this by design?  Maybe the
PixelFormat menu should be disabled on -vo:mgatv?

One more thing: Is there some way to get the Linux console
on the Matrox SCART RGB output?  I tried the matroxset program,
but I only managed to get a black screen or apparently
unsyncronized VGA RGB output.

	Marko


From marko.makela at hut.fi  Fri Jun 10 22:54:57 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 10 Jun 2005 23:54:57 +0300
Subject: [Softdevice-devel] Crash in exit() on vanilla vdr 1.3.25 and DirectFB 0.9.22
Message-ID: <20050610205457.GA232416@kosh.hut.fi>

Hi,

When I hit Setup Right OK OK to exit VDR (it'd restart when running inside
a run-vdr script), I get this crash on VDR 1.3.25:

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 16384 (LWP 5931)]
0xb7944cf0 in ?? ()
(gdb) i thr
  2 Thread 32769 (LWP 5935)  0xb7e25ada in poll () from /lib/libc.so.6
* 1 Thread 16384 (LWP 5931)  0xb7944cf0 in ?? ()
(gdb) bt
#0  0xb7944cf0 in ?? ()
#1  0xb7d82b62 in exit () from /lib/libc.so.6
#2  0xb7d6ce3e in __libc_start_main () from /lib/libc.so.6
#3  0x08081361 in _start () at ../sysdeps/i386/elf/start.S:102
(gdb) thr 2
[Switching to thread 2 (Thread 32769 (LWP 5935))]#0  0xb7e25ada in poll ()
   from /lib/libc.so.6
(gdb) bt
#0  0xb7e25ada in poll () from /lib/libc.so.6
#1  0xb7f77b50 in __pthread_manager () from /lib/libpthread.so.0
#2  0xb7f77d57 in __pthread_manager_event () from /lib/libpthread.so.0
#3  0xb7e2e92a in clone () from /lib/libc.so.6

vdr has been compiled with -g, but it doesn't help.  I set a breakpoint in
exit() and re-ran (vdr -P'softdevice -vo dfb:mgatv'):

Breakpoint 2, 0xb7d82b06 in exit () from /lib/libc.so.6
(gdb)
(gdb) display/i $pc
1: x/i $pc  0xb7d82b06 <exit+6>:        sub    $0xc,%esp
(gdb) ni
0xb7d82b09 in exit () from /lib/libc.so.6
1: x/i $pc  0xb7d82b09 <exit+9>:        call   0xb7d6cc8d <z_errmsg+5524237>
...
0xb7d82bcf in exit () from /lib/libc.so.6
1: x/i $pc  0xb7d82bcf <exit+207>:      jmp    0xb7d82b5c <exit+92>
(gdb)
0xb7d82b5c in exit () from /lib/libc.so.6
1: x/i $pc  0xb7d82b5c <exit+92>:       mov    %eax,(%esp)
(gdb)
0xb7d82b5f in exit () from /lib/libc.so.6
1: x/i $pc  0xb7d82b5f <exit+95>:       call   *0x4(%esi)
(gdb) si
0xb77df630 in dfb_core_deinit_check ()
   from /usr/local/lib/libdirectfb-0.9.so.22
1: x/i $pc  0xb77df630 <dfb_core_deinit_check>: push   %ebp
(gdb) up
#1  0xb7d82b62 in exit () from /lib/libc.so.6

Note that this is the address in the backtrace.  I think this
is the atexit handler.  It won't crash in dfb_core_deinit_check(),
but at some later call.  Let us trace this a bit further:

gdb vdr
(gdb) break exit
(gdb) set env LD_ASSUME_KERNEL=2.4.1
(gdb) set env LD_LIBRARY_PATH=/usr/local/lib
(gdb) r -P'softdevice -vo dfb:mgatv'
Breakpoint 1, 0xb7d82b06 in exit () from /lib/libc.so.6
(gdb) break *0xb7d82b5f
(gdb) c
Breakpoint 2, 0xb7d82b5f in exit () from /lib/libc.so.6
(gdb) si
0xb77df630 in dfb_core_deinit_check ()
   from /usr/local/lib/libdirectfb-0.9.so.22
(gdb) c
Continuing.

Breakpoint 2, 0xb7d82b5f in exit () from /lib/libc.so.6
(gdb) si
0xb7944cf0 in ?? ()

So, something has entered a junk pointer (0xb7944cf0) to the atexit()
chain.  Unfortunately, I can't see any calls to atexit().  Hmm, at
the time when dfb_core_deinit_check() is called, the array dereferenced

1: x/i $pc  0xb7d82b5f <exit+95>:       call   *0x4(%esi)

has the following entries:

(gdb) p/x *((unsigned*)$esi)@3
$8 = {0x4, 0xb77df630, 0x0}
(gdb) p/x $esi
$9 = 0x81cfed0

On the next call, $esi will be 0x81cfec0.  The data pointed to by $esi
doesn't seem to change: it's

(gdb) p/x *((unsigned*)0x81cfec0)@8
$15 = {0x4, 0xb7944cf0, 0x0, 0xb7c52000, 0x4, 0xb77df630, 0x0, 0xb77f9000}

both before and after the dfb_core_deinit_check() call.

Any ideas?  Should I compile libc with -g, or what?

BTW, -Psubtitles refuses to start on vdr 1.3.25.  The vdr patch didn't
apply cleanly either, but it was trivial to apply the two rejects.
I'll ask the plugin author about that.

	Marko


From stefan at lucke.in-berlin.de  Fri Jun 10 23:16:34 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 10 Jun 2005 23:16:34 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <20050610171037.GB6749@localhost.localdomain>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain>
Message-ID: <200506102316.34994.stefan@lucke.in-berlin.de>

On Freitag, 10. Juni 2005 19:10, Marko M?kel? wrote:
> On Fri, Jun 10, 2005 at 10:28:54AM +0200, Stefan Lucke wrote:
> > YUV -> RGB conversion is done in hardware during stretch_bilt.
> 
> Hmm, somehow I got some judder while playing a recording that was
> perfectly okay with VGA output.
> 
> > my-pal-32 timings are used for display via vga. The disadvantage
> > of that method is, that it is not possible to select field parity.
> > 
> > For "tv-out" field parity select is possible and will be adjusted
> > (in future) to current video material. Currently it is fixed
> > to top field first.
> 
> What are the symptomps of wrong field parity?  I got some wavy output
> on the screen, i.e., vertical lines in horizontal motion would look like
> blurry waves:
> 
> \
> /
> \
> /

That looks like wrong field parity. Hm, there are some differences between
G400 and G450. You can try to change field parity around line 349.
Try: osdLayer->SetFieldParity(1);

> 
> One more thing: could it be that the composite sync of the Matrox G450
> TV output violates the standard during vertical retrace (i.e.,
> MacroVision)?  The top visible lines on my monitor were shifted to the
> right.  The problem is not as bad as with the DXR3, which omitted
> horizontal sync pulses for several dozen lines during vertical retrace,
> and then output a very narrow and high spike (over 1 volt if I remember
> correctly) a bit before starting to output the picture.  I haven't
> measured the G450 composite sync output yet.

I wish, I'd have an oscilloscope too.

> 
> Oh well, I may revert back to VGA.  It has problems with horizontal
> scrolling and interlaced video, but at least the picture is sharp,
> and I have no other use for the monitor.  Is there some easy way
> to specify which directfbrc to use on the -Psoftdevice command line?
> 
> 	Marko

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Jun 10 23:34:26 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 10 Jun 2005 23:34:26 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <200506062346.16419.stefan@lucke.in-berlin.de>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <42A4B95A.102@gmx.net> <200506062346.16419.stefan@lucke.in-berlin.de>
Message-ID: <200506102334.26518.stefan@lucke.in-berlin.de>

On Montag, 6. Juni 2005 23:46, Stefan Lucke wrote:
> On Montag, 6. Juni 2005 23:00, Martin Wache wrote:
> > Stefan Lucke wrote:
> > 
> > >>The cause for this is that I reduced the buffer sizes, I plan to make it 
> > >>possible to choose between "good seeking" (that is currently the 
> > >>default), a save buffer (like it was bevore), and HDTV buffers.
> > >>The good seeking buffer is as large as the FF card buffers, that means 
> > >>that when seeking backward vdr will correctly guess the current position.
> > >>Right now the switch to choose the buffer size is still missing, so one 
> > >>can't chosse yet :-(, but I'll add this feature soon.
> > > 
> > > 
> > > un  5 14:34:04 jarada vdr[3189]: buffer usage: 60% (tid=294919)
> > > Jun  5 14:34:04 jarada vdr[3189]: buffer usage: 70% (tid=294919)
> > > Jun  5 14:34:05 jarada vdr[3189]: buffer usage: 80% (tid=294919)
> > > Jun  5 14:34:06 jarada vdr[3193]: [softdevice-audio]: xrun
> > > Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 90% (tid=294919)
> > > Jun  5 14:34:14 jarada vdr[3188]: clearing transfer buffer to avoid overflows
> > > Jun  5 14:34:14 jarada vdr[3189]: buffer usage: 0% (tid=294919)
> > > Jun  5 14:34:15 jarada vdr[3219]: [softdevice-audio]: xrun
> > > Jun  5 14:34:25 jarada vdr[3219]: [softdevice-audio]: xrun
> > > 
> > > There must be something else. I played around with various buffer sizes,
> > > without success.
> > > 
> > Sorry, I have not finished the buffer size selection yet. Which buffer 
> > size did you increase? Did you choose one of the combinations from 
> > mpeg2decoder.h?
> 
> Yes.
> MIN_BUF_SIZE is used as buffer size for init_but_byte and as a threshold
> for enabling a signal.
> I'm wondering if I'm the only one who noticed that, could that be caused
> by my old/ stable kernel 2.4.27 ?

I got a bit further. So for now I don't think that my problem is with
buffering. I think it is a problem in the sync change, that is now
with pthread_cond_timedwait() .  It looks like upon call of this function
it allways returns upon the expired time and never at arrival of
a signal.

BUF[1388]:wakeup consumer
BUF[1388]:-- wakeup producer
BUF[1388]:-- consumer sleep    <---
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1388]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:wakeup consumer
BUF[1389]:producer sleep
BUF[1408]:-- consumer sleep done    <--- delta = 20ms
BUF[1448]:producer sleep done
BUF[1448]:wakeup consumer


BUF[1808]:wakeup consumer
BUF[1808]:-- wakeup producer
BUF[1808]:-- consumer sleep    <---
BUF[1828]:-- consumer sleep done    <--- delta = 20ms
BUF[1848]:-- wakeup producer
BUF[1848]:-- consumer sleep
BUF[1868]:wakeup consumer

BUF[3148]:wakeup consumer
BUF[3148]:producer sleep    <+++
BUF[3168]:-- consumer sleep done
BUF[3171]:-- wakeup producer
BUF[3171]:-- consumer sleep    <---
BUF[3188]:-- consumer sleep done    <--- delta = 17ms
BUF[3208]:producer sleep done    <+++ delta = 60ms
BUF[3208]:wakeup consumer
BUF[3208]:-- wakeup producer
BUF[3208]:-- consumer sleep
BUF[3208]:wakeup consumer



-- 
Stefan Lucke
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sod-sync.diff
Type: text/x-diff
Size: 3940 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050610/69be4521/attachment.diff>

From marko.makela at hut.fi  Fri Jun 10 23:45:15 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 11 Jun 2005 00:45:15 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <200506102316.34994.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de>
Message-ID: <20050610214515.GC232416@kosh.hut.fi>

On Fri, Jun 10, 2005 at 11:16:34PM +0200, Stefan Lucke wrote:
> > What are the symptomps of wrong field parity?  I got some wavy output
> > on the screen, i.e., vertical lines in horizontal motion would look like
> > blurry waves:
> > 
> > \
> > /
> > \
> > /
> 
> That looks like wrong field parity. Hm, there are some differences between
> G400 and G450. You can try to change field parity around line 349.
> Try: osdLayer->SetFieldParity(1);

I tried again with up-to-date vdr and softdevice and recordings that I
believe are interlaced (many films are not), but didn't get the symptoms
on horizontal motion.  Those symptoms I got with live stream, which I
stupidly didn't record.

> > One more thing: could it be that the composite sync of the Matrox G450
> > TV output violates the standard during vertical retrace (i.e.,
> > MacroVision)?  The top visible lines on my monitor were shifted to the
> > right.  The problem is not as bad as with the DXR3, which omitted
> > horizontal sync pulses for several dozen lines during vertical retrace,
> > and then output a very narrow and high spike (over 1 volt if I remember
> > correctly) a bit before starting to output the picture.  I haven't
> > measured the G450 composite sync output yet.
> 
> I wish, I'd have an oscilloscope too.

Technically, it's not my scope, but I haven't had the transport to return
it, and my friend hasn't had time to need it. :-)

I'm not an expert, but the composite sync signal looks okay to me.  The
vsync phase takes maybe 15 hsync pulses, and the sync line is at mostly
GND level for about 3 hsync pulse times.  (It's an analog scope, and I
had trouble controlling the trigger.)

So, I can safely blame the slight distortion at the top of the screen on
the monitor.  On a second thought, I can blame it on me: The picture is
perfect when I put the "VCR mode" switch to another position.  On DXR3,
the distortion was much worse, and the VCR mode switch had almost no
effect on it.

BTW, I got the subtitles plugin to work on vdr-1.3.25.  I had to slightly
modify the patch in osd.c.rej.  Somehow VDR 1.3.25 can open nested OSDs, and
the hook for subtitles should only be invoked at the outmost level where
no OSD is open.  I notified the author.

	Marko


From torgeir at pobox.com  Sat Jun 11 04:11:30 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sat, 11 Jun 2005 03:11:30 +0100
Subject: [Softdevice-devel] Poor performance and crashes on G450
	SCART-RGB output
In-Reply-To: <20050610200102.GB387709@kosh.hut.fi>
References: <20050610200102.GB387709@kosh.hut.fi>
Message-ID: <1118455890.3151.80.camel@africa>

On Fri, 2005-06-10 at 23:01 +0300, Marko M?kel? wrote:
> I profiled softdevice with SCART RGB output on the Matrox G450, maybe a
> week old softdevice, vdr 1.3.24 and DirectFB 0.9.22.  ffmpeg has been linked
> statically with softdevice, but DirectFB and VDR are not.

Could you also possibly do some profiling when playing back recordings?

-- 
Torgeir Veimo <torgeir at pobox.com>



From marko.makela at hut.fi  Sat Jun 11 12:10:48 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 11 Jun 2005 13:10:48 +0300
Subject: [Softdevice-devel] Poor performance and crashes on G450	SCART-RGB output
In-Reply-To: <1118455890.3151.80.camel@africa>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa>
Message-ID: <20050611101048.GA3225@localhost.localdomain>

On Sat, Jun 11, 2005 at 03:11:30AM +0100, Torgeir Veimo wrote:
> On Fri, 2005-06-10 at 23:01 +0300, Marko M?kel? wrote:
> > I profiled softdevice with SCART RGB output on the Matrox G450, maybe a
> > week old softdevice, vdr 1.3.24 and DirectFB 0.9.22.  ffmpeg has been linked
> > statically with softdevice, but DirectFB and VDR are not.
> 
> Could you also possibly do some profiling when playing back recordings?

The profiling report I posted was obtained while playing back a
recording, albeit from a randomly chosen position.

I see no point in profiling further until the processor-intensive color
space conversion can be avoided.  (Stefan wrote that softdevice would do
color space conversion in hardware.)

	Marko


From stefan at lucke.in-berlin.de  Sat Jun 11 13:28:15 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 11 Jun 2005 13:28:15 +0200
Subject: [Softdevice-devel] Poor performance and crashes on =?iso-8859-1?q?G450=09SCART-RGB?= output
In-Reply-To: <20050611101048.GA3225@localhost.localdomain>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain>
Message-ID: <200506111328.15441.stefan@lucke.in-berlin.de>

On Samstag, 11. Juni 2005 12:10, Marko M?kel? wrote:
> On Sat, Jun 11, 2005 at 03:11:30AM +0100, Torgeir Veimo wrote:
> > On Fri, 2005-06-10 at 23:01 +0300, Marko M?kel? wrote:
> > > I profiled softdevice with SCART RGB output on the Matrox G450, maybe a
> > > week old softdevice, vdr 1.3.24 and DirectFB 0.9.22.  ffmpeg has been linked
> > > statically with softdevice, but DirectFB and VDR are not.
> > 
> > Could you also possibly do some profiling when playing back recordings?
> 
> The profiling report I posted was obtained while playing back a
> recording, albeit from a randomly chosen position.
> 
> I see no point in profiling further until the processor-intensive color
> space conversion can be avoided.  (Stefan wrote that softdevice would do
> color space conversion in hardware.)

There is a small misunderstanding. Color space conversion is done in
hardware (YUY2 -> RGB). Color format change is done in software
(YV12 -> YUV2).

-- 
Stefan Lucke



From marko.makela at hut.fi  Sat Jun 11 15:37:06 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sat, 11 Jun 2005 16:37:06 +0300
Subject: [Softdevice-devel] Poor performance and crashes on G450	SCART-RGB output
In-Reply-To: <200506111328.15441.stefan@lucke.in-berlin.de>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de>
Message-ID: <20050611133706.GB3359@localhost.localdomain>

On Sat, Jun 11, 2005 at 01:28:15PM +0200, Stefan Lucke wrote:
> There is a small misunderstanding. Color space conversion is done in
> hardware (YUY2 -> RGB). Color format change is done in software
> (YV12 -> YUV2).

I see.  Is there any way to speed up the software part?  I.e., can the
conversion be done in-place, so that the Y component need not be
written?  (On a second thought, that shouldn't bring much, because all
components will be fetched to the processor caches anyway.)

When I used deinterlacing and the software-intensive pixel format (YUV2?)
with VGA output, the sound played smoothly, but video frames were dropped
every now and then.  With -vo:mgatv and obviously without deinterlacing,
I also get dropped _audio_ frames, which is really annoying.  

	Marko


From marko.makela at hut.fi  Sun Jun 12 08:33:06 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 12 Jun 2005 09:33:06 +0300
Subject: [Softdevice-devel] Poor performance and crashes on G450 SCART-RGB output
In-Reply-To: <20050611133706.GB3359@localhost.localdomain>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain>
Message-ID: <20050612063306.GA3230@localhost.localdomain>

On Sat, Jun 11, 2005 at 04:37:06PM +0300, Marko M?kel? wrote:
> When I used deinterlacing and the software-intensive pixel format (YUV2?)
> with VGA output, the sound played smoothly, but video frames were dropped
> every now and then.  With -vo:mgatv and obviously without deinterlacing,
> I also get dropped _audio_ frames, which is really annoying.  

Update: audio frames are never dropped on live stream, even when
recording the stream while playing.  "top" will show about 50% idle
processor time.  If I play the same stream from a recording, "top" shows
about 25% idle processor time, and video and audio frames will be dropped,
often several times per second.  I can't see anything suspicious in the
oprofile output of softdevice.

Hmm, now I think got it: opreport --global-percent tells it all at
module level.  This is with live playback:

  samples|      %|
  ------------------
   156558 67.6753 libvdr-softdevice.so.1.3.25
    22436  9.6984 libdirectfb_matrox.so
    19083  8.2490 vmlinux
     7639  3.3021 oprofiled
     7614  3.2913 libc-2.3.2.so
     4933  2.1324 vdr
     3832  1.6565 oprofile
     3467  1.4987 dvb_core
     1829  0.7906 libpthread-0.10.so

And this when playing the corresponding recording:

   160134 57.7513 libvdr-softdevice.so.1.3.25
    35726 12.8844 libpthread-0.10.so
    20816  7.5072 vdr
    20243  7.3005 libdirectfb_matrox.so
    16292  5.8756 vmlinux
     9321  3.3616 oprofiled
     4686  1.6900 oprofile
     4090  1.4750 libc-2.3.2.so
     2119  0.7642 dvb_core

Somehow, libpthread is consuming 13 % of processing time.  In live
playback, it uses less than one percent.  Judging from opstack
output on /lib/libpthread-0.10.so, the most frequently used entry
point is pthread_cond_timedwait_relative.  Here's the opreport
breakdown:

samples  %        symbol name
9047     25.3233  __pthread_alt_unlock
6931     19.4004  __pthread_alt_lock
5338     14.9415  thread_self
4370     12.2320  thread_self
3354      9.3881  __GI___pthread_mutex_unlock
3174      8.8843  __GI___pthread_mutex_lock
1842      5.1559  __i686.get_pc_thunk.bx
1045      2.9250  __errno_location
89        0.2491  __pthread_lock
52        0.1456  thread_self
50        0.1400  __pthread_unlock
45        0.1260  __pthread_timedsuspend_new
45        0.1260  pthread_cond_timedwait_relative

Any ideas?  In order to get more accurate results, I think I'll have to
link vdr and all plugins and libraries statically.  Could someone
(Martin?) post that patch again?

	Marko


From marko.makela at hut.fi  Sun Jun 12 13:24:25 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 12 Jun 2005 14:24:25 +0300
Subject: [Softdevice-devel] Inefficient synchronization when playing back recordings
In-Reply-To: <20050612063306.GA3230@localhost.localdomain>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain> <20050612063306.GA3230@localhost.localdomain>
Message-ID: <20050612112425.GA251025@kosh.hut.fi>

On Sun, Jun 12, 2005 at 09:33:06AM +0300, Marko M?kel? wrote:
> Somehow, libpthread is consuming 13 % of processing time.  In live
> playback, it uses less than one percent.

I confirmed this with VGA output.  When repeating live stream (and recording
it at the same time), libpthread-0.10.so uses 0.8 % of CPU_CLK_UNHALTED time.
When playing back the recording, it uses 11.6 %.

I tested again with NPTL (after removing the nagging from vdr.c).  It
appears to be twice as fast, i.e., live playback spends 0.44 % in
libpthread, and playing back the recording spends 6.55% in libpthread.

If someone has a hardware decoder (dxr3 or a full-featured card), I'd
be interested to see the results from a similar test.  (That is, who
is invoking synchronization primitives too often: vdr or softdevice?)

	Marko


From torgeir at pobox.com  Sun Jun 12 14:01:00 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Sun, 12 Jun 2005 13:01:00 +0100
Subject: [Softdevice-devel] Inefficient synchronization when playing
	back recordings
In-Reply-To: <20050612112425.GA251025@kosh.hut.fi>
References: <20050610200102.GB387709@kosh.hut.fi>
	 <1118455890.3151.80.camel@africa>
	 <20050611101048.GA3225@localhost.localdomain>
	 <200506111328.15441.stefan@lucke.in-berlin.de>
	 <20050611133706.GB3359@localhost.localdomain>
	 <20050612063306.GA3230@localhost.localdomain>
	 <20050612112425.GA251025@kosh.hut.fi>
Message-ID: <1118577660.5424.4.camel@localhost>

On Sun, 2005-06-12 at 14:24 +0300, Marko M?kel? wrote:
> 
> I confirmed this with VGA output.  When repeating live stream (and
> recording
> it at the same time), libpthread-0.10.so uses 0.8 % of
> CPU_CLK_UNHALTED time.
> When playing back the recording, it uses 11.6 %.
> 
> I tested again with NPTL (after removing the nagging from vdr.c).  It
> appears to be twice as fast, i.e., live playback spends 0.44 % in
> libpthread, and playing back the recording spends 6.55% in libpthread.
> 
> If someone has a hardware decoder (dxr3 or a full-featured card), I'd
> be interested to see the results from a similar test.  (That is, who
> is invoking synchronization primitives too often: vdr or softdevice?)

Your observations seem to indicate this is the same problem I'm seeing,
where the dvbplayer thread occupy about 15% cpu when playing back
recordings. Can you reread the thread subject "Problems while playing
recordings and in startup" and check if you similar things to me;

> top;
>   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> 11007 root      16   0  124m  21m 5440 S 21.0  4.3   0:28.16 vdr
> 11009 root      15   0  124m  21m 5440 S 17.7  4.3   0:22.00 vdr
> 
> /var/log/messages;
> Jun 10 16:56:54 localhost vdr[11007]: dvbplayer thread started
> (pid=11007, tid=245770)


-- 
Torgeir Veimo <torgeir at pobox.com>



From prelude at kapsi.fi  Sun Jun 12 16:52:51 2005
From: prelude at kapsi.fi (prelude)
Date: Sun, 12 Jun 2005 17:52:51 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <200506102316.34994.stefan@lucke.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de>
Message-ID: <42AC4C43.4050506@kapsi.fi>

Stefan Lucke wrote:

>On Freitag, 10. Juni 2005 19:10, Marko M?kel? wrote:
>  
>
>>On Fri, Jun 10, 2005 at 10:28:54AM +0200, Stefan Lucke wrote:
>>    
>>
>>>YUV -> RGB conversion is done in hardware during stretch_bilt.
>>>      
>>>
>>Hmm, somehow I got some judder while playing a recording that was
>>perfectly okay with VGA output.
>>
>>    
>>
>>>my-pal-32 timings are used for display via vga. The disadvantage
>>>of that method is, that it is not possible to select field parity.
>>>
>>>For "tv-out" field parity select is possible and will be adjusted
>>>(in future) to current video material. Currently it is fixed
>>>to top field first.
>>>      
>>>
>>What are the symptomps of wrong field parity?  I got some wavy output
>>on the screen, i.e., vertical lines in horizontal motion would look like
>>blurry waves:
>>
>>\
>>/
>>\
>>/
>>    
>>
>
>That looks like wrong field parity. Hm, there are some differences between
>G400 and G450. You can try to change field parity around line 349.
>Try: osdLayer->SetFieldParity(1);
>
>  
>

Hi

It's more likely "problem" whit scaling. When you scale image whit 
"StretchBlit" function you will see same kind effect what you see when 
you use wrong field parity. (I hit my head to rock about 2 weeks whit 
df_xine when i hunt that).

Someday when i have enough time (i'm not a programmer) i try to 
implement "correct" aspect ratio handling to softdevice when you use 
matrox TV out. (Point is that you use "Blit" and normaly newer use 
"StretchBlit" whit video data)
Example:
your TV aspect ratio is old 4/3. (720*576):
Incoming video is 720*576 -> blit it directly
Incoming video is 630x576 -> make buffer to 720*576 size -> clear it -> 
blit video to that buffer whit 45 ((720-630)/2) pixel offset.
Incoming video is 720x486 -> make buffer to 720*576 size -> clear it -> 
blit video to that buffer whit 45 ((576-286)/2) lines offset.
Incoming video is 360*576 -> make StretchBlit.
etc.

It's not probably a correct way to handle it but whit that picture looks 
good.

Ouh yeah..Btw.. Why softdevice make that YUV420 -> RGB conversion. 
(libavout send YUV420 and you can use that directly whit matrox 
(YUV420=YV12)?. I ask it because that conversion makes picture bit less 
good and because conversions it's use much processor power)







From M.Wache at gmx.net  Sun Jun 12 19:32:21 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 12 Jun 2005 19:32:21 +0200
Subject: [Softdevice-devel] Inefficient synchronization when playing	back
 recordings
In-Reply-To: <1118577660.5424.4.camel@localhost>
References: <20050610200102.GB387709@kosh.hut.fi>	 <1118455890.3151.80.camel@africa>	 <20050611101048.GA3225@localhost.localdomain>	 <200506111328.15441.stefan@lucke.in-berlin.de>	 <20050611133706.GB3359@localhost.localdomain>	 <20050612063306.GA3230@localhost.localdomain>	 <20050612112425.GA251025@kosh.hut.fi> <1118577660.5424.4.camel@localhost>
Message-ID: <42AC71A5.70702@gmx.net>

Torgeir Veimo schrieb:
> On Sun, 2005-06-12 at 14:24 +0300, Marko M?kel? wrote:
> 
>>I confirmed this with VGA output.  When repeating live stream (and
>>recording
>>it at the same time), libpthread-0.10.so uses 0.8 % of
>>CPU_CLK_UNHALTED time.
>>When playing back the recording, it uses 11.6 %.

After thinking for some time about this, I think one should expect that
vdr/softdevice spents more time in libpthread when replaying a recording.
When playing live-tv the stream arrives at almost the same rate as it is
consumed, normally there is enough room to store the data since it is
consumed at the same rate.
When playing a recording vdr feeds data into the softdevice as fast as
it can. The softdevice sleeps in Poll() (just like the specification
says) when there is no room to store more data.
So in the end the buffers are full almost all the time when playing a
recording, which means that locking is more important there.

I'm not sure if this explains the 10 times more time which is spent in
libpthread, I would expect a bit more time, but 10 times?
And I'm sure that this _definitly_ not explains the additional thread
20-30% cpu time.
Which glibc version are you using?

>>
>>I tested again with NPTL (after removing the nagging from vdr.c).  It
>>appears to be twice as fast, i.e., live playback spends 0.44 % in
>>libpthread, and playing back the recording spends 6.55% in libpthread.
>>
>>If someone has a hardware decoder (dxr3 or a full-featured card), I'd
>>be interested to see the results from a similar test.  (That is, who
>>is invoking synchronization primitives too often: vdr or softdevice?)
I second that, it would really be interessting to know if this is the
same for different decoders. What about xine? Maybe someone has a
running xine plugin?

Martin


From M.Wache at gmx.net  Sun Jun 12 19:32:37 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 12 Jun 2005 19:32:37 +0200
Subject: [Softdevice-devel] Many xrun(s) with latest cvs changes.
In-Reply-To: <200506102334.26518.stefan@lucke.in-berlin.de>
References: <200505291329.54431.stefan@lucke.in-berlin.de> <42A4B95A.102@gmx.net> <200506062346.16419.stefan@lucke.in-berlin.de> <200506102334.26518.stefan@lucke.in-berlin.de>
Message-ID: <42AC71B5.4080800@gmx.net>

Stefan Lucke schrieb:

> 
> I got a bit further. So for now I don't think that my problem is with
> buffering. I think it is a problem in the sync change, that is now
> with pthread_cond_timedwait() .  It looks like upon call of this function
> it allways returns upon the expired time and never at arrival of
> a signal.

> BUF[3148]:wakeup consumer
> BUF[3148]:producer sleep    <+++
> BUF[3168]:-- consumer sleep done
> BUF[3171]:-- wakeup producer
> BUF[3171]:-- consumer sleep    <---
> BUF[3188]:-- consumer sleep done    <--- delta = 17ms
> BUF[3208]:producer sleep done    <+++ delta = 60ms
> BUF[3208]:wakeup consumer
> BUF[3208]:-- wakeup producer
> BUF[3208]:-- consumer sleep
> BUF[3208]:wakeup consumer
> 

Hmm, I can't say much currently, as it is not easy to see which messages
belong to the audio packet queue and which to the video queue.
But there is one thing which you may want to try: change
cSigTimer::Sleep(), so that it doesn't set got_signal to false on a
start of the sleep. Currently the signal gets lost if the signal arrives
even before the consumer started sleeping.

Martin


From marko.makela at hut.fi  Sun Jun 12 19:57:45 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Sun, 12 Jun 2005 20:57:45 +0300
Subject: [Softdevice-devel] Inefficient synchronization when playing	back recordings
In-Reply-To: <42AC71A5.70702@gmx.net>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain> <20050612063306.GA3230@localhost.localdomain> <20050612112425.GA251025@kosh.hut.fi> <1118577660.5424.4.camel@localhost> <42AC71A5.70702@gmx.net>
Message-ID: <20050612175745.GC3239@localhost.localdomain>

On Sun, Jun 12, 2005 at 07:32:21PM +0200, Martin Wache wrote:
> I'm not sure if this explains the 10 times more time which is spent in
> libpthread, I would expect a bit more time, but 10 times?
> And I'm sure that this _definitly_ not explains the additional thread
> 20-30% cpu time.
> Which glibc version are you using?

I can't check right now (the box is recording right now, and I accidentally
made it inaccessible from the net until being able to access it from the
console or rebooting it), but I assume it's GNU libc 2.3.2.  The kernel is
at least version 2.6.11.6.

By the way, today's benchmarks I made with VGA output were taken with
YUV2 color format, which wastes 25-30% of softdevice's CPU cycles.  The
libpthread percentage could be even higher with I420 color space.

Can you please tell me again how to link vdr and softdevice statically?

	Marko


From M.Wache at gmx.net  Sun Jun 12 22:43:01 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Sun, 12 Jun 2005 22:43:01 +0200
Subject: [Softdevice-devel] Inefficient synchronization when playing	back
 recordings
In-Reply-To: <20050612175745.GC3239@localhost.localdomain>
References: <20050610200102.GB387709@kosh.hut.fi> <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain> <20050612063306.GA3230@localhost.localdomain> <20050612112425.GA251025@kosh.hut.fi> <1118577660.5424.4.camel@localhost> <42AC71A5.70702@gmx.net> <20050612175745.GC3239@localhost.localdomain>
Message-ID: <42AC9E55.1000000@gmx.net>

Marko M?kel? schrieb:

> Can you please tell me again how to link vdr and softdevice statically?
> 
Sure, find attached the patch I already sent the last time, I assume not
much changed from the old vdr version, so it should apply also to more
recent vdr version.

You will have to modify vdr's makefile to link statically to the
softdevice. As far as I remember I created a .a library with all the
needed files from the softdevice and linked this to vdr.
Please note that my patch is a hack and it will disable all other plugins.

Martin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: static.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050612/f82303fa/attachment.ksh>

From nhuillard at e-dition.fr  Mon Jun 13 00:03:43 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 13 Jun 2005 00:03:43 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <42AC4C43.4050506@kapsi.fi>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de> <42AC4C43.4050506@kapsi.fi>
Message-ID: <42ACB13F.4080202@e-dition.fr>

prelude a ?crit :
> Hi
> 
> It's more likely "problem" whit scaling. When you scale image whit
> "StretchBlit" function you will see same kind effect what you see when
> you use wrong field parity. (I hit my head to rock about 2 weeks whit
> df_xine when i hunt that).
> 
> Someday when i have enough time (i'm not a programmer) i try to
> implement "correct" aspect ratio handling to softdevice when you use
> matrox TV out. (Point is that you use "Blit" and normaly newer use
> "StretchBlit" whit video data)
> Example:
> your TV aspect ratio is old 4/3. (720*576):
> Incoming video is 720*576 -> blit it directly
> Incoming video is 630x576 -> make buffer to 720*576 size -> clear it ->
> blit video to that buffer whit 45 ((720-630)/2) pixel offset.
> Incoming video is 720x486 -> make buffer to 720*576 size -> clear it ->
> blit video to that buffer whit 45 ((576-286)/2) lines offset.
> Incoming video is 360*576 -> make StretchBlit.
> etc.
> 
> It's not probably a correct way to handle it but whit that picture looks
> good.
> 
> Ouh yeah..Btw.. Why softdevice make that YUV420 -> RGB conversion.
> (libavout send YUV420 and you can use that directly whit matrox
> (YUV420=YV12)?. I ask it because that conversion makes picture bit less
> good and because conversions it's use much processor power)

Stephan is currently working on aspect ratio handling, upon suggestions
from me and others.
I first decided to ignore the field parity / interlacing problem when
scaling, partly because I didn't see any artifacts with the current
scaling code (with the material I actually watch), partly because when
taking interlacing into account, one shouldn't scale at all (that's what
you suggest) (this is true for interlaced material on interlaced display).
Maybe the current scaling setup take your problem into account. It's far
behind in my head right now, I must admit...

-- 
NH


From stefan at lucke.in-berlin.de  Mon Jun 13 08:47:00 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 13 Jun 2005 08:47:00 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <42ACB13F.4080202@e-dition.fr>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de> <42AC4C43.4050506@kapsi.fi> <42ACB13F.4080202@e-dition.fr>
Message-ID: <1118645220.42ad2be4102cc@webmail.in-berlin.de>

Quoting Nicolas Huillard :

> prelude a ?crit :
> > Hi
> >
> > It's more likely "problem" whit scaling. When you scale image whit
> > "StretchBlit" function you will see same kind effect what you see when
> > you use wrong field parity. (I hit my head to rock about 2 weeks whit
> > df_xine when i hunt that).
> >
> > Someday when i have enough time (i'm not a programmer) i try to
> > implement "correct" aspect ratio handling to softdevice when you use
> > matrox TV out. (Point is that you use "Blit" and normaly newer use
> > "StretchBlit" whit video data)
> > Example:
> > your TV aspect ratio is old 4/3. (720*576):
> > Incoming video is 720*576 -> blit it directly

> > Incoming video is 630x576 -> make buffer to 720*576 size -> clear it ->
> > blit video to that buffer whit 45 ((720-630)/2) pixel offset.

Thats what is done, if incoming stream is 4:3 and you set your display
aspect to 4:3. If it does not do the "correct scaling" (tm) please
post messages from your syslog where all scaling operation are logged.

> > Incoming video is 720x486 -> make buffer to 720*576 size -> clear it ->
> > blit video to that buffer whit 45 ((576-286)/2) lines offset.

Thats an unusual height. Where does it come from ?
Scaling interlaced material with such height values is a bit problematic.

> > Incoming video is 360*576 -> make StretchBlit.
> > etc.
> >
> > It's not probably a correct way to handle it but whit that picture looks
> > good.
> >
> > Ouh yeah..Btw.. Why softdevice make that YUV420 -> RGB conversion.
> > (libavout send YUV420 and you can use that directly whit matrox
> > (YUV420=YV12)?. I ask it because that conversion makes picture bit less
> > good and because conversions it's use much processor power)
>
> Stephan is currently working on aspect ratio handling, upon suggestions
> from me and others.

No. There is (currently) no pending action. I posted a patch and this patch
is in cvs, but there was no feedback.

> I first decided to ignore the field parity / interlacing problem when
> scaling, partly because I didn't see any artifacts with the current
> scaling code (with the material I actually watch), partly because when
> taking interlacing into account, one shouldn't scale at all (that's what
> you suggest) (this is true for interlaced material on interlaced display).
> Maybe the current scaling setup take your problem into account. It's far
> behind in my head right now, I must admit...

Stefan Lucke



From nhuillard at e-dition.fr  Mon Jun 13 10:18:32 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 13 Jun 2005 10:18:32 +0200
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <1118645220.42ad2be4102cc@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de> <42AC4C43.4050506@kapsi.fi> <42ACB13F.4080202@e-dition.fr> <1118645220.42ad2be4102cc@webmail.in-berlin.de>
Message-ID: <42AD4158.9070807@e-dition.fr>

Stefan Lucke a ?crit :
> Quoting Nicolas Huillard :
>>Stephan is currently working on aspect ratio handling, upon suggestions
>>from me and others.
> 
> No. There is (currently) no pending action. I posted a patch and this patch
> is in cvs, but there was no feedback.

Excuse me for involving you directly. I meant that pending action was
testing / suggesting. You certainly will take into account good
suggestions... when they will be there.

-- 
NH


From prelude at kapsi.fi  Mon Jun 13 11:55:03 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Mon, 13 Jun 2005 12:55:03 +0300 (EEST)
Subject: [Softdevice-devel] Improvement suggestion (closing video & audio after keypress)
Message-ID: <Pine.LNX.4.62.0506131241170.30529@lakka>

Some times i want to look movies whit mplayer and/or use some other DFB 
application and currently i need to stop whole VDR to do that. (Not fun if 
you have some recordings waiting)
So following functionality in to softdevice is very welcomme to me ;-)

When i press example power button from my remote softdevice uninitialize 
video and audio but it still left VDR runing. And when i press that button 
again softdevice initialize audio&video and start showing VDR's output.

Btw. thx for that softdevice... it's great. Someday when all working fine 
it's even better that fullfeature card :-) (Pic quality whit G400 is 
better that fullfeature cards and softdevice can handle HDTV resolutions 
:-))




From voitto.tuomainen at luukku.com  Mon Jun 13 11:52:37 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Mon, 13 Jun 2005 12:52:37 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
Message-ID: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com>

Hi,
As stated in subject, there is a blue bar on left side of the picture in certain conditions. I think that if broadcasting picture is smaller than the maximum picture viewable area, this happens. This problem was not shown in a channel, I have an example in my web page http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases, but it occurs on another channel, which I think is in different channel bunch. Problem in that channel is valid still.

My configuration is vdr 1.3.25, softdevice xv, FFMpeg-20050609, gentoo with one week old software and Technisat Airstar2 DVB-T PCI. Picture is sent to plasma through Sapphire Radeon 9600 DVI connection.
______
BR, Voitto Tuomainen

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From marko.makela at hut.fi  Mon Jun 13 12:12:22 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Mon, 13 Jun 2005 13:12:22 +0300
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com>
References: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com>
Message-ID: <20050613101222.GE4330@localhost.localdomain>

On Mon, Jun 13, 2005 at 12:52:37PM +0300, Voitto Tuomainen wrote:
> Hi,
> As stated in subject, there is a blue bar on left side of the picture in
> certain conditions. I think that if broadcasting picture is smaller than
> the maximum picture viewable area, this happens.

Me too, using current softdevice CVS and a bit older ffmpeg CVS.  I
think it could be the sender's problem.  I'm getting this from the
DVB-T bundle of MTV3, Nelonen, SubTV etc.

Maybe there should be a softdevice configuration option for cropping
the picture?

BTW, something is wrong with 16:9->4:3->16:9 transitions again.  If I
use the skip-one-minute buttons, sometimes it won't notice the changed
format.  In two occasions, softdevice stopped updating the right-hand
1/8 or 1/6 of the screen and showed parts of two old frames there until
I touched the "crop mode" setting in softdevice menu.  I didn't have
these problems two weeks ago.

	Marko


From nhuillard at e-dition.fr  Mon Jun 13 12:44:41 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Mon, 13 Jun 2005 12:44:41 +0200
Subject: [Softdevice-devel] Improvement suggestion (closing video & audio
 after keypress)
In-Reply-To: <Pine.LNX.4.62.0506131241170.30529@lakka>
References: <Pine.LNX.4.62.0506131241170.30529@lakka>
Message-ID: <42AD6399.8@e-dition.fr>

Tommi Lundell a ?crit :
> Some times i want to look movies whit mplayer and/or use some other DFB
> application and currently i need to stop whole VDR to do that. (Not fun
> if you have some recordings waiting)

Do you use the DFB multi-application core ?
With that feature, you should be able to launch many apps at the same
time and display them on the screen. It is maybe useful to also suspend
audio/video.
You could also have problems with the LIRC stuff, which is totally
independant of softdevice.
I think your problem is more a good UI and ergonomics problem than a
software problem. Can you explain a bit more how you launch mplayer and
"other apps" and what you expect ?
On the other hand, you could leave mplayer alone and use softplay to
view other movies...

> So following functionality in to softdevice is very welcomme to me ;-)
> 
> When i press example power button from my remote softdevice uninitialize
> video and audio but it still left VDR runing. And when i press that
> button again softdevice initialize audio&video and start showing VDR's
> output.
> 
> Btw. thx for that softdevice... it's great. Someday when all working
> fine it's even better that fullfeature card :-) (Pic quality whit G400
> is better that fullfeature cards and softdevice can handle HDTV
> resolutions :-))

-- 
NH


From stefan at lucke.in-berlin.de  Mon Jun 13 14:22:48 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 13 Jun 2005 14:22:48 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
Message-ID: <1118665368.42ad7a9808b63@webmail.in-berlin.de>

Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:

> Hi,
> As stated in subject, there is a blue bar on left side of the picture in
> certain conditions. I think that if broadcasting picture is smaller than the
> maximum picture viewable area, this happens. This problem was not shown in a
> channel, I have an example in my web page
> http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases, but
> it occurs on another channel, which I think is in different channel bunch.
> Problem in that channel is valid still.

Can you show us the messages from syslog which describe actual scaling
parameters?
Scaling parameters are usually reported after lines like:
... aspect changed (....

Stefan Lucke


From stefan at lucke.in-berlin.de  Mon Jun 13 14:22:48 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 13 Jun 2005 14:22:48 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
Message-ID: <1118665368.42ad7a9808b63@webmail.in-berlin.de>

Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:

> Hi,
> As stated in subject, there is a blue bar on left side of the picture in
> certain conditions. I think that if broadcasting picture is smaller than the
> maximum picture viewable area, this happens. This problem was not shown in a
> channel, I have an example in my web page
> http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases, but
> it occurs on another channel, which I think is in different channel bunch.
> Problem in that channel is valid still.

Can you show us the messages from syslog which describe actual scaling
parameters?
Scaling parameters are usually reported after lines like:
... aspect changed (....

Stefan Lucke


From voitto.tuomainen at luukku.com  Mon Jun 13 16:40:33 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Mon, 13 Jun 2005 17:40:33 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the
 picture
Message-ID: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>

Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> 
> > Hi,
> > As stated in subject, there is a blue bar on left side of the picture in
> > certain conditions. I think that if broadcasting picture is smaller than
> the
> > maximum picture viewable area, this happens. This problem was not shown
> in a
> > channel, I have an example in my web page
> > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases,
> but
> > it occurs on another channel, which I think is in different channel bunch.
> > Problem in that channel is valid still.
> 
> Can you show us the messages from syslog which describe actual scaling
> parameters?
> Scaling parameters are usually reported after lines like:
> ... aspect changed (....
> 
> Stefan Lucke

Hi,
Following are lines, which printed to log during changing channels from 1 to 7. Third channel does not have blue bar, others have:
Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 13 17:07:30 miuvdr vdr[4762]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 17:07:35 miuvdr vdr[4770]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
Jun 13 17:07:39 miuvdr vdr[4776]: [VideoOut]: aspect changed (8 -> 8 ; 1.777778 -> 1.333333)
Jun 13 17:07:43 miuvdr vdr[4782]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)

When I booted PC (vdr starts at channel 3), I got 
Jun 13 16:41:55 miuvdr vdr[4282]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)

Then there are some other lines like
Jun 12 19:50:52 miuvdr vdr[4423]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 12 23:08:48 miuvdr vdr[4457]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)

And finally something, which maybe does not relate to this at all
Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for 'Xv startup aspect' in language 8 (suomi)


______
BR, Voitto

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From voitto.tuomainen at luukku.com  Mon Jun 13 16:40:33 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Mon, 13 Jun 2005 17:40:33 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the
 picture
Message-ID: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>

Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> 
> > Hi,
> > As stated in subject, there is a blue bar on left side of the picture in
> > certain conditions. I think that if broadcasting picture is smaller than
> the
> > maximum picture viewable area, this happens. This problem was not shown
> in a
> > channel, I have an example in my web page
> > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases,
> but
> > it occurs on another channel, which I think is in different channel bunch.
> > Problem in that channel is valid still.
> 
> Can you show us the messages from syslog which describe actual scaling
> parameters?
> Scaling parameters are usually reported after lines like:
> ... aspect changed (....
> 
> Stefan Lucke

Hi,
Following are lines, which printed to log during changing channels from 1 to 7. Third channel does not have blue bar, others have:
Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 13 17:07:30 miuvdr vdr[4762]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 17:07:35 miuvdr vdr[4770]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
Jun 13 17:07:39 miuvdr vdr[4776]: [VideoOut]: aspect changed (8 -> 8 ; 1.777778 -> 1.333333)
Jun 13 17:07:43 miuvdr vdr[4782]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)

When I booted PC (vdr starts at channel 3), I got 
Jun 13 16:41:55 miuvdr vdr[4282]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)

Then there are some other lines like
Jun 12 19:50:52 miuvdr vdr[4423]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 12 23:08:48 miuvdr vdr[4457]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)

And finally something, which maybe does not relate to this at all
Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for 'Xv startup aspect' in language 8 (suomi)


______
BR, Voitto

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From stefan at lucke.in-berlin.de  Mon Jun 13 18:45:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 13 Jun 2005 18:45:02 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>
References: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>
Message-ID: <200506131845.02856.stefan@lucke.in-berlin.de>

On Montag, 13. Juni 2005 16:40, Voitto Tuomainen wrote:
> Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> > Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> > 
> > > Hi,
> > > As stated in subject, there is a blue bar on left side of the picture in
> > > certain conditions. I think that if broadcasting picture is smaller than
> > the
> > > maximum picture viewable area, this happens. This problem was not shown
> > in a
> > > channel, I have an example in my web page
> > > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases,
> > but
> > > it occurs on another channel, which I think is in different channel bunch.
> > > Problem in that channel is valid still.
> > 
> > Can you show us the messages from syslog which describe actual scaling
> > parameters?
> > Scaling parameters are usually reported after lines like:
> > ... aspect changed (....
> > 
> > Stefan Lucke
> 
> Hi,
> Following are lines, which printed to log during changing channels from 1 to 7. Third channel does not have blue bar, others have:
> Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
> Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
> Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)

Just do a "grep -A 1 'aspect changed' /var/log/messages".
As stated above: scaling information is reported _after_ ..

> 
> And finally something, which maybe does not relate to this at all
> Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for 'Xv startup aspect' in language 8 (suomi)

If you like translations for your language, prepare a patch :-) . File of interest is i18n.c

Please subscribe. Maunal approve will cause delays.

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Mon Jun 13 18:45:02 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 13 Jun 2005 18:45:02 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>
References: <1118673633918.voitto.tuomainen.74440.nsoEK_cj4C45vS1qGqkPxg@luukku.com>
Message-ID: <200506131845.02856.stefan@lucke.in-berlin.de>

On Montag, 13. Juni 2005 16:40, Voitto Tuomainen wrote:
> Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> > Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> > 
> > > Hi,
> > > As stated in subject, there is a blue bar on left side of the picture in
> > > certain conditions. I think that if broadcasting picture is smaller than
> > the
> > > maximum picture viewable area, this happens. This problem was not shown
> > in a
> > > channel, I have an example in my web page
> > > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older releases,
> > but
> > > it occurs on another channel, which I think is in different channel bunch.
> > > Problem in that channel is valid still.
> > 
> > Can you show us the messages from syslog which describe actual scaling
> > parameters?
> > Scaling parameters are usually reported after lines like:
> > ... aspect changed (....
> > 
> > Stefan Lucke
> 
> Hi,
> Following are lines, which printed to log during changing channels from 1 to 7. Third channel does not have blue bar, others have:
> Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
> Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
> Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)

Just do a "grep -A 1 'aspect changed' /var/log/messages".
As stated above: scaling information is reported _after_ ..

> 
> And finally something, which maybe does not relate to this at all
> Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for 'Xv startup aspect' in language 8 (suomi)

If you like translations for your language, prepare a patch :-) . File of interest is i18n.c

Please subscribe. Maunal approve will cause delays.

-- 
Stefan Lucke



From prelude at kapsi.fi  Mon Jun 13 19:26:03 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Mon, 13 Jun 2005 20:26:03 +0300
Subject: [Softdevice-devel] Improvement suggestion (closing video & audio
 after keypress)
In-Reply-To: <42AD6399.8@e-dition.fr>
References: <Pine.LNX.4.62.0506131241170.30529@lakka> <42AD6399.8@e-dition.fr>
Message-ID: <42ADC1AB.2070301@kapsi.fi>

Nicolas Huillard wrote:

>Tommi Lundell a ?crit :
>  
>
>>Some times i want to look movies whit mplayer and/or use some other DFB
>>application and currently i need to stop whole VDR to do that. (Not fun
>>if you have some recordings waiting)
>>    
>>
>
>Do you use the DFB multi-application core ?
>With that feature, you should be able to launch many apps at the same
>time and display them on the screen. It is maybe useful to also suspend
>audio/video.
>You could also have problems with the LIRC stuff, which is totally
>independant of softdevice.
>I think your problem is more a good UI and ergonomics problem than a
>software problem. Can you explain a bit more how you launch mplayer and
>"other apps" and what you expect ?
>On the other hand, you could leave mplayer alone and use softplay to
>view other movies...
>  
>
Ouch..need to reconfigure my other mail client..other use my real name 
and other shows that "prelude" what i use in on line gaming nick.
Yes i use DFB multi-application core.
It can but because i use g400 TV out softdevice reserve whole output. So 
i got error if i try to run other application to that surface.
Normally i run mplayer/other apps from shell (ssh from laptop to my vdr 
machine).
I need to test that softplay someday when i got more time...It's a 
probably a correct solution to watch movies.
Anyway i believe that sometimes is handy to disconnect vdr from 
audio/video only pressing one key but maybe i'm wrong.



From prelude at kapsi.fi  Mon Jun 13 19:35:41 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Mon, 13 Jun 2005 20:35:41 +0300
Subject: [Softdevice-devel] Can't get composite sync from G450
In-Reply-To: <1118645220.42ad2be4102cc@webmail.in-berlin.de>
References: <42A33207.1070903@kapsi.fi> <1118392134.42a94f46ae115@webmail.in-berlin.de> <20050610171037.GB6749@localhost.localdomain> <200506102316.34994.stefan@lucke.in-berlin.de> <42AC4C43.4050506@kapsi.fi> <42ACB13F.4080202@e-dition.fr> <1118645220.42ad2be4102cc@webmail.in-berlin.de>
Message-ID: <42ADC3ED.7010507@kapsi.fi>

Stefan Lucke wrote:

> <>Quoting Nicolas Huillard :
>
> Thats what is done, if incoming stream is 4:3 and you set your display
> aspect to 4:3. If it does not do the "correct scaling" (tm) please
> post messages from your syslog where all scaling operation are logged.
>
>>>Incoming video is 720x486 -> make buffer to 720*576 size -> clear it ->
>>>blit video to that buffer whit 45 ((576-286)/2) lines offset.
>>>      
>>>
>
>Thats an unusual height. Where does it come from ?
>Scaling interlaced material with such height values is a bit problematic.
>
>  
>



Screen aspect is 4:3 in softdevice.

All ok:
Jun 13 19:02:12 eswd1333kara vdr[19669]: [VideoOut]: 720x576 [0,0 
720x576] -> 720x576 [0,0 720x576]
Something what i see often when i surf channells: (No resolution changes)
Jun 13 19:04:29 eswd1333kara vdr[19820]: [VideoOut]: aspect changed (8 
-> 0 ; 1.333333 -> 1.333333)

One recorded program from disk:
Jun 13 19:06:01 eswd1333kara vdr[19834]: [VideoOut]: aspect changed (0 
-> 8 ; 1.333333 -> 1.777778)
Jun 13 19:06:01 eswd1333kara vdr[19834]: [VideoOut]: 720x576 [0,0 
720x576] -> 720x576 [0,72 720x432]

When i looking recorded programs from disk cpu usage jumps form 35-38% 
(if osd is on 43-48%) to 54-59% (and sometimes it missed frames and 
audio is jerky)

Then log when i change channell 1 to channell 2 and back to 1. (Channell 
1 is ok and in channell 2 i see that screthblit effect)
Jun 13 19:13:59 eswd1333kara vdr[15053]: buffer stats: 20868 (10%) used
Jun 13 19:13:59 eswd1333kara vdr[19954]: [VideoOut]: aspect changed (8 
-> 8 ; 1.777778 -> 1.333333)
Jun 13 19:13:59 eswd1333kara vdr[19954]: [VideoOut]: 720x576 [0,0 
720x576] -> 720x576 [0,0 720x576]
Jun 13 19:14:00 eswd1333kara vdr[19950]: setting audio track to 1
Jun 13 19:14:00 eswd1333kara vdr[19955]: [softdevice-audio]: xrun
Jun 13 19:14:16 eswd1333kara vdr[15053]: switching to channel 2
Jun 13 19:14:16 eswd1333kara vdr[19950]: transfer thread ended 
(pid=19950, tid=4702222)
Jun 13 19:14:16 eswd1333kara vdr[15053]: buffer stats: 59972 (2%) used
Jun 13 19:14:16 eswd1333kara vdr[15053]: buffer stats: 0 (0%) used
Jun 13 19:14:16 eswd1333kara vdr[19956]: transfer thread started 
(pid=19956, tid=4800526)
Jun 13 19:14:16 eswd1333kara vdr[15053]: buffer stats: 10152 (5%) used
Jun 13 19:14:17 eswd1333kara vdr[19960]: [VideoOut]: aspect changed (8 
-> 8 ; 1.333333 -> 1.777778)
Jun 13 19:14:17 eswd1333kara vdr[19960]: [VideoOut]: 720x576 [0,0 
720x576] -> 720x576 [0,72 720x432]
Jun 13 19:14:17 eswd1333kara vdr[19956]: setting audio track to 1
Jun 13 19:14:18 eswd1333kara vdr[19961]: [softdevice-audio]: xrun
Jun 13 19:14:27 eswd1333kara vdr[15053]: switching to channel 1
Jun 13 19:14:27 eswd1333kara vdr[19956]: transfer thread ended 
(pid=19956, tid=4800526)
Jun 13 19:14:27 eswd1333kara vdr[15053]: buffer stats: 87420 (4%) used
Jun 13 19:14:27 eswd1333kara vdr[15053]: buffer stats: 0 (0%) used
Jun 13 19:14:27 eswd1333kara vdr[19962]: transfer thread started 
(pid=19962, tid=4898830)
Jun 13 19:14:27 eswd1333kara vdr[15053]: buffer stats: 11656 (6%) used
Jun 13 19:14:28 eswd1333kara vdr[19966]: [VideoOut]: aspect changed (8 
-> 8 ; 1.777778 -> 1.333333)
Jun 13 19:14:28 eswd1333kara vdr[19966]: [VideoOut]: 720x576 [0,0 
720x576] -> 720x576 [0,0 720x576]
Jun 13 19:14:28 eswd1333kara vdr[19962]: setting audio track to 1


Processes when i look live tv:
15053 root      16   0 97332  23m 5560 S  0.7  4.6   0:08.45 vdr
15054 root      16   0 97332  23m 5560 S  0.0  4.6   0:00.05 vdr
15055 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.01 vdr
15057 root      16   0 97332  23m 5560 S  0.0  4.6   0:00.50 vdr
15058 root      15   0 97332  23m 5560 S  0.7  4.6   5:16.24 vdr
15059 root      15   0 97332  23m 5560 S  0.0  4.6   0:01.70 vdr
15060 root       1 -15 97332  23m 5560 S  0.0  4.6   0:00.00 vdr
15061 root       0 -20 97332  23m 5560 S  0.0  4.6   0:00.00 vdr
15062 root      10 -10 97332  23m 5560 S  0.0  4.6   0:00.00 vdr
15063 root      10 -10 97332  23m 5560 S  0.0  4.6   0:00.00 vdr
15064 root      15   0 97332  23m 5560 S  0.0  4.6   0:04.15 vdr
15065 root      16   0 97332  23m 5560 S  0.0  4.6   0:00.14 vdr
15066 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.00 vdr
15067 root      15   0 97332  23m 5560 S  0.0  4.6   0:01.24 vdr
19923 root      15   0 97332  23m 5560 S  0.3  4.6   0:00.22 vdr
19926 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.65 vdr
19962 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.76 vdr
19963 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.18 vdr
19964 root      15   0 97332  23m 5560 S  0.3  4.6   0:00.54 vdr
19965 root      15   0 97332  23m 5560 S  0.0  4.6   0:00.50 vdr
19966 root      15   0 97332  23m 5560 S 36.3  4.6   2:01.71 vdr
19967 root      15   0 97332  23m 5560 S  3.0  4.6   0:06.77 vdr

and when i look recoring:
15053 root      16   0 99.2m  21m 5560 S  0.0  4.3   0:08.64 vdr
15054 root      16   0 99.2m  21m 5560 S  0.0  4.3   0:00.05 vdr
15055 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.01 vdr
15057 root      16   0 99.2m  21m 5560 S  0.0  4.3   0:00.50 vdr
15058 root      15   0 99.2m  21m 5560 S  0.3  4.3   5:16.70 vdr
15059 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:01.72 vdr
15060 root       1 -15 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
15061 root       0 -20 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
15062 root      10 -10 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
15063 root      10 -10 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
15064 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:04.15 vdr
15065 root      16   0 99.2m  21m 5560 S  0.0  4.3   0:00.14 vdr
15066 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
15067 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:01.24 vdr
19923 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.26 vdr
19926 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.77 vdr
19964 root      15   0 99.2m  21m 5560 S  0.3  4.3   0:00.74 vdr
20002 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
20003 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
20004 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.00 vdr
20005 root      16   0 99.2m  21m 5560 S  0.3  4.3   0:00.08 vdr
20006 root      16   0 99.2m  21m 5560 S 22.9  4.3   0:11.28 vdr
20007 root      15   0 99.2m  21m 5560 S  0.0  4.3   0:00.02 vdr
20008 root      15   0 99.2m  21m 5560 S 34.2  4.3   0:17.98 vdr
20009 root      15   0 99.2m  21m 5560 S  1.3  4.3   0:01.11 vdr

Ps. Dont look what user i use in tests ;-)

| Thats an unusual height. Where does it come from ?

| Scaling interlaced material with such height values is a bit problematic.

And that unusual video height (720x486) coming from my home made videos.

I dont understand why that need to be a scaled..Maybe i miss something :-/



From stefan at lucke.in-berlin.de  Tue Jun 14 07:25:27 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 14 Jun 2005 07:25:27 +0200
Subject: Scaling with unusual source resolution WAS(Re: [Softdevice-devel] Can't get composite sync from G450)
Message-ID: <200506140725.28021.stefan@lucke.in-berlin.de>

On Montag, 13. Juni 2005 19:35, Tommi Lundell wrote:
> Stefan Lucke wrote:
> 
> > <>Quoting Nicolas Huillard :
> >
> > Thats what is done, if incoming stream is 4:3 and you set your display
> > aspect to 4:3. If it does not do the "correct scaling" (tm) please
> > post messages from your syslog where all scaling operation are logged.
> >
> >>>Incoming video is 720x486 -> make buffer to 720*576 size -> clear it ->
> >>>blit video to that buffer whit 45 ((576-286)/2) lines offset.
> >>>      
> >>>
> >
> >Thats an unusual height. Where does it come from ?
> >Scaling interlaced material with such height values is a bit problematic.
> >

> 
> 
> Screen aspect is 4:3 in softdevice.
> 
> All ok:
> Jun 13 19:02:12 eswd1333kara vdr[19669]: [VideoOut]: 720x576 [0,0 
> 720x576] -> 720x576 [0,0 720x576]
> Something what i see often when i surf channells: (No resolution changes)
> Jun 13 19:04:29 eswd1333kara vdr[19820]: [VideoOut]: aspect changed (8 
> -> 0 ; 1.333333 -> 1.333333)
> 
> One recorded program from disk:
> Jun 13 19:06:01 eswd1333kara vdr[19834]: [VideoOut]: aspect changed (0 
> -> 8 ; 1.333333 -> 1.777778)
> Jun 13 19:06:01 eswd1333kara vdr[19834]: [VideoOut]: 720x576 [0,0 
> 720x576] -> 720x576 [0,72 720x432]

That looks ok.

> 
> | Thats an unusual height. Where does it come from ?
> 
> | Scaling interlaced material with such height values is a bit problematic.
> 
> And that unusual video height (720x486) coming from my home made videos.
> 
> I dont understand why that need to be a scaled..Maybe i miss something :-/

I was interested in getting scaling info of that unusual height. You can override
scaling via OSD (or map that to a user defined key).

-- 
Stefan Lucke



From voitto.tuomainen at luukku.com  Tue Jun 14 09:50:04 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Tue, 14 Jun 2005 10:50:04 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the
 picture
Message-ID: <1118735404268.voitto.tuomainen.19764.eBIa5AiSqxs0JCLl1Tdxpg@luukku.com>

Stefan Lucke kirjoitti 13.06.2005 kello 19:45:
> On Montag, 13. Juni 2005 16:40, Voitto Tuomainen wrote:
> > Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> > > Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> > > 
> > > > Hi,
> > > > As stated in subject, there is a blue bar on left side of the picture
> in
> > > > certain conditions. I think that if broadcasting picture is smaller
> than
> > > the
> > > > maximum picture viewable area, this happens. This problem was not
> shown
> > > in a
> > > > channel, I have an example in my web page
> > > > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older
> releases,
> > > but
> > > > it occurs on another channel, which I think is in different channel
> bunch.
> > > > Problem in that channel is valid still.
> > > 
> > > Can you show us the messages from syslog which describe actual scaling
> > > parameters?
> > > Scaling parameters are usually reported after lines like:
> > > ... aspect changed (....
> > > 
> > > Stefan Lucke
> > 
> > Hi,
> > Following are lines, which printed to log during changing channels from 1
> to 7. Third channel does not have blue bar, others have:
> > Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ;
> 1.333333 -> 1.333333)
> > Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ;
> 1.333333 -> 1.333333)
> > Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ;
> 1.333333 -> 1.333333)
> 
> Just do a "grep -A 1 'aspect changed' /var/log/messages".
> As stated above: scaling information is reported _after_ ..
> 
> > 
> > And finally something, which maybe does not relate to this at all
> > Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for
> 'Xv startup aspect' in language 8 (suomi)
> 
> If you like translations for your language, prepare a patch :-) .
>  File of
> interest is i18n.c
> 
> Please subscribe. Maunal approve will cause delays.
> 
> -- 
> Stefan Lucke
> 
Hi,
I didn't read carefully your last message. But here are the results:

Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [0,0 1280x719]
--
Jun 13 23:11:47 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ; 1.777778 -> 1.333333)
Jun 13 23:11:47 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:12:23 miuvdr vdr[4296]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 13 23:12:23 miuvdr vdr[4296]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [0,0 1280x719]
--
Jun 13 23:21:59 miuvdr vdr[4304]: [VideoOut]: aspect changed (0 -> 0 ; 1.777778 -> 1.333333)
Jun 13 23:21:59 miuvdr vdr[4304]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:24:30 miuvdr vdr[4311]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 23:24:30 miuvdr vdr[4312]: [softdevice-audio]: xrun
--
Jun 14 07:30:04 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 07:30:04 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 14 10:12:08 miuvdr vdr[4336]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 10:12:08 miuvdr vdr[4336]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 14 10:12:41 miuvdr vdr[4342]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:12:41 miuvdr vdr[4320]: changing pids of channel 2 from 513+129:660=sve:2321 to 513+129:660=fin:2321
--
Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]
--
Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
--
Jun 14 10:13:00 miuvdr vdr[4359]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:13:00 miuvdr vdr[4360]: [softdevice-audio]: xrun
--
Jun 14 10:13:15 miuvdr vdr[4379]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:13:16 miuvdr vdr[4380]: [softdevice-audio]: xrun
--
Jun 14 10:13:21 miuvdr vdr[4384]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:13:21 miuvdr vdr[4320]: channel 8 (Urheilukanava) event 09:00 'Ostoskanava' status 4
--
Jun 14 10:13:25 miuvdr vdr[4392]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:13:25 miuvdr vdr[4392]: [VideoOut]: 704x576 [0,0 704x576] -> 768x576 [0,0 768x575]


And in addition I printed some last VideoOuts:

Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: resolution changed: W(736 -> 720); H(576 ->576)
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:15 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:15 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:25 miuvdr vdr[4907]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.777778)
Jun 14 10:23:25 miuvdr vdr[4907]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]
Jun 14 10:25:42 miuvdr vdr[4939]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
Jun 14 10:25:42 miuvdr vdr[4939]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 10:25:44 miuvdr vdr[4944]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:25:58 miuvdr vdr[4964]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:26:02 miuvdr vdr[4969]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: resolution changed: W(720 -> 704); H(576 ->576)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: 704x576 [0,0 704x576] -> 768x576 [0,0 768x575]

______
BR, Voitto

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From voitto.tuomainen at luukku.com  Tue Jun 14 09:50:04 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Tue, 14 Jun 2005 10:50:04 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the
 picture
Message-ID: <1118735404268.voitto.tuomainen.19764.eBIa5AiSqxs0JCLl1Tdxpg@luukku.com>

Stefan Lucke kirjoitti 13.06.2005 kello 19:45:
> On Montag, 13. Juni 2005 16:40, Voitto Tuomainen wrote:
> > Stefan Lucke kirjoitti 13.06.2005 kello 15:22:
> > > Quoting Voitto Tuomainen <voitto.tuomainen at luukku.com>:
> > > 
> > > > Hi,
> > > > As stated in subject, there is a blue bar on left side of the picture
> in
> > > > certain conditions. I think that if broadcasting picture is smaller
> than
> > > the
> > > > maximum picture viewable area, this happens. This problem was not
> shown
> > > in a
> > > > channel, I have an example in my web page
> > > > http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older
> releases,
> > > but
> > > > it occurs on another channel, which I think is in different channel
> bunch.
> > > > Problem in that channel is valid still.
> > > 
> > > Can you show us the messages from syslog which describe actual scaling
> > > parameters?
> > > Scaling parameters are usually reported after lines like:
> > > ... aspect changed (....
> > > 
> > > Stefan Lucke
> > 
> > Hi,
> > Following are lines, which printed to log during changing channels from 1
> to 7. Third channel does not have blue bar, others have:
> > Jun 13 17:07:13 miuvdr vdr[4737]: [VideoOut]: aspect changed (8 -> 0 ;
> 1.333333 -> 1.333333)
> > Jun 13 17:07:21 miuvdr vdr[4745]: [VideoOut]: aspect changed (0 -> 8 ;
> 1.333333 -> 1.333333)
> > Jun 13 17:07:27 miuvdr vdr[4757]: [VideoOut]: aspect changed (8 -> 0 ;
> 1.333333 -> 1.333333)
> 
> Just do a "grep -A 1 'aspect changed' /var/log/messages".
> As stated above: scaling information is reported _after_ ..
> 
> > 
> > And finally something, which maybe does not relate to this at all
> > Jun 11 23:54:11 miuvdr vdr[4322]: softdevice: no translation found for
> 'Xv startup aspect' in language 8 (suomi)
> 
> If you like translations for your language, prepare a patch :-) .
>  File of
> interest is i18n.c
> 
> Please subscribe. Maunal approve will cause delays.
> 
> -- 
> Stefan Lucke
> 
Hi,
I didn't read carefully your last message. But here are the results:

Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [0,0 1280x719]
--
Jun 13 23:11:47 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ; 1.777778 -> 1.333333)
Jun 13 23:11:47 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:12:23 miuvdr vdr[4296]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
Jun 13 23:12:23 miuvdr vdr[4296]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [0,0 1280x719]
--
Jun 13 23:21:59 miuvdr vdr[4304]: [VideoOut]: aspect changed (0 -> 0 ; 1.777778 -> 1.333333)
Jun 13 23:21:59 miuvdr vdr[4304]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 13 23:24:30 miuvdr vdr[4311]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 13 23:24:30 miuvdr vdr[4312]: [softdevice-audio]: xrun
--
Jun 14 07:30:04 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 07:30:04 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 14 10:12:08 miuvdr vdr[4336]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 10:12:08 miuvdr vdr[4336]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
--
Jun 14 10:12:41 miuvdr vdr[4342]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:12:41 miuvdr vdr[4320]: changing pids of channel 2 from 513+129:660=sve:2321 to 513+129:660=fin:2321
--
Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]
--
Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
--
Jun 14 10:13:00 miuvdr vdr[4359]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:13:00 miuvdr vdr[4360]: [softdevice-audio]: xrun
--
Jun 14 10:13:15 miuvdr vdr[4379]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:13:16 miuvdr vdr[4380]: [softdevice-audio]: xrun
--
Jun 14 10:13:21 miuvdr vdr[4384]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:13:21 miuvdr vdr[4320]: channel 8 (Urheilukanava) event 09:00 'Ostoskanava' status 4
--
Jun 14 10:13:25 miuvdr vdr[4392]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:13:25 miuvdr vdr[4392]: [VideoOut]: 704x576 [0,0 704x576] -> 768x576 [0,0 768x575]


And in addition I printed some last VideoOuts:

Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:11 miuvdr vdr[4892]: [VideoOut]: 736x576 [0,0 736x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: resolution changed: W(736 -> 720); H(576 ->576)
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 10:23:12 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:15 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 10:23:15 miuvdr vdr[4901]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 10:23:25 miuvdr vdr[4907]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.777778)
Jun 14 10:23:25 miuvdr vdr[4907]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]
Jun 14 10:25:42 miuvdr vdr[4939]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
Jun 14 10:25:42 miuvdr vdr[4939]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 10:25:44 miuvdr vdr[4944]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:25:58 miuvdr vdr[4964]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:26:02 miuvdr vdr[4969]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: resolution changed: W(720 -> 704); H(576 ->576)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 10:26:06 miuvdr vdr[4977]: [VideoOut]: 704x576 [0,0 704x576] -> 768x576 [0,0 768x575]

______
BR, Voitto

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From stefan at lucke.in-berlin.de  Tue Jun 14 10:59:34 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 14 Jun 2005 10:59:34 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <1118735404268.voitto.tuomainen.19764.eBIa5AiSqxs0JCLl1Tdxpg@luukku.com>
References: <1118735404268.voitto.tuomainen.19764.eBIa5AiSqxs0JCLl1Tdxpg@luukku.com>
Message-ID: <1118739574.42ae9c767896f@webmail.in-berlin.de>

Quoting Voitto Tuomainen:
> Hi,
> I didn't read carefully your last message. But here are the results:
>
> Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
> Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]

> Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ; 1.333333 -> 1.777778)
> Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [0,0 1280x719]

Seems to be a small rounding issue 719 should be 720 as height, and xoffset 159
should be even too (158).

> Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
> Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]

> Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
> Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]

Again rounding.

Did you set the monitor aspect correct ? Even when X11 provides us with some
physical geometry dimensions, these are not allways correct. I've to set mine
to 5:4 for my 1280x1024 lcd monitor too, to avoid some rounding gliches.

In which of the your mailed/above cases do you see the blue vertical bar ??

Stefan Lucke


From voitto.tuomainen at luukku.com  Tue Jun 14 16:46:43 2005
From: voitto.tuomainen at luukku.com (Voitto Tuomainen)
Date: Tue, 14 Jun 2005 17:46:43 +0300 (EEST)
Subject: [Softdevice-devel] Blue vertical bar on left side of the
 picture
Message-ID: <1118760403659.voitto.tuomainen.71713.A0nkb9Gt3-h8bsiqc0nMvw@luukku.com>

Stefan Lucke kirjoitti 14.06.2005 kello 11:59:
> Quoting Voitto Tuomainen:
> > Hi,
> > I didn't read carefully your last message. But here are the results:
> >
> > Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: aspect changed (-100 -> 0 ;
> -100.000000 -> 1.333333)
> > Jun 13 22:58:26 miuvdr vdr[4279]: [VideoOut]: 720x576 [0,0 720x576] ->
> 1280x720 [159,0 962x720]
> 
> > Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: aspect changed (0 -> 0 ;
> 1.333333 -> 1.777778)
> > Jun 13 23:00:06 miuvdr vdr[4291]: [VideoOut]: 720x576 [0,0 720x576] ->
> 1280x720 [0,0 1280x719]
> 
> Seems to be a small rounding issue 719 should be 720 as height, and
>  xoffset
> 159
> should be even too (158).
> 
> > Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: aspect changed (8 -> 8 ;
> 1.333333 -> 1.777778)
> > Jun 14 10:12:47 miuvdr vdr[4348]: [VideoOut]: 720x576 [0,0 720x576] ->
> 768x576 [0,72 768x431]
> 
> > Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: aspect changed (8 -> 0 ;
> 1.777778 -> 1.333333)
> > Jun 14 10:12:53 miuvdr vdr[4354]: [VideoOut]: 720x576 [0,0 720x576] ->
> 768x576 [0,0 768x575]
> 
> Again rounding.
> 
> Did you set the monitor aspect correct ? Even when X11 provides us
>  with some
> physical geometry dimensions, these are not allways correct. I've to set
> mine
> to 5:4 for my 1280x1024 lcd monitor too, to avoid some rounding gliches.
> 
> In which of the your mailed/above cases do you see the blue vertical
>  bar ??
> 
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/softdevice-devel

Hi,
I don't remember which one is which. So I did one more experiment.

My softdevice configuration is such, that
Xv startup aspect: 4:3 normal
Screen Aspect: Default
- if I change any of above, they did not change the situation


My plasma does not give proper modelines using DDC, so it must be set by hand in xorg.conf. Mine is
Modeline "1280x720_50" 74.25 1280 1360 1872 1976 720 725 730 750 -hsync -vsync


Here is log from last time I started vdr. Channel 3 does not have bar on left side or at least it is not visible.

Jun 14 16:39:01 miuvdr vdr[4293]: switching to channel 3
Jun 14 16:39:01 miuvdr vdr[4311]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 16:39:01 miuvdr vdr[4311]: [VideoOut]: 736x576 [0,0 736x576] -> 768x576 [0,0 768x575]
Jun 14 16:39:01 miuvdr vdr[4311]: [VideoOut]: 736x576 [0,0 736x576] -> 1280x720 [159,0 962x720]
Jun 14 16:39:02 miuvdr vdr[4293]: creating directory /vtx/T-8438-8193-49
Jun 14 16:39:02 miuvdr vdr[4313]: transfer thread started (pid=4313, tid=163851)
Jun 14 16:39:02 miuvdr vdr[4314]: receiver on device 1 thread started (pid=4314, tid=180236)
Jun 14 16:39:02 miuvdr vdr[4317]: TS buffer on device 1 thread started (pid=4317, tid=229391)
Jun 14 16:39:02 miuvdr vdr[4303]: channel 3 (MTV3) event 00:45 'MTV3 Chat' status 4
Jun 14 16:39:02 miuvdr vdr[4303]: channel 4 (Nelonen) event 15:50 'Felicity' status 4
Jun 14 16:39:02 miuvdr vdr[4303]: channel 7 (Subtv) event 16:35 'Ritari ?ss?' status 4
Jun 14 16:39:02 miuvdr vdr[4303]: channel 9 (MTV3+) event 16:15 'Polttopallo' status 4
Jun 14 16:39:02 miuvdr vdr[4303]: channel 10 (Nelonen Plus) event 16:00 'Mobiilipeli: Blockate' status 4
Jun 14 16:39:03 miuvdr vdr[4313]: setting audio track to 1
Jun 14 16:39:03 miuvdr vdr[4319]: [VideoOut]: resolution changed: W(736 -> 720); H(576 ->576)
Jun 14 16:39:03 miuvdr vdr[4319]: [VideoOut]: aspect changed (-100 -> 0 ; -100.000000 -> 1.333333)
Jun 14 16:39:03 miuvdr vdr[4319]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 16:39:03 miuvdr vdr[4320]: [softdevice-audio] samplerate: 48000Hz, channels: #2
Jun 14 16:39:03 miuvdr vdr[4320]: [softdevice-audio] Period size 1152 Buffer size 9216
Jun 14 16:39:03 miuvdr vdr[4320]: [softdevice-audio] Hardware initialized
Jun 14 16:39:03 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:39:05 miuvdr vdr[4319]: [VideoOut]: 720x576 [0,0 720x576] -> 1280x720 [159,0 962x720]
Jun 14 16:39:05 miuvdr vdr[4319]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 16:39:08 miuvdr vdr[4293]: assuming manual start of VDR
Jun 14 16:39:09 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:39:11 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:39:13 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:39:37 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:39:59 miuvdr vdr[4303]: channel 4 (Nelonen) event 16:40 'P?ivien viem??' status 4
Jun 14 16:40:02 miuvdr vdr[4320]: [softdevice-audio]: xrun
Jun 14 16:40:13 miuvdr vdr[4293]: switching to channel 1
Jun 14 16:40:13 miuvdr vdr[4313]: transfer thread ended (pid=4313, tid=163851)
Jun 14 16:40:13 miuvdr vdr[4293]: buffer stats: 131412 (6%) used
Jun 14 16:40:13 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:14 miuvdr vdr[4339]: transfer thread started (pid=4339, tid=294923)
Jun 14 16:40:14 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:14 miuvdr vdr[4293]: creating directory /vtx/T-8438-4097-17
Jun 14 16:40:14 miuvdr vdr[4303]: channel 13 (YLE FSR+) event 16:15 'Vega: Inblick + Rapido' status 4
Jun 14 16:40:14 miuvdr vdr[4303]: channel 5 (YLE Teema) event 09:00 'Ei esityst?' status 4
Jun 14 16:40:14 miuvdr vdr[4303]: channel 1 (YLE TV1) event 16:05 'Murhasta tuli totta' status 4
Jun 14 16:40:14 miuvdr vdr[4303]: channel 17 (YLE PEILI) event 04:30 'Clazz radio 2' status 4
Jun 14 16:40:14 miuvdr vdr[4303]: channel 2 (YLE TV2) event 15:55 'TV2: Summeri' status 4
Jun 14 16:40:15 miuvdr vdr[4303]: channel 15 (YLEQ) event 15:02 'P?iv? Kuussa. Marce Rendic. www.yleq.fi.' status 4
Jun 14 16:40:15 miuvdr vdr[4303]: changing pids of channel 2 from 513+129:660=sve:2321 to 513+129:660=fin:2321
Jun 14 16:40:15 miuvdr vdr[4303]: channel 12 (YLE FST) event 09:00 'Jakten p? Mauritius' status 4
Jun 14 16:40:15 miuvdr vdr[4303]: channel 18 (YLEN KLASSINEN) event 12:00 'P?iv?klassinen.' status 4
Jun 14 16:40:15 miuvdr vdr[4303]: channel 6 (YLE24) event 16:10 'Euronews' status 4
Jun 14 16:40:15 miuvdr vdr[4343]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 16:40:15 miuvdr vdr[4339]: setting audio track to 1
Jun 14 16:40:16 miuvdr vdr[4303]: changing pids of channel 5 from 516+132:690=fra:2321 to 516+132:690=fin:2321
Jun 14 16:40:16 miuvdr vdr[4344]: [softdevice-audio]: xrun
Jun 14 16:40:17 miuvdr vdr[4293]: switching to channel 2
Jun 14 16:40:17 miuvdr vdr[4339]: transfer thread ended (pid=4339, tid=294923)
Jun 14 16:40:17 miuvdr vdr[4293]: buffer stats: 109416 (5%) used
Jun 14 16:40:17 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:17 miuvdr vdr[4345]: transfer thread started (pid=4345, tid=393227)
Jun 14 16:40:17 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:17 miuvdr vdr[4293]: creating directory /vtx/T-8438-4097-33
Jun 14 16:40:18 miuvdr vdr[4349]: [VideoOut]: aspect changed (8 -> 8 ; 1.333333 -> 1.777778)
Jun 14 16:40:18 miuvdr vdr[4349]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x431]
Jun 14 16:40:18 miuvdr vdr[4345]: setting audio track to 1
Jun 14 16:40:19 miuvdr vdr[4350]: [softdevice-audio]: xrun
Jun 14 16:40:19 miuvdr vdr[4293]: switching to channel 3
Jun 14 16:40:19 miuvdr vdr[4345]: transfer thread ended (pid=4345, tid=393227)
Jun 14 16:40:20 miuvdr vdr[4293]: buffer stats: 104152 (4%) used
Jun 14 16:40:20 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:20 miuvdr vdr[4351]: transfer thread started (pid=4351, tid=491531)
Jun 14 16:40:20 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:21 miuvdr vdr[4355]: [VideoOut]: aspect changed (8 -> 0 ; 1.777778 -> 1.333333)
Jun 14 16:40:21 miuvdr vdr[4355]: [VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,0 768x575]
Jun 14 16:40:21 miuvdr vdr[4351]: setting audio track to 1
Jun 14 16:40:21 miuvdr vdr[4356]: [softdevice-audio]: xrun
Jun 14 16:40:22 miuvdr vdr[4356]: [softdevice-audio]: xrun
Jun 14 16:40:23 miuvdr vdr[4293]: switching to channel 4
Jun 14 16:40:23 miuvdr vdr[4351]: transfer thread ended (pid=4351, tid=491531)
Jun 14 16:40:23 miuvdr vdr[4293]: buffer stats: 135924 (6%) used
Jun 14 16:40:23 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:23 miuvdr vdr[4357]: transfer thread started (pid=4357, tid=589835)
Jun 14 16:40:23 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:23 miuvdr vdr[4293]: creating directory /vtx/T-8438-8193-65
Jun 14 16:40:24 miuvdr vdr[4357]: setting audio track to 1
Jun 14 16:40:24 miuvdr vdr[4360]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 16:40:24 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:24 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:25 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:25 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:25 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:26 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:27 miuvdr vdr[4361]: [softdevice-audio]: xrun
Jun 14 16:40:27 miuvdr vdr[4293]: switching to channel 5
Jun 14 16:40:27 miuvdr vdr[4357]: transfer thread ended (pid=4357, tid=589835)
Jun 14 16:40:28 miuvdr vdr[4293]: buffer stats: 119944 (5%) used
Jun 14 16:40:28 miuvdr vdr[4317]: TS buffer on device 1 thread ended (pid=4317, tid=229391)
Jun 14 16:40:28 miuvdr vdr[4314]: buffer stats: 145136 (6%) used
Jun 14 16:40:28 miuvdr vdr[4314]: receiver on device 1 thread ended (pid=4314, tid=180236)
Jun 14 16:40:28 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:28 miuvdr vdr[4293]: creating directory /vtx/T-8438-4097-145
Jun 14 16:40:28 miuvdr vdr[4362]: transfer thread started (pid=4362, tid=671755)
Jun 14 16:40:28 miuvdr vdr[4363]: receiver on device 1 thread started (pid=4363, tid=688140)
Jun 14 16:40:28 miuvdr vdr[4367]: TS buffer on device 1 thread started (pid=4367, tid=753680)
Jun 14 16:40:30 miuvdr vdr[4362]: setting audio track to 1
Jun 14 16:40:30 miuvdr vdr[4369]: [softdevice-audio]: xrun
Jun 14 16:40:31 miuvdr vdr[4293]: switching to channel 6
Jun 14 16:40:31 miuvdr vdr[4362]: transfer thread ended (pid=4362, tid=671755)
Jun 14 16:40:31 miuvdr vdr[4293]: buffer stats: 95880 (4%) used
Jun 14 16:40:31 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:31 miuvdr vdr[4370]: transfer thread started (pid=4370, tid=802827)
Jun 14 16:40:31 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:31 miuvdr vdr[4293]: creating directory /vtx/T-8438-4097-129
Jun 14 16:40:32 miuvdr vdr[4370]: setting audio track to 1
Jun 14 16:40:33 miuvdr vdr[4375]: [softdevice-audio]: xrun
Jun 14 16:40:35 miuvdr vdr[4303]: changing pids of channel 1 from 512+128:650=fin:2321 to 512+128:650=eng,652=dut:2321
Jun 14 16:40:35 miuvdr vdr[4293]: switching to channel 7
Jun 14 16:40:35 miuvdr vdr[4370]: transfer thread ended (pid=4370, tid=802827)
Jun 14 16:40:35 miuvdr vdr[4293]: buffer stats: 97948 (4%) used
Jun 14 16:40:35 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:36 miuvdr vdr[4376]: transfer thread started (pid=4376, tid=901131)
Jun 14 16:40:36 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:36 miuvdr vdr[4293]: creating directory /vtx/T-8438-8193-97
Jun 14 16:40:37 miuvdr vdr[4376]: setting audio track to 1
Jun 14 16:40:37 miuvdr vdr[4380]: [VideoOut]: aspect changed (8 -> 0 ; 1.333333 -> 1.333333)
Jun 14 16:40:37 miuvdr vdr[4381]: [softdevice-audio]: xrun
Jun 14 16:40:39 miuvdr vdr[4293]: switching to channel 8
Jun 14 16:40:39 miuvdr vdr[4376]: transfer thread ended (pid=4376, tid=901131)
Jun 14 16:40:39 miuvdr vdr[4293]: buffer stats: 104528 (4%) used
Jun 14 16:40:39 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:40 miuvdr vdr[4382]: transfer thread started (pid=4382, tid=999435)
Jun 14 16:40:40 miuvdr vdr[4293]: buffer stats: 0 (0%) used
Jun 14 16:40:40 miuvdr vdr[4293]: creating directory /vtx/T-8438-12289-113
Jun 14 16:40:40 miuvdr vdr[4303]: channel 19 (CANAL+ Finland) event 16:15 'Willard' status 4
Jun 14 16:40:40 miuvdr vdr[4303]: channel 20 (CANAL+ FILM 1) event 14:40 '21 grammaa' status 4
Jun 14 16:40:40 miuvdr vdr[4303]: channel 8 (Urheilukanava) event 16:00 'Veikkauskanava' status 4
Jun 14 16:40:40 miuvdr vdr[4303]: channel 21 (CANAL+ FILM 2) event 16:40 'Ken sutta pelk??' status 4
Jun 14 16:40:40 miuvdr vdr[4303]: channel 22 (CANAL+ SPORT) event 16:40 'Allsvenskan: Helsingborg - Malm?' status 4
Jun 14 16:40:40 miuvdr vdr[4385]: [VideoOut]: aspect changed (0 -> 8 ; 1.333333 -> 1.333333)
Jun 14 16:40:41 miuvdr vdr[4382]: setting audio track to 1
Jun 14 16:40:42 miuvdr vdr[4386]: [softdevice-audio]: xrun

______
BR, Voitto

...................................................................
Luukku Plus paketilla p??set eroon tila- ja turvallisuusongelmista.
Hanki Luukku Plus ja helpotat el?m??si. http://www.mtv3.fi/luukku



From M.Wache at gmx.net  Tue Jun 14 18:12:02 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Tue, 14 Jun 2005 18:12:02 +0200
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com>
References: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com>
Message-ID: <42AF01D2.5030605@gmx.net>

Voitto Tuomainen schrieb:
> Hi,
> As stated in subject, there is a blue bar on left side of the picture in certain conditions. 
> I think that if broadcasting picture is smaller than the maximum
picture viewable area, this
> happens. This problem was not shown in a channel, I have an example in
my web page
> http://kotisivu.mtv3.fi/vtuomain/blue_bar.jpg in 0.1.2 or older
releases, but it occurs on
> another channel, which I think is in different channel bunch. Problem
in that channel is valid
> still.
> 
> My configuration is vdr 1.3.25, softdevice xv, FFMpeg-20050609, 
> gentoo with one week old software and Technisat Airstar2 DVB-T PCI.
> Picture is sent to plasma through Sapphire Radeon 9600 DVI connection.

I may be wrong but I think this blue bar is coded in the mpeg stream and
not shown by the TVs due to the overscan. As far as I know televisions
don't show the complete picture which is sent to them (the reason for
this is that it is transfered analogous, so there are disortions at the
edges, which they just cut away). The softdevice in Xv mode doesn't do
this, it shows the complete picture.

So I think a cropping mode which emulates the overscan is the correct
solution for this.

Martin


From marko.makela at hut.fi  Tue Jun 14 20:14:42 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Tue, 14 Jun 2005 21:14:42 +0300
Subject: [Softdevice-devel] Blue vertical bar on left side of the picture
In-Reply-To: <42AF01D2.5030605@gmx.net>
References: <1118656357618.voitto.tuomainen.35574.jNJmWzZLpSsArLhHaf8Xjw@luukku.com> <42AF01D2.5030605@gmx.net>
Message-ID: <20050614181442.GD3369@localhost.localdomain>

On Tue, Jun 14, 2005 at 06:12:02PM +0200, Martin Wache wrote:
> I may be wrong but I think this blue bar is coded in the mpeg stream and
> not shown by the TVs due to the overscan.

I just verified this by recording a couple of seconds from a blue-bar
channel and viewing the 001.vdr file in a MPlayer window on another
computer.  Maybe this blue bar has something to do with the color burst
in PAL signal?  Many Commodore computers output a white vertical bar at
the very left of the image.

This is not the only imperfection you can see near the edges.  I've been
recording an old animated series for my 2-year-old son.  It's from the
analog times in 4:3 format, and there is a black vertical bar at the
left of the picture.  However, when it scrolls credits at the bottom of
the screen, the left-hand-side of the credits will overwrite that black
bar.

This reminds me from the Commodore times: I used to view demos with all
overscan areas visible.  Most rasterbar effects had imperfections in
the horizontal borders.

You're just not supposed to see the overscan area.  A (preferrably
per-channel) configureable cropping mode would be the solution if you
can't make the bar disappear by touching the monitor settings.  The bar
doesn't disturb me too much, as I'm using an old 14" VGA monitor.

	Marko


From marko.makela at hut.fi  Wed Jun 15 20:09:25 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Wed, 15 Jun 2005 21:09:25 +0300
Subject: [Softdevice-devel] How to link libsoftdevice.a?
In-Reply-To: <42AC9E55.1000000@gmx.net>
References: <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain> <20050612063306.GA3230@localhost.localdomain> <20050612112425.GA251025@kosh.hut.fi> <1118577660.5424.4.camel@localhost> <42AC71A5.70702@gmx.net> <20050612175745.GC3239@localhost.localdomain> <42AC9E55.1000000@gmx.net>
Message-ID: <20050615180925.GB3245@localhost.localdomain>

Martin,

> Sure, find attached the patch I already sent the last time, I assume not
> much changed from the old vdr version, so it should apply also to more
> recent vdr version.

The patch to plugin.c is still valid, but the Makefile seems to have
changed a little (or your diffs were based on a modified copy).

> You will have to modify vdr's makefile to link statically to the
> softdevice. As far as I remember I created a .a library with all the
> needed files from the softdevice and linked this to vdr.

This is problematic for me.  I keep getting tons of "undefined
reference" errors when trying to link libsoftdevice.a.  Alternatively,
I keep getting an error about -ldfb++ not being found (it only exists
as .so, and I can't figure out how to convince libtool or other
autotools-generated scripts and makefiles to create an .a for me).

	Marko


From M.Wache at gmx.net  Thu Jun 16 18:09:26 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 16 Jun 2005 18:09:26 +0200
Subject: [Softdevice-devel] How to link libsoftdevice.a?
In-Reply-To: <20050615180925.GB3245@localhost.localdomain>
References: <1118455890.3151.80.camel@africa> <20050611101048.GA3225@localhost.localdomain> <200506111328.15441.stefan@lucke.in-berlin.de> <20050611133706.GB3359@localhost.localdomain> <20050612063306.GA3230@localhost.localdomain> <20050612112425.GA251025@kosh.hut.fi> <1118577660.5424.4.camel@localhost> <42AC71A5.70702@gmx.net> <20050612175745.GC3239@localhost.localdomain> <42AC9E55.1000000@gmx.net> <20050615180925.GB3245@localhost.localdomain>
Message-ID: <42B1A436.3020605@gmx.net>

Marko M?kel? schrieb:
>>You will have to modify vdr's makefile to link statically to the
>>softdevice. As far as I remember I created a .a library with all the
>>needed files from the softdevice and linked this to vdr.
> 
> 
> This is problematic for me.  I keep getting tons of "undefined
> reference" errors when trying to link libsoftdevice.a.  Alternatively,
> I keep getting an error about -ldfb++ not being found (it only exists
> as .so, and I can't figure out how to convince libtool or other
> autotools-generated scripts and makefiles to create an .a for me).
> 
I did this only for xv-out and as far as I remember I just linked the
X11 .so libraries dynamicly to vdr (so they weren't included in
libsoftdevice.a)
Well, this is all just one big hack, but it worked for me ;-)

Martin


From linuxtvmaker at yahoo.es  Fri Jun 17 10:11:13 2005
From: linuxtvmaker at yahoo.es (Rose M)
Date: Fri, 17 Jun 2005 10:11:13 +0200 (CEST)
Subject: [Softdevice-devel] Problem running vdr+softdevice
Message-ID: <20050617081113.92527.qmail@web26301.mail.ukl.yahoo.com>

Hello,

I'm trying to use vdr with softdevice but I only have
this output when I run them:

./vdr -Psoftdevice
[softdevice] processing args
[softdevice]   argv [0] = softdevice
Segmentation fault

I'm using Fedora Core 3 with kernel 2.6.11.11, I've
tried the last version of softdevice and 0.1.0, but no
changes. I've configurated softdevice with framebuffer
and DirectFB, but both same results. Why it could
happen?
I would post it in vdr too.
Any idea would be wellcomed,
Thanks in advance,

Rose M



		
______________________________________________ 
Renovamos el Correo Yahoo! 
Nuevos servicios, m?s seguridad 
http://correo.yahoo.es


From nhuillard at e-dition.fr  Fri Jun 17 11:30:29 2005
From: nhuillard at e-dition.fr (Nicolas Huillard)
Date: Fri, 17 Jun 2005 11:30:29 +0200
Subject: [Softdevice-devel] Problem running vdr+softdevice
In-Reply-To: <20050617081113.92527.qmail@web26301.mail.ukl.yahoo.com>
References: <20050617081113.92527.qmail@web26301.mail.ukl.yahoo.com>
Message-ID: <42B29835.8090509@e-dition.fr>

Rose M a ?crit :
> Hello,
> 
> I'm trying to use vdr with softdevice but I only have
> this output when I run them:
> 
> ./vdr -Psoftdevice
> [softdevice] processing args
> [softdevice]   argv [0] = softdevice
> Segmentation fault
> 
> I'm using Fedora Core 3 with kernel 2.6.11.11, I've
> tried the last version of softdevice and 0.1.0, but no
> changes. I've configurated softdevice with framebuffer
> and DirectFB, but both same results. Why it could
> happen?
> I would post it in vdr too.
> Any idea would be wellcomed,

Try to run vdr from gdb, and print a backtrace. Also provide the syslog
output of VDR : more information is there about the actual loading steps.

-- 
NH


From marko.makela at hut.fi  Fri Jun 17 22:58:42 2005
From: marko.makela at hut.fi (Marko =?iso-8859-1?B?TeRrZWzk?=)
Date: Fri, 17 Jun 2005 23:58:42 +0300
Subject: [Softdevice-devel] Cannot power down while playing a recording
Message-ID: <20050617205842.GA5271@localhost.localdomain>

I've noticed that the Power key is ignored when VDR is playing a recording.
The key is detected, because it makes any open OSD menu go away, but it
is simply ignored.  To power down the system, I have to press Stop first
in order to switch to live TV mode, where the Power button works.

Is this a bug in softdevice or in VDR?

	Marko


From noreply at berlios.de  Tue Jun 21 23:02:31 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Tue, 21 Jun 2005 23:02:31 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #4355] vdr --help dont work
Message-ID: <200506212102.j5LL2Vet002549@unicorn.berlios.de>

Bug #4355, was updated on 2005-Jun-21 23:02
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: clausmuus
Assigned to : none
Summary: vdr --help dont work

Details: Hi,

I have a little bugfix against the problem, that vdr --help dont work:

--- softdevice.c.orig   2005-05-22 09:21:12.000000000 +0200
+++ softdevice.c    2005-06-21 22:36:05.372792353 +0200
@@ -684,6 +684,7 @@
     if ( !strcmp(argv[i], "softdevice") ) {
         i++;
         argc--;
+       break;
     };
     if (!strcmp (argv[i], "-vo")) {
       ++i;

Claus

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=4355&group_id=2051


From noreply at berlios.de  Wed Jun 22 18:11:57 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Wed, 22 Jun 2005 18:11:57 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #4355] vdr --help dont work
Message-ID: <200506221611.j5MGBvvc003491@unicorn.berlios.de>

Bug #4355, was updated on 2005-Jun-21 23:02
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Closed
Resolution: None
Bug Group: None
Priority: 5
Submitted by: clausmuus
Assigned to : none
Summary: vdr --help dont work

Details: Hi,

I have a little bugfix against the problem, that vdr --help dont work:

--- softdevice.c.orig   2005-05-22 09:21:12.000000000 +0200
+++ softdevice.c    2005-06-21 22:36:05.372792353 +0200
@@ -684,6 +684,7 @@
     if ( !strcmp(argv[i], "softdevice") ) {
         i++;
         argc--;
+       break;
     };
     if (!strcmp (argv[i], "-vo")) {
       ++i;

Claus

Follow-Ups:

Date: 2005-Jun-22 18:11
By: wachm

Comment:
This bug is already fixed in the CVS.
But thank you for the report anyway :-)
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=4355&group_id=2051


From noreply at berlios.de  Wed Jun 22 18:13:49 2005
From: noreply at berlios.de (noreply at berlios.de)
Date: Wed, 22 Jun 2005 18:13:49 +0200 (CEST)
Subject: [Softdevice-devel] [Feature #687] start in fullscreen ,  safe parameter
Message-ID: <200506221613.j5MGDniS003629@unicorn.berlios.de>

Feature Request #687, was updated on 2005-Mar-08 13:13
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051

Category: None
Status: Closed
Priority: 5
Summary: start in fullscreen ,  safe parameter

By: wachm
Date: 2005-Jun-22 18:13

Message:
Logged In: YES 
user_id=11379
Browser: Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; de-DE; rv:1.7.8) Gecko/20050511 Firefox/1.0.4

start Xv-out in fullscreen mode is there since the 0.1.1
release, safe parameters even longer.
I guess I can close this request...

----------------------------------------------------------------------

By: lucke
Date: 2005-Mar-08 21:56

Message:
Logged In: YES 
user_id=8885
Browser: Mozilla/5.0 (compatible; Konqueror/3.1; Linux)

Start in fullscreen: 
 That should be an additional substring to th -vo option 
 something like "-vo xv:full" 
 
Save parameter: 
 That is already present via settings->plugins->softdevice 
 
X11 changes via OSD instead of hotkeys: 
 Could/should be done. 

----------------------------------------------------------------------
You can respond by visiting: 
http://developer.berlios.de/feature/?func=detailfeature&feature_id=687&group_id=2051


From ospite at studenti.unina.it  Wed Jun 22 23:13:46 2005
From: ospite at studenti.unina.it (A.O.)
Date: Wed, 22 Jun 2005 23:13:46 +0200
Subject: [Softdevice-devel] xv output and fullscreen issue: almost SOLVED.
Message-ID: <20050622231346.0099dcf3.ospite@studenti.unina.it>

Hi,

it seems i was able to solve the problem i had when going in and
out of fullscreen mode very fast. The effect was that from time to time
vdr stopped because of a buffering problem.

I commented the call that sets the window Focus explicitly in
xv-video.c, now the focus handling is demanded to the windows manager (i
use blackbox, and my videocard is a savage IX/MX ARGH!). But.. there is
always a "but", playing insanely with the f-key now brings to another
issue: sometimes when coming back to windowed mode the window size is
not restored properly, the window seems to have the correct position but
it has the "fullscreen" size. Maybe a locking problem? Should
softdevice allow a fullscreen request when serving a fullscreen request?

The attached patch needs to be tested on other setups, i presume.

Moreover, i noticed another odd behaviour (but i can live with that for
now): when i move the softdevice window, if i keep the titlebar grabbed
without releasing it for a while, the decodig thread seems to going mad.
Please, can anyone else experiment this?

Thanks, softdevice is now usable on my crappy thinkpad :)

Regards,
   Antonio Ospite.

-- 
Public key: http://studenti.unina.it/~ospite/aopubkey.asc
  Web Site: http://studenti.unina.it/~ospite
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: xv_fullscreen_focus.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050622/df0e6dbc/attachment.ksh>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050622/df0e6dbc/attachment.pgp>

From stefan at lucke.in-berlin.de  Thu Jun 23 09:56:42 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 23 Jun 2005 09:56:42 +0200
Subject: [Softdevice-devel] xv output and fullscreen issue: almost SOLVED.
In-Reply-To: <20050622231346.0099dcf3.ospite@studenti.unina.it>
References: <20050622231346.0099dcf3.ospite@studenti.unina.it>
Message-ID: <1119513402.42ba6b3a89a10@webmail.in-berlin.de>

Quoting "A.O." <ospite at studenti.unina.it>:

> Hi,
>
> it seems i was able to solve the problem i had when going in and
> out of fullscreen mode very fast. The effect was that from time to time
> vdr stopped because of a buffering problem.
>
> I commented the call that sets the window Focus explicitly in
> xv-video.c, now the focus handling is demanded to the windows manager (i
> use blackbox, and my videocard is a savage IX/MX ARGH!). But.. there is
> always a "but", playing insanely with the f-key now brings to another
> issue: sometimes when coming back to windowed mode the window size is
> not restored properly, the window seems to have the correct position but
> it has the "fullscreen" size. Maybe a locking problem? Should
> softdevice allow a fullscreen request when serving a fullscreen request?

Noticed that too when holding 'f' key, so that toggling is done at keyrepeat rate.
Perhaps we have to ignore (count) toggle request until we get the corresponding
ConfigureNotify event. I guess that counting toggle requests should solve
your initial problem too.

>
> The attached patch needs to be tested on other setups, i presume.

Setting input focus explicit is required for some window managers.
Changing the toggle code, requires test on at least several (five+) WMs
gnome, kde, windowmaker, .. .

Sorry but for that reason: patch rejected.

>
> Moreover, i noticed another odd behaviour (but i can live with that for
> now): when i move the softdevice window, if i keep the titlebar grabbed
> without releasing it for a while, the decodig thread seems to going mad.
> Please, can anyone else experiment this?

That is: no video update during that action ?
I think thats a window manager issue. As far as I remember, mwm acts in
a similar sane way upon resize events. Blocking events until the resize
action complets :-( .

>
> Thanks, softdevice is now usable on my crappy thinkpad :)
>

Stefan Lucke

PS: please subscribe to avoid manual approve of postings.
When I find that checkbox to autoreject mails from nonsubscribers
I'll do that (to get rid of approve request from spammers).


From ospite at studenti.unina.it  Thu Jun 23 14:20:35 2005
From: ospite at studenti.unina.it (A.O.)
Date: Thu, 23 Jun 2005 14:20:35 +0200
Subject: [Softdevice-devel] xv output and fullscreen issue: almost
 SOLVED.
In-Reply-To: <1119513402.42ba6b3a89a10@webmail.in-berlin.de>
References: <20050622231346.0099dcf3.ospite@studenti.unina.it>
	<1119513402.42ba6b3a89a10@webmail.in-berlin.de>
Message-ID: <20050623142035.27daf2e4.ospite@studenti.unina.it>

On Thu, 23 Jun 2005 09:56:42 +0200
Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> Quoting "A.O." <ospite at studenti.unina.it>:
> >
> > The attached patch needs to be tested on other setups, i presume.
> 
> Setting input focus explicit is required for some window managers.
> Changing the toggle code, requires test on at least several (five+)
> WMs gnome, kde, windowmaker, .. .
> 
> Sorry but for that reason: patch rejected.
>

Ok, really no problems here. If the toggle count trick for fullscreen
wont solve my problem, i can always apply the patch myself before
compiling a new softdevice.

> >
> > Moreover, i noticed another odd behaviour (but i can live with that
> > for now): when i move the softdevice window, if i keep the titlebar
> > grabbed without releasing it for a while, the decodig thread seems
> > to going mad. Please, can anyone else experiment this?
> 
> That is: no video update during that action ?
> I think thats a window manager issue. As far as I remember, mwm acts
> in a similar sane way upon resize events. Blocking events until the
> resize action complets :-( .

Exactly, no video update! I presume is has something to do with opaque
window moving. Ok, if it is a wm issue i will not bother you anymore.

> 
> PS: please subscribe to avoid manual approve of postings.
> When I find that checkbox to autoreject mails from nonsubscribers
> I'll do that (to get rid of approve request from spammers).

I'm subscribed now.

Best wishes,
   Antonio.

-- 
Public key: http://studenti.unina.it/~ospite/aopubkey.asc
  Web Site: http://studenti.unina.it/~ospite
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20050623/d0eeb96b/attachment.pgp>

From stefan at lucke.in-berlin.de  Tue Jun 28 20:14:57 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 28 Jun 2005 20:14:57 +0200
Subject: [Softdevice-devel] xv output and fullscreen issue: almost SOLVED.
In-Reply-To: <1119513402.42ba6b3a89a10@webmail.in-berlin.de>
References: <20050622231346.0099dcf3.ospite@studenti.unina.it> <1119513402.42ba6b3a89a10@webmail.in-berlin.de>
Message-ID: <200506282014.57955.stefan@lucke.in-berlin.de>

On Donnerstag, 23. Juni 2005 09:56, Stefan Lucke wrote:
> Quoting "A.O." <ospite at studenti.unina.it>:
> 
> > Hi,
> >
> > it seems i was able to solve the problem i had when going in and
> > out of fullscreen mode very fast. The effect was that from time to time
> > vdr stopped because of a buffering problem.
> >
> > I commented the call that sets the window Focus explicitly in
> > xv-video.c, now the focus handling is demanded to the windows manager (i
> > use blackbox, and my videocard is a savage IX/MX ARGH!). But.. there is
> > always a "but", playing insanely with the f-key now brings to another
> > issue: sometimes when coming back to windowed mode the window size is
> > not restored properly, the window seems to have the correct position but
> > it has the "fullscreen" size. Maybe a locking problem? Should
> > softdevice allow a fullscreen request when serving a fullscreen request?
> 
> Noticed that too when holding 'f' key, so that toggling is done at keyrepeat rate.
> Perhaps we have to ignore (count) toggle request until we get the corresponding
> ConfigureNotify event. I guess that counting toggle requests should solve
> your initial problem too.
> 

A fix for loosing window dimension is in cvs now. By this sometimes
a toggle is ignored (while already in progress). In addition to this
we may define a "min toggle repeat intervall" to reduce amount
of toggle requests if you still get sometimes in trouble.
Toggleing fullscreen, windowed mode at keyrepeat rate is not a 
typical "use case" of softdevice.


Stefan Lucke



From prelude at kapsi.fi  Wed Jun 29 19:20:09 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Wed, 29 Jun 2005 20:20:09 +0300
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
Message-ID: <42C2D849.7040808@kapsi.fi>

Hello

I use G400 TV out, vdr-1.3.27 and latest softdevice source from CVS.
When i look live TV picture is fine but when i look recording picture 
jerking whole time :-/
Any idea where to look that problem?

I added little timing debug to code.
mpeg2decoder.c
Line 594:

   // display picture
    delay2=syncTimer2->GetRelTime();
    printf("decode = %d\t",delay2);
    videoOut->YUV(picture->data[0], picture->data[1],picture->data[2],
        context->width,context->height,
        picture->linesize[0],picture->linesize[1]);
    delay2+=syncTimer2->GetRelTime();
    printf("Total = %d\n",delay2);

When i watch live tv result is: (CPU usage: 33-40%)
decode = 7111   Total = 39998
decode = 6615   Total = 39997
decode = 6352   Total = 40000
decode = 5120   Total = 40002
decode = 3908   Total = 39992
decode = 4977   Total = 40007
decode = 5108   Total = 39999
decode = 7105   Total = 39978
decode = 5565   Total = 40018
decode = 5377   Total = 39992
decode = 5279   Total = 40012
decode = 6046   Total = 39983
decode = 5970   Total = 39994
decode = 5391   Total = 40005
decode = 6046   Total = 40008
decode = 5846   Total = 39991
decode = 6889   Total = 40004
decode = 6598   Total = 39995
decode = 6543   Total = 39988
decode = 6690   Total = 40012
decode = 5764   Total = 39988
decode = 5949   Total = 40007
decode = 5141   Total = 39993
decode = 6125   Total = 40005
decode = 5887   Total = 39995
decode = 4841   Total = 39999
decode = 6096   Total = 39996
decode = 7117   Total = 40009
decode = 8515   Total = 39985
decode = 6376   Total = 40031
decode = 6066   Total = 39970
decode = 7444   Total = 40023
decode = 5443   Total = 39996
decode = 5595   Total = 39973
decode = 4128   Total = 40005
decode = 6061   Total = 40002
decode = 5885   Total = 39989
decode = 5423   Total = 40005
decode = 6018   Total = 39990
decode = 5886   Total = 40013
decode = 7819   Total = 39998
decode = 7109   Total = 39991
decode = 6576   Total = 39997
decode = 8899   Total = 39996
decode = 5890   Total = 40013
decode = 5416   Total = 39994
decode = 4079   Total = 39992
decode = 5643   Total = 40003
decode = 5754   Total = 40001


And when i watch recording: (CPU usage: 50-60%)
decode = 8272   Total = 40005
decode = 8297   Total = 46372
decode = 16845  Total = 33628
decode = 14091  Total = 39985
decode = 8298   Total = 40011
decode = 8258   Total = 46366
decode = 27880  Total = 73637
decode = 8349   Total = 39982
decode = 6759   Total = 40005
decode = 7968   Total = 39998
decode = 8524   Total = 39996
decode = 8205   Total = 44513
decode = 17871  Total = 35964
decode = 13078  Total = 39510
decode = 7243   Total = 40006
decode = 8443   Total = 46336
decode = 17679  Total = 73676
decode = 8728   Total = 39990
decode = 8363   Total = 39992
decode = 8965   Total = 44391
decode = 7340   Total = 35614
decode = 8223   Total = 39990
decode = 8067   Total = 47255
decode = 28150  Total = 72761
decode = 31628  Total = 39984
decode = 60185  Total = 80004
decode = 43471  Total = 80002
decode = 36020  Total = 83120
decode = 36345  Total = 76857
decode = 31024  Total = 39992
decode = 55483  Total = 89967
decode = 40212  Total = 70039
decode = 33172  Total = 40063
decode = 61915  Total = 119928
decode = 31385  Total = 39997
decode = 60965  Total = 87037
decode = 37072  Total = 72967
decode = 31574  Total = 39982
decode = 55065  Total = 84067
decode = 35454  Total = 75937
decode = 31775  Total = 40002
decode = 56866  Total = 82256
decode = 37441  Total = 77729
decode = 30997  Total = 80007

It's seems that problem is somewhere mpeg2 stream decoding part but i 
can be wrong also ;-)

Regards: Tommi


From torgeir at pobox.com  Wed Jun 29 19:23:07 2005
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 29 Jun 2005 18:23:07 +0100
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
In-Reply-To: <42C2D849.7040808@kapsi.fi>
References: <42C2D849.7040808@kapsi.fi>
Message-ID: <1120065787.3093.4.camel@africa>

On Wed, 2005-06-29 at 20:20 +0300, Tommi Lundell wrote:
> Hello
> 
> I use G400 TV out, vdr-1.3.27 and latest softdevice source from CVS.
> When i look live TV picture is fine but when i look recording picture 
> jerking whole time :-/
> Any idea where to look that problem?

It's a known problem. See the thread "Inefficient synchronization when
playing back recordings".

A workaround for now is to use softplay to playback recordings.

-- 
Torgeir Veimo <torgeir at pobox.com>



From M.Wache at gmx.net  Thu Jun 30 18:16:09 2005
From: M.Wache at gmx.net (Martin Wache)
Date: Thu, 30 Jun 2005 18:16:09 +0200
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
In-Reply-To: <42C2D849.7040808@kapsi.fi>
References: <42C2D849.7040808@kapsi.fi>
Message-ID: <42C41AC9.1080203@gmx.net>

Tommi Lundell schrieb:
> Hello
> 
> I use G400 TV out, vdr-1.3.27 and latest softdevice source from CVS.
> When i look live TV picture is fine but when i look recording picture
> jerking whole time :-/
> Any idea where to look that problem?
As Torgeir already said, this is a known problem, I think you are the
third one to report it.
It would be really nice to find the reason for these troubles,
unfortunatly on my box I don't see them, so for me it is impossible to
find out more....

Currently I know the following:
1. one of vdr's threads takes much more cpu time on the affected systems
   (this is the thread which feeds the data to the softdevice)
2. when replaying a recording the buffers of the softdevice are usually
   full. This is because vdr feeds data as fast as it can since vdr
   doesn't know how fast it will be consumed.
So my current guess is that something (either the softdevice or vdr)
busy waits because of the full buffers. No idea why or where....

> 
> I added little timing debug to code.
> mpeg2decoder.c
> Line 594:
> 
>   // display picture
>    delay2=syncTimer2->GetRelTime();
>    printf("decode = %d\t",delay2);
>    videoOut->YUV(picture->data[0], picture->data[1],picture->data[2],
>        context->width,context->height,
>        picture->linesize[0],picture->linesize[1]);
>    delay2+=syncTimer2->GetRelTime();
>    printf("Total = %d\n",delay2);

[.....]

> It's seems that problem is somewhere mpeg2 stream decoding part but i
> can be wrong also ;-)

Your debuging code is a bit simple, it cannot decide if it's really in
the decoding or in the buffering somewhere.
If you really want to debug this, you should enable the BUFDEB debugging
macro, which gives you a lot of debugging information together with the
times, pipe the output into a file since it quite a lot. You could can
compare the output of live tv with the output of a replay, and keep in
mind that the softdevice is multithreaded. I said "if you really want to
debug this", because I think trying to understand the logs will be very
difficult since you need to understand fully how all the threads of the
softdevice and vdr work together. But if you are willing to try, don't
hesitate to ask if you don't understand something. Note that you won't
find the reason with this method if it is in vdr.

The other possibility would be to profile the softdevice playing a
recording and live-tv and compare where the softdevice or vdr spents the
time. I guess oprofile would be the best profiler for this since gprof
doesn't like threads and shared librarys...
I think the second possiblity is the better one, but unfortunatly I'm
still no expert of oprofile, so I can't help you much there...


Bye,
Martin


From stefan at lucke.in-berlin.de  Thu Jun 30 21:34:39 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 30 Jun 2005 21:34:39 +0200
Subject: [Softdevice-devel] compile problem:parse error before string constant
Message-ID: <200506302134.39419.stefan@lucke.in-berlin.de>

Hi,

got some compile problem on my prod vdr box with current cvs:

utils.c: In function `void * fast_memcpy(void *, const void *, unsigned int)':
utils.c:469: parse error before string constant
utils.c:514: confused by earlier errors, bailing out

Thats is with gcc: 2.95.3

-- 
Stefan Lucke



From stefan at lucke.in-berlin.de  Thu Jun 30 21:42:54 2005
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 30 Jun 2005 21:42:54 +0200
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
In-Reply-To: <42C41AC9.1080203@gmx.net>
References: <42C2D849.7040808@kapsi.fi> <42C41AC9.1080203@gmx.net>
Message-ID: <200506302142.54143.stefan@lucke.in-berlin.de>

On Donnerstag, 30. Juni 2005 18:16, Martin Wache wrote:
> Tommi Lundell schrieb:
> > Hello
> > 
> > I use G400 TV out, vdr-1.3.27 and latest softdevice source from CVS.
> > When i look live TV picture is fine but when i look recording picture
> > jerking whole time :-/
> > Any idea where to look that problem?
> As Torgeir already said, this is a known problem, I think you are the
> third one to report it.
> It would be really nice to find the reason for these troubles,
> unfortunatly on my box I don't see them, so for me it is impossible to
> find out more....

I think it's the same we talked about some days (week) ago.
I changed clamping low limit and added a fprintf in case we drop frames.

Tommi can you try this change ?

Stefan Lucke



From patrick.boettcher at desy.de  Thu Jun 30 22:20:34 2005
From: patrick.boettcher at desy.de (Patrick Boettcher)
Date: Thu, 30 Jun 2005 22:20:34 +0200 (CEST)
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
In-Reply-To: <42C41AC9.1080203@gmx.net>
References: <42C2D849.7040808@kapsi.fi> <42C41AC9.1080203@gmx.net>
Message-ID: <Pine.LNX.4.61.0506302215020.6192@pub2.ifh.de>

Hi,

On Thu, 30 Jun 2005, Martin Wache wrote:

> Tommi Lundell schrieb:
>> Hello
>>
>> I use G400 TV out, vdr-1.3.27 and latest softdevice source from CVS.
>> When i look live TV picture is fine but when i look recording picture
>> jerking whole time :-/
>> Any idea where to look that problem?
> As Torgeir already said, this is a known problem, I think you are the
> third one to report it.

That make it four.

Everything was fine before:
- updating to vdr 1.3.27
- updating to 2.6.12
- updating ffmpeg CVS, softdevice CVS, DirectFB CVS

Don't know which of these are causing the trouble. Additionally I noticed 
an audio/video ansynchronisation when view live-tv after updating. It can 
almost be solved by setting the option AV-sync-correction to 2.

Everything was fine beforehand.

Anything I can do to help finding the problem.

best regards,
Patrick.

--
   Mail: patrick.boettcher at desy.de
   WWW:  http://www.wi-bw.tfh-wildau.de/~pboettch/


From prelude at kapsi.fi  Thu Jun 30 23:45:10 2005
From: prelude at kapsi.fi (Tommi Lundell)
Date: Fri, 01 Jul 2005 00:45:10 +0300
Subject: [Softdevice-devel] Jerky picture when i replay recordings.
In-Reply-To: <200506302142.54143.stefan@lucke.in-berlin.de>
References: <42C2D849.7040808@kapsi.fi> <42C41AC9.1080203@gmx.net> <200506302142.54143.stefan@lucke.in-berlin.de>
Message-ID: <42C467E6.1010806@kapsi.fi>

Stefan Lucke wrote:

>I think it's the same we talked about some days (week) ago.
>I changed clamping low limit and added a fprintf in case we drop frames.
>
>Tommi can you try this change ?
>
>Stefan Lucke
>
>_______________________________________________
>Softdevice-devel mailing list
>Softdevice-devel at lists.berlios.de
>http://lists.berlios.de/mailman/listinfo/softdevice-devel
>
>  
>
I made test whit current CVS (taken from CVS 30 mins ago) and result is 
same i don t see any different behavior that before.
And in syslog i don t see anything unfamiliar (no errors or warnings or 
anything about frame dropping)
I try to look logs someday when i have time but if someone want to look 
log what i made (uncommenting #define BUFDEB(out...) 
{printf("BUF[%04d]:",(int)(getTimeMilis() % 10000));printf(out);} line 
from mpeg2decoder.c) then you can download it from:
http://prelude.kapsi.fi/jerky.tar.gz (about 500kB)

I take that log about 30 sec after stabilaton (starting vdr and starting 
playback ) and both logs was timed about 15sec...but still those logs 
are hugs.

Tommi


