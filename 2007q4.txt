From admin at berlios.de  Mon Oct  1 15:05:06 2007
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 1 Oct 2007 15:05:06 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #7147] cvs - expand top/bottom lines
Message-ID: <200710011305.l91D56cv019677@unicorn.berlios.de>

Bug #7147, was updated on 2006-Apr-15 02:17
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: general
Status: Closed
Resolution: Invalid
Bug Group: None
Priority: 5
Submitted by: daliman
Assigned to : none
Summary: cvs - expand top/bottom lines

Details: Ich bin mir nicht sicher ob man das Folgende als Fehler bezeichnen kann, aber ich kann es ja versuchen.

Mit diesem Wert wird der Bildschirm nach oben erweitert, wobei die untere "Kante" fast an der selben Stelle bleibt. Bei manchen Sendern ist die obere Bildschirmkante bereits bei einem Wert von 14 erreicht. Wenn man die Postition, wie z.B. mit ZoomCenter(x,y) jetzt korrigieren k?nnte, also nach unten verschieben, dann k?nnte man weiter bis 25 erh?hen  und eine Bildschirmf?llende Ausgabe erreichen. Welche Variablen m?ssten dazu ver?ndert werden?
   

Follow-Ups:

Date: 2007-Oct-01 15:05
By: lucke

Comment:
Verhalten kann nicht reproduziert werden.
-------------------------------------------------------

Date: 2006-Apr-15 02:57
By: lucke

Comment:
Die beiden Kanten sollten sich gleichzeitig und im gleichen Umfang verschieben. 
Wurde eine make clean in softdevice-verzeichnis ausgef?hrt (falls cvs update gemacht wurde)?
Welche Ausgabemethode wird verwendet?
Ich habe nur mit xv getestet.
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=7147&group_id=2051


From admin at berlios.de  Mon Oct  1 15:07:27 2007
From: admin at berlios.de (admin at berlios.de)
Date: Mon, 1 Oct 2007 15:07:27 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #7365] Crash bei Kanalwechsel +
	ExpandBottomLines
Message-ID: <200710011307.l91D7RgF025527@unicorn.berlios.de>

Bug #7365, was updated on 2006-May-03 00:46
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Closed
Resolution: Invalid
Bug Group: None
Priority: 5
Submitted by: daliman
Assigned to : none
Summary: Crash bei Kanalwechsel + ExpandBottomLines

Details: Wenn der Wert ExpandBottomLines erh?ht wurde und dannach mit den Cursortasten der Kanal gewechselt wird, crasht der VDR.

vdr-1.4 + BP + softdevice 0.2.3a & cvs update


Follow-Ups:

Date: 2007-Oct-01 15:07
By: lucke

Comment:
Kann nicht reproduziert werden. Keine Antwort auf nachfrage.
Not reproducable. No answer upon request.
-------------------------------------------------------

Date: 2006-May-03 08:03
By: lucke

Comment:
Which output method do you use ?

From stefan at lucke.in-berlin.de  Mon Oct  1 18:51:39 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Mon, 1 Oct 2007 18:51:39 +0200
Subject: [Softdevice-devel] Problem with segfaulting softplay.
In-Reply-To: <200709300944.47346.stefan@lucke.in-berlin.de>
References: <46EE7B31.5090402@mellander.org>
	<200709292320.04810.stefan@lucke.in-berlin.de>
	<200709300944.47346.stefan@lucke.in-berlin.de>
Message-ID: <200710011851.40186.stefan@lucke.in-berlin.de>

On Sonntag, 30. September 2007, Stefan Lucke wrote:
> On Samstag, 29. September 2007, Stefan Lucke wrote:
> > On Montag, 17. September 2007, Per Mellander wrote:
> > > Hi!
> > > 
> > > Just curious to here from you? Haven't been any traffic lately?
> > > 
> > > I have had some problems when I reinstalled my VDR setup that
> > > softplay segfaults when I try to use it. I use softplay/ffmpeg etc
> > > as of 070831.
> > 
> > For me av_open_input_file () now segfaults. Looks like the
> > same problem, which was reported first on april 3rd.
> > My working ffmpeg is from 2007-08-11: svn-10066.
> > 
> > ++ B 0 256 1 mp3
> > ++ B 0 0 1 mpc
> > ++ B 0 9 1 mpeg
> > ++ C
> > Segmentation fault
> > 
> > That is generated by ffmpeg's av_probe_input2() function (file libavformat/utils.c):
> >     for(fmt1 = first_iformat; fmt1 != NULL; fmt1 = fmt1->next) {
> > fprintf(stderr,"++ B %d %d %d %s\n",is_opened, fmt1->flags, AVFMT_NOFILE, fmt1->name);
> >         if (!is_opened == !(fmt1->flags & AVFMT_NOFILE))
> >             continue;
> > fprintf(stderr,"++ C\n");
> > 
> > FFplay does not segfault when it should play the same mp3 file:
> > ++ B 0 256 1 mp3
> > ++ B 0 0 1 mpc
> > ++ B 0 8 1 mpeg
> > ++ B 0 8 1 mpegts
> > 
> > Output is a bit different, as AVFMT_NOFILE is _not_ set now.
> 
> AVFMT_NOFILE is set for format "mpeg" in softdevice's mpeg2decoder.c
> line 1126. Without this we'll get errors from softdevice.
> 
> OT: Don't know if mail distribution works. prev mail is visible via web.
> 

As reported on bug #12090 I made a hack for softplay to work
around softdevice's AVFMT_NOFILE behaviour.

Ofcourse thereis a way to fix this in ffmpeg, but I don't think
they'll change something because of our flag handling.

Martin I cc'ed you, as mail delivery from berlios is interrupted,
but they are visible via web interface.

-- 
Stefan Lucke
-------------- next part --------------
Index: SoftPlayer.c
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.c,v
retrieving revision 1.16
diff -n -b -U3 -r1.16 SoftPlayer.c
--- SoftPlayer.c	12 Mar 2007 21:32:03 -0000	1.16
+++ SoftPlayer.c	30 Sep 2007 20:34:29 -0000
@@ -445,14 +445,20 @@
 	};
 		
         printf("open file '%s'\n",filename);
+AVInputFormat *fmt;
+fmt=av_find_input_format("mpeg");
+fmt->flags &= ~AVFMT_NOFILE;
         char str[60];
-        if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        //if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        if ( (ret=av_open_input_file( &ic, filename, NULL, FFM_PACKET_SIZE, NULL)) ) {
                 snprintf(str,60,"%s %s!","Could not open file",filename);
-                Skins.Message(mtError, str);
+                //Skins.Message(mtError, str);
                 printf("could not open file. Return value %d\n",ret);
                 ic=0;
+fmt->flags |= AVFMT_NOFILE;
                 return;
         };
+fmt->flags |= AVFMT_NOFILE;
 
         if ( av_find_stream_info( ic ) ) {
                 printf("could not find stream info\n");
-------------- next part --------------
Index: libavformat/mpeg.c
===================================================================
--- libavformat/mpeg.c	(Revision 10066)
+++ libavformat/mpeg.c	(Arbeitskopie)
@@ -35,7 +35,8 @@
 static int cdxa_probe(AVProbeData *p)
 {
     /* check file header */
-    if (p->buf[0] == 'R' && p->buf[1] == 'I' &&
+    if (p->buf_size > 11 &&
+	p->buf[0] == 'R' && p->buf[1] == 'I' &&
         p->buf[2] == 'F' && p->buf[3] == 'F' &&
         p->buf[8] == 'C' && p->buf[9] == 'D' &&
         p->buf[10] == 'X' && p->buf[11] == 'A')

From admin at berlios.de  Tue Oct  2 18:40:41 2007
From: admin at berlios.de (admin at berlios.de)
Date: Tue, 2 Oct 2007 17:40:41 +0100 (BST)
Subject: [Softdevice-devel] [Bug #12090] softplay: problems with recent
	ffmpeg snapshot
Message-ID: <200710021640.l92GefYh020319@unicorn.berlios.de>

Bug #12090, was updated on 2007-Sep-27 20:46
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: blueman
Assigned to : none
Summary: softplay: problems with recent ffmpeg snapshot

Details: Hi,

I have problems with softplay when I use a newer ffmpeg version.

compiling:
Plugin softplay:
make[1]: Entering directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
make[1]: Leaving directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
make[1]: Entering directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  softplay.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  SoftPlayer.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
SoftPlayer.c: In member function 'int cSoftPlayer::GetPlayMode(AVFormatContext*)':
SoftPlayer.c:380: warning: comparison between signed and unsigned integer expressions
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  PlayList.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  PlayListMenu.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  i18n.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  FileIndex.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  Receiver.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  Setup.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -shared softplay.o SoftPlayer.o PlayList.o PlayListMenu.o i18n.o FileIndex.o Receiver.o Setup.o -L/usr/include/ffmpeg/ -L/usr/include/ffmpeg//libavformat -L/usr/include/ffmpeg//libavcodec -L/usr/include/ffmpeg//libavutil -lavformat -lavcodec -lz -lavutil -o libvdr-softplay.so

when starting vdr:
vdr: ./PLUGINS/lib/libvdr-softplay.so.1.5.1: undefined symbol: _Z15av_register_allv

softdevice (cvs today) runs fine...

thanks

Follow-Ups:

Date: 2007-Oct-02 17:40
By: blueman

Comment:
Hi,

ok thanks,
I used the SoftPlayer.c patch an only this one, not the one for ffmpeg. Everything seems to be working. :)


-------------------------------------------------------

Date: 2007-Sep-30 16:34
By: lucke

Comment:
I'm seeing a similar problem (described on the ml, accessable via web only). It seems to caused by softdevice, setting AVFMT_NOFILE for format mpeg. De / reasserting this flag in softplay ake some avi's play again, but mp3 playback is still inop.
Index: SoftPlayer.c
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.c,v
retrieving revision 1.16
diff -n -b -U3 -r1.16 SoftPlayer.c
cvs server: conflicting specifications of output style
--- SoftPlayer.c        12 Mar 2007 21:32:03 -0000      1.16
+++ SoftPlayer.c        30 Sep 2007 14:54:43 -0000
@@ -445,14 +445,20 @@
        };

         printf("open file '%s'\n",filename);
+AVInputFormat *fmt;
+fmt=av_find_input_format("mpeg");
+fmt->flags &= ~AVFMT_NOFILE;
         char str[60];
-        if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        //if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        if ( (ret=av_open_input_file( &ic, filename, NULL, FFM_PACKET_SIZE, NULL)) ) {
                 snprintf(str,60,"%s %s!","Could not open file",filename);
-                Skins.Message(mtError, str);
+                //Skins.Message(mtError, str);
                 printf("could not open file. Return value %d\n",ret);
                 ic=0;
+fmt->flags |= AVFMT_NOFILE;
                 return;
         };
+fmt->flags |= AVFMT_NOFILE;

         if ( av_find_stream_info( ic ) ) {
                 printf("could not find stream info\n");

-------------------------------------------------------

Date: 2007-Sep-30 15:54
By: lucke

Comment:
I'm seeing a similar problem (described on the ml, accessable via web only). It seems to caused by softdevice, setting AVFMT_NOFILE for format mpeg. De / reasserting this flag in softplay ake some avi's play again, but mp3 playback is still inop.
Index: SoftPlayer.c
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.c,v
retrieving revision 1.16
diff -n -b -U3 -r1.16 SoftPlayer.c
cvs server: conflicting specifications of output style
--- SoftPlayer.c        12 Mar 2007 21:32:03 -0000      1.16
+++ SoftPlayer.c        30 Sep 2007 14:54:43 -0000
@@ -445,14 +445,20 @@
        };

         printf("open file '%s'\n",filename);
+AVInputFormat *fmt;
+fmt=av_find_input_format("mpeg");
+fmt->flags &= ~AVFMT_NOFILE;
         char str[60];
-        if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        //if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        if ( (ret=av_open_input_file( &ic, filename, NULL, FFM_PACKET_SIZE, NULL)) ) {
                 snprintf(str,60,"%s %s!","Could not open file",filename);
-                Skins.Message(mtError, str);
+                //Skins.Message(mtError, str);
                 printf("could not open file. Return value %d\n",ret);
                 ic=0;
+fmt->flags |= AVFMT_NOFILE;
                 return;
         };
+fmt->flags |= AVFMT_NOFILE;

         if ( av_find_stream_info( ic ) ) {
                 printf("could not find stream info\n");

-------------------------------------------------------

Date: 2007-Sep-29 19:27
By: blueman

Comment:
Hi,

I made an cvs update and now vdr ist starting with softplay, but when I start a file vdr crashes with the following error:

PLDBG: Activate 1 
PLDBG: Thread started: SoftPlayer
softdevicePlugin 0x81e6a10
Service 'softdevice-GetPacketHandles-v1.0'
IsStream .mpg
open file '/multimedia/media/testfile.mpg'
(!) [ 7848:    0.000] --> Caught signal 11 (at (nil), invalid address) <--
Aborted


-------------------------------------------------------

Date: 2007-Sep-28 16:55
By: lucke

Comment:
Please do a cvs update to get the fix.

Stefan
-------------------------------------------------------

Date: 2007-Sep-27 21:42
By: blueman

Comment:
Update:

I found out, that I had a old libvdr-softplay in the lib folder, now I deleted this file but at compiling I get the same as above, but it doesnt create a new  ibvdr-softplay.so.1.5.1 file.

strane...
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=12090&group_id=2051


From stefan at lucke.in-berlin.de  Wed Oct  3 17:09:40 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Wed,  3 Oct 2007 17:09:40 +0200
Subject: [Softdevice-devel] Test: ML working III?
Message-ID: <1191424180.4703b0b4aca65@webmail.in-berlin.de>

check for working ml III.

Stefan



From stefan at lucke.in-berlin.de  Thu Oct  4 17:58:31 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 4 Oct 2007 17:58:31 +0200
Subject: [Softdevice-devel] Loop when jumping to cut marks ?
Message-ID: <200710041758.31353.stefan@lucke.in-berlin.de>

Hi,

hopefully ml works again.

I noticed a problem which happens now with several vdr versions 1.4.0, 1.5.5, 1.5.9.
When trying to jump to cut marks of recordings, vdr enters a loop.
The first glance OSD seems still to be responsive.

(gdb) bt
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb7f32b5c in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
#2  0x0810173e in cCondVar::TimedWait (this=0x8159220, Mutex=@0x81591f8, TimeoutMs=1000) at thread.c:125
#3  0x080e0212 in cRemote::Get (WaitMs=1000, UnknownCode=0x0) at remote.c:191
#4  0x0810bbe8 in main (argc=9, argv=0xbfb1b2a4) at vdr.c:885

After selecting restart via OSD the back trace shows:
(gdb) bt
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb7f32b5c in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib/libpthread.so.0
#2  0x081017e9 in cCondWait::Wait (this=0xbfb1af04, TimeoutMs=10) at thread.c:69
#3  0x081019a0 in cCondWait::SleepMs (TimeoutMs=10) at thread.c:58
#4  0x08101b48 in cThread::Cancel (this=0xb1c0c694, WaitSeconds=9) at thread.c:313
#5  0x080990bd in cDevice::Detach (this=0xb62ae558, Player=0xb1c0c688) at device.c:1017
#6  0x080d673c in cPlayer::Detach (this=0x1) at player.c:37
#7  0x080a2d60 in ~cDvbPlayer (this=0xb1c0c688) at dvbplayer.c:273
#8  0x080a2969 in cDvbPlayerControl::Stop (this=0xb1c0bc08) at dvbplayer.c:780
#9  0x080c5695 in ~cReplayControl (this=0xb1c0bc08) at menu.c:3927
#10 0x080d65aa in cControl::Shutdown () at player.c:95
#11 0x0810b413 in main (argc=9, argv=0xbfb1b2a4) at vdr.c:1235

and a kill -9 PID must follow.

Is someone else seeing this problem too ?
A few weeks ago I had the same problem, which disappeared for an
unknown reason.

-- 
Stefan Lucke


From radi at radylon.com  Thu Oct  4 18:21:42 2007
From: radi at radylon.com (Michael Rademacher)
Date: Thu, 4 Oct 2007 18:21:42 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
Message-ID: <20071004162142.GA15672@radylon.com>

Hi,

I'd like to use the softdevice plugin on my desktop. I have this graphics
adapter:

zentrale:~# lspci | grep VGA
01:00.0 VGA compatible controller: nVidia Corporation NV44 [GeForce 6200 TurboCache(TM)] (rev a1)


Connected are two LCD flat screen monitors in a dual head configuration with
TwinView enabled (see attached xorg.conf). For information about TwinView
and its Xinerama hinting see
http://www.nvidia.com/object/feature_twinview.html and
http://us.download.nvidia.com/XFree86/Linux-x86/100.14.19/README/index.html.
Xinerama without TwinView is not an option as I did not manage to get this
running with both the nv and nvidia drivers (apparently a known problem).


The following software (and some more) is installed:

zentrale:~# dpkg -l vdr vdr-plugin-softdevice libavcodec0d libavformat0d libx11-6 libxext6 libxinerama1 libxv1 nvidia-kernel-2.6.22-2-686 nvidia-glx xserver-xorg
Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Installed/Config-files/Unpacked/Failed-config/Half-installed
|/ Err?=(none)/Hold/Reinst-required/X=both-problems (Status,Err: uppercase=bad)
||/ Name                             Version                          Description
+++-================================-================================-================================================================================
ii  libavcodec0d                     0.cvs20060823-8                  ffmpeg codec library
ii  libavformat0d                    0.cvs20060823-8                  ffmpeg file format library
ii  libx11-6                         2:1.0.3-7                        X11 client-side library
ii  libxext6                         1:1.0.3-2                        X11 miscellaneous extension library
ii  libxinerama1                     1:1.0.2-1                        X11 Xinerama extension library
ii  libxv1                           1:1.0.3-1                        X11 Video extension library
ii  nvidia-glx                       100.14.19-1                      NVIDIA binary Xorg driver
ii  nvidia-kernel-2.6.22-2-686       100.14.19-1+2.6.22-4             NVIDIA binary kernel module for Linux 2.6.22-2-686
ii  vdr                              1.4.7-2ctvdr3                    Video Disk Recorder for DVB cards
ii  vdr-plugin-softdevice            0.4.0-5                          VDR plugin for frame-buffer output
ii  xserver-xorg                     1:7.2-5                          the X.Org X server


When I start ShmClient I see a normal window with a half-width TV picture
(see screenshot at http://www.radylon.com/ShmClient.png ). Text output of
ShmClient as follows:

radi at zentrale:~$ ShmClient
dsyslog:[XvVideoOut]: patch version (2006-11-05)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: Xinerama Screen 1: 1280,0  1280x1024
dsyslog:[XvVideoOut]: Initialize XShmCreateImage Successful (0x80bfcb8)
[XvVideoOut]: osd_image shmid = 204996613
dsyslog:[XvVideoOut]: Initialize shmget Successful (5898240 bytes)
dsyslog:[XvVideoOut]: Initialize shmat Successful
[XvVideoOut]: got osd_image: width 2560 height 1024, bytes per line 10240, Bpp 32
dsyslog:[softdevice-xscreensaver]: xscreensaver not running

dsyslog:[XvVideoOut]: initialized OK
dsyslog:[XvVideoOut]: NV17 Video Texture: available ports 355 - 386
dsyslog:[XvVideoOut]: grabbed port 355
[XvVideoOut]: max area size 2046 x 2046
dsyslog:[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
dsyslog:[XvVideoOut]: using area size 736 x 576
dsyslog:[XvVideoOut]:   XV_SET_DEFAULTS           NOT-XvGettable     XvSettable (       0 [0x00000000] -        0 [0x00000000]) (       0 [0x00000000]
dsyslog:[XvVideoOut]:   XV_ITURBT_709                 XvGettable     XvSettable (       0 [0x00000000] -        1 [0x00000001]) (       0 [0x00000000]
dsyslog:[XvVideoOut]:   XV_SYNC_TO_VBLANK             XvGettable     XvSettable (       0 [0x00000000] -        1 [0x00000001]) (       1 [0x00000001]
dsyslog:[XvVideoOut]: using color key 0x1a0f00
dsyslog:[XvVideoOut]: XvShmCreateImage Successful (0x80c0808)
dsyslog:[XvVideoOut]: shmget Successful (0 bytes)
dsyslog:[XvVideoOut]: shmat Successful
dsyslog:[XvVideoOut]: XShmAttach    rc = 1 (should be OK)
dsyslog:[VideoOut]: resolution changed: W(736 -> 704); H(576 ->576)

dsyslog:[VideoOut]: 704x576 [0,0 704x576] -> 768x576 [194,0 379x576]
[XvVideoOut]: Xinerama-Screen changed to 0
dsyslog:[VideoOut]: 704x576 [8,0 687x576] -> 768x576 [194,0 379x576]


Any hint what to do to get a normal sized picture out of ShmClient?
Any other details you need to have a look into this issue?


Many thanks in advance,
kind regards -

Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
# xorg.conf (xorg X Window System server configuration file)
#
# This file was generated by dexconf, the Debian X Configuration tool, using
# values from the debconf database.
#
# Edit this file with caution, and see the xorg.conf manual page.
# (Type "man xorg.conf" at the shell prompt.)
#
# This file is automatically updated on xserver-xorg package upgrades *only*
# if it has not been modified since the last upgrade of the xserver-xorg
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command:
#   sudo dpkg-reconfigure -phigh xserver-xorg

Section "Files"
EndSection

Section "InputDevice"
	Identifier	"Generic Keyboard"
	Driver		"kbd"
	Option		"CoreKeyboard"
	Option		"XkbRules"	"xorg"
	Option		"XkbModel"	"type5"
	Option		"XkbLayout"	"de"
	Option		"XkbVariant"	"nodeadkeys"
EndSection

Section "InputDevice"
	Identifier	"Configured Mouse"
	Driver		"mouse"
	Option		"CorePointer"
	Option		"Device"		"/dev/input/mice"
	Option		"Protocol"		"ExplorerPS/2"
EndSection

Section "Device"
	Identifier	"nVidia Corporation NV44 [GeForce 6200 TurboCache(TM)]"
	Driver		"nvidia"
	BusID		"PCI:1:0:0"
	Option		"NoLogo"		"True"
	Option		"TwinView"
	Option		"TwinViewOrientation"	"RightOf"
EndSection

Section "Monitor"
	Identifier	"Xerox"
	Option		"DPMS"
	HorizSync	30-100
	VertRefresh	50-160
EndSection

Section "Monitor"
	Identifier	"BENQ"
	Option		"DPMS"
	HorizSync	30-100
	VertRefresh	50-160
EndSection

Section "Screen"
	Identifier	"Default Screen"
	Device		"nVidia Corporation NV44 [GeForce 6200 TurboCache(TM)]"
	Monitor		"Xerox"
	DefaultDepth	24
	SubSection "Display"
		Modes		"1280x1024" "1152x864" "1024x768" "800x600" "640x480"
	EndSubSection
EndSection

Section "ServerLayout"
	Identifier	"Default Layout"
	Screen		"Default Screen"
	InputDevice	"Generic Keyboard"
	InputDevice	"Configured Mouse"
EndSection
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071004/222cc41e/attachment.pgp>

From stefan at lucke.in-berlin.de  Thu Oct  4 19:58:01 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 4 Oct 2007 19:58:01 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071004162142.GA15672@radylon.com>
References: <20071004162142.GA15672@radylon.com>
Message-ID: <200710041958.01318.stefan@lucke.in-berlin.de>

On Donnerstag, 4. Oktober 2007, Michael Rademacher wrote:
> Hi,
> 
> I'd like to use the softdevice plugin on my desktop. I have this graphics
> adapter:
> 
> zentrale:~# lspci | grep VGA
> 01:00.0 VGA compatible controller: nVidia Corporation NV44 [GeForce 6200 TurboCache(TM)] (rev a1)
> 
> 
> Connected are two LCD flat screen monitors in a dual head configuration with
> TwinView enabled (see attached xorg.conf). For information about TwinView
> and its Xinerama hinting see
> http://www.nvidia.com/object/feature_twinview.html and
> http://us.download.nvidia.com/XFree86/Linux-x86/100.14.19/README/index.html.
> Xinerama without TwinView is not an option as I did not manage to get this
> running with both the nv and nvidia drivers (apparently a known problem).
> 
> 


> When I start ShmClient I see a normal window with a half-width TV picture
> (see screenshot at http://www.radylon.com/ShmClient.png ). Text output of
> ShmClient as follows:
> 
> radi at zentrale:~$ ShmClient
> dsyslog:[XvVideoOut]: patch version (2006-11-05)
> [XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
> [XvVideoOut]: Xinerama Screen 1: 1280,0  1280x1024


> dsyslog:[XvVideoOut]: shmat Successful
> dsyslog:[XvVideoOut]: XShmAttach    rc = 1 (should be OK)
> dsyslog:[VideoOut]: resolution changed: W(736 -> 704); H(576 ->576)
> 
> dsyslog:[VideoOut]: 704x576 [0,0 704x576] -> 768x576 [194,0 379x576]
> [XvVideoOut]: Xinerama-Screen changed to 0
> dsyslog:[VideoOut]: 704x576 [8,0 687x576] -> 768x576 [194,0 379x576]

The xoffset 194 seems to be strange, as I could not provoke such a value
with various combinations of wrong selected display aspect ratios.

But I want to ask you, which geometry did you specify (5:4, 16:9, .. )?

> 
> 
> Any hint what to do to get a normal sized picture out of ShmClient?
> Any other details you need to have a look into this issue?

-- 
Stefan Lucke


From radi at radylon.com  Fri Oct  5 09:02:33 2007
From: radi at radylon.com (Michael Rademacher)
Date: Fri, 5 Oct 2007 09:02:33 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710041958.01318.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710041958.01318.stefan@lucke.in-berlin.de>
Message-ID: <20071005070233.GA23015@radylon.com>

Hi,

On Thu, 04.10.07, at 19:58 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> But I want to ask you, which geometry did you specify (5:4, 16:9, .. )?

Geometry is "standard". Sorry, should have posted the parameters from
setup.conf. Here they are:

root at zentrale:/etc/vdr# grep softdevice setup.conf
softdevice.AC3Mode = 1
softdevice.AlsaAC3Device = hw:0,1
softdevice.AlsaDevice = default
softdevice.autodetectAspect = 0
softdevice.avOffset = 0
softdevice.bufferMode = 0
softdevice.CropBottomLines = 0
softdevice.CropLeftCols = 0
softdevice.CropMode = 0
softdevice.CropModeToggleKey = 0
softdevice.CropRightCols = 0
softdevice.CropTopLines = 0
softdevice.Deinterlace Method = 1
softdevice.ExpandLeftRightCols = 0
softdevice.ExpandTopBottomLines = 0
softdevice.mainMenu = 1
softdevice.OSDalphablend = 1
softdevice.Picture mirroring = 0
softdevice.PixelAspect = 0
softdevice.PixelFormat = 0
softdevice.Postprocess Method = 0
softdevice.Postprocess Quality = 0
softdevice.softlog-appendpid = 1
softdevice.softlog-file = stderr
softdevice.softlog-priorities = 3
softdevice.Suspend = 0
softdevice.syncTimerMode = 2
softdevice.UseSetSourceRectangle = 0
softdevice.UseStretchBlit = 0
softdevice.vidBrightness = -1
softdevice.vidContrast = -1
softdevice.vidHue = -1
softdevice.vidSaturation = -1
softdevice.Xv-Aspect = 1


Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071005/5931fda6/attachment.pgp>

From stefan at lucke.in-berlin.de  Fri Oct  5 11:15:38 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 5 Oct 2007 11:15:38 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071005070233.GA23015@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710041958.01318.stefan@lucke.in-berlin.de>
	<20071005070233.GA23015@radylon.com>
Message-ID: <200710051115.39125.stefan@lucke.in-berlin.de>

On Freitag, 5. Oktober 2007, Michael Rademacher wrote:
> Hi,
> 
> On Thu, 04.10.07, at 19:58 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> 
> > But I want to ask you, which geometry did you specify (5:4, 16:9, .. )?
> 
> Geometry is "standard". Sorry, should have posted the parameters from
> setup.conf. Here they are:

Did you try to select an other one ? 
5:4 should be correct for 1280x1024 screen size.

Does toggeling fullscreen mode (pressing key 'f') work (showing
the same effect [extra large black bars]) ?

What does the following command report:
xdpyinfo | grep dimension
For my display it is:
  dimensions:    1280x1024 pixels (342x274 millimeters)

-- 
Stefan Lucke


From radi at radylon.com  Fri Oct  5 11:23:26 2007
From: radi at radylon.com (Michael Rademacher)
Date: Fri, 5 Oct 2007 11:23:26 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710051115.39125.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710041958.01318.stefan@lucke.in-berlin.de>
	<20071005070233.GA23015@radylon.com>
	<200710051115.39125.stefan@lucke.in-berlin.de>
Message-ID: <20071005092326.GA29528@radylon.com>

Hi,

On Fri, 05.10.07, at 11:16 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> Did you try to select an other one ? 
> 5:4 should be correct for 1280x1024 screen size.

Yes, I played around a bit but no big changes. Set this to 5:4 now.

> Does toggeling fullscreen mode (pressing key 'f') work (showing
> the same effect [extra large black bars]) ?

Yes, also in fullscreen.

> What does the following command report:
> xdpyinfo | grep dimension
> For my display it is:
>   dimensions:    1280x1024 pixels (342x274 millimeters)

werkstatt at zentrale:~$ xdpyinfo | grep dimension
  dimensions:    2560x1024 pixels (765x302 millimeters)


Any other info I can give you?

Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071005/535f93c2/attachment.pgp>

From stefan at lucke.in-berlin.de  Fri Oct  5 12:49:29 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 5 Oct 2007 12:49:29 +0200
Subject: [Softdevice-devel] Loop when jumping to cut marks ?
In-Reply-To: <200710041758.31353.stefan@lucke.in-berlin.de>
References: <200710041758.31353.stefan@lucke.in-berlin.de>
Message-ID: <200710051249.29482.stefan@lucke.in-berlin.de>

On Donnerstag, 4. Oktober 2007, Stefan Lucke wrote:
> Hi,
> 
> hopefully ml works again.
> 
> I noticed a problem which happens now with several vdr versions 1.4.0, 1.5.5, 1.5.9.
> When trying to jump to cut marks of recordings, vdr enters a loop.
> The first glance OSD seems still to be responsive.

We loop in decoding still picture. For some reason ffmpeg changed their
api :-) and now it is possible that when avcodec_decode_video() is
called with buffer and length 4, it may return 0 bytes consumed from 
decode buffer. That happend on 2007-08-02:

http://svn.mplayerhq.hu/ffmpeg/trunk/libavcodec/mpeg12.c?view=diff&r1=9869&r2=9870

Lets see what fmpeg people think of attached patch.
If they say no I fix (work around that) in mpeg2decoder.c

-- 
Stefan Lucke
-------------- next part --------------
Index: libavcodec/mpeg12.c
===================================================================
--- libavcodec/mpeg12.c	(Revision 10657)
+++ libavcodec/mpeg12.c	(Arbeitskopie)
@@ -2239,7 +2239,7 @@
 
             *data_size = sizeof(AVFrame);
         }
-        return 0;
+        return buf_size;
     }
 
     if(s2->flags&CODEC_FLAG_TRUNCATED){
-------------- next part --------------
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.77
diff -U3 -r1.77 mpeg2decoder.c
--- mpeg2decoder.c	27 Sep 2007 18:10:41 -0000	1.77
+++ mpeg2decoder.c	5 Oct 2007 10:25:51 -0000
@@ -670,6 +705,13 @@
   if (len < 0)
     return len;
 
+  /* -------------------------------------------------------------------------
+   * newer ffmpeg versions return len 0 when the buffer holds the
+   * the 4 byte end sequence only.
+   */
+  if (!len && length == 4)
+    len = 4;
+
   // save coded picture number together with corresponding pts
   if (context->coded_frame  &&
       context->coded_frame->coded_picture_number!=lastCodedPictNo

From stefan at lucke.in-berlin.de  Fri Oct  5 14:42:27 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 5 Oct 2007 14:42:27 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071005092326.GA29528@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710051115.39125.stefan@lucke.in-berlin.de>
	<20071005092326.GA29528@radylon.com>
Message-ID: <200710051442.28122.stefan@lucke.in-berlin.de>

On Freitag, 5. Oktober 2007, Michael Rademacher wrote:
> Hi,
> 
> On Fri, 05.10.07, at 11:16 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> 
> > Did you try to select an other one ? 
> > 5:4 should be correct for 1280x1024 screen size.
> 
> Yes, I played around a bit but no big changes. Set this to 5:4 now.
> 
> > Does toggeling fullscreen mode (pressing key 'f') work (showing
> > the same effect [extra large black bars]) ?
> 
> Yes, also in fullscreen.
> 
> > What does the following command report:
> > xdpyinfo | grep dimension
> > For my display it is:
> >   dimensions:    1280x1024 pixels (342x274 millimeters)
> 
> werkstatt at zentrale:~$ xdpyinfo | grep dimension
>   dimensions:    2560x1024 pixels (765x302 millimeters)
> 
> 
> Any other info I can give you?

I'd like to have a look at complete output of xdpyinfo command,
to check if there is some more info of both screens.

If you are able to compile softdevice, you may change
in video-xv.c, ~line 479

from:
displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();

to:
displayAspect = displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();

Or without compiling, by modifying xorg.conf:

Section "Monitor"
        Identifier      "Xerox"
        Option          "DPMS"
        HorizSync       30-100
        VertRefresh     50-160
# overwrite display size:
	DisplaySize	377 302	# <-- about 5:4
# and half the size if above line still does not help
#	DisplaySize	189 302
EndSection

-- 
Stefan Lucke


From radi at radylon.com  Fri Oct  5 15:12:56 2007
From: radi at radylon.com (Michael Rademacher)
Date: Fri, 5 Oct 2007 15:12:56 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710051442.28122.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710051115.39125.stefan@lucke.in-berlin.de>
	<20071005092326.GA29528@radylon.com>
	<200710051442.28122.stefan@lucke.in-berlin.de>
Message-ID: <20071005131256.GA16004@radylon.com>

Hi,

On Fri, 05.10.07, at 14:42 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> I'd like to have a look at complete output of xdpyinfo command,
> to check if there is some more info of both screens.

See attached xdpyinfo.out.

> If you are able to compile softdevice, you may change
> in video-xv.c, ~line 479

I'll try, if indeed necessary.

> Or without compiling, by modifying xorg.conf:
> 
> Section "Monitor"
>         Identifier      "Xerox"
>         Option          "DPMS"
>         HorizSync       30-100
>         VertRefresh     50-160
> # overwrite display size:
> 	DisplaySize	377 302	# <-- about 5:4
> # and half the size if above line still does not help
> #	DisplaySize	189 302
> EndSection

I did so, first in one Monitor section, then in both. I also tried the
second parameter (DisplaySize 189 302) - no change at all.

Let's see if I can manage to get this thing compiled.

Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
name of display:    :0.0
version number:    11.0
vendor string:    The X.Org Foundation
vendor release number:    10400000
X.Org version: 1.4.0
maximum request size:  16777212 bytes
motion buffer size:  256
bitmap unit, bit order, padding:    32, LSBFirst, 32
image byte order:    LSBFirst
number of supported pixmap formats:    7
supported pixmap formats:
    depth 1, bits_per_pixel 1, scanline_pad 32
    depth 4, bits_per_pixel 8, scanline_pad 32
    depth 8, bits_per_pixel 8, scanline_pad 32
    depth 15, bits_per_pixel 16, scanline_pad 32
    depth 16, bits_per_pixel 16, scanline_pad 32
    depth 24, bits_per_pixel 32, scanline_pad 32
    depth 32, bits_per_pixel 32, scanline_pad 32
keycode range:    minimum 8, maximum 255
focus:  window 0x800005, revert to PointerRoot
number of extensions:    35
    BIG-REQUESTS
    Composite
    DAMAGE
    DOUBLE-BUFFER
    DPMS
    Extended-Visual-Information
    GLX
    MIT-SCREEN-SAVER
    MIT-SHM
    MIT-SUNDRY-NONSTANDARD
    NV-CONTROL
    NV-GLX
    RANDR
    RECORD
    RENDER
    SECURITY
    SHAPE
    SYNC
    TOG-CUP
    X-Resource
    XAccessControlExtension
    XC-APPGROUP
    XC-MISC
    XFIXES
    XFree86-Bigfont
    XFree86-DGA
    XFree86-Misc
    XFree86-VidModeExtension
    XINERAMA
    XINERAMA
    XInputExtension
    XKEYBOARD
    XTEST
    XVideo
    XVideo-MotionCompensation
default screen number:    0
number of screens:    1

screen #0:
  dimensions:    2560x1024 pixels (765x302 millimeters)
  resolution:    85x86 dots per inch
  depths (7):    24, 1, 4, 8, 15, 16, 32
  root window id:    0x1a6
  depth of root window:    24 planes
  number of colormaps:    minimum 1, maximum 1
  default colormap:    0x20
  default number of colormap cells:    256
  preallocated pixels:    black 0, white 16777215
  options:    backing-store NO, save-unders NO
  largest cursor:    64x64
  current input event mask:    0xfa4035
    KeyPressMask             ButtonPressMask          EnterWindowMask          
    LeaveWindowMask          KeymapStateMask          StructureNotifyMask      
    SubstructureNotifyMask   SubstructureRedirectMask FocusChangeMask          
    PropertyChangeMask       ColormapChangeMask       
  number of visuals:    120
  default visual id:  0x21
  visual:
    visual id:    0x21
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x22
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x24
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x25
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x26
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x27
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x28
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x29
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2a
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2b
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2c
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2d
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2e
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x2f
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x30
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x31
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x32
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x33
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x34
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x35
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x36
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x37
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x38
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x39
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3a
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3b
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3c
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3d
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3e
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x3f
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x40
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x41
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x42
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x43
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x44
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x45
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x46
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x47
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x48
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x49
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4a
    class:    TrueColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4b
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4c
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4d
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4e
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x4f
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x50
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x51
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x52
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x53
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x54
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x55
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x56
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x57
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x58
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x59
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5a
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5b
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5c
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5d
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5e
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x5f
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x60
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x61
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x62
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x63
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x64
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x65
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x66
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x67
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x68
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x69
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6a
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6b
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6c
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6d
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6e
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x6f
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x70
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x71
    class:    DirectColor
    depth:    24 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x23
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x72
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x73
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x74
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x75
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x76
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x77
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x78
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x79
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7a
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7b
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7c
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7d
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7e
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x7f
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x80
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x81
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x82
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x83
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x84
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x85
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x86
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x87
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x88
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x89
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8a
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8b
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8c
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8d
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8e
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x8f
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x90
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x91
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x92
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x93
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x94
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x95
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x96
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x97
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
  visual:
    visual id:    0x98
    class:    TrueColor
    depth:    32 planes
    available colormap entries:    256 per subfield
    red, green, blue masks:    0xff0000, 0xff00, 0xff
    significant bits in color specification:    8 bits
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071005/6b2e5e19/attachment.pgp>

From radi at radylon.com  Fri Oct  5 20:36:46 2007
From: radi at radylon.com (Michael Rademacher)
Date: Fri, 5 Oct 2007 20:36:46 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710051442.28122.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710051115.39125.stefan@lucke.in-berlin.de>
	<20071005092326.GA29528@radylon.com>
	<200710051442.28122.stefan@lucke.in-berlin.de>
Message-ID: <20071005183646.GA10637@radylon.com>

Hi,

On Fri, 05.10.07, at 14:42 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> If you are able to compile softdevice, you may change
> in video-xv.c, ~line 479
> from:
> displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();
> to:
> displayAspect = displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();

Ok, took a while to get the necessary development libraries installed as I
am not a software developer. Anyway, with the suggested fix it works indeed.

What's the next step to support this in future releases? I imagine that
there has to be some code to detect my special setup, right? Anything I can
do to support you?

Thanks a lot for your immediate help!

Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071005/6929a650/attachment.pgp>

From stefan at lucke.in-berlin.de  Sat Oct  6 09:12:55 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 6 Oct 2007 09:12:55 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071005183646.GA10637@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710051442.28122.stefan@lucke.in-berlin.de>
	<20071005183646.GA10637@radylon.com>
Message-ID: <200710060912.55649.stefan@lucke.in-berlin.de>

On Freitag, 5. Oktober 2007, Michael Rademacher wrote:
> Hi,
> 
> On Fri, 05.10.07, at 14:42 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> 
> > If you are able to compile softdevice, you may change
> > in video-xv.c, ~line 479
> > from:
> > displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();
> > to:
> > displayAspect = displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();
> 
> Ok, took a while to get the necessary development libraries installed as I
> am not a software developer. Anyway, with the suggested fix it works indeed.
> 

If that works now, some of your previous tests was wrong (or with
a version too old, see below).
From initial mail:
ii ?vdr-plugin-softdevice ? ? ? ? ? ?0.4.0-5 ? ? ? ? ? ? ? ? ? ? ? ? ?VDR plugin for frame-buffer output

With this modification, displayAspect is of the same value than displayRatio.
Both are passed to (line 484): SetParValues(displayAspect, displayRatio); .

displayRatio should be in your case taken from current screen 
(quoting your initial mail):
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: Xinerama Screen 1: 1280,0  1280x1024

with 1280 height 1024 -> 1280/1024 = 5/4 = 1,25

With code from SetParValue() [Par: Pixel aspect ratio] file video.c:
/* ---------------------------------------------------------------------------
 */
void cVideoOut::SetParValues(double displayAspect, double displayRatio)
{
  parValues [0] = displayAspect / displayRatio;
  parValues [1] = ( 5.0 /  4.0) / displayRatio;
  parValues [2] = ( 4.0 /  3.0) / displayRatio;
  parValues [3] = (16.0 /  9.0) / displayRatio;
  parValues [4] = (16.0 / 10.0) / displayRatio;
  parValues [5] = (15.0 /  9.0) / displayRatio;
}

With above modification, first two entries produce the same result.

> What's the next step to support this in future releases?

Can you revert above modification and do a retest by changing 
"Screen aspect" ("Bildschirmformat") via softdevice OSD ?

Which version of softdevice did you compile ?
CVS ? Then it might be a change in cvs, compared to your binary
version, that helped.

From our CHANGELOG, Martin committed ShmClient access to setup
parameters on 2007-05-10 (1 month past 0.4.0 release).

I think its time for a new release.

> I imagine that 
> there has to be some code to detect my special setup, right? Anything I can
> do to support you?
> 
> Thanks a lot for your immediate help!
> 

-- 
Stefan Lucke


From radi at radylon.com  Sat Oct  6 12:04:32 2007
From: radi at radylon.com (Michael Rademacher)
Date: Sat, 6 Oct 2007 12:04:32 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710060912.55649.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710051442.28122.stefan@lucke.in-berlin.de>
	<20071005183646.GA10637@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
Message-ID: <20071006100432.GA23445@radylon.com>

Hi,

On Sat, 06.10.07, at 09:13 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> If that works now, some of your previous tests was wrong (or with
> a version too old, see below).
> From initial mail:
> ii ?vdr-plugin-softdevice ? ? ? ? ? ?0.4.0-5 ? ? ? ? ? ? ? ? ? ? ? ? ?VDR plugin for frame-buffer output

Hmm, I don't know if I did something wrong but, here is what I've done:

root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src# apt-get source vdr-plugin-softdevice
Reading package lists... Done
Building dependency tree
Reading state information... Done
Need to get 199kB of source archives.
Get:1 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (dsc) [939B]
Get:2 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (tar) [191kB]
Get:3 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (diff) [7296B]
Fetched 199kB in 0s (301kB/s)
dpkg-source: warning: extracting unsigned source package (./vdr-plugin-softdevice_0.4.0-5.dsc)
dpkg-source: extracting vdr-plugin-softdevice in vdr-plugin-softdevice-0.4.0
dpkg-source: unpacking vdr-plugin-softdevice_0.4.0.orig.tar.gz
dpkg-source: applying ./vdr-plugin-softdevice_0.4.0-5.diff.gz


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# ./configure --disable-vidix --disable-fb --disable-dfb --disable-cle266 --disable-oss --disable-yaepg
Testing system and cpu type... found Linux on i386 cpu.
Checking for pkg-config... Found.
Checking for ffmpeg... Ok.
Checking for ALSA sound... Enabled audio-alsa.
Checking for OSS sound... Not Found.
Checking for linux frambuffer... Not Found.
Checking for DirectFB and DFB++... Not Found.
Checking for vidix... Not found.
Checking for Xv... Enabled video-xv.
Checking for Xinerama... Enabled Xinerama.
Creating temporary config.h and config.mak
updated config.h
updated config.mak
Configure is finished. Please check config.log in case of problems.


No errors in config.log


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# make ShmClient
[...]


This leads to the known problem. After applying your patch follwed by 'make
clean ; make ShmClient' it works. I did not change anything in the setup of
softdevice, so the aspect ratio still is 5:4.

Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071006/c8481ed1/attachment.pgp>

From alexander at gaengel.de  Sat Oct  6 14:42:40 2007
From: alexander at gaengel.de (Alexander =?ISO-8859-1?Q?G=E4ngel?=)
Date: Sat, 06 Oct 2007 14:42:40 +0200
Subject: [Softdevice-devel] Shmclient Fullscreen
Message-ID: <1191674560.11643.1.camel@localhost>

Is it possible to start the ShmClient in Fullscreen.

I found some thing that it wasremoved vom cvs.

Alexander



From stefan at lucke.in-berlin.de  Sat Oct  6 16:11:50 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 6 Oct 2007 16:11:50 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071006100432.GA23445@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
	<20071006100432.GA23445@radylon.com>
Message-ID: <200710061611.50493.stefan@lucke.in-berlin.de>

On Samstag, 6. Oktober 2007, Michael Rademacher wrote:
> Hi,
> 
> On Sat, 06.10.07, at 09:13 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
> 
> > If that works now, some of your previous tests was wrong (or with
> > a version too old, see below).
> > From initial mail:
> > ii ?vdr-plugin-softdevice ? ? ? ? ? ?0.4.0-5 ? ? ? ? ? ? ? ? ? ? ? ? ?VDR plugin for frame-buffer output
> 
> Hmm, I don't know if I did something wrong but, here is what I've done:

> 
> 
> root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# ./configure --disable-vidix --disable-fb --disable-dfb --disable-cle266 --disable-oss --disable-yaepg
> Testing system and cpu type... found Linux on i386 cpu.

> root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# make ShmClient
> [...]
> 
> 
> This leads to the known problem. After applying your patch follwed by 'make
> clean ; make ShmClient' it works. I did not change anything in the setup of
> softdevice, so the aspect ratio still is 5:4.

I'd like to see some more mesages. Revert to original cvs version.


Please try attached patch and cycle through different aspect
settings of softdevice. Above change is commented out:
  if (xin_mode)
    // displayAspect =
    displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();

We will get lines like:
dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x432]
width x height (MM) 342 x 274
Screen width x height 1280 x 1024
Display width x height 1280 x 1024
xin_screen = 0
par [0] 0.9985
par [1] 1.0000
par [2] 1.0667
par [3] 1.4222
par [4] 1.2800
par [5] 1.3333
dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,6 768x562]
dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x432]
PAR idx changed 1 -> 2
dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,56 768x461]
PAR idx changed 2 -> 3
dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [24,0 720x576]


-- 
Stefan Lucke
-------------- next part --------------
Index: video.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video.c,v
retrieving revision 1.76
diff -U3 -r1.76 video.c
--- video.c	12 Jul 2007 16:17:31 -0000	1.76
+++ video.c	6 Oct 2007 13:58:36 -0000
@@ -173,6 +173,12 @@
   parValues [3] = (16.0 /  9.0) / displayRatio;
   parValues [4] = (16.0 / 10.0) / displayRatio;
   parValues [5] = (15.0 /  9.0) / displayRatio;
+fprintf (stderr, "par [0] %1.4lf\n", parValues[0]);
+fprintf (stderr, "par [1] %1.4lf\n", parValues[1]);
+fprintf (stderr, "par [2] %1.4lf\n", parValues[2]);
+fprintf (stderr, "par [3] %1.4lf\n", parValues[3]);
+fprintf (stderr, "par [4] %1.4lf\n", parValues[4]);
+fprintf (stderr, "par [5] %1.4lf\n", parValues[5]);
 }
 
 /* ---------------------------------------------------------------------------
@@ -307,6 +313,9 @@
 
   if (screenPixelAspect != setupStore->screenPixelAspect)
   {
+fprintf(stderr,"PAR idx changed %d -> %d \n",
+        screenPixelAspect, setupStore->screenPixelAspect);
+
     screenPixelAspect = setupStore->screenPixelAspect;
     /* -----------------------------------------------------------------------
      * force recalculation for aspect ration handling
Index: video.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video.h,v
retrieving revision 1.55
diff -U3 -r1.55 video.h
--- video.h	11 Jul 2007 20:08:34 -0000	1.55
+++ video.h	6 Oct 2007 13:58:36 -0000
@@ -36,6 +36,13 @@
 
 #define AVRG_OFF_CNT        16
 
+/* ---------------------------------------------------------------------------
+ */
+static inline int roundI (int i)
+{
+  return (i + 3) & ~3;
+}
+
 #ifndef STAND_ALONE
 class cSoftRemote : public cRemote {
   public:
Index: video-xv.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-xv.c,v
retrieving revision 1.73
diff -U3 -r1.73 video-xv.c
--- video-xv.c	11 Jul 2007 20:08:35 -0000	1.73
+++ video-xv.c	6 Oct 2007 13:58:38 -0000
@@ -476,10 +476,26 @@
   displayAspect = (double) DisplayWidthMM(dpy, DefaultScreen(dpy)) /
                     (double) DisplayHeightMM(dpy, DefaultScreen(dpy));
   if (xin_mode)
+    // displayAspect =
     displayRatio  = (double) GetScreenWidth() / (double) GetScreenHeight();
   else
     displayRatio  = (double) DisplayWidth(dpy, DefaultScreen(dpy)) /
                       (double) DisplayHeight(dpy, DefaultScreen(dpy));
+
+fprintf(stderr,"width x height (MM) %d x %d\n",
+        DisplayWidthMM(dpy, DefaultScreen(dpy)),
+        DisplayHeightMM(dpy, DefaultScreen(dpy)));
+fprintf(stderr,"Screen width x height %d x %d\n",
+         GetScreenWidth(),
+         GetScreenHeight());
+fprintf(stderr,"Display width x height %d x %d\n",
+        DisplayWidth(dpy, DefaultScreen(dpy)),
+        DisplayHeight(dpy, DefaultScreen(dpy)));
+#if XINERAMA_SUPPORT
+if (xin_mode) {
+fprintf(stderr,"xin_screen = %d\n", xin_screen);
+}
+#endif
 
   SetParValues(displayAspect, displayRatio);
 

From stefan at lucke.in-berlin.de  Sat Oct  6 21:20:18 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 6 Oct 2007 21:20:18 +0200
Subject: [Softdevice-devel] Shmclient Fullscreen
In-Reply-To: <1191674560.11643.1.camel@localhost>
References: <1191674560.11643.1.camel@localhost>
Message-ID: <200710062120.18795.stefan@lucke.in-berlin.de>

On Samstag, 6. Oktober 2007, Alexander G?ngel wrote:
> Is it possible to start the ShmClient in Fullscreen.

Sorry. At the moment this is not possible.

> 
> I found some thing that it wasremoved vom cvs.
> 

The original patch, with "-f" option is still available here:
http://cache.gmane.org//gmane/comp/video/vdr/softdevice/534-003.bin

The preferred way of doing this (introducing command line arguments
to ShmClient) is the same style as softdevice. They should read like
"-vo xv:full". By this way, additional output methods can be added.

-- 
Stefan Lucke


From listaccount at e-tobi.net  Sat Oct  6 23:46:36 2007
From: listaccount at e-tobi.net (Tobi)
Date: Sat, 06 Oct 2007 23:46:36 +0200
Subject: [Softdevice-devel] GPL2 or GPL2anylater?
Message-ID: <4708023C.7090908@e-tobi.net>

Hello!

We (the Debian VDR packaging team) are currently checking all VDR
plug-ins, if the correct licenses and copyrights are listed in the
Debian-specific copyright file.

The softdevice plug-in contains a small disclaimer about the GPL in it's
source files and refers to the COPYRIGHT file, but it's not clear, if
the plug-in is licensed under "GPL2" or "GPL2 and any later".

Please consider adding the full license disclaimer as suggested in the
GPL 2 license text after paragraph 12 ("How to Apply These Terms to Your
New Programs"):

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

see also:
    http://www.gnu.org/licenses/old-licenses/gpl-2.0.html#SEC4
    http://www.fsf.org/licensing/licenses/gpl-howto.html

For the moment, we assume, that "GPL2 or any later" can be applied to
this plug-in, if you have no objections.

Thanks,

the Debian VDR Packaging Team



From radi at radylon.com  Sun Oct  7 17:52:48 2007
From: radi at radylon.com (Michael Rademacher)
Date: Sun, 7 Oct 2007 17:52:48 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <200710061611.50493.stefan@lucke.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
	<20071006100432.GA23445@radylon.com>
	<200710061611.50493.stefan@lucke.in-berlin.de>
Message-ID: <20071007155248.GA12071@radylon.com>

Hi,

On Sat, 06.10.07, at 16:12 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> I'd like to see some more mesages. Revert to original cvs version.
> Please try attached patch and cycle through different aspect
> settings of softdevice. Above change is commented out:

Ok. let's see:

root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src# apt-get source vdr-plugin-softdevice
Reading package lists... Done
Building dependency tree
Reading state information... Done
Need to get 199kB of source archives.
Get:1 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (dsc) [939B]
Get:2 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (tar) [191kB]
Get:3 http://e-tobi.net etch/vdr-multipatch vdr-plugin-softdevice 0.4.0-5 (diff) [7296B]
Fetched 199kB in 0s (318kB/s)
dpkg-source: warning: extracting unsigned source package (./vdr-plugin-softdevice_0.4.0-5.dsc)
dpkg-source: extracting vdr-plugin-softdevice in vdr-plugin-softdevice-0.4.0
dpkg-source: unpacking vdr-plugin-softdevice_0.4.0.orig.tar.gz
dpkg-source: applying ./vdr-plugin-softdevice_0.4.0-5.diff.gz


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src# cd vdr-plugin-softdevice-0.4.0/


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# patch <~/shm-test-01.diff
patching file video.c
Hunk #1 succeeded at 172 (offset -1 lines).
Hunk #2 succeeded at 312 (offset -1 lines).
patching file video.h
patching file video-xv.c


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# ./configure --disable-vidix --disable-fb --disable-dfb --disable-cle266 --disable-oss --disable-yaepg
Testing system and cpu type... found Linux on i386 cpu.
Checking for pkg-config... Found.
Checking for ffmpeg... Ok.
Checking for ALSA sound... Enabled audio-alsa.
Checking for OSS sound... Not Found.
Checking for linux frambuffer... Not Found.
Checking for DirectFB and DFB++... Not Found.
Checking for vidix... Not found.
Checking for Xv... Enabled video-xv.
Checking for Xinerama... Enabled Xinerama.
Creating temporary config.h and config.mak
updated config.h
updated config.mak
Configure is finished. Please check config.log in case of problems.

No errors in config.log


root at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/vdr-plugin-softdevice-0.4.0# make ShmClient
[...]

Ok.


> We will get lines like:
> dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x432]

Yes. See attached file. However, nothing changes at your debug parameters.

Do we talk about the same? I do *not* use the version from CVS at
cvs.softdevice.berlios.de. I use the one that comes from e-tobi.net. I
always only built ShmClient and nothing else.

I tried the CVS version and was able to compile ShmClient. But, when I start
ShmClient it complains about the shared memory:

werkstatt at zentrale:/usr/src/vdr/vdr-1.4.7/PLUGINS/src/softdevice$ ./ShmClient
ctl_shmid error in shmget!
Check if vdr and the softdevice are running with the option -vo shm:

Perhaps it should have worked if I built the whole plugin from CVS. That's
what I'll try next.


Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071007/e92fdff9/attachment.pgp>

From radi at radylon.com  Sun Oct  7 17:54:22 2007
From: radi at radylon.com (Michael Rademacher)
Date: Sun, 7 Oct 2007 17:54:22 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071007155248.GA12071@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
	<20071006100432.GA23445@radylon.com>
	<200710061611.50493.stefan@lucke.in-berlin.de>
	<20071007155248.GA12071@radylon.com>
Message-ID: <20071007155422.GB12071@radylon.com>

Hi,

On Sun, 07.10.07, at 17:52 Michael Rademacher <radi at radylon.com> wrote:

> Yes. See attached file.

Well, now it's attached...

Sorry - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ShmClient-output.tgz
Type: application/x-gtar
Size: 1068 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071007/c4fe8c1c/attachment.tgz>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071007/c4fe8c1c/attachment.pgp>

From zzam at gentoo.org  Sun Oct  7 18:03:11 2007
From: zzam at gentoo.org (Matthias Schwarzott)
Date: Sun, 7 Oct 2007 18:03:11 +0200
Subject: [Softdevice-devel] [PATCH] shm init in incorrect order [was:
	ShmClient: XvVideoOut.Reconfigure format > 3!]
In-Reply-To: <200707121214.48028.zzam@gentoo.org>
References: <200705221311.54727.zzam@gentoo.org>
	<200707121214.48028.zzam@gentoo.org>
Message-ID: <200710071803.12096.zzam@gentoo.org>

On Donnerstag, 12. Juli 2007, Matthias Schwarzott wrote:
> On Dienstag, 22. Mai 2007, Matthias Schwarzott wrote:
> > Hi there!
> >
> > Using latest cvs snapshot, and starting vdr with:
> > vdr -Psoftdevice" -vo shm:" [... other options]
> >
> > and then starting ShmClient gets me this output (of ShmClient):
> >
> > dsyslog:[XvVideoOut]: patch version (2006-11-05)
> > [XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
> > dsyslog:[XvVideoOut]: Initialize XShmCreateImage Successful (0x80be610)
> > [XvVideoOut]: osd_image shmid = 229379
> > dsyslog:[XvVideoOut]: Initialize shmget Successful (2949120 bytes)
> > dsyslog:[XvVideoOut]: Initialize shmat Successful
> > [XvVideoOut]: got osd_image: width 1280 height 1024, bytes per line 5120,
> > Bpp 32
> > dsyslog:[softdevice-xscreensaver]: xscreensaver not running
> >
> > dsyslog:[XvVideoOut]: initialized OK
> > XvVideoOut.Reconfigure format > 3!
> > [XvVideoOut]: Xinerama-Screen changed to 0
> > dsyslog:[VideoOut]: 736x576 [0,0 736x576] -> 1024x576 [122,0 778x576]
> > XvVideoOut.Reconfigure format > 3!
> > reconfigure failed
> > dsyslog:[VideoOut]: resolution changed: W(736 -> 528); H(576 ->576)
> >
> > dsyslog:[VideoOut]: 528x576 [0,0 528x576] -> 1024x576 [132,0 759x576]
> > XvVideoOut.Reconfigure format > 3!
> > reconfigure failed
> > XvVideoOut.Reconfigure format > 3!
> > reconfigure failed
> >
> >
> >
> >
> > audio starts, but video is just black. The last two lines loop endlessly.
> > Stopping and restarting ShmClient does not change anything.
> >
> > Stopping vdr, and then starting it DOES help.
> > It can be reproduced then by stopping vdr, deleting the shared memory
> > region, and starting it.
> > Some debugging showed me that the pixelformat var had the value 14 ?!?
>
> Debugged the problem further:
> Starting softdevice with shm output and no shm segment exists:
> cPluginSoftDevice starts, does net get a shm segment.
> Thus it creates the setupStore, but cannot write the Shmid of it into
> normal shm segment.
> Later video-shm is started, and does create the shm segment.
>
>
> Needed now is some way to put the shmid of setupStore in the shm segment.
> The attached patch is a bit a hack, as it stores the shmid of setupStore
> inside setupStore (as this is the only place it seems the subplugin
> video-shm can access).
>

ping, almost three month since I discovered this bug - and nobody seems to 
care :(

Matthias



-- 
Matthias Schwarzott (zzam)


From stefan at lucke.in-berlin.de  Sun Oct  7 20:49:53 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun,  7 Oct 2007 20:49:53 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <20071007155248.GA12071@radylon.com>
References: <20071004162142.GA15672@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
	<20071006100432.GA23445@radylon.com>
	<200710061611.50493.stefan@lucke.in-berlin.de>
	<20071007155248.GA12071@radylon.com>
Message-ID: <1191782993.47092a5116b7d@webmail.in-berlin.de>

Quoting Michael Rademacher <radi at radylon.com>:
> Hi,
>
> On Sat, 06.10.07, at 16:12 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:
>


> > We will get lines like:
> > dsyslog:[VideoOut]: 720x576 [0,0 720x576] -> 768x576 [0,72 768x432]
>
> Yes. See attached file. However, nothing changes at your debug parameters.
>
> Do we talk about the same?

I guess not.

> I do *not* use the version from CVS at
> cvs.softdevice.berlios.de. I use the one that comes from e-tobi.net.

So you can check if the CHANGELOG of these source package has the
entry from 2007-05-10 or newer ones.

> I
> always only built ShmClient and nothing else.
>
> I tried the CVS version and was able to compile ShmClient. But, when I start
> ShmClient it complains about the shared memory:

You should switch to cvs version and build plugin and client.


Stefan Lucke


From radi at radylon.com  Mon Oct  8 09:03:31 2007
From: radi at radylon.com (Michael Rademacher)
Date: Mon, 8 Oct 2007 09:03:31 +0200
Subject: [Softdevice-devel] Problems with nvidia TwinView and ShmClient
In-Reply-To: <1191782993.47092a5116b7d@webmail.in-berlin.de>
References: <20071004162142.GA15672@radylon.com>
	<200710060912.55649.stefan@lucke.in-berlin.de>
	<20071006100432.GA23445@radylon.com>
	<200710061611.50493.stefan@lucke.in-berlin.de>
	<20071007155248.GA12071@radylon.com>
	<1191782993.47092a5116b7d@webmail.in-berlin.de>
Message-ID: <20071008070330.GD5756@radylon.com>

Hi,

On Sun, 07.10.07, at 20:50 Stefan Lucke <stefan at lucke.in-berlin.de> wrote:

> > I do *not* use the version from CVS at
> > cvs.softdevice.berlios.de. I use the one that comes from e-tobi.net.
> 
> So you can check if the CHANGELOG of these source package has the
> entry from 2007-05-10 or newer ones.

Last entry is of 2007-04-11.

> You should switch to cvs version and build plugin and client.

I'll try my best.

Kind regards - Michael Rademacher.

-- 
====================================================================//====
 Michael Rademacher     fon +49-4103-8036388       RADYLON Netzwerkdesign
 Schillerstr. 31        fax +49-4103-8036389      http://www.radylon.com/
 D-22880 Wedel          gsm +49-170-4543911       eMail: radi at radylon.com
 GPG Key fingerprint = C713 8AA0 8EE7 4B02 73A6  0948 EA48 B6CD 55CB 7337
==========================================================================
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071008/5136f5ec/attachment.pgp>

From Neumann at do-net.de  Wed Oct 10 22:42:54 2007
From: Neumann at do-net.de (Andre Neumann)
Date: Wed, 10 Oct 2007 22:42:54 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D03901A194@sbs2003.do-net.de>

Hi,
 
i have problems running softdevice with vidix enabled with HD Stations. When i switch to an HD channel, i get the following (complete log):
 
(none):/usr/local/src/VDR # ./vdr -c /etc/vdr -v /video0/ -P'softdevice -vo vidix:'
softdevice: Created setupStoreId 131073!
softdevice: Attatched to setupStoreId 131073 at 0x40019000.
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[setup-softdevice] alsa ac3Mode set to: 1
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (-2)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 2 (16:9)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 6 median
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 0
[setup-softdevice] setting alpha blend mode to pseudo
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 55
[setup-softdevice] vidContrast: 55
[setup-softdevice] vidHue: 47
[setup-softdevice] vidSaturation: 47
[setup-softdevice] startup aspect set to (4:3 normal)
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3352064)
22:36:43.0590 I [5193] [cVidixVideoOut] DirectColor FB found
22:36:43.0590 I [5193] [cVidixVideoOut] xres = 1920 yres= 1080
22:36:43.0590 I [5193] [cVidixVideoOut] line length = 7680
22:36:43.0591 I [5193] [cVidixVideoOut] bpp = 32
22:36:43.0599 I [5193] [cVidixVideoOut] vidix version: 100
[mga] Can't find chip
[mga] Can't find chip
[mga] Can't find chip
Radeon_vid: Found chip: RV370 5B60 [Radeon X300 (PCIE)]
Radeon_vid: Video memory = 128Mb
Radeon_vid: Set write-combining type of video memory
Radeon_vid: DVI port has DFP monitor connected
Radeon_vid: CRT port has no monitor connected
libdha: Can't open /dev/dhahelper
22:36:43.0606 I [5193] [cVidixVideoOut] capabilities:  0x2030
22:36:43.0606 I [5193] [cVidixVideoOut] fourcc.flags:  0xf
22:36:43.0606 I [5193] [cVidixVideoOut] set colorkey
22:36:43.0606 I [5193] [cVidixVideoOut] vdlSetGrKeys() = 0
22:36:43.0607 I [5193] [cVidixVideoOut] capabilities
22:36:43.0607 I [5193] [cVidixVideoOut] EQ cap: 1f:
22:36:43.0607 I [5193] [cVidixVideoOut]  brightness (0)
22:36:43.0607 I [5193] [cVidixVideoOut]  contrast (0)
22:36:43.0607 I [5193] [cVidixVideoOut]  saturation (0)
22:36:43.0607 I [5193] [cVidixVideoOut]  hue (0)
22:36:43.0607 I [5193] [cVidixVideoOut]  RGB-intensity (0, 0, 0)
22:36:43.0607 I [5193] [cVidixVideoOut]  HW-deinterlace (8,900aaaaa)
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
22:36:46.0183 I [5202] [cVidixVideoOut] Video changed format to 736x576
22:36:46.0183 I [5202] [cVidixVideoOut] set colorkey
22:36:46.0183 I [5202] [cVidixVideoOut] vdlSetGrKeys() = 0
22:36:46.0184 I [5202] [cVidixVideoOut] set eq values
video: synced early
22:36:46.0373 D [5207] [VideoOut] reset: sync info: repF = 0, drpF = 0, totF = 0
ALSA lib pcm.c:1962:(snd_pcm_open_noupdate) Unknown PCM CH2
allocating buffer format orig->format 0
22:36:47.0243 I [5210] [cVidixVideoOut] Video changed format to 704x576
22:36:47.0243 I [5210] [cVidixVideoOut] set colorkey
22:36:47.0243 I [5210] [cVidixVideoOut] vdlSetGrKeys() = 0
22:36:49.0724 D [5210] [VideoOut] video now synced (54 - -251)
audio: synced early
22:36:55.0344 D [5216] [softdevice-audio]: Xrun (at least 632.158 ms long)
22:36:55.0742 D [5214] [VideoOut] reset: sync info: repF = 52, drpF = 0, totF = 173
[mpeg2video @ 0x406d8488]skipped MB in I frame at 71 6
[mpeg2video @ 0x406d8488]skipped MB in I frame at 16 10
[mpeg2video @ 0x406d8488]skipped MB in I frame at 30 20
[mpeg2video @ 0x406d8488]ac-tex damaged at 29 23
[mpeg2video @ 0x406d8488]ac-tex damaged at 8 63
[mpeg2video @ 0x406d8488]Warning MVs not available
[mpeg2video @ 0x406d8488]concealing 300 DC, 300 AC, 300 MV errors
[mpeg2video @ 0x406d8488]concealing 300 DC, 300 AC, 300 MV errors
[mpeg2video @ 0x406d8488]concealing 300 DC, 300 AC, 300 MV errors
[mpeg2video @ 0x406d8488]slice mismatch
[mpeg2video @ 0x406d8488]ac-tex damaged at 119 14
[mpeg2video @ 0x406d8488]mb incr damaged
[mpeg2video @ 0x406d8488]slice mismatch
[mpeg2video @ 0x406d8488]Warning MVs not available
[mpeg2video @ 0x406d8488]concealing 290 DC, 290 AC, 290 MV errors
allocating buffer format orig->format 0
22:36:55.0998 I [5217] [cVidixVideoOut] Video changed format to 1920x1088
22:36:55.0998 E [5217] [cVidixVideoOut] Can't configure playback: Function not implemented exiting

 
Is there some kind of limitation with vidix ??
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071010/6dc65b96/attachment.html>

From stefan at lucke.in-berlin.de  Thu Oct 11 10:55:41 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 11 Oct 2007 10:55:41 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
In-Reply-To: <FB3B5DB3197CEA429E5FB8E83D01D03901A194@sbs2003.do-net.de>
References: <FB3B5DB3197CEA429E5FB8E83D01D03901A194@sbs2003.do-net.de>
Message-ID: <1192092941.470de50d57cf7@webmail.in-berlin.de>

Quoting Andre Neumann <Neumann at do-net.de>:

> allocating buffer format orig->format 0
> 22:36:55.0998 I [5217] [cVidixVideoOut] Video changed format to 1920x1088
> 22:36:55.0998 E [5217] [cVidixVideoOut] Can't configure playback: Function not implemented
> exiting
>
>
> Is there some kind of limitation with vidix ??
>

Yes.
These are width limits for some supported fourcc formats.

from :
http://vidix.svn.sourceforge.net/viewvc/vidix/trunk/vidix/vidix/drivers/radeon_vid.c?revision=301&view=markup

 1456   { IMGFMT_YV12, 1567 },
 1457   { IMGFMT_I420, 1567 },
 1458   { IMGFMT_IYUV, 1567 },
 1459   { IMGFMT_UYVY, 1551 },
 1460   { IMGFMT_YUY2, 1551 },

Stefan





From Neumann at do-net.de  Thu Oct 11 11:10:12 2007
From: Neumann at do-net.de (Andre Neumann)
Date: Thu, 11 Oct 2007 11:10:12 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D0391A498E@sbs2003.do-net.de>

Is that a limit of the hardware? With DirectFB HD channels are ok.
Any change to change this limits simply by editing them? 

-------------
Andre Neumann

Quoting Andre Neumann <Neumann at do-net.de>:

> allocating buffer format orig->format 0
> 22:36:55.0998 I [5217] [cVidixVideoOut] Video changed format to 
> 1920x1088
> 22:36:55.0998 E [5217] [cVidixVideoOut] Can't configure playback: 
> Function not implemented exiting
>
>
> Is there some kind of limitation with vidix ??
>

Yes.
These are width limits for some supported fourcc formats.

from :
http://vidix.svn.sourceforge.net/viewvc/vidix/trunk/vidix/vidix/drivers/
radeon_vid.c?revision=301&view=markup

 1456   { IMGFMT_YV12, 1567 },
 1457   { IMGFMT_I420, 1567 },
 1458   { IMGFMT_IYUV, 1567 },
 1459   { IMGFMT_UYVY, 1551 },
 1460   { IMGFMT_YUY2, 1551 },

Stefan



_______________________________________________
Softdevice-devel mailing list
Softdevice-devel at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/softdevice-devel





From stefan at lucke.in-berlin.de  Thu Oct 11 12:42:48 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Thu, 11 Oct 2007 12:42:48 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
In-Reply-To: <FB3B5DB3197CEA429E5FB8E83D01D0391A498E@sbs2003.do-net.de>
References: <FB3B5DB3197CEA429E5FB8E83D01D0391A498E@sbs2003.do-net.de>
Message-ID: <1192099368.470dfe2823a9e@webmail.in-berlin.de>

Quoting Andre Neumann <Neumann at do-net.de>:

> Is that a limit of the hardware? With DirectFB HD channels are ok.
> Any change to change this limits simply by editing them?

You can try to change the limits. Perhaps they are dependent
of the chip type, In your case:
Radeon_vid: Found chip: RV370 5B60 [Radeon X300 (PCIE)]

X11 and DirectFB have limits of 2048x2048.

My R280 had some issues last time I tried HD demo files with X11.
They seem to be truncated to the right, so some 1567 limit
looks reasonable. Have to do a DirectFB test.

>
> -------------
> Andre Neumann
>
> Quoting Andre Neumann <Neumann at do-net.de>:
>
> > allocating buffer format orig->format 0
> > 22:36:55.0998 I [5217] [cVidixVideoOut] Video changed format to
> > 1920x1088
> > 22:36:55.0998 E [5217] [cVidixVideoOut] Can't configure playback:
> > Function not implemented exiting
> >
> >
> > Is there some kind of limitation with vidix ??
> >
>
> Yes.
> These are width limits for some supported fourcc formats.
>
> from :
> http://vidix.svn.sourceforge.net/viewvc/vidix/trunk/vidix/vidix/drivers/
> radeon_vid.c?revision=301&view=markup
>
>  1456   { IMGFMT_YV12, 1567 },
>  1457   { IMGFMT_I420, 1567 },
>  1458   { IMGFMT_IYUV, 1567 },
>  1459   { IMGFMT_UYVY, 1551 },
>  1460   { IMGFMT_YUY2, 1551 },
>
> Stefan
>

Stefan


From stefan at lucke.in-berlin.de  Sat Oct 13 12:09:44 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 13 Oct 2007 12:09:44 +0200
Subject: [Softdevice-devel] Loop when jumping to cut marks ?
In-Reply-To: <200710051249.29482.stefan@lucke.in-berlin.de>
References: <200710041758.31353.stefan@lucke.in-berlin.de>
	<200710051249.29482.stefan@lucke.in-berlin.de>
Message-ID: <200710131209.44685.stefan@lucke.in-berlin.de>

On Freitag, 5. Oktober 2007, Stefan Lucke wrote:
> On Donnerstag, 4. Oktober 2007, Stefan Lucke wrote:
> > Hi,
> > 
> > hopefully ml works again.
> > 
> > I noticed a problem which happens now with several vdr versions 1.4.0, 1.5.5, 1.5.9.
> > When trying to jump to cut marks of recordings, vdr enters a loop.
> > The first glance OSD seems still to be responsive.
> 
> We loop in decoding still picture. For some reason ffmpeg changed their
> api :-) and now it is possible that when avcodec_decode_video() is
> called with buffer and length 4, it may return 0 bytes consumed from 
> decode buffer. That happend on 2007-08-02:
> 
> http://svn.mplayerhq.hu/ffmpeg/trunk/libavcodec/mpeg12.c?view=diff&r1=9869&r2=9870
> 
> Lets see what fmpeg people think of attached patch.
> If they say no I fix (work around that) in mpeg2decoder.c

It is now fixed in ffmpeg:
http://lists.mplayerhq.hu/pipermail/ffmpeg-devel/2007-October/036665.html
http://lists.mplayerhq.hu/pipermail/ffmpeg-cvslog/2007-October/009920.html

Ffmpegs svn versions >= 9870 and < 10720 have this error.

-- 
Stefan Lucke


From admin at berlios.de  Sat Oct 13 12:31:51 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 13 Oct 2007 12:31:51 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #12090] softplay: problems with recent
	ffmpeg snapshot
Message-ID: <200710131031.l9DAVpAI022344@unicorn.berlios.de>

Bug #12090, was updated on 2007-Sep-27 21:46
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: None
Status: Closed
Resolution: Fixed
Bug Group: None
Priority: 5
Submitted by: blueman
Assigned to : none
Summary: softplay: problems with recent ffmpeg snapshot

Details: Hi,

I have problems with softplay when I use a newer ffmpeg version.

compiling:
Plugin softplay:
make[1]: Entering directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
make[1]: Leaving directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
make[1]: Entering directory `/multimedia/src/vdr-1.5.2/PLUGINS/src/softplay'
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  softplay.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  SoftPlayer.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
SoftPlayer.c: In member function 'int cSoftPlayer::GetPlayMode(AVFormatContext*)':
SoftPlayer.c:380: warning: comparison between signed and unsigned integer expressions
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  PlayList.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  PlayListMenu.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  i18n.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  FileIndex.c
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  Receiver.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -c -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softplay"' -I../../../include -I../../../../DVB/include -I/usr/include/ffmpeg/ -I/usr/include/ffmpeg//libavformat -I/usr/include/ffmpeg//libavcodec -I/usr/include/ffmpeg//libavutil  Setup.c
/usr/include/ffmpeg/avcodec.h:2246: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
/usr/include/ffmpeg/avcodec.h:2256: warning: 'ImgReSampleContext' is deprecated (declared at /usr/include/ffmpeg/avcodec.h:2240)
g++ -g -O2 -fPIC -Wall -Woverloaded-virtual   -shared softplay.o SoftPlayer.o PlayList.o PlayListMenu.o i18n.o FileIndex.o Receiver.o Setup.o -L/usr/include/ffmpeg/ -L/usr/include/ffmpeg//libavformat -L/usr/include/ffmpeg//libavcodec -L/usr/include/ffmpeg//libavutil -lavformat -lavcodec -lz -lavutil -o libvdr-softplay.so

when starting vdr:
vdr: ./PLUGINS/lib/libvdr-softplay.so.1.5.1: undefined symbol: _Z15av_register_allv

softdevice (cvs today) runs fine...

thanks

Follow-Ups:

Date: 2007-Oct-13 12:31
By: lucke

Comment:
Slightly modified version of softplay patch is now in cvs.

Stefan
-------------------------------------------------------

Date: 2007-Oct-02 18:40
By: blueman

Comment:
Hi,

ok thanks,
I used the SoftPlayer.c patch an only this one, not the one for ffmpeg. Everything seems to be working. :)


-------------------------------------------------------

Date: 2007-Sep-30 17:34
By: lucke

Comment:
I'm seeing a similar problem (described on the ml, accessable via web only). It seems to caused by softdevice, setting AVFMT_NOFILE for format mpeg. De / reasserting this flag in softplay ake some avi's play again, but mp3 playback is still inop.
Index: SoftPlayer.c
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.c,v
retrieving revision 1.16
diff -n -b -U3 -r1.16 SoftPlayer.c
cvs server: conflicting specifications of output style
--- SoftPlayer.c        12 Mar 2007 21:32:03 -0000      1.16
+++ SoftPlayer.c        30 Sep 2007 14:54:43 -0000
@@ -445,14 +445,20 @@
        };

         printf("open file '%s'\n",filename);
+AVInputFormat *fmt;
+fmt=av_find_input_format("mpeg");
+fmt->flags &= ~AVFMT_NOFILE;
         char str[60];
-        if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        //if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        if ( (ret=av_open_input_file( &ic, filename, NULL, FFM_PACKET_SIZE, NULL)) ) {
                 snprintf(str,60,"%s %s!","Could not open file",filename);
-                Skins.Message(mtError, str);
+                //Skins.Message(mtError, str);
                 printf("could not open file. Return value %d\n",ret);
                 ic=0;
+fmt->flags |= AVFMT_NOFILE;
                 return;
         };
+fmt->flags |= AVFMT_NOFILE;

         if ( av_find_stream_info( ic ) ) {
                 printf("could not find stream info\n");

-------------------------------------------------------

Date: 2007-Sep-30 16:54
By: lucke

Comment:
I'm seeing a similar problem (described on the ml, accessable via web only). It seems to caused by softdevice, setting AVFMT_NOFILE for format mpeg. De / reasserting this flag in softplay ake some avi's play again, but mp3 playback is still inop.
Index: SoftPlayer.c
===================================================================
RCS file: /cvsroot/softdevice/softplay/SoftPlayer.c,v
retrieving revision 1.16
diff -n -b -U3 -r1.16 SoftPlayer.c
cvs server: conflicting specifications of output style
--- SoftPlayer.c        12 Mar 2007 21:32:03 -0000      1.16
+++ SoftPlayer.c        30 Sep 2007 14:54:43 -0000
@@ -445,14 +445,20 @@
        };

         printf("open file '%s'\n",filename);
+AVInputFormat *fmt;
+fmt=av_find_input_format("mpeg");
+fmt->flags &= ~AVFMT_NOFILE;
         char str[60];
-        if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        //if ( (ret=av_open_input_file( &ic, filename, NULL, 0, NULL)) ) {
+        if ( (ret=av_open_input_file( &ic, filename, NULL, FFM_PACKET_SIZE, NULL)) ) {
                 snprintf(str,60,"%s %s!","Could not open file",filename);
-                Skins.Message(mtError, str);
+                //Skins.Message(mtError, str);
                 printf("could not open file. Return value %d\n",ret);
                 ic=0;
+fmt->flags |= AVFMT_NOFILE;
                 return;
         };
+fmt->flags |= AVFMT_NOFILE;

         if ( av_find_stream_info( ic ) ) {
                 printf("could not find stream info\n");

-------------------------------------------------------

Date: 2007-Sep-29 20:27
By: blueman

Comment:
Hi,

I made an cvs update and now vdr ist starting with softplay, but when I start a file vdr crashes with the following error:

PLDBG: Activate 1 
PLDBG: Thread started: SoftPlayer
softdevicePlugin 0x81e6a10
Service 'softdevice-GetPacketHandles-v1.0'
IsStream .mpg
open file '/multimedia/media/testfile.mpg'
(!) [ 7848:    0.000] --> Caught signal 11 (at (nil), invalid address) <--
Aborted


-------------------------------------------------------

Date: 2007-Sep-28 17:55
By: lucke

Comment:
Please do a cvs update to get the fix.

Stefan
-------------------------------------------------------

Date: 2007-Sep-27 22:42
By: blueman

Comment:
Update:

I found out, that I had a old libvdr-softplay in the lib folder, now I deleted this file but at compiling I get the same as above, but it doesnt create a new  ibvdr-softplay.so.1.5.1 file.

strane...
-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=12090&group_id=2051


From stefan at lucke.in-berlin.de  Sat Oct 13 13:19:15 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sat, 13 Oct 2007 13:19:15 +0200
Subject: [Softdevice-devel] [PATCH] shm init in incorrect order [was:
	ShmClient: XvVideoOut.Reconfigure format > 3!]
In-Reply-To: <200710071803.12096.zzam@gentoo.org>
References: <200705221311.54727.zzam@gentoo.org>
	<200707121214.48028.zzam@gentoo.org>
	<200710071803.12096.zzam@gentoo.org>
Message-ID: <200710131319.15868.stefan@lucke.in-berlin.de>

On Sonntag, 7. Oktober 2007, Matthias Schwarzott wrote:
> On Donnerstag, 12. Juli 2007, Matthias Schwarzott wrote:
> > On Dienstag, 22. Mai 2007, Matthias Schwarzott wrote:
> > > Hi there!
> > >
> > > Using latest cvs snapshot, and starting vdr with:
> > > vdr -Psoftdevice" -vo shm:" [... other options]
> > >
> > > and then starting ShmClient gets me this output (of ShmClient):
> > >
> > > dsyslog:[XvVideoOut]: patch version (2006-11-05)
> > > [XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
> > > dsyslog:[XvVideoOut]: Initialize XShmCreateImage Successful (0x80be610)
> > > [XvVideoOut]: osd_image shmid = 229379
> > > dsyslog:[XvVideoOut]: Initialize shmget Successful (2949120 bytes)
> > > dsyslog:[XvVideoOut]: Initialize shmat Successful
> > > [XvVideoOut]: got osd_image: width 1280 height 1024, bytes per line 5120,
> > > Bpp 32
> > > dsyslog:[softdevice-xscreensaver]: xscreensaver not running
> > >
> > > dsyslog:[XvVideoOut]: initialized OK
> > > XvVideoOut.Reconfigure format > 3!
> > > [XvVideoOut]: Xinerama-Screen changed to 0
> > > dsyslog:[VideoOut]: 736x576 [0,0 736x576] -> 1024x576 [122,0 778x576]
> > > XvVideoOut.Reconfigure format > 3!
> > > reconfigure failed
> > > dsyslog:[VideoOut]: resolution changed: W(736 -> 528); H(576 ->576)
> > >
> > > dsyslog:[VideoOut]: 528x576 [0,0 528x576] -> 1024x576 [132,0 759x576]
> > > XvVideoOut.Reconfigure format > 3!
> > > reconfigure failed
> > > XvVideoOut.Reconfigure format > 3!
> > > reconfigure failed
> > >
> > >
> > >
> > >
> > > audio starts, but video is just black. The last two lines loop endlessly.
> > > Stopping and restarting ShmClient does not change anything.
> > >
> > > Stopping vdr, and then starting it DOES help.
> > > It can be reproduced then by stopping vdr, deleting the shared memory
> > > region, and starting it.
> > > Some debugging showed me that the pixelformat var had the value 14 ?!?
> >
> > Debugged the problem further:
> > Starting softdevice with shm output and no shm segment exists:
> > cPluginSoftDevice starts, does net get a shm segment.
> > Thus it creates the setupStore, but cannot write the Shmid of it into
> > normal shm segment.
> > Later video-shm is started, and does create the shm segment.
> >
> >
> > Needed now is some way to put the shmid of setupStore in the shm segment.
> > The attached patch is a bit a hack, as it stores the shmid of setupStore
> > inside setupStore (as this is the only place it seems the subplugin
> > video-shm can access).
> >
> 
> ping, almost three month since I discovered this bug - and nobody seems to 
> care :(

Thanks, applied.


-- 
Stefan Lucke


From wallak at free.fr  Sat Oct 13 21:44:35 2007
From: wallak at free.fr (wallak at free.fr)
Date: Sat, 13 Oct 2007 21:44:35 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank video...
Message-ID: <1192304675.47112023154a1@imp.free.fr>


This patch seems to be mandatory to get the video back with the last branch. Is
there an other way to solve this problem ?

Is there an h264 support ?

Best Regards,


diff -r -u ffmpeg-20071012/libavformat/mpeg.c
ffmpeg-20071012-mdf/libavformat/mpeg.c
--- ffmpeg-20071012/libavformat/mpeg.c  2007-10-12 14:27:56.000000000 +0200
+++ ffmpeg-20071012-mdf/libavformat/mpeg.c      2007-10-13 00:30:41.000000000
+0200
@@ -305,7 +305,7 @@
                 header_len -= 5;
             }
         }
-        if (flags & 0x01) { /* PES extension */
+       if ((flags & 0x01) && 0 /*ZZ*/) { /* PES extension */
             pes_ext = get_byte(&s->pb);
             header_len--;
             if (pes_ext & 0x40) { /* pack header - should be zero in PS */


From stefan at lucke.in-berlin.de  Sun Oct 14 11:21:01 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 14 Oct 2007 11:21:01 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank
	video...
In-Reply-To: <1192304675.47112023154a1@imp.free.fr>
References: <1192304675.47112023154a1@imp.free.fr>
Message-ID: <1192353661.4711df7df36e8@webmail.in-berlin.de>

Quoting wallak at free.fr:

>
> This patch seems to be mandatory to get the video back with the last branch.

Softdevice or ffmpeg branch ?
Which branch of them do you use exact ?

The code you modify was introduced with r7853 (2007-02-06).

Actually I'm on ffmpeg r10657 and I do not see problems.
Are your problems during live view or playback of recordings ?


> Is
> there an other way to solve this problem ?
>
> Is there an h264 support ?

I'm waiting for a more stabilized versions of the drivers.
Last time I tested DVB-S2 there were some problems with ffmpeg,
as they didn't support MBAFF/PAFF. That seems to have changed.

Stefan Lucke


From wallak at free.fr  Sun Oct 14 15:12:29 2007
From: wallak at free.fr (wallak at free.fr)
Date: Sun, 14 Oct 2007 15:12:29 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank
	video...
In-Reply-To: <1192353661.4711df7df36e8@webmail.in-berlin.de>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
Message-ID: <1192367549.471215bda0424@imp.free.fr>


I've tried, with the last version available of both ffmpeg and softdevice. I've
tried again with the ffmpeg branch available today r10733. Without the above
patch, I still get a blank video output on all live channels (CNN, etc...). I've
not tried yet, any playback.

Softdevice displays, in that case, and without the patch:
14:43:33.0875 D [13341] [VideoOut] reset: sync info: repF = 0, drpF = 0, totF =
0

A bug, or a configuration incompatibility, seems to be there somewhere. Here is
my configuration:

#### compiler: gcc-4.2.2
#### ffmpeg-20071014-r10733:
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig \
LDFLAGS="-lm" CFLAGS="-O2 -fomit-frame-pointer -mcpu=pentium" CXXFLAGS="-O2
-fomit-frame-pointer -mcpu=pentium" \
"${1:-.}/configure" --prefix=/usr/local \
--enable-shared --disable-static \
--enable-gpl --enable-pthreads \
--enable-libogg --enable-pp \
--enable-liba52 --enable-libfaad --enable-libfaac --enable-libmp3lame
--enable-libvorbis --enable-libxvid --enable-libx264
make


#### softdevice-20071009
       
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig:/usr/local/lib/pkgconfig
\
        CFLAGS="-I/usr/gnome/include -L/usr/gnome/lib -lstdc++" \
        ./configure --disable-cle266 --disable-mmx2


Best Regards,
J. Wallak.




Quoting Stefan Lucke <stefan at lucke.in-berlin.de>:

> Quoting wallak at free.fr:
>
> >
> > This patch seems to be mandatory to get the video back with the last
> branch.
>
> Softdevice or ffmpeg branch ?
> Which branch of them do you use exact ?
>
> The code you modify was introduced with r7853 (2007-02-06).
>
> Actually I'm on ffmpeg r10657 and I do not see problems.
> Are your problems during live view or playback of recordings ?
>
>
> > Is
> > there an other way to solve this problem ?
> >
> > Is there an h264 support ?
>
> I'm waiting for a more stabilized versions of the drivers.
> Last time I tested DVB-S2 there were some problems with ffmpeg,
> as they didn't support MBAFF/PAFF. That seems to have changed.
>
> Stefan Lucke
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>




From stefan at lucke.in-berlin.de  Sun Oct 14 18:01:57 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 14 Oct 2007 18:01:57 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and
	blank	video...
In-Reply-To: <1192367549.471215bda0424@imp.free.fr>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
	<1192367549.471215bda0424@imp.free.fr>
Message-ID: <1192377717.47123d7599249@webmail.in-berlin.de>

Quoting wallak at free.fr:

>
> I've tried, with the last version available of both ffmpeg and softdevice. I've
> tried again with the ffmpeg branch available today r10733. Without the above
> patch, I still get a blank video output on all live channels (CNN, etc...). I've
> not tried yet, any playback.
>
> Softdevice displays, in that case, and without the patch:
> 14:43:33.0875 D [13341] [VideoOut] reset: sync info: repF = 0, drpF = 0, totF =
> 0
>
> A bug, or a configuration incompatibility, seems to be there somewhere. Here is
> my configuration:
>
> #### compiler: gcc-4.2.2
> #### ffmpeg-20071014-r10733:
> PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig \
> LDFLAGS="-lm" CFLAGS="-O2 -fomit-frame-pointer -mcpu=pentium" CXXFLAGS="-O2
> -fomit-frame-pointer -mcpu=pentium" \
> "${1:-.}/configure" --prefix=/usr/local \
> --enable-shared --disable-static \
> --enable-gpl --enable-pthreads \
> --enable-libogg --enable-pp \
> --enable-liba52 --enable-libfaad --enable-libfaac --enable-libmp3lame
> --enable-libvorbis --enable-libxvid --enable-libx264
> make

Ffmpeg options are according to ffplay:
$ ffplay
FFplay version SVN-r10733, Copyright (c) 2003-2007 Fabrice Bellard, et al.
  configuration: --enable-shared --enable-pp --enable-gpl --enable-swscaler --enable-liba52
--enable-libfaac --enable-libfaad
  libavutil version: 49.5.0
  libavcodec version: 51.45.0
  libavformat version: 51.14.0
  built on Oct 14 2007 15:23:37, gcc: 4.1.2 (Gentoo 4.1.2)
usage: ffplay [options] input_file
Simple media player

gcc is:
gcc (GCC) 4.1.2 (Gentoo 4.1.2)


>
>
> #### softdevice-20071009
>
>
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig:/usr/local/lib/pkgconfig
> \
>         CFLAGS="-I/usr/gnome/include -L/usr/gnome/lib -lstdc++" \
>         ./configure --disable-cle266 --disable-mmx2
>
>

I took your configure options for softdevice, ffmpeg r10733, vdr-1.4.0
and I've no problems with live dvb-t and (new-)recordings.


Stefan


From stefan at lucke.in-berlin.de  Sun Oct 14 19:53:59 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 14 Oct 2007 19:53:59 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
In-Reply-To: <1192099368.470dfe2823a9e@webmail.in-berlin.de>
References: <FB3B5DB3197CEA429E5FB8E83D01D0391A498E@sbs2003.do-net.de>
	<1192099368.470dfe2823a9e@webmail.in-berlin.de>
Message-ID: <200710141954.00188.stefan@lucke.in-berlin.de>

On Donnerstag, 11. Oktober 2007, Stefan Lucke wrote:
> Quoting Andre Neumann <Neumann at do-net.de>:
> 
> > Is that a limit of the hardware? With DirectFB HD channels are ok.
> > Any change to change this limits simply by editing them?
> 
> You can try to change the limits. Perhaps they are dependent
> of the chip type, In your case:
> Radeon_vid: Found chip: RV370 5B60 [Radeon X300 (PCIE)]
> 
> X11 and DirectFB have limits of 2048x2048.
> 
> My R280 had some issues last time I tried HD demo files with X11.
> They seem to be truncated to the right, so some 1567 limit
> looks reasonable. Have to do a DirectFB test.

So I did 2 tests (lspic -vv -s 01:00.0 ; see attached files):
  1st rv280:
    This one shows a video truncation on the right side. Both with Xv
    and DirectFB. Rightmost ~300 pixels are pink ;-) .

  2nd rv350
    This one shows no truncation on the right side (Xv and DirectFB).
    And after modifying vidix sources, my samples play untrucated even
    by vidix.

My samples trailer for testing are:
-rw-r--r-- 1 stefan users 291096901 29. Okt 2005  maria_taylor_m1080p.mov
-rw-r--r-- 1 stefan users 267415093 28. Jul 2006  onesixright_1080p.mov

Somewhere available from apple I guess.

I think we should ask vidix people for a change (see attached one)

-- 
Stefan Lucke
-------------- next part --------------
01:00.0 VGA compatible controller: ATI Technologies Inc RV280 [Radeon 9200] (rev 01) (prog-if 00 [VGA])
	Subsystem: Connect Components Ltd Unknown device 2801
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B-
	Status: Cap+ 66MHz+ UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32 (2000ns min), Cache Line Size: 64 bytes
	Interrupt: pin A routed to IRQ 19
	Region 0: Memory at e0000000 (32-bit, prefetchable) [size=256M]
	Region 1: I/O ports at b000 [size=256]
	Region 2: Memory at fe9f0000 (32-bit, non-prefetchable) [size=64K]
	Expansion ROM at fe9c0000 [disabled] [size=128K]
	Capabilities: [58] AGP version 3.0
		Status: RQ=256 Iso- ArqSz=0 Cal=0 SBA+ ITACoh- GART64- HTrans- 64bit- FW+ AGP3+ Rate=x4,x8
		Command: RQ=32 ArqSz=2 Cal=0 SBA+ AGP+ GART64- 64bit- FW- Rate=x4
	Capabilities: [50] Power Management version 2
		Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-

-------------- next part --------------
01:00.0 VGA compatible controller: ATI Technologies Inc RV350 AS [Radeon 9550] (prog-if 00 [VGA])
	Subsystem: Micro-Star International Co., Ltd. 865PE Neo2-V (MS-6788) mainboard
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B-
	Status: Cap+ 66MHz+ UDF- FastB2B+ ParErr- DEVSEL=medium >TAbort- <TAbort- <MAbort- >SERR- <PERR-
	Latency: 32 (2000ns min), Cache Line Size: 64 bytes
	Interrupt: pin A routed to IRQ 19
	Region 0: Memory at e8000000 (32-bit, prefetchable) [size=128M]
	Region 1: I/O ports at b000 [size=256]
	Region 2: Memory at fe9f0000 (32-bit, non-prefetchable) [size=64K]
	Expansion ROM at fe9c0000 [disabled] [size=128K]
	Capabilities: [58] AGP version 3.0
		Status: RQ=256 Iso- ArqSz=0 Cal=0 SBA+ ITACoh- GART64- HTrans- 64bit- FW+ AGP3+ Rate=x4,x8
		Command: RQ=32 ArqSz=2 Cal=0 SBA+ AGP+ GART64- 64bit- FW- Rate=x4
	Capabilities: [50] Power Management version 2
		Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-)
		Status: D0 PME-Enable- DSel=0 DScale=0 PME-

-------------- next part --------------
Index: trunk/vidix/vidix/drivers/radeon_vid.c
===================================================================
--- trunk/vidix/vidix/drivers/radeon_vid.c	(Revision 313)
+++ trunk/vidix/vidix/drivers/radeon_vid.c	(Arbeitskopie)
@@ -1472,8 +1472,9 @@
   unsigned i;
   for(i=0;i<sizeof(supported_fourcc)/sizeof(fourcc_desc_t);i++)
   {
-    if(fourcc==supported_fourcc[i].fourcc &&
-	srcw <=supported_fourcc[i].max_srcw) return 1;
+    if (fourcc == supported_fourcc [i]. fourcc /* &&
+	srcw <= supported_fourcc [i]. max_srcw */ )
+      return 1;
   }
   return 0;
 }

From wallak at free.fr  Sun Oct 14 21:09:18 2007
From: wallak at free.fr (wallak at free.fr)
Date: Sun, 14 Oct 2007 21:09:18 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank
	video...
In-Reply-To: <1192377717.47123d7599249@webmail.in-berlin.de>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
	<1192367549.471215bda0424@imp.free.fr>
	<1192377717.47123d7599249@webmail.in-berlin.de>
Message-ID: <1192388958.4712695e02c39@imp.free.fr>

I've tried further, and everything works as is (without patch) when using
vdr-1.5.9. But I still have the same problem with vdr-1.4.7. Some buggy PES
extension may be generated inside vdr.

Best Regards,
J. Wallak.




Quoting Stefan Lucke <stefan at lucke.in-berlin.de>:

> Quoting wallak at free.fr:
>
> >
> > I've tried, with the last version available of both ffmpeg and softdevice.
> I've
> > tried again with the ffmpeg branch available today r10733. Without the
> above
> > patch, I still get a blank video output on all live channels (CNN, etc...).
> I've
> > not tried yet, any playback.
> >
> > Softdevice displays, in that case, and without the patch:
> > 14:43:33.0875 D [13341] [VideoOut] reset: sync info: repF = 0, drpF = 0,
> totF =
> > 0
> >
> > A bug, or a configuration incompatibility, seems to be there somewhere.
> Here is
> > my configuration:
> >
> > #### compiler: gcc-4.2.2
> > #### ffmpeg-20071014-r10733:
> >
> PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig
> \
> > LDFLAGS="-lm" CFLAGS="-O2 -fomit-frame-pointer -mcpu=pentium" CXXFLAGS="-O2
> > -fomit-frame-pointer -mcpu=pentium" \
> > "${1:-.}/configure" --prefix=/usr/local \
> > --enable-shared --disable-static \
> > --enable-gpl --enable-pthreads \
> > --enable-libogg --enable-pp \
> > --enable-liba52 --enable-libfaad --enable-libfaac --enable-libmp3lame
> > --enable-libvorbis --enable-libxvid --enable-libx264
> > make
>
> Ffmpeg options are according to ffplay:
> $ ffplay
> FFplay version SVN-r10733, Copyright (c) 2003-2007 Fabrice Bellard, et al.
>   configuration: --enable-shared --enable-pp --enable-gpl --enable-swscaler
> --enable-liba52
> --enable-libfaac --enable-libfaad
>   libavutil version: 49.5.0
>   libavcodec version: 51.45.0
>   libavformat version: 51.14.0
>   built on Oct 14 2007 15:23:37, gcc: 4.1.2 (Gentoo 4.1.2)
> usage: ffplay [options] input_file
> Simple media player
>
> gcc is:
> gcc (GCC) 4.1.2 (Gentoo 4.1.2)
>
>
> >
> >
> > #### softdevice-20071009
> >
> >
>
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig:/usr/local/lib/pkgconfig
> > \
> >         CFLAGS="-I/usr/gnome/include -L/usr/gnome/lib -lstdc++" \
> >         ./configure --disable-cle266 --disable-mmx2
> >
> >
>
> I took your configure options for softdevice, ffmpeg r10733, vdr-1.4.0
> and I've no problems with live dvb-t and (new-)recordings.
>
>
> Stefan
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>




From wallak at free.fr  Mon Oct 15 23:42:13 2007
From: wallak at free.fr (wallak at free.fr)
Date: Mon, 15 Oct 2007 23:42:13 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank
	video... [solved: subtitles-0.5.0 bug]
In-Reply-To: <1192388958.4712695e02c39@imp.free.fr>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
	<1192367549.471215bda0424@imp.free.fr>
	<1192377717.47123d7599249@webmail.in-berlin.de>
	<1192388958.4712695e02c39@imp.free.fr>
Message-ID: <1192484533.4713deb55d791@imp.free.fr>

 The bug was introduced by the subtitles-0.5.0 plugin patch. Vdr once patched,
generate invalid PES extension. And so, softdevice/ffmpeg is unable to handle
the stream (the patch given in a previous mail, is only a dirty fix).

Best Regards,
J. Wallak.

PS: new patch to be applied (after the subtitles-0.5.0 one):

--- vdr-1.4.7/remux.c   2007-10-15 23:16:40.000000000 +0200
+++ vdr-1.4.7-mdf/remux.c       2007-10-15 23:13:29.000000000 +0200
@@ -1741,7 +1741,7 @@
                         dataIdentifier = 0;
                         }
                      else {
-                        flag2 |= PES_EXTENSION;
+                      /*flag2 |= PES_EXTENSION;*/
                         }
                      found++;
                      }



Quoting wallak at free.fr:

> I've tried further, and everything works as is (without patch) when using
> vdr-1.5.9. But I still have the same problem with vdr-1.4.7. Some buggy PES
> extension may be generated inside vdr.
>
> Best Regards,
> J. Wallak.
>
>
>
>
> Quoting Stefan Lucke <stefan at lucke.in-berlin.de>:
>
> > Quoting wallak at free.fr:
> >
> > >
> > > I've tried, with the last version available of both ffmpeg and
> softdevice.
> > I've
> > > tried again with the ffmpeg branch available today r10733. Without the
> > above
> > > patch, I still get a blank video output on all live channels (CNN,
> etc...).
> > I've
> > > not tried yet, any playback.
> > >
> > > Softdevice displays, in that case, and without the patch:
> > > 14:43:33.0875 D [13341] [VideoOut] reset: sync info: repF = 0, drpF = 0,
> > totF =
> > > 0
> > >
> > > A bug, or a configuration incompatibility, seems to be there somewhere.
> > Here is
> > > my configuration:
> > >
> > > #### compiler: gcc-4.2.2
> > > #### ffmpeg-20071014-r10733:
> > >
> >
> PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig
> > \
> > > LDFLAGS="-lm" CFLAGS="-O2 -fomit-frame-pointer -mcpu=pentium"
> CXXFLAGS="-O2
> > > -fomit-frame-pointer -mcpu=pentium" \
> > > "${1:-.}/configure" --prefix=/usr/local \
> > > --enable-shared --disable-static \
> > > --enable-gpl --enable-pthreads \
> > > --enable-libogg --enable-pp \
> > > --enable-liba52 --enable-libfaad --enable-libfaac --enable-libmp3lame
> > > --enable-libvorbis --enable-libxvid --enable-libx264
> > > make
> >
> > Ffmpeg options are according to ffplay:
> > $ ffplay
> > FFplay version SVN-r10733, Copyright (c) 2003-2007 Fabrice Bellard, et al.
> >   configuration: --enable-shared --enable-pp --enable-gpl --enable-swscaler
> > --enable-liba52
> > --enable-libfaac --enable-libfaad
> >   libavutil version: 49.5.0
> >   libavcodec version: 51.45.0
> >   libavformat version: 51.14.0
> >   built on Oct 14 2007 15:23:37, gcc: 4.1.2 (Gentoo 4.1.2)
> > usage: ffplay [options] input_file
> > Simple media player
> >
> > gcc is:
> > gcc (GCC) 4.1.2 (Gentoo 4.1.2)
> >
> >
> > >
> > >
> > > #### softdevice-20071009
> > >
> > >
> >
>
PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/X11R6/lib/pkgconfig:/usr/lib/pkgconfig:/usr/local/lib/pkgconfig
> > > \
> > >         CFLAGS="-I/usr/gnome/include -L/usr/gnome/lib -lstdc++" \
> > >         ./configure --disable-cle266 --disable-mmx2
> > >
> > >
> >
> > I took your configure options for softdevice, ffmpeg r10733, vdr-1.4.0
> > and I've no problems with live dvb-t and (new-)recordings.
> >
> >
> > Stefan
> > _______________________________________________
> > Softdevice-devel mailing list
> > Softdevice-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/softdevice-devel
> >
>
>
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel
>




From ollo.diab at gmx.de  Tue Oct 16 20:50:54 2007
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Tue, 16 Oct 2007 20:50:54 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and
	blank	video...
In-Reply-To: <1192353661.4711df7df36e8@webmail.in-berlin.de>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
Message-ID: <20071016185054.192040@gmx.net>


-------- Original-Nachricht --------
> Datum: Sun, 14 Oct 2007 11:21:01 +0200
> Von: Stefan Lucke <stefan at lucke.in-berlin.de>
> An: softdevice-devel at lists.berlios.de
> Betreff: Re: [Softdevice-devel] last softdevice/ffmpeg branch and blank	video...

> >
> > Is there an h264 support ?
> 
> I'm waiting for a more stabilized versions of the drivers.
> Last time I tested DVB-S2 there were some problems with ffmpeg,
> as they didn't support MBAFF/PAFF. That seems to have changed.
> 

DVB-S2 driver runs reasonable well already! But ffmpeg PAFF still lacks some interlaced feature support. This is what I get while streaming TS to mplayer (from cvs) - like Sat.1 HD:
[h264 @ 0xdeb420]Interlaced pictures + spatial direct mode is not implemented

Anyhow, while we are that topic, any chance to get ffmpeg multi threading support enabled? Again, while running mplayer -lavdopts threads=2, it works well on my low power dual core CPU (AMD Athlon BE-2350).

Regards,  Thomas
-- 
GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail


From ollo.diab at gmx.de  Tue Oct 16 20:56:19 2007
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Tue, 16 Oct 2007 20:56:19 +0200
Subject: [Softdevice-devel] Bug: playback option
In-Reply-To: <200710141954.00188.stefan@lucke.in-berlin.de>
References: <FB3B5DB3197CEA429E5FB8E83D01D0391A498E@sbs2003.do-net.de>
	<1192099368.470dfe2823a9e@webmail.in-berlin.de>
	<200710141954.00188.stefan@lucke.in-berlin.de>
Message-ID: <20071016185619.192040@gmx.net>

Hi,

I have an issue with current cvs softdevice plugin. If I hit the option "Playback" and enable "suspend" live TV freezes, but I can never enable it again through the OSD. I have to manually modify setup.conf to go out of suspend mode.

Does anyone see this was well?

Thanks & regards,  Thomas

-- 
Psssst! Schon vom neuen GMX MultiMessenger geh?rt?
Der kanns mit allen: http://www.gmx.net/de/go/multimessenger


From rahrenbe at cc.hut.fi  Tue Oct 16 23:44:59 2007
From: rahrenbe at cc.hut.fi (Rolf Ahrenberg)
Date: Wed, 17 Oct 2007 00:44:59 +0300 (EEST)
Subject: [Softdevice-devel] last softdevice/ffmpeg branch and blank
 video... [solved: subtitles-0.5.0 bug]
In-Reply-To: <1192484533.4713deb55d791@imp.free.fr>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
	<1192367549.471215bda0424@imp.free.fr>
	<1192377717.47123d7599249@webmail.in-berlin.de>
	<1192388958.4712695e02c39@imp.free.fr>
	<1192484533.4713deb55d791@imp.free.fr>
Message-ID: <Pine.OSF.4.64.0710170039330.13732@kosh.hut.fi>

On Mon, 15 Oct 2007, wallak at free.fr wrote:

> The bug was introduced by the subtitles-0.5.0 plugin patch. Vdr once patched,
> generate invalid PES extension. And so, softdevice/ffmpeg is unable to handle
> the stream (the patch given in a previous mail, is only a dirty fix).

And this should have been already fixed in my latest patch sets for 
vdr-1.5.9.

>> I've tried further, and everything works as is (without patch) when using
>> vdr-1.5.9. But I still have the same problem with vdr-1.4.7. Some buggy PES
>> extension may be generated inside vdr.

Are you sure that my patch for vdr-1.5.9 doesn't work? I've been lazy 
and haven't done the required modifications for vdr-1.4.7 as I don't 
have any setup to test it.

--
rofa


From ollo.diab at gmx.de  Wed Oct 17 18:58:37 2007
From: ollo.diab at gmx.de (Thomas Herrmann)
Date: Wed, 17 Oct 2007 18:58:37 +0200
Subject: [Softdevice-devel] last softdevice/ffmpeg branch
	and	blank	video...
In-Reply-To: <20071016185054.192040@gmx.net>
References: <1192304675.47112023154a1@imp.free.fr>
	<1192353661.4711df7df36e8@webmail.in-berlin.de>
	<20071016185054.192040@gmx.net>
Message-ID: <20071017165837.179400@gmx.net>


-------- Original-Nachricht --------
> Datum: Tue, 16 Oct 2007 20:50:54 +0200
> Von: "Thomas Herrmann" <ollo.diab at gmx.de>
> An: softdevice-devel at lists.berlios.de
> Betreff: Re: [Softdevice-devel] last softdevice/ffmpeg branch and	blank	video...

> 
> -------- Original-Nachricht --------
> > Datum: Sun, 14 Oct 2007 11:21:01 +0200
> > Von: Stefan Lucke <stefan at lucke.in-berlin.de>
> > An: softdevice-devel at lists.berlios.de
> > Betreff: Re: [Softdevice-devel] last softdevice/ffmpeg branch and
> blank	video...
> 
> > >
> > > Is there an h264 support ?
> > 
> > I'm waiting for a more stabilized versions of the drivers.
> > Last time I tested DVB-S2 there were some problems with ffmpeg,
> > as they didn't support MBAFF/PAFF. That seems to have changed.
> > 
> 
> DVB-S2 driver runs reasonable well already! But ffmpeg PAFF still lacks
> some interlaced feature support. This is what I get while streaming TS to
> mplayer (from cvs) - like Sat.1 HD:
> [h264 @ 0xdeb420]Interlaced pictures + spatial direct mode is not
> implemented
> 
> Anyhow, while we are that topic, any chance to get ffmpeg multi threading
> support enabled? Again, while running mplayer -lavdopts threads=2, it works
> well on my low power dual core CPU (AMD Athlon BE-2350).

... or how about to make all ffmpeg -lavdopts useable by softdevice - maybe via config file. I can imagine those options might be quite helpfull for lower performance systems.

Thanks,  Thomas
> 
> Regards,  Thomas
> -- 
> GMX FreeMail: 1 GB Postfach, 5 E-Mail-Adressen, 10 Free SMS.
> Alle Infos und kostenlose Anmeldung: http://www.gmx.net/de/go/freemail
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel

-- 
Ist Ihr Browser Vista-kompatibel? Jetzt die neuesten 
Browser-Versionen downloaden: http://www.gmx.net/de/go/browser


From Neumann at DO-net.de  Fri Oct 19 18:58:44 2007
From: Neumann at DO-net.de (Andre Neumann)
Date: Fri, 19 Oct 2007 18:58:44 +0200
Subject: [Softdevice-devel] Pro7HD .ts sample
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D039177CCD@sbs2003.do-net.de>

Hi,

anyone can provide me with a .ts sample recorded from Pro7HD?
I would like to test it with softdevice/softplay.

Since ffmpeg now supports PAFF decoding, i would like to know,
if my CPU (Core2Duo E4500) is powerfull enough.

A "real" HDTV clip would be great, no upscaled stuff.


-------------
Andre Neumann




From Neumann at DO-net.de  Fri Oct 19 19:00:32 2007
From: Neumann at DO-net.de (Andre Neumann)
Date: Fri, 19 Oct 2007 19:00:32 +0200
Subject: [Softdevice-devel] Problems running HD channels with vidix
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D039177CCE@sbs2003.do-net.de>

runs fine here with my X300 PCIe card. Could you please e-mail the vidix
people the change?

thank you for all your work.

-------------
Andre Neumann

> -----Original Message-----
> From: softdevice-devel-bounces at lists.berlios.de 
> [mailto:softdevice-devel-bounces at lists.berlios.de] On Behalf 
> Of Stefan Lucke
> Sent: Sunday, October 14, 2007 7:54 PM
> To: softdevice-devel at lists.berlios.de
> Subject: Re: [Softdevice-devel] Problems running HD channels 
> with vidix
> 
> On Donnerstag, 11. Oktober 2007, Stefan Lucke wrote:
> > Quoting Andre Neumann <Neumann at do-net.de>:
> > 
> > > Is that a limit of the hardware? With DirectFB HD channels are ok.
> > > Any change to change this limits simply by editing them?
> > 
> > You can try to change the limits. Perhaps they are dependent of the 
> > chip type, In your case:
> > Radeon_vid: Found chip: RV370 5B60 [Radeon X300 (PCIE)]
> > 
> > X11 and DirectFB have limits of 2048x2048.
> > 
> > My R280 had some issues last time I tried HD demo files with X11.
> > They seem to be truncated to the right, so some 1567 limit looks 
> > reasonable. Have to do a DirectFB test.
> 
> So I did 2 tests (lspic -vv -s 01:00.0 ; see attached files):
>   1st rv280:
>     This one shows a video truncation on the right side. Both with Xv
>     and DirectFB. Rightmost ~300 pixels are pink ;-) .
> 
>   2nd rv350
>     This one shows no truncation on the right side (Xv and DirectFB).
>     And after modifying vidix sources, my samples play untrucated even
>     by vidix.
> 
> My samples trailer for testing are:
> -rw-r--r-- 1 stefan users 291096901 29. Okt 2005  
> maria_taylor_m1080p.mov
> -rw-r--r-- 1 stefan users 267415093 28. Jul 2006  
> onesixright_1080p.mov
> 
> Somewhere available from apple I guess.
> 
> I think we should ask vidix people for a change (see attached one)
> 
> --
> Stefan Lucke
> 
> 




From admin at berlios.de  Sat Oct 20 12:12:31 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sat, 20 Oct 2007 12:12:31 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #12224] openSUSE 10.3 throws X_ShmPutImage
	BadValue with softdevice
Message-ID: <200710201012.l9KACVG7019073@unicorn.berlios.de>

Bug #12224, was updated on 2007-Oct-20 12:12
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: xv-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: hkirschk
Assigned to : none
Summary: openSUSE 10.3 throws X_ShmPutImage BadValue with softdevice 

Details: Moin Stefan,

switching over from OpenSUSE 10.2 to 10.3 I've encountered a problem
with your softdevice. On 10.2, everything worked fine, on 10.3 I
encountered an error. Here now the detailed description:

Configuration
=============

OpenSUSE 10.3, X Windows version 11, revision 7.2 (<- this could be
one of the reasons for the error to occur, 10.2 had something like
revision 7.19)

softdevice 0.4.0 checkout of 2007-10-06

nVidia proprietary graphics driver, most actual version

FX5200 nVidia-compatible graphic card operated with 2 screens:

1. CRT-0 with LCD monitor, 1280x1024 resolution, X display :0.0

2. TV-0 with composite TV set, 800x600 resolution, X display :0.1

When running vdr+softdevice on DISPLAY :0.0, everything works fine.

The problem
===========

When running vdr+softdevice with DISPLAY on :0.1, I encounter an error:

X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134

(find the complete output of vdr at the end of this posting.)

The `Value in failed request' corresponds to the X resolution of the
:0.0 screen, therefore I thought this could have to do with the
Xinerama settings of the X server. Unfortunately, I did not find a
sufficient methods to convince the X server NOT to enable Xinerama.

Tracing down the error I found that in video-xv.c, in method
cXvVideoOut::ProcessEvents () (in video-xv.c(562)) gets called with an
event.type (in video-xv.c(585)) of ConfigureNotify ((in
video-xv.c(603)) several times. The code:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	dwidth = event.xconfigure.width;
	dheight = event.xconfigure.height;
        AdjustXineramaScreen();
        RecalculateAspect();

sets the dwidth and dheight to the parameters attached to the
event. Very strange, the 4th or 5th call here delivers a
event.xconfigure.width of 1280, this is stored as dwidth and dheight,
and leads in turn to the error described above. I'm using a
quick-and-dirty fix like:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	/* 2007-10-16 hkirschk: */
	if ( event.xconfigure.width < dwidth &&
	     event.xconfigure.height < dheight ) {
	  dwidth = event.xconfigure.width;
	  dheight = event.xconfigure.height;
	}
        AdjustXineramaScreen();
        RecalculateAspect();

This works only if the TV-0 screen is configured to be smaller than
the CRT-0 one. IMHO, dwidth and dheight should be set in some
initialization method by requesting the values directly from the X
server.

Workarounds
===========

1. my quick-and-dirty-fix above, with the explained restrictions

2. setting both resolutions the same (i.e., 800x600 for TV-0 and
   CRT-0) bypasses the bug (I've tested it, and it works)

3. I guess that switching off Xinerama might also do the trick, but I
   didn't manage to get Xinerama switched off, so I've not tested this.

Attachments
===========

Attachment 1: complete output of vdr
Attachment 2: my /etc/X11/xorg.conf
--
Attachment 1: complete output of vdr:

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 655375
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
Read list from /home/media/vdr/plugins/softplay/current.playlist
could not open /home/media/vdr/plugins/softplay/current.playlist for reading!
Sat Oct 13 13:08:21 CEST 2007 reloading DVB driver
Sat Oct 13 13:08:31 CEST 2007 restarting VDR
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 819218
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
--
Attachment 2: My /etc/X11/xorg.conf:

# nvidia-settings: X configuration file generated by nvidia-settings
# nvidia-settings:  version 1.0  (buildmeister at builder3)  Sat May 26 01:05:11 PDT 2007

# nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 1.0  (buildmeister at builder3)  Sat May 26 01:04:16 PDT 2007
# /.../
# SaX generated X11 config file
# Created on: 2007-02-06T21:32:22+0100.
#
# Version: 8.1
# Contact: Marcus Schaefer <sax at suse.de>, 2005
# Contact: SaX-User list <https://lists.berlios.de/mailman/listinfo/sax-users>
#
# Automatically generated by [ISaX] (8.1)
# PLEASE DO NOT EDIT THIS FILE!
#

Section "ServerLayout"
    Identifier     "Layout[all]"
    Screen      0  "Screen0" RightOf "Screen1"
    Screen      1  "Screen1" 0 0
    InputDevice    "Keyboard[0]" "CoreKeyboard"
    InputDevice    "Mouse[1]" "CorePointer"
    Option         "Clone" "off"
    Option         "Xinerama" "off"
EndSection

Section "Files"
    InputDevices      "/dev/gpmdata"
    InputDevices      "/dev/input/mice"
    FontPath        "/usr/share/fonts/misc:unscaled"
    FontPath        "/usr/share/fonts/local"
    FontPath        "/usr/share/fonts/75dpi:unscaled"
    FontPath        "/usr/share/fonts/100dpi:unscaled"
    FontPath        "/usr/share/fonts/Type1"
    FontPath        "/usr/share/fonts/URW"
    FontPath        "/usr/share/fonts/Speedo"
    FontPath        "/usr/share/fonts/PEX"
    FontPath        "/usr/share/fonts/cyrillic"
    FontPath        "/usr/share/fonts/latin2/misc:unscaled"
    FontPath        "/usr/share/fonts/latin2/75dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/100dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/Type1"
    FontPath        "/usr/share/fonts/latin7/75dpi:unscaled"
    FontPath        "/usr/share/fonts/baekmuk:unscaled"
    FontPath        "/usr/share/fonts/japanese:unscaled"
    FontPath        "/usr/share/fonts/kwintv"
    FontPath        "/usr/share/fonts/truetype"
    FontPath        "/usr/share/fonts/uni:unscaled"
    FontPath        "/usr/share/fonts/CID"
    FontPath        "/usr/share/fonts/ucs/misc:unscaled"
    FontPath        "/usr/share/fonts/ucs/75dpi:unscaled"
    FontPath        "/usr/share/fonts/ucs/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/misc:unscaled"
    FontPath        "/usr/share/fonts/hellas/75dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/Type1"
    FontPath        "/usr/share/fonts/misc/sgi:unscaled"
    FontPath        "/usr/share/fonts/xtest"
    FontPath        "/opt/kde3/share/fonts"
    FontPath        "unix/:7100"
EndSection

Section "Module"
    Load           "dbe"
    Load           "type1"
    Load           "freetype"
    Load           "extmod"
    Load           "glx"
    Load           "v4l"
EndSection

Section "ServerFlags"
    Option         "AllowMouseOpenFail" "on"
    Option         "Xinerama" "off"
EndSection

Section "InputDevice"
    Identifier     "Keyboard[0]"
    Driver         "kbd"
    Option         "Protocol" "Standard"
    Option         "XkbLayout" "de"
    Option         "XkbModel" "microsoftpro"
    Option         "XkbRules" "xfree86"
    Option         "XkbVariant" "nodeadkeys"
EndSection

Section "InputDevice"
    Identifier     "Mouse[1]"
    Driver         "mouse"
    Option         "AutoSoft" "on"
    Option         "Device" "/dev/input/mice"
    Option         "Emulate3Buttons" "on"
    Option         "Name" "<undefined>"
    Option         "Protocol" "Auto"
    Option         "Vendor" "Sysp"
EndSection

Section "Modes"
    Identifier         "Modes[0]"
    ModeLine     "1280x1024" 107.0 1280 1360 1496 1712 1024 1025 1028 1059
    ModeLine     "1280x1024" 87.8 1280 1328 1360 1440 1024 1027 1034 1053 +hsync -vsync
    ModeLine     "1280x960" 107.3 1280 1360 1496 1712 960 961 964 995
    ModeLine     "1280x960" 88.2 1280 1328 1360 1440 960 963 967 989 +hsync -vsync
    ModeLine     "1280x800" 107.2 1280 1360 1496 1712 800 801 804 835
    ModeLine     "1280x800" 98.9 1280 1352 1488 1696 800 801 804 833
    ModeLine     "1280x800" 91.6 1280 1352 1488 1696 800 801 804 831
    ModeLine     "1280x800" 88.2 1280 1328 1360 1440 800 803 809 829 +hsync -vsync
    ModeLine     "1280x800" 83.5 1280 1344 1480 1680 800 801 804 828
    ModeLine     "1152x864" 105.0 1152 1224 1352 1552 864 865 868 902
    ModeLine     "1152x864" 96.8 1152 1224 1344 1536 864 865 868 900
    ModeLine     "1152x864" 89.6 1152 1224 1344 1536 864 865 868 897
    ModeLine     "1152x864" 86.8 1152 1200 1232 1312 864 867 871 895 +hsync -vsync
    ModeLine     "1152x864" 81.6 1152 1216 1336 1520 864 865 868 895
    ModeLine     "1280x768" 103.0 1280 1360 1496 1712 768 769 772 802
    ModeLine     "1280x768" 95.0 1280 1352 1488 1696 768 769 772 800
    ModeLine     "1280x768" 88.0 1280 1352 1488 1696 768 769 772 798
    ModeLine     "1280x768" 84.8 1280 1328 1360 1440 768 771 778 796 +hsync -vsync
    ModeLine     "1280x768" 80.1 1280 1344 1480 1680 768 769 772 795
    ModeLine     "1024x768" 81.8 1024 1080 1192 1360 768 769 772 802
    ModeLine     "1024x768" 76.2 1024 1080 1192 1360 768 769 772 800
    ModeLine     "1024x768" 69.7 1024 1080 1184 1344 768 769 772 798
    ModeLine     "1024x768" 69.5 1024 1072 1104 1184 768 771 775 796 +hsync -vsync
    ModeLine     "1024x768" 64.1 1024 1080 1184 1344 768 769 772 795
    ModeLine     "1280x600" 79.0 1280 1344 1480 1680 600 601 604 627
    ModeLine     "1280x600" 72.8 1280 1336 1472 1664 600 601 604 625
    ModeLine     "1280x600" 66.7 1280 1336 1464 1648 600 601 604 623
    ModeLine     "1280x600" 66.2 1280 1328 1360 1440 600 603 613 622 +hsync -vsync
    ModeLine     "1280x600" 61.5 1280 1336 1464 1648 600 601 604 622
    ModeLine     "1024x600" 63.2 1024 1080 1184 1344 600 601 604 627
    ModeLine     "1024x600" 58.1 1024 1072 1176 1328 600 601 604 625
    ModeLine     "1024x600" 54.2 1024 1072 1104 1184 600 603 613 622 +hsync -vsync
    ModeLine     "1024x600" 53.8 1024 1072 1176 1328 600 601 604 623
    ModeLine     "1024x600" 49.0 1024 1064 1168 1312 600 601 604 622
    ModeLine     "800x600" 48.9 800 840 920 1040 600 601 604 627
    ModeLine     "800x600" 45.5 800 840 920 1040 600 601 604 625
    ModeLine     "800x600" 44.0 800 848 880 960 600 603 607 622 +hsync -vsync
    ModeLine     "800x600" 42.1 800 840 920 1040 600 601 604 623
    ModeLine     "800x600" 38.2 800 832 912 1024 600 601 604 622
    ModeLine     "768x576" 45.5 768 808 888 1008 576 577 580 602
    ModeLine     "768x576" 41.7 768 800 880 992 576 577 580 600
    ModeLine     "768x576" 40.8 768 816 848 928 576 579 583 597 +hsync -vsync
    ModeLine     "768x576" 38.6 768 800 880 992 576 577 580 598
    ModeLine     "768x576" 35.0 768 792 872 976 576 577 580 597
    ModeLine     "640x480" 30.7 640 664 728 816 480 481 484 502
    ModeLine     "640x480" 29.2 640 688 720 800 480 483 487 497 +hsync -vsync
    ModeLine     "640x480" 28.6 640 664 728 816 480 481 484 500
    ModeLine     "640x480" 25.9 640 656 720 800 480 481 484 499
    ModeLine     "640x480" 23.9 640 656 720 800 480 481 484 497
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "CRT-0"
    DisplaySize     337    270
    HorizSync       29.0 - 83.0
    VertRefresh     43.0 - 75.0
    Option         "DPMS"
EndSection

Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "Unknown"
    ModelName      "TV-0"
    HorizSync       28.0 - 33.0
    VertRefresh     43.0 - 72.0
EndSection

Section "Device"
    Identifier     "Videocard0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          0
    Option         "Xinerama" "off"
EndSection

Section "Device"
    Identifier     "Videocard1"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          1
    Option         "Xinerama" "off"
EndSection

Section "Screen"

# Removed Option "metamodes" "CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    Identifier     "Screen0"
    Device         "Videocard1"
    Monitor        "Monitor0"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "CRT: 1280x1024_60 +0+0; CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Section "Screen"
    Identifier     "Screen1"
    Device         "Videocard0"
    Monitor        "Monitor1"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
#    Option         "TVOutFormat" "SVIDEO"
    Option         "TVOutFormat" "COMPOSITE"
    Option         "TVStandard" "PAL-B"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "TV: 800x600 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Greeting & happy bug fixing,
Heiko Kirschke


For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=12224&group_id=2051


From admin at berlios.de  Thu Oct 25 13:33:13 2007
From: admin at berlios.de (admin at berlios.de)
Date: Thu, 25 Oct 2007 13:33:13 +0200 (CEST)
Subject: [Softdevice-devel] [Bug #12224] openSUSE 10.3 throws X_ShmPutImage
	BadValue with softdevice
Message-ID: <200710251133.l9PBXDlT024993@unicorn.berlios.de>

Bug #12224, was updated on 2007-Oct-20 12:12
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: xv-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: hkirschk
Assigned to : lucke
Summary: openSUSE 10.3 throws X_ShmPutImage BadValue with softdevice 

Details: Moin Stefan,

switching over from OpenSUSE 10.2 to 10.3 I've encountered a problem
with your softdevice. On 10.2, everything worked fine, on 10.3 I
encountered an error. Here now the detailed description:

Configuration
=============

OpenSUSE 10.3, X Windows version 11, revision 7.2 (<- this could be
one of the reasons for the error to occur, 10.2 had something like
revision 7.19)

softdevice 0.4.0 checkout of 2007-10-06

nVidia proprietary graphics driver, most actual version

FX5200 nVidia-compatible graphic card operated with 2 screens:

1. CRT-0 with LCD monitor, 1280x1024 resolution, X display :0.0

2. TV-0 with composite TV set, 800x600 resolution, X display :0.1

When running vdr+softdevice on DISPLAY :0.0, everything works fine.

The problem
===========

When running vdr+softdevice with DISPLAY on :0.1, I encounter an error:

X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134

(find the complete output of vdr at the end of this posting.)

The `Value in failed request' corresponds to the X resolution of the
:0.0 screen, therefore I thought this could have to do with the
Xinerama settings of the X server. Unfortunately, I did not find a
sufficient methods to convince the X server NOT to enable Xinerama.

Tracing down the error I found that in video-xv.c, in method
cXvVideoOut::ProcessEvents () (in video-xv.c(562)) gets called with an
event.type (in video-xv.c(585)) of ConfigureNotify ((in
video-xv.c(603)) several times. The code:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	dwidth = event.xconfigure.width;
	dheight = event.xconfigure.height;
        AdjustXineramaScreen();
        RecalculateAspect();

sets the dwidth and dheight to the parameters attached to the
event. Very strange, the 4th or 5th call here delivers a
event.xconfigure.width of 1280, this is stored as dwidth and dheight,
and leads in turn to the error described above. I'm using a
quick-and-dirty fix like:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	/* 2007-10-16 hkirschk: */
	if ( event.xconfigure.width < dwidth &&
	     event.xconfigure.height < dheight ) {
	  dwidth = event.xconfigure.width;
	  dheight = event.xconfigure.height;
	}
        AdjustXineramaScreen();
        RecalculateAspect();

This works only if the TV-0 screen is configured to be smaller than
the CRT-0 one. IMHO, dwidth and dheight should be set in some
initialization method by requesting the values directly from the X
server.

Workarounds
===========

1. my quick-and-dirty-fix above, with the explained restrictions

2. setting both resolutions the same (i.e., 800x600 for TV-0 and
   CRT-0) bypasses the bug (I've tested it, and it works)

3. I guess that switching off Xinerama might also do the trick, but I
   didn't manage to get Xinerama switched off, so I've not tested this.

Attachments
===========

Attachment 1: complete output of vdr
Attachment 2: my /etc/X11/xorg.conf
--
Attachment 1: complete output of vdr:

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 655375
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
Read list from /home/media/vdr/plugins/softplay/current.playlist
could not open /home/media/vdr/plugins/softplay/current.playlist for reading!
Sat Oct 13 13:08:21 CEST 2007 reloading DVB driver
Sat Oct 13 13:08:31 CEST 2007 restarting VDR
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 819218
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
--
Attachment 2: My /etc/X11/xorg.conf:

# nvidia-settings: X configuration file generated by nvidia-settings
# nvidia-settings:  version 1.0  (buildmeister at builder3)  Sat May 26 01:05:11 PDT 2007

# nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 1.0  (buildmeister at builder3)  Sat May 26 01:04:16 PDT 2007
# /.../
# SaX generated X11 config file
# Created on: 2007-02-06T21:32:22+0100.
#
# Version: 8.1
# Contact: Marcus Schaefer <sax at suse.de>, 2005
# Contact: SaX-User list <https://lists.berlios.de/mailman/listinfo/sax-users>
#
# Automatically generated by [ISaX] (8.1)
# PLEASE DO NOT EDIT THIS FILE!
#

Section "ServerLayout"
    Identifier     "Layout[all]"
    Screen      0  "Screen0" RightOf "Screen1"
    Screen      1  "Screen1" 0 0
    InputDevice    "Keyboard[0]" "CoreKeyboard"
    InputDevice    "Mouse[1]" "CorePointer"
    Option         "Clone" "off"
    Option         "Xinerama" "off"
EndSection

Section "Files"
    InputDevices      "/dev/gpmdata"
    InputDevices      "/dev/input/mice"
    FontPath        "/usr/share/fonts/misc:unscaled"
    FontPath        "/usr/share/fonts/local"
    FontPath        "/usr/share/fonts/75dpi:unscaled"
    FontPath        "/usr/share/fonts/100dpi:unscaled"
    FontPath        "/usr/share/fonts/Type1"
    FontPath        "/usr/share/fonts/URW"
    FontPath        "/usr/share/fonts/Speedo"
    FontPath        "/usr/share/fonts/PEX"
    FontPath        "/usr/share/fonts/cyrillic"
    FontPath        "/usr/share/fonts/latin2/misc:unscaled"
    FontPath        "/usr/share/fonts/latin2/75dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/100dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/Type1"
    FontPath        "/usr/share/fonts/latin7/75dpi:unscaled"
    FontPath        "/usr/share/fonts/baekmuk:unscaled"
    FontPath        "/usr/share/fonts/japanese:unscaled"
    FontPath        "/usr/share/fonts/kwintv"
    FontPath        "/usr/share/fonts/truetype"
    FontPath        "/usr/share/fonts/uni:unscaled"
    FontPath        "/usr/share/fonts/CID"
    FontPath        "/usr/share/fonts/ucs/misc:unscaled"
    FontPath        "/usr/share/fonts/ucs/75dpi:unscaled"
    FontPath        "/usr/share/fonts/ucs/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/misc:unscaled"
    FontPath        "/usr/share/fonts/hellas/75dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/Type1"
    FontPath        "/usr/share/fonts/misc/sgi:unscaled"
    FontPath        "/usr/share/fonts/xtest"
    FontPath        "/opt/kde3/share/fonts"
    FontPath        "unix/:7100"
EndSection

Section "Module"
    Load           "dbe"
    Load           "type1"
    Load           "freetype"
    Load           "extmod"
    Load           "glx"
    Load           "v4l"
EndSection

Section "ServerFlags"
    Option         "AllowMouseOpenFail" "on"
    Option         "Xinerama" "off"
EndSection

Section "InputDevice"
    Identifier     "Keyboard[0]"
    Driver         "kbd"
    Option         "Protocol" "Standard"
    Option         "XkbLayout" "de"
    Option         "XkbModel" "microsoftpro"
    Option         "XkbRules" "xfree86"
    Option         "XkbVariant" "nodeadkeys"
EndSection

Section "InputDevice"
    Identifier     "Mouse[1]"
    Driver         "mouse"
    Option         "AutoSoft" "on"
    Option         "Device" "/dev/input/mice"
    Option         "Emulate3Buttons" "on"
    Option         "Name" "<undefined>"
    Option         "Protocol" "Auto"
    Option         "Vendor" "Sysp"
EndSection

Section "Modes"
    Identifier         "Modes[0]"
    ModeLine     "1280x1024" 107.0 1280 1360 1496 1712 1024 1025 1028 1059
    ModeLine     "1280x1024" 87.8 1280 1328 1360 1440 1024 1027 1034 1053 +hsync -vsync
    ModeLine     "1280x960" 107.3 1280 1360 1496 1712 960 961 964 995
    ModeLine     "1280x960" 88.2 1280 1328 1360 1440 960 963 967 989 +hsync -vsync
    ModeLine     "1280x800" 107.2 1280 1360 1496 1712 800 801 804 835
    ModeLine     "1280x800" 98.9 1280 1352 1488 1696 800 801 804 833
    ModeLine     "1280x800" 91.6 1280 1352 1488 1696 800 801 804 831
    ModeLine     "1280x800" 88.2 1280 1328 1360 1440 800 803 809 829 +hsync -vsync
    ModeLine     "1280x800" 83.5 1280 1344 1480 1680 800 801 804 828
    ModeLine     "1152x864" 105.0 1152 1224 1352 1552 864 865 868 902
    ModeLine     "1152x864" 96.8 1152 1224 1344 1536 864 865 868 900
    ModeLine     "1152x864" 89.6 1152 1224 1344 1536 864 865 868 897
    ModeLine     "1152x864" 86.8 1152 1200 1232 1312 864 867 871 895 +hsync -vsync
    ModeLine     "1152x864" 81.6 1152 1216 1336 1520 864 865 868 895
    ModeLine     "1280x768" 103.0 1280 1360 1496 1712 768 769 772 802
    ModeLine     "1280x768" 95.0 1280 1352 1488 1696 768 769 772 800
    ModeLine     "1280x768" 88.0 1280 1352 1488 1696 768 769 772 798
    ModeLine     "1280x768" 84.8 1280 1328 1360 1440 768 771 778 796 +hsync -vsync
    ModeLine     "1280x768" 80.1 1280 1344 1480 1680 768 769 772 795
    ModeLine     "1024x768" 81.8 1024 1080 1192 1360 768 769 772 802
    ModeLine     "1024x768" 76.2 1024 1080 1192 1360 768 769 772 800
    ModeLine     "1024x768" 69.7 1024 1080 1184 1344 768 769 772 798
    ModeLine     "1024x768" 69.5 1024 1072 1104 1184 768 771 775 796 +hsync -vsync
    ModeLine     "1024x768" 64.1 1024 1080 1184 1344 768 769 772 795
    ModeLine     "1280x600" 79.0 1280 1344 1480 1680 600 601 604 627
    ModeLine     "1280x600" 72.8 1280 1336 1472 1664 600 601 604 625
    ModeLine     "1280x600" 66.7 1280 1336 1464 1648 600 601 604 623
    ModeLine     "1280x600" 66.2 1280 1328 1360 1440 600 603 613 622 +hsync -vsync
    ModeLine     "1280x600" 61.5 1280 1336 1464 1648 600 601 604 622
    ModeLine     "1024x600" 63.2 1024 1080 1184 1344 600 601 604 627
    ModeLine     "1024x600" 58.1 1024 1072 1176 1328 600 601 604 625
    ModeLine     "1024x600" 54.2 1024 1072 1104 1184 600 603 613 622 +hsync -vsync
    ModeLine     "1024x600" 53.8 1024 1072 1176 1328 600 601 604 623
    ModeLine     "1024x600" 49.0 1024 1064 1168 1312 600 601 604 622
    ModeLine     "800x600" 48.9 800 840 920 1040 600 601 604 627
    ModeLine     "800x600" 45.5 800 840 920 1040 600 601 604 625
    ModeLine     "800x600" 44.0 800 848 880 960 600 603 607 622 +hsync -vsync
    ModeLine     "800x600" 42.1 800 840 920 1040 600 601 604 623
    ModeLine     "800x600" 38.2 800 832 912 1024 600 601 604 622
    ModeLine     "768x576" 45.5 768 808 888 1008 576 577 580 602
    ModeLine     "768x576" 41.7 768 800 880 992 576 577 580 600
    ModeLine     "768x576" 40.8 768 816 848 928 576 579 583 597 +hsync -vsync
    ModeLine     "768x576" 38.6 768 800 880 992 576 577 580 598
    ModeLine     "768x576" 35.0 768 792 872 976 576 577 580 597
    ModeLine     "640x480" 30.7 640 664 728 816 480 481 484 502
    ModeLine     "640x480" 29.2 640 688 720 800 480 483 487 497 +hsync -vsync
    ModeLine     "640x480" 28.6 640 664 728 816 480 481 484 500
    ModeLine     "640x480" 25.9 640 656 720 800 480 481 484 499
    ModeLine     "640x480" 23.9 640 656 720 800 480 481 484 497
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "CRT-0"
    DisplaySize     337    270
    HorizSync       29.0 - 83.0
    VertRefresh     43.0 - 75.0
    Option         "DPMS"
EndSection

Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "Unknown"
    ModelName      "TV-0"
    HorizSync       28.0 - 33.0
    VertRefresh     43.0 - 72.0
EndSection

Section "Device"
    Identifier     "Videocard0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          0
    Option         "Xinerama" "off"
EndSection

Section "Device"
    Identifier     "Videocard1"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          1
    Option         "Xinerama" "off"
EndSection

Section "Screen"

# Removed Option "metamodes" "CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    Identifier     "Screen0"
    Device         "Videocard1"
    Monitor        "Monitor0"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "CRT: 1280x1024_60 +0+0; CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Section "Screen"
    Identifier     "Screen1"
    Device         "Videocard0"
    Monitor        "Monitor1"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
#    Option         "TVOutFormat" "SVIDEO"
    Option         "TVOutFormat" "COMPOSITE"
    Option         "TVStandard" "PAL-B"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "TV: 800x600 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Greeting & happy bug fixing,
Heiko Kirschke


Follow-Ups:

Date: 2007-Oct-25 13:33
By: lucke

Comment:
Thanks for your detailed analysis.

Can you check your X configuration.
You've 2 screens defined and both screens are of the same size.
Please drop modes "1600x1200" "1280x1024" "1024x768" from subsection display of screen1 and try an unmodified softdevice version.

A bit strange are the following messages:
[XvVideoOut]: Xinerama Screen 0: 0,0 1280x1024
[XvVideoOut]: dispName = :0.1

-> There is only one screen with 1280x1024 dimensions.
That should be screen0 I guess, but the name you diplayed is from screen1.

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=12224&group_id=2051


From admin at berlios.de  Sun Oct 28 11:59:30 2007
From: admin at berlios.de (admin at berlios.de)
Date: Sun, 28 Oct 2007 11:59:30 +0100 (CET)
Subject: [Softdevice-devel] [Bug #12224] openSUSE 10.3 throws X_ShmPutImage
	BadValue with softdevice
Message-ID: <200710281059.l9SAxUq4000136@unicorn.berlios.de>

Bug #12224, was updated on 2007-Oct-20 12:12
Here is a current snapshot of the bug.

Project: Vdr Softdevice
Category: xv-out
Status: Open
Resolution: None
Bug Group: None
Priority: 5
Submitted by: hkirschk
Assigned to : lucke
Summary: openSUSE 10.3 throws X_ShmPutImage BadValue with softdevice 

Details: Moin Stefan,

switching over from OpenSUSE 10.2 to 10.3 I've encountered a problem
with your softdevice. On 10.2, everything worked fine, on 10.3 I
encountered an error. Here now the detailed description:

Configuration
=============

OpenSUSE 10.3, X Windows version 11, revision 7.2 (<- this could be
one of the reasons for the error to occur, 10.2 had something like
revision 7.19)

softdevice 0.4.0 checkout of 2007-10-06

nVidia proprietary graphics driver, most actual version

FX5200 nVidia-compatible graphic card operated with 2 screens:

1. CRT-0 with LCD monitor, 1280x1024 resolution, X display :0.0

2. TV-0 with composite TV set, 800x600 resolution, X display :0.1

When running vdr+softdevice on DISPLAY :0.0, everything works fine.

The problem
===========

When running vdr+softdevice with DISPLAY on :0.1, I encounter an error:

X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134

(find the complete output of vdr at the end of this posting.)

The `Value in failed request' corresponds to the X resolution of the
:0.0 screen, therefore I thought this could have to do with the
Xinerama settings of the X server. Unfortunately, I did not find a
sufficient methods to convince the X server NOT to enable Xinerama.

Tracing down the error I found that in video-xv.c, in method
cXvVideoOut::ProcessEvents () (in video-xv.c(562)) gets called with an
event.type (in video-xv.c(585)) of ConfigureNotify ((in
video-xv.c(603)) several times. The code:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	dwidth = event.xconfigure.width;
	dheight = event.xconfigure.height;
        AdjustXineramaScreen();
        RecalculateAspect();

sets the dwidth and dheight to the parameters attached to the
event. Very strange, the 4th or 5th call here delivers a
event.xconfigure.width of 1280, this is stored as dwidth and dheight,
and leads in turn to the error described above. I'm using a
quick-and-dirty fix like:

      case ConfigureNotify:
        EVDEB("ConfigureNotify\n");
        map_count++;
        dx = event.xconfigure.x;
        dy = event.xconfigure.y;
	/* 2007-10-16 hkirschk: */
	if ( event.xconfigure.width < dwidth &&
	     event.xconfigure.height < dheight ) {
	  dwidth = event.xconfigure.width;
	  dheight = event.xconfigure.height;
	}
        AdjustXineramaScreen();
        RecalculateAspect();

This works only if the TV-0 screen is configured to be smaller than
the CRT-0 one. IMHO, dwidth and dheight should be set in some
initialization method by requesting the values directly from the X
server.

Workarounds
===========

1. my quick-and-dirty-fix above, with the explained restrictions

2. setting both resolutions the same (i.e., 800x600 for TV-0 and
   CRT-0) bypasses the bug (I've tested it, and it works)

3. I guess that switching off Xinerama might also do the trick, but I
   didn't manage to get Xinerama switched off, so I've not tested this.

Attachments
===========

Attachment 1: complete output of vdr
Attachment 2: my /etc/X11/xorg.conf
--
Attachment 1: complete output of vdr:

[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 655375
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
Read list from /home/media/vdr/plugins/softplay/current.playlist
could not open /home/media/vdr/plugins/softplay/current.playlist for reading!
Sat Oct 13 13:08:21 CEST 2007 reloading DVB driver
Sat Oct 13 13:08:31 CEST 2007 restarting VDR
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -ao
[softdevice] using alsa mixer for volume control
[softdevice]   argv [3] = -vo
[ProcessArgs] xv: start up fullscreen
[setup-softdevice] alsa ac3Mode set to: 0
[setup-softdevice] alsa AC3 device set to: hw:0,1
[setup-softdevice] alsa device set to: default
[setup-softdevice] autodetectAspect 0
[setup-softdevice] A/V Offset set to (0)
[setup-softdevice] Cropping 0 lines from bottom
[setup-softdevice] Cropping 0 columns from left
[setup-softdevice] cropping mode set to 0 (none)
[setup-softdevice] cropping mode toggle key set to 0 (none)
[setup-softdevice] Cropping 0 columns from right
[setup-softdevice] Cropping 0 lines from top
[setup-softdevice] deinterlace method set to 0 none
[setup-softdevice] Expanding 0 columns at left and right
[setup-softdevice] Expanding 0 columns at top and bottom
[setup-softdevice] mainMenu: 1
[setup-softdevice] setting alpha blend mode to software
[softdevice] picture mirroring set to 0 (off)
[setup-softdevice] pixel format set to (I420)
[setup-softdevice] shouldSuspend to: 0
[setup-softdevice] syncTimerMode: sig
[softdevice] UseSetSourceRectangle to off
[softdevice] UseStretchBlitset to off
[setup-softdevice] vidBrightness: 50
[setup-softdevice] vidContrast: 50
[setup-softdevice] vidHue: 0
[setup-softdevice] vidSaturation: 50
[setup-softdevice] startup aspect set to (4:3 normal)
arg: /home/media/vdr/plugins/dvdswitch/dvdlink
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3353600)
[XvVideoOut]: Xinerama Screen 0: 0,0  1280x1024
[XvVideoOut]: dispName = :0.1
[XvVideoOut]: osd_max_width = 800,osd_max_height = 600, useShm = 1
[XvVideoOut]: osd_image shmid = 819218
[XvVideoOut]: got osd_image: width 800 height 600, bytes per line 3200, Bpp 32
[XvVideoOut]: max area size 2046 x 2046
[XvVideoOut]: using area size 736 x 576
[softdevice] Subplugin successfully opend
[softdevice] Video Out seems to be OK
[softdevice] Initializing Audio Out
[softdevice] Audio out seems to be OK
[softdevice] A/V devices initialized, now initializing MPEG2 Decoder
[XvVideoOut]: Xinerama-Screen changed to 0
X Error of failed request:  BadValue (integer parameter out of range for operation)
  Major opcode of failed request:  147 (MIT-SHM)
  Minor opcode of failed request:  3 (X_ShmPutImage)
  Value in failed request:  0x4ff
  Serial number of failed request:  132
  Current serial number in output stream:  134
--
Attachment 2: My /etc/X11/xorg.conf:

# nvidia-settings: X configuration file generated by nvidia-settings
# nvidia-settings:  version 1.0  (buildmeister at builder3)  Sat May 26 01:05:11 PDT 2007

# nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 1.0  (buildmeister at builder3)  Sat May 26 01:04:16 PDT 2007
# /.../
# SaX generated X11 config file
# Created on: 2007-02-06T21:32:22+0100.
#
# Version: 8.1
# Contact: Marcus Schaefer <sax at suse.de>, 2005
# Contact: SaX-User list <https://lists.berlios.de/mailman/listinfo/sax-users>
#
# Automatically generated by [ISaX] (8.1)
# PLEASE DO NOT EDIT THIS FILE!
#

Section "ServerLayout"
    Identifier     "Layout[all]"
    Screen      0  "Screen0" RightOf "Screen1"
    Screen      1  "Screen1" 0 0
    InputDevice    "Keyboard[0]" "CoreKeyboard"
    InputDevice    "Mouse[1]" "CorePointer"
    Option         "Clone" "off"
    Option         "Xinerama" "off"
EndSection

Section "Files"
    InputDevices      "/dev/gpmdata"
    InputDevices      "/dev/input/mice"
    FontPath        "/usr/share/fonts/misc:unscaled"
    FontPath        "/usr/share/fonts/local"
    FontPath        "/usr/share/fonts/75dpi:unscaled"
    FontPath        "/usr/share/fonts/100dpi:unscaled"
    FontPath        "/usr/share/fonts/Type1"
    FontPath        "/usr/share/fonts/URW"
    FontPath        "/usr/share/fonts/Speedo"
    FontPath        "/usr/share/fonts/PEX"
    FontPath        "/usr/share/fonts/cyrillic"
    FontPath        "/usr/share/fonts/latin2/misc:unscaled"
    FontPath        "/usr/share/fonts/latin2/75dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/100dpi:unscaled"
    FontPath        "/usr/share/fonts/latin2/Type1"
    FontPath        "/usr/share/fonts/latin7/75dpi:unscaled"
    FontPath        "/usr/share/fonts/baekmuk:unscaled"
    FontPath        "/usr/share/fonts/japanese:unscaled"
    FontPath        "/usr/share/fonts/kwintv"
    FontPath        "/usr/share/fonts/truetype"
    FontPath        "/usr/share/fonts/uni:unscaled"
    FontPath        "/usr/share/fonts/CID"
    FontPath        "/usr/share/fonts/ucs/misc:unscaled"
    FontPath        "/usr/share/fonts/ucs/75dpi:unscaled"
    FontPath        "/usr/share/fonts/ucs/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/misc:unscaled"
    FontPath        "/usr/share/fonts/hellas/75dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/100dpi:unscaled"
    FontPath        "/usr/share/fonts/hellas/Type1"
    FontPath        "/usr/share/fonts/misc/sgi:unscaled"
    FontPath        "/usr/share/fonts/xtest"
    FontPath        "/opt/kde3/share/fonts"
    FontPath        "unix/:7100"
EndSection

Section "Module"
    Load           "dbe"
    Load           "type1"
    Load           "freetype"
    Load           "extmod"
    Load           "glx"
    Load           "v4l"
EndSection

Section "ServerFlags"
    Option         "AllowMouseOpenFail" "on"
    Option         "Xinerama" "off"
EndSection

Section "InputDevice"
    Identifier     "Keyboard[0]"
    Driver         "kbd"
    Option         "Protocol" "Standard"
    Option         "XkbLayout" "de"
    Option         "XkbModel" "microsoftpro"
    Option         "XkbRules" "xfree86"
    Option         "XkbVariant" "nodeadkeys"
EndSection

Section "InputDevice"
    Identifier     "Mouse[1]"
    Driver         "mouse"
    Option         "AutoSoft" "on"
    Option         "Device" "/dev/input/mice"
    Option         "Emulate3Buttons" "on"
    Option         "Name" "<undefined>"
    Option         "Protocol" "Auto"
    Option         "Vendor" "Sysp"
EndSection

Section "Modes"
    Identifier         "Modes[0]"
    ModeLine     "1280x1024" 107.0 1280 1360 1496 1712 1024 1025 1028 1059
    ModeLine     "1280x1024" 87.8 1280 1328 1360 1440 1024 1027 1034 1053 +hsync -vsync
    ModeLine     "1280x960" 107.3 1280 1360 1496 1712 960 961 964 995
    ModeLine     "1280x960" 88.2 1280 1328 1360 1440 960 963 967 989 +hsync -vsync
    ModeLine     "1280x800" 107.2 1280 1360 1496 1712 800 801 804 835
    ModeLine     "1280x800" 98.9 1280 1352 1488 1696 800 801 804 833
    ModeLine     "1280x800" 91.6 1280 1352 1488 1696 800 801 804 831
    ModeLine     "1280x800" 88.2 1280 1328 1360 1440 800 803 809 829 +hsync -vsync
    ModeLine     "1280x800" 83.5 1280 1344 1480 1680 800 801 804 828
    ModeLine     "1152x864" 105.0 1152 1224 1352 1552 864 865 868 902
    ModeLine     "1152x864" 96.8 1152 1224 1344 1536 864 865 868 900
    ModeLine     "1152x864" 89.6 1152 1224 1344 1536 864 865 868 897
    ModeLine     "1152x864" 86.8 1152 1200 1232 1312 864 867 871 895 +hsync -vsync
    ModeLine     "1152x864" 81.6 1152 1216 1336 1520 864 865 868 895
    ModeLine     "1280x768" 103.0 1280 1360 1496 1712 768 769 772 802
    ModeLine     "1280x768" 95.0 1280 1352 1488 1696 768 769 772 800
    ModeLine     "1280x768" 88.0 1280 1352 1488 1696 768 769 772 798
    ModeLine     "1280x768" 84.8 1280 1328 1360 1440 768 771 778 796 +hsync -vsync
    ModeLine     "1280x768" 80.1 1280 1344 1480 1680 768 769 772 795
    ModeLine     "1024x768" 81.8 1024 1080 1192 1360 768 769 772 802
    ModeLine     "1024x768" 76.2 1024 1080 1192 1360 768 769 772 800
    ModeLine     "1024x768" 69.7 1024 1080 1184 1344 768 769 772 798
    ModeLine     "1024x768" 69.5 1024 1072 1104 1184 768 771 775 796 +hsync -vsync
    ModeLine     "1024x768" 64.1 1024 1080 1184 1344 768 769 772 795
    ModeLine     "1280x600" 79.0 1280 1344 1480 1680 600 601 604 627
    ModeLine     "1280x600" 72.8 1280 1336 1472 1664 600 601 604 625
    ModeLine     "1280x600" 66.7 1280 1336 1464 1648 600 601 604 623
    ModeLine     "1280x600" 66.2 1280 1328 1360 1440 600 603 613 622 +hsync -vsync
    ModeLine     "1280x600" 61.5 1280 1336 1464 1648 600 601 604 622
    ModeLine     "1024x600" 63.2 1024 1080 1184 1344 600 601 604 627
    ModeLine     "1024x600" 58.1 1024 1072 1176 1328 600 601 604 625
    ModeLine     "1024x600" 54.2 1024 1072 1104 1184 600 603 613 622 +hsync -vsync
    ModeLine     "1024x600" 53.8 1024 1072 1176 1328 600 601 604 623
    ModeLine     "1024x600" 49.0 1024 1064 1168 1312 600 601 604 622
    ModeLine     "800x600" 48.9 800 840 920 1040 600 601 604 627
    ModeLine     "800x600" 45.5 800 840 920 1040 600 601 604 625
    ModeLine     "800x600" 44.0 800 848 880 960 600 603 607 622 +hsync -vsync
    ModeLine     "800x600" 42.1 800 840 920 1040 600 601 604 623
    ModeLine     "800x600" 38.2 800 832 912 1024 600 601 604 622
    ModeLine     "768x576" 45.5 768 808 888 1008 576 577 580 602
    ModeLine     "768x576" 41.7 768 800 880 992 576 577 580 600
    ModeLine     "768x576" 40.8 768 816 848 928 576 579 583 597 +hsync -vsync
    ModeLine     "768x576" 38.6 768 800 880 992 576 577 580 598
    ModeLine     "768x576" 35.0 768 792 872 976 576 577 580 597
    ModeLine     "640x480" 30.7 640 664 728 816 480 481 484 502
    ModeLine     "640x480" 29.2 640 688 720 800 480 483 487 497 +hsync -vsync
    ModeLine     "640x480" 28.6 640 664 728 816 480 481 484 500
    ModeLine     "640x480" 25.9 640 656 720 800 480 481 484 499
    ModeLine     "640x480" 23.9 640 656 720 800 480 481 484 497
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "CRT-0"
    DisplaySize     337    270
    HorizSync       29.0 - 83.0
    VertRefresh     43.0 - 75.0
    Option         "DPMS"
EndSection

Section "Monitor"
    Identifier     "Monitor1"
    VendorName     "Unknown"
    ModelName      "TV-0"
    HorizSync       28.0 - 33.0
    VertRefresh     43.0 - 72.0
EndSection

Section "Device"
    Identifier     "Videocard0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          0
    Option         "Xinerama" "off"
EndSection

Section "Device"
    Identifier     "Videocard1"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BoardName      "GeForce FX 5200"
    BusID          "PCI:1:0:0"
    Screen          1
    Option         "Xinerama" "off"
EndSection

Section "Screen"

# Removed Option "metamodes" "CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    Identifier     "Screen0"
    Device         "Videocard1"
    Monitor        "Monitor0"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "CRT: 1280x1024_60 +0+0; CRT: 1280x1024 +0+0; CRT: 1280x960 +0+0; CRT: 1152x864 +0+0; CRT: 1024x768 +0+0; CRT: 800x600 +0+0; CRT: 640x480 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Section "Screen"
    Identifier     "Screen1"
    Device         "Videocard0"
    Monitor        "Monitor1"
    DefaultDepth    24
    Option         "Xinerama" "off"
    Option         "ConnectedMonitor" "CRT,TV"
    Option         "IgnoreDisplayDevices" "DFP"
#    Option         "TVOutFormat" "SVIDEO"
    Option         "TVOutFormat" "COMPOSITE"
    Option         "TVStandard" "PAL-B"
    Option         "TwinView" "0"
    Option         "Xinerama" "off"
    Option         "metamodes" "TV: 800x600 +0+0"
    SubSection     "Display"
        Depth       24
        Modes      "1600x1200" "1280x1024" "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Greeting & happy bug fixing,
Heiko Kirschke


Follow-Ups:

Date: 2007-Oct-28 11:59
By: hkirschk

Comment:
Moin Stefan,

I've reduced the modes in xorg.conf to those actually used, i.e. 1280x1024 for :0.0 and 800x600 for :0.1. With the unmodified video-xv.c I get the same X_ShmPutImage error.

Regarding the Xinerama setting indicated in the log file, this also looks very strange to me (esp. since I tried to switch Xinerama off in xorg.conf). Although DISPLAY is set to :0.1, the resolution of DISPLAY :0.0 is shown. Maybe there's a bug in X Windows' Xinerama?
-------------------------------------------------------

Date: 2007-Oct-25 13:33
By: lucke

Comment:
Thanks for your detailed analysis.

Can you check your X configuration.
You've 2 screens defined and both screens are of the same size.
Please drop modes "1600x1200" "1280x1024" "1024x768" from subsection display of screen1 and try an unmodified softdevice version.

A bit strange are the following messages:
[XvVideoOut]: Xinerama Screen 0: 0,0 1280x1024
[XvVideoOut]: dispName = :0.1

-> There is only one screen with 1280x1024 dimensions.
That should be screen0 I guess, but the name you diplayed is from screen1.

-------------------------------------------------------

For detailed info, follow this link:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=12224&group_id=2051


From per at mellander.org  Thu Nov  1 12:55:20 2007
From: per at mellander.org (Per Mellander)
Date: Thu, 01 Nov 2007 12:55:20 +0100
Subject: [Softdevice-devel] Softplay, unable to play (mpeg) movies.
In-Reply-To: <46439268.4080506@gmx.net>
References: <461220AF.2070001@mellander.org>	<4612BAC2.4080909@gmx.net>	<46136DF1.7020508@mellander.org>	<4613D481.4050308@gmx.net>	<461CC9E2.2000509@mellander.org>	<46248C75.2010500@mellander.org>
	<46439268.4080506@gmx.net>
Message-ID: <4729BEA8.1080707@mellander.org>

Hi!

Just for info I can tell that vdr-1.5.10 + ffmpeg,softdevice,softplay ( all of 
cvs/svn 20071031 ) works like a charm. Softplay has been bugging me and my kids 
for a while. Now they can watch all their movies again.

Thanks,

Per


From Neumann at DO-net.de  Sat Nov  3 11:10:09 2007
From: Neumann at DO-net.de (Andre Neumann)
Date: Sat, 3 Nov 2007 11:10:09 +0100
Subject: [Softdevice-devel] Softplay not working with latest cvs
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D03901A19E@sbs2003.do-net.de>

Hi,

i'm using the newest versions from ffmpeg (svn today), softdevice (cvs from today) and softplay (cvs from today).

When playing a file with softplay, i get the following:

new Aspect detected 1,333333 (1,347368) / bb 3 71
OpenLastBrowsedDir: '' startFrom ''
Opening dir '' until ''
MyDir ''
scandir error
Open only directory ''.
scandir error
LISTDEB: PrepareForPlayback
LISTDEB: NextFile currShuffleIdx -1
LISTDEB: NextFile currShuffleIdx 0 nIdx 72
LISTDEB: PrepareForPlayback
LISTDEB: NextFile currShuffleIdx -1
LISTDEB: NextFile currShuffleIdx 0 nIdx 72
PLDBG: ~cSoftControl()
PLDBG: ~cSoftPlayer
PLDBG: Activate 1
PLDBG: Thread started: SoftPlayer
softdevicePlugin 0x8255380
Service 'softdevice-GetPacketHandles-v1.0'
IsStream .mp3
open file '/opt//mp3/absolute_beginner_feat._sammy_-_k2.mp3'
(!) [ 7257:    0.000] --> Caught signal 11 (at (nil), invalid address) <--


Running a gdb, this is what i get:

 

(gdb) bt
#0  0x40017410 in ?? ()
#1  0x4b19aebc in ?? ()
#2  0x00000006 in ?? ()
#3  0x00001c95 in ?? ()
#4  0x40166751 in raise () from /lib/tls/libc.so.6
#5  0x40167f29 in abort () from /lib/tls/libc.so.6
#6  0x40cf0c14 in signal_handler () from /usr/lib/libdirect-1.0.so.0
#7  <signal handler called>
#8  0x40b6c704 in ff_mov_iso639_to_lang () from /usr/lib/libavformat.so.51


Anyone can fix this ?

----------------
Andre Neumann

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071103/bb66b2f2/attachment.html>

From per at mellander.org  Wed Dec 12 09:19:49 2007
From: per at mellander.org (Per Mellander)
Date: Wed, 12 Dec 2007 09:19:49 +0100
Subject: [Softdevice-devel] EPIA HW decoding HOWTO
Message-ID: <475F99A5.2010501@mellander.org>

FYI

The page at http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
is now up for traffic. Sorry for the downtime.

Please feel free to make suggestions for improvement.

Per


From torgeir at pobox.com  Wed Dec 12 09:57:33 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Wed, 12 Dec 2007 18:57:33 +1000
Subject: [Softdevice-devel] EPIA HW decoding HOWTO
In-Reply-To: <475F99A5.2010501@mellander.org>
References: <475F99A5.2010501@mellander.org>
Message-ID: <DCCB6F09-1B91-4910-B701-B20FD888ED6E@pobox.com>


On 12 Dec 2007, at 18:19, Per Mellander wrote:

> FYI
>
> The page at http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
> is now up for traffic. Sorry for the downtime.
>
> Please feel free to make suggestions for improvement.


Some unrelated questions:

- I sometimes get colour banding with my CLE266 setup using RGB  
output. I figure this might be related to either low bandwidth  
transmission (dvb-t) or simply the HW scaler using only 8bit  
precision. Any ideas?

- What is the status of H.264 decoding on VIA hardware now?

-- 
Torgeir Veimo
torgeir at pobox.com





From dpageau at infodev.ca  Thu Dec 20 23:05:13 2007
From: dpageau at infodev.ca (D.Pageau)
Date: Thu, 20 Dec 2007 17:05:13 -0500
Subject: [Softdevice-devel] mpeg2decoder.c compile error
Message-ID: <476AE719.40907@infodev.ca>

I'm on debian and follow step here but using vdr1.4.7:

http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266

viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++

Compile error in vdr "make plugins" .  I'm stuck there.

# LANG=c make plugins
Plugin softdevice:
make[1]: Entering directory 
`/usr/local/src/vdr-1.4.7/PLUGINS/src/softdevice'
g++ -O2 -g -Wall -fPIC -Woverloaded-virtual   -c -DHAVE_CONFIG 
-D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE 
-DPLUGINLIBDIR='"./PLUGINS/lib"' -DSHM_SUPPORT -I../../../include 
-I../../../../DVB/include -I/usr/local/include/ffmpeg 
-I/usr/local/include/ffmpeg -I/usr/local/include/postproc   -D_REENTRANT 
-I/usr/local/include/directfb -I/usr/local/include/dfb++ 
-DHAVE_CLE266_MPEG_DECODER -I/usr/local/include   mpeg2decoder.c
/usr/local/include/ffmpeg/avcodec.h:2285: warning: 'ImgReSampleContext' 
is deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2279)
/usr/local/include/ffmpeg/avcodec.h:2295: warning: 'ImgReSampleContext' 
is deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2279)
mpeg2decoder.c: In member function 'virtual int 
cAudioStreamDecoder::DecodePacket(AVPacket*)':
mpeg2decoder.c:455: warning: 'avcodec_decode_audio' is deprecated 
(declared at /usr/local/include/ffmpeg/avcodec.h:2606)
mpeg2decoder.c:456: warning: 'avcodec_decode_audio' is deprecated 
(declared at /usr/local/include/ffmpeg/avcodec.h:2606)
mpeg2decoder.c: In member function 'int 
cMpeg2Decoder::read_packet(uint8_t*, int)':
mpeg2decoder.c:1081: error: request for member 'buffer' in 
'((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
is of non-class type 'ByteIOContext*'
mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to 
'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*, 
unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int 
(*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
mpeg2decoder.c:1116: error: request for member 'buf_end' in 
'((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
is of non-class type 'ByteIOContext*'
mpeg2decoder.c:1117: error: request for member 'is_streamed' in 
'((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
is of non-class type 'ByteIOContext*'
mpeg2decoder.c: In member function 'virtual void cMpeg2Decoder::Action()':
mpeg2decoder.c:1155: warning: comparison between signed and unsigned 
integer expressions
mpeg2decoder.c: In member function 'void 
cMpeg2Decoder::QueuePacket(const AVFormatContext*, AVPacket&, bool)':
mpeg2decoder.c:1215: warning: comparison between signed and unsigned 
integer expressions
make[1]: *** [mpeg2decoder.o] Error 1
make[1]: Leaving directory `/usr/local/src/vdr-1.4.7/PLUGINS/src/softdevice'

*** failed plugins: softdevice



From dpageau at infodev.ca  Fri Dec 21 02:15:26 2007
From: dpageau at infodev.ca (D.Pageau)
Date: Thu, 20 Dec 2007 20:15:26 -0500
Subject: [Softdevice-devel] VDR help
Message-ID: <476B13AE.2090604@infodev.ca>

Can't find any English or French help forum or listserv on VDR official 
site.  The only site found was VDR-portal which seems to be german only.




From per at mellander.org  Fri Dec 21 07:20:58 2007
From: per at mellander.org (Per Mellander)
Date: Fri, 21 Dec 2007 07:20:58 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <476AE719.40907@infodev.ca>
References: <476AE719.40907@infodev.ca>
Message-ID: <476B5B4A.5070704@mellander.org>


I've noticed that newer ffmpeg doesn't match softdevice.

I did the actual setup of my EPIA MII 12000 last week. Can't look at it now 
because it's powered off and @home but I recognize the error. I took an older 
ffmpeg and it compiled.

Looking at my main VDR @home, I'm running softdevice-cvs-071220 + FFmpeg version 
SVN-r10885.

Per

D.Pageau skrev:
> I'm on debian and follow step here but using vdr1.4.7:
> 
> http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
> 
> viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++
> 
> Compile error in vdr "make plugins" .  I'm stuck there.
> 
> # LANG=c make plugins
> Plugin softdevice:
> make[1]: Entering directory 
> `/usr/local/src/vdr-1.4.7/PLUGINS/src/softdevice'
> g++ -O2 -g -Wall -fPIC -Woverloaded-virtual   -c -DHAVE_CONFIG 
> -D__STDC_CONSTANT_MACROS -DPLUGIN_NAME_I18N='"softdevice"' -D_GNU_SOURCE 
> -DPLUGINLIBDIR='"./PLUGINS/lib"' -DSHM_SUPPORT -I../../../include 
> -I../../../../DVB/include -I/usr/local/include/ffmpeg 
> -I/usr/local/include/ffmpeg -I/usr/local/include/postproc   -D_REENTRANT 
> -I/usr/local/include/directfb -I/usr/local/include/dfb++ 
> -DHAVE_CLE266_MPEG_DECODER -I/usr/local/include   mpeg2decoder.c
> /usr/local/include/ffmpeg/avcodec.h:2285: warning: 'ImgReSampleContext' 
> is deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2279)
> /usr/local/include/ffmpeg/avcodec.h:2295: warning: 'ImgReSampleContext' 
> is deprecated (declared at /usr/local/include/ffmpeg/avcodec.h:2279)
> mpeg2decoder.c: In member function 'virtual int 
> cAudioStreamDecoder::DecodePacket(AVPacket*)':
> mpeg2decoder.c:455: warning: 'avcodec_decode_audio' is deprecated 
> (declared at /usr/local/include/ffmpeg/avcodec.h:2606)
> mpeg2decoder.c:456: warning: 'avcodec_decode_audio' is deprecated 
> (declared at /usr/local/include/ffmpeg/avcodec.h:2606)
> mpeg2decoder.c: In member function 'int 
> cMpeg2Decoder::read_packet(uint8_t*, int)':
> mpeg2decoder.c:1081: error: request for member 'buffer' in 
> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
> is of non-class type 'ByteIOContext*'
> mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
> mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to 
> 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*, 
> unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int 
> (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
> mpeg2decoder.c:1116: error: request for member 'buf_end' in 
> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
> is of non-class type 'ByteIOContext*'
> mpeg2decoder.c:1117: error: request for member 'is_streamed' in 
> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which 
> is of non-class type 'ByteIOContext*'
> mpeg2decoder.c: In member function 'virtual void cMpeg2Decoder::Action()':
> mpeg2decoder.c:1155: warning: comparison between signed and unsigned 
> integer expressions
> mpeg2decoder.c: In member function 'void 
> cMpeg2Decoder::QueuePacket(const AVFormatContext*, AVPacket&, bool)':
> mpeg2decoder.c:1215: warning: comparison between signed and unsigned 
> integer expressions
> make[1]: *** [mpeg2decoder.o] Error 1
> make[1]: Leaving directory `/usr/local/src/vdr-1.4.7/PLUGINS/src/softdevice'
> 
> *** failed plugins: softdevice
> 
> _______________________________________________
> Softdevice-devel mailing list
> Softdevice-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/softdevice-devel



From stefan at lucke.in-berlin.de  Fri Dec 21 10:53:21 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Dec 2007 10:53:21 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <476B5B4A.5070704@mellander.org>
References: <476AE719.40907@infodev.ca> <476B5B4A.5070704@mellander.org>
Message-ID: <1198230801.476b8d11053ab@webmail.in-berlin.de>

Quoting Per Mellander <per at mellander.org>:

>
> I've noticed that newer ffmpeg doesn't match softdevice.
>
> I did the actual setup of my EPIA MII 12000 last week. Can't look at it now
> because it's powered off and @home but I recognize the error. I took an older
> ffmpeg and it compiled.
>
> Looking at my main VDR @home, I'm running softdevice-cvs-071220 + FFmpeg version
> SVN-r10885.

At a first glance it looks like ffmpeg svn-11071 is causing some troubles.
Comment of this change is: "Use dynamically allocated ByteIOContext in AVFormatContext"

So we have to adapte our sources :-).
LIBAVFORMAT_VERSION  changed from "51.19.0" to "52.0.0"

For troubles in line 1081 it should be something like:

#if LIBAVFORMAT_BUILD >= ((52<<16)+(0<<8)+0)
       ic->pb->buffer=u;
#else
       ic->pb.buffer=u;
#endif

>
> Per
>
> D.Pageau skrev:
> > I'm on debian and follow step here but using vdr1.4.7:
> >
> > http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
> >
> > viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++

I guess you took all from cvs / svn ?

> >
> > Compile error in vdr "make plugins" .  I'm stuck there.
> >
> > # LANG=c make plugins
> > Plugin softdevice:
> > make[1]: Entering directory
> > `/usr/local/src/vdr-1.4.7/PLUGINS/src/softdevice'

> > (declared at /usr/local/include/ffmpeg/avcodec.h:2606)
> > mpeg2decoder.c: In member function 'int
> > cMpeg2Decoder::read_packet(uint8_t*, int)':
> > mpeg2decoder.c:1081: error: request for member 'buffer' in
> > '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
> > is of non-class type 'ByteIOContext*'
> > mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
> > mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to
> > 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*,
> > unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int
> > (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
> > mpeg2decoder.c:1116: error: request for member 'buf_end' in
> > '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
> > is of non-class type 'ByteIOContext*'
> > mpeg2decoder.c:1117: error: request for member 'is_streamed' in
> > '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
> > is of non-class type 'ByteIOContext*'
> > mpeg2decoder.c: In member function 'virtual void cMpeg2Decoder::Action()':
> > mpeg2decoder.c:1155: warning: comparison between signed and unsigned
> > integer expressions
> > mpeg2decoder.c: In member function 'void
> > cMpeg2Decoder::QueuePacket(const AVFormatContext*, AVPacket&, bool)':
> > mpeg2decoder.c:1215: warning: comparison between signed and unsigned
> > integer expressions

Stefan Lucke


From stefan at lucke.in-berlin.de  Fri Dec 21 12:37:07 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Dec 2007 12:37:07 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <1198230801.476b8d11053ab@webmail.in-berlin.de>
References: <476AE719.40907@infodev.ca> <476B5B4A.5070704@mellander.org>
	<1198230801.476b8d11053ab@webmail.in-berlin.de>
Message-ID: <1198237027.476ba563ced67@webmail.in-berlin.de>

Quoting Stefan Lucke <stefan at lucke.in-berlin.de>:

> Quoting Per Mellander <per at mellander.org>:
>
> >
> > I've noticed that newer ffmpeg doesn't match softdevice.
> >
> > I did the actual setup of my EPIA MII 12000 last week. Can't look at it now
> > because it's powered off and @home but I recognize the error. I took an older
> > ffmpeg and it compiled.
> >
> > Looking at my main VDR @home, I'm running softdevice-cvs-071220 + FFmpeg version
> > SVN-r10885.
>
> At a first glance it looks like ffmpeg svn-11071 is causing some troubles.
> Comment of this change is: "Use dynamically allocated ByteIOContext in AVFormatContext"
>
> So we have to adapte our sources :-).
> LIBAVFORMAT_VERSION  changed from "51.19.0" to "52.0.0"
>
> For troubles in line 1081 it should be something like:
>
> #if LIBAVFORMAT_BUILD >= ((52<<16)+(0<<8)+0)
>        ic->pb->buffer=u;
> #else
>        ic->pb.buffer=u;
> #endif
>

Seems to be a more serious problem as fixing this,
still causes segfaults during av_open_input_file(&ic, "null",fmt,0,NULL)
or with fmt->flags |= AVFMT_NOFILE; commented out, during
init_put_byte ().

Stefan Lucke


From lis_-t.20_0.7 at poczta.multimo.pl  Fri Dec 21 16:44:44 2007
From: lis_-t.20_0.7 at poczta.multimo.pl (Artur Skawina)
Date: Fri, 21 Dec 2007 16:44:44 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <1198237027.476ba563ced67@webmail.in-berlin.de>
References: <476AE719.40907@infodev.ca>
	<476B5B4A.5070704@mellander.org>	<1198230801.476b8d11053ab@webmail.in-berlin.de>
	<1198237027.476ba563ced67@webmail.in-berlin.de>
Message-ID: <476BDF6C.6000305@poczta.multimo.pl>

Stefan Lucke wrote:
> Quoting Stefan Lucke <stefan at lucke.in-berlin.de>:
> 
>> Quoting Per Mellander <per at mellander.org>:
>>
>>> I've noticed that newer ffmpeg doesn't match softdevice.

>>> Looking at my main VDR @home, I'm running softdevice-cvs-071220 + FFmpeg version
>>> SVN-r10885.
>> At a first glance it looks like ffmpeg svn-11071 is causing some troubles.
>> Comment of this change is: "Use dynamically allocated ByteIOContext in AVFormatContext"

>> For troubles in line 1081 it should be something like:
>>
>> #if LIBAVFORMAT_BUILD >= ((52<<16)+(0<<8)+0)
>>        ic->pb->buffer=u;
>> #else
>>        ic->pb.buffer=u;
>> #endif

> Seems to be a more serious problem as fixing this,
> still causes segfaults during av_open_input_file(&ic, "null",fmt,0,NULL)
> or with fmt->flags |= AVFMT_NOFILE; commented out, during
> init_put_byte ().

yes, i ran into this when upgrading ffmpeg too, tried the simple changes below,
but it wasn't enough, something is still missing. then i downgraded ffmpeg and
didn't investigate further....

artur 

diff -urNp softdevice-cvs/mpeg2decoder.c softdevice-cvs-new/mpeg2decoder.c
--- softdevice-cvs/mpeg2decoder.c	2007-05-12 18:40:49.000000000 +0200
+++ softdevice-cvs-new/mpeg2decoder.c	2007-11-28 19:15:16.000000000 +0100
@@ -1067,7 +1067,7 @@ start:
        if (size>buf_size)
          size=buf_size;
 
-       ic->pb.buffer=u;
+       ic->pb->buffer=u;
        LastSize=size;
        BUFDEB("read_packet: got %d bytes\n",size);
        return size;
@@ -1096,14 +1096,15 @@ void cMpeg2Decoder::initStream() {
    fmt=av_find_input_format("mpeg");
    fmt->flags |= AVFMT_NOFILE;
 
+   ic = NULL;
    if ( int err=av_open_input_file(&ic, "null",fmt,0,NULL) ) {
        printf("Failed to open input stream.Error %d\n",err);
    };
 
-   init_put_byte(&ic->pb, NULL,dvb_buf_size[setupStore->bufferMode]/2, 0, this,
+   init_put_byte(ic->pb, NULL,dvb_buf_size[setupStore->bufferMode]/2, 0, this,
        read_packet_RingBuffer,NULL,seek_RingBuffer);
-   ic->pb.buf_end=NULL;
-   ic->pb.is_streamed=true;
+   ic->pb->buf_end=NULL;
+   ic->pb->is_streamed=true;
    CMDDEB("init put byte finished\n");
 };
 






From stefan at lucke.in-berlin.de  Fri Dec 21 19:12:17 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Dec 2007 19:12:17 +0100
Subject: [Softdevice-devel] VDR help
In-Reply-To: <476B13AE.2090604@infodev.ca>
References: <476B13AE.2090604@infodev.ca>
Message-ID: <1198260737.476c0201aa17c@webmail.in-berlin.de>

Quoting "D.Pageau":

> Can't find any English or French help forum or listserv on VDR official
> site.  The only site found was VDR-portal which seems to be german only.

If you are looking for softdevice help you may ask on this list or VDR's
official list.

If you need help on VDR general themes, best place would be VDR's official
list (in english).

http://www.linuxtv.org/
http://www.linuxtv.org/pipermail/vdr/


Stefan Lucke



From stefan at lucke.in-berlin.de  Fri Dec 21 19:20:05 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Dec 2007 19:20:05 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <476AE719.40907@infodev.ca>
References: <476AE719.40907@infodev.ca>
Message-ID: <1198261205.476c03d5c8a3b@webmail.in-berlin.de>

Quoting "D.Pageau":

> I'm on debian and follow step here but using vdr1.4.7:
>
> http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
>
> viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++
>
> Compile error in vdr "make plugins" .  I'm stuck there.
>


> mpeg2decoder.c:1081: error: request for member 'buffer' in
> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
> is of non-class type 'ByteIOContext*'
> mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
> mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to
> 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*,
> unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int
> (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'

You need 2 patches. One for softdevice _and_ one for ffmpeg.
Could you please test ?

The bad thing is, this cannot be worked around in softdevice.
I'll report that on ffmpeg list too.

Stefan Lucke
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ffmpeg_av_open_input_stream-01.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071221/cb611fd0/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ffmpeg_compile_fix.diff
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071221/cb611fd0/attachment-0001.ksh>

From lis_-t.20_0.7 at poczta.multimo.pl  Fri Dec 21 21:04:36 2007
From: lis_-t.20_0.7 at poczta.multimo.pl (Artur Skawina)
Date: Fri, 21 Dec 2007 21:04:36 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <1198261205.476c03d5c8a3b@webmail.in-berlin.de>
References: <476AE719.40907@infodev.ca>
	<1198261205.476c03d5c8a3b@webmail.in-berlin.de>
Message-ID: <476C1C54.6090405@poczta.multimo.pl>

Stefan Lucke wrote:
> Quoting "D.Pageau":
>> mpeg2decoder.c:1081: error: request for member 'buffer' in
>> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
>> is of non-class type 'ByteIOContext*'
>> mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
>> mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to
>> 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*,
>> unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int
>> (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
> 
> You need 2 patches. One for softdevice _and_ one for ffmpeg.
> Could you please test ?

works for me, using current ffmpeg cvs-071221.1937.

artur


From dompageau at sympatico.ca  Fri Dec 21 23:14:59 2007
From: dompageau at sympatico.ca (D.Pageau)
Date: Fri, 21 Dec 2007 17:14:59 -0500
Subject: [Softdevice-devel] vdr exit on dfb error
Message-ID: <476C3AE3.3040909@sympatico.ca>

vdr exit with dfb error.

I've seen some discussion on this list 2007Q1, I have try both 
ARGB/AiRGB without success.  Can't figure out what's wrong.

My config: debian and follow step here but using vdr1.4.7:

http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266

viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++

# cat /etc/directfbrc
fbdev=/dev/fb0
mode=720x576
depth=32
pixelformat=ARGB
disable-module=cle266
no-vt

# LANG=c ./vdr -P"softdevice -vo dfb:cle266" -v /tmp
softdevice: Created setupStoreId 360449!
softdevice: Attatched to setupStoreId 360449 at 0xb7f4a000.
[softdevice] processing args
[softdevice]   argv [0] = softdevice
[softdevice]   argv [1] = -vo
[softdevice] enabling CLE266 HW decoding
[softdevice] initializing Plugin
[softdevice] Initializing Video Out
[softdevice] ffmpeg build(3354880)
16:55:17.0231 I [6430] [dfb] init

      =======================|  DirectFB 1.0.0  |=======================
           (c) 2001-2007  The DirectFB Organization (directfb.org)
           (c) 2000-2004  Convergence (integrated media) GmbH
         ------------------------------------------------------------

(*) DirectFB/Core: Single Application Core. (2007-12-21 19:37)
(*) Direct/Thread: Running 'PS/2 Input' (INPUT, 6433)...
(*) DirectFB/Input: IMPS/2 Mouse 1.0 (directfb.org)
(*) Direct/Thread: Running 'Linux Input' (INPUT, 6434)...
(*) DirectFB/Input: PC Speaker 0.1 (directfb.org)
(*) DirectFB/Genefx: MMX detected and enabled
(*) Direct/Modules: suppress module 'cle266'
(*) DirectFB/Graphics: VIA/S3G CLE266/UniChrome 0.4 (-)
(*) DirectFB/Core/WM: Default 0.3 (directfb.org)
(!) DirectFB/DirectFBCreate: Setting desktop resolution to 720x576 failed!
      -> Using default resolution.
(!) DirectFB/DirectFBCreate: Setting desktop format failed!
      -> Using default format.
(!) DirectFB/DirectFBCreate: Setting desktop buffer mode failed!
      -> No virtual resolution support or not enough memory?
         Falling back to system back buffer.
[dfb] RAM: 33288192 bytes
[dfb] Accellerated Functions: FillRectange DrawRectange DrawLine 
FillTriangle Blit StretchBlit All
[dfb] Drawing Flags: Blend Xor
[dfb] Surface Blitting Flags: BlendAlpha BlendColorAlpha Colorize 
SrcColorkey DstColorkey Deinterlace
16:55:17.0404 I [6430] [dfb] Supported video Modes are:
640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8 
800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8 
1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 
1280x960 at 8 1280x960 at 16 1280x960 at 32 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 
1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8
16:55:17.0408 I [6430] [dfb] Enumerating display Layers
16:55:17.0409 I [6430] [dfb] Configuring CooperativeLevel for OSD
Layer 0 VIA CLE266 Graphics  Type: graphics
   Caps: alphachannel brightness contrast opacity saturation 
src_colorkey surface
Layer 1 VIA Unichrome Video  Type: graphics picture video
   Caps: deinterlacing dst_colorkey levels field_parity opacity 
screen_location surface
16:55:17.0414 I [6430] Initialising CLE266 decoder (?4???4??): success!
16:55:17.0414 I [6430] CLE266: Creating buffers for decoder
16:55:17.0415 D [6430] CLE266: Creating buffer number 0
16:55:17.0417 D [6430] CLE266: Creating buffer number 1
16:55:17.0418 D [6430] CLE266: Creating buffer number 2
16:55:17.0420 D [6430] CLE266: Creating buffer number 3
16:55:17.0422 D [6430] CLE266: passing mpegfb_stride
16:55:17.0422 D [6430] CLE266: passing buffers to decoder
16:55:17.0423 I [6430] [dfb] (osdLayer): flags, options, pixelformat: 
0000000f, 00000000 00200801
16:55:17.0423 I [6430] [dfb] (osdLayer): width, height: 
640 480
16:55:17.0424 I [6430] [dfb] osdLayer has alpha channel
16:55:17.0440 E [6430] [dfb] init 
EXITING:action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), 
result=Not supported!
  (!!!)  *** WARNING [Application exited without deinitialization of 
DirectFB!] *** [core.c:775 in dfb_core_deinit_check()]


From dompageau at sympatico.ca  Fri Dec 21 22:58:48 2007
From: dompageau at sympatico.ca (D.Pageau)
Date: Fri, 21 Dec 2007 16:58:48 -0500
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <1198261205.476c03d5c8a3b@webmail.in-berlin.de>
References: <476AE719.40907@infodev.ca>
	<1198261205.476c03d5c8a3b@webmail.in-berlin.de>
Message-ID: <476C3718.3000908@sympatico.ca>

Stefan Lucke wrote:
> You need 2 patches. One for softdevice _and_ one for ffmpeg.
> Could you please test ?

works for me using ffmpeg r11292 and softdevice.

Thanks Stefan


From stefan at lucke.in-berlin.de  Fri Dec 21 23:35:39 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Fri, 21 Dec 2007 23:35:39 +0100
Subject: [Softdevice-devel] vdr exit on dfb error
In-Reply-To: <476C3AE3.3040909@sympatico.ca>
References: <476C3AE3.3040909@sympatico.ca>
Message-ID: <200712212335.39746.stefan@lucke.in-berlin.de>

On Friday 21 December 2007, D.Pageau wrote:
> vdr exit with dfb error.
> 
> I've seen some discussion on this list 2007Q1, I have try both 
> ARGB/AiRGB without success.  Can't figure out what's wrong.
> 
> My config: debian and follow step here but using vdr1.4.7:
> 
> http://www.mellander.org/per/projects/linux/?chapter=epia-hw-cle266
> 
> viafb, libcle266mpegdec, ffmpeg, DirectFB, DFB++
> 
> # cat /etc/directfbrc
> fbdev=/dev/fb0
> mode=720x576

720x576 is mostly used for TV-out. But I guess you are trying vga-out.
So your /etc/fb.modes should have a mode that fits the resolution
specified here.

> depth=32
> pixelformat=ARGB
> disable-module=cle266
> no-vt
> 
> # LANG=c ./vdr -P"softdevice -vo dfb:cle266" -v /tmp


> (!) DirectFB/DirectFBCreate: Setting desktop resolution to 720x576 failed!
>       -> Using default resolution.


> 16:55:17.0404 I [6430] [dfb] Supported video Modes are:
> 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 640x480 at 8 800x600 at 8 800x600 at 8 
> 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 800x600 at 8 1024x768 at 8 
> 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 1024x768 at 8 
> 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 1152x864 at 8 
> 1280x960 at 8 1280x960 at 16 1280x960 at 32 1280x1024 at 8 1280x1024 at 8 1280x1024 at 8 
> 1280x1024 at 8 1280x1024 at 8 1600x1200 at 8 1600x1200 at 8 1600x1200 at 8

> 16:55:17.0423 I [6430] [dfb] (osdLayer): flags, options, pixelformat: 
> 0000000f, 00000000 00200801
> 16:55:17.0423 I [6430] [dfb] (osdLayer): width, height: 
> 640 480

Here the default resolution 640x480 is selected. From above enumeration
of available modes, there is only 8 bit color depth available for this one.

> 16:55:17.0424 I [6430] [dfb] osdLayer has alpha channel
> 16:55:17.0440 E [6430] [dfb] init 
> EXITING:action=IDirectFBDisplayLayer::SetConfiguration(DFBDisplayLayerConfig&), 
> result=Not supported!
>   (!!!)  *** WARNING [Application exited without deinitialization of 
> DirectFB!] *** [core.c:775 in dfb_core_deinit_check()]

Stefan Lucke


From Neumann at DO-net.de  Sun Dec 23 10:28:53 2007
From: Neumann at DO-net.de (Andre Neumann)
Date: Sun, 23 Dec 2007 10:28:53 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
References: <476AE719.40907@infodev.ca><1198261205.476c03d5c8a3b@webmail.in-berlin.de>
	<476C1C54.6090405@poczta.multimo.pl>
Message-ID: <FB3B5DB3197CEA429E5FB8E83D01D03901A1C7@sbs2003.do-net.de>

Tested it also and noticed that when switching from an
blank channel (a channel with no signal or card not in cam inserted) to a
working channel, vdr crashes. 
 
-----------------------
Andre Neumann

________________________________

Von: softdevice-devel-bounces at lists.berlios.de im Auftrag von Artur Skawina
Gesendet: Fr 21.12.2007 21:04
An: softdevice-devel at lists.berlios.de
Betreff: Re: [Softdevice-devel] mpeg2decoder.c compile error



Stefan Lucke wrote:
> Quoting "D.Pageau":
>> mpeg2decoder.c:1081: error: request for member 'buffer' in
>> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
>> is of non-class type 'ByteIOContext*'
>> mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
>> mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to
>> 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*,
>> unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int
>> (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
>
> You need 2 patches. One for softdevice _and_ one for ffmpeg.
> Could you please test ?

works for me, using current ffmpeg cvs-071221.1937.

artur
_______________________________________________
Softdevice-devel mailing list
Softdevice-devel at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/softdevice-devel



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/softdevice-devel/attachments/20071223/0a73c7bb/attachment.html>

From stefan at lucke.in-berlin.de  Sun Dec 23 11:38:30 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 23 Dec 2007 11:38:30 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <FB3B5DB3197CEA429E5FB8E83D01D03901A1C7@sbs2003.do-net.de>
References: <476AE719.40907@infodev.ca> <476C1C54.6090405@poczta.multimo.pl>
	<FB3B5DB3197CEA429E5FB8E83D01D03901A1C7@sbs2003.do-net.de>
Message-ID: <200712231138.30446.stefan@lucke.in-berlin.de>

On Sunday 23 December 2007, Andre Neumann wrote:
> Tested it also and noticed that when switching from an
> blank channel (a channel with no signal or card not in cam inserted) to a
> working channel, vdr crashes. 

Now I've a different version which solves initial issue in softdevice only.
This one removes tricks with AVFMT_NOFILE flag too, which in term
previously caused some problems in softplay:

http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softplay/SoftPlayer.c.diff?r1=1.16&r2=1.17

To test the new version, you have to backout both previous changes
(softdevice + ffmpeg).

With this one, there may be issues at termination, if ffmpeg's revision is
between and 11071 (ByteIOContext change) and 11269 (introduction of
function av_close_input_stream()). Issues may be a segfault or a
reported glibc error caused by ffmpeg url_fclose().

If you have a problems please check your ffmpeg version by:
$ ffplay |grep version
FFplay version SVN-r11292, Copyright (c) 2003-2007 Fabrice Bellard, et al.
  configuration: --enable-shared --enable-pp --enable-gpl --enable-swscaler --enable-liba52 --enable-libfaac --enable-libfaad --enable-pthreads
  libavutil version: 49.6.0
  libavcodec version: 51.49.0
  libavformat version: 52.3.0
  built on Dec 21 2007 11:27:31, gcc: 4.1.2 (Gentoo 4.1.2)

>  
> -----------------------
> Andre Neumann
> 


> 
> Stefan Lucke wrote:
> > Quoting "D.Pageau":
> >> mpeg2decoder.c:1081: error: request for member 'buffer' in
> >> '((cMpeg2Decoder*)this)->cMpeg2Decoder::ic->AVFormatContext::pb', which
> >> is of non-class type 'ByteIOContext*'
> >> mpeg2decoder.c: In member function 'void cMpeg2Decoder::initStream()':
> >> mpeg2decoder.c:1115: error: cannot convert 'ByteIOContext**' to
> >> 'ByteIOContext*' for argument '1' to 'int init_put_byte(ByteIOContext*,
> >> unsigned char*, int, int, void*, int (*)(void*, uint8_t*, int), int
> >> (*)(void*, uint8_t*, int), offset_t (*)(void*, offset_t, int))'
> >
> > You need 2 patches. One for softdevice _and_ one for ffmpeg.
> > Could you please test ?
> 
> works for me, using current ffmpeg cvs-071221.1937.
> 
> artur

Stefan Lucke
-------------- next part --------------
? ffmpeg_compile_fix-02.diff
? ffmpeg_compile_fix.diff
Index: mpeg2decoder.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.c,v
retrieving revision 1.77
diff -U3 -r1.77 mpeg2decoder.c
--- mpeg2decoder.c	27 Sep 2007 18:10:41 -0000	1.77
+++ mpeg2decoder.c	23 Dec 2007 10:35:12 -0000
@@ -1024,6 +1024,7 @@
   decoding=false;
   IsSuspended=false;
   Speed=1;
+  pb = NULL;
 }
 
 cMpeg2Decoder::~cMpeg2Decoder()
@@ -1078,7 +1079,11 @@
        if (size>buf_size)
          size=buf_size;
 
+#if LIBAVFORMAT_BUILD >= ((52<<16)+(0<<8)+0)
+       ic->pb->buffer=u;
+#else
        ic->pb.buffer=u;
+#endif
        LastSize=size;
        BUFDEB("read_packet: got %d bytes\n",size);
        return size;
@@ -1105,6 +1110,23 @@
    av_register_all();
 
    fmt=av_find_input_format("mpeg");
+
+#if LIBAVFORMAT_BUILD >= ((52<<16)+(0<<8)+0)
+   if (pb) {
+       av_free(pb->buffer);
+       av_free(pb);
+   }
+   pb = (ByteIOContext *) av_mallocz (sizeof (ByteIOContext));
+
+   if ( int err=av_open_input_stream (&ic, pb, "null", fmt, NULL) ) {
+       fprintf (stderr, "Failed to open input stream.Error %d\n", err);
+   }
+
+   init_put_byte(ic->pb, NULL,dvb_buf_size[setupStore->bufferMode]/2, 0, this,
+       read_packet_RingBuffer,NULL,seek_RingBuffer);
+   ic->pb->buf_end=NULL;
+    ic->pb->is_streamed=true;
+#else
    fmt->flags |= AVFMT_NOFILE;
 
    if ( int err=av_open_input_file(&ic, "null",fmt,0,NULL) ) {
@@ -1115,6 +1137,7 @@
        read_packet_RingBuffer,NULL,seek_RingBuffer);
    ic->pb.buf_end=NULL;
    ic->pb.is_streamed=true;
+#endif
    CMDDEB("init put byte finished\n");
 };
 
@@ -1472,8 +1495,11 @@
     }
     aout=NULL;
     aoutMutex.Unlock();
-
+#if LIBAVFORMAT_BUILD >= ((52<<16)+(3<<8)+0)
+    av_close_input_stream(ic);
+#else
     av_close_input_file(ic);
+#endif
     ic=NULL;
   }
   if (StreamBuffer) {
Index: mpeg2decoder.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/mpeg2decoder.h,v
retrieving revision 1.42
diff -U3 -r1.42 mpeg2decoder.h
--- mpeg2decoder.h	3 Apr 2007 19:06:17 -0000	1.42
+++ mpeg2decoder.h	23 Dec 2007 10:35:12 -0000
@@ -278,6 +278,7 @@
     bool freezeMode;
 
     AVFormatContext *ic;
+    ByteIOContext   *pb;
     int LastSize;
     cMutex  mutex;
     cSigTimer EnablePutSignal;

From lis_-t.20_0.7 at poczta.multimo.pl  Sun Dec 23 14:00:36 2007
From: lis_-t.20_0.7 at poczta.multimo.pl (Artur Skawina)
Date: Sun, 23 Dec 2007 14:00:36 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <200712231138.30446.stefan@lucke.in-berlin.de>
References: <476AE719.40907@infodev.ca>
	<476C1C54.6090405@poczta.multimo.pl>	<FB3B5DB3197CEA429E5FB8E83D01D03901A1C7@sbs2003.do-net.de>
	<200712231138.30446.stefan@lucke.in-berlin.de>
Message-ID: <476E5BF4.1030604@poczta.multimo.pl>

Stefan Lucke wrote:
> On Sunday 23 December 2007, Andre Neumann wrote:
>> Tested it also and noticed that when switching from an
>> blank channel (a channel with no signal or card not in cam inserted) to a
>> working channel, vdr crashes. 
> 
> Now I've a different version which solves initial issue in softdevice only.
> This one removes tricks with AVFMT_NOFILE flag too, which in term
> previously caused some problems in softplay:
> 
> http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softplay/SoftPlayer.c.diff?r1=1.16&r2=1.17
> 
> To test the new version, you have to backout both previous changes
> (softdevice + ffmpeg).
> 
> With this one, there may be issues at termination, if ffmpeg's revision is
> between and 11071 (ByteIOContext change) and 11269 (introduction of
> function av_close_input_stream()). Issues may be a segfault or a
> reported glibc error caused by ffmpeg url_fclose().
> 
> If you have a problems please check your ffmpeg version by:
> $ ffplay |grep version

tried w/ stock ffmpeg r11306 and now vdr crashes 1) after the first channel change
and 2) when started on "blank" channel like mentioned above.

The former seems to be triggered by freeing pb->buffer:
*** glibc detected *** vdr: free(): invalid pointer: 0xb1f7ca60 ***
#5  0xb7d25f77 in free () from /lib/libc.so.6
#6  0xb7c0986e in cMpeg2Decoder::initStream (this=0xb376dc18) at mpeg2decoder.c:1114
#7  0xb7c099ec in cMpeg2Decoder::Start (this=0xb376dc18, GetMutex=true) at mpeg2decoder.c:1346
#8  0xb7c040ed in cSoftDevice::SetPlayMode (this=0xb3708218, PlayMode=pmAudioVideo) at softdevice.c:428
#9  0x08092cc3 in cDevice::AttachPlayer (this=0xb3708218, Player=0xb1faf96c) at device.c:960
#10 0x080d271b in cControl::Attach () at player.c:80
#11 0x0810a734 in main (argc=0, argv=0xbf909854) at vdr.c:689

the latter crash looks like this:
Program received signal SIGSEGV, Segmentation fault.
#0  0xb7a9b5c8 in av_read_packet (s=0xb21a7370, pkt=0xae9f5350) at utils.c:502
#1  0xb7b9497c in cMpeg2Decoder::Action (this=0xb3948608) at mpeg2decoder.c:1160
#2  0x080ff939 in cThread::StartThread (Thread=0xb3948608) at thread.c:252
#3  0xb7f1222c in start_thread () from /lib/libpthread.so.0
#4  0xb7d0cd2e in clone () from /lib/libc.so.6

artur


From stefan_doermann at web.de  Sun Dec 23 15:12:12 2007
From: stefan_doermann at web.de (=?iso-8859-15?Q?Stefan_D=F6rmann?=)
Date: Sun, 23 Dec 2007 15:12:12 +0100
Subject: [Softdevice-devel] <kein Betreff>
Message-ID: <986058178@web.de>


______________________________________________________________________________
Jetzt neu! Im riesigen WEB.DE Club SmartDrive Dateien freigeben und mit 
Freunden teilen! http://www.freemail.web.de/club/smartdrive_ttc.htm/?mc=021134



From stefan_doermann at web.de  Sun Dec 23 15:18:04 2007
From: stefan_doermann at web.de (=?iso-8859-15?Q?Stefan_D=F6rmann?=)
Date: Sun, 23 Dec 2007 15:18:04 +0100
Subject: [Softdevice-devel] Softdevice-cvs + DirectFB 1.1.1 + i810fb on
	SMT7020s
Message-ID: <986060718@web.de>

Hi all,

Ok, i give it another try. I recently sent this message , but I couldn't find it on the list.

I am using softdevice with vdr-1.4.7 on my samsung smt7020s with directfb on i810fb. It works good if the color depth in directfbrc is set on 16, but if I use 24 or 32 bit, the video is ok, but the osd is in the background, I mean on 16:9 I can see a bit of the upper and the lower part of the osd. In addition to this the osd colour in some areas is strange (with 16bit), e.g. the green button is invisible.
DirectFB is cvs from 23.12.07, softdevice is cvs from today.
I also tried xineliboutput. I couldn't notice anything like that, it doesn't matter which colour depth is defined, osd looks alright, but for some reasons video is slightly stuttering, so softdevice is first choice.

By the way I have seen on vdrportal that some guys had the same issue with i810, but no solution yet.
If this might be due to transparency, how can I switch off osd transparency.

 dfbinfo:

Screen (00) FBDev Primary Screen (primary screen)
Caps: VSYNC POWER_MANAGEMENT

Layer (00) FBDev Primary Layer (primary layer)
Type: GRAPHICS
Caps: SURFACE BRIGHTNESS CONTRAST SATURATION

Layer (01) Intel 810/815 Overlay
Type: GRAPHICS VIDEO STILL_PICTURE
Caps: SURFACE OPACITY SCREEN_LOCATION DEINTERLACING DST_COLORKEY BRIGHTNESS CONTRAST SATURATION SCREEN_POSITION SCREEN_SIZE

Regards and merry christmas,

Stefan
_____________________________________________________________________
Der WEB.DE SmartSurfer hilft bis zu 70% Ihrer Onlinekosten zu sparen!
http://smartsurfer.web.de/?mc=100071&distributionid=000000000066



From stefan at lucke.in-berlin.de  Sun Dec 23 16:44:06 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 23 Dec 2007 16:44:06 +0100
Subject: [Softdevice-devel] Softdevice-cvs + DirectFB 1.1.1 + i810fb on
	SMT7020s
In-Reply-To: <986060718@web.de>
References: <986060718@web.de>
Message-ID: <200712231644.06352.stefan@lucke.in-berlin.de>

On Sunday 23 December 2007, Stefan D?rmann wrote:
> Hi all,
> 
> Ok, i give it another try. I recently sent this message , but I couldn't find it on the list.
> 
> I am using softdevice with vdr-1.4.7 on my samsung smt7020s with directfb on i810fb. It works good if the color depth in directfbrc is set on 16, but if I use 24 or 32 bit, the video is ok, but the osd is in the background, I mean on 16:9 I can see a bit of the upper and the lower part of the osd. In addition to this the osd colour in some areas is strange (with 16bit), e.g. the green button is invisible.
> DirectFB is cvs from 23.12.07, softdevice is cvs from today.
> I also tried xineliboutput. I couldn't notice anything like that, it doesn't matter which colour depth is defined, osd looks alright, but for some reasons video is slightly stuttering, so softdevice is first choice.
> 
> By the way I have seen on vdrportal that some guys had the same issue with i810, but no solution yet.
> If this might be due to transparency, how can I switch off osd transparency.
> 
>  dfbinfo:
> 
> Screen (00) FBDev Primary Screen (primary screen)
> Caps: VSYNC POWER_MANAGEMENT
> 
> Layer (00) FBDev Primary Layer (primary layer)
> Type: GRAPHICS
> Caps: SURFACE BRIGHTNESS CONTRAST SATURATION
> 
> Layer (01) Intel 810/815 Overlay
> Type: GRAPHICS VIDEO STILL_PICTURE
> Caps: SURFACE OPACITY SCREEN_LOCATION DEINTERLACING DST_COLORKEY BRIGHTNESS CONTRAST SATURATION SCREEN_POSITION SCREEN_SIZE
> 

Looks like directfb's i810 driver has still :-) the same issue like
the old i830 driver which was corrected.

Original thread on vdr-portal:
http://www.vdr-portal.de/board/thread.php?threadid=54640


http://mail.directfb.org/pipermail/directfb-dev/2006-September/002345.html


http://www.directfb.org/index.php/viewcvs.cgi/DirectFB/gfxdrivers/i830/i830_overlay.c.diff?r1=1.5&r2=1.6

From file gfxdrivers/i810/i810_overlay.c:

 584     /*
 585      * Destination color keying.
 586      */
 587 
 588     primary_format = dfb_primary_layer_pixelformat();
 589 
 590     i810drv->oregs->dclrkv = dfb_color_to_pixel( primary_format,
 591                                                  config->dst_key.r,
 592                                                  config->dst_key.g,
 593                                                  config->dst_key.b );
 594 
 595     i810drv->oregs->dclrkm = (1 << DFB_COLOR_BITS_PER_PIXEL( primary_format )) - 1;
 596 
 597     if (config->options & DLOP_DST_COLORKEY)
 598          i810drv->oregs->dclrkm |= 0x80000000;


Line 584 to 598 should be replaced by:
     /*
      * Destination color keying.
      */
     i810drv->oregs->dclrkv = PIXEL_RGB32 (config->dst_key.r, config->dst_key.g, config->dst_key.b );

     switch (DFB_COLOR_BITS_PER_PIXEL( dfb_primary_layer_pixelformat() )) {
          case 8:
               i810drv->oregs->dclrkm = 0xffffff;
               break;
          case 15:
               i810drv->oregs->dclrkm = 0x070707;
               break;
          case 16:
               i810drv->oregs->dclrkm = 0x070307;
               break;
          default:
               i810drv->oregs->dclrkm = 0;
               break;
     }

    if (config->options & DLOP_DST_COLORKEY)
         i810drv->oregs->dclrkm |= 0x80000000;

     /*
      * Disable source color keying if not selected
      */
     if (!(config->options & DLOP_SRC_COLORKEY)) {
          i810drv->oregs->sclrkvh = 0;
          i810drv->oregs->sclrkvh = 0;
          i810drv->oregs->sclrkm  = 0;
     }


Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Dec 23 18:17:33 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 23 Dec 2007 18:17:33 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <476E5BF4.1030604@poczta.multimo.pl>
References: <476AE719.40907@infodev.ca>
	<200712231138.30446.stefan@lucke.in-berlin.de>
	<476E5BF4.1030604@poczta.multimo.pl>
Message-ID: <200712231817.33383.stefan@lucke.in-berlin.de>

On Sunday 23 December 2007, Artur Skawina wrote:
> Stefan Lucke wrote:
> > On Sunday 23 December 2007, Andre Neumann wrote:
> >> Tested it also and noticed that when switching from an
> >> blank channel (a channel with no signal or card not in cam inserted) to a
> >> working channel, vdr crashes. 
> > 
> > Now I've a different version which solves initial issue in softdevice only.
> > This one removes tricks with AVFMT_NOFILE flag too, which in term
> > previously caused some problems in softplay:
> > 
> > http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softplay/SoftPlayer.c.diff?r1=1.16&r2=1.17
> > 
> > To test the new version, you have to backout both previous changes
> > (softdevice + ffmpeg).
> > 
> > With this one, there may be issues at termination, if ffmpeg's revision is
> > between and 11071 (ByteIOContext change) and 11269 (introduction of
> > function av_close_input_stream()). Issues may be a segfault or a
> > reported glibc error caused by ffmpeg url_fclose().
> > 
> > If you have a problems please check your ffmpeg version by:
> > $ ffplay |grep version
> 
> tried w/ stock ffmpeg r11306 and now vdr crashes 1) after the first channel change
> and 2) when started on "blank" channel like mentioned above.

Commenting out    //av_free(pb->buffer); looks like lowering
occurrence of 1).

2.) looks like a race condition as I can
reproduce that by fast zapping.

> 
> The former seems to be triggered by freeing pb->buffer:
> *** glibc detected *** vdr: free(): invalid pointer: 0xb1f7ca60 ***
> #5  0xb7d25f77 in free () from /lib/libc.so.6
> #6  0xb7c0986e in cMpeg2Decoder::initStream (this=0xb376dc18) at mpeg2decoder.c:1114
> #7  0xb7c099ec in cMpeg2Decoder::Start (this=0xb376dc18, GetMutex=true) at mpeg2decoder.c:1346
> #8  0xb7c040ed in cSoftDevice::SetPlayMode (this=0xb3708218, PlayMode=pmAudioVideo) at softdevice.c:428
> #9  0x08092cc3 in cDevice::AttachPlayer (this=0xb3708218, Player=0xb1faf96c) at device.c:960
> #10 0x080d271b in cControl::Attach () at player.c:80
> #11 0x0810a734 in main (argc=0, argv=0xbf909854) at vdr.c:689
> 
> the latter crash looks like this:
> Program received signal SIGSEGV, Segmentation fault.
> #0  0xb7a9b5c8 in av_read_packet (s=0xb21a7370, pkt=0xae9f5350) at utils.c:502
> #1  0xb7b9497c in cMpeg2Decoder::Action (this=0xb3948608) at mpeg2decoder.c:1160
> #2  0x080ff939 in cThread::StartThread (Thread=0xb3948608) at thread.c:252
> #3  0xb7f1222c in start_thread () from /lib/libpthread.so.0
> #4  0xb7d0cd2e in clone () from /lib/libc.so.6
> 

Stefan Lucke


From stefan at lucke.in-berlin.de  Sun Dec 23 21:30:10 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Sun, 23 Dec 2007 21:30:10 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <200712231817.33383.stefan@lucke.in-berlin.de>
References: <476AE719.40907@infodev.ca> <476E5BF4.1030604@poczta.multimo.pl>
	<200712231817.33383.stefan@lucke.in-berlin.de>
Message-ID: <200712232130.11160.stefan@lucke.in-berlin.de>

On Sunday 23 December 2007, Stefan Lucke wrote:
> On Sunday 23 December 2007, Artur Skawina wrote:
> > Stefan Lucke wrote:
> > > On Sunday 23 December 2007, Andre Neumann wrote:
> > >> Tested it also and noticed that when switching from an
> > >> blank channel (a channel with no signal or card not in cam inserted) to a
> > >> working channel, vdr crashes. 
> > > 
> > > Now I've a different version which solves initial issue in softdevice only.
> > > This one removes tricks with AVFMT_NOFILE flag too, which in term
> > > previously caused some problems in softplay:
> > > 
> > > http://cvs.berlios.de/cgi-bin/viewcvs.cgi/softdevice/softplay/SoftPlayer.c.diff?r1=1.16&r2=1.17
> > > 
> > > To test the new version, you have to backout both previous changes
> > > (softdevice + ffmpeg).
> > > 
> > > With this one, there may be issues at termination, if ffmpeg's revision is
> > > between and 11071 (ByteIOContext change) and 11269 (introduction of
> > > function av_close_input_stream()). Issues may be a segfault or a
> > > reported glibc error caused by ffmpeg url_fclose().
> > > 
> > > If you have a problems please check your ffmpeg version by:
> > > $ ffplay |grep version
> > 
> > tried w/ stock ffmpeg r11306 and now vdr crashes 1) after the first channel change
> > and 2) when started on "blank" channel like mentioned above.

You've been a bit too fast. Look at the commit log for r11307:

http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/utils.c?view=log

"100l, av_read_packet must check for read_packet error, in case of
error pkt->stream_index could be invalid and must not be used.
Fixes a crash with" [link removed].

So now I'm on r11311 and cannot get a crash by fast zapping.
Switching away from some chnnels without reception does not
harm anymore. av_free(pb->buffer); still commented out.

> 
> Commenting out    //av_free(pb->buffer); looks like lowering
> occurrence of 1).
> 
> 2.) looks like a race condition as I can
> reproduce that by fast zapping.
> 

Stefan Lucke


From lis_-t.20_0.7 at poczta.multimo.pl  Mon Dec 24 14:27:14 2007
From: lis_-t.20_0.7 at poczta.multimo.pl (Artur Skawina)
Date: Mon, 24 Dec 2007 14:27:14 +0100
Subject: [Softdevice-devel] mpeg2decoder.c compile error
In-Reply-To: <200712232130.11160.stefan@lucke.in-berlin.de>
References: <476AE719.40907@infodev.ca>
	<476E5BF4.1030604@poczta.multimo.pl>	<200712231817.33383.stefan@lucke.in-berlin.de>
	<200712232130.11160.stefan@lucke.in-berlin.de>
Message-ID: <476FB3B2.2040403@poczta.multimo.pl>

Stefan Lucke wrote:
> On Sunday 23 December 2007, Stefan Lucke wrote:
>> On Sunday 23 December 2007, Artur Skawina wrote:

>>> tried w/ stock ffmpeg r11306 and now vdr crashes 1) after the first channel change
>>> and 2) when started on "blank" channel like mentioned above.
> 
> You've been a bit too fast. Look at the commit log for r11307:
> 
> http://svn.mplayerhq.hu/ffmpeg/trunk/libavformat/utils.c?view=log
> 
> "100l, av_read_packet must check for read_packet error, in case of
> error pkt->stream_index could be invalid and must not be used.
> Fixes a crash with" [link removed].
> 
> So now I'm on r11311 and cannot get a crash by fast zapping.
> Switching away from some chnnels without reception does not
> harm anymore. av_free(pb->buffer); still commented out.

With ffmpeg r11312 and current softdevice cvs, no patches, everything
seems fine here too.

Thanks, Merry Christmas and Happy Holidays,

artur


From stefan at lucke.in-berlin.de  Tue Dec 25 10:32:49 2007
From: stefan at lucke.in-berlin.de (Stefan Lucke)
Date: Tue, 25 Dec 2007 10:32:49 +0100
Subject: [Softdevice-devel] GPL2 or GPL2anylater?
In-Reply-To: <4708023C.7090908@e-tobi.net>
References: <4708023C.7090908@e-tobi.net>
Message-ID: <200712251032.49745.stefan@lucke.in-berlin.de>

On Saturday 06 October 2007, Tobi wrote:
> Hello!
> 
> We (the Debian VDR packaging team) are currently checking all VDR
> plug-ins, if the correct licenses and copyrights are listed in the
> Debian-specific copyright file.
> 
> The softdevice plug-in contains a small disclaimer about the GPL in it's
> source files and refers to the COPYRIGHT file, but it's not clear, if
> the plug-in is licensed under "GPL2" or "GPL2 and any later".
> 
> Please consider adding the full license disclaimer as suggested in the
> GPL 2 license text after paragraph 12 ("How to Apply These Terms to Your
> New Programs"):
> 

> see also:
>     http://www.gnu.org/licenses/old-licenses/gpl-2.0.html#SEC4
>     http://www.fsf.org/licensing/licenses/gpl-howto.html
> 
> For the moment, we assume, that "GPL2 or any later" can be applied to
> this plug-in, if you have no objections.
> 

As noone had a comment (veto), I included attached diff to the README.


Stefan Lucke
-------------- next part --------------
Index: README
===================================================================
RCS file: /cvsroot/softdevice/softdevice/README,v
retrieving revision 1.25
retrieving revision 1.27
diff -U3 -r1.25 -r1.27
--- README	27 Sep 2007 18:22:40 -0000	1.25
+++ README	25 Dec 2007 09:31:04 -0000	1.27
@@ -14,6 +14,26 @@
 It can be used as an output device for the vdr. Possible output devices are
 Xv, DirectFB, Vidix or a framebuffer.
 
+License:
+--------
+
+? ? This is a output plugin for Klaus Schmidinger's vdr.
+? ? Copyright (C) 2007 ?Roland Praml,
+? ?                     Stefan Lucke, Torgeir Veimo, Martin Wache
+
+? ? This program is free software; you can redistribute it and/or modify
+? ? it under the terms of the GNU General Public License as published by
+? ? the Free Software Foundation; either version 2 of the License, or
+? ? (at your option) any later version.
+
+? ? This program is distributed in the hope that it will be useful,
+? ? but WITHOUT ANY WARRANTY; without even the implied warranty of
+? ? MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. ?See the
+? ? GNU General Public License for more details.
+
+? ? You should have received a copy of the GNU General Public License along
+? ? with this program; if not, write to the Free Software Foundation, Inc.,
+? ? 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 
 Requirements:
 -------------

From torgeir at pobox.com  Tue Dec 25 11:57:23 2007
From: torgeir at pobox.com (Torgeir Veimo)
Date: Tue, 25 Dec 2007 20:57:23 +1000
Subject: [Softdevice-devel] GPL2 or GPL2anylater?
In-Reply-To: <200712251032.49745.stefan@lucke.in-berlin.de>
References: <4708023C.7090908@e-tobi.net>
	<200712251032.49745.stefan@lucke.in-berlin.de>
Message-ID: <387FC1D7-AEA2-4DE3-A03E-626F49A3D9EA@pobox.com>


On 25 Dec 2007, at 19:32, Stefan Lucke wrote:

> On Saturday 06 October 2007, Tobi wrote:
>> Hello!
>>
>> We (the Debian VDR packaging team) are currently checking all VDR
>> plug-ins, if the correct licenses and copyrights are listed in the
>> Debian-specific copyright file.
>>
>> The softdevice plug-in contains a small disclaimer about the GPL in  
>> it's
>> source files and refers to the COPYRIGHT file, but it's not clear, if
>> the plug-in is licensed under "GPL2" or "GPL2 and any later".
>>
>> Please consider adding the full license disclaimer as suggested in  
>> the
>> GPL 2 license text after paragraph 12 ("How to Apply These Terms to  
>> Your
>> New Programs"):
>>
>
>> see also:
>>    http://www.gnu.org/licenses/old-licenses/gpl-2.0.html#SEC4
>>    http://www.fsf.org/licensing/licenses/gpl-howto.html
>>
>> For the moment, we assume, that "GPL2 or any later" can be applied to
>> this plug-in, if you have no objections.
>>
>
> As noone had a comment (veto), I included attached diff to the README.

+1

-- 
Torgeir Veimo
torgeir at pobox.com





From bob at globall.ru  Mon Dec 31 14:58:04 2007
From: bob at globall.ru (Vladimir Monchenko)
Date: Mon, 31 Dec 2007 16:58:04 +0300
Subject: [Softdevice-devel] softdevice+dvd plugin - audio jerks
In-Reply-To: <46529A6C.8010303@huillard.net>
References: <46517C2F.1080507@globall.ru>	<471021BE-A15C-472C-9E27-E43B1713DACE@pobox.com>	<4651E871.7000105@globall.ru>	<A61AB388-C503-4DA8-BD51-53591A1A0907@pobox.com>	<4652659B.2090306@globall.ru>	<4652806D.8000905@globall.ru>
	<46529A6C.8010303@huillard.net>
Message-ID: <4778F56C.6060104@globall.ru>

I have updated today ffmpeg and softdevice from cvs.
At playing of DVD through vdr-dvd plugin I get an irregular and jerks
audio. After downgrade on the version softdevice from 2007-08-29 all it
is played normally.

It is my vdr log:

libdvdnav: Using dvdnav version 0.1.10 from http://dvd.sf.net
libdvdread: Using libdvdcss version 1.2.9 for DVD access
libdvdnav: DVD Title: ROBIN_HOOD_PRINCE_OF_THIEVES
libdvdnav: DVD Serial Number: 297098F7
libdvdnav: DVD Title (Alternative): ROBIN_HOOD_PRINCE_OF_THIEVES
libdvdnav: Unable to find map file
'/home/bob/.dvdnav/ROBIN_HOOD_PRINCE_OF_THIEVES.map'
libdvdnav: DVD disk reports itself with Region mask 0x00ef0000. Regions: 5

libdvdread: Attempting to retrieve all CSS keys
libdvdread: This can take a _long_ time, please be patient

libdvdread: Get key for /VIDEO_TS/VIDEO_TS.VOB at 0x00000120
libdvdread: Elapsed time 0
libdvdread: Get key for /VIDEO_TS/VTS_01_0.VOB at 0x000001eb
libdvdread: Elapsed time 0
libdvdread: Get key for /VIDEO_TS/VTS_01_1.VOB at 0x00000501
libdvdread: Elapsed time 0
libdvdread: Found 1 VTS's
libdvdread: Elapsed time 0
No accelerated IMDCT transform found
16:44:01.0410 D [47562467843823] [VideoOut] reset: sync info: repF =
1908404013, drpF = 16892704, totF = 1938060864
ALSA lib pcm.c:2144:(snd_pcm_open_noupdate) Unknown PCM CH2
Warning, unsupported format in ClearPicBuffer!
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
16:44:04.0427 D [7921] [VideoOut] video now synced (-1628 - -1628)
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame
[liba52 @ 0x2b4273f9fbf0]Error decoding frame


Happy New Year!

Regards,
Vladimir Monchenko.




